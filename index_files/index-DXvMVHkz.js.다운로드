import{f as Hle,R as ae,r as h,j as s,b as cH,h as lR}from"./0-vendor-react-CBSVGXw6.js";import{m as qe,h as Vt,a as ya}from"./1-vendor-moment-z4ywv-JG.js";import{c as Y,A as Vle,v as ct,i as Wle,g as Yle,R as qle,a as Kle,u as Hg,b as Ne,d as cR,m as zle,e as Qle,t as M_,f as lF,h as Xle,q as Qe,P as m,s as Ho,j as Zle,n as dH,k as Jle,p as sC,l as ece,o as f,r as Vo,w as F,x as uH,G as tce,y as zr,z as Fp,B as sce,C as w_,D as Pe,E as nce,F as oce,H as cF,I as rce,J as ace,K as pH,L as ice,M as dF,N as L,O as ie,Q as ee,W as Fi,S as O,T as _e,V as Xh,U as ln,X as Bp,Y as lce,Z as cce,_ as dce,$ as Ts,a0 as Vr,a1 as Yd,a2 as Oi,a3 as xe,a4 as Zh,a5 as vl,a6 as we,a7 as gp,a8 as Tt,a9 as Ht,aa as Js,ab as dR,ac as Ge,ad as uce,ae as qd,af as Us,ag as uR,ah as pce,ai as ps,aj as mce,ak as hce,al as uF,am as gce,an as Ece,ao as fce,ap as yce,aq as Ice,ar as Sce,as as Gn,at as Cce,au as vce,av as Nt,aw as V,ax as mH,ay as pR,az as Tce,aA as _ce,aB as po,aC as Dn,aD as On,aE as nn,aF as nC,aG as mR,aH as rp,aI as bce,aJ as bx,aK as xce,aL as Ace,aM as F_,aN as Er,aO as hH,aP as Si,aQ as Pi,aR as Qu,aS as Ep,aT as Kd,aU as Py,aV as xx,aW as Go,aX as hR,aY as oC,aZ as zd,a_ as Rce,a$ as Dce,b0 as gH,b1 as PI,b2 as Dd,b3 as rC,b4 as bn,b5 as Oce,b6 as Pce,b7 as EH,b8 as Nce,b9 as Od,ba as Ny,bb as Lce,bc as gR,bd as fH,be as yh,bf as kce,bg as jce,bh as Mce,bi as wce,bj as Fce,bk as yH,bl as IH,bm as Bce,bn as pF,bo as Uce,bp as Gce,bq as $ce,br as Hce,bs as Vce}from"./2-vendor-C2bQmiiO.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};e.__faroBundleId_webuniversal="1756454773760508d1046be"}catch{}})();(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};e.__faroBundleId_webuniversal="1756454773760bb4a502313"}catch{}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const Ta="YYYY-MM-DD",SH="YYYY-MM-DDTHH:mm:ssZ",Wce="DD-MM-YY",CH="dddd D MMMM",Sr="ddd DD MMM",aC="ddd DD",iC="ddd DD MMM H:mm",NI="ddd DD MMM YYYY",Yce="DD MMM YYYY",vH="DD/MM/YYYY",TH="DD/MM/YY",lC="ll",qce="L",Kce="LLLL",$n="HH:mm",_H="ddd",Ja="dddd",bH="DD",Ax="M",xH="MMMM YYYY",Rx="Do MMMM YYYY",AH="DD MMM",Dx="DD MMMM",RH="MMM",DH="minutes",ER="day",cC="days",dC="month",fR="months",yR="week",OH="weeks",qs=(e,t)=>qe(t).format(e),PH=(e,t)=>qe(t).format(e),Qd=(e,t)=>{const n=typeof e=="string"?Number(e):e;return typeof n=="number"&&n>=1&&n<=7?qe().isoWeekday(n).format(t):""},gt=(e,t)=>qe.parseZone(e,qe.ISO_8601).format(t),Vg=(e,t,n)=>{const o=gt(e,n),r=gt(t,n);return`${o} - ${r}`},zce=(e,t,n,o)=>({fromDate:gt(e,n),toDate:gt(t,o)}),NH=(e,t,n)=>`${gt(e,t)} ${gt(e,n)}`,Wg=e=>/[+|-][0-9]{2}/.test(qe.tz(e).zoneName())?"[GMT]zz":"zz",$o=(e,t,n,o)=>qe.parseZone(e,qe.ISO_8601).tz(t).format(`${n}${o?` ${Wg(t)}`:""}`),IR=(e,t,n,o)=>qe.parseZone(e,qe.ISO_8601).tz(t).format(`${n}${o?` ${Wg(t)}`:""}`),SR=(e,t,n,o,r)=>qe.parseZone(e,qe.ISO_8601).tz(t).format(`${n} ${o}${r?` ${Wg(t)}`:""}`),LH=(e,t,n,o,r)=>{const a=qe.parseZone(e,qe.ISO_8601).tz(n),i=qe.parseZone(t,qe.ISO_8601).tz(n);return`${a.format(o)} - ${i.format(`${o}${r?` ${Wg(n)}`:""}`)}`},kH=(e,t,n,o,r,a)=>{const i=qe.parseZone(e,qe.ISO_8601).tz(n),l=qe.parseZone(t,qe.ISO_8601).tz(n),c=i.format(o),d=l.format(o),u=c!==d?`${d} `:"",p=l.format(`${r}${a?` ${Wg(n)}`:""}`);return`${c} ${i.format(r)} - ${u}${p}`},jH=(e,t,n,o)=>{const r=gt(e,n),a=gt(t,n),i=gt(e,o),l=gt(t,o),c=r!==a?`${a} `:"";return`${r} ${i} - ${c}${l}`},Jh=(e,t)=>qe.utc(e).tz(t).format(SH),Yg=(e,t,n)=>qe(n).add(e,t).format(),Ox=(e,t)=>Yg(e,DH,t),uC=(e,t)=>Yg(e,cC,t),MH=(e,t)=>Yg(e,fR,t),Qce=(e,t)=>qe(t).subtract(e,fR).format(),wH=(e,t)=>qe(t).subtract(e,cC).format(),Pd=(e,t=qe())=>qe(e).isAfter(qe(t)),qg=(e,t)=>qe(e)-qe(t),Xce=(e,t)=>Pd(e,t)?t:e,Zce=()=>qe.localeData().firstDayOfWeek(),FH=(e,t,n)=>{const r=qe(e),a=qe(t);if(!r.isValid()||!a.isValid())return"Invalid date";const l=Math.abs(r.diff(a,n))/1+1;return Array.from(Array(l)).map((c,d)=>Yg(d*1,n,e))},BH=(e,t)=>FH(e,t,cC),Jce=(e,t)=>FH(e,t,OH),ede=(e,t)=>qe(e).isSame(qe(t),ER),tde=e=>qe(e).startOf(dC).startOf(yR).format(),sde=e=>qe(e).endOf(dC).endOf(yR).format(),de=(e="")=>e!==""?qe(e).valueOf():qe().valueOf(),nde=e=>e?qe(e).valueOf():qe().valueOf(),CR=e=>qe(e).format(),Ni=()=>qe().format(),UH=(e="")=>e.split("T")[0],eg=e=>qe(e).valueOf(),ode=e=>qe(e).toDate(),rde=e=>qe(e),pC=e=>qe(e).toDate(),LI=e=>qe(e).toISOString(),GH=()=>qe().utc().toISOString(),$H=e=>qe.locale(e),ade=()=>Date,tg=e=>qe.tz.zone(e)!==null,sg=e=>qe.tz.guess()||e||"UTC",Px=e=>qe().tz(e).utcOffset(),kI=(e,t)=>{const n=qe(e).startOf("day"),o=qe(t).startOf("day");return n.diff(o,"days")},Tc=e=>{const t=qe().startOf("day");return qe(e).startOf("day").diff(t,"days")},mC=e=>Tc(e)<0,ide=e=>Tc(e)>0,lde=e=>Tc(e)===-1,Nd=e=>Tc(e)===0,ng=e=>Tc(e)===1,vR=(e,t)=>qe(e).startOf("day").isSame(qe(t).startOf("day"),ER),HH=(e,t)=>qe(e).isSame(qe(t),dC),Ih=Object.freeze(Object.defineProperty({__proto__:null,DATE_FORMAT_DAY_AND_FULL_MONTH:Dx,DATE_FORMAT_DAY_AND_MONTH:AH,DATE_FORMAT_DAY_WITH_LEADING_ZEROS:bH,DATE_FORMAT_FULL_DAY_NAME:Ja,DATE_FORMAT_HYPHEN_SEPARATED:Wce,DATE_FORMAT_LOCALE_DEPENDENT:lC,DATE_FORMAT_LOCALE_DEPENDENT_LONG:Kce,DATE_FORMAT_LOCALE_DEPENDENT_SHORT:qce,DATE_FORMAT_MONTH_INDEX:Ax,DATE_FORMAT_MONTH_SHORTHAND:RH,DATE_FORMAT_MONTH_YEAR_LABEL:xH,DATE_FORMAT_SHORT_ISO:Ta,DATE_FORMAT_SHORT_WEEKDAY_NAME:_H,DATE_FORMAT_SLASH_SEPARATED_WITH_FULL_YEAR:vH,DATE_FORMAT_SLASH_SEPARATED_WITH_SHORT_YEAR:TH,DATE_FORMAT_SPACE_SEPARATED_WITH_FULL_YEAR:Yce,DATE_FORMAT_UTC_WITH_OFFSET:SH,DATE_FORMAT_WRITTEN:CH,DATE_FORMAT_WRITTEN_SHORTHAND:Sr,DATE_FORMAT_WRITTEN_SHORTHAND_WEEKDAY:aC,DATE_FORMAT_WRITTEN_SHORTHAND_WITH_YEAR:NI,DATE_FORMAT_WRITTEN_WITH_FULL_YEAR:Rx,DATE_TIME_FORMAT_WRITTEN_SHORTHAND:iC,TIME_FORMAT_MILITARY:$n,TIME_PERIOD_DAY:ER,TIME_PERIOD_DAYS:cC,TIME_PERIOD_MINUTES:DH,TIME_PERIOD_MONTH:dC,TIME_PERIOD_MONTHS:fR,TIME_PERIOD_WEEK:yR,TIME_PERIOD_WEEKS:OH,addDays:uC,addMinutes:Ox,addMonths:MH,addPeriod:Yg,areDaysTheSame:ede,checkDiffBetweenTodayAndGivenDayInDays:Tc,checkIfDaysAreTheSame:vR,checkIfGivenDateIsInTheFuture:ide,checkIfGivenDateIsInThePast:mC,checkIfGivenDateIsToday:Nd,checkIfGivenDateIsTomorrow:ng,checkIfGivenDateIsYesterday:lde,checkIfMonthsAreTheSame:HH,convertUtcDateToUtcWithOffset:Jh,formatDate:qs,formatDateTime:NH,formatDateTimeIntervalWithFixedTimezone:jH,formatDateTimeIntervalWithTimeZone:kH,formatDateTimeWithTimeZone:SR,formatDateWithFixedTimezone:gt,formatDateWithTimeZone:$o,formatDayOfWeekIso:Qd,formatInterval:Vg,formatTime:PH,formatTimeIntervalWithTimeZone:LH,formatTimeWithTimeZone:IR,genDayRange:BH,genWeekRange:Jce,getClientLocalTimeZoneId:sg,getDateFromIso:pC,getDateFromTimestamp:ode,getDateLibraryObjectFromIso:rde,getDiffInDays:kI,getEarliestDate:Xce,getFirstDayOfWeekCrossingBeginningOfMonth:tde,getFirstDayOfWeekIndex:Zce,getFormattedIntervalDates:zce,getIsoDateFromDatetime:UH,getIsoFromTimestamp:CR,getIsoNow:Ni,getLastDayOfWeekCrossingEndOfMonth:sde,getMillisecondsSinceUnixEpoch:de,getMillisecondsSinceUnixEpochFromTimestamp:nde,getNativeDate:ade,getTimeZoneOffset:Px,getTimestampFromIso:eg,getUtcIso:GH,isDateAfter:Pd,isTimeZoneIdValid:tg,setLocale:$H,subtractDate:qg,subtractDays:wH,subtractMonths:Qce,toUtcIso:LI},Symbol.toStringTag,{value:"Module"})),Xd=({retailerSettings:e})=>e["default-time-zone"],Mt=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-time`]||$n,cde=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-time-range-start`],dde=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-time-range-end`],TR=Y(Mt,cde,dde,(e,t,n)=>!t||!n?{startFormat:e,endFormat:e}:{startFormat:t,endFormat:n}),cr=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-date-numerical`]||vH,Zt=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-date-descriptive`]||Sr,ude=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-datetime-descriptive`]||iC,VH=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-momentjs-month-of-year`]||xH,Bi=({data:e,retailerSettings:t})=>t[`display-format-${e.locale.active}-currency-format`]||"",pde=Y(({retailerSettings:e})=>e["validation-customer-details-form-definition"],e=>{if(!e)return[];try{return JSON.parse(decodeURIComponent(e))}catch{return[]}}),mde=({retailerSettings:e})=>e["validation-mobile-phone-number-mask-frontend"],Up=({retailerSettings:e})=>e["validation-chars-allowed"],_R=({retailerSettings:e})=>e["validation-postal-code-mask"],hde=({retailerSettings:e})=>e["customer-account-external-management-return-redirect-web-url"],gde=({retailerSettings:e})=>e["customer-account-external-management-url"],Ede=({retailerSettings:e})=>e["customer-promise-price-and-promotions-strategy"],Ze=({retailerSettings:e},t)=>e[t],bR=({retailerSettings:e})=>Number(e["basket-max-quantity-per-product"]??0),fde=Y(({retailerSettings:e})=>e["slot-booking-slot-time-font-size"],({retailerSettings:e})=>e["slot-booking-slot-time-font-weight"],(e,t)=>({fontSize:e,fontWeight:t})),yde=Y(({retailerSettings:e})=>e["required-user-info-marketing-prefs"],e=>e?.split(",").map(t=>t.trim())||[]),hC=({retailerSettings:e})=>e["orders-display-fiscal-invoice-form-url"],WH=({retailerSettings:e})=>e["orders-display-hide-external-orders-alert"]==="true",Ide=({retailerSettings:e})=>e["use-by-date-short-year-web"]||TH,Sde=({retailerSettings:e})=>e["use-by-date-short-weekday-web"]||_H,Cde=({retailerSettings:e})=>e["pop-up-banner-page-count-to-reset"],vde=({retailerSettings:e})=>e["psps-to-save-payment-method"]==="true",Tde=({retailerSettings:e})=>e["psps-show-checkout-complete-invoice-icon"]==="true",Hn=Y(({retailerSettings:e})=>e["images-formats"],e=>e?.split(",").map(t=>t.trim())??[]),gC=({retailerSettings:e})=>e["infinite-scroll-server-side-fop-decoration-limit"]||"50",_de=({retailerSettings:e})=>({iosAppId:e["smart-banners-ios-app-id"],iosCustomScheme:e["smart-banners-ios-custom-scheme"],iosIconUrl:e["smart-banners-ios-icon-url"],iosAppStoreUrl:e["smart-banners-ios-app-store-url"],iosAppTeamId:e["smart-banners-ios-app-team-id"],iosAppBundleId:e["smart-banners-ios-app-bundle-id"],androidPackageName:e["smart-banners-android-package-name"],androidCustomScheme:e["smart-banners-android-custom-scheme"],androidIconUrl:e["smart-banners-android-icon-url"],androidAppFallbackUrl:e["smart-banners-android-fallback-url"],appTitle:e["smart-banners-app-title"],appAuthor:e["smart-banners-app-author"],hideTTL:e["smart-banners-hide-ttl"],visiblePages:e["smart-banners-visible-pages"]}),bde=({retailerSettings:e})=>Number(e["basket-max-number-items"]||1e3),xde={enabledFeatures:[]},Ade=(e=xde)=>e,Kg=e=>e.session.features.enabledFeatures,D=e=>Y(Kg,t=>t.some(n=>n===e)),Wn=e=>Y(Kg,t=>e.some(n=>t.includes(n))),Ro=e=>Y(Kg,t=>e.every(n=>t.includes(n))),Pn="@@router/LOCATION_CHANGE",Rde=(e,t,n=!1)=>({type:Pn,payload:{location:e,action:t,isFirstRendering:n}}),mF=e=>{if(e&&e.query)return e;const t=e&&e.search;if(typeof t!="string"||t.length===0)return{...e,query:{}};const r=t.substring(1).split("&").reduce((a,i)=>{const[l,c]=i.split("=");return{...a,[l]:c}},{});return{...e,query:r}},Dde=(e,t)=>t?.length&&e.startsWith(t)?e.replace(t,"")||"/":e,Ode=({basePath:e,initialLocation:t,initialAction:n})=>{const o={location:mF({pathname:Dde(t.pathname,e),search:t.search??"",hash:"",key:"default",state:null}),action:n??Vle.Pop};return(r=o,{type:a,payload:i}={})=>{if(a===Pn){const{location:l,action:c,isFirstRendering:d}=i;return d?r:{...r,location:mF(l),action:c}}return r}},Ly={error:null,fetchError:!1,isFetching:!1},ky={selectedItems:[],refundValueBreakdown:{taxComponents:[],net:null,gross:null,displayAmount:null},...Ly},Nx={newRefundRequest:{regionId:"",availableItems:[],refundReasonsPerCategory:[],...Ly},summary:ky,createdRefundRequest:{anyItemAvailableForRefund:!1,newRefundRequestCreationCutoff:"",regionId:"",requestedItems:[],...Ly},placeRefundRequest:{refundRequestId:null,expectedRequestReviewTime:null,...Ly}},je={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null},ms={benefits:{...je,currentSubscription:{...je}},customerDeliveryPassSubscription:{...je},menuCampaigns:{...je},checkoutWalk:{...je,data:{}},orders:{all:{...je,retentionPeriod:"",orders:[]},pending:{...je,orders:[]},past:{...je,retentionPeriod:"",nextPageToken:"",orders:[]},current:{order:{...je},refunds:Nx,loyalty:{...je}},failedPayments:{...je,orders:[]},recurring:{definitions:{...je}},orderEntities:{lastUpdated:null}},addWalletItemModal:{},footer:{...je,links:{sections:[],contact:"",social:[],feedback:""}},contentBlocks:{...je,blocks:[]},advertisingBanners:{...je},customer:{addresses:{...je,data:[]},addressFields:{...je,formSection:{title:"",fields:[]}},addressDetails:{...je,data:{}},billingAddress:{...je},addressValidation:{...je,data:{formattedAddress:"",id:"",additionalInformation:""}},segments:{...je}},addressLookup:{metadata:{...je}},favorite:je,bop:{details:{...je}},products:{alternatives:{...je,data:{}},catalogue:{...je},offers:{...je,data:{promotionPageType:"UNKNOWN",sortOptions:[],promoId:"",retailerPromotionId:"",description:"",promotionGroups:[{products:[],quantity:0}]}},productEntities:{},missedPromotions:[]},wallet:{...je,items:[]},theme:{...je},retailer:{addressFields:{...je}},search:{suggestions:{...je,data:[],smartSearchSuggestions:null,isSearchPage:!1},redirects:{...je}},topTabs:{...je,data:[]},shopInShop:{html:"",productIds:[],isFetching:!1},recipes:{homePageComponents:{...je},homePage:{...je},searchPage:{...je},collectionDetailsPage:{...je},savedRecipesPage:{...je}},recommendedProducts:{...je},toggleablePromotions:je},se=e=>({DISPATCH:`${e}_DISPATCH`,PENDING:`${e}_PENDING`,SUCCESS:`${e}_SUCCESS`,ERROR:`${e}_ERROR`,ABORT:`${e}_ABORT`}),EC="PAGE_PART_VIEW_CHANGE",YH="APP_MOUNTED",qH="USER_JUST_LOGGED_IN",KH="CLEAR_USER_JUST_LOGGED_IN",zH="SET_CLIENT_ROUTE_ID",QH="SET_HAS_PAGE_BEEN_HIDDEN",jy=se("GET_RETAILER_CUSTOMER_ID"),My=(e,t)=>({type:EC,payload:{location:e,pagePartType:t}}),Pde=()=>({type:YH}),Nde=(e=!1)=>({type:qH,payload:{withRegistration:e}}),Lde=()=>({type:KH}),XH=e=>({type:"API",payload:{url:`/customer/v3/customers/${e}/customerRetailerId`,service:"web_customer_ws",...jy}}),kde=()=>({type:zH}),B_=e=>({type:QH,payload:{hasPageBeenHidden:e}}),jde={...je,locationChangeCount:0,isFullPageLoad:!0,isServerRendered:!1,hasPageBeenHidden:!1,reportingLevel:0,assetVersion:"",environment:"",bannerId:"",bannerName:"",regionId:"",clientRouteId:"",requestId:"",visitorId:"",fqdn:"",userJustLoggedIn:!1,userJustRegistered:!1},ZH={CENTRALIZED:"CENTRALIZED",STORE:"STORE"},Mde=(e=jde,t)=>{switch(t.type){case Pn:return{...e,pageViewId:ct(),locationChangeCount:e.locationChangeCount+1,isFullPageLoad:e.locationChangeCount===0};case EC:return{...e,pageViewId:ct()};case QH:return{...e,hasPageBeenHidden:t.payload.hasPageBeenHidden};case zH:return{...e,clientRouteId:ct()};case YH:return{...e,isServerRendered:!1};case qH:return{...e,userJustLoggedIn:!0,userJustRegistered:t.payload.withRegistration};case KH:return{...e,userJustLoggedIn:!1,userJustRegistered:!1};case jy.PENDING:return{...e,isFetching:!0,fetchError:!1};case jy.ERROR:return{...e,isFetching:!1,fetchError:!0,retailerCustomerId:void 0};case jy.SUCCESS:return{...e,isFetching:!1,fetchError:!1,retailerCustomerId:t.payload.responseData.customerRetailerId};default:return e}},_c=({session:e})=>e.metadata.sessionId,Rt=({session:e})=>e.metadata.isServerRendered,xr=({session:e})=>e.metadata.customerId,ei=({session:e})=>e.metadata.retailerCustomerId,Gp=({session:e})=>e.metadata.visitorId,vn=({session:e})=>e.metadata.regionId,sa=({session:e})=>e.metadata.retailerRegionId,xR=({session:e})=>e.metadata.regionName,fC=({session:e})=>e.metadata.requestId,ti=({session:e})=>e.metadata.bannerId,yC=({session:e})=>e.metadata.retailerBannerId,Zd=({session:e})=>e.metadata.bannerName,AR=({session:e})=>e.metadata.contentExperienceUserId,Tl=({session:e})=>e.metadata.bannerBusinessModel,wde=Y(Tl,e=>e===ZH.CENTRALIZED),Fde=Y(Tl,e=>e===ZH.STORE),Nn=({session:e})=>e.metadata.pageViewId,Bde=({session:e})=>e.metadata.serverLoadTime,Ude=({session:e})=>e.metadata.userJustLoggedIn,Gde=({session:e})=>e.metadata.userJustRegistered,IC=({session:e})=>e.metadata.isFullPageLoad,JH=({session:e})=>e.metadata.locationChangeCount,Do=({session:e})=>e.metadata.clientRouteId,SC=({session:e})=>e.metadata.fqdn,At=e=>e?.session?.metadata?.basePath,CC=e=>e?.session?.metadata?.assetVersion,$de=e=>e.session.metadata.environment,eV=e=>e?.session?.metadata?.hasPageBeenHidden,tV=({session:e})=>e.metadata.reportingLevel,Oo=({session:e})=>({basePath:e.metadata?.basePath,clientRouteId:e.metadata?.clientRouteId,requestId:e.metadata?.requestId,csrfToken:e.csrf?.token}),Hde=.1,Vde=e=>{const t={collectorURL:Ze(e,"grafana-faro-web-url"),includePII:Ze(e,"grafana-faro-include-pii")==="true",samplingRate:Hde},n=[],o=Ze(e,"grafana-faro-sampling-rate"),r=Number(o||"NaN");return isNaN(r)?n.push(new Error(`Invalid setting 'grafana-faro-sampling-rate': '${o}'`)):t.samplingRate=r,[t,n]},Wde=e=>{if(!D("faro")(e))return;const[t,n]=Vde(e),o=t.includePII?{id:xr(e)}:void 0,r=Wle({url:t.collectorURL,instrumentations:[...Yle(),new qle({router:Kle({createRoutesFromChildren:Qle,matchRoutes:zle,Routes:cR,useLocation:Ne,useNavigationType:Hg})})],app:{name:"webuniversal",version:CC(e),environment:$de(e)},sessionTracking:{samplingRate:t.samplingRate,session:{attributes:{bannerId:ti(e),bannerName:Zd(e)}}},user:o});n.forEach(a=>{r.api.pushError(a)})};Wde(window.__INITIAL_STATE__);function sV(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Yde(){window.Element.prototype.remove||(window.Element.prototype.remove=function(){this.parentElement.removeChild(this)},window.HTMLCollection.prototype.remove=function(){for(let e=this.length-1;e>=0;e--)this[e]&&this[e].parentElement&&this[e].parentElement.removeChild(this[e])},window.NodeList.prototype.remove=window.HTMLCollection.prototype.remove)}function qde(e,t){return sV()&&document.querySelector(t)?Hle.createPortal(e,document.querySelector(t)):null}function Kde(){if(sV()){Yde();const e=document.querySelectorAll("[data-react-universal-portal]");[].slice.call(e).forEach(function(t){t.remove()})}}const zde="default"in M_?M_.default:M_,hF={api:{pushError:()=>{},pushLog:()=>{},pushTraces:()=>{},pushEvent:()=>{},pushMeasurement:()=>{},changeStacktraceParser:()=>{},getStacktraceParser:()=>{},getOTEL:()=>{},getTraceContext:()=>{},initOTEL:()=>{},isOTELInitialized:()=>!1,setUser:()=>{},resetUser:()=>{},getPage:()=>{},setPage:()=>{},setSession:()=>{},resetSession:()=>{},getSession:()=>{},setView:()=>{},getView:()=>{}},instrumentations:{add:()=>{},remove:()=>{},instrumentations:[]},metas:{add:()=>{},remove:()=>{},addListener:()=>{},removeListener:()=>{},value:{}},transports:{add:()=>{},addBeforeSendHooks:()=>{},execute:()=>{},getBeforeSendHooks:()=>[],isPaused:()=>!1,remove:()=>{},removeBeforeSendHooks:()=>{},transports:[],pause:()=>{},unpause:()=>{}},config:{app:{},dedupe:!1,globalObjectKey:"",instrumentations:[],internalLoggerLevel:0,isolate:!1,metas:[],parseStacktrace:()=>({frames:[]}),paused:!1,preventGlobalExposure:!1,transports:[],unpatchedConsole:console},internalLogger:{debug:()=>{},error:()=>{},info:()=>{},prefix:"",warn:()=>{}},unpatchedConsole:console,pause:()=>{},unpause:()=>{}},Ue=new Proxy(hF,{get(e,t,n){const o=lF?.config?.app?.name?lF:hF;return Reflect.get(o,t,n)}}),Qde=(e,t)=>{try{if(!t.getState().session.features.enabledFeatures.includes("aev"))return;e.forEach(o=>{if(o&&typeof o=="object"&&"event"in o){const r=o.event;Xle.googleAnalyticsEventHandler(r,o).forEach(i=>{const l=new Error(`GA-INVALID:${r}`),c=JSON.stringify(i),d=JSON.stringify(o);Ue.api.pushError(l,{context:{validationError:c,event:d}})})}})}catch(n){const o=n instanceof Error?n:new Error(`handleGaValidation error: ${JSON.stringify(n)}`);Ue.api.pushError(o)}},Xde={error:null,fetchError:!1,isFetching:!1,lastUpdated:null,didInvalidate:!1},Zde={errorCheckoutBasket:null,fetchErrorCheckoutBasket:!1,isFetchingCheckoutBasket:!1,lastCheckoutBasketUpdated:null},Jde={isVoucherError:!1,isVoucherFetching:!1},eue={...Xde,...Zde,...Jde},tue={ageRestriction:null,appliedPaymentChecks:null,checkout:{basketAboveThreshold:!1,canCheckout:!1,minimumCheckoutThreshold:{amount:"0",currency:"GBP"},shippingGroupType:"",shippingGroupTypeDisplayName:""},basketId:null,basketStatus:null,bufferRate:null,carrierBag:null,delivery:null,deliveryDestinationId:null,deliveryPriceModificationLevels:null,deliveryPromotions:[],invoice:null,items:[],loyalty:null,orderId:null,checkoutCorrelationId:null,activeCheckoutGroupId:null,orderLevelPromotions:[],preparation:null,regionId:null,remainingTimeToEditInMillis:null,removedPaymentChecks:null,slot:null,smallOrder:null,defaultSlot:null,nextAvailableSlot:null,unavailableData:[],checkoutGroups:[],unassignedItems:[],variablePrice:!1,vouchers:[]},Qo={...eue,...tue},jt=({basePath:e=""}={})=>`${e}/basket`,nV=({basePath:e="",shippingGroupType:t="",showErrorIfShippingGroupDoesntExist:n=!1}={})=>`${jt({basePath:e})}?error=below-minimum-spend${t?`&errorShippingGroupType=${t}`:""}${n?"&showError=true":""}`,lo=()=>"/orders",sue=(e,t)=>`${lo()}/recurring-shopping/definitions/${e}/scheduled/${t}`,cn=(e,t,n="")=>{const o=t?`?${t}`:"";return`${n}${lo()}/${e}/details${o}`},oV=e=>`/api/receipts/v1/orders/${e}/receipt.pdf`,rV=/orders\/\d+\/details/,aV=D("logmod"),nue=D("logmod.dest"),oue=D("asi"),rue=D("asi.m"),Xe=e=>e.session.isLoggedIn,Ui=({basePath:e="",queryString:t=""}={})=>`${e}/delivery${t}`,RR=(e="")=>`${Ui({basePath:e})}/home`,DR=(e="")=>`${Ui({basePath:e})}/collection`,bc=(e="")=>`${RR(e)}/slots`,Jd=(e="")=>`${DR(e)}/slots`,aue=()=>"/slots",na=({basePath:e="",queryString:t=""}={})=>`${e}/checkout${t?`?${t}`:""}`,vr=({basePath:e="",queryString:t=""}={})=>`${na({basePath:e})}/summary${t?`?${t}`:""}`,iue=({basePath:e=""}={})=>`${na({basePath:e})}/3ds`,OR=({basePath:e="",queryString:t=""}={})=>{const n=t?`?${t}`:"";return`${iue({basePath:e})}/continue${n}`},zg=({pageKey:e="",queryString:t=""}={})=>`${na()}/checkout-walk/${e}${t?`?${t}`:""}`,Qg=(e={})=>{const t=e.orderId?`?orderId=${e.orderId}`:"";return`${na()}/complete${t}`},lue=({basePath:e=""}={})=>`${na({basePath:e})}/3ds`,Tr=({basePath:e="",inCheckoutWalk:t=!1,shippingGroupType:n="",directDeliveryMethod:o=void 0,searchParams:r=new URLSearchParams,isContinue:a=!1}={})=>{let i=Ui({basePath:e});return o==="HOME_DELIVERY"&&(i=bc(e)),o==="CUSTOMER_COLLECTION"&&(i=Jd(e)),r.set("in-checkout-walk",`${t}`),n&&r.set("shippingGroup",n),t&&a&&r.set("continue",`${a}`),`${i}?${r.toString()}`},iV=se("GET_ACTIVE_SESSION"),cue=e=>({type:"API",payload:{url:Qe.stringifyUrl({url:"/v2/sessions/active",query:{...e&&{regionId:e}}}),pathPrefix:{client:"/api/customersessions",server:"/core-api"},service:"customersessions",...iV}}),Lx={getActiveSession:cue,types:{GET_ACTIVE_SESSION:iV}},due=()=>async(e,t)=>{let n=null;const o=t(),{regionId:r}=o.session.metadata;try{n=(await e(Lx.getActiveSession(r)))?.payload?.responseData}catch(a){Ue.api.pushError(new Error("CustomerSession: Get active session call failed"),{context:{errorData:JSON.stringify(a,Object.getOwnPropertyNames(a))}})}return n},uue={getActiveSession:due},pue={ORDER_EDIT:"ORDER_EDIT"},ma={CART:"CART",CART_VIEW:"CART_VIEW",CHECKOUT_WALK:"CHECKOUT_WALK",CHECKOUT_SUMMARY:"CHECKOUT_SUMMARY"},kx={NULL:"NULL",ADDITION_TIME:"ADDITION_TIME",CATEGORIES:"CATEGORIES",SELLER:"SELLER"},lV=se("GET_CART"),cV=se("GET_CHECKOUT_CART"),dV=se("UPDATE_CHECKOUT_CART"),mue=(e={})=>{const{sendAnalytics:t=!1,withUpdatedItemsResponse:n,updatedItems:o,fetchAllocatedPaymentChecks:r,cartType:a,productGroupingType:i,location:l}=e;return{type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:Qe.stringifyUrl({url:Eue(a),query:yue({fetchAllocatedPaymentChecks:r,location:l,productGroupingType:i})}),...lV},...t&&{sendAnalytics:t},withUpdatedItemsResponse:n,updatedItems:o}},hue=({fetchAllocatedPaymentChecks:e,appliedPaymentCheckId:t}={fetchAllocatedPaymentChecks:!1,appliedPaymentCheckId:void 0})=>{const n="/v1/carts/active/checkout-summary",o={...e&&{fetchAllocatedPaymentChecks:e},...t&&{paymentCheckId:t}};return{type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:Qe.stringifyUrl({url:n,query:o}),...cV}}},gue=({paymentMethodGroup:e,fetchAllocatedPaymentChecks:t=!1,appliedPaymentCheckId:n=void 0})=>{const o="/v1/carts/active/checkout-summary",r={...t&&{fetchAllocatedPaymentChecks:t},...n&&{paymentCheckId:n}};return{type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:Qe.stringifyUrl({url:o,query:r}),options:{method:"PUT",body:{paymentMethodGroup:e}},...dV}}},mn={getCart:mue,getCheckoutCart:hue,updateCheckoutCart:gue,types:{GET_CART:lV,GET_CHECKOUT_CART:cV,UPDATE_CHECKOUT_CART:dV}},Eue=e=>{switch(e){case ma.CART_VIEW:return"/v1/carts/active/cart-view";case ma.CHECKOUT_WALK:return"/v1/carts/active/checkout-walk";case ma.CHECKOUT_SUMMARY:return"/v1/carts/active/checkout-summary";case ma.CART:default:return"/v1/carts/active"}},fue=(e={})=>{const{location:t,productGroupingType:n}=e,o=t?.pathname??"/";return n===kx.NULL?null:n||(o.endsWith(jt())||rV.test(o)?kx.CATEGORIES:null)},yue=(e={})=>{const{fetchAllocatedPaymentChecks:t,location:n}=e,o=fue({location:n,productGroupingType:e?.productGroupingType});return{...o&&{productGroupingType:o},...t&&{fetchAllocatedPaymentChecks:t}}},jx=e=>t=>e?.find(n=>n?.productId===t?.productId)??t,Xg=({basket:e,updatedItems:t})=>({...e,items:e?.items?.map(jx(t))||[],checkoutGroups:e?.checkoutGroups?.map(n=>({...n,items:n?.items?.map(jx(t))}))||[]}),Iue=e=>async(t,n)=>{const o=n(),r=Xe(o),a=e?.pathname??"/";return a.endsWith(jt())?ma.CART_VIEW:r?rV.test(a)?(await t(uue.getActiveSession()))?.type===pue.ORDER_EDIT?ma.CART_VIEW:ma.CART:a?.startsWith(zg())||new URLSearchParams(e?.search)?.get("in-checkout-walk")==="true"?ma.CHECKOUT_WALK:a===vr()?ma.CHECKOUT_SUMMARY:ma.CART:ma.CART},Sue=(e,t)=>({orderId:e||t?.orderId||null}),uV=({productId:e,quantity:t,maxQuantityReached:n})=>({productId:e,quantity:{quantityInBasket:t,maxQuantityReached:n}}),gF=(e,t)=>{const n=t?.reduce((a,i)=>[...a,...i?.promoIds??[]],[])??[],r=(e?.delivery?.promotions||[]).filter(({promoId:a})=>!n.includes(a));return{carrierBag:e?.carrierBag?.finalPrice??null,delivery:e?.delivery?.price??null,preparation:e?.preparation?.finalPrice??null,invoice:e?.invoice?.finalPrice??null,smallOrder:e?.smallOrder?.finalPrice??null,deliveryPromotions:r}},Cue=(e,t)=>e&&e==="ORDER_EDIT"&&t&&typeof Number(t)=="number"?t:null,vue=e=>{if(e){const{startTime:t,endTime:n,timeZoneId:o,slotId:r,...a}=e;return{nextAvailableSlot:{...a,slotId:r,start:qe(t,qe.ISO_8601).tz(o).format(),end:qe(n,qe.ISO_8601).tz(o).format(),utcStartTime:t,utcEndTime:n,timeZoneId:o}}}return{nextAvailableSlot:null}},Mx=e=>{if(!e)return null;const{startTime:t,endTime:n,addressDetails:o,...r}=e,a=e?.timeZoneId||"UTC";return{...r,...o,start:qe(t,qe.ISO_8601).tz(a).format(),end:qe(n,qe.ISO_8601).tz(a).format(),utcStartTime:t,utcEndTime:n}},EF=({checkout:e})=>{const t=e?.delivery;return{...e,...t&&Mx(t)}},Tue=e=>{const{checkoutGroups:t,...n}=e,{cartId:o,checkoutCorrelationId:r}=n,a=t?.assignedCheckoutGroups||[],i=t?.unassignedProducts||[];return{checkoutGroups:a.map(l=>bi({cartId:o,checkoutCorrelationId:r,...l})),unassignedItems:i.map(uV)}},bi=e=>{const{bufferRate:t,cartId:n,orderId:o,checkoutCorrelationId:r,checkout:a,activeCheckoutGroup:i,defaultCheckoutGroup:l,regionId:c,items:d,itemGroups:u,charges:p,orderLevelPromotions:g,totals:E,vouchers:y,loyalty:I,cartStatus:S,unavailableData:C,remainingTimeToEditInMillis:T,ageRestriction:_,variablePrice:A,appliedPaymentChecks:R,removedPaymentChecks:P,deliveryDestinationId:N,deliveryPriceModificationLevels:k,pricingNotifications:M,nextAvailableSlot:w,smallOrderChargeThresholds:j,totalsGroups:G,sellers:W,paymentMethodGroup:H}=e,K=a||i||l;return{basketId:n??null,checkoutCorrelationId:r||null,activeCheckoutGroupId:i?.orderId||null,regionId:c??null,items:d?.map(uV)??[],...u&&{itemGroups:u},orderLevelPromotions:g??[],slot:Mx(K?.delivery),defaultSlot:Mx(l?.delivery),appliedPaymentChecks:R??null,removedPaymentChecks:P??null,loyalty:I??null,basketStatus:S??null,ageRestriction:_??null,variablePrice:A??!1,unavailableData:C??[],remainingTimeToEditInMillis:Cue(S,T),bufferRate:t??null,deliveryDestinationId:N??null,deliveryPriceModificationLevels:k??null,pricingNotifications:M,vouchers:y||[],sellers:W||[],smallOrderChargeThresholds:j||[],totalsGroups:G?.map(X=>({...X,...gF(X.charges,X.vouchers),charges:void 0}))??[],...E&&{totals:E},...gF(p,y),...vue(w),...Sue(o,K),...Tue(e),...K&&{checkout:EF({checkout:K})},...l&&{defaultCheckout:EF({checkout:l})},paymentMethodGroup:H}},pV=e=>{if(e.type===mn.types.GET_CART.SUCCESS||e.type===mn.types.GET_CHECKOUT_CART.SUCCESS){const t=e?.payload?.responseData;return t?bi(t):null}return null},vC=[],_ue=(e=Qo,t)=>{switch(t.type){case mn.types.GET_CART.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case mn.types.GET_CART.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case mn.types.GET_CART.SUCCESS:{const n=t,o=n?.payload?.responseData;if(!o)return e;const r=bi(o),a=n?.updatedItems||[];return{...Qo,...Xg({basket:r,updatedItems:a}),isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),limitedPromotionIds:e.limitedPromotionIds}}case mn.types.GET_CHECKOUT_CART.PENDING:case mn.types.UPDATE_CHECKOUT_CART.PENDING:return{...e,isFetchingCheckoutBasket:!0,fetchErrorCheckoutBasket:!1,errorCheckoutBasket:null};case mn.types.GET_CHECKOUT_CART.ERROR:case mn.types.UPDATE_CHECKOUT_CART.ERROR:return{...e,isFetchingCheckoutBasket:!1,fetchErrorCheckoutBasket:!0,errorCheckoutBasket:t.payload};case mn.types.GET_CHECKOUT_CART.SUCCESS:case mn.types.UPDATE_CHECKOUT_CART.SUCCESS:{const o=t?.payload?.responseData;if(!o)return e;const r=bi(o);return{...Qo,...r,...r?.totals?.finalPrice&&{lastCheckoutBasketUpdated:de()},isFetchingCheckoutBasket:!1,fetchErrorCheckoutBasket:!1,errorCheckoutBasket:null,lastUpdated:de()}}default:return e}},Gi=({data:e})=>e.basket,TC=Y(Gi,e=>e?.slot),bue=Y(Gi,e=>e?.slot?.expiryTime),_l=Y(Gi,e=>e?.items||vC),mV=Y(_l,e=>e?.map(t=>t.productId));Y(Gi,e=>e?.limitedPromotionIds?.length?e.limitedPromotionIds:vC);const Zg=Y(Gi,e=>e?.checkout?.shippingGroupType),eu=Y(Gi,e=>e?.basketStatus==="ORDER_EDIT"),PR=Y(Gi,e=>e?.defaultCheckout?.shippingGroupType),$i=Y(Gi,e=>e?.deliveryDestinationId);Y(Gi,e=>e.isFetching);const xue=Y(Gi,e=>e.isFetchingCheckoutBasket),hV=e=>!!e?.items?.length,tu=e=>e.data.basket?.checkoutGroups?.filter(hV)||vC,Aue=(e,t)=>tu(e).find(n=>n?.checkout?.shippingGroupType===t),NR=e=>e.data.basket?.sellers||vC,Rue=Y(NR,e=>e?.map(t=>t.sellerId)),pt={clickAndCollect:{type:"C_N_C",id:"collection",method:"CUSTOMER_COLLECTION"},vanDelivery:{type:"BRANDED_VAN",id:"home",method:"HOME_DELIVERY"},jinn:{type:"JINN",id:"jinn",method:"JINN"}};m.shape({type:m.string,id:m.string,method:m.string});const su=(e,t)=>{const n=e.deliveryMethod===pt.clickAndCollect.method,o=e.slotType==="STANDARD",r="deliveryTimeInMinutes"in e,a=e.start?.slice(0,10)!==e.end?.slice(0,10);return t&&n&&o&&!r&&a},gV="BATCH_ADD_BASKET_ITEM",EV=se("EMPTY_CART"),fV="BATCH_REMOVE_BASKET_ITEM",yV=se("ADD_BASKET_ITEM"),IV=se("REMOVE_BASKET_ITEM"),SV=se("ADD_BASKET_FREE_GIFT_ITEM"),CV=se("REMOVE_BASKET_FREE_GIFT_ITEM"),Due=(e,t)=>({type:gV,productId:e,quantity:t}),Oue=(e,t)=>({type:fV,productId:e,quantity:t}),Pue=()=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/items",options:{method:"DELETE"},...EV}}),Nue=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/add-items",options:{body:e,method:"POST"},...yV},items:e}),Lue=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/add-promoted-product",options:{body:{productId:e.productId,promotionId:e.promotionId,meta:e.meta},method:"POST"},...SV}}),kue=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/remove-items",options:{body:e,method:"POST"},...IV},items:e}),jue=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/remove-promoted-product",options:{body:{productId:e.productId,promotionId:e.promotionId},method:"POST"},...CV}}),Rs={setBatchAdd:Due,emptyCart:Pue,setBatchRemove:Oue,addBasketItems:Nue,removeBasketItems:kue,addBasketFreeGiftItem:Lue,removeBasketFreeGiftItem:jue,types:{BATCH_ADD_BASKET_ITEM:gV,EMPTY_CART:EV,BATCH_REMOVE_BASKET_ITEM:fV,ADD_BASKET_ITEM:yV,REMOVE_BASKET_ITEM:IV,ADD_BASKET_FREE_GIFT_ITEM:SV,REMOVE_BASKET_FREE_GIFT_ITEM:CV}},LR=e=>e?.data?.basketSpeculation||{},Mue=({data:e})=>e.basketSpeculation?.items||[],wue=e=>e?.data?.basketSpeculation?.maximumInFlightRequests>1,Fue=e=>e.type===Rs.types.ADD_BASKET_ITEM.ERROR||e.type===Rs.types.REMOVE_BASKET_ITEM.ERROR||e.type===mn.types.GET_CART.SUCCESS&&!!e.withUpdatedItemsResponse,Bue=(e,t)=>Fue(e)&&LR(t).currentInFlightRequests===1&&wue(t),Uue=e=>({...e.data.basket,items:Mue(e)}),Gue=Y(LR,e=>e.currentInFlightRequests>=1||e.currentBouncedAddItemRequests===1||e.currentBouncedRemoveItemRequests===1),is=e=>Gue(e)?{...e.data.basket,...Uue(e)}:e.data.basket,vV=e=>tu(e).find(n=>n.checkout?.shippingGroupType===is(e).checkout?.shippingGroupType),$ue=({data:e})=>e.basket.remainingTimeToEditInMillis||null,xc=e=>is(e)?.items||[],_C=e=>is(e)?.itemGroups||[],Hi=e=>xc(e).length>0,Ra=({data:e})=>e.basket?.totals?.display?.itemPriceAfterPromos||null,kR=({data:e})=>e.basket?.totals?.display?.finalPrice||null,Jg=({data:e})=>e.basket?.checkout?.minimumCheckoutThreshold||null,jR=({data:e})=>e.basket?.checkout?.basketAboveThreshold,MR=e=>!jR(e),eE=({data:e})=>e.basket.loyalty?.earnings||null,TV=e=>e?.unitsSpent&&e?.savings?{money:{...e.savings},units:e.unitsSpent}:null,bl=e=>{const t=vV(e),n=t?t.loyalty:is(e).loyalty;return TV(n)},Hue=({data:e})=>e.basket.loyalty?.totalSavings||null,_V=e=>({data:t})=>{const o=t.basket?.totalsGroups?.find(r=>r.groupName===e)?.loyalty;return TV(o)},wR=({data:e})=>e.basket?.appliedPaymentChecks&&e.basket?.appliedPaymentChecks?.length>=1?e.basket?.appliedPaymentChecks:[],FR=e=>{const t=wR(e);return t?.length>=1&&t[0]||void 0},bV=({data:e})=>e.basket?.removedPaymentChecks&&e.basket?.removedPaymentChecks?.length>=1?e.basket.removedPaymentChecks:[],xn=({data:e})=>e.basket.slot,Vue=e=>{const{slotType:t,deliveryMethod:n}=xn(e)||{};return t==="ON_DEMAND"&&n==="CUSTOMER_COLLECTION"},Wue=Y(xn,D("md.sl"),(e,t)=>e&&su(e,t)),Yue=Y(Vue,Wue,(e,t)=>e||t),xV=e=>{const t=vV(e);return t?t.slot:is(e).slot},que=({data:e})=>e.basket.defaultSlot,Vi=Y(D("bt.spl"),xn,que,(e,t,n)=>e?n:t),AV=({data:e})=>e.basket?.unavailableData||[],BR=e=>!!AV(e).length,RV=({data:e})=>e.basket?.totals?.savingsPrice||null,DV=({data:e})=>e.basket?.basketStatus,OV=e=>e.reduce((t,n)=>{const o=n.product.productId,r=t[o]||0,a=n.product.quantity||1;return t[o]=r+a,t},{}),tE=(e=[])=>e.reduce((t,{quantity:n})=>t+n.quantityInBasket,0),Kue=({data:e})=>e.basket?.totals?.paymentSplit?.remainingPayment,zue=({data:e})=>e.basket?.pricingNotifications||[],sE=Y(xn,e=>e&&Object.keys(e).length>0||!1),Que=Y(Vi,e=>e&&Object.keys(e).length>0||!1),Xue=Y(Vi,e=>e?.expiryTime?Pd(Ni(),e.expiryTime):!1),Zue=Y([is],e=>{const t=e.totalsGroups?.length;return t===void 0?!1:t>1}),UR=Y(xV,e=>e&&Object.keys(e).length>0||!1),$p=Y(xc,e=>tE(e)),Jue=Y(RV,e=>e?.amount&&Number(parseFloat(e.amount.toString()))>0||!1),Ct=e=>Y(is,t=>t?.orderId)(e),bC=(e,t)=>Y(xc,n=>n.filter(o=>o.productId===t)[0])(e),epe=()=>Y(bC,e=>e&&e.quantity&&e.quantity.quantityInBasket||0),xC=epe(),Ar=Y(DV,e=>e==="ORDER_EDIT");Y(e=>is(e),e=>{const[t]=e?.vouchers||[];return t?.voucherId});Y(e=>is(e),e=>e?.delivery?.amount??null);const or=Y(e=>is(e),e=>e?.activeCheckoutGroupId||null);Y(e=>is(e),e=>e?.checkoutCorrelationId||null);const tpe=Y(e=>is(e),e=>e?.vouchers||[]),spe=Y(e=>is(e),e=>e?.lastUpdated),GR=Y(e=>is(e),e=>e?.paymentMethodGroup?.paymentMethodGroupId),npe=Y(e=>is(e),e=>e?.paymentMethodGroup?.financingProviderId),ope=Y(e=>is(e),e=>e?.isVoucherFetching),rpe={"^/settings/user-details$":"CUSTOMER_DETAILS","^/settings/login-details$":"LOGIN_DETAILS","^/settings/language$":"LANGUAGE","^/settings/addresses$":"ADDRESS_BOOK","^/settings/delivery-pass$":"DELIVERY_PASS_SETTINGS","^/settings/loyalty$":"LOYALTY","^/settings/wallet$":"WALLET","^/settings/marketing$":"MARKETING_PREFERENCES"},ape={"^/basket$":"SMART_BASKET"},ipe={"^/products/[^/]*/details$":"BOP","^/products/[^/]*/[^/]*$":"BOP","^/products(/?)/[^/search]*$":"BOP"},lpe={"^/products$":"SHOP_PRODUCTS","^/categories":"SHOP_PRODUCTS","^/favorites$":"FAVORITES","^/promotions":"PROMOTIONS"},fF={"^/products$":"ALL_SHOP_PRODUCTS","^/products(\\?.*)(sublocationId)(.*)":"SHOP_PRODUCTS","^/categories$":"ALL_SHOP_PRODUCTS","^/categories/.*":"SHOP_PRODUCTS","^/favorites":"FAVORITES","^/promotions$":"ALL_PROMOTIONS","^/promotions/.*":"PROMOTIONS","^/promotions?(.*)([&]?)(sublocationId)([&]?)(.*)":"PROMOTIONS"},cpe={"^/products/[^/]*/alternatives":"ALTERNATIVE_PRODUCTS"},dpe={"^/checkout/summary$":"ORDER_SUMMARY","^/checkout/complete$":"ORDER_CONFIRM","^/checkout/3ds$":"THREE_D_SECURE_FRAME","^/checkout/checkout-walk/([^/?]*)[^/]*$":"CHECKOUT_WALK"},upe={"^/cookie-policy$":"COOKIE_POLICY"},PV="HOME_DELIVERY_SLOTBOOKING",NV="COLLECT_SLOTBOOKING",LV="EDIT_ORDER_HOME_DELIVERY_SLOTBOOKING",kV="EDIT_ORDER_COLLECT_SLOTBOOKING",ppe="DEFAULT_METHOD_SLOTBOOKING",mpe="EDIT_ORDER_DEFAULT_METHOD_SLOTBOOKING",jV="^/out-of-stock$",MV={"^/delivery$":"DELIVERY_TYPE_SELECTION","^/delivery/home$":"HOME_DELIVERY_ADDRESS_SELECT","^/delivery/collection$":"COLLECT_ADDRESS_SELECT","^/delivery/home/slots$":PV,"^/delivery/collection/slots$":NV,[jV]:"SLOT_RESERVATION","^/orders/[^/]*/delivery$":"EDIT_ORDER_DELIVERY_TYPE_SELECTION","^/orders/[^/]*/delivery/home$":"EDIT_ORDER_HOME_DELIVERY_ADDRESS_SELECT","^/orders/[^/]*/delivery/collection$":"EDIT_ORDER_COLLECT_ADDRESS_SELECT","^/orders/[^/]*/delivery/home/slots$":LV,"^/orders/[^/]*/delivery/collection/slots$":kV},hpe={"^/delivery-pass/subscription$":"DELIVERY_PASS_SUBSCRIPTION","^/subscription/reauth$":"DELIVERY_PASS_SETTINGS","^/delivery-pass/benefit-group-selection$":"BENEFIT_GROUP_SELECT","^/delivery-pass/subscription[^/]*$":"DELIVERY_PASS_SUBSCRIPTION","^/delivery-pass/subscription/complete":"DELIVERY_PASS_SUBSCRIPTION_3DS_COMPLETE","^/delivery-pass/complete":"DELIVERY_PASS_3DS_COMPLETE"},gpe={"^/$":"HOMEPAGE"},Epe={"^/smart-shop":"INSTANT_SHOP"},fpe={"^/orders/[^/]*/refund-request":"REFUNDS"},ype={"^/orders/recurring-shopping/definitions/[^/]*/scheduled/[^/]*$":"UPCOMING_ORDER","^/orders$":"ORDERS"},Ipe={"^/failed-payment/[^/]*$":"FAILED_PAYMENT","^/failed-payment/[^/]*/3ds$":"FAILED_PAYMENT_3DS","^/failed-payment/[^/]*/complete$":"FAILED_PAYMENT_SUCCESS"},Spe={"^/offers/[^/]*$":"OFFERS","^/offers/[^/]*/[^/]*$":"OFFERS"},Cpe={"^/products/search$":"SEARCH","^/search$":"SEARCH"},vpe={"^/lists$":"LISTS","^/lists/[^/]*$":"LIST_DETAILS"},Tpe={"^/content/[^/]*$":"CONTENT_PAGE"},_pe={"^/addresses/add-address$":"ADD_ADDRESS","^/addresses/confirm-address":"CONFIRM_ADDRESS"},bpe={"^/regulars$":"REGULARS"},xpe={"^/shop-in-shop/[^/]*$":"SHOP_IN_SHOP"},Wi=e=>Number(e)!==0?`-${e}`:e,nh=e=>e?e.replace(/./g,"*"):"",AC=e=>/^[A-Za-z0-9]+(\.[A-Za-z0-9]+){1,}$/.test(e),Ape=/[^\p{L}\d]/gu,Rpe=new RegExp(Ape),Cn=e=>e&&e.replace(Rpe," ").trim().replace(/ +/g,"-"),Dpe=e=>e.split(/[?#]/)[0],Ope=e=>e.endsWith("/")?e.slice(0,-1):e,Ppe=e=>e?.replace(/\s+/g," ").trim(),Sh=(e,t,n="")=>{let o=n?Dpe(n):e;return t&&(o+=`?language=${t}`),o},wV="fromCollectionsPage=true",Xo={RecipeHome:"RECIPES_HOMEPAGE",RecipeSearch:"RECIPES_SEARCH_PAGE",RecipeCollections:"RECIPES_COLLECTIONS_LIST",RecipeCollectionDetails:"RECIPES_COLLECTION_DETAILS",RecipeDetails:"RECIPE_DETAILS",ShopForIngredients:"RECIPE_SHOP_FOR_INGREDIENTS",SavedRecipes:"SAVED_RECIPES_PAGE"},$R=(e,t)=>{const n=decodeURIComponent(e);return t?.length?n.concat("?",t):n},fp=e=>{const t=Array.isArray(e)?e[0]:e;return typeof t=="string"?t:void 0},Yi={service:"ecomrecipes",pathPrefix:{client:"/api/recipes",server:"/core-api"}},Npe={"^/recipes$":Xo.RecipeHome,"^/recipes/search-results$":Xo.RecipeSearch,"^/recipes/saved-recipes$":Xo.SavedRecipes,"^/recipes/[^/]+/[^/]+$":Xo.RecipeDetails,"^/recipes/[^/]+/[^/]+/ingredients$":Xo.ShopForIngredients,"^/recipes/collections$":Xo.RecipeCollections,"^/recipes/collections/[^/]+/[^/]+$":Xo.RecipeCollectionDetails},Lpe={"^/meal-plan$":"MEAL_PLAN","^/meals$":"YOUR_MEALS"},kpe={"^/product-range$":"PRODUCT_RANGE"},jpe={"^/coupons$":"COUPONS","^/coupons/[^/]*/[^/]*$":"COUPON_DETAILS"},yF={...cpe,...rpe,...ape,...ipe,...lpe,...dpe,...upe,...MV,...hpe,...gpe,...Epe,...fpe,...ype,...Ipe,...Spe,...Cpe,...vpe,...Tpe,..._pe,...bpe,...xpe,...Npe,...Lpe,...kpe,...jpe},Mpe=new Ho.Entity("address",void 0,{idAttribute:e=>e.address.addressId}),wpe=[Mpe],wx=new Ho.Entity("categories",{},{idAttribute:"categoryId",processStrategy:e=>({name:e.name,id:e.categoryId,retailerId:e.retailerCategoryId,children:e.childCategories})}),Fpe=[wx];wx.define({children:[wx]});const Mu=new Ho.Entity("product",{},{idAttribute:e=>e.productId}),Bpe=new Ho.Entity("order",{substitutedItems:[{product:Mu,substitutes:[{product:Mu}]}],missingItems:[{product:Mu}],returnedItems:[{product:Mu}],items:[{product:Mu}],itemsOnCheckout:[{product:Mu}]},{idAttribute:e=>e.orderId}),FV=new Ho.Entity("order",{},{idAttribute:e=>e.orderId}),Upe=[FV],HR=new Ho.Entity("product",void 0,{idAttribute:"productId"}),Gpe=new Ho.Object({productGroups:[{products:[new Ho.Entity("product",void 0,{processStrategy:e=>e.product,idAttribute:"productId"})]}]}),$pe=[HR],BV=new Ho.Object({promotionGroups:[{products:[HR]}]}),Hpe=new Ho.Object({productGroups:[{products:[new Ho.Entity("product",void 0,{idAttribute:"productId"})]}]}),Vpe=new Ho.Object({pages:[Hpe]}),Wpe=new Ho.Entity("products",void 0,{idAttribute:"productId"}),Ype=new Ho.Entity("productList",{products:[Wpe]},{idAttribute:"listId"}),UV=new Ho.Entity("productList",void 0,{idAttribute:"listId"}),qpe=new Ho.Array(UV),xl=Object.freeze(Object.defineProperty({__proto__:null,addressesSchema:wpe,categoriesSchema:Fpe,checkoutWalkSchema:Vpe,decoratedOrderSchema:Bpe,decoratedProductListSchema:Ype,offerPageSchema:BV,orderSchema:FV,ordersSchema:Upe,productArraySchema:$pe,productGroupsSchema:Gpe,productListSchema:UV,productListsSchema:qpe,productSchema:HR},Symbol.toStringTag,{value:"Module"})),Al=Object.freeze(Object.defineProperty({__proto__:null,denormalize:Zle,normalize:dH},Symbol.toStringTag,{value:"Module"})),GV=se("GET_PENDING_ORDERS"),$V=()=>({type:"API",payload:{url:"/v6/orders/pending",service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},...GV}}),HV="SET_PENDING_ORDERS",VV=e=>({type:"SET_PENDING_ORDERS",payload:e}),wy={getPendingOrders:$V,setPendingOrders:VV,actionTypes:{GET_PENDING_ORDERS:GV,SET_PENDING_ORDERS:HV}},{denormalize:Kpe}=Al,{ordersSchema:zpe}=xl,Qpe=(e=ms.orders.pending,t)=>{switch(t.type){case wy.actionTypes.GET_PENDING_ORDERS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case wy.actionTypes.GET_PENDING_ORDERS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case wy.actionTypes.GET_PENDING_ORDERS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),orders:t.payload.responseData.result};default:return e}},Ac=Y(e=>e.data.orders.pending,e=>e.data.orders.orderEntities,(e,t)=>{const n=Kpe(e.orders,zpe,{order:t});return{...e,orders:n.includes(void 0)?[]:n}}),Xpe="UNDER_EDIT",WV=Y(Ac,e=>(e.orders.find(t=>t.editStatus===Xpe)||{}).orderId||null),nu=Y(WV,e=>!!e),YV="SET_SELECTED_DELIVERY_DESTINATION_ID",Zpe=(e=null)=>({type:YV,selectedDeliveryDestinationId:e}),qV={setSelectedDeliveryDestinationId:Zpe,types:{SET_SELECTED_DELIVERY_DESTINATION_ID:YV}},KV="SET_SELECTED_ADDRESS",Jpe=e=>({type:KV,selectedAddress:{addressId:e?.addressId||null,deliveryDestinationId:e?.deliveryDestinationId||null}}),Wa={setSelectedAddress:Jpe,types:{SET_SELECTED_ADDRESS:KV}},eme=(e=null,t)=>{switch(t.type){case qV.types.SET_SELECTED_DELIVERY_DESTINATION_ID:return t.selectedDeliveryDestinationId;case Wa.types.SET_SELECTED_ADDRESS:return t.selectedAddress.deliveryDestinationId;default:return e}},Po=({control:e})=>e.delivery.selectedDeliveryDestinationId,tme=(e,t)=>e&&t,sme=(e,t,n)=>e&&t&&!n,Hp=Y(D("dds"),D("dds.t"),Xe,(e,t,n)=>tme(e,n)||sme(e,t,n)),ou=D("dds.plus"),nme=D("dds.hup"),zs=({data:e})=>e.delivery.destinations.selectedDeliveryDestination;Y(zs,e=>e.data?.deliveryType);const zV=Y(zs,e=>e.data?.deliveryMethod),qi=Y(Po,zs,(e,t)=>e??t.data?.deliveryDestinationId),Rl=({data:e})=>e.delivery.destinations.homeDelivery,ru=({data:e})=>e.delivery.destinations.customerCollection,VR=D("homedel"),QV=D("cncdel"),ome=e=>e.data.basket.deliveryDestinationId,Dl=e=>e?.deliverability==="DELIVERABLE",RC=Y(zs,e=>Dl(e.data));Y(Rl,({data:e})=>[...new Set(Object.values(e).map(({resolvedRegionId:t})=>t))]);Y(Rl,({lastUpdated:e})=>e);Y(ru,({data:e})=>[...new Set(Object.values(e).map(({resolvedRegionId:t})=>t))]);Y(ru,({lastUpdated:e})=>e);const WR=Y(Rl,({data:e})=>e?Object.values(e):[]),YR=Y(WR,e=>e.filter(t=>Dl(t))),XV=({data:e})=>e.delivery.destinations.supportedPropositions,ZV=({data:e})=>e.delivery.supportedDeliveryMethods,JV=({data:e})=>e.delivery.supportedDeliveryMethods.data,rme=Y(JV,e=>e.length),ame=(e,t)=>{const n=QV(e),o=VR(e);return n&&t===pt.clickAndCollect.method||o&&t===pt.vanDelivery.method},e2=e=>{const t=zV(e);if(t&&RC(e)&&ame(e,t))return t},Ys=e=>t2(e)||e2(e)||ime(e),ime=e=>VR(e)?pt.vanDelivery.method:pt.clickAndCollect.method,t2=Y(e=>e.router.location,e=>{const t=o=>e.pathname.indexOf(o)>-1;if(t(DR()))return pt.clickAndCollect.method;if(t(RR()))return pt.vanDelivery.method;const n=Qe.parse(e.search);return Object.values(pt).find(o=>o.type===n.type||o.method===n.deliveryMethod)?.method}),qR=Y(Ys,e=>Object.values(pt).find(t=>t.method===e)?.type),lme=Object.keys(MV).filter(e=>e!==jV),cme=(e,t)=>{const n=Ys(t),o=nu(t);if(e.match("^(/orders/[^/]*)?/delivery$"))return o?mpe:ppe;if(n==="CUSTOMER_COLLECTION")return o?kV:NV;if(n==="HOME_DELIVERY")return o?LV:PV},dme=(e,t)=>{if(lme.some(o=>e&&e.match(o)))return cme(e,t)},ume=(e,t,n)=>{if(D("aeptu")(n)){const{search:r}=e,a=r.includes("sublocationId")?t.concat(r):t,i=Object.keys(fF).find(l=>a&&a.match(l));if(i)return fF[i]}},pme=(e,t)=>{if(e.match("^/orders/[^/]*/details$"))return eu(t)?"SMART_BASKET":"ORDER"},mme=(e,t,n)=>{if(!n)return;const o=dme(t,n);if(o)return o;const r=ume(e,t,n);if(r)return r;const a=pme(t,n);if(a)return a},hme="cluster",gme="favorite",Eme="featured",fme="featured_cross_sell",s2="group",yme="personalized",n2="ungrouped",Ime="missing",Sme="substitutions",Cme="returned",vme="delivered",Tme="on_offer",o2="unknown",_me="inspiration_carousel",bme="shoppable_banner",xme="shop-for-ingredients",Ame="other",Ut={CLUSTER:hme,FAVORITE:gme,FEATURED:Eme,FEATURED_CROSS_SELL:fme,GROUP:s2,PERSONALIZED:yme,UNGROUPED:n2,MISSING:Ime,SUBSTITUTED:Sme,RETURNED:Cme,DELIVERED:vme,ON_OFFER:Tme,UNKNOWN:o2,INSPIRATION_CAROUSEL:_me,SHOPPABLE_BANNER:bme,SHOP_FOR_INGREDIENTS:xme,OTHER:Ame},DC=[s2,n2,o2],Vp=(e,t)=>{const{pathname:n}=e,o=At(t)||"",r=n?.replace(o,"")||"/",a=mme(e,r,t);if(a)return a;const i=Object.keys(yF).find(d=>r&&r.match(d));if(!i)return"UNDEFINED";const l=yF[i],c=r.match(i)[1];return c?`${l}_${Jle(c).toUpperCase()}`:l},r2=e=>{const t=Qe.parse(e.payload.location.search).source,n=e.payload.location.state&&decodeURIComponent(e.payload.location.state.source);return t||n},Rme=e=>{const t=Qe.parse(e.payload.location.search).sourceEventId,n=e.payload.location.state&&e.payload.location.state.sourceEventId;return t||n},pc=(e,t=!1)=>{const n=e.price&&e.price.current&&e.price.current.amount;return t?Number(n):n},KR=e=>{const{ratingSummary:t}=e;return t?Number(t.overallRating):null},zR=e=>e?.offers?.map(t=>t?.retailerPromotionId).join(",").slice(0,100)||null,Dme={[Ut.FAVORITE]:"favorites",[Ut.FEATURED]:"featured",[Ut.FEATURED_CROSS_SELL]:"cross-sell",[Ut.PERSONALIZED]:"top-results",[Ut.ON_OFFER]:"on-offer",[Ut.MISSING]:"missing",[Ut.SUBSTITUTED]:"substitutes",[Ut.RETURNED]:"returns",[Ut.DELIVERED]:"delivered",[Ut.INSPIRATION_CAROUSEL]:"inspiration_carousel",[Ut.CLUSTER]:"other",[Ut.GROUP]:"other",[Ut.UNGROUPED]:"other",[Ut.UNKNOWN]:"other"},Ome="other",Pme=e=>e?Dme[e]??e:Ome,ks=(e,t,n)=>{if(e){const o=Pme(n);return`${e}${t?`-${t}`:""}: ${o}`}return null},Nme={},Lme=(e=Nme)=>e,kme=({data:e})=>e?.retailer?.retailerConfig||{},Wp=({data:e})=>e.retailer?.retailerConfig?.languages||[];class jme{queue=[];timer=null;options;constructor(t){this.options=t}async enqueue(t){this.queue.push(t),this.queue.length>=this.options.maxQueueLength?await this.flush():this.timer||this.startFlushTimer()}async flush(){if(this.queue.length===0)return;const t=[...this.queue];this.queue=[],this.clearFlushTimer();try{await this.options.onFlush(t)}catch(n){Ue.api.pushError(n instanceof Error?n:new Error(`EventBatcher flush error: ${JSON.stringify(n)}`),{context:{events:JSON.stringify(t)}})}}startFlushTimer(){this.timer=setTimeout(async()=>{await this.flush()},this.options.flushIntervalMs)}clearFlushTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}}const IF=e=>e?.price?.current?.amount,SF=e=>e?.price?.current?.currency,Ld=e=>["featured","shoppable_banner"].some(t=>e?.includes(t)),Mme="webp",wme="300x300",Fme="500x500",Bme="108x108",Ume="108x60",Gme=["jpg","jpeg","JPG","JPEG"],$me=["100x100","150x150","200x200","300x300","350x350","410x410","500x500"],Hme=["300x300","500x500","640x640","800x800","960x960","1120x1120","1280x1280"],Vme=e=>{if(e.length===0||!e[0])throw Error("Promotions array is empty");const{description:t,type:n,promoId:o,presentationMode:r,requiredProductQuantity:a,retailerPromotionId:i}=e[0];return{id:o,description:t,type:n,retailerPromotionId:i,...a&&{requiredProductQuantity:a},...r&&{presentationMode:r}}},CF=e=>e.map(({promoId:t,...n})=>({id:t,...n})),Wme=({origPrice:e,promoPrice:t,unitPrice:n,promoUnitPrice:o,grossPrice:r,referencePrice:a})=>{const i=o?o.price:void 0;return{...t&&{original:e},...t?{current:t}:{current:e},...n&&{unit:{label:n.unit,...n.pricePerSuffix&&{pricePerSuffix:n.pricePerSuffix},...i&&{original:n.price},...i?{current:i}:{current:n.price}}},...r&&{gross:r},...a&&{reference:{...a.price,type:a.type}}}},jI=(e,t,n,o)=>({src:`${e}/${n}.${o}`,description:t}),Yme=e=>e.substring(0,e.indexOf("x")),qme=(e,t,n,o)=>e.filter(r=>t.includes(r)).map(r=>`${o}/${r}.${n} ${Yme(r)}w`).join(", "),vF=(e,t,n,o)=>n.reduce((r,a)=>{const i=qme(t,o,a,e);return r?a===Mme?`${i}, ${r}`:`${r}, ${i}`:i},""),Kme=(e,t,n,o)=>({fopSrcset:`${vF(e,t.availableResolutions,t.availableFormats,n)}`,bopSrcset:`${vF(e,t.availableResolutions,t.availableFormats,o)}`}),zme=e=>{const t=[];return e&&e.forEach(n=>t.push({icon:n.file.replace("-icon",""),label:n.label})),t},a2=(e,t,n)=>{if(t&&n){const{availableFormats:r}=n;if(r.length>0){const[a]=r;return a}}const o=e.filter(r=>Gme.includes(r));return o.length>0?o[0]:e[0]},i2=(e,t,n,o,r)=>{if(r&&r.length>0){const a=Kme(t,n,$me,Hme);return{...e,...a}}return{src:"",description:o,fopSrcset:"",bopSrcset:""}},Qme=e=>{const{format:t,imagePaths:n,isDynamicImagesEnabled:o,productName:r,imageConfig:a}=e;if(t&&n&&n.length>0&&n[0]){const i=jI(n[0],r,wme,t);return o&&a?i2(i,n[0],a,r,n):i}return o?{src:"",description:r,fopSrcset:"",bopSrcset:""}:{src:"",description:r}},Xme=e=>{const{format:t,imagePaths:n,isDynamicImagesEnabled:o,productName:r,imageConfig:a}=e;return t&&n&&n.length>0?n.map(i=>{const l=jI(i,r,Fme,t);return o&&a?i2(l,i,a,r,n):l}):[]},si=(e,t,n,o=[],r=void 0,a=void 0)=>{const{name:i,imageConfig:l,imagePaths:c,icons:d,packSizeDescription:u,iconAttributes:p,price:g,promoPrice:E,unitPrice:y,promoUnitPrice:I,promotions:S,catchweight:C,isInShoppingList:T,basketLines:_,type:A,alternatives:R,grossPrice:P,referencePrice:N,...k}=e,M=a2(t,n,l),w={format:M,imagePaths:c,isDynamicImagesEnabled:n,productName:i,imageConfig:l},j={...k,name:i,price:Wme({origPrice:g,promoPrice:E,unitPrice:y,promoUnitPrice:I,grossPrice:P,referencePrice:N}),isInProductList:T||!1,image:Qme(w),images:Xme(w),icons:{certification:[],legal:[]},featured:typeof a<"u"&&typeof r<"u"?"true":"false"};return R&&R.length>0&&(j.alternatives=R),_&&_.length>0&&(j.basketLines=_),M&&d&&d.length>0&&d.forEach(G=>{if(G.type==="CERTIFICATION"){const W=jI(G.path,G.label,Bme,M);j.icons.certification.push(W)}if(G.type==="LEGAL"){const W=jI(G.path,G.label,Ume,M);j.icons.legal.push(W)}}),o&&o.length>0?j.offers=CF(o):S&&S.length>0&&(j.offers=CF(S)),S&&S.length>0&&(j.offer=Vme(S)),p?.length>0&&(j.attributes=zme(p)),A==="CATCHWEIGHT"&&C?(j.size={value:C.typicalQuantity.value,uom:C.typicalQuantity.uom,catchWeight:!0},j.catchweight=C):u&&(j.size={value:u}),j},l2={S:"xs",M:"sm",L:"md",XL:"lg"},Zme=(e,t)=>{const{childCategories:n,name:o,categoryId:r,productCount:a,retailerCategoryId:i}=e,l=Cn(o),c=t.length===0?l:`${t}/${l}`;return{id:r,name:o,productCount:a,fullURLPath:c,...i&&{retailerCategoryId:i},children:QR(n,c)}},QR=(e=[],t="")=>e.map(n=>Zme(n,t)),Jme=({childCategories:e,name:t,categoryId:n,productCount:o,retailerCategoryId:r})=>({id:n,name:t,productCount:o,...r&&{retailerCategoryId:r},children:XR(e)}),XR=(e=[])=>e.map(Jme),c2=(e=[])=>e.reduce((t,{children:n,name:o,id:r,fullURLPath:a,retailerCategoryId:i})=>(t.push({id:r,name:o,fullURLPath:a,retailerCategoryId:i},...c2(n)),t),[]),d2=e=>c2(e),u2=(e=[])=>e.reduce((t,{childCategories:n,name:o,categoryId:r})=>(t.push({id:r,name:o},...u2(n)),t),[]),p2=e=>u2(e),ZR=(e=[])=>e.reduce((t,{name:n,categoryId:o,retailerCategoryId:r})=>{const a={name:n,id:o,retailerCategoryId:r},i=Cn(n),{length:l}=t;return l===0?[...t,{...a,fullURLPath:i}]:[...t,{...a,fullURLPath:`${t[l-1]?.fullURLPath}/${i}`}]},[]),JR=(e=[])=>e.map(({name:t,categoryId:n,retailerCategoryId:o})=>({name:t,id:n,retailerCategoryId:o})),ehe=Object.values(l2).reduce((e,t)=>({...e,[t]:0}),{}),m2=e=>{if(e)return Object.entries(e).reduce((t,[n,o])=>({...t,[l2[n]]:o}),ehe)},eD=(e,t,n)=>{if(t!=="featured_cross_sell"&&t!=="featured")return;const o=new Set(e.map(a=>a.productId));if(!n||typeof n!="object")return;const r=a=>Array.isArray(a)?a:[];return{S:r(n.S).filter(a=>o.has(a)),M:r(n.M).filter(a=>o.has(a)),L:r(n.L).filter(a=>o.has(a)),XL:r(n.XL).filter(a=>o.has(a))}},h2=(e,t)=>e.filter(n=>t.includes(n.id)),tD=e=>e.map(t=>Cn(t.name)).join("/"),sD=(e=[])=>e.map(({sortOptionId:t,messageKey:n,selected:o})=>({id:t,messageKey:n,selected:o})),the=({filterAttributeId:e,label:t,selected:n})=>({id:e,label:t,selected:n}),she=({filterId:e,label:t,attributes:n=[],type:o})=>({id:e,label:t,attributes:n.map(the),type:o}),nD=(e=[])=>e.map(she),nhe=(e,t)=>{const n={};for(const o of t){const r=[{id:o,pathSoFar:""}];for(;r.length;){const{id:a,pathSoFar:i}=r.pop(),l=e[a];if(!l)continue;const c=Cn(l.name),d=i?`${i}/${c}`:c;n[a]={...l,fullURLPath:d};for(const u of l.children)r.push({id:u,pathSoFar:d})}}return n},{normalize:ohe}=Al,{productGroupsSchema:rhe}=xl,ahe=(e,t)=>{if(!e)return{basePath:"",breadcrumbs:[],sortOptions:[],categories:[],filters:[],categoriesFlat:[],query:void 0};const{breadcrumb:n,categories:o,filters:r,sortOptions:a,query:i}=e,l=tD(n),c=t?QR(o,l):XR(o);return{basePath:l,breadcrumbs:t?ZR(n):JR(n),sortOptions:sD(a),categories:c,filters:nD(r),categoriesFlat:t?d2(c):p2(o),query:i}},ihe=({type:e,decoratedProducts:t=[],otherProductIds:n=[],name:o,clusterCategories:r=[],promotedProductsCampaignName:a,promotedProductsCampaignId:i,featuredProductsViewportConfig:l,featuredProductsPerViewportMap:c},d,u=[],p=!1)=>({type:e,products:lhe(t,n,a,i,p,d),name:o,clusterBreadcrumbs:h2(u,r),campaignName:a,campaignId:i,viewportConfig:m2(l),featuredProductsPerViewportMap:eD(t,e,c)}),lhe=(e,t,n,o,r,a)=>{const i=e.map(c=>({productId:c.productId,product:si(c,a,r,[],n,o)})),l=t.map(c=>({productId:c,product:void 0}));return[...i,...l]},che=(e,t,n=[],o=!1)=>t.map(r=>ihe(r,e,n,o)),dhe=({productGroups:e,additionalPageInfo:t,metadata:n,missedPromotions:o},r,a,i)=>{const{basePath:l,breadcrumbs:c,sortOptions:d,categories:u,filters:p,categoriesFlat:g,query:E}=ahe(t,a);return{productGroups:che(r,e,g,i),breadcrumbs:c,sortOptions:d,categories:u,filters:p,...c.length&&{retailerCategoryId:c[c.length-1]?.retailerCategoryId},...a&&{fullURLPath:l},...n&&n.nextPageToken&&{nextPageToken:n.nextPageToken},...o&&{missedPromotions:o},...E&&{query:E}}},OC=(e,t,n,o)=>{const r=dhe(e,t,n,o),a=["campaignName","campaignId"];return ohe({...r,productGroups:r.productGroups.map(i=>({...i,products:i.products.map(l=>{if(l&&l.product){const c=Object.fromEntries(Object.entries(l.product).filter(([d,u])=>!a.includes(d)));return{productId:l.productId,product:c}}return l}),additionalProductAttributes:i.products.map(l=>l&&l.product?sC(l.product,...a):{})}))},rhe)},{normalize:uhe}=Al,{productGroupsSchema:phe}=xl,mhe=({type:e,products:t=[],name:n,clusterCategories:o=[],promotedProductsCampaignName:r,promotedProductsCampaignId:a,featuredProductsViewportConfig:i,featuredProductsPerViewportMap:l},c,d=[],u=!1)=>({type:e,products:t.map(p=>({productId:p.productId,product:p.product?si(p.product,c,u,[],r,a):void 0})),name:n,clusterBreadcrumbs:h2(d,o),campaignName:r,campaignId:a,viewportConfig:m2(i),featuredProductsPerViewportMap:eD(t,e,l)}),hhe=(e,t,n=[],o=!1)=>t.map(r=>mhe(r,e,n,o)),ghe=({productGroups:e,breadcrumbs:t,sortOptions:n,categories:o,filters:r,totalProducts:a,categoryId:i,missedPromotions:l},c,d,u)=>{const p=tD(t),g=d?QR(o,p):XR(o),E=d?d2(g):p2(o),y=d?ZR(t):JR(t);return{productGroups:hhe(c,e,E,u),breadcrumbs:y,sortOptions:sD(n),categories:g,filters:nD(r),...t.length&&{retailerCategoryId:t[t.length-1]?.retailerCategoryId},totalProducts:a,...d&&{fullURLPath:p},...d&&i&&{categoryId:i},...l&&{missedPromotions:l}}},yp=(e,t,n,o)=>{const r=ghe(e,t,n,o),a=["campaignName","campaignId"];return uhe({...r,productGroups:r.productGroups.map(i=>({...i,products:i.products.map(l=>{if(l&&l.product){const c=Object.fromEntries(Object.entries(l.product).filter(([d,u])=>!a.includes(d)));return{productId:l.productId,product:c}}return l}),additionalProductAttributes:i.products.map(l=>l&&l.product?sC(l.product,...a):{})}))},phe)},Ehe=e=>{try{return decodeURIComponent(e)}catch{return Object.keys(Qe.parse(e)).join()}};function Fx(e){const{sublocationId:t,...n}=e;return Qe.stringify(n)}function Yp(e){const{q:t,sortBy:n,sublocationId:o,sort:r,category:a,source:i,...l}=e;return Object.keys(l).reduce((c,d)=>({...c,[d]:Ehe(l[d]).split(",")}),{})}function fhe(e){return Object.keys(e).reduce((t,n)=>({...t,[n]:e[n].join(",")}),{})}function nE({category:e,filters:t,sortOption:n,additional:o={}}){return Qe.stringify({...o,sublocationId:e,sortBy:n,...fhe(t)})}const yhe=se("GET_PROMOTION_CATALOGUE"),Ihe=se("GET_SEARCH_CATALOGUE"),She=se("GET_FAVORITES_CATALOGUE"),Che=se("GET_REGULARS_CATALOGUE"),g2=se("GET_CATALOGUE"),vhe=se("GET_HOMEPAGE_CATALOGUE"),The=se("GET_PROMOTION_CATALOGUE_SCROLL"),E2=se("GET_NEXT_CATALOGUE_PAGE"),_he=se("GET_NEXT_PROMOTION_CATALOGUE_PAGE"),bhe=se("GET_NEXT_SEARCH_CATALOGUE_PAGE"),xhe=se("GET_NEXT_FAVORITES_CATALOGUE_PAGE"),f2=se("GET_CROSS_SELL_PRODUCTS"),y2="SET_LAST_FETCHED_CATALOGUE_LOCATION",I2="REMOVE_PRODUCT_FROM_REGULARS_PRODUCT_GROUP",S2=se("GET_CATEGORY_ENTITY"),Ahe="FILTER_CATALOGUE",oE=({category:e,filters:t={},sortOption:n,offset:o=void 0,pageToken:r,additional:a={},isRetailerCategoryId:i,...l})=>Qe.stringify({...i?{retailerCategoryId:e}:{category:e},filters:Qe.stringify(t,{arrayFormat:"separator",arrayFormatSeparator:","}),sort:n,...o!==void 0&&{offset:o},pageToken:r,...a,...l},{skipEmptyString:!0}),Rhe=(e,t,n,o,r,a,i,l={},c)=>d=>d({type:"API",payload:{url:`${e}?${oE({category:t,filters:n,sortOption:o,offset:r,pageToken:a,isRetailerCategoryId:i,additional:l})}`,...g2,...c?f2:{}}}),Dhe=(e,t,n={},o=void 0,r,a={},i)=>l=>l({type:"API",payload:{url:`${e}?${oE({category:t,filters:n,sortOption:o,pageToken:r,additional:a,isRetailerCategoryId:i})}`,...E2}}),Ohe=e=>({type:y2,payload:e}),Phe=e=>({type:I2,payload:{productIdToDelete:e}}),Nhe=({queryString:e})=>({type:"API",payload:{url:`/v1/seo/category?${e}`,...S2}}),yt={getCataloguePage:Rhe,getNextCataloguePage:Dhe,setLastFetchedCatalogueLocation:Ohe,removeProductFromRegularsProductGroup:Phe,getCategoryEntity:Nhe,types:{GET_CATALOGUE:g2,GET_HOMEPAGE_CATALOGUE:vhe,GET_SEARCH_CATALOGUE:Ihe,GET_FAVORITES_CATALOGUE:She,GET_REGULARS_CATALOGUE:Che,GET_PROMOTION_CATALOGUE:yhe,GET_PROMOTION_CATALOGUE_SCROLL:The,GET_NEXT_CATALOGUE_PAGE:E2,GET_NEXT_SEARCH_CATALOGUE_PAGE:bhe,GET_NEXT_FAVORITES_CATALOGUE_PAGE:xhe,GET_NEXT_PROMOTION_CATALOGUE_PAGE:_he,GET_CROSS_SELL_PRODUCTS:f2,SET_LAST_FETCHED_CATALOGUE_LOCATION:y2,REMOVE_PRODUCT_FROM_REGULARS_PRODUCT_GROUP:I2,GET_CATEGORY_ENTITY:S2,FILTER_CATALOGUE:Ahe}},{normalize:Lhe}=Al,{productGroupsSchema:khe}=xl,jhe=(e,t)=>{const{name:n,categoryId:o,productCount:r,retailerCategoryId:a}=e,i=Cn(n),l=t.length===0?i:`${t}/${i}`;return{id:o,name:n,productCount:r,fullURLPath:l,...a&&{retailerCategoryId:a}}},Mhe=(e=[],t="")=>e.map(n=>jhe(n,t)),whe=({name:e,categoryId:t,productCount:n,retailerCategoryId:o})=>({id:t,name:e,productCount:n,...o&&{retailerCategoryId:o}}),Fhe=(e=[])=>e.map(whe),Bhe=({type:e,decoratedProducts:t=[],otherProductIds:n=[],name:o,clusterCategories:r=[],featuredProductsPerViewportMap:a,featuredProductCampaigns:i},l,c,d=!1)=>{const u=e.toLowerCase();return{type:u,products:Uhe(t,n,d,l),name:o,clusterBreadcrumbs:c.filter(p=>r.includes(p.id)),featuredProductsPerViewportMap:eD(t,u,a),featuredProductCampaigns:i}},Uhe=(e,t,n,o)=>{const r=e.map(i=>({productId:i.productId,product:si(i,o,n,[])})),a=t.map(i=>({productId:i,product:void 0}));return[...r,...a]},Ghe=(e,t,n,o=!1)=>t.map(r=>Bhe(r,e,n,o)),$he=({productGroups:e,additionalPageInfo:{breadcrumb:t,categories:n,filters:o,sortOptions:r},metadata:a,missedPromotions:i},l,c,d)=>{const u=tD(t),p=c?Mhe(n,u):Fhe(n),g=c?ZR(t):JR(t);return{productGroups:Ghe(l,e,p,d),breadcrumbs:g,sortOptions:sD(r),categories:p,filters:nD(o),missedPromotions:i,...t.length&&{retailerCategoryId:t[t.length-1]?.retailerCategoryId},...c&&{fullURLPath:u},...a.nextPageToken&&{nextPageToken:a.nextPageToken}}},Bx=(e,t,n,o)=>{const r=$he(e,t,n,o);return Lhe(r,khe)},{denormalize:C2}=Al,{productGroupsSchema:v2}=xl,PC={},NC=[],Vf=(e,t)=>{const n=[...e.productGroups];return t.productGroups.forEach(o=>{const r=n.findLastIndex(({name:a})=>a===o.name);if(r>-1){const a=[...n[r].products,...o.products],i=n[r].additionalProductAttributes||[],l=o.additionalProductAttributes||[];n[r]={...n[r],products:a,additionalProductAttributes:[...i,...l]}}else n.push(o)}),n},Hhe=(e,t)=>{const n=[...e.productGroups],o=n.find(({type:a})=>a==="featured_cross_sell"),r=t.productGroups.find(({type:a})=>a==="featured_cross_sell");return o&&r&&(o.products=r.products),n},Vhe=(e,t,n)=>e?.map(o=>o.type!==t?o:{...o,products:o.products.filter(r=>r!==n)}),Whe=(e,t)=>e.reduce((n,o)=>{if(!t[o.id])return n;const r=o.attributes.map(i=>i.id),a=t[o.id].filter(i=>r.indexOf(i)!==-1);return a.length?{...n,[o.id]:a}:n},{}),Yhe=(e,t)=>{if(!e)return;const n=t&&t.find(r=>r.selected);return Qe.parse(e.search).sortBy||n&&n.id||void 0},qp=e=>e?e.reduce((t,n)=>[...t,...n.products],[]).filter(t=>t!==void 0):[],Ei=(e,t)=>{const n=e?e.totalProducts:0,o=qp(t.productGroups);return n?n+o.length:o.length},oh=(e,t)=>{const{imageFormats:n,isSEOReadableURLEnabled:o,isDynamicImagesEnabled:r}=t;return OC(e,n,o,r)},qhe={...je,data:{}},Khe=(e=qhe,t)=>{switch(t.type){case Pn:{const{location:n}=t.payload,o=Qe.parse(n&&n.search);return{...e,filtersFromQueryString:Yp(o),selectedSortOptionId:Yhe(n,e.data.sortOptions)}}case yt.types.GET_PROMOTION_CATALOGUE.PENDING:case yt.types.GET_SEARCH_CATALOGUE.PENDING:case yt.types.GET_HOMEPAGE_CATALOGUE.PENDING:case yt.types.GET_REGULARS_CATALOGUE.PENDING:case yt.types.GET_CATALOGUE.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case yt.types.GET_PROMOTION_CATALOGUE.ERROR:case yt.types.GET_SEARCH_CATALOGUE.ERROR:case yt.types.GET_HOMEPAGE_CATALOGUE.ERROR:case yt.types.GET_REGULARS_CATALOGUE.ERROR:case yt.types.GET_CATALOGUE.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case yt.types.GET_PROMOTION_CATALOGUE.SUCCESS:{let{responseData:n}=t.payload;const{imageFormats:o,isSEOReadableURLEnabled:r,isDynamicImagesEnabled:a}=t.transformerConfig;n=Bx(n,o,r,a);const{sortOptions:i}=n.result,l=i&&i.find(c=>c.selected);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),selectedSortOptionId:l&&l.id,data:{...n.result,totalProducts:Ei(null,n.result)}}}case yt.types.GET_SEARCH_CATALOGUE.SUCCESS:{let{responseData:n}=t.payload;n=oh(n,t.transformerConfig);const{sortOptions:o}=n.result,r=o&&o.find(a=>a.selected);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),selectedSortOptionId:r&&r.id,data:{...n.result,totalProducts:Ei(null,n.result)}}}case yt.types.GET_FAVORITES_CATALOGUE.SUCCESS:{let{responseData:n}=t.payload;n=oh(n,t.transformerConfig);const{sortOptions:o,retailerCategoryId:r}=n.result,a=o&&o.find(i=>i.selected);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),selectedSortOptionId:a&&a.id,data:{...n.result,totalProducts:Ei(null,n.result),retailerCategoryId:r}}}case yt.types.GET_NEXT_FAVORITES_CATALOGUE_PAGE.SUCCESS:{let{responseData:n}=t.payload;return n=oh(n,t.transformerConfig),{...e,isNextPageFetching:!1,fetchNextPageError:!1,lastUpdated:de(),data:{...e.data,productGroups:Vf(e.data,n.result),nextPageToken:n.result.nextPageToken,totalProducts:Ei(e.data,n.result),retailerCategoryId:t.retailerCategoryId}}}case yt.types.GET_REGULARS_CATALOGUE.SUCCESS:{let{responseData:n}=t.payload;const{imageFormats:o,isSEOReadableURLEnabled:r,isDynamicImagesEnabled:a}=t.transformerConfig;n=yp(n,o,r,a);const{sortOptions:i}=n.result,l=i&&i.find(c=>c.selected);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),selectedSortOptionId:l&&l.id,data:{...n.result,totalProducts:Ei(null,n.result)}}}case yt.types.GET_CATALOGUE.SUCCESS:{const{sortOptions:n}=t.payload.responseData.result,o=n&&n.find(r=>r.selected);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),selectedSortOptionId:o&&o.id,data:{...t.payload.responseData.result,totalProducts:Ei(null,t.payload.responseData.result)}}}case yt.types.GET_HOMEPAGE_CATALOGUE.SUCCESS:{let{responseData:n}=t.payload;const{imageFormats:o,isSEOReadableURLEnabled:r,isDynamicImagesEnabled:a}=t.transformerConfig;n=yp(n,o,r,a);const{sortOptions:i}=n.result,l=i&&i.find(c=>c.selected);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),selectedSortOptionId:l&&l.id,data:{...n.result,totalProducts:Ei(null,n.result),...t.isProductFiltersEnabled&&{catalogueCopy:{...n.result}}}}}case yt.types.FILTER_CATALOGUE:{const n=t.payload?e.data.catalogueCopy.productGroups.filter(o=>o.type===t.payload):e.data.catalogueCopy.productGroups;return{...e,isFetching:!1,fetchError:!1,data:{...e.data,productGroups:[...n.map(o=>({...o,lastUpdated:de()}))]}}}case yt.types.GET_NEXT_PROMOTION_CATALOGUE_PAGE.PENDING:case yt.types.GET_NEXT_SEARCH_CATALOGUE_PAGE.PENDING:case yt.types.GET_NEXT_CATALOGUE_PAGE.PENDING:return{...e,isNextPageFetching:!0,fetchNextPageError:!1,error:null};case yt.types.GET_NEXT_PROMOTION_CATALOGUE_PAGE.ERROR:case yt.types.GET_NEXT_SEARCH_CATALOGUE_PAGE.ERROR:case yt.types.GET_NEXT_CATALOGUE_PAGE.ERROR:return{...e,isNextPageFetching:!1,fetchNextPageError:!0,error:t.payload,data:{...e.data,nextPageToken:void 0}};case yt.types.GET_NEXT_PROMOTION_CATALOGUE_PAGE.SUCCESS:{let{responseData:n}=t.payload;const{imageFormats:o,isSEOReadableURLEnabled:r,isDynamicImagesEnabled:a}=t.transformerConfig;return n=Bx(n,o,r,a),{...e,isNextPageFetching:!1,fetchNextPageError:!1,lastUpdated:de(),data:{...e.data,productGroups:Vf(e.data,n.result),nextPageToken:n.result.nextPageToken,totalProducts:Ei(e.data,n.result)}}}case yt.types.GET_NEXT_SEARCH_CATALOGUE_PAGE.SUCCESS:{let{responseData:n}=t.payload;return n=oh(n,t.transformerConfig),{...e,isNextPageFetching:!1,fetchNextPageError:!1,lastUpdated:de(),data:{...e.data,productGroups:Vf(e.data,n.result),nextPageToken:n.result.nextPageToken,totalProducts:Ei(e.data,n.result)}}}case yt.types.GET_NEXT_CATALOGUE_PAGE.SUCCESS:return{...e,isNextPageFetching:!1,fetchNextPageError:!1,lastUpdated:de(),data:{...e.data,productGroups:Vf(e.data,t.payload.responseData.result),nextPageToken:t.payload.responseData.result.nextPageToken,totalProducts:Ei(e.data,t.payload.responseData.result)}};case yt.types.GET_CROSS_SELL_PRODUCTS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case yt.types.GET_CROSS_SELL_PRODUCTS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case yt.types.GET_CROSS_SELL_PRODUCTS.SUCCESS:{let{responseData:n}=t.payload;return t.transformerConfig&&(n=oh(n,t.transformerConfig)),{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e.data,productGroups:Hhe(e.data,n.result)}}}case yt.types.SET_LAST_FETCHED_CATALOGUE_LOCATION:return{...e,lastFetchedLocation:t.payload};case yt.types.REMOVE_PRODUCT_FROM_REGULARS_PRODUCT_GROUP:return{...e,data:{...e.data,productGroups:Vhe(e.data.productGroups,"regular",t.payload.productIdToDelete)}};case yt.types.GET_CATEGORY_ENTITY.SUCCESS:return{...e,categoryEntity:{...t.payload.responseData}};default:return e}},T2=e=>({...e,productGroups:(e.productGroups||[]).map(t=>({...t,products:t.products.map((n,o)=>n&&{...n,...t.additionalProductAttributes?.[o]}),additionalProductAttributes:void 0}))}),zhe=Y(e=>e.data.products.catalogue,e=>e.data.products.productEntities,(e,t)=>({...e,data:T2(C2(e.data,v2,{product:t}))})),Qhe=Y(e=>e.result,e=>e.entities.product,(e,t)=>({data:T2(C2(e,v2,{product:t}))})),_2=e=>Y(e,t=>qp(t.data.productGroups)),b2=Y(({data:e})=>e.products.catalogue.data.productGroups,e=>e?.map(t=>({...t,section:t.type}))),Xhe=Y(({data:e})=>e.products.catalogue.data.catalogueCopy?.productGroups,e=>e?.map(t=>({...t,section:t.type}))),mo=({data:e})=>e.products.productEntities,Zhe=e=>Y([mo],t=>e?Object.values(t).filter(n=>e.includes(n.productId)):[]),Jhe=_2(zhe),Kp=()=>_2(Qhe),ege=({data:e})=>e.products.catalogue.isFetching,rE=({data:e})=>e.products.catalogue.isNextPageFetching||!1,zp=({data:e})=>e.products.catalogue.fetchError?e.products.catalogue.error:null,x2=({data:e})=>e.products.catalogue.lastUpdated,tge=({data:e})=>e.products.catalogue.data.categoryId||"",sge=({data:e})=>e.products.catalogue.data.retailerCategoryId||"",au=({data:e})=>e.products.catalogue.data.breadcrumbs||NC,oD=Y(au,e=>e.length),rD=({data:e})=>e.products.catalogue.data.fullURLPath||"",nge=({data:e})=>e.products.catalogue.data.categories||[],aD=({data:e})=>e.products.catalogue.data.sortOptions||NC,aE=({data:e})=>e.products.catalogue.data.filters||NC,iD=({data:e})=>e.products.catalogue.data.totalProducts||0,Qp=({data:e})=>e.products.catalogue.data.query||PC,oge=({data:e})=>e.products.catalogue.data.mlModelIds||NC,A2=({data:e})=>e.products.catalogue.data.rankingScoreByProductId||PC,lD=({data:e})=>e.products.catalogue.lastFetchedLocation||"",R2=({data:e})=>e.products.catalogue.categoryEntity,rge=({data:e})=>e.products.catalogue.data.nextPageToken||"",Xp=Y([aE,({data:e})=>e.products.catalogue.filtersFromQueryString||PC],Whe),D2=({data:e})=>e.products.catalogue.filtersFromQueryString||PC,cD=({data:e})=>e.products.catalogue.selectedSortOptionId||void 0,LC=e=>Y(({data:t})=>t.products.catalogue.data.productGroups,t=>{if(!e)return null;for(const n of t||[])if(n.featuredProductCampaigns&&n.featuredProductCampaigns[e])return n.featuredProductCampaigns[e];return null}),Qs=Y(({data:e})=>e.products.catalogue.data.productGroups,e=>{const t={};return(e||[]).forEach(n=>{n.featuredProductCampaigns&&Object.assign(t,n.featuredProductCampaigns)}),t}),Xs={hitType:"event",ecommType:"enhanced",eventCategory:"E-commerce",deliveryType:void 0,ecommerce:void 0,eventAction:void 0,eventLabel:void 0,eventValue:void 0,page:void 0,source:void 0},iu="Checkout Funnel",age="PROMO_LINK_IMPRESSION",ige="GA_BOP_PROMO_LINK_CLICKED",O2="GA_PRODUCT_DETAILS",P2="GA4_PRODUCT_DETAILS",lge="PRODUCT_IMAGE_CLICKED",cge="PRODUCT_IMAGE_ZOOMED_IN",dge="PRODUCT_IMAGE_ZOOMED_OUT",uge="PRODUCT_IMAGE_CLOSED",pge="ACCESSIBILITY_IMAGE_ZOOMED_IN",mge="ACCESSIBILITY_IMAGE_ZOOMED_OUT",hge="ACCESSIBILITY_SCREEN_NAVIGATION_CLICKED",gge="ACCESSIBILITY_IMAGE_NAVIGATION_USED",Ege="PRODUCT_ID",fge="BRAND_BUTTON_CLICKED",yge="BREADCRUMBS",ns={PROMO_LINK_IMPRESSION:age,GA_BOP_PROMO_LINK_CLICKED:ige,GA_PRODUCT_DETAILS:O2,GA4_PRODUCT_DETAILS:P2,PRODUCT_IMAGE_CLICKED:lge,PRODUCT_IMAGE_ZOOMED_IN:cge,PRODUCT_IMAGE_ZOOMED_OUT:dge,PRODUCT_IMAGE_CLOSED:uge,ACCESSIBILITY_IMAGE_ZOOMED_IN:pge,ACCESSIBILITY_IMAGE_ZOOMED_OUT:mge,ACCESSIBILITY_SCREEN_NAVIGATION_CLICKED:hge,ACCESSIBILITY_IMAGE_NAVIGATION_USED:gge,PRODUCT_ID:Ege,BRAND_BUTTON_CLICKED:fge,BREADCRUMBS:yge},Ige=e=>({type:O2,payload:{...e,category:"E-commerce"}}),Sge=e=>({type:P2,payload:e.payload}),Cge=["search","categories"],vge=["featured","featured_cross_sell"],Tge={FEATURED_PRODUCT_IMPRESSION:se("CX_FEATURED_PRODUCT_IMPRESSION"),FEATURED_PRODUCT_CLICK:se("CX_FEATURED_PRODUCT_CLICK")},MI=(e,t,n="")=>{const o=t?.featuredProductCampaign?.source==="CITRUS_AD",r=vge.includes(n),a=Cge.includes(e);return o&&r&&a},_ge=e=>e.filter(({page:t,product:n,group:o})=>MI(t,n,o.type)).map(({product:t})=>t),N2=e=>(t,n)=>({type:"API",payload:{url:n?"/v1/events":"/v4/content/events",service:n?"cxhub":"webuniversalapi",...n?{pathPrefix:{client:"/api/cxhub",server:"/core-api"}}:{},options:{method:"POST",body:{eventType:e,externalAdvertIds:t.map(o=>o.featuredProductCampaign?.externalAdvertId)}},...Tge[e]}}),L2=N2("FEATURED_PRODUCT_CLICK"),bge=N2("FEATURED_PRODUCT_IMPRESSION"),xge="BREADCRUMBS_LIST_CLICKED",Age="CLUSTER_EXPANDED",Rge="FOP_CLICKED",Dge="PRODUCT_IMPRESSION",Oge="QUEUE_PRODUCT_IMPRESSION",Pge="PROMO_LINK_CLICKED",Nge="ELLIPSIS_CLICKED",Lge="MESSAGE_ALERT_DISPLAYED",kge="SHOW_SUBSTITUTES",jge="GA_FOP_PROMO_LINK_CLICKED",Mge="GA_IMPRESSION",wge="GA_BATCH_IMPRESSION",Fge="GA4_BATCH_IMPRESSION",Bge="GA_PRODUCT_CLICK",Uge="GA4_PRODUCT_CLICK",Jt={BREADCRUMBS_LIST_CLICKED:xge,CLUSTER_EXPANDED:Age,FOP_CLICKED:Rge,PRODUCT_IMPRESSION:Dge,QUEUE_PRODUCT_IMPRESSION:Oge,PROMO_LINK_CLICKED:Pge,ELLIPSIS_CLICKED:Nge,MESSAGE_ALERT_DISPLAYED:Lge,SHOW_SUBSTITUTES:kge,GA_FOP_PROMO_LINK_CLICKED:jge,GA_IMPRESSION:Mge,GA_BATCH_IMPRESSION:wge,GA4_BATCH_IMPRESSION:Fge,GA_PRODUCT_CLICK:Bge,GA4_PRODUCT_CLICK:Uge},Ch=15,Gge=0,Wf=[],k2=e=>[...Array(Math.ceil(e.length/Ch))].map((n,o)=>e.slice(o*Ch,(o+1)*Ch)),TF=(e,t,n)=>{if(!n.length)return;const o=D("cxe.by")(t()),r=_ge(n);r.length>0&&e(bge(r,o)),e({type:Jt.PRODUCT_IMPRESSION,payload:{pageViewId:n[0].pageViewId,products:n.map(({page:l,breadcrumbValue:c,...d})=>{const u=d.cluster?.clusterName.trim()?d.cluster.clusterName.trim():null,p=d.group.type?.trim()?d.group.type.trim():null;return{...d.product,sequence:d.sequence,isPersonalised:d.group.type===Ut.PERSONALIZED||d.group.type===Ut.INSPIRATION_CAROUSEL,groupName:d.group.groupTitle,rankingScore:d.rankingScore,groupType:p,clusterName:u,...d.pageEventId&&{pageEventId:d.pageEventId},...d.orderId&&{orderId:d.orderId},...d.missedPromotion&&{missedPromotion:d.missedPromotion},...d.customAnalyticsData&&{customAnalyticsData:d.customAnalyticsData}}})}}),e({type:Jt.GA_BATCH_IMPRESSION,payload:{category:n[0].breadcrumbValue,page:n[0].page,impressions:n.map(({page:l,breadcrumbValue:c,...d})=>({product:{...d.product,cmsProductAttributes:d.group&&d.group.type===Ut.FEATURED?["featured"]:[],isPersonalised:d.group&&d.group.type===Ut.PERSONALIZED},productListName:d.productListName,position:d.position}))}}),n[0].page!=="basket"&&e({type:Jt.GA4_BATCH_IMPRESSION,payload:{page:n[0].page,currency:n[0].product.price?.current.currency||null,impressions:n.map(l=>({product:{...l.product},productListName:l.productListName,position:l.position}))}});const i=n.filter(({product:l})=>l&&!!l.offer);i.length>0&&e({type:ns.PROMO_LINK_IMPRESSION,payload:{pageViewId:n[0].pageViewId,promoLinkImpressions:i.map(({product:l,position:c})=>({promotionId:l.offer.id,promotionText:l.offer.description,promotionType:l.offer.type,promotionPresentation:l.offer.presentationMode,promotionSequence:l.offers?l.offers.reduce((d,u,p)=>u.id===l.offer.id?p:d,0):0,productId:l.productId,productSequence:c}))}})},og=({dispatch:e,getState:t})=>{const n=()=>TF(e,t,Wf.splice(0));return o=>r=>{const a=o(r);switch(r.type){case Pn:return n(),a;case Jt.QUEUE_PRODUCT_IMPRESSION:return r.payload&&(Wf.push(r.payload),og.beforeUnload(n),og.setTimeout(n)),Wf.length>=Ch&&TF(e,t,Wf.splice(0,Ch)),a;default:return a}}};let _F=0;og.setTimeout=e=>{typeof window>"u"||(window.clearTimeout(_F),_F=window.setTimeout(e,Gge))};let bF=!1;og.beforeUnload=e=>{typeof window>"u"||bF||(window.addEventListener("beforeunload",e),bF=!0)};const j2=e=>e.size?e.size.value:null,M2=(e={})=>e.price&&e.price.current&&{currencyCode:e.price.current.currency},dD=e=>e.quantity&&e.quantity.quantityInBasket||typeof e.quantity!="object"&&e.quantity||e.addedAmount||0,$ge=e=>typeof e>"u"?!1:typeof e=="object"?!0:e,w2=(e,t)=>{const n=t&&LC(e.productId)(t)||e.featuredProductCampaign,{favorite:o,offers:r,available:a,maxQuantityReached:i,isPersonalised:l}=e,c={};c.isFeatured=!!n,n&&(c.featuredCampaignName=n.campaignName,c.featuredCampaignId=n.campaignId),c.isFavorite=$ge(o),c.isPersonalised=!!l;const d=typeof r<"u"&&r.length>0;c.isOnPromotion=d;const u=[],p=[];return d&&(r.forEach(g=>{p.push(g.description),g.retailerPromotionId&&u.push(g.retailerPromotionId)}),c.promotionIds=u,c.promotionNames=p),c.canAddToBasket=a&&!i,c},Hge=(e,{productListName:t,position:n,product:o},r)=>({id:o.retailerProductId,name:o.name,list:t,brand:o.brand||null,category:e||null,variant:j2(o),position:n,price:pc(o,!0),hfssDisplayRestrictionGroup:o.hfssDisplayRestrictionGroup||null,...w2(o,r)}),Vge=(e,t,n)=>({impressions:t.map(o=>Hge(e,o,n)),...M2(t[0].product)}),tn=(e,t,n,o)=>({id:e.retailerProductId,productId:e.productId,name:e.name,brand:e.brand||null,category:t||null,variant:j2(e),price:pc(e,!0),quantity:dD(e),position:n,...w2(e,o)}),Wge=(e,t,n)=>{const{category:o,position:r,product:a,productListName:i}=t;return{[e]:{actionField:{...i?{list:i}:{}},products:a.map(l=>tn(l,o,r,n))},...M2(a[0])}},uD=(e,t)=>(n,o)=>({...Xs,eventAction:n.type,eventLabel:t,ecommerce:Wge(e,n.payload,o)}),Yge=(e,t)=>uD("detail",e.payload.product[0].retailerProductId)(e,t),F2=(e,t,n)=>({...Xs,eventAction:"view_item_list",eventLabel:t.length===1?t[0].product.retailerProductId:"Not Set",ecommerce:Vge(e,t,n)}),qge=(e,t)=>{const{category:n,productListName:o,position:r,product:a}=e.payload;return F2(n,[{product:a,position:r,productListName:o}],t)},Kge=(e,t)=>{const{category:n,impressions:o}=e.payload;return k2(o).map(a=>F2(n,a,t))},zge=e=>({...Xs,eventLabel:e.payload.productId,eventAction:"product_click",event:"productClick",ecommerce:{currencyCode:e.payload.currencyCode,click:{actionField:{list:e.payload.productListName},products:[{name:e.payload.productName,id:e.payload.productId,price:e.payload.productPrice,position:e.payload.productPosition}]}}}),Qge=e=>({event:"select_item_promotion",id:e.payload.itemId,name:e.payload.itemName,index:e.payload.index,promotion_id:e.payload.promotionId,promotion_name:e.payload.promotionName,list:e.payload.list}),U_=15,B2=e=>[...Array(Math.ceil(e.length/U_))].map((t,n)=>e.slice(n*U_,(n+1)*U_)),pD=e=>e&&e.price&&e.price.current&&{currencyCode:e.price.current.currency},mD=([e,t,n,o,r,...a])=>({...e&&{item_category:e},...t&&{item_category2:t},...n&&{item_category3:n},...o&&{item_category4:o},...r&&{item_category5:r},...a.length&&{item_category_more:a.join("/")}}),hD=(e,t)=>!!(e.available&&!e.maxQuantityReached&&!e.timeRestricted&&e.isInCurrentCatalog&&t!=="regulars"),Xge=e=>typeof e>"u"?!1:typeof e=="object"?!0:e,Zge=e=>e.size?e.size.value:null,U2=({product:e,category:t,position:n,featuredProductCampaign:o})=>{const r=typeof e.offers<"u"&&e.offers.length>0,a=[],i=[];return r&&e.offers?.forEach(l=>{i.push(l.description),l.retailerPromotionId&&a.push(l.retailerPromotionId)}),{id:e.retailerProductId,productId:e.productId,name:e.name,brand:e.brand||null,category:t||null,variant:Zge(e)?.toString()||null,price:pc(e,!0),quantity:dD(e),isFeatured:!!o,...o&&{featuredCampaignName:o.campaignName,featuredCampaignId:o.campaignId},isFavorite:Xge(e.favorite),canAddToBasket:e.available&&!e.maxQuantityReached,promotionIds:a,promotionNames:i,position:n,isOnPromotion:r}},Zp=({product:e,position:t,productListName:n,page:o,featuredProductCampaign:r})=>{const{campaignId:a=null,campaignName:i=null}=r||{},l=Ld(n);return{item_id:e.retailerProductId,item_name:e.name,index:t,item_brand:e.brand||null,hfss_display_restriction_group:e.hfssDisplayRestrictionGroup||null,item_list_name:n,item_variant:e.size?.value.toString()||null,price:pc(e,!0)||null,rating:KR(e),quantity:1,is_on_promotion:!!e.offers?.length,promotion_ids:zR(e),is_favorite:!!e.favorite,is_featured:l&&!!r,featured_campaign_id:l?a:null,featured_campaign_name:l?i:null,can_add_to_cart:hD(e,o),...e.categoryPath&&mD(e.categoryPath),seller_id:e.seller?.id||null}},Jge=e=>{const t=e.at(0)?.product.retailerProductId;return{ecommType:"enhanced",event:"event",eventCategory:"E-commerce",eventAction:"view_item_list",eventLabel:e.length===1&&t?t:"Not Set",ecommerce:{impressions:e.map(n=>({...U2({product:n.product,category:n.category,featuredProductCampaign:n.featuredProductCampaign}),position:n.position,isPersonalised:n.isPersonalised,list:n.productListName})),currencyCode:pD(e.at(0)?.product)?.currencyCode}}},eEe=e=>({event:"view_item_list",ecommerce:{currency:pD(e.at(0)?.product)?.currencyCode,items:e.map(t=>Zp({product:t.product,position:t.position,productListName:t.productListName,page:t.page,featuredProductCampaign:t.featuredProductCampaign}))}}),tEe=e=>B2(e).map(Jge),sEe=e=>B2(e).map(eEe);class nEe{impressionsHandler=new jme({maxQueueLength:10,flushIntervalMs:500,onFlush:t=>this.handleProductImpressionsBatch(t)});async flushProductImpressions(){await this.impressionsHandler.flush()}async queueProductImpressionEvent(t){await this.impressionsHandler.enqueue(t)}async sendEvent(t){(t.event==="page_view"||t.event==="pageview")&&await this.impressionsHandler.flush(),this.sendEventToGTM(t)}handleProductImpressionsBatch(t){if(!t.at(0))return;const o=sEe(t),r=tEe(t);o.forEach(a=>this.sendEventToGTM(a)),r.forEach(a=>this.sendEventToGTM(a))}sendEventToGTM(t){if(typeof window>"u")return;const n=window.dataLayer;if(!n||typeof n?.push!="function")throw new Error("GoogleTagManager error: window.dataLayer is not defined. Have you forgotten to include Google Tag Manager and dataLayer?");n.push(t)}}class oEe{async sendEvent(){}handleProductImpressionsBatch(){}async queueProductImpressionEvent(){}async flushProductImpressions(){}}class rEe{googleAnalyticsHandler=new nEe;webAnalyticsHandler=new oEe;async sendEvent(t){const n=[];this.isEnabled()&&(t.GA&&n.push(this.googleAnalyticsHandler.sendEvent(t.GA)),t.WA&&n.push(this.webAnalyticsHandler.sendEvent()),await Promise.allSettled(n))}async queueProductImpressionEvent(t){const n=[];this.isEnabled()&&(t.GA&&n.push(this.googleAnalyticsHandler.queueProductImpressionEvent(t.GA)),t.WA&&n.push(this.webAnalyticsHandler.queueProductImpressionEvent()),await Promise.allSettled(n))}async flushProductImpressions(){this.isEnabled()&&(await this.googleAnalyticsHandler.flushProductImpressions(),await this.webAnalyticsHandler.flushProductImpressions())}isEnabled(){if(typeof window>"u")return!1;const t=window?.__INITIAL_STATE__;return t?D("al")(t):!1}}const te=new rEe,G2=(e,t)=>{try{const n=ece(e,t);if(n.country)return n.format("E.164")}catch{throw new Error("Invalid phone number provided")}return null},aEe=(e,t)=>n=>{const o={...e};return e.mobilePhone&&(o.mobilePhone=G2(e.mobilePhone,t)),n(xs.updateCustomerDetails(o)).then(()=>{const r={event:"event",eventCategory:"Settings",eventAction:"UPDATE_CUSTOMER_DETAILS_SUCCESS",eventLabel:"Not Set"};te.sendEvent({GA:r,WA:null})}).catch(r=>{const a={event:"event",eventCategory:"Settings",eventAction:"UPDATE_CUSTOMER_DETAILS_ERROR",eventLabel:"Not Set"};throw te.sendEvent({GA:a,WA:null}),r?.response?.statusCode===400?new Error("Invalid details submitted"):r})},$2=se("GET_CURRENT_CUSTOMER"),H2=se("GET_REQUIRES_ADDITIONAL_DETAILS"),V2=se("UPDATE_ADDITIONAL_DETAILS"),W2=se("UPDATE_CUSTOMER_DETAILS"),Y2=se("UPDATE_CUSTOMER_LANGUAGE"),iEe=()=>({type:"API",payload:{url:"/v3/customers/current",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},...$2}}),lEe=()=>({type:"API",payload:{url:"/v5/customers/current/details/complete",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},...H2}}),cEe=e=>({type:"API",payload:{url:"/v5/customers/current/details",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{body:e,method:"PUT",responseType:"text"},...W2}}),dEe=(e,t)=>({type:"API",payload:{url:"/v5/customers/current/details/additional",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{body:{...e,mobilePhone:e.mobilePhone?G2(e.mobilePhone,t):null},method:"PUT",responseType:"text"},...V2}}),uEe=e=>({type:"API",payload:{url:"/v5/customers/current/details/default-language",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{body:{language:e},method:"PUT"},...Y2}}),xs={getCurrentCustomer:iEe,getRequiresAdditionalDetails:lEe,updateCustomerDetails:cEe,updateAdditionalDetails:dEe,updateCustomerLanguage:uEe,types:{GET_CURRENT_CUSTOMER:$2,UPDATE_CUSTOMER_DETAILS:W2,GET_REQUIRES_ADDITIONAL_DETAILS:H2,UPDATE_ADDITIONAL_DETAILS:V2,UPDATE_CUSTOMER_LANGUAGE:Y2}},pEe={...je,data:{}},mEe=D("lng"),hEe=D("ads");function gEe({details:e,attributes:t=[]}){return{...t.reduce((n,o)=>({...n,[`attr.${o.attributeKey}`]:o.attributeValue}),{}),...e??{}}}const EEe=(e=pEe,t={})=>{switch(t.type){case xs.types.GET_CURRENT_CUSTOMER.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case xs.types.GET_CURRENT_CUSTOMER.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case xs.types.GET_CURRENT_CUSTOMER.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:gEe(t.payload.responseData)};default:return e}},fEe=({data:e})=>e.customer?.details?.data?.["attr.registrationPostcode"],Ol=({data:e})=>e.customer?.details,yEe=({data:e})=>e.customer?.details?.lastUpdated,IEe=({data:e})=>e.customer?.details?.data?.email,q2=({data:e})=>e.customer?.details?.data?.defaultLanguage??"",SEe={...je,required:!1},CEe=(e=SEe,t={})=>{switch(t.type){case xs.types.GET_REQUIRES_ADDITIONAL_DETAILS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case xs.types.GET_REQUIRES_ADDITIONAL_DETAILS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case xs.types.GET_REQUIRES_ADDITIONAL_DETAILS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),required:t.payload.responseData.additionalDetailsRequired};case xs.types.UPDATE_ADDITIONAL_DETAILS.SUCCESS:return{...e,lastUpdated:de(),required:!1};default:return e}},K2=({session:e})=>e.additionalDetails||{},gD=Y(hEe,mEe,Wp,(e,t,n)=>e&&t&&n.length>1),Ws={hitType:void 0,deliveryType:void 0,ecommerce:void 0,ecommType:void 0,eventAction:void 0,eventCategory:void 0,eventLabel:void 0,eventValue:void 0,page:void 0,source:void 0},ga=(e,t)=>n=>({...Ws,hitType:"event",eventCategory:e,eventAction:n.type,eventLabel:"Not Set"}),Ux=(e,t,n)=>{const o=r2(e),r=Ra(n)?.amount,a=Ol(n),{pagePartType:i,location:{pathname:l}}=e.payload;return{...Ws,hitType:"pageview",page:l,pageViewId:Nn(n),pageType:i||Vp(window.location,n),sessionId:_c(t),loggedInStatus:Xe(n),retailerCustomerId:ei(t),customerFirstname:a.data["attr.firstName"],customerLastname:a.data["attr.surname"],customerEmail:a.data.email,transactionId:Ct(n),...o&&{source:o},...r&&{basketTotalAmount:r}}},vEe="UPDATE_MARKETING_PREFERENCES_SUCCESS",TEe="UPDATE_MARKETING_PREFERENCES_ERROR",_Ee={[xs.types.UPDATE_CUSTOMER_DETAILS.SUCCESS]:ga("Settings"),[xs.types.UPDATE_CUSTOMER_DETAILS.ERROR]:ga("Settings"),[vEe]:ga("Settings"),[TEe]:ga("Settings")},ED="Address Lookup",bEe=e=>({...Ws,hitType:"event",eventCategory:ED,eventAction:"AddressSelected",eventLabel:e.payload.addressDescription,eventValue:"1"}),xEe=e=>({...Ws,hitType:"event",eventCategory:ED,eventAction:"Undeliverable",eventLabel:e.payload.addressDescription,eventValue:"1"}),AEe=e=>({...Ws,hitType:"event",eventCategory:ED,eventAction:"Abandoned",eventLabel:e.payload.lastSearchString,eventValue:"1"}),REe=()=>({event:"add_address_success"}),DEe=()=>({event:"address_lookup_abandoned"}),OEe=()=>({event:"address_lookup_address_not_found"}),PEe=()=>({event:"address_lookup_address_selected"}),NEe=()=>({event:"address_lookup_success"}),LEe=()=>({event:"address_lookup_undeliverable"}),kEe=()=>({event:"remove_address"}),jEe=()=>({event:"update_address"}),ke={ADDRESS_LOOKUP_SELECTED:"ADDRESS_LOOKUP_SELECTED",ADD_ADDRESS_SUCCESS:"ADD_ADDRESS_SUCCESS",ADDRESS_LOOKUP_ABANDONED:"ADDRESS_LOOKUP_ABANDONED",ADDRESS_LOOKUP_ABANDONED_GA4:"ADDRESS_LOOKUP_ABANDONED_GA4",ADDRESS_LOOKUP_ADDRESS_NOT_FOUND:"ADDRESS_LOOKUP_ADDRESS_NOT_FOUND",ADDRESS_LOOKUP_ADDRESS_SELECTED:"ADDRESS_LOOKUP_ADDRESS_SELECTED",ADDRESS_LOOKUP_SUCCESS:"ADDRESS_LOOKUP_SUCCESS",ADDRESS_LOOKUP_UNDELIVERABLE:"ADDRESS_LOOKUP_UNDELIVERABLE",ADDRESS_LOOKUP_UNDELIVERABLE_GA4:"ADDRESS_LOOKUP_UNDELIVERABLE_GA4",REMOVE_ADDRESS:"REMOVE_ADDRESS",UPDATE_ADDRESS:"UPDATE_ADDRESS",ADDRESS_ERROR:"ADDRESS_ERROR",ADDRESS_POSTCODE:"ADDRESS_POSTCODE",ADD_ADDRESS_BUTTON_CLICKED:"ADD_ADDRESS_BUTTON_CLICKED",FORM_ADD_ADDRESS_BUTTON_CLICKED:"FORM_ADD_ADDRESS_BUTTON_CLICKED",EDIT_ADDRESS_BUTTON_CLICKED:"EDIT_ADDRESS_BUTTON_CLICKED",REMOVE_ADDRESS_BUTTON_CLICKED:"REMOVE_ADDRESS_BUTTON_CLICKED",SAVE_ADDRESS_BUTTON_CLICKED:"SAVE_ADDRESS_BUTTON_CLICKED",ADDRESS_IMPRESSION:"ADDRESS_IMPRESSION",TOAST_NOTIFICATION_DISPLAYED:"TOAST_NOTIFICATION_DISPLAYED",FIND_ADDRESS_BUTTON_CLICKED:"FIND_ADDRESS_BUTTON_CLICKED",FIND_ADDRESS_AGAIN_BUTTON_CLICKED:"FIND_ADDRESS_AGAIN_BUTTON_CLICKED",CANCEL_BUTTON_CLICKED:"CANCEL_BUTTON_CLICKED",USER_DETAILS_FORM_MODAL_DISPLAYED:"USER_DETAILS_FORM_MODAL_DISPLAYED",USER_DETAILS_FORM_MODAL_CLOSED:"USER_DETAILS_FORM_MODAL_CLOSED",SAVE_DETAILS_BUTTON_CLICKED:"SAVE_DETAILS_BUTTON_CLICKED",ADDRESS_DROPDOWN_OPENED:"ADDRESS_DROPDOWN_OPENED",DROPDOWN_ADDRESS_SELECTED:"DROPDOWN_ADDRESS_SELECTED",ADD_ADDRESS_MODAL_DISPLAYED:"ADD_ADDRESS_MODAL_DISPLAYED",ADD_ADDRESS_MODAL_CLOSED:"ADD_ADDRESS_MODAL_CLOSED",SELECT_ADDRESS_MODAL_DISPLAYED:"SELECT_ADDRESS_MODAL_DISPLAYED",SELECT_ADDRESS_MODAL_CLOSED:"SELECT_ADDRESS_MODAL_CLOSED",CONFIRM_ADDRESS_MODAL_DISPLAYED:"CONFIRM_ADDRESS_MODAL_DISPLAYED",CONFIRM_ADDRESS_MODAL_CLOSED:"CONFIRM_ADDRESS_MODAL_CLOSED",ZOOM_BUTTON_CLICKED:"ZOOM_BUTTON_CLICKED",LOCATE_ME_BUTTON_CLICKED:"LOCATE_ME_BUTTON_CLICKED",SAVE_ADDRESS_MODAL_DISPLAYED:"SAVE_ADDRESS_MODAL_DISPLAYED",SAVE_ADDRESS_MODAL_CLOSED:"SAVE_ADDRESS_MODAL_CLOSED",SEARCH_ADDRESS_POSTCODE_MODAL_DISPLAYED:"SEARCH_ADDRESS_POSTCODE_MODAL_DISPLAYED",SEARCH_ADDRESS_POSTCODE_MODAL_CLOSED:"SEARCH_ADDRESS_POSTCODE_MODAL_CLOSED",SEARCH_ADDRESS_POSTCODE_END_TYPING:"SEARCH_ADDRESS_POSTCODE_END_TYPING",CONTINUE_ADDRESS_ADD_BUTTON_CLICKED:"CONTINUE_ADDRESS_ADD_BUTTON_CLICKED",ENTER_ADDRESS_MANUALLY_BUTTON_CLICKED:"ENTER_ADDRESS_MANUALLY_BUTTON_CLICKED",SEARCH_ADDRESS_MODAL_CLOSED:"SEARCH_ADDRESS_MODAL_CLOSED",SEARCH_ADDRESS_CONTINUE_CLICKED:"SEARCH_ADDRESS_CONTINUE_CLICKED"},z2=se("UPDATE_CUSTOMER_ADDRESS"),MEe=({id:e,nickname:t,notes:n})=>({type:"API",payload:{url:`/v2/accounts/current/addresses/${e}`,service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{method:"PUT",body:{nickname:t,notes:n}},...z2}}),wI={types:{UPDATE_CUSTOMER_ADDRESS:z2},updateCustomerAddress:MEe},Q2=se("REMOVE_CUSTOMER_ADDRESS"),wEe=e=>({type:"API",payload:{url:`/v2/accounts/current/addresses/${e}`,service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{body:{},method:"DELETE"},...Q2},id:e}),FI={removeCustomerAddress:wEe,types:{REMOVE_CUSTOMER_ADDRESS:Q2}},FEe={[wI.types.UPDATE_CUSTOMER_ADDRESS.SUCCESS]:ga("Settings"),[wI.types.UPDATE_CUSTOMER_ADDRESS.ERROR]:ga("Settings"),[FI.types.REMOVE_CUSTOMER_ADDRESS.SUCCESS]:ga("Settings"),[FI.types.REMOVE_CUSTOMER_ADDRESS.ERROR]:ga("Settings"),[ke.ADDRESS_LOOKUP_SELECTED]:bEe,[ke.ADD_ADDRESS_SUCCESS]:REe,[ke.ADDRESS_LOOKUP_ABANDONED]:AEe,[ke.ADDRESS_LOOKUP_ABANDONED_GA4]:DEe,[ke.ADDRESS_LOOKUP_ADDRESS_NOT_FOUND]:OEe,[ke.ADDRESS_LOOKUP_ADDRESS_SELECTED]:PEe,[ke.ADDRESS_LOOKUP_SUCCESS]:NEe,[ke.ADDRESS_LOOKUP_UNDELIVERABLE]:xEe,[ke.ADDRESS_LOOKUP_UNDELIVERABLE_GA4]:LEe,[ke.REMOVE_ADDRESS]:kEe,[ke.UPDATE_ADDRESS]:jEe},kC=(e,t,n)=>({...Xs,eventAction:e,ecommerce:{[t]:{promotions:n}}}),BEe=e=>({event:"view_promotion_details",id:e.payload.retailerPromotionId,name:e.payload.name,type:e.payload.promotionType}),UEe={MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",PRODUCT_CARD:"PRODUCT_CARD",HORIZONTAL:"HORIZONTAL",DOUBLE_TILE:"DOUBLE_TILE",SHOPPABLE:"SHOPPABLE_BANNER"},fD=e=>({BOP:"product_details",FOP:"product_card",KEYWORD:"product_search",SHOP_IN_SHOP_TEMPLATED:"shop_in_shop"})[e]??e.toLowerCase(),yD=(e,t,n)=>{if(t==="CITRUS_AD"||!t)return e;const o=n?.split("/").pop()??"";return o.slice(0,o.lastIndexOf("."))},GEe=e=>({HERO:"ABOVE_GRID"})[e]??e,ID=(e,t)=>{const n=GEe(e).toLowerCase(),o=t?`_${UEe[t].toLowerCase()}`:"";return`${n}${o}`},$Ee=e=>{const{altText:t,contentSource:n,id:o,linkType:r,name:a,placement:i,sequence:l,targetUrl:c,format:d,imageUrl:u,size:p}=e;return{event:"ga4_select_promotion",ecommerce:{creative_name:yD(t,n,u),creative_slot:ID(i,d),creative_index:l??null,link_type:r?fD(r):"",promotion_id:o,promotion_name:a,content_source:n?.toLowerCase()||"",target:c||null,...p&&{size:p}}}},HEe=e=>{const{altText:t,contentSource:n,id:o,linkType:r,name:a,placement:i,sequence:l,targetUrl:c,format:d,imageUrl:u,size:p}=e;return{event:"ga4_view_promotion",ecommerce:{creative_name:yD(t,n,u),creative_slot:ID(i,d),creative_index:l??null,link_type:r?fD(r):"",promotion_id:o,promotion_name:a,content_source:n?.toLowerCase()||"",target:c||null,...p&&{size:p}}}},VEe=(e,t)=>{const{id:n,name:o,altText:r,targetUrl:a,linkType:i,advertisingBannerType:l}=e;return{event:"select_promotion",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:t,ecommerce:{promoClick:{promotions:[{promotionType:"Advertising Banner",id:n,name:o,creative:r,position:l,targetUrl:a,linkType:i}]}}}},WEe=(e,t)=>{const{id:n,name:o,altText:r,targetUrl:a,linkType:i,advertisingBannerType:l}=e;return{event:"view_promotion",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:t,ecommerce:{promoView:{promotions:[{promotionType:"Advertising Banner",id:n,name:o,creative:r,position:l,targetUrl:a,linkType:i}]}}}},YEe=e=>{const{id:t,name:n,altText:o,advertisingBannerType:r,targetUrl:a,linkType:i}=e;return{promotionType:"Advertising Banner",id:t,name:n,creative:o,position:r,targetUrl:a,linkType:i}},qEe={ADVERTISING_BANNER_CLICKED:"select_promotion",ADVERTISING_BANNER_IMPRESSION:"view_promotion",RESPONSIVE_ADVERTISING_BANNER_CLICKED:"select_promotion",RESPONSIVE_ADVERTISING_BANNER_IMPRESSION:"view_promotion"},KEe={ADVERTISING_BANNER_CLICKED:"ga4_select_promotion",ADVERTISING_BANNER_IMPRESSION:"ga4_view_promotion",RESPONSIVE_ADVERTISING_BANNER_CLICKED:"ga4_select_promotion",RESPONSIVE_ADVERTISING_BANNER_IMPRESSION:"ga4_view_promotion"},X2=(e,t)=>{const{type:n,payload:o}=e,r=YEe(o);return{...kC(n,t,[r]),event:qEe[n]}},Z2=e=>{const{type:t,payload:n}=e,{altText:o,contentSource:r,id:a,linkType:i,name:l,placement:c,sequence:d,targetUrl:u,format:p,imageUrl:g,size:E}=n;return{event:KEe[t],ecommerce:{creative_name:yD(o,r,g),creative_slot:ID(c,p),creative_index:d??null,link_type:i?fD(i):null,promotion_id:a,promotion_name:l,content_source:r?.toLowerCase()||"",target:u||null,...E&&{size:E}}}},xF=e=>X2(e,"promoView"),AF=e=>X2(e,"promoClick"),RF=e=>Z2(e),DF=e=>Z2(e),zEe={ADVERTISING_BANNER_CLICKED:DF,ADVERTISING_BANNER_IMPRESSION:RF,RESPONSIVE_ADVERTISING_BANNER_CLICKED:DF,RESPONSIVE_ADVERTISING_BANNER_IMPRESSION:RF},Ya={SMART_BANNER_IMPRESSION:"SMART_BANNER_IMPRESSION",SMART_BANNER_CLICKED:"SMART_BANNER_CLICKED",SMART_BANNER_CLOSED:"SMART_BANNER_CLOSED"},J2=()=>({...Xs,ecommerce:{creative_name:null,creative_slot:"mobile_app_prompt",creative_index:null,promotion_name:"Go to app",promotion_id:"go_to_app",target:null,link_type:"app",size:null,content_source:"config"}}),QEe=()=>({...J2(),event:"ga4_view_promotion"}),XEe=()=>({...J2(),event:"ga4_select_promotion"}),ZEe={[Ya.SMART_BANNER_CLICKED]:XEe,[Ya.SMART_BANNER_IMPRESSION]:QEe},JEe={ADVERTISING_BANNER_CLICKED:AF,ADVERTISING_BANNER_IMPRESSION:xF,RESPONSIVE_ADVERTISING_BANNER_CLICKED:AF,RESPONSIVE_ADVERTISING_BANNER_IMPRESSION:xF},SD=e=>{const t=e?.split("/").pop()??"";return t.slice(0,t.lastIndexOf("."))},efe=e=>{const{id:t,name:n,targetUrl:o,contentSource:r,linkType:a,imageUrl:i}=e;return{event:"ga4_select_promotion",ecommerce:{creative_slot:"popup_campaign",creative_name:SD(i),promotion_id:t,promotion_name:n,link_type:a.toLowerCase(),content_source:r.toLowerCase(),target:o}}},tfe=e=>{const{id:t,name:n,targetUrl:o,contentSource:r,linkType:a,imageUrl:i}=e;return{event:"ga4_view_promotion",ecommerce:{creative_slot:"popup_campaign",creative_name:SD(i),promotion_id:t,promotion_name:n,link_type:a.toLowerCase(),content_source:r.toLowerCase(),target:o}}},sfe=e=>{const{id:t,name:n,targetUrl:o,linkType:r}=e;return{event:"popup_banner_close",id:t,name:n,target:o,link_type:r.toLowerCase(),location:"popup_campaign"}},nfe=e=>{const{id:t,name:n,altText:o,targetUrl:r,linkType:a}=e;return{event:"select_promotion",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"POPUP_BANNER_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"PopUp Banner",id:t,name:n,creative:o,targetUrl:r,linkType:a,position:""}]}}}},ofe=e=>{const{id:t,name:n,targetUrl:o,linkType:r,altText:a}=e;return{event:"select_promotion",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"POPUP_BANNER_CLOSE",ecommerce:{promoClick:{promotions:[{promotionType:"PopUp Banner",id:t,name:n,targetUrl:o,linkType:r,position:"",creative:a}]}}}},rfe=e=>{const{id:t,name:n,altText:o,targetUrl:r,linkType:a}=e;return{event:"view_promotion",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"POPUP_BANNER_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"PopUp Banner",id:t,name:n,creative:o,targetUrl:r,linkType:a,position:""}]}}}},eW={POPUP_BANNER_CLICKED:"ga4_select_promotion",POPUP_BANNER_IMPRESSION:"ga4_view_promotion",POPUP_BANNER_CLOSE:"popup_banner_close"},OF=e=>{const{type:t,payload:n}=e,{id:o,name:r,targetUrl:a,contentSource:i,linkType:l,imageUrl:c}=n;return{event:eW[t],ecommerce:{creative_slot:"popup_campaign",creative_name:SD(c),promotion_id:o,promotion_name:r,link_type:l.toLowerCase(),content_source:i.toLowerCase(),target:a}}},afe=e=>{const{type:t,payload:n}=e,{id:o,name:r,targetUrl:a,linkType:i}=n;return{event:eW[t],id:o,name:r,target:a,link_type:i.toLowerCase(),location:"popup_campaign"}},ife={POPUP_BANNER_CLICKED:"select_promotion",POPUP_BANNER_IMPRESSION:"view_promotion",POPUP_BANNER_CLOSE:"popup_banner_close"},lfe=e=>{const{id:t,name:n,altText:o,targetUrl:r,linkType:a}=e;return{promotionType:"PopUp Banner",id:t,name:n,creative:o,targetUrl:r,linkType:a}},CD=(e,t)=>{const{type:n,payload:o}=e,r=lfe(o);return{...kC(n,t,[r]),event:ife[n]}},cfe=e=>CD(e,"promoView"),dfe=e=>CD(e,"promoClick"),ufe=e=>CD(e,"promoClick"),pfe={POPUP_BANNER_CLICKED:OF,POPUP_BANNER_IMPRESSION:OF,POPUP_BANNER_CLOSE:afe},mfe={POPUP_BANNER_CLICKED:dfe,POPUP_BANNER_IMPRESSION:cfe,POPUP_BANNER_CLOSE:ufe},hfe="LOGIN_REGISTER_MODAL_CLICKED",gfe="LOGIN_REGISTER_MODAL_DISPLAYED",Efe="LOGIN_CLICKED",ffe="LOGIN_FAILURE_ANALYTICS",yfe="LOGIN_SUCCESS_ANALYTICS",Ife="LOGIN_SUCCESS_ANALYTICS_GA4",Sfe="REGISTER_SUCCESS_ANALYTICS",Cfe="REGISTER_SUCCESS_ANALYTICS_GA4",vfe="LOGOUT_ANALYTICS",Tfe="REGISTER_CLICKED",on={LOGIN_REGISTER_MODAL_CLICKED:hfe,LOGIN_REGISTER_MODAL_DISPLAYED:gfe,LOGIN_CLICKED:Efe,LOGIN_FAILURE_ANALYTICS:ffe,LOGIN_SUCCESS_ANALYTICS:yfe,LOGIN_SUCCESS_ANALYTICS_GA4:Ife,REGISTER_SUCCESS_ANALYTICS:Sfe,REGISTER_SUCCESS_ANALYTICS_GA4:Cfe,LOGOUT_ANALYTICS:vfe,REGISTER_CLICKED:Tfe},_fe=e=>({...Ws,hitType:"event",eventCategory:"Login",eventAction:"LoginFailure",eventLabel:e.payload.error}),bfe=e=>({...Ws,hitType:"event",eventCategory:"Login",eventAction:"LoginSuccess",eventLabel:"LoginSuccess",retailerCustomerId:e.payload.retailerCustomerId,visitorId:e.payload.visitorId}),xfe=e=>({event:"login",customer_id:e.payload.retailerCustomerId}),Afe=e=>({...Ws,hitType:"event",eventCategory:"Registration",eventAction:"RegistrationSuccess",eventLabel:"RegistrationSuccess",retailerCustomerId:e.payload.retailerCustomerId,visitorId:e.payload.visitorId}),Rfe=e=>({event:"sign_up",customer_id:e.payload.retailerCustomerId}),Dfe=e=>({...Ws,hitType:"event",eventCategory:"Login",eventAction:"LogoutSuccess",eventLabel:"LogoutSuccess",retailerCustomerId:e.payload.retailerCustomerId}),Ofe={[on.LOGIN_FAILURE_ANALYTICS]:_fe,[on.LOGIN_SUCCESS_ANALYTICS]:bfe,[on.LOGIN_SUCCESS_ANALYTICS_GA4]:xfe,[on.REGISTER_SUCCESS_ANALYTICS]:Afe,[on.REGISTER_SUCCESS_ANALYTICS_GA4]:Rfe,[on.LOGOUT_ANALYTICS]:Dfe},Re={ADD_BASKET_ITEM:"ADD_BASKET_ITEM",CHECKOUT_ORDER_BUTTON_CLICKED:"CHECKOUT_ORDER_BUTTON_CLICKED",CHECKOUT_ORDER_BUTTON_VIEWED:"CHECKOUT_ORDER_BUTTON_VIEWED",BOOK_SLOT_BUTTON_CLICKED:"BOOK_SLOT_BUTTON_CLICKED",BOOK_SLOT_BUTTON_VIEWED:"BOOK_SLOT_BUTTON_VIEWED",CURRENT_ORDER_ANALYTICS:"CURRENT_ORDER_ANALYTICS",EMPTY_BASKET:"EMPTY_BASKET",EMPTY_TROLLEY_CARD_IMPRESSION:"EMPTY_TROLLEY_CARD_IMPRESSION",UNAVAILABLE_PRODUCTS:"UNAVAILABLE_PRODUCTS",MERGE_BASKET_CONFLICT:"MERGE_BASKET_CONFLICT",REDEEM_PAYMENT_CHECK_BUTTON_CLICKED:"REDEEM_PAYMENT_CHECK_BUTTON_CLICKED",REDIRECT_TO_SLOT_BOOKING:"REDIRECT_TO_SLOT_BOOKING",REMOVE_BASKET_ITEM:"REMOVE_BASKET_ITEM",START_SHOPPING:"START_SHOPPING",INSTANT_SHOP_TROLLEY_CARD_CLICKED:"INSTANT_SHOP_TROLLEY_CARD_CLICKED",INSTANT_SHOP_REMOVE_FROM_BASKET_MODAL:"INSTANT_SHOP_REMOVE_FROM_BASKET_MODAL",TROLLEY_VIEW_CHANGE_VIEW_TYPE_BUTTON_CLICKED:"TROLLEY_VIEW_CHANGE_VIEW_TYPE_BUTTON_CLICKED",UNAVAILABLE_ITEMS_MODAL_DISPLAYED:"UNAVAILABLE_ITEMS_MODAL_DISPLAYED",VOUCHER_ADD_SUCCESS:"VOUCHER_ADD_SUCCESS",VOUCHER_ADD_FAILURE:"VOUCHER_ADD_FAILURE",VOUCHER_REMOVED:"VOUCHER_REMOVED",SMART_CART_BUTTON_CLICKED:"SMART_CART_BUTTON_CLICKED",BUY_ALL_PRODUCTS:"BUY_ALL_PRODUCTS",EMPTY_BUTTON_CLICKED:"EMPTY_BUTTON_CLICKED",OPEN_MENU_CLICKED:"OPEN_MENU_CLICKED",MULTIPLE_DELIVERIES_MODAL:"MULTIPLE_DELIVERIES_MODAL",MINIMUM_BASKET_VALUE_NOT_REACHED_NOTIFICATION_DISPLAYED:"MINIMUM_BASKET_VALUE_NOT_REACHED_NOTIFICATION_DISPLAYED",MINIMUM_BASKET_VALUE_CHANGED_NOTIFICATION_DISPLAYED:"MINIMUM_BASKET_VALUE_CHANGED_NOTIFICATION_DISPLAYED",REMOVE_ALL_OUT_OF_STOCK_ITEMS_FROM_BASKET:"REMOVE_ALL_OUT_OF_STOCK_ITEMS_FROM_BASKET",VIEW_CART:"VIEW_CART",ADD_TO_CART_GA4:"ADD_TO_CART_GA4",SOME_ITEMS_UNABLE_TO_ADD_MODAL_DISPLAYED:"SOME_ITEMS_UNABLE_TO_ADD_MODAL_DISPLAYED",SOME_ITEMS_UNABLE_TO_ADD_IMPRESSION:"SOME_ITEMS_UNABLE_TO_ADD_IMPRESSION",ADD_PRODUCT_TO_ORDER_WITH_NO_ITEMS_REQUESTED:"ADD_PRODUCT_TO_ORDER_WITH_NO_ITEMS_REQUESTED",ADD_PRODUCT_TO_ORDER_MODAL_DISPLAYED:"ADD_PRODUCT_TO_ORDER_MODAL_DISPLAYED",NOT_NOW_BUTTON_CLICKED:"NOT_NOW_BUTTON_CLICKED",CLOSE_BUTTON_CLICKED:"CLOSE_BUTTON_CLICKED",MERGE_CART:"MERGE_CART",EMPTY_CART:"EMPTY_CART",SMALL_ORDER_CHARGE_MODAL_DISPLAYED:"SMALL_ORDER_CHARGE_MODAL_DISPLAYED",SMALL_ORDER_CHARGE_MODAL_LEARN_MORE_BUTTON_CLICKED:"SMALL_ORDER_CHARGE_MODAL_LEARN_MORE_BUTTON_CLICKED",SMALL_ORDER_CHARGE_MODAL_CLOSE_BUTTON_CLICKED:"SMALL_ORDER_CHARGE_MODAL_CLOSE_BUTTON_CLICKED",SMALL_ORDER_CHARGE_COMPONENT_CLICKED:"SMALL_ORDER_CHARGE_COMPONENT_CLICKED",SMALL_ORDER_CHARGE_SLOT_BOOKED_LEARN_MORE_BUTTON_CLICKED:"SMALL_ORDER_CHARGE_SLOT_BOOKED_LEARN_MORE_BUTTON_CLICKED"},G_=(e,t)=>(n,o)=>{const{payload:{addedByFunction:r,basket:a,page:i}}=n,l=a?.totals?.display?.itemPriceAfterPromos?.amount,c=a?.basketId;return{...uD(e,t)(n,o),...l&&{basketTotalAmount:l},...c&&{basketId:c},addedByFunction:r,page:i}},Pfe={[Re.ADD_BASKET_ITEM]:G_("add","Add to Cart"),[Re.REMOVE_BASKET_ITEM]:G_("remove","Remove from Cart"),[Re.BUY_ALL_PRODUCTS]:G_("add","Add to Cart"),[Re.EMPTY_BASKET]:ga("Basket"),[Re.MERGE_BASKET_CONFLICT]:uD("merge","Basket merge conflict"),[Re.START_SHOPPING]:ga("Basket")},Vn=(e,t)=>{if(e)return t&&t[e.productId]||e.featuredProductCampaign},Nfe=(e,t)=>{const{page:n,product:o,position:r,productListName:a}=e.payload,i=o.price?.current.currency||null,l=Qs(t),c=Vn(o,l);return{event:"select_item",ecommerce:{currency:i,items:[Zp({product:o,position:r,productListName:a,page:n,featuredProductCampaign:c})]}}},Lfe=(e,t,n)=>e.map(o=>{const{product:r,productListName:a,position:i}=o,l=Vn(r,n),{campaignId:c=null,campaignName:d=null}=l||{},u=Ld(a);return{item_id:r.retailerProductId,item_name:r?.name||null,index:i,item_brand:r?.brand||null,hfss_display_restriction_group:r?.hfssDisplayRestrictionGroup||null,item_list_name:a,item_variant:r?.size?.value||null,price:pc(r,!0)??null,rating:KR(r),quantity:1,is_on_promotion:!!r?.offers?.length,promotion_ids:zR(r),is_favorite:!!r?.favorite,is_featured:u&&!!l,featured_campaign_id:u?c:null,featured_campaign_name:u?d:null,can_add_to_cart:hD(r,t),...r.categoryPath&&mD(r.categoryPath),seller_id:r.seller?.id||null}}),kfe=(e,t)=>{const{impressions:n,page:o,currency:r}=e.payload,a=Qs(t);return k2(n).map(l=>({event:"view_item_list",ecommerce:{currency:r,items:Lfe(l,o,a)}}))},jfe=(e,t)=>{const{product:n,productListName:o,position:r}=e.payload,a=n.price?.current.currency||null,i=LC(n.productId)(t)||n.featuredProductCampaign,{campaignId:l=null,campaignName:c=null}=i||{},d=Ld(o);return{event:"view_item",ecommerce:{currency:a,items:[{item_id:n.retailerProductId,item_name:n?.name||null,index:typeof r=="number"?r:null,item_brand:n?.brand||null,hfss_display_restriction_group:n?.hfssDisplayRestrictionGroup||null,item_list_name:o||null,item_variant:n?.size?.value||null,price:pc(n,!0)??null,rating:KR(n),quantity:1,is_on_promotion:!!n?.offers?.length,promotion_ids:zR(n),is_favorite:!!n?.favorite,is_featured:d&&!!i,featured_campaign_id:d?l:null,featured_campaign_name:d?c:null,can_add_to_cart:hD(n,"BOP"),image_count:n.images.length,...n.categoryPath&&mD(n.categoryPath),seller_id:n.seller?.id||null}]}}},Mfe=e=>({event:"select_item_promotion",id:e.payload.itemId,name:e.payload.itemName,index:e.payload.index,promotion_id:e.payload.promotionId,promotion_name:e.payload.promotionName,list:e.payload.list}),wfe={[ns.GA_BOP_PROMO_LINK_CLICKED]:Mfe,[ns.GA_PRODUCT_DETAILS]:Yge,[ns.GA4_PRODUCT_DETAILS]:jfe},Ffe=e=>({...Ws,hitType:"event",eventCategory:"Catalogue",eventAction:"NoResults",eventLabel:e.payload.term}),Bfe=e=>({...Ws,hitType:"event",eventCategory:"Catalogue",eventAction:"NoResultsBrowseClicked",eventLabel:e.payload.term}),Ufe=e=>({...Ws,hitType:"event",eventCategory:"Catalogue",eventAction:"NoFilteredResults",eventLabel:e.payload.term}),Gfe=e=>({...Ws,hitType:"event",eventCategory:"Catalogue",eventAction:"NoFilteredResultsClearFiltersClicked",eventLabel:e.payload.term}),$fe=e=>({...Ws,hitType:"event",eventCategory:"Catalogue",eventAction:"ShowCategory",eventLabel:e.payload.retailerId,categoryName:e.payload.categoryName}),Hfe=(e,t)=>{const n=e.payload.product.at(0),o=t.data.products.productEntities[n?.productId];if(!(!o||!("favorite"in n)))return n.favorite===void 0?{...Ws,hitType:"event",eventCategory:"FAVORITES",eventAction:"ManualRemoveFromFavorites",eventLabel:o.retailerProductId}:{...Ws,hitType:"event",eventCategory:"FAVORITES",eventAction:"ManualAddToFavorites",eventLabel:o.retailerProductId}},Vfe=e=>({event:"search_no_results",search_term:e.payload.term}),Wfe=e=>({event:"apply_filter",type:e.payload.pageType,filters:e.payload.filters}),Yfe=e=>({event:"filter_no_results",type:e.payload.pageType,filters:e.payload.filters}),qfe=e=>({event:"apply_sort",type:e.payload.pageType,sort:e.payload.sortOptionId}),Kfe="CATALOGUE_ATTRIBUTES",zfe="CATALOGUE_NO_RESULTS",Qfe="SEARCH_NO_RESULTS",Xfe="CATALOGUE_NO_RESULTS_BROWSE_CLICKED",Zfe="NO_FILTERED_RESULTS_RETURNED",Jfe="OPEN_MENU",eye="OPEN_MENU_CLICKED",tye="CLEAR_ALL_FILTERS_BUTTON_CLICKED",sye="SHOW_CATEGORY_PAGE_EVENT",nye="FAVORITES_TAB_CLICKED",oye="LISTS_TAB_CLICKED",rye="SMART_CART_TAB_CLICKED",aye="REGULARS_TAB_CLICKED",iye="NO_FILTERED_RESULTS_RETURNED_CLEAR_FILTERS_BUTTON_CLICKED",lye="CLEAR_SELECTED_FILTERS_BUTTON_CLICKED",cye="SHOW_ALL_FAVORITES_FILTER_BUTTON_CLICKED",dye="SHOW_ALL_FAVORITES_FILTER_BUTTON_IMPRESSION",uye="APPLY_FILTER_EVENT",pye="FILTER_NO_RESULT",mye="APPLY_SORT_EVENT",hye="BACK_TO_TOP_BUTTON_CLICKED",ht={CATALOGUE_ATTRIBUTES:Kfe,CATALOGUE_NO_RESULTS:zfe,SEARCH_NO_RESULTS:Qfe,CATALOGUE_NO_RESULTS_BROWSE_CLICKED:Xfe,NO_FILTERED_RESULTS_RETURNED:Zfe,OPEN_MENU:Jfe,OPEN_MENU_CLICKED:eye,CLEAR_ALL_FILTERS_BUTTON_CLICKED:tye,SHOW_CATEGORY_PAGE_EVENT:sye,FAVORITES_TAB_CLICKED:nye,LISTS_TAB_CLICKED:oye,REGULARS_TAB_CLICKED:aye,SMART_CART_TAB_CLICKED:rye,CLEAR_SELECTED_FILTERS_BUTTON_CLICKED:lye,NO_FILTERED_RESULTS_RETURNED_CLEAR_FILTERS_BUTTON_CLICKED:iye,SHOW_ALL_FAVORITES_FILTER_BUTTON_CLICKED:cye,SHOW_ALL_FAVORITES_FILTER_BUTTON_IMPRESSION:dye,APPLY_FILTER_EVENT:uye,FILTER_NO_RESULT:pye,APPLY_SORT_EVENT:mye,BACK_TO_TOP_BUTTON_CLICKED:hye},tW=se("DECORATE_PRODUCTS"),iE={SET_PRODUCTS:"SET_PRODUCTS",SET_CHECKOUT_VALIDATION_PRODUCTS:"SET_CHECKOUT_VALIDATION_PRODUCTS",CLEAR_PRODUCTS:"CLEAR_PRODUCTS",UPDATE_PRODUCTS:"UPDATE_PRODUCTS"},gye=e=>({type:iE.UPDATE_PRODUCTS,payload:e}),Eye=e=>({type:iE.SET_PRODUCTS,payload:e}),fye=e=>({type:iE.SET_CHECKOUT_VALIDATION_PRODUCTS,payload:{products:e}}),yye=()=>({type:iE.CLEAR_PRODUCTS}),Iye=e=>({type:"API",payload:{url:"/v6/products",service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},skipLoginRedirect:!0,options:{method:"PUT",body:e},...tW}}),xt={setProducts:Eye,setCheckoutValidationProducts:fye,clearProducts:yye,decorateProductsPPWSAction:Iye,updateProducts:gye,types:{...iE,DECORATE_PRODUCTS:tW}},Sye={[ht.CATALOGUE_NO_RESULTS]:Ffe,[ht.CATALOGUE_NO_RESULTS_BROWSE_CLICKED]:Bfe,[ht.NO_FILTERED_RESULTS_RETURNED]:Ufe,[ht.NO_FILTERED_RESULTS_RETURNED_CLEAR_FILTERS_BUTTON_CLICKED]:Gfe,[ht.SHOW_CATEGORY_PAGE_EVENT]:$fe,[ht.SEARCH_NO_RESULTS]:Vfe,[ht.APPLY_FILTER_EVENT]:Wfe,[ht.FILTER_NO_RESULT]:Yfe,[ht.APPLY_SORT_EVENT]:qfe,[xt.types.UPDATE_PRODUCTS]:Hfe},rn={SHOP_IN_SHOP_CATEGORY_PAGE_VIEW:"SHOP_IN_SHOP_CATEGORY_PAGE_VIEW",HORIZONTAL_HERO_BANNER_IMPRESSION:"CA_HERO_IMAGE_BANNER_IMPRESSION",SUB_CATEGORY_IMAGE_IMPRESSION:"CA_SUB_CATEGORY_IMAGE_IMPRESSION",SUB_CATEGORY_IMAGE_CLICKED:"CA_SUB_CATEGORY_IMAGE_CLICKED",VIEW_CATEGORY_PAGE_VIEW:"VIEW_CATEGORY_PAGE_VIEW",SELECT_CATEGORY_GA4_EVENT:"SELECT_CATEGORY_GA4_EVENT",CATEGORY_FILTER_OPTION_CLICKED:"CATEGORY_FILTER_OPTION_CLICKED"},lu={HORIZONTAL_HERO_BANNER_IMPRESSION:"HERO_IMAGE_BANNER_IMPRESSION",SUB_CATEGORY_IMAGE_IMPRESSION:"SUB_CATEGORY_IMAGE_IMPRESSION",SUB_CATEGORY_IMAGE_CLICKED:"SUB_CATEGORY_IMAGE_CLICKED",CATEGORY_FILTER_OPTION_CLICKED:"CATEGORY_FILTER_OPTION_CLICKED"},Cye=({payload:e})=>({...Xs,event:"view_promotion",eventCategory:"Event page",eventAction:lu.HORIZONTAL_HERO_BANNER_IMPRESSION,ecommerce:{promoView:{promotions:[{promotionType:"Category Event",id:e.id,name:e.name,creative:e.imageId,position:"Hero Image"}]}}}),vye=({payload:e})=>({...Xs,event:"view_promotion",eventCategory:"Event page",eventAction:lu.SUB_CATEGORY_IMAGE_IMPRESSION,ecommerce:{promoView:{promotions:[{promotionType:"Category Event",id:e.id,name:e.subCategoryName,creative:e.imageId,position:`Sub category image ${e.sequence}`}]}}}),Tye=({payload:e})=>({...Xs,event:"select_promotion",eventCategory:"Event page",eventAction:lu.SUB_CATEGORY_IMAGE_CLICKED,ecommerce:{promoClick:{promotions:[{promotionType:"Category Event",id:e.id,name:e.subCategoryName,creative:e.imageId,position:`Sub category image ${e.sequence}`}]}}}),_ye=({payload:e})=>({event:e.event,name:e.name,id:e.id,type:e.pageType}),bye=({payload:e})=>({id:e.id,name:e.subCategoryName,event:e.event,navigation:"subcategory",type:e.pageType,index:Number(e.sequence)}),xye=({payload:e})=>({id:e.retailerCategoryId,name:e.categoryName,event:"view_category",category1:e.category1,category2:e.category2,category3:e.category3,category4:e.category4,category5:e.category5,category_more:e.categoryMore}),Aye=({payload:e})=>({id:e.retailerCategoryId,name:e.categoryName,event:"select_category",location:e.location}),Rye={[rn.HORIZONTAL_HERO_BANNER_IMPRESSION]:Cye,[rn.SUB_CATEGORY_IMAGE_IMPRESSION]:vye,[rn.SUB_CATEGORY_IMAGE_CLICKED]:Tye,[rn.VIEW_CATEGORY_PAGE_VIEW]:xye,[rn.SELECT_CATEGORY_GA4_EVENT]:Aye},Dye={[rn.SHOP_IN_SHOP_CATEGORY_PAGE_VIEW]:_ye,[rn.SUB_CATEGORY_IMAGE_CLICKED]:bye},Oye=(e,t)=>{const n=e[t];return n?.price?.original?{...n,price:{current:n.price?.original,unit:{label:n.price.unit.label,current:n.price.unit.original??n.price.unit.current}}}:n},Pye=ms.products.productEntities,Nye=(e=Pye,t)=>{switch(t.type){case xt.types.SET_PRODUCTS:return{...e,...t.payload.product};case xt.types.UPDATE_PRODUCTS:{const n=t.payload.product.reduce((o,r)=>{const{productId:a}=r;if(a){if(e[a])return o[a]={...e[a],...r},o;t.payload.upsert&&(o[a]=r)}return o},{});return{...e,...n}}case xt.types.CLEAR_PRODUCTS:return{};default:return e}},ts=({data:e})=>e.products.productEntities,Da=(e,t)=>Y(ts,n=>n&&n[t])(e),Lye=(e,t)=>Y(ts,n=>n&&Object.values(n).find(o=>o.retailerProductId===t))(e),kye=(e,t)=>Y(ts,n=>n&&Oye(n,t))(e),jye=Y(Da,e=>e&&e.maxQuantityReached),vD=e=>t=>t.data.basket?.checkoutGroups?.find(n=>n?.checkout?.shippingGroupType===e)?.items||[],TD=e=>e.data.products.basket.isFetching,Mye=e=>e.data.products.basket.lastUpdated!==null,_D=(e,t)=>e?.length?e.map(({productId:n,quantity:o})=>({...t[n],productId:n,quantity:o})):[],ho=Y(_l,ts,_D),wye=Y(ho,e=>e.filter(({available:t})=>t===!1)),Fye=e=>Y(vD(e),ts,_D),jC=e=>e.data.basket?.unassignedItems||[],Bye=Y(jC,ts,_D),Uye=Y(ho,e=>!!e.filter(t=>t.alcohol).length),Gye=(e,t)=>{const n=ho(t).map(o=>tn(o));return{...Xs,eventCategory:iu,eventLabel:"Not Set",eventAction:"CheckoutWalk",ecommerce:{checkout:{actionField:{step:3},products:n}}}},Zn={CHECKOUT_WALK:"CHECKOUT_WALK",CHECKOUT_WALK_GA4:"CHECKOUT_WALK_GA4",CHECKOUT_WALK_FREE_GIFT:"CHECKOUT_WALK_FREE_GIFT",ADD_FREE_GIFT_CLICKED:"ADD_FREE_GIFT_CLICKED",REMOVE_FREE_GIFT_CLICKED:"REMOVE_FREE_GIFT_CLICKED",CONTINUE_SHOPPING_CLICKED:"CONTINUE_SHOPPING_CLICKED"},$ye={[Zn.CHECKOUT_WALK]:Gye},rg="newlyCreatedOrderId",Hye=D("co.last"),Vye=e=>{if(e.nonSavedFundingInstrument)return"NOT SAVED";switch(e.paymentMethodV2){case"CARDS":return"CARD";case"PAYPAL":return"PAYPAL";case"INVOICE":return"INVOICE";default:return"UNKNOWN"}},Wye=e=>{const t=Vt(e);return{slotBookingDay:t.isoWeekday(),slotBookingTime:t.format($n),slotBookingDate:t.format(Ta)}},sW=(e,t,n,o)=>({...e&&{deliveryType:e},...t&&{loyaltyDiscount:t},...o&&{paymentMethodType:Vye(o)},...n&&Wye(n)}),PF=(e,t,n,o)=>{const{orderId:r,editedOrder:a,revenue:i,tax:l,orderTotals:c,deliveryType:d,paymentInfo:u,appliedVouchers:p,charges:g,loyalty:E,deliveryStartDate:y}=e;let I,S,C,T=a?"edited-order":"new-order";const _=g.delivery.amount,A=p.map(P=>P.id).join(", "),R=c.totalPrice.currency;return n===0?(I=i,S=l,C=E&&E.spent.money.amount):(T+="-continued",I="0",S="0",C=E&&"0"),o&&(T+="-last"),{...Xs,eventLabel:T,eventAction:"OrderPurchased",ecommerce:{currencyCode:R,purchase:{actionField:{id:r,revenue:Number(I),tax:S,coupon:A,shipping:Number(_)},products:t.map(P=>tn({...P,quantity:`${P.quantity}`},void 0,void 0))}},...sW(d,C,y,u)}},Yye=(e,t)=>{const{product:n}=e.payload,o=25;if(!n.length)return[PF(e.payload,[],0,!1)];const r=Math.ceil(n.length/o),a=[];for(let i=0;i<r;i+=1)a.push(n.slice(i*o,(i+1)*o));return a.map((i,l)=>PF(e.payload,i,l,l+1===r&&Hye(t)))},qye=se("GET_DELIVERY_STATUS"),Kye=e=>({type:"API",payload:{url:`/ecomfulfillments/v1/order-tracking/delivery-status?orderId=${e}`,options:{method:"GET"},service:"ecomfulfillments",...qye}}),nW="SET_DELIVERY_STATUS",zye=e=>({type:nW,payload:e}),Qye=e=>{const{currentState:t,fulfillmentDeliveryStartedState:n,upcomingFulfillmentDeliveryState:o,fulfillmentArrivedState:r,deliveryTimeData:a}=e;switch(t){case"PLANNED_DELIVERY":return rh(t,a?.expectedDeliveryTime,a?.expectedDeliveryTimeWindow);case"WE_ARE_ON_THE_WAY":return rh(t,n?.estimatedTimeArrival,n?.estimatedTimeWindowOfArrival);case"YOU_ARE_NEXT":return rh(t,o?.estimatedTimeArrival,o?.estimatedTimeWindowOfArrival,o?.status);case"WE_ARE_HERE":return rh(t,r.arrivalTime);default:return rh(t)}},rh=(e,t,n,o)=>({deliveryInfo:{currentState:e,deliveryState:{status:o,estimatedTimeArrival:t,estimatedTimeWindowOfArrival:n}}}),Fy=se("GET_ORDERS"),Xye=()=>({type:"API",payload:{url:"/v6/orders",service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},options:{method:"GET"},...Fy}}),Zye="SET_ORDERS",lE=e=>({type:"SET_ORDERS",payload:e}),oW=se("GET_PAST_ORDERS"),rW=se("GET_PAST_ORDERS_PAGE"),Jye=()=>({type:"API",payload:{url:"/v6/orders/past",service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},options:{method:"GET"},...oW}}),eIe=e=>({type:"API",payload:{url:"/v6/orders/past",service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},options:{headers:{"next-page-token":e?e.nextPageToken:null},method:"GET"},...rW}}),tIe="SET_PAST_ORDERS",aW=e=>({type:"SET_PAST_ORDERS",payload:e}),wu={actionTypes:{GET_PAST_ORDERS:oW,GET_PAST_ORDERS_PAGE:rW}},$_=(e,t)=>(e&&e.length)>0?e:t,sIe=({oldEntity:e,entityFromAction:t})=>({...t,loyalty:t.loyalty?t.loyalty:null,paymentInfo:t.paymentInfo.paymentMethod!=="UNKNOWN"?t.paymentInfo:e.paymentInfo,items:$_(t.items,e.items),missingItems:$_(t.missingItems,e.missingItems),substitutedItems:$_(t.substitutedItems,e.substitutedItems)}),H_=(e,t)=>{const n={...e,...t};return t&&Object.keys(t).forEach(o=>{if(e[o]){const r=e[o],a=t[o];n[o]=sIe({oldEntity:r,entityFromAction:a})}}),n},nIe=(e,t)=>{if(!e||!t||!e[t.orderId])return e;const n={...e[t.orderId],...Qye(t)},o={...e};return o[t.orderId]=n,o},oIe=(e=ms.orders.orderEntities,t)=>{switch(t.type){case Zye:return{...H_(e,t.payload.order),lastUpdated:de()};case HV:return H_(e,t.payload.order);case tIe:return H_(e,t.payload.order);case nW:return nIe(e,t.payload);default:return e}},rIe=({data:e})=>e.orders.orderEntities,Ki=(e,t)=>Y(rIe,n=>n&&n[t])(e);function aIe(e,t){const{orderId:n}=e.payload,o=Ki(t,n);return{...Xs,eventLabel:o.wasEdited?"edited-confirmed-order":"new-confirmed-order",eventAction:"OrderConfirmed",ecommerce:{currencyCode:o.orderTotals?.totalPrice?.currency,purchase:{actionField:{id:o.orderId,editedOrder:o.wasEdited,coupon:o.appliedVouchers.map(r=>r.id).join(", "),shipping:Number(o.charges.delivery.amount)},products:o.products?.length?[o.products[0]]:[]}}}}const iIe=(e,t)=>{const n=ho(t).map(o=>tn(o));return{...Xs,eventCategory:iu,eventLabel:"Not Set",eventAction:"PaymentSelected",ecommerce:{checkout:{actionField:{step:5},products:n}}}},lIe=(e,t)=>{const n=ho(t).map(o=>tn(o));return{...Xs,eventCategory:iu,eventAction:"CheckoutConfirmation",eventLabel:"Not Set",ecommerce:{checkout:{actionField:{step:6,option:e.payload.isEditedOrder?"edited-order":"new-order"},products:n}}}},cIe=(e,t)=>{const n=ho(t).map(o=>tn(o));return{...Xs,eventCategory:iu,eventAction:"BeginCheckout",eventLabel:"Not Set",ecommerce:{checkout:{actionField:{step:1},products:n}}}},dIe=(e,t)=>{const n=ho(t).map(o=>tn(o));return{...Xs,eventCategory:iu,eventLabel:"Not Set",eventAction:"CheckoutSummary",ecommerce:{checkout:{actionField:{step:4},products:n}}}},Le={APPLICABLE_LOYALTY:"APPLICABLE_LOYALTY",PLACE_ORDER_CONFIRMATION:"PLACE_ORDER_CONFIRMATION",BEGIN_CHECKOUT:"BEGIN_CHECKOUT",RECURRING_SHOPPING_DEFINITION_FORM_CARD_IMPRESSION:"RECURRING_SHOPPING_DEFINITION_FORM_CARD_IMPRESSION",RECURRING_SHOPPING_DEFINITION_LABEL_WRITTEN:"RECURRING_SHOPPING_DEFINITION_LABEL_WRITTEN",RECURRING_SHOPPING_DEFINITION_FREQUENCY_SELECTED:"RECURRING_SHOPPING_DEFINITION_FREQUENCY_SELECTED",TOAST_NOTIFICATION_DISPLAYED:"TOAST_NOTIFICATION_DISPLAYED",CHECKOUT_SUMMARY_DISPLAYED:"CHECKOUT_SUMMARY_DISPLAYED",DELIVERY_CARD_IMPRESSION:"DELIVERY_CARD_IMPRESSION",CHANGE_DELIVERY_BUTTON_CLICKED:"CHANGE_DELIVERY_BUTTON_CLICKED",SELECT_PAYMENT:"SELECT_PAYMENT",PAYMENT_BUFFER_MODAL_DISPLAYED:"PAYMENT_BUFFER_MODAL_DISPLAYED",FIND_OUT_MORE_BUTTON_CLICKED:"FIND_OUT_MORE_BUTTON_CLICKED",VOUCHER_BUTTON_CLICKED:"VOUCHER_BUTTON_CLICKED",VOUCHERS_ADDED_TO_ORDER:"VOUCHERS_ADDED_TO_ORDER",AGE_CHECK_CONFIRMED:"AGE_CHECK_CONFIRMED",ORDER_PURCHASED:"ORDER_PURCHASED",SELECT_PLACE_ORDER:"SELECT_PLACE_ORDER",ORDER_CONFIRMED:"ORDER_CONFIRMED",PLACE_ORDER:"PLACE_ORDER",RECURRING_ORDER_CREATED:"RECURRING_ORDER_CREATED",PAYMENT_CHECK_BUTTON_CLICKED:"PAYMENT_CHECK_BUTTON_CLICKED",CONCIERGE_CHECK_BOX_CHECKED:"CONCIERGE_CHECK_BOX_CHECKED",CONCIERGE_CHECK_BOX_UNCHECKED:"CONCIERGE_CHECK_BOX_UNCHECKED",CONCIERGE_TERMS_AND_CONDITIONS_CLICKED:"CONCIERGE_T&C_CLICKED",PHARMACY_FORM_DISPLAYED:"PHARMACY_FORM_DISPLAYED",PHARMACY_FORM_DELETE_ITEM_CLICKED:"PHARMACY_FORM_DELETE_ITEM_CLICKED",PHARMACY_FORM_SUBMIT_CLICKED:"PHARMACY_FORM_SUBMIT_CLICKED",PHARMACY_FORM_IFRAME_LOADING_ERROR:"PHARMACY_FORM_IFRAME_LOADING_ERROR",SUBMIT_FEEDBACK_INTERACTION:"SUBMIT_FEEDBACK_INTERACTION",SUBMIT_FEEDBACK_BUTTON_CLICKED:"SUBMIT_FEEDBACK_BUTTON_CLICKED",SUBMIT_FEEDBACK_IMPRESSION:"SUBMIT_FEEDBACK_IMPRESSION",LOYALTY_POINTS_BUTTON_CLICKED:"LOYALTY_POINTS_BUTTON_CLICKED",LOYALTY_POINTS_DISPLAYED:"LOYALTY_POINTS_DISPLAYED",LOYALTY_POINTS_ADD_SUCCESS:"LOYALTY_POINTS_ADD_SUCCESS",LOYALTY_POINTS_ADD_FAILURE:"LOYALTY_POINTS_ADD_FAILURE"},iW={[Le.CHANGE_DELIVERY_BUTTON_CLICKED]:"User clicked change delivery button",[Le.SUBMIT_FEEDBACK_INTERACTION]:"Customer interacted with the next order feedback options",[Le.SUBMIT_FEEDBACK_BUTTON_CLICKED]:"Customer submitted the next order feedback"},uIe={[Le.PLACE_ORDER_CONFIRMATION]:lIe,[Le.BEGIN_CHECKOUT]:cIe,[Le.CHECKOUT_SUMMARY_DISPLAYED]:dIe,[Le.SELECT_PAYMENT]:iIe,[Le.ORDER_PURCHASED]:Yye,[Le.ORDER_CONFIRMED]:aIe},Pl=e=>{const[t,n,o,r,a,...i]=e;return{item_category:t||null,item_category2:n||null,item_category3:o||null,item_category4:r||null,item_category5:a||null,item_category_more:i.length?i.join(","):null}},lW=e=>{const{item:t,itemsAnalyticsPayload:n,getState:o}=e,r=o(),{productId:a}=t,i=n.find(({product:y})=>y.productId===a),l=Nn(r),c=Vp(window.location,r),d=i?.productListName||ks(i?.page,"",i?.section),u=LC(i?.product?.productId)(r)||i?.product?.featuredProductCampaign,p=u?.campaignId,g=u?.campaignName,E={itemListName:d||void 0,featured:p||g?{campaignId:p,campaignName:g}:void 0,favorite:!!i?.product?.favorite,pageViewId:l,pageType:c};return{...t,meta:E}},Rc=e=>{const{productId:t,item:n,meta:o}=e,r=o?.items?.find(({productId:E})=>t===E);if(!r)return n;const{meta:{itemListName:a,favorite:i,featured:{campaignName:l,campaignId:c}={}}}=r,d=a??n.item_list_name,u=Ld(d),p=c??n.featured_campaign_id,g=l??n.featured_campaign_name;return{...n,is_favorite:i??n.is_favorite,item_list_name:d,is_featured:u&&!!(l||c||n.is_featured),featured_campaign_id:u?p:null,featured_campaign_name:u?g:null}},pIe={BRANDED_VAN:"home_delivery",C_N_C:"click_and_collect"},mIe=e=>{const t=e?Vt(e):null;return{slot_day:t?.isoWeekday(),slot_start_time:t?.format($n),slot_date:t?.format(Ta),slot_end_time:""}},cW=(e,t,n)=>{const{id:o,name:r,brand:a,price:i,quantity:l,isOnPromotion:c,isFavorite:d,productId:u}=tn(e),p=Vn(e,n),g={item_id:o||null,item_name:r,index:null,item_brand:a,hfss_display_restriction_group:e?.hfssDisplayRestrictionGroup||null,item_list_name:null,item_variant:e.variant,price:i?Number(i):null,rating:null,quantity:Number(l),is_on_promotion:c,promotion_ids:e.offers?.map(E=>E.retailerPromotionId).join(",")||null,is_favorite:d,is_featured:!!p,featured_campaign_id:p?.campaignId||null,featured_campaign_name:p?.campaignName||null,...Pl(e?.categoryPath??[]),seller_id:e.sellerId||null};return Rc({productId:u,item:g,meta:t})},dW=(e,t,n,o,r,a,i)=>{const{orderId:l,groupId:c,editedOrder:d,tax:u,orderTotals:{totalPrice:p,finalPrice:g},appliedVouchers:E,charges:y,loyalty:I,deliveryStartDate:S,deliveryType:C}=e,T=d?"edited-order":"new-order",_=y.delivery.amount,A=E.map(w=>w.id).join(", "),R=p.currency,P=de(),N=I?.spent?.money.amount,k=w=>`${l}-${P}-part${w}`,M=Object.entries(y).reduce((w,[j,G])=>"amount"in G&&j!=="delivery"?w+Number(G.amount):w,0);return{event:"select_place_order",osp_transaction_id:l,ecommerce:{transaction_type:T,transaction_id:k(r),group_id:c||null,total_value:p.amount?Number(p.amount):null,value:g.amount?Number(g.amount):null,tax:n?Number(u):0,shipping:_?Number(_):null,loyalty:N?Number(N):null,currency:R,coupon:A,charges:M,items:t.map(w=>o(w,a,i))},...mIe(S),fulfillment_method:pIe[C]}},hIe=(e,t)=>{const{product:n,meta:o}=e.payload,r=15,a=Qs(t),i=Math.ceil(n.length/r),l=[];for(let d=0;d<i;d+=1)l.push(n.slice(d*r,(d+1)*r));const c=d=>d===0;return l.map((d,u)=>dW(e.payload,d,c(u),cW,u,o,a))},gIe={CUSTOMER_COLLECTION:"click_and_collect",HOME_DELIVERY:"home_delivery"},EIe=e=>{const t=e?ya(e):null;return{slot_day:t?.isoWeekday(),slot_start_time:t?.format($n),slot_date:t?.format(Ta),slot_end_time:""}},BI=(e,t,n)=>{const o=tn(e),r=Vn(e,n),a={item_id:o.id||null,item_name:o.name,index:null,item_brand:o.brand,hfss_display_restriction_group:e?.hfssDisplayRestrictionGroup||null,item_list_name:null,item_variant:e.variant,price:o.price?Number(o.price):null,rating:null,quantity:Number(o.quantity),is_on_promotion:o.isOnPromotion,promotion_ids:e.offers?.map(i=>i.retailerPromotionId).join(",")||null,is_favorite:o.isFavorite,is_featured:!!r,featured_campaign_id:r?.campaignId||null,featured_campaign_name:r?.campaignName||null,...Pl(e?.categoryPath??[]),seller_id:e.sellerId||null};return Rc({productId:o.productId,item:a,meta:t})},UI=e=>{const{payload:t,productChunk:n,isFirstChunk:o,index:r,mapProductToItem:a,featuredProductCampaigns:i}=e,{orderId:l,groupId:c,editedOrder:d,tax:u,orderTotals:{totalPrice:p},appliedVouchers:g,charges:E,loyalty:y,deliveryStartDate:I,deliveryMethod:S,meta:C,revenue:T}=t,_=d?"edited-order":"new-order",A=E.delivery.amount,R=g.map(j=>j.id).join(", "),P=p.currency,N=de(),k=y?.spent?.money.amount,M=j=>`${l}-${N}-part${j}`,w=Object.entries(E).reduce((j,[G,W])=>"amount"in W&&G!=="delivery"?j+Number(W.amount):j,0);return{event:"purchase",ecommerce:{osp_transaction_id:l,transaction_type:_,transaction_id:M(r),group_id:c||null,total_value:p.amount?Number(p.amount):null,value:o?Number(T):0,tax:o?Number(u):0,shipping:A?Number(A):null,loyalty:k?Number(k):null,currency:P,coupon:R,charges:w,items:n.map(j=>a(j,C,i))},...EIe(I),fulfillment_method:gIe[S]}},fIe=(e,t)=>{const{product:n}=e.payload,o=Qs(t);if(!n.length)return[UI({payload:e.payload,productChunk:[],isFirstChunk:!0,mapProductToItem:BI,index:0,featuredProductCampaigns:o})];const r=15,a=Math.ceil(n.length/r),i=[];for(let c=0;c<a;c+=1)i.push(n.slice(c*r,(c+1)*r));const l=c=>c===0;return i.map((c,d)=>UI({payload:e.payload,productChunk:c,isFirstChunk:l(d),mapProductToItem:BI,index:d,featuredProductCampaigns:o}))},yIe=(e,t,n)=>{const{brand:o,variant:r,price:a,quantity:i,isFavorite:l,isOnPromotion:c,position:d,productId:u}=tn(e),p=e.ratingSummary?.overallRating,g=Vn(e,n),E={item_id:e.retailerProductId||null,item_name:e.name,index:d||null,item_brand:o,hfss_display_restriction_group:e.hfssDisplayRestrictionGroup??null,item_list_name:null,item_variant:r,price:a,rating:p?Number(p):null,quantity:Number(i),is_on_promotion:c,is_favorite:l,is_featured:!!g,featured_campaign_id:g?.campaignId||null,featured_campaign_name:g?.campaignName||null,...Pl(e?.categoryPath??[]),seller_id:e.seller?.id||null};return Rc({productId:u,item:E,meta:t})},IIe=(e,t)=>{const{payload:{meta:n}}=e,o=Ct(t)||null,r=Qs(t),a=ho(t).map(c=>yIe(c,n,r)),i=Ra(t),l=or(t);return{event:"begin_checkout",ecommerce:{currency:i?.currency||null,value:i?.amount?Number(i.amount):null,osp_transaction_id:o,group_id:l,items:a}}},uW=se("GET_DELIVERABILITY_BY_ADDRESS_DETAILS"),pW=se("FETCH_DETAILS_FOR_ADDRESS"),mW=se("GET_CUSTOMER_ADDRESSES"),hW=se("POST_CUSTOMER_ADDRESSES"),gW=se("FETCH_ADDRESSES_BY_SEARCH_TERM"),EW=se("FETCH_ADDRESSES_BY_POSTCODE"),SIe=(e,t)=>({type:"API",payload:{url:`/v3/address-deliverability/by-address-details?countryCode=${t}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",body:e},...uW}}),CIe=e=>({type:"API",payload:{url:"/v1/addresses/by-search-term",service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"PUT",body:{query:e}},...gW}}),vIe=(e,t=!1)=>{const n=new URLSearchParams;return t&&n.append("sorted",t.toString()),{type:"API",payload:{url:`/v1/addresses/by-postcode${n.toString()?`?${n.toString()}`:""}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"PUT",body:{postcode:e}},...EW}}},TIe=e=>({type:"API",payload:{url:`/v1/addresses/lookup/${e}/details`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},...pW}}),fW=()=>({type:"API",payload:{service:"ecomdeliverydestinations",url:"/ecomdeliverydestinations/v4/delivery-addresses?deliveryMethod=HOME_DELIVERY",...mW}}),_Ie=e=>({type:"API",payload:{url:"/v3/customer-addresses",service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",body:e},...hW}}),eo={types:{GET_DELIVERABILITY_BY_ADDRESS_DETAILS:uW,FETCH_ADDRESSES_BY_SEARCH_TERM:gW,FETCH_ADDRESSES_BY_POSTCODE:EW,FETCH_DETAILS_FOR_ADDRESS:pW,GET_CUSTOMER_ADDRESSES:mW,POST_CUSTOMER_ADDRESSES:hW},getDeliverabilityByAddressDetails:SIe,fetchAddressesBySearchTerm:CIe,fetchAddressesByPostcode:vIe,fetchDetailsForAddress:TIe,getCustomerAddresses:fW,postCustomerAddresses:_Ie},bIe=(e=ms.customer.addresses,t)=>{switch(t.type){case eo.types.GET_CUSTOMER_ADDRESSES.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case eo.types.GET_CUSTOMER_ADDRESSES.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case eo.types.GET_CUSTOMER_ADDRESSES.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:t.payload.responseData};case FI.types.REMOVE_CUSTOMER_ADDRESS.SUCCESS:return{...e,lastUpdated:de(),data:e.data.filter(n=>n.id?n.id!==t.id:n.addressId!==t.id)};default:return e}},xIe=e=>e.map(t=>({...t,id:t.addressId,regionId:t.resolvedRegionId||t.regionId,deliverable:t.deliverability==="DELIVERABLE",nickname:t.name,addressLine:t.formattedAddress,notes:t.deliveryInstructions})),cu=({data:e})=>({...e.customer.addresses,data:xIe(e.customer.addresses.data)}),AIe=({data:e})=>(e.customer.addresses.data||[]).length,bD=({data:e})=>e.customer.addresses.isFetching,RIe=({data:e})=>!!e.customer.addresses.data.length;Y(({data:e})=>e.customer.addresses,e=>!!e.data.length&&e.data.find(t=>t.deliverable)!==void 0);const yW=Y(cu,e=>e.data.reduce((t,n)=>({...t,[n.addressId]:n.deliverable}),{})),DIe=e=>Ze(e,"address-lookup-flow-main"),OIe=e=>Ze(e,"address-lookup-flow-secondary"),PIe=e=>parseInt(Ze(e,"address-lookup-flow-page-size"),10),NIe=e=>parseInt(Ze(e,"address-lookup-flow-warning-threshold"),10),LIe=e=>parseInt(Ze(e,"address-lookup-flow-max-candidates"),10),cE=Y(({retailerSettings:e})=>e["customer-addresses-supported-lookup-countries"],e=>typeof e=="string"?e.split(",").map(t=>t.trim()):[]),kIe="deliveryPassSubscription",jIe="dp.r",MIe="dp",IW="dp.by.store",wIe="sub3ds",FIe="spt",BIe="dp.fft",UIe="dp.freetrial",GIe="dp.ctf",$Ie="w.sbc",mc="center",un=(()=>{const e=D(IW),t=D(MIe),n=D(jIe),o=D(GIe),r=D(wIe),a=D($Ie),i=Y(a,r,(c,d)=>!c||d),l=Y(a,r,(c,d)=>c&&!d);return{isDeliveryPassByStoreEnabled:e,isSubscriptionEnabled:t,isRegionAwareEnabled:n,isSubscriptionPlanTransitionEnabled:D(FIe),is3dsSubscriptionsFlowEnabled:r,isBlockSubscriptionPurchaseAndEditEnabled:a,isSubscriptionPurchaseDisabled:l,isChangeAndEditPaymentEnabled:i,isFlexibleFreeTrialEnabled:D(BIe),isFreeTrialEnabled:D(UIe),isContentfulEnabled:o,canLoadBenefitGroupSelectionScene:c=>t(c)&&n(c)}})();function HIe(e){const t=un.isDeliveryPassByStoreEnabled(e),n=un.isSubscriptionEnabled(e),o=un.isRegionAwareEnabled(e),r=un.isSubscriptionPlanTransitionEnabled(e),a=un.is3dsSubscriptionsFlowEnabled(e),i=un.isBlockSubscriptionPurchaseAndEditEnabled(e),l=un.canLoadBenefitGroupSelectionScene(e),c=un.isFlexibleFreeTrialEnabled(e),d=un.isFreeTrialEnabled(e),u=un.isContentfulEnabled(e),p=un.isChangeAndEditPaymentEnabled(e),g=un.isSubscriptionPurchaseDisabled(e);return{isSubscriptionEnabled:n,isRegionAwareEnabled:o,isSubscriptionPlanTransitionEnabled:r,is3dsSubscriptionsFlowEnabled:a,isBlockSubscriptionPurchaseAndEditEnabled:i,canLoadBenefitGroupSelectionScene:l,isFlexibleFreeTrialEnabled:c,isFreeTrialEnabled:d,isContentfulEnabled:u,isChangeAndEditPaymentEnabled:p,isSubscriptionPurchaseDisabled:g,isDeliveryPassByStoreEnabled:t}}function No(){const e=f(t=>t);return HIe(e)}const VIe="web_customer_ws",WIe=()=>({client:"/api/customer",server:"/core-api"});function du(e,t,n,o=VIe,r=WIe()){return{type:"API",payload:{...se(e),url:t,options:n,service:o,pathPrefix:r}}}const YIe=e=>du("ENABLE_AUTO_RENEWAL",`/v1/benefit-groups/delivery-pass/subscription/${e}/autoRenewalStatus`,{method:"PUT",body:{autoRenewalStatus:!0}}),qIe=e=>du("DISABLE_AUTO_RENEWAL",`/v1/benefit-groups/delivery-pass/subscription/${e}/autoRenewalStatus`,{method:"PUT",body:{autoRenewalStatus:!1}});function SW(){return du("GET_CUSTOMER_SUBSCRIPTIONS","/v2/benefit-groups/delivery-pass/subscriptions",{method:"GET"})}function CW(e){return e(SW()).then(n=>n?.type==="GET_CUSTOMER_SUBSCRIPTIONS_SUCCESS"?n?.payload?.responseData:n?.payload)}const KIe=e=>({type:"WALLET_ITEM_UPDATED",payload:{walletItemId:e}}),vW=e=>({type:"SET_SELECTED_SUBSCRIPTION_CARD",payload:{paymentInformation:e}});function zIe(e,t){const n=o=>t[o.addressId];return e.filter(n)}function NF({customerSubscription:{subscription:{nextRenewal:e}}}){return e?.planId!==null}function QIe(e){return e.customerSubscription.subscription.autoRenewalStatus}function XIe(e){return!!(e.customerSubscription.subscription.walletItem||e.customerSubscription.subscription.paymentInformation?.details)}function ZIe(e){const{customerSubscription:{plan:{freeTrial:t}}}=e;return!!t}function JIe({customerSubscriptionResponse:e}){return e.customerSubscription.subscription.nextRenewal?.planIsTransitioning}function eSe(e,{isSubscriptionPlanTransitionEnabled:t,isFreeTrialEnabled:n,isBlockSubscriptionPurchaseAndEditEnabled:o,isChangeAndEditPaymentEnabled:r,is3dsSubscriptionsFlowEnabled:a},i){const l=NF(e)&&QIe(e),c=XIe(e),d=zIe(e.deliveryAddresses,i);return{...e,metadata:{isPlanRenewable:NF(e),isPlanAutoRenewing:l,canCancelAutoRenewal:l&&(c||o),canChangePaymentMethod:r&&l,isReauthRequired:a&&!!e.customerSubscription.subscription.paymentInformation?.authRequired,isPaymentMethodLinkedToPlan:c,isSubscriptionPlanTransitioning:JIe({customerSubscriptionResponse:e})&&t,isFreeTrialAvailable:n&&ZIe(e),filteredAddresses:d,isCardDisabled:d.length===0}}}function tSe(e,t){if(e.data)return e.data.map(n=>n.customerSubscription?.subscription.subscriptionId===t.payload.responseData.subscriptionId?{...n,customerSubscription:{...n.customerSubscription,subscription:{...n.customerSubscription?.subscription,autoRenewalStatus:t.payload.responseData.autoRenewalStatus}}}:n)}const sSe=(e={...je,error:null,data:void 0,selectedSubscriptionCard:void 0},t)=>{switch(t.type){case"ENABLE_AUTO_RENEWAL_PENDING":case"GET_CUSTOMER_SUBSCRIPTIONS_PENDING":return{...e,isFetching:!0,fetchError:!1,error:null};case"GET_CUSTOMER_SUBSCRIPTIONS_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};case"GET_CUSTOMER_SUBSCRIPTIONS_SUCCESS":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};case"DISABLE_AUTO_RENEWAL_SUCCESS":case"ENABLE_AUTO_RENEWAL_SUCCESS":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:tSe(e,t)};case"WALLET_ITEM_UPDATED":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de()};case"SET_SELECTED_SUBSCRIPTION_CARD":return{...e,selectedSubscriptionCard:{paymentInformation:t.payload.paymentInformation}};default:return e}},xD="deliveryPass.subscription",nSe=({data:e})=>!!Vo(e,`${xD}.data`,[])[0]?.customerSubscription,oSe=({data:e})=>!!Vo(e,`${xD}.data`,[])?.[0]?.customerSubscription?.subscription?.autoRenewalStatus,rSe=({data:e})=>Vo(e,`${xD}.selectedSubscriptionCard.paymentInformation`),{isSubscriptionPlanTransitionEnabled:aSe,isFreeTrialEnabled:iSe,isBlockSubscriptionPurchaseAndEditEnabled:lSe,isChangeAndEditPaymentEnabled:cSe,is3dsSubscriptionsFlowEnabled:dSe}=un;function TW(e){const t=nSe(e),n=oSe(e),o=rSe(e),r=aSe(e),a=iSe(e),i=lSe(e),l=cSe(e),c=dSe(e),{data:d}=e.data.deliveryPass.subscription;return{...e.data.deliveryPass.subscription,data:d?d.map(u=>eSe(u,{isSubscriptionPlanTransitionEnabled:r,isFreeTrialEnabled:a,isBlockSubscriptionPurchaseAndEditEnabled:i,isChangeAndEditPaymentEnabled:l,is3dsSubscriptionsFlowEnabled:c},yW(e))):void 0,metadata:{hasCustomerSubscriptions:t,isSubscriptionAutoRenewalEnabled:n,selectedSubscriptionCardPaymentInformation:o}}}function uSe(e){return TW(e)}function pSe(){const e=f(TW),t=F();return ae.useMemo(()=>({fetch:()=>CW(t),getComputedState:()=>e,disableAutoRenewal:n=>t(qIe(n)),enableAutoRenewal:n=>t(YIe(n)),walletItemUpdated:n=>t(KIe(n)),setSelectedSubscriptionCard:n=>t(vW(n))}),[e])}const Qr={server:{fetch:CW,getComputedState:uSe},client:{useHooks:pSe}},mSe="deliveryPass.benefitGroupsAddresses",hSe={...je,error:null,data:[]},gSe=(e=hSe,t)=>{switch(t.type){case"GET_DELIVERY_PASS_BENEFIT_GROUPS_ADDRESSES_PENDING":return{...e,isFetching:!0,fetchError:!1,error:null};case"GET_DELIVERY_PASS_BENEFIT_GROUPS_ADDRESSES_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};case"GET_DELIVERY_PASS_BENEFIT_GROUPS_ADDRESSES_SUCCESS":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},ESe=({data:e})=>Vo(e,mSe);function fSe({data:e}){const t=o=>{if((o||[]).length!==0)return o[0]};return(o=>t(o)?.benefitGroupId)(e.deliveryPass?.benefitGroupsAddresses?.data)}const ySe=()=>du("GET_DELIVERY_PASS_BENEFIT_GROUPS_ADDRESSES","/v3/benefit-groups/delivery-pass",{method:"GET"}),ISe=({benefitGroupId:e}={})=>du("GET_DELIVERY_PASS_BENEFITS",`/v4/benefit-groups/delivery-pass${e?`?benefitGroupId=${e}`:""}`,{method:"GET"}),SSe=e=>du("GET_CUSTOMER_SELECTED_SUBSCRIPTION",`/v2/benefit-groups/delivery-pass/subscription/${e}`,{method:"GET"}),CSe=(e,t)=>e(SSe(t)),uu={getDeliveryPassBenefits:ISe,getDeliveryPassBenefitGroupsAddresses:ySe,setSelectedSubscriptionCard:vW,fetchCustomerSelectedSubscription:CSe,getCustomerSubscriptions:SW};function _W(e){return{...ESe(e),metadata:{benefitGroupIdFromDefaultAddress:fSe(e)}}}function vSe(){const e=f(_W),t=F(),n=()=>t(uu.getDeliveryPassBenefitGroupsAddresses());return ae.useMemo(()=>({getComputedState:()=>e,fetch:n}),[e])}const Xr={server:{getComputedState:_W,fetch:e=>e(uu.getDeliveryPassBenefitGroupsAddresses())},client:{useHooks:vSe}},TSe=e=>({...e.subscription,planName:e.name,cost:e.cost}),LF=e=>{const t=e.plans.find(n=>!!n.subscription);return t?TSe(t):void 0},_Se=(e={...je,data:void 0,error:null},t)=>{switch(t.type){case"GET_DELIVERY_PASS_BENEFITS_PENDING":return{...e,isFetching:!0,fetchError:!1,error:null};case"GET_DELIVERY_PASS_BENEFITS_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};case"GET_DELIVERY_PASS_BENEFITS_SUCCESS":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},bSe=e=>e.data.deliveryPass.benefits,AD=e=>e.data.deliveryPass.benefits.data?.benefits??[],bW=e=>(e.data.deliveryPass.benefits.data?.benefits||[]).flatMap(t=>t.plans),xSe=e=>bW(e).some(n=>n.freeTrial?.eligible),ASe=Y(AD,e=>e?.some(({plans:t})=>t.some(({subscription:n})=>n?.autoRenewalStatus))),RSe=Y(AD,e=>{const t=e.find(n=>!!LF(n));if(t)return{benefitName:t.name,benefitDescription:t.description,...LF(t)}});function xW(e){const t=bSe(e),n=AD(e),o=bW(e),r=xSe(e),a=ASe(e),i=RSe(e);return{...t,error:t.error,metadata:{benefits:n,plans:o,isFreeTrial:r,isPurchasedSubscriptionAutoRenewalEnabled:a,benefitGroupSubscription:i}}}function DSe(){const e=f(xW),t=F();return ae.useMemo(()=>({getComputedState:()=>e,fetch:n=>t(uu.getDeliveryPassBenefits(n))}),[e])}const Ln={server:{getComputedState:xW,fetch:(e,t={})=>e(uu.getDeliveryPassBenefits(t))},client:{useHooks:DSe}},OSe="deliveryPass.selectedSubscription",PSe=(e={...je,error:null,data:void 0},t)=>{switch(t.type){case"GET_CUSTOMER_SELECTED_SUBSCRIPTION_PENDING":return{...e,isFetching:!0,fetchError:!1,error:null};case"GET_CUSTOMER_SELECTED_SUBSCRIPTION_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};case"GET_CUSTOMER_SELECTED_SUBSCRIPTION_SUCCESS":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},AW=({data:e})=>Vo(e,OSe),{fetchCustomerSelectedSubscription:RW}=uu;function NSe(){const e=f(AW),t=F();return ae.useMemo(()=>({fetch:n=>RW(t,n),getComputedState:()=>e}),[e])}const DW={server:{fetch:RW,getComputedState:AW},client:{useHooks:NSe}},LSe=(e={...je,data:void 0,error:null},t)=>{switch(t.type){case"GET_DELIVERY_PASS_CONTENTFUL_PAGE_PENDING":return{...e,isFetching:!0,fetchError:!1,error:null};case"GET_DELIVERY_PASS_CONTENTFUL_PAGE_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};case"GET_DELIVERY_PASS_CONTENTFUL_PAGE_SUCCESS":return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},OW=e=>e.data.deliveryPass.contentful;function kSe(){return f(OW)}const go=({basePath:e="",target:t=""}={})=>`${e}/api${t}`,jSe=({basePath:e=""}={})=>`${e}/change-credentials`,kd=e=>`/stores/${e}`;function MSe({postFetchOptions:{basePath:e,options:t},isFreeTrialEnabled:n,resultToken:o}){const r=go({basePath:e,target:"/customer/v3/benefit-groups/delivery-pass/subscription/complete3ds"});return fetch(r,{...t,body:JSON.stringify({freeTrialEnabled:n,details:{resultToken:o}})})}function PW({postFetchOptions:{basePath:e,options:t},isFreeTrialEnabled:n,planId:o,walletItemId:r,regionId:a,checkoutUrl:i}){const l=go({basePath:e,target:"/customer/v3/benefit-groups/delivery-pass/subscription"});return fetch(l,{...t,body:JSON.stringify({planId:o,walletItemId:r,startTime:GH(),freeTrialEnabled:n,checkoutUrl:i,source:"web",regionId:a})})}const wSe=({clientRouteId:e,csrfToken:t,basePath:n})=>({basePath:n,options:{method:"POST",credentials:"same-origin",headers:{"client-route-id":e,"content-type":"application/json; charset=utf-8","X-CSRF-TOKEN":t}}}),FSe=()=>du("GET_DELIVERY_PASS_CONTENTFUL_PAGE","/v1/subscriptions/contentful",{method:"GET"}),BSe={getDeliveryPassContentfulPage:FSe},USe=(e,t)=>{const n=ya(e),o=ya(t);return{slot_day:n.isoWeekday(),slot_start_time:n.format($n),slot_date:n.format(Ta),slot_end_time:o.format($n)}},NW=(e,t,n)=>{const{productEntity:o,quantity:r}=e,a=tn(o),i=o?.ratingSummary?.overallRating,l=Vn(o,n),c={item_id:a?.id||null,item_name:a?.name,index:null,item_brand:a?.brand,hfss_display_restriction_group:o?.hfssDisplayRestrictionGroup||null,item_list_name:null,item_variant:o?.size?.value||null,price:a?.price?Number(a.price):null,rating:i?Number(i):null,quantity:r,is_on_promotion:!!a?.isOnPromotion,promotion_ids:o?.offers?.map(d=>d.retailerPromotionId).join(",")||null,is_favorite:!!a?.isFavorite,is_featured:!!l,featured_campaign_id:l?.campaignId||null,featured_campaign_name:l?.campaignName||null,...Pl(o?.categoryPath??[]),seller_id:o?.seller?.id||null};return Rc({productId:a.productId,item:c,meta:t})},LW=e=>{const{data:t,productChunk:n,isFirstChunk:o,index:r,hasDeliveryPass:a,groupId:i,mapEventItem:l,meta:c,featuredProductCampaigns:d}=e,{orderId:u,orderTotals:{taxesTotals:p,totalPrice:g,finalPrice:E},appliedVouchers:y,charges:I,loyalty:S,dates:{deliveryStartDate:C,deliveryEndDate:T},deliveryMethod:_,wasEdited:A}=t,R=A?"edited-order":"new-order",P=y.map(K=>K.id).join(", "),{currency:N,amount:k}=g,M=de(),w=S?.spent?.money.amount,j=()=>`${u}-${M}-part${r}`,G=o?p.taxes.components.reduce((K,X)=>K+Number(X.taxAmount.amount),0):0,W=Object.entries(I).reduce((K,[X,q])=>"amount"in q&&X!=="delivery"?K+Number(q.amount):K,0),H=()=>a?0:I.delivery.amount?Number(I.delivery.amount):null;return{event:"order_confirmed",ecommerce:{osp_transaction_id:u,transaction_type:R,transaction_id:j(),group_id:i,value:E.amount?Number(E.amount):null,total_value:k?Number(k):null,tax:G,shipping:H(),loyalty:w?Number(w):null,currency:N,coupon:P,charges:W,items:n.map(K=>l(K,c,d))},...USe(C,T),fulfillment_method:_.toLowerCase()}},GSe=(e,t)=>{const n=Ki(t,e.payload.orderId),o=ts(t),r=or(t),a=Qs(t),i=Qr.server.getComputedState(t).metadata.hasCustomerSubscriptions,{items:l}=n,c=15,d=Math.ceil(l.length/c),u=[];for(let g=0;g<d;g+=1)u.push(l.slice(g*c,(g+1)*c).map(E=>({...E,productEntity:o[E.product]})));const p=g=>g===0;return u.map((g,E)=>LW({data:n,productChunk:g,isFirstChunk:p(E),mapEventItem:NW,index:E,groupId:r,hasDeliveryPass:i,meta:e.payload.meta,featuredProductCampaigns:a}))},$Se={[Le.BEGIN_CHECKOUT]:IIe,[Le.ORDER_PURCHASED]:fIe,[Le.SELECT_PLACE_ORDER]:hIe,[Le.ORDER_CONFIRMED]:GSe},HSe=e=>{const{ITEM_ID:t,ITEM_NAME:n,SEQUENCE:o,SEQUENCE_OF_ITEM_ON_PAGE:r,PAGE_TYPE:a,PAGE_NAME:i,LINK_TYPE:l,LINK_VALUE:c}=e.payload;return i==="homepage"?{id:t,name:n,event:"select_homepage_tile",navigation:"grid",index:o,location:r,link_type:l,target:c}:{id:t,name:n,event:`${i}_navigation`,navigation:"grid-tile",type:a,index:r,location:null,link_type:l,target:c}},VSe=e=>{const{ITEM_ID:t,ITEM_NAME:n,SEQUENCE:o,SEQUENCE_OF_ITEM_ON_PAGE:r,LINK_TYPE:a,LINK_VALUE:i}=e.payload;return{id:t,name:n,event:"select_homepage_tile",navigation:"carousel",index:o,location:r,link_type:a,target:i}},WSe=e=>{const{ITEM_ID:t,ITEM_NAME:n,LOCATION:o,PAGE_TYPE:r,PAGE_NAME:a,LINK_TYPE:i,LINK_VALUE:l}=e.payload;return{id:t,name:n,event:`${a}_navigation`,navigation:"navigation",type:r,index:null,location:o,link_type:i,target:l}},YSe=e=>{const{ITEM_ID:t,ITEM_NAME:n,LOCATION:o,PAGE_TYPE:r,PAGE_NAME:a,LINK_TYPE:i,LINK_VALUE:l}=e.payload;return{id:t,name:n,event:`${a}_navigation`,navigation:"lead-image",type:r,index:null,location:o,link_type:i,target:l}},qSe=e=>{const{BANNER_ID:t,BANNER_NAME:n,PAGE_NAME:o,PAGE_TYPE:r,LINK_TYPE:a,TARGET_URL:i,SEQUENCE:l}=e.payload;return{id:t,name:n,event:`${o}_navigation`,navigation:"hero",type:r,index:l,location:null,link_type:a,target:i}},KSe=e=>{const{RICH_TEXT_ID:t,LINK_TYPE:n,LINK_VALUE:o,PAGE_NAME:r,PAGE_TYPE:a,LOCATION:i}=e.payload;return{id:t,name:t,event:`${r}_navigation`,navigation:"link",type:a,index:null,location:i,link_type:n,target:o}},Ls={COMPONENTIZED_ATTRIBUTES:"COMPONENTIZED_ATTRIBUTES",GRID_IMPRESSION:"GRID_IMPRESSION",GRID_ITEM_IMPRESSION:"GRID_ITEM_IMPRESSION",HORIZONTAL_HERO_BANNER_CLICK:"IMAGE_CLICKED",HORIZONTAL_HERO_BANNER_IMPRESSION:"HERO_IMAGE_BANNER_IMPRESSION",GRID_ITEM_CLICKED:"GRID_ITEM_CLICKED",CAROUSEL_ITEM_CLICKED:"CAROUSEL_ITEM_CLICKED",NAV_MENU_CLICKED:"NAV_MENU_CLICKED",NAV_ITEM_CLICKED:"NAV_ITEM_CLICKED",RICH_TEXT_IMPRESSION:"RICH_TEXT_IMPRESSION",RICH_TEXT_LINK_CLICKED:"RICH_TEXT_LINK_CLICKED",LEAD_IMAGE_CLICKED:"LEAD_IMAGE_CLICKED"},zSe={[Ls.GRID_ITEM_CLICKED]:HSe,[Ls.CAROUSEL_ITEM_CLICKED]:VSe,[Ls.NAV_ITEM_CLICKED]:WSe,[Ls.LEAD_IMAGE_CLICKED]:YSe,[Ls.HORIZONTAL_HERO_BANNER_CLICK]:qSe,[Ls.RICH_TEXT_LINK_CLICKED]:KSe},QSe=(e,t)=>({...Ws,userId:ei(t),retailerRegionId:sa(t),retailerBannerId:yC(t),regionName:xR(t),bannerName:Zd(t)}),XSe={[Pn]:QSe},ZSe=e=>({...Ws,hitType:"pageview",page:`/open-${e.payload.modalName.toLowerCase().replace("_","-")}-modal`}),kW="OPEN_MODAL",jW="CLOSE_MODAL",JSe=(e,t)=>({type:kW,payload:{modalName:e,options:t}}),eCe=()=>({type:jW}),J={actionTypes:{OPEN_MODAL:kW,CLOSE_MODAL:jW},openModal:JSe,closeModal:eCe},Yn=e=>({control:t})=>t.modal?.[e]?.options,$e=e=>({control:t})=>t.modal?.[e]?.isOpen??!1,Wt=e=>{const t=F(),n=f($e(e)),o=f(Yn(e));return h.useMemo(()=>({isOpen:n,options:o,open:r=>{t(J.openModal(e,r))},close:()=>{t(J.closeModal())}}),[e,t,n,o])},tCe={[J.actionTypes.OPEN_MODAL]:ZSe},sCe={[Jt.GA_IMPRESSION]:qge,[Jt.GA_BATCH_IMPRESSION]:Kge,[Jt.GA4_BATCH_IMPRESSION]:kfe,[Jt.GA_PRODUCT_CLICK]:zge,[Jt.GA4_PRODUCT_CLICK]:Nfe,[Jt.GA_FOP_PROMO_LINK_CLICKED]:Qge},nCe=e=>({...Xs,event:"select_promotion",eventAction:"MENU_CAMPAIGN_ITEM_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"Menu Campaign",id:e.payload.menuCampaignItemId,name:e.payload.menuCampaignItemName,creative:e.payload.fileName,position:`Menu campaign item ${e.payload.position}`}]}}}),oCe=e=>({...Xs,event:"view_promotion",eventAction:"MENU_CAMPAIGN_ITEM_IMPRESSION",ecommerce:{promoView:{promotions:e.payload.menuCampaignItemList}}}),rCe=e=>({...Xs,event:"select_promotion",eventAction:"MENU_CAMPAIGN_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"Menu Campaign",id:e.payload.menuCampaignId,name:e.payload.menuCampaignName,creative:e.payload.fileName,position:`Menu ${e.payload.position}`}]}}}),aCe=e=>({...Xs,event:"view_promotion",eventAction:"MENU_CAMPAIGN_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Menu Campaign",id:e.payload.id,name:e.payload.name,creative:e.payload.fileName,position:`Menu ${e.payload.position}`}]}}}),iCe="CATALOGUE_NAVIGATION_BAR_BUTTON_CLICKED",lCe="FAVORITES_NAVIGATION_BAR_BUTTON_CLICKED",cCe="COUPONS_NAVIGATION_BAR_BUTTON_CLICKED",dCe="LISTS_NAVIGATION_BAR_BUTTON_CLICKED",uCe="REGULARS_NAVIGATION_BAR_BUTTON_CLICKED",pCe="DELIVERY_PASS_NAVIGATION_BAR_BUTTON_CLICKED",mCe="RECIPES_NAVIGATION_BAR_BUTTON_CLICKED",hCe="MEAL_NAVIGATION_BAR_BUTTON_CLICKED",gCe="RECURRING_ORDERS_NAVIGATION_BAR_BUTTON_CLICKED",ECe="SHOP_IN_SHOP_NAVIGATION_BAR_BUTTON_CLICKED",fCe="MENU_CAMPAIGN_CLICKED",yCe="MENU_CAMPAIGN_DETAIL_IMPRESSION",ICe="MENU_CAMPAIGN_IMPRESSION",SCe="MENU_CAMPAIGN_ITEM_CLICKED",CCe="MENU_CAMPAIGN_ITEM_IMPRESSION",vCe="MENU_CAMPAIGN_ITEM_LIST_IMPRESSION",TCe="NAVIGATION_BAR_BUTTON_IMPRESSION",_Ce="OFFERS_NAVIGATION_BAR_BUTTON_CLICKED",bCe="LOCALE_DROPDOWN_OPENED",xCe="SMART_CART_NAVIGATION_BAR_BUTTON_CLICKED",Bt={CATALOGUE_NAVIGATION_BAR_BUTTON_CLICKED:iCe,FAVORITES_NAVIGATION_BAR_BUTTON_CLICKED:lCe,COUPONS_NAVIGATION_BAR_BUTTON_CLICKED:cCe,LISTS_NAVIGATION_BAR_BUTTON_CLICKED:dCe,REGULARS_NAVIGATION_BAR_BUTTON_CLICKED:uCe,DELIVERY_PASS_NAVIGATION_BAR_BUTTON_CLICKED:pCe,RECIPES_NAVIGATION_BAR_BUTTON_CLICKED:mCe,MEAL_NAVIGATION_BAR_BUTTON_CLICKED:hCe,RECURRING_ORDERS_NAVIGATION_BAR_BUTTON_CLICKED:gCe,SHOP_IN_SHOP_NAVIGATION_BAR_BUTTON_CLICKED:ECe,MENU_CAMPAIGN_CLICKED:fCe,MENU_CAMPAIGN_DETAIL_IMPRESSION:yCe,MENU_CAMPAIGN_IMPRESSION:ICe,MENU_CAMPAIGN_ITEM_CLICKED:SCe,MENU_CAMPAIGN_ITEM_IMPRESSION:CCe,MENU_CAMPAIGN_ITEM_LIST_IMPRESSION:vCe,NAVIGATION_BAR_BUTTON_IMPRESSION:TCe,OFFERS_NAVIGATION_BAR_BUTTON_CLICKED:_Ce,LOCALE_DROPDOWN_OPENED:bCe,SMART_CART_NAVIGATION_BAR_BUTTON_CLICKED:xCe},ACe={[Bt.MENU_CAMPAIGN_ITEM_LIST_IMPRESSION]:oCe,[Bt.MENU_CAMPAIGN_IMPRESSION]:aCe,[Bt.MENU_CAMPAIGN_ITEM_CLICKED]:nCe,[Bt.MENU_CAMPAIGN_CLICKED]:rCe},RCe=e=>({event:"select_menu_campaign_item",name:e.payload.menuCampaignItemName,id:e.payload.menuCampaignItemId,promotion_id:e.payload.menuCampaignId,index:e.payload.index}),DCe=e=>({event:"view_menu_campaign",name:e.payload.menuCampaignName,id:e.payload.menuCampaignId,index:e.payload.index}),OCe={[Bt.MENU_CAMPAIGN_DETAIL_IMPRESSION]:DCe,[Bt.MENU_CAMPAIGN_ITEM_CLICKED]:RCe},PCe=e=>({event:"select_tab",name:e.payload.label,id:e.payload.id,index:e.payload.tabPosition,location:e.payload.isInDropdown?"in-drop-down":"not-in-drop-down",target:e.payload.targetURL}),NCe="TOP_TAB_CLICKED",LCe="TOP_TAB_DROPDOWN_OPENED",kCe="TOP_TAB_IMPRESSION",xi={TOP_TAB_CLICKED:NCe,TOP_TAB_DROPDOWN_OPENED:LCe,TOP_TAB_IMPRESSION:kCe},jCe={[xi.TOP_TAB_CLICKED]:PCe},MCe=e=>{const{id:t,label:n,tabPosition:o,isInDropdown:r}=e.payload,a={promotionType:"Top Tab",id:t,name:n,creative:null,position:o,topTabIsInDropdown:r};return kC(e.type,"promoClick",[a])},wCe=()=>({...Ws,hitType:"event",eventCategory:"Top Tabs",eventAction:"TopTabDropdownOpened",eventLabel:"Not Set"}),FCe=e=>{const t=e.payload.links.map(n=>({promotionType:"Top Tab",id:n.id,name:n.label,creative:null,position:n.positionSeen,topTabIsInDropdown:n.isInDropdown}));return kC(e.type,"promoView",t)},BCe={[xi.TOP_TAB_CLICKED]:MCe,[xi.TOP_TAB_DROPDOWN_OPENED]:wCe,[xi.TOP_TAB_IMPRESSION]:FCe},UCe=e=>({...Ws,hitType:"event",eventCategory:"Locale",eventAction:e.type,eventLabel:e.payload.language}),GCe=e=>({event:"locale_changed",locale:e.payload.locale}),$Ce="LOCALE_CHANGED",HCe="LOCALE_CHANGED_GA4",VCe="LOCALE_MODAL_DISPLAYED",_r={LOCALE_CHANGED:$Ce,LOCALE_CHANGED_GA4:HCe,LOCALE_MODAL_DISPLAYED:VCe},WCe={[_r.LOCALE_CHANGED]:UCe,[_r.LOCALE_CHANGED_GA4]:GCe},YCe=e=>({...Xs,eventLabel:"cancelled-order",eventAction:"OrderCancelled",ecommerce:{refund:{actionField:{id:e.payload.orderId}}}}),qCe=e=>({...Xs,eventLabel:"edit-order-clicked",eventAction:"EditOrderButtonClicked",ecommerce:{transactionId:e.payload.orderId}}),Gs={BUY_ALL_PRODUCTS:"BUY_ALL_PRODUCTS",CANCEL_ORDER_MODAL_DISPLAYED:"CANCEL_ORDER_MODAL_DISPLAYED",DISCARD_CHANGES_MODAL_DISPLAYED:"DISCARD_CHANGES_MODAL_DISPLAYED",EDIT_ORDER_BUTTON_CLICKED:"EDIT_ORDER_BUTTON_CLICKED",ORDER_CANCELLED:"ORDER_CANCELLED",EDIT_PAGE_SLOT_BOOKING_CARD_CLICKED:"EDIT_PAGE_SLOT_BOOKING_CARD_CLICKED",ORDER_CANCELLED_GA4:"ORDER_CANCELLED_GA4",EDIT_ORDER_GA4:"EDIT_ORDER_GA4",EDIT_ORDER_PAGE_VIEW_EVENT:"EDIT_ORDER_PAGE_VIEW_EVENT"},KCe={[Gs.ORDER_CANCELLED]:YCe,[Gs.EDIT_ORDER_BUTTON_CLICKED]:qCe,[Gs.EDIT_ORDER_PAGE_VIEW_EVENT]:Ux},zCe=e=>{switch(e){case"START":return"AddWalletItemStart";case"COMPLETE":return"AddWalletItemSuccess";case"ERROR":return"AddWalletItemError";default:return"AddWalletItemError"}},QCe=e=>t=>({...Ws,hitType:"event",eventAction:zCe(t.payload.event),eventCategory:e,walletItemId:t.payload.walletItemId}),XCe=e=>({...Ws,hitType:"event",eventCategory:"Payment",eventAction:"failedPaymentWarningAlert",eventLabel:e.payload.pathname}),ZCe=e=>({...Ws,hitType:"pageview",page:e.payload.pathname}),JCe=e=>({...Ws,hitType:"event",eventCategory:"Payment",eventAction:"failedPaymentWarningAlertLinkClicked",eventLabel:e.payload.pathname}),eve=e=>t=>({...Ws,hitType:"event",eventCategory:e,eventAction:"SelectWalletItem",eventLabel:t.payload.pageEventAttributes.page,walletItemId:t.payload.pageEventAttributes.walletItemId}),tve="ADD_WALLET_ITEM",sve="BACK_TO_SHOP",nve="FAILED_PAYMENT",ove="FAILED_PAYMENT_SUCCESS",rve="FAILED_PAYMENT_WARNING_ALERT",ave="FAILED_PAYMENT_WARNING_ALERT_LINK_CLICKED",ive="FAILED_PAYMENT_WARNING_MODAL",lve="FAILED_PAYMENT_WARNING_MODAL_UPDATE_PAYMENT_DETAILS_BUTTON_CLICKED",cve="PAYMENT_CHECK_ADD_MODAL_DISPLAYED",dve="PAYMENT_CHECKS_AVAILABILITY_FETCHED_ANALYTICS",uve="WALLET_ITEM_IMPRESSION",pve="SELECT_WALLET_ITEM",mve="ADD_WALLET_ITEM_REQUEST",hve="ADD_PAYMENT_METHOD_MODAL_DISPLAYED",gve="PAYMENT_METHOD_DETAILS_MODAL_DISPLAYED",Eve="UNAUTHORIZED_POST_MESSAGE_ATTEMPT",Ot={ADD_WALLET_ITEM:tve,BACK_TO_SHOP:sve,FAILED_PAYMENT:nve,FAILED_PAYMENT_SUCCESS:ove,FAILED_PAYMENT_WARNING_ALERT:rve,FAILED_PAYMENT_WARNING_ALERT_LINK_CLICKED:ave,FAILED_PAYMENT_WARNING_MODAL:ive,FAILED_PAYMENT_WARNING_MODAL_UPDATE_PAYMENT_DETAILS_BUTTON_CLICKED:lve,PAYMENT_CHECK_ADD_MODAL_DISPLAYED:cve,PAYMENT_CHECKS_AVAILABILITY_FETCHED_ANALYTICS:dve,WALLET_ITEM_IMPRESSION:uve,SELECT_WALLET_ITEM:pve,ADD_WALLET_ITEM_REQUEST:mve,ADD_PAYMENT_METHOD_MODAL_DISPLAYED:hve,PAYMENT_METHOD_DETAILS_MODAL_DISPLAYED:gve,UNAUTHORIZED_POST_MESSAGE_ATTEMPT:Eve},MW=se("REMOVE_WALLET_ITEM"),kF="walletservice",fve=(e,t)=>({type:"API",payload:{service:kF,url:`/${kF}/v1/customers/${t}/wallet-items/${e}`,options:{method:"DELETE",body:{}},...MW},id:e}),ag={removeCustomerWalletItem:fve,types:{REMOVE_WALLET_ITEM:MW}},yve={[Ot.ADD_WALLET_ITEM]:QCe("Payment"),[Ot.FAILED_PAYMENT_WARNING_ALERT]:XCe,[Ot.FAILED_PAYMENT_WARNING_MODAL]:ZCe,[Ot.FAILED_PAYMENT_WARNING_ALERT_LINK_CLICKED]:JCe,[Ot.SELECT_WALLET_ITEM]:eve("Payment"),[ag.types.REMOVE_WALLET_ITEM.SUCCESS]:ga("Settings"),[ag.types.REMOVE_WALLET_ITEM.ERROR]:ga("Settings")},zt={REVIEW_IMAGE_GALLERY_CLOSED:"REVIEW_IMAGE_GALLERY_CLOSED",REVIEW_IMAGE_GALLERY_OPENED:"REVIEW_IMAGE_GALLERY_OPENED",REVIEW_IMAGE_NAVIGATED:"REVIEW_IMAGE_NAVIGATED",REVIEW_HELPFUL_BUTTON_CLICK:"REVIEW_HELPFUL_BUTTON_CLICK",GA_SELECT_REVIEW_HELPFUL:"GA_SELECT_REVIEW_HELPFUL",GA_UNSELECT_REVIEW_HELPFUL:"GA_UNSELECT_REVIEW_HELPFUL",ADD_A_REVIEW_BUTTON_CLICKED:"ADD_A_REVIEW_BUTTON_CLICKED",PRODUCT_RATINGS_CLICKED:"PRODUCT_RATINGS_CLICKED",SEE_NEXT_REVIEW_PAGE_BUTTON_CLICKED:"SEE_NEXT_REVIEW_PAGE_BUTTON_CLICKED",SEE_PREVIOUS_REVIEW_PAGE_BUTTON_CLICKED:"SEE_PREVIOUS_REVIEW_PAGE_BUTTON_CLICKED",REVIEW_SUBMITTED_TOAST_DISPLAYED:"REVIEW_SUBMITTED_TOAST_DISPLAYED",WRITE_REVIEW_ERROR_ALERT_DISPLAYED:"WRITE_REVIEW_ERROR_ALERT_DISPLAYED",VIEW_RESPONSE_BUTTON_CLICKED:"VIEW_RESPONSE_BUTTON_CLICKED",HIDE_RESPONSE_BUTTON_CLICKED:"HIDE_RESPONSE_BUTTON_CLICKED",REVIEW_SORT_PREFERENCE_CHANGED:"REVIEW_SORT_PREFERENCE_CHANGED",PRODUCT_REVIEW_IMPRESSION:"PRODUCT_REVIEW_IMPRESSION",PRODUCT_OVERALL_RATINGS_DASHBOARD_IMPRESSION:"PRODUCT_OVERALL_RATINGS_DASHBOARD_IMPRESSION",WRITE_NON_VERIFIED_REVIEW_BLOCK_TOAST_DISPLAYED:"WRITE_NON_VERIFIED_REVIEW_BLOCK_TOAST_DISPLAYED"},Ive=e=>({event:"select_review_helpful",id:e.payload.id,review_id:e.payload.reviewId}),Sve=e=>({event:"unselect_review_helpful",id:e.payload.id,review_id:e.payload.reviewId}),Cve={[zt.GA_SELECT_REVIEW_HELPFUL]:Ive,[zt.GA_UNSELECT_REVIEW_HELPFUL]:Sve},Cs={SEARCH_PAGE_VIEWED:"SEARCH_PAGE_VIEWED",SEARCH_SUGGESTION_CHOSEN:"SEARCH_SUGGESTION_CHOSEN",SEARCH_FORM_SUBMISSION:"SEARCH_FORM_SUBMISSION",GA_SHOW_SEARCH_PAGE:"GA_SHOW_SEARCH_PAGE",SEARCH_REDIRECT:"SEARCH_REDIRECT",SEARCH_SUGGESTION_IMPRESSION:"SEARCH_SUGGESTION_IMPRESSION",SEARCH_SUGGESTION_CLICKED:"SEARCH_SUGGESTION_CLICKED",SELECT_SEARCH_SUGGESTION:"SELECT_SEARCH_SUGGESTION",SEARCH_EVENT:"SEARCH_EVENT"},vve=e=>({...Ws,hitType:"event",eventCategory:"Search",eventAction:"SuggestionClicked",eventLabel:e.payload.searchSuggestion}),Tve=e=>({event:"select_search_suggestion",search_suggestion:e.payload.searchSuggestion,type:e.payload.suggestionType,index:e.payload.suggestionIndex,location:e.payload.location}),_ve=e=>({event:"search",search_term:e.payload.searchTerm,corrected_search_term:e.payload.correctedSearchTerm,locale:e.payload.locale}),bve=e=>({event:"search_redirect",search_term:e.payload.searchTerm,target:e.payload.redirectURL}),xve=e=>({...Ws,hitType:"event",eventCategory:"Search",pagePartType:"SEARCH",eventAction:Cs.GA_SHOW_SEARCH_PAGE,eventLabel:e.payload.searchTerm,searchTerm:e.payload.searchTerm,correctedSearchTerm:e.payload.correctedSearchTerm,locale:e.payload.locale}),Ave={[Cs.SEARCH_SUGGESTION_CHOSEN]:vve,[Cs.SELECT_SEARCH_SUGGESTION]:Tve,[Cs.SEARCH_EVENT]:_ve,[Cs.GA_SHOW_SEARCH_PAGE]:xve,[Cs.SEARCH_REDIRECT]:bve},Rve=(e,t)=>{const n=ho(t).map(r=>tn(r)),{slot:o}=e.payload;return{...Xs,eventCategory:iu,eventLabel:`${o.startTime} - ${o.endTime}`,eventValue:parseFloat(e.deliveryPrice.amount),eventAction:"SlotBooked",ecommerce:{checkout:{actionField:{step:2,option:e.deliveryType===pt.clickAndCollect.type?"click&collect":"homeDelivery"},products:n}}}},Dve=(e,t)=>{const n=ho(t).map(o=>tn(o));return{...Xs,eventCategory:iu,eventLabel:e.slotId,eventValue:parseFloat(e.deliveryPrice.amount),eventAction:"SelectSlotError",ecommerce:{checkout:{actionField:{step:2,option:e.deliveryType===pt.clickAndCollect.type?"click&collect":"homeDelivery"},products:n}}}},wW="CLEAR_SELECTED_SLOT",FW="CANCEL_SELECTED_SLOT",BW=se("SELECT_SLOT"),UW="INVALIDATE_SLOTS_CONFIRMATION_DATA",GW=se("GET_SLOT_BOOKING_LIMITED_PRODUCTS"),$W="SET_SELECTED_SLOT",Ove=()=>({type:wW}),Pve=()=>({type:FW}),Nve=({slotId:e,deliveryDestinationId:t,deliveryPrice:n,deliveryType:o,minimumOrder:r,orderId:a,externalAddress:i,carrierName:l,regionId:c,ecoSlot:d})=>({type:"API",payload:{pathPrefix:{client:"/api/ecomslots",server:"/core-api"},service:"ecomslots",url:"/v1/slots/reservation",options:{method:"POST",body:{regionId:c,slotId:e,deliveryDestinationId:t,externalAddress:i}},...BW},deliveryPrice:n,deliveryType:o,slotId:e,minimumOrder:r,orderId:a,carrierName:l,ecoSlot:d}),Lve=()=>({type:UW}),kve=({slotId:e,slotRegionId:t,limitedProducts:n})=>({type:"API",payload:{url:"/v5/products/slot-booking",options:{method:"PUT",body:{slotId:e,slotRegionId:t,limitedProducts:n}},...GW}}),jve=({selectSlotData:e,params:t})=>({...t,type:$W,payload:e}),wo={clearSelectedSlot:Ove,cancelSelectedSlot:Pve,selectSlot:Nve,invalidateSlotsConfirmationData:Lve,getSlotBookingLimitedProducts:kve,setSelectedSlot:jve,types:{CANCEL_SELECTED_SLOT:FW,CLEAR_SELECTED_SLOT:wW,SELECT_SLOT:BW,INVALIDATE_SLOTS_CONFIRMATION_DATA:UW,GET_SLOT_BOOKING_LIMITED_PRODUCTS:GW,SET_SELECTED_SLOT:$W}},Mve={[wo.types.SET_SELECTED_SLOT]:Rve,[wo.types.SELECT_SLOT.ERROR]:Dve},Ea={SHOP_IN_SHOP_PAGE_VIEW:"SIS_PAGE_VIEW",HORIZONTAL_HERO_BANNER_IMPRESSION:"SIS_HERO_IMAGE_BANNER_IMPRESSION",SUB_CATEGORY_IMAGE_IMPRESSION:"SIS_SUB_CATEGORY_IMAGE_IMPRESSION",SUB_CATEGORY_IMAGE_CLICKED:"SIS_SUB_CATEGORY_IMAGE_CLICKED"},Jp={HORIZONTAL_HERO_BANNER_IMPRESSION:"HERO_IMAGE_BANNER_IMPRESSION",SUB_CATEGORY_IMAGE_IMPRESSION:"SUB_CATEGORY_IMAGE_IMPRESSION",SUB_CATEGORY_IMAGE_CLICKED:"SUB_CATEGORY_IMAGE_CLICKED"},wve=({payload:e})=>({...Xs,event:"view_promotion",eventCategory:"Shop in Shop page",eventAction:Jp.HORIZONTAL_HERO_BANNER_IMPRESSION,ecommerce:{promoView:{promotions:[{promotionType:"Shop in Shop",id:e.id,name:e.name,creative:e.imageId,position:"Hero Image"}]}}}),Fve=({payload:e})=>({...Xs,event:"view_promotion",eventCategory:"Shop in Shop page",eventAction:Jp.SUB_CATEGORY_IMAGE_IMPRESSION,ecommerce:{promoView:{promotions:[{promotionType:"Shop in Shop",id:e.id,name:e.subCategoryName,creative:e.imageId,position:`Sub category image ${e.sequence}`}]}}}),Bve=({payload:e})=>({...Xs,event:"select_promotion",eventCategory:"Shop in Shop page",eventAction:Jp.SUB_CATEGORY_IMAGE_CLICKED,ecommerce:{promoClick:{promotions:[{promotionType:"Shop in Shop",id:e.id,name:e.subCategoryName,creative:e.imageId,position:`Sub category image ${e.sequence}`}]}}}),Uve=({payload:e})=>({event:e.event,name:e.name,id:e.id,type:e.pageType}),Gve=({payload:e})=>({event:"shop_in_shop_navigation",navigation:"subcategory",name:e.subCategoryName,id:e.id,index:Number(e.sequence),type:"curated"}),$ve={[Ea.SHOP_IN_SHOP_PAGE_VIEW]:Uve,[Ea.HORIZONTAL_HERO_BANNER_IMPRESSION]:wve,[Ea.SUB_CATEGORY_IMAGE_IMPRESSION]:Fve,[Ea.SUB_CATEGORY_IMAGE_CLICKED]:Bve},Hve={[Ea.SUB_CATEGORY_IMAGE_CLICKED]:Gve},ig={SAVED_RECIPES:"SAVED_RECIPES",RECIPE_ASSISTANT:"RECIPE_ASSISTANT"},ap={RECIPE:"RECIPE",RECIPE_COLLECTION:"RECIPE_COLLECTION",RECIPE_HOME_PAGE:"RECIPE_HOME_PAGE"},zl={TEXT:"TEXT",RECIPE_IMPRESSION:"RECIPE_IMPRESSION"},Vve=e=>({hitType:"recipe_shop_for_ingredients_click",id:e.payload.RECIPE_ID,name:e.payload.RECIPE_NAME}),Wve=e=>({hitType:"recipe_ingredients_no_result",id:e.payload.RECIPE_ID,name:e.payload.RECIPE_NAME,search_term:e.payload.SEARCH_TERM,ingredient_name:e.payload.INGREDIENT_NAME}),Yve=e=>({hitType:e.payload.RECIPE_SEARCH_RESULTS_COUNT?"recipe_search":"recipe_search_no_results",search_term:e.payload.RECIPE_SEARCH_TERM}),qve=e=>({hitType:"select_recipe",id:e.payload.RECIPE_ID,name:e.payload.RECIPE_NAME,collection_id:e.payload.RECIPE_COLLECTION_ID,servings:e.payload.SERVINGS,total_time:e.payload.TOTAL_TIME,index:e.payload.INDEX,list:e.payload.LIST}),Kve=e=>{const{RECIPE_ID:t,RECIPE_NAME:n,SEQUENCE:o,LIST:r,TOTAL_TIME:a,SERVES:i}=e.payload;return{event:"select_recipe_card",id:t,name:n,...i&&{servings:i},total_time:a,index:o,list:r}},zve=e=>({hitType:"view_recipe",id:e.payload.RECIPE_ID,name:e.payload.RECIPE_NAME,collection_id:e.payload.RECIPE_COLLECTION_ID,servings:e.payload.SERVINGS,total_time:e.payload.TOTAL_TIME,prep_time:e.payload.PREP_TIME,cooking_time:e.payload.COOK_TIME,metrics:e.payload.METRICS,ingredient_count:e.payload.INGREDIENT_COUNT,step_count:e.payload.STEP_COUNT}),Qve=e=>({hitType:"view_recipe_collection",id:e.payload.RECIPE_COLLECTION_ID,name:e.payload.RECIPE_COLLECTION_NAME,recipe_count:e.payload.RECIPE_COUNT}),Xve=e=>({hitType:"select_recipe_collection",id:e.payload.RECIPE_COLLECTION_ID,name:e.payload.RECIPE_COLLECTION_NAME,recipe_count:e.payload.RECIPE_COUNT,list:e.payload.LIST,index:e.payload.INDEX}),Zve=e=>({hitType:"select_recipe_collection_card",id:e.payload.RECIPE_COLLECTION_ID,name:e.payload.RECIPE_COLLECTION_NAME,index:e.payload.SEQUENCE,list:e.payload.LIST}),Jve=e=>{const{RECIPE_ID:t,RECIPE_NAME:n,SEQUENCE:o,LIST:r,TOTAL_TIME:a,RECIPE_COLLECTION_ID:i,SERVES:l,GROUP_TYPE:c,GROUP_SEQUENCE:d}=e.payload.recipeImpression;return{hitType:"view_recipe_list",id:t,name:n,index:o,list:r,total_time:a,...i&&{collection_id:i},...l&&{servings:l},...c&&{group_type:c},...(d||d===0)&&{group_sequence:d}}},eTe=e=>{const{RECIPE_ID:t,RECIPE_NAME:n,SEQUENCE:o,LIST:r,TOTAL_TIME:a,SERVES:i}=e.payload.recipeImpression;return{event:"view_recipe_card",id:t,name:n,index:o,list:r,total_time:a,...i&&{servings:i}}},tTe=e=>{const{RECIPE_COLLECTION_ID:t,RECIPE_COLLECTION_NAME:n,RECIPE_COUNT:o,SEQUENCE:r,LIST:a,GROUP_TYPE:i,GROUP_SEQUENCE:l}=e.payload.collectionImpression;return{hitType:"view_recipe_collection_list",id:t,name:n,recipe_count:o,list:a,index:r,...i&&{group_type:i},...(l||l===0)&&{group_sequence:l}}},sTe=e=>{const{RECIPE_COLLECTION_ID:t,RECIPE_COLLECTION_NAME:n,SEQUENCE:o,LIST:r}=e.payload.collectionImpression;return{hitType:"view_recipe_collection_card",id:t,name:n,list:r,index:o}},GI={[ap.RECIPE]:"recipe",[ap.RECIPE_COLLECTION]:"recipe-collection",[ap.RECIPE_HOME_PAGE]:"recipe-homepage"},nTe=e=>({event:"select_recipe_homepage_card",type:GI[e.payload.LINK_TYPE],id:e.payload.RECIPE_CARD_ID,name:e.payload.RECIPE_CARD_TITLE,target:e.payload.ENTITY_ID??null,index:e.payload.SEQUENCE}),oTe=e=>({event:"view_recipe_homepage_card",type:GI[e.payload.recipeCardImpression.LINK_TYPE],id:e.payload.recipeCardImpression.RECIPE_CARD_ID,name:e.payload.recipeCardImpression.RECIPE_CARD_TITLE,target:e.payload.recipeCardImpression.ENTITY_ID??null,index:e.payload.recipeCardImpression.SEQUENCE}),rTe=({payload:e})=>({event:"select_recipe_card",id:e.RECIPE_ID,type:"recipe",index:e.INDEX,list:e.LIST}),aTe=({payload:e})=>({event:"view_recipe_card",id:e.RECIPE_ID,type:"recipe",index:e.INDEX,list:e.LIST}),iTe=e=>({event:"save_recipe",id:e.payload.RECIPE_ID,name:e.payload.RECIPE_NAME}),lTe=e=>({event:"remove_saved_recipe",id:e.payload.RECIPE_ID,name:e.payload.RECIPE_NAME}),cTe=()=>({event:"select_navigation",navigation:"View all recipes",target:"/recipes",location:"shop-for-ingredients"}),dTe=e=>({event:"recipe_assistant_message",id:e.payload.CHAT_ID,type:e.payload.MESSAGE_TYPE,origin:e.payload.MESSAGE_FROM,index:e.payload.SEQUENCE}),uTe=()=>({event:"reopen_recipe_assistant"}),pTe=()=>({event:"minimize_recipe_assistant"}),mTe=()=>({event:"open_recipe_assistant"}),RD="SHOP_FOR_INGREDIENTS_CLICKED",DD="RECIPE_CLICKED",HW="RECIPE_ADVERT_CLICKED",OD="RECIPE_ADVERT_IMPRESSION",PD="RECIPE_COLLECTION_ADVERT_CLICKED",ND="RECIPE_COLLECTION_ADVERT_IMPRESSION",dE="RECIPE_IMPRESSION",uE="RECIPE_COLLECTION_IMPRESSION",MC="RECIPE_COLLECTION_CLICKED",VW="RECIPE_SEARCH_INPUT_FOCUS",WW="BROWSE_IN_RECIPE_SEARCH_CLICKED",YW="RECIPES_COLLECTIONS_BROWSE_BUTTON_CLICKED",LD="INGREDIENTS_NO_RESULTS",qW="RECIPES_COLLECTIONS_LOAD_MORE_BUTTON_CLICKED",kD="RECIPE_SEARCH_VIEW",jD="RECIPE_DETAILS_VIEW",MD="RECIPE_COLLECTION_DETAILS_VIEW",wD="HOMEPAGE_RECIPE_CARD_CLICKED",FD="HOMEPAGE_RECIPE_CARD_IMPRESSION",BD="RECIPE_CARD_CLICKED",UD="RECIPE_CARD_IMPRESSION",GD="RECIPE_SAVE_BUTTON_CLICKED",$D="RECIPE_UNSAVE_BUTTON_CLICKED",HD="RECIPE_BROWSE_ALL_BUTTON_CLICKED",VD="RECIPE_BROWSE_ALL_BUTTON_IMPRESSION",KW="SAVED_RECIPES_LOAD_MORE_BUTTON_CLICKED",WD="RECIPE_ASSISTANT_BUTTON_CLICKED",YD="RECIPE_ASSISTANT_RESTART_BUTTON_CLICKED",qD="RECIPE_ASSISTANT_MODAL_MINIMIZE_BUTTON_CLICKED",KD="RECIPE_ASSISTANT_REOPENED",zW="RECIPE_ASSISTANT_FLOWOUT_CLOSED",QW="RECIPE_ASSISTANT_RESTART_CANCELLED",XW="RECIPE_ASSISTANT_RESTART_CONFIRMED",ZW="RECIPE_ASSISTANT_ERROR_MESSAGE_DISPLAYED",JW="RECIPE_ASSISTANT_TRY_AGAIN_BUTTON_CLICKED",vh="RECIPE_ASSISTANT_MESSAGE_DISPLAYED",hTe={[RD]:Vve,[LD]:Wve,[kD]:Yve,[DD]:qve,[HW]:Kve,[jD]:zve,[MC]:Xve,[PD]:Zve,[MD]:Qve,[dE]:Jve,[OD]:eTe,[uE]:tTe,[ND]:sTe,[wD]:nTe,[FD]:oTe,[BD]:rTe,[UD]:aTe,[GD]:iTe,[$D]:lTe,[HD]:cTe,[WD]:mTe,[qD]:pTe,[KD]:uTe,[vh]:dTe},zD="MEALS_VIEW",eY="RECIPES_HOME_MEAL_PLANNING_CLICKED",QD="MEAL_DETAILS_DIALOG_DISPLAYED",gTe="SEARCH_RECIPES_CLICKED",tY="MEAL_CREATE_NEW_DIALOG_DISPLAYED",XD="MEAL_CREATED_SUCCESS",sY="MEAL_PASTE_INGREDIENTS_FROM_CLIPBOARD",nY="MEAL_EDIT_DIALOG_DISPLAYED",ZD="MEAL_EDITED_SUCCESS",oY="MEAL_CANCEL_EDIT_DIALOG_DISPLAYED",rY="MEAL_CANCEL_EDIT_CONFIRMED",aY="MEAL_CREATE_YOUR_FIRST_MEAL_CLICKED",iY="MEAL_DELETE_DIALOG_DISPLAYED",JD="MEAL_DELETE_SUCCESS",ETe=({payload:e})=>({event:"meal_plan_create_meal",id:e.MEAL_ID}),fTe=({payload:e})=>({event:"meal_plan_edit_meal",id:e.MEAL_ID}),yTe=({payload:e})=>({event:"meal_plan_delete_meal",id:e.MEAL_ID}),ITe=({payload:e})=>({event:"meal_plan_view_meal_details",id:e.MEAL_ID}),STe={[XD]:ETe,[ZD]:fTe,[JD]:yTe,[QD]:ITe},CTe="ADD_TO_REGULARS_MODAL_DISPLAYED",vTe="REMOVE_ALL_REGULARS_MODAL_DISPLAYED",TTe="REMOVE_ALL_REGULARS_FROM_BASKET_MODAL_DISPLAYED",_Te="PRODUCT_ADDED_TO_REGULARS",bTe="PRODUCT_REMOVED_FROM_REGULARS",xTe="TOAST_NOTIFICATION_DISPLAYED",ATe="REGULARS_TOTAL_COUNT",RTe="REGULARS_IN_TROLLEY_TOTAL_COUNT",DTe="REGULARS_PARAMETERS_CHANGED",OTe="REMOVE_ALL_REGULARS_FROM_BASKET",PTe="REGULARS_GA_EVENT",NTe="REMOVE_ALL_REGULARS_GA_EVENT",Is={ADD_TO_REGULARS_MODAL_DISPLAYED:CTe,REMOVE_ALL_REGULARS_MODAL_DISPLAYED:vTe,REMOVE_ALL_REGULARS_FROM_BASKET_MODAL_DISPLAYED:TTe,PRODUCT_ADDED_TO_REGULARS:_Te,PRODUCT_REMOVED_FROM_REGULARS:bTe,TOAST_NOTIFICATION_DISPLAYED:xTe,REGULARS_TOTAL_COUNT:ATe,REGULARS_IN_TROLLEY_TOTAL_COUNT:RTe,REGULARS_PARAMETERS_CHANGED:DTe,REMOVE_ALL_REGULARS_FROM_BASKET:OTe,REGULARS_GA_EVENT:PTe,REMOVE_ALL_REGULARS_GA_EVENT:NTe},LTe=e=>({event:e.payload.event,id:e.payload.retailerProductId,name:e.payload.productName,index:e.payload.productIndex,list:e.payload.list,quantity:e.payload.quantity,frequency:e.payload.frequency}),kTe=e=>({event:"remove_all_regulars",count:e.payload.count}),jTe={[Is.REGULARS_GA_EVENT]:LTe,[Is.REMOVE_ALL_REGULARS_GA_EVENT]:kTe},MTe="ADD_DELIVERY_ADDRESS_SELECTED",wTe="BENEFIT_GROUP_SELECTED",FTe="DELIVERY_PASS_PLAN_SEEN",BTe="DELIVERY_PASS_SUBSCRIPTION_STARTED",UTe="DELIVERY_PASS_TERMS_CONDITIONS_CLICKED",GTe="DELIVERY_PASS_BUTTON_CLICKED",$Te="BUY_PLAN_BUTTON_CLICKED",HTe="FREE_TRIAL_BUTTON_CLICKED",VTe="MANAGE_CURRENT_PLAN_BUTTON_CLICKED",WTe="SELECTED_DELIVERY_PASS_PLAN_MODAL_DISPLAYED",YTe="VIEW_ALL_PLANS_BUTTON_CLICKED",qTe="DELIVERY_PASS_SIGN_UP",KTe="DELIVERY_PASS_CANCEL_AUTO_RENEW",zTe="DELIVERY_PASS_ENABLE_AUTO_RENEW",bs={ADD_DELIVERY_ADDRESS_SELECTED:MTe,BENEFIT_GROUP_SELECTED:wTe,DELIVERY_PASS_PLAN_SEEN:FTe,DELIVERY_PASS_SUBSCRIPTION_STARTED:BTe,DELIVERY_PASS_TERMS_CONDITIONS_CLICKED:UTe,VIEW_ALL_PLANS_BUTTON_CLICKED:YTe,DELIVERY_PASS_BUTTON_CLICKED:GTe,BUY_PLAN_BUTTON_CLICKED:$Te,FREE_TRIAL_BUTTON_CLICKED:HTe,MANAGE_CURRENT_PLAN_BUTTON_CLICKED:VTe,SELECTED_DELIVERY_PASS_PLAN_MODAL_DISPLAYED:WTe,DELIVERY_PASS_SIGN_UP:qTe,DELIVERY_PASS_CANCEL_AUTO_RENEW:KTe,DELIVERY_PASS_ENABLE_AUTO_RENEW:zTe};function eO(e,t){const{retailerSubscriptionPlanId:n,price:o,currency:r}=t;return{event:e,id:n,price:o,currency:r}}const QTe=e=>eO("delivery_pass_sign_up",e.payload),XTe=e=>eO("delivery_pass_cancel_auto_renew",e.payload),ZTe=e=>eO("delivery_pass_enable_auto_renew",e.payload),JTe={[bs.DELIVERY_PASS_SIGN_UP]:QTe,[bs.DELIVERY_PASS_CANCEL_AUTO_RENEW]:XTe,[bs.DELIVERY_PASS_ENABLE_AUTO_RENEW]:ZTe},e_e="GA_ADD_TO_WISHLIST",t_e="GA_REMOVE_FROM_WISHLIST",s_e="GA_CREATE_LIST",n_e="GA_DELETE_LIST",Ci={GA_ADD_TO_WISHLIST:e_e,GA_REMOVE_FROM_WISHLIST:t_e,GA_CREATE_LIST:s_e,GA_DELETE_LIST:n_e},o_e=e=>({event:"add_to_wishlist",type:e.payload.eventType,ecommerce:e.payload.ecommerce}),r_e=e=>({event:"remove_from_wishlist",type:e.payload.eventType,id:e.payload.id,name:e.payload.name,index:e.payload.index,quantity:e.payload.quantity,list:e.payload.list}),a_e=e=>({event:e.payload.event}),i_e=e=>({event:e.payload.event}),l_e={[Ci.GA_ADD_TO_WISHLIST]:o_e,[Ci.GA_REMOVE_FROM_WISHLIST]:r_e,[Ci.GA_CREATE_LIST]:a_e,[Ci.GA_DELETE_LIST]:i_e},c_e=({payload:e})=>({event:"view_coupon",id:e.id,name:e.name,index:e.index}),d_e=({payload:e})=>({event:"select_coupon",id:e.id,name:e.name,index:e.index}),en={ONBOARDING_CARD_CLOSED:"ONBOARDING_CARD_CLOSED",LEARN_MORE_BUTTON_CLICKED:"LEARN_MORE_BUTTON_CLICKED",COUPON_ONBOARDING_CARD_IMPRESSION:"COUPON_ONBOARDING_CARD_IMPRESSION",LEARN_MORE_BUTTON_IMPRESSION:"LEARN_MORE_BUTTON_IMPRESSION",PROMOTIONS_TAB_CLICKED:"PROMOTIONS_TAB_CLICKED",EMPTY_COUPONS_PROMO_BUTTON_CLICKED:"EMPTY_COUPONS_PROMO_BUTTON_CLICKED",COUPON_CLICKED:"COUPON_CLICKED",COUPON_IMPRESSION:"COUPON_IMPRESSION",COUPONS_AVAILABLE:"COUPONS_AVAILABLE",GA4_COUPON_IMPRESSION:"GA4_COUPON_IMPRESSION",GA4_COUPON_CLICKED:"GA4_COUPON_CLICKED"},u_e={[en.GA4_COUPON_CLICKED]:d_e,[en.GA4_COUPON_IMPRESSION]:c_e},p_e=e=>{const{payload:{index:t,name:n,currency:o,value:r,transactionId:a,groupId:i}}=e;return{event:"checkout_walk",index:t??null,name:n??null,currency:o,value:r?Number(r):null,osp_transaction_id:a,group_id:i}},m_e={[Zn.CHECKOUT_WALK_GA4]:p_e},h_e="quick-view-trolley",lY=e=>typeof e.quantity=="object"&&e.quantity?.quantityInBasket||typeof e.quantity!="object"&&e.quantity||e.quantityInBasket||e.addedAmount||0,g_e=e=>!!(e.available&&!e.maxQuantityReached),E_e=e=>e?.offers?.filter(t=>t.retailerPromotionId)?.map(t=>t.retailerPromotionId).join(","),cY=(e,t=15)=>{function*n(o,r){for(let a=0;a<o.length;a+=r)yield o.slice(a,a+r)}return[...n(e,t)]},f_e=e=>e.reduce((t,n)=>{const o=lY(n),r=n?.price?.current?.amount??0;return t+Number(r)*o},0),dY=e=>{const{position:t,product:n,productListName:o,event:r,page:a,section:i,meta:l,featuredProductCampaigns:c}=e;return n.map(d=>{const u=Vn(d,c),p=!!d?.offers?.length,g=E_e(d),E=d?.price?.current?.amount,y=d?.ratingSummary?.overallRating,I=o||ks(a,"",i||""),S=Ld(I),{campaignId:C=null,campaignName:T=null}=u||{},_={item_id:d.retailerProductId||null,item_name:d?.name||null,index:t??null,item_brand:d?.brand||null,hfss_display_restriction_group:d?.hfssDisplayRestrictionGroup||null,item_list_name:I,item_variant:d?.size?.value||null,price:E?Number(E):null,rating:y?Number(y):null,quantity:lY(d)||null,is_on_promotion:p,is_favorite:!!d?.favorite,is_featured:S&&!!u,featured_campaign_id:S?C:null,featured_campaign_name:S?T:null,promotion_ids:p&&g?g:null,...Pl(d?.categoryPath??[]),seller_id:d.seller?.id||null};if(r!=="add_to_cart"){const A={..._,can_add_to_cart:g_e(d)};return r==="view_cart"?Rc({productId:d.productId,item:A,meta:l}):A}return _})},jF=e=>(t,n)=>{const{payload:{addedByFunction:o,basket:r,product:a,productListName:i,position:l,page:c,section:d}}=t,u=r?.totals?.display?.itemPriceAfterPromos?.amount||null,p=cY(a),g=Qs(n);return p.map(E=>{const y=f_e(E);return{event:e,ecommerce:{currency:a[0]?.price?.current?.currency||null,cart_value:u?Number(u):null,cart_update_value:null,value:y,osp_transaction_id:r?.orderId||null,items:dY({event:e,product:E,position:l,productListName:i,page:c,section:d,featuredProductCampaigns:g})},cart_function:o}})},y_e=(e,t)=>{const{payload:n}=e,o=Qs(t);return cY(n.products).map(a=>({event:"view_cart",type:n.cartType,ecommerce:{currency:n.currencyCode||null,cart_value:n.total?Number(n.total):null,osp_transaction_id:n.orderId??null,group_id:n.groupId||null,items:dY({event:"view_cart",product:a,position:n.position,productListName:ks(n.page,"",n.cartType==="expanded"?h_e:""),page:n.page,meta:n.meta,featuredProductCampaigns:o})}}))},I_e=e=>{const t=e?.payload?.prevOrderId,n=e?.payload?.nextOrderId;return{event:"merge_cart",type:"edit-merge",previous_transaction_id:t,osp_transaction_id:n}},MF=e=>t=>({event:e,order_id:t.payload.orderId}),S_e=()=>({event:"view_cart_checkout"}),C_e=()=>({event:"view_cart_book_slot"}),v_e={[Re.ADD_TO_CART_GA4]:jF("add_to_cart"),[Re.REMOVE_BASKET_ITEM]:jF("remove_from_cart"),[Re.VIEW_CART]:y_e,[Re.MERGE_CART]:I_e,[Re.CHECKOUT_ORDER_BUTTON_CLICKED]:MF("cart_checkout"),[Re.CHECKOUT_ORDER_BUTTON_VIEWED]:S_e,[Re.BOOK_SLOT_BUTTON_CLICKED]:MF("cart_book_slot"),[Re.BOOK_SLOT_BUTTON_VIEWED]:C_e},T_e={...je,fetchError:!1,isFetching:!1,error:null,customerSegments:[{name:"segment_list_01",shortCodes:null}]},__e=(e=T_e,t)=>{switch(t.type){case"GET_CUSTOMER_SEGMENTS_PENDING":return{...e,isFetching:!0,fetchError:!1};case"GET_CUSTOMER_SEGMENTS_SUCCESS":return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),customerSegments:t.payload.responseData};case"GET_CUSTOMER_SEGMENTS_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};default:return e}},tO=({data:e})=>e.customer.segments,b_e=(e,t,n)=>{const o=Ra(n)?.amount,r=Ol(n),{pagePartType:a}=e.payload;return{event:"page_view",session_id:_c(t)||null,page_view_id:Nn(n)||null,page_type:a||Vp(window.location,n)||null,customer_id:ei(t)||null,osp_transaction_id:Ct(n)||null,transaction_type:Ar(n)?"edit":"new",region_id:sa(t)||null,banner_id:yC(t)||null,region_name:xR(t)||null,banner_name:Zd(t)||null,cart_value:o?Number(o):null,customer_email:r.data.email||null,customer_first_name:r.data["attr.firstName"]||null,customer_last_name:r.data["attr.surname"]||null,is_logged_in:!!Xe(n)}},x_e=e=>({event:"select_navigation",name:e.payload.name,location:e.payload.location}),A_e=(e,t,n)=>{if(!D("seg.dl")(t)||!Xe(n))return{};const{customerSegments:r}=tO(n);return{event:"active_segments",...(r||[]).reduce((i,l)=>({...i,[l.name]:l.shortCodes}),{})}},R_e="PAGE_ATTRIBUTES_MULTIPLE",D_e="SELECT_NAVIGATION",Ds={PAGE_ATTRIBUTES_MULTIPLE:R_e,SELECT_NAVIGATION:D_e},em=(...e)=>(...t)=>e.map(n=>n(...t)),O_e={[Pn]:em(b_e,A_e),[Ds.SELECT_NAVIGATION]:x_e},wF=e=>t=>{const{payload:{loyaltyAmount:n,transactionId:o,groupId:r}}=t;return{event:e,osp_transaction_id:o||null,loyalty_amount:n,group_id:r}},$I={USE_LOYALTY:"USE_LOYALTY",REMOVE_LOYALTY:"REMOVE_LOYALTY"},P_e={[$I.USE_LOYALTY]:wF("use_loyalty"),[$I.REMOVE_LOYALTY]:wF("remove_loyalty")},N_e="SKIPPED_ADDRESS_SELECTION",L_e="C_N_C_GEOLOCATION_EVENT",k_e="C_N_C_ADDRESS_SEARCH_TERM",j_e="C_N_C_ADDRESS_SEARCH_FOCUS",M_e="C_N_C_ADDRESS_SELECT",w_e="C_N_C_ADDRESS_PIN_CLICK",F_e="C_N_C_HOME_DELIVERY_TAB_CLICKED",B_e="DELIVERY_DESTINATION_HEADER_CLICKED",U_e="HOMEPAGE_DELIVERY_DESTINATION_CARD_CLICKED",G_e="CHANGE_ADDRESS_BUTTON_CLICKED",$_e="DELIVERY_DESTINATION_MODAL_CLOSED",H_e="DELIVERY_DESTINATIONS_SELECTOR_SEARCH_FOCUS",V_e="DELIVERY_DESTINATIONS_SELECTOR_GEOLOCATION_EVENT",W_e="SELECT_DELIVERY_DESTINATION",Y_e="DELIVERY_OPTION_MODAL_TRIGGERED",q_e="HOMEPAGE_BOX_DDS_IMPRESSION",Ns={SKIPPED_ADDRESS_SELECTION:N_e,C_N_C_GEOLOCATION_EVENT:L_e,C_N_C_ADDRESS_SEARCH_TERM:k_e,C_N_C_ADDRESS_SEARCH_FOCUS:j_e,C_N_C_ADDRESS_SELECT:M_e,C_N_C_ADDRESS_PIN_CLICK:w_e,C_N_C_HOME_DELIVERY_TAB_CLICKED:F_e,HOMEPAGE_DELIVERY_DESTINATION_CARD_CLICKED:U_e,DELIVERY_DESTINATION_HEADER_CLICKED:B_e,CHANGE_ADDRESS_BUTTON_CLICKED:G_e,DELIVERY_DESTINATION_MODAL_CLOSED:$_e,DELIVERY_DESTINATIONS_SELECTOR_SEARCH_FOCUS:H_e,DELIVERY_DESTINATIONS_SELECTOR_GEOLOCATION_EVENT:V_e,SELECT_DELIVERY_DESTINATION:W_e,DELIVERY_OPTION_MODAL_TRIGGERED:Y_e,HOMEPAGE_BOX_DDS_IMPRESSION:q_e},K_e={CUSTOMER_COLLECTION:"click_and_collect",HOME_DELIVERY:"home_delivery"},z_e=e=>{const{payload:{deliveryMethod:t,groupId:n}}=e;return{event:"select_delivery_destination",method:K_e[t],group_id:n}},uY={HOMEPAGE_BOX_CLICKED:"homebox",HEADER_CLICKED:"header",MORE_CLICKED:"menu",HOMEPAGE_CARD_CLICKED:"homepage-card"},Q_e=e=>{const t=uY[e.payload.userAction];return t?{event:"select_navigation",name:"delivery-destination",location:t}:null},X_e={[Ns.SELECT_DELIVERY_DESTINATION]:z_e,[Ns.DELIVERY_OPTION_MODAL_TRIGGERED]:Q_e},FF=e=>t=>{const{payload:{transactionId:n,voucherCode:o,groupId:r}}=t;return{event:e,id:o||null,osp_transaction_id:n||null,group_id:r}},HI={USE_PROMOTION_CODE:"USE_PROMOTION_CODE",REMOVE_PROMOTION_CODE:"REMOVE_PROMOTION_CODE"},Z_e={[HI.USE_PROMOTION_CODE]:FF("use_promotion_code"),[HI.REMOVE_PROMOTION_CODE]:FF("remove_promotion_code")},J_e="CONFIRM_REQUEST_BUTTON_CLICKED",ebe="REFUND_REQUEST_ITEM_CANCELLED",tbe="REFUND_REQUEST_ITEM_SELECTED",sbe="REQUEST_REFUND_BUTTON_CLICKED",nbe="REQUEST_REFUND_GA4",vi={CONFIRM_REQUEST_BUTTON_CLICKED:J_e,REFUND_REQUEST_ITEM_CANCELLED:ebe,REFUND_REQUEST_ITEM_SELECTED:tbe,REQUEST_REFUND_BUTTON_CLICKED:sbe,REQUEST_REFUND_GA4:nbe},pY=e=>{const{payload:{refundTotal:t,requestedItems:n,orderId:o}}=e,r=n.map(i=>({item_id:i?.retailerProductId||null,item_name:i?.productName||null,quantity:i?.requestedQuantity||null,refund_reason:i?.refundReasonDescription||null,seller_id:i?.sellerId||null})),a=de();return{event:"refund",ecommerce:{osp_transaction_id:o||null,transaction_id:`${o}-${a}`,value:t?.amount?Number(t.amount):null,currency:t?.currency||null,items:r}}},obe={[vi.REQUEST_REFUND_GA4]:pY},mY=e=>e.map(t=>t.id).join(", "),hY=e=>Object.keys(e).reduce((n,o)=>{if(o==="delivery"||o==="deliveryPromotions")return n;const r=e[o];return r?.amount?n+Number(r.amount):n},0),gY=(e,t)=>{const n=Vt(e),o=Vt(t);return{slot_start_time:n.format($n),slot_end_time:o.format($n),slot_date:n.format(Ta),slot_day:n.isoWeekday()}},rbe=e=>{const{orderId:t,state:n,meta:o}=e,r=Ki(n,t),a=ts(n),i=Qs(n),{orderTotals:l,charges:c,items:d,loyalty:u,appliedVouchers:p,deliveryMethod:g,dates:E}=r,{currency:y,amount:I}=l.totalPrice,{amount:S}=l.finalPrice,{components:C}=l.taxesTotals.taxes,{amount:T}=c.delivery,_=C.reduce((H,K)=>H+Number(K?.taxAmount?.amount??0),0),A=or(n),R=u?.spent?.money.amount,P=mY(p),N=hY(c),{slot_day:k,slot_start_time:M,slot_end_time:w,slot_date:j}=gY(E.deliveryStartDate,E.deliveryEndDate),G=d.map(H=>{const{product:K,quantity:X}=H,q=a[K],ne=Vn(q,i),ue=!!q?.offers?.length,oe=q?.offers?.map(Fe=>Fe.retailerPromotionId).join(","),ye=q?.price?.current.amount,he=q?.ratingSummary?.overallRating,Ie={item_id:q?.retailerProductId||null,item_name:q?.name||null,index:null,item_brand:q?.brand||null,hfss_display_restriction_group:q?.hfssDisplayRestrictionGroup||null,item_list_name:ks("order","details",""),item_variant:q?.size?.value.toString()||null,price:ye?Number(ye):null,rating:he?Number(he):null,quantity:X?-Number(X):null,is_on_promotion:ue,promotion_ids:ue&&oe?oe:null,is_favorite:!!q?.favorite,is_featured:!!ne,featured_campaign_id:ne?.campaignId||null,featured_campaign_name:ne?.campaignName||null,...Pl(q?.categoryPath??[]),seller_id:q?.seller?.id||null};return Rc({productId:K,item:Ie,meta:o})});return{event:"purchase",fulfillment_method:{CUSTOMER_COLLECTION:"click_and_collect",HOME_DELIVERY:"home_delivery"}[g],slot_day:k,slot_date:j,slot_end_time:w,slot_start_time:M,ecommerce:{osp_transaction_id:t||null,group_id:A,transaction_type:"cancel-order",transaction_id:`${t}-${de()}`,value:S?-Number(S):null,total_value:I?-Number(I):null,tax:_?-Number(_):null,shipping:T?-Number(T):null,currency:y||null,loyalty:R?-Number(R):null,coupon:P.length?P:null,charges:N?-N:null,items:G}}},abe=e=>({event:"edit_order",osp_transaction_id:e.payload.orderId||null,group_id:e.payload.groupId||null}),ibe=e=>{const{payload:{orderId:t,state:n,meta:o}}=e,r=Ki(n,t),a=ts(n),i=Qs(n),{orderTotals:l,charges:c,items:d,loyalty:u,appliedVouchers:p,deliveryMethod:g,dates:E}=r,{currency:y,amount:I}=l.totalPrice,{amount:S}=l.finalPrice,{components:C}=l.taxesTotals.taxes,{amount:T}=c.delivery,_=C.reduce((H,K)=>H+Number(K?.taxAmount?.amount??0),0),A=or(n),R=u?.spent?.money.amount,P=mY(p),N=hY(c),{slot_day:k,slot_start_time:M,slot_end_time:w,slot_date:j}=gY(E.deliveryStartDate,E.deliveryEndDate),G=d.map(H=>{const{product:K,quantity:X}=H,q=a[K],ne=Vn(q,i),ue=!!q?.offers?.length,oe=q?.offers?.map(Fe=>Fe.retailerPromotionId).join(","),ye=q?.price?.current.amount,he=q?.ratingSummary?.overallRating,Ie={item_id:q?.retailerProductId||null,item_name:q?.name||null,index:null,item_brand:q?.brand||null,hfss_display_restriction_group:q?.hfssDisplayRestrictionGroup||null,item_list_name:ks("order","details",""),item_variant:q?.size?.value||null,price:ye?Number(ye):null,rating:he?Number(he):null,quantity:X?-Number(X):null,is_on_promotion:ue,promotion_ids:ue&&oe?oe:null,is_favorite:!!q?.favorite,is_featured:!!ne,featured_campaign_id:ne?.campaignId||null,featured_campaign_name:ne?.campaignName||null,...Pl(q?.categoryPath??[]),seller_id:q?.seller?.id||null};return Rc({productId:K,item:Ie,meta:o})});return{event:"purchase",fulfillment_method:{CUSTOMER_COLLECTION:"click_and_collect",HOME_DELIVERY:"home_delivery"}[g],slot_day:k,slot_date:j,slot_end_time:w,slot_start_time:M,ecommerce:{osp_transaction_id:t||null,group_id:A,transaction_type:"cancel-order",transaction_id:`${t}-${de()}`,value:S?-Number(S):null,total_value:I?-Number(I):null,tax:_?-Number(_):null,shipping:T?-Number(T):null,currency:y||null,loyalty:R?-Number(R):null,coupon:P.length?P:null,charges:N?-N:null,items:G}}},lbe={[Gs.EDIT_ORDER_GA4]:abe,[Gs.ORDER_CANCELLED_GA4]:ibe},cbe="SLOT_IMPRESSION",dbe="ALERT_IMPRESSION",ube="SLOT_BOOKING_MODAL_DISPLAYED",pbe="SLOT_BOOKED",mbe="GA4_SLOT_BOOKED",EY="ADDRESS_SELECTION_DROP_DOWN_CLICKED",fY="ADDRESS_FROM_DROP_DOWN_SELECTED",yY="COLLECTION_POINT_FROM_DROP_DOWN_SELECTED",IY="CHOOSE_DIFFERENT_COLLECTION_POINT_BUTTON_CLICKED",hbe="SELECT_FULFILLMENT_LOCATION",SY="ITEM_WINDOW_EXPANDED",CY="ITEM_WINDOW_REDUCED",vY="STANDARD_SLOTS_BUTTON_CLICKED",TY="SAVER_SLOTS_BUTTON_CLICKED",gbe="MAP_RENDERED_REASON",_Y="CARRIER_SELECTION_CLICKED",bY="CONTINUE_CHECKOUT_BUTTON_CLICKED",xY="CHOOSE_CARRIER_MODAL_DISPLAYED",AY="SELECT_PICK_UP_POINT_BUTTON_CLICKED",Ebe="CARRIER_SELECTION_CARD_IMPRESSION",RY="SHIPPING_METHOD_NOT_VALID_MODAL_DISPLAYED",DY="SELECT_SHIPPING_METHOD_BUTTON_CLICKED",OY="CHANGE_DELIVERY_METHOD_MODAL_DISPLAYED",PY="CONTINUE_AND_SEE_TROLLEY_BUTTON_CLICKED",NY="CHANGE_DELIVERY_METHOD_CANCEL_BUTTON_CLICKED",LY="EXTERNAL_COLLECTION_POINT_SELECT_BUTTON_CLICKED",kY="DELIVERY_DETAILS_MODAL_DISPLAYED",fbe="DELIVERY_OPTIONS_VIEWED",jY="DELIVERY_ASSET_CHANGED",ybe="SEASONAL_SLOTS_BANNER_IMPRESSION",MY="SEASONAL_SLOTS_BANNER_CLICKED",Ibe="SLOTBOOKING_NO_SAVED_ADDRESS_DISPLAYED",Sbe="CALENDAR_CLICKED",Cbe="CALENDAR_DATE_SELECTED",Ve={SLOT_IMPRESSION:cbe,ALERT_IMPRESSION:dbe,SLOT_BOOKING_MODAL_DISPLAYED:ube,SLOT_BOOKED:pbe,GA4_SLOT_BOOKED:mbe,ADDRESS_SELECTION_DROP_DOWN_CLICKED:EY,ADDRESS_FROM_DROP_DOWN_SELECTED:fY,COLLECTION_POINT_FROM_DROP_DOWN_SELECTED:yY,CHOOSE_DIFFERENT_COLLECTION_POINT_BUTTON_CLICKED:IY,SELECT_FULFILLMENT_LOCATION:hbe,ITEM_WINDOW_REDUCED:CY,ITEM_WINDOW_EXPANDED:SY,STANDARD_SLOTS_BUTTON_CLICKED:vY,SAVER_SLOTS_BUTTON_CLICKED:TY,MAP_RENDERED_REASON:gbe,CARRIER_SELECTION_CLICKED:_Y,CONTINUE_CHECKOUT_BUTTON_CLICKED:bY,CHOOSE_CARRIER_MODAL_DISPLAYED:xY,SELECT_PICK_UP_POINT_BUTTON_CLICKED:AY,CARRIER_SELECTION_CARD_IMPRESSION:Ebe,SHIPPING_METHOD_NOT_VALID_MODAL_DISPLAYED:RY,SELECT_SHIPPING_METHOD_BUTTON_CLICKED:DY,CHANGE_DELIVERY_METHOD_MODAL_DISPLAYED:OY,CONTINUE_AND_SEE_TROLLEY_BUTTON_CLICKED:PY,CHANGE_DELIVERY_METHOD_CANCEL_BUTTON_CLICKED:NY,EXTERNAL_COLLECTION_POINT_SELECT_BUTTON_CLICKED:LY,DELIVERY_DETAILS_MODAL_DISPLAYED:kY,DELIVERY_OPTIONS_VIEWED:fbe,DELIVERY_ASSET_CHANGED:jY,SEASONAL_SLOTS_BANNER_IMPRESSION:ybe,SEASONAL_SLOTS_BANNER_CLICKED:MY,SLOTBOOKING_NO_SAVED_ADDRESS_DISPLAYED:Ibe,CALENDAR_CLICKED_EVENT:Sbe,CALENDAR_DATE_SELECTED_EVENT:Cbe},Wr={[fY]:"User selected an address from the address drop-down",[yY]:"User selected a different collection point from the collection point drop-down",[EY]:"User clicked on address selection drop down",[IY]:"User clicked the 'Choose a different collection point' button",[CY]:"The user reduced the product images",[SY]:"The user expanded the product images to see all",[vY]:"User clicked standard slots button",[TY]:"User clicked saver slots button",[_Y]:"User clicked carrier option",[bY]:"User clicked continue_checkout button for a selected carrier",[xY]:"User clicked on show_all_carriers button",[AY]:"User clicked select_pick_up_point button in the customer collection view",[RY]:"Shipping method not valid modal displayed",[DY]:"User clicked select_shipping_method_button",[OY]:"Change delivery method modal displayed when user changed the address and some items might not be available",[PY]:"User clicked continue_and_see_trolley button on the change_delivery_method modal",[NY]:"User clicked cancel button on the change_delivery_method modal",[LY]:"User clicked select_external_collection_point button",[kY]:"A delivery details modal was displayed",[jY]:"Delivery asset was changed from packaging card",[MY]:"User clicked on the seasonal slots banner action button"},lg={CUSTOMER_COLLECTION:"click_and_collect",HOME_DELIVERY:"home_delivery"},vbe=e=>{const{payload:{deliveryMethod:t,deliveryDestinationId:n}}=e;return{event:"select_fulfillment_location",method:lg[t],fulfillment_location_id:n}},Tbe=(e,t)=>{const{slot:n}=e.payload,o=Ct(t)??"",r=or(t),a=Vt(n.startTime),i=Vt(n.endTime),l=()=>n.type==="ON_DEMAND"?{}:{slot_start_time:a.format($n),slot_end_time:i.format($n)};return{event:"slot_booked",method:lg[n.deliveryMethod],osp_transaction_id:o,group_id:r,...l(),slot_date:a.format(Ta),slot_day:a.isoWeekday(),slot_type:n.type,slot_price:parseFloat(e.deliveryPrice.amount),site_id:""}},_be={[Ve.SELECT_FULFILLMENT_LOCATION]:vbe,[Ve.GA4_SLOT_BOOKED]:Tbe},bbe=e=>{const{ENTRY_ID:t,ENTRY_NAME:n,TYPE:o}=e.payload;return{event:"view_componentized_homepage",name:n,id:t,type:o}},xbe="HOMEPAGE_SLOT_BOOKING_CARD_CLICKED",Abe="HOME_CARD_IMPRESSION",Rbe="HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED",Dbe="MULTIPLE_UPCOMING_ORDERS_CARD_CLICKED",Obe="HOMEPAGE_ADD_FUNCTION_CARD_CLICKED",Pbe="HOMEPAGE_COMPONENTIZED_AREA_IMPRESSION",Nbe="PRODUCT_CLUSTERS_FILTER_CLICKED",Lbe="PRODUCT_CLUSTERS_FILTERS_IMPRESSION",Xt={HOMEPAGE_SLOT_BOOKING_CARD_CLICKED:xbe,HOME_CARD_IMPRESSION:Abe,HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED:Rbe,MULTIPLE_UPCOMING_ORDERS_CARD_CLICKED:Dbe,HOMEPAGE_ADD_FUNCTION_CARD_CLICKED:Obe,HOMEPAGE_COMPONENTIZED_AREA_IMPRESSION:Pbe,PRODUCT_CLUSTERS_FILTER_CLICKED:Nbe,PRODUCT_CLUSTERS_FILTERS_IMPRESSION:Lbe},kbe={[Xt.HOMEPAGE_COMPONENTIZED_AREA_IMPRESSION]:bbe},wC=e=>{if(!e)return null;const{unit:t,value:n}=e;return`every_${n}_${t.toLowerCase()}`},FC=e=>e.dayOfWeekIso?Number(e.dayOfWeekIso):e.day?ya().day(e.day).isoWeekday():null,wY=e=>t=>{const{payload:{recurringOrderType:n,recurringShoppingDefinition:o}}=t;return{event:e,frequency:wC(o.frequency),type:n,slot_day:FC(o.deliveryWindow),slot_start_time:o.deliveryWindow?.from||null,slot_end_time:o.deliveryWindow?.to||null}},jbe=e=>wY("recurring_order_creation")(e),Mbe=e=>wY("recurring_order_cancellation")(e),wbe="RECURRING_ORDER_CARD_CLICKED",Fbe="RECURRING_ORDER_CANCEL_MODAL_EVENT",Bbe="PLACEHOLDER_RECURRING_ORDER_DETAILS_CANCEL_MODAL_EVENT",Ube="RECURRING_ORDER_CREATED_GA4_EVENT",Gbe="RECURRING_ORDER_CANCELED_GA4_EVENT",$be="MANAGE_RECURRING_ORDER_BUTTON_CLICKED",Hbe="EDIT_PAYMENT_BUTTON_CLICKED",Vbe="CANCEL_RECURRING_ORDER_BUTTON_CLICKED",Wbe="CANCEL_SELECTED_RECURRING_ORDERS_BUTTON_CLICKED",Ybe="CHECKBOX_FOR_UPCOMING_RECURRING_ORDERS_CLICKED",qbe="CLEAR_SELECTED_BUTTON_CLICKED",Kbe="CHOOSE_PAYMENT_METHOD_MODAL_DISPLAYED",zbe="CONFIRM_RECURRING_ORDER_CANCELLATION_MODAL_DISPLAYED",Qbe="CONFIRMED_RECURRING_ORDER_CANCEL_MODAL",Xbe="NO_BUTTON_CLICKED",Zbe="RECURRING_ORDER_DAY_AND_TIME_MODAL_DISPLAYED",Jbe="RECURRING_ORDER_TIME_REJECTED_FROM_DROPDOWN",exe="RECURRING_ORDER_DAY_AND_TIME_SAVED",txe="RECURRING_ORDER_DAY_AND_TIME_MODAL_CLOSED",mt={RECURRING_ORDER_CARD_CLICKED:wbe,RECURRING_ORDER_CANCEL_MODAL_EVENT:Fbe,PLACEHOLDER_RECURRING_ORDER_DETAILS_CANCEL_MODAL_EVENT:Bbe,MANAGE_RECURRING_ORDER_BUTTON_CLICKED:$be,RECURRING_ORDER_CREATED_GA4_EVENT:Ube,RECURRING_ORDER_CANCELED_GA4_EVENT:Gbe,EDIT_PAYMENT_BUTTON_CLICKED:Hbe,CANCEL_RECURRING_ORDER_BUTTON_CLICKED:Vbe,CANCEL_SELECTED_RECURRING_ORDERS_BUTTON_CLICKED:Wbe,CHECKBOX_FOR_UPCOMING_RECURRING_ORDERS_CLICKED:Ybe,CLEAR_SELECTED_BUTTON_CLICKED:qbe,CHOOSE_PAYMENT_METHOD_MODAL_DISPLAYED:Kbe,CONFIRM_RECURRING_ORDER_CANCELLATION_MODAL_DISPLAYED:zbe,CONFIRMED_RECURRING_ORDER_CANCEL_MODAL:Qbe,NO_BUTTON_CLICKED:Xbe,RECURRING_ORDER_DAY_AND_TIME_MODAL_DISPLAYED:Zbe,RECURRING_ORDER_TIME_REJECTED_FROM_DROPDOWN:Jbe,RECURRING_ORDER_DAY_AND_TIME_SAVED:exe,RECURRING_ORDER_DAY_AND_TIME_MODAL_CLOSED:txe},sxe={[mt.RECURRING_ORDER_CREATED_GA4_EVENT]:jbe,[mt.RECURRING_ORDER_CANCELED_GA4_EVENT]:Mbe},Va={PROMOTIONS_NO_RESULTS:"PROMOTIONS_NO_RESULTS",COMBO_PROMO_COMPLETED:"COMBO_PROMO_COMPLETED",COMBO_PROMO_ACCORDION_EXPANDED:"COMBO_PROMO_ACCORDION_EXPANDED",COMBO_PROMO_ACCORDION_COLLAPSED:"COMBO_PROMO_ACCORDION_COLLAPSED",COUPONS_TAB_CLICKED:"COUPONS_TAB_CLICKED",VIEW_PROMOTION_DETAILS:"VIEW_PROMOTION_DETAILS"},nxe={[Va.VIEW_PROMOTION_DETAILS]:BEe},oxe="CONTENT_BLOCK_CLICKED",rxe="CONTENT_BLOCK_IMPRESSION",axe="CONTENT_BLOCK_CLOSE_BUTTON_CLICKED",fa={CONTENT_BLOCK_CLICKED:oxe,CONTENT_BLOCK_IMPRESSION:rxe,CONTENT_BLOCK_CLOSE_BUTTON_CLICKED:axe},ixe=({payload:e})=>({event:"content_block_navigation",name:e.entryName,id:e.entryId,link_type:e.linkType,target:e.targetUrl}),lxe={[fa.CONTENT_BLOCK_CLICKED]:ixe},cxe={[Pn]:Ux,[EC]:Ux},dxe=[XSe],uxe=[...dxe,cxe,_Ee,FEe,JEe,zEe,pfe,mfe,Ofe,Pfe,v_e,wfe,Sye,Rye,Dye,uIe,$Se,$ye,m_e,zSe,tCe,sCe,ACe,OCe,BCe,jCe,WCe,KCe,O_e,yve,Cve,Ave,Mve,Hve,$ve,hTe,STe,jTe,l_e,JTe,u_e,P_e,Z_e,X_e,obe,lbe,_be,lxe,sxe,nxe,kbe,ZEe],pxe=uxe.reduce((e,t)=>(Object.keys(t).forEach(n=>{e[n]=e[n]?em(e[n],t[n]):t[n]}),e),{}),mxe=e=>{const t=D("al")(e.getState());return n=>o=>uH.createMiddleware(pxe,r=>{if(Qde(r,e),!t)return tce()(r)})(e)(n)(o)},hxe=D("wa.log.err"),gxe=D("beacon");class Exe{#e=null;constructor(){this.eventPromises=[],this.resolveEventPromises=this.resolveEventPromises.bind(this),this.sendEventPromise=this.sendEventPromise.bind(this),this.sendEvent=this.sendEvent.bind(this),this.sendEventBeacon=this.sendEventBeacon.bind(this),this.dispatchEvents=this.dispatchEvents.bind(this),this.handleFailedEvent=this.handleSentEvent.bind(this),this.handleBeaconApiEventEnabled=this.handleBeaconApiEventEnabled.bind(this),document.readyState!=="complete"&&window.addEventListener("load",this.resolveEventPromises)}set getState(t){this.#e=t}get state(){return this.#e?this.#e():null}isBasketQuantityUpdateEventV5=t=>!!t?.basketQuantityUpdateEventV5;getBasketQuantityUpdateEventV5EmptyFields=t=>{const n=["retailerProductId","updateQuantity"];return this.isBasketQuantityUpdateEventV5(t)?n.filter(o=>!t?.basketQuantityUpdateEventV5?.[o]):[]};handleBeaconApiEventEnabled(){const{state:t}=this;return!!t&&gxe(t)}handleSentEvent({responseHeaders:t,body:n,responseCode:o,responseData:r,errorData:a,locationPrev:i}){const{state:l}=this;if(!hxe(l))return;const c=this.getBasketQuantityUpdateEventV5EmptyFields(n);c?.length&&Ue.api.pushError(new Error(`WebAnalytics: basketQuantityUpdateEventV5 empty fields (${c.join(",")})`),{context:{requestBody:JSON.stringify(n),...o&&{responseCode:o},...r&&{responseData:r},...t&&{responseHeaders:t},...a&&{errorData:a},locationPrev:i,locationNext:window.location.href}})}sendEventPromise({targetUrl:t,body:n}){const o=window.location.href;return fetch(`${t}/v1/event`,{body:JSON.stringify(n),headers:{"Content-Type":"application/json",Accept:"text/plain, */*; q=0.01"},method:"POST"}).then(async r=>{this.handleSentEvent({body:n,responseCode:r?.status,responseData:await r?.text(),responseHeaders:JSON.stringify([...r?.headers.entries()]),locationPrev:o})}).catch(r=>{this.handleSentEvent({body:n,errorData:JSON.stringify(r,Object.getOwnPropertyNames(r)),locationPrev:o})})}sendEventBeacon({targetUrl:t,body:n}){const o=JSON.stringify(n),r={type:"application/json"},a=new Blob([o],r);return navigator.sendBeacon(`${t}/v1/event`,a)?Promise.resolve():this.sendEventPromise({targetUrl:t,body:n})}sendEvent(t){return this.handleBeaconApiEventEnabled()&&"sendBeacon"in navigator?this.sendEventBeacon(t):this.sendEventPromise(t)}resolveEventPromises(){this.eventPromises.map((t,n)=>t(n)),this.eventPromises=[]}dispatchEvents(t){return Promise.all(t.map(({body:n,targetUrl:o})=>{if(n){if(document.readyState==="complete")return this.sendEvent({targetUrl:o,body:n});this.eventPromises.push(r=>this.sendEvent({targetUrl:o,body:n}))}return Promise.resolve()}))}}const VI="BASKET_UNAVAILABLE_DATA_NOTIFICATION_ID",cg="CART_MULTIPLE_DELIVERIES_SHOWN",Hs={DETAIL:"detail",GRID:"grid",LIST:"list"},Gx={[Hs.DETAIL]:"view_details",[Hs.GRID]:"view_grid",[Hs.LIST]:"view_list"},$x={[Hs.DETAIL]:"basket.details.view.button",[Hs.GRID]:"basket.grid.view.button",[Hs.LIST]:"basket.list.view.button"},Br={SUCCESSFUL:"SUCCESSFUL",WITH_CONFLICTS:"WITH_CONFLICTS",ALL_WITH_CONFLICTS:"ALL_WITH_CONFLICTS",NO_ACTION:"NO_ACTION"},Jl={OUT_OF_STOCK:"OUT_OF_STOCK",LIMITED_AVAILABILITY:"LIMITED_AVAILABILITY",EXCEEDED_MAX_QUANTITY:"EXCEEDED_MAX_QUANTITY",EXCEEDED_BASKET_MAX_QUANTITY:"EXCEEDED_BASKET_MAX_QUANTITY",TIME_RESTRICTION:"TIME_RESTRICTION",UNKNOWN:"UNKNOWN"},BF={"skip-edit-order-modal":"skipEditOrderModal","skip-payment-buffer-modal":"skipPaymentBufferModal","basket-view":"basketView"},fxe="web_customer_preference_ws",FY="/v1/customer-preferences",BY={service:fxe,pathPrefix:{client:"/api/customer-preferences",server:"/core-api"}},UY=({actionType:e,url:t,options:n,service:o,pathPrefix:r})=>({type:"API",payload:{url:t,...!!n&&{options:n},...se(e),...!!o&&{service:o},...!!r&&{pathPrefix:r}}}),sO=({actionType:e,preferenceKey:t})=>n=>UY({actionType:e,url:FY,...BY,options:{body:{preferenceKey:t,preferenceValue:n},method:"PUT"}}),nO=({actionType:e,preferenceKey:t})=>()=>UY({actionType:e,url:`${FY}/${t}`,...BY}),yxe=e=>({type:"SET_CUSTOMER_PREFERENCES_SKIP_EDIT_ORDER_MODAL",payload:{skipEditOrderModal:e}}),Ixe=e=>({type:"SET_CUSTOMER_PREFERENCES_SKIP_PAYMENT_BUFFER_MODAL",payload:{skipPaymentBufferModal:e}}),Sxe=nO({actionType:"GET_CUSTOMER_PREFERENCES_SKIP_EDIT_ORDER_MODAL",preferenceKey:"skip-edit-order-modal"}),Cxe=sO({actionType:"UPDATE_CUSTOMER_PREFERENCES_SKIP_EDIT_ORDER_MODAL",preferenceKey:"skip-edit-order-modal"}),vxe=nO({actionType:"GET_CUSTOMER_PREFERENCES_SKIP_PAYMENT_BUFFER_MODAL",preferenceKey:"skip-payment-buffer-modal"}),Txe=sO({actionType:"UPDATE_CUSTOMER_PREFERENCES_SKIP_PAYMENT_BUFFER_MODAL",preferenceKey:"skip-payment-buffer-modal"}),_xe=nO({actionType:"GET_CUSTOMER_PREFERENCES_BASKET_VIEW",preferenceKey:"basket-view"}),bxe=sO({actionType:"UPDATE_CUSTOMER_PREFERENCES_BASKET_VIEW",preferenceKey:"basket-view"}),xxe=e=>({type:"SET_CUSTOMER_PREFERENCES_BASKET_VIEW",payload:{basketView:e}}),za={getCustomerPreferenceSkipEditOrderModal:Sxe,getCustomerPreferenceSkipPaymentBufferModal:vxe,getCustomerPreferenceBasketView:_xe,setCustomerPreferenceSkipEditOrderModal:yxe,setCustomerPreferenceSkipPaymentBufferModal:Ixe,setCustomerPreferenceBasketView:xxe,updateCustomerPreferenceSkipEditOrderModal:Cxe,updateCustomerPreferenceSkipPaymentBufferModal:Txe,updateCustomerPreferenceBasketView:bxe},Axe={data:{skipEditOrderModal:!1,skipPaymentBufferModal:!1,basketView:null},...je,error:null},Rxe=(e=Axe,t)=>{switch(t.type){case"GET_CUSTOMER_PREFERENCES_SKIP_EDIT_ORDER_MODAL_SUCCESS":case"GET_CUSTOMER_PREFERENCES_SKIP_PAYMENT_BUFFER_MODAL_SUCCESS":{const{preferenceKey:n,preferenceValue:o}=t.payload.responseData,r=BF[n];return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:{...e.data,...!!r&&{[r]:o==="true"}}}}case"GET_CUSTOMER_PREFERENCES_BASKET_VIEW_SUCCESS":{const{preferenceKey:n,preferenceValue:o}=t.payload.responseData,r=BF[n];return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:{...e.data,...!!r&&{[r]:o}}}}case"SET_CUSTOMER_PREFERENCES_SKIP_EDIT_ORDER_MODAL":return{...e,data:{...e.data,skipEditOrderModal:t.payload.skipEditOrderModal}};case"SET_CUSTOMER_PREFERENCES_SKIP_PAYMENT_BUFFER_MODAL":return{...e,data:{...e.data,skipPaymentBufferModal:t.payload.skipPaymentBufferModal}};case"SET_CUSTOMER_PREFERENCES_BASKET_VIEW":return{...e,data:{...e.data,basketView:t.payload.basketView}};case"GET_CUSTOMER_PREFERENCES_SKIP_EDIT_ORDER_MODAL_ERROR":case"GET_CUSTOMER_PREFERENCES_SKIP_PAYMENT_BUFFER_MODAL_ERROR":case"GET_CUSTOMER_PREFERENCES_BASKET_VIEW_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};default:return e}};function Dxe(e){return Object.values(Hs).some(t=>t===e)}const Oxe=({data:e})=>e.customer.preferences,oO=e=>Oxe(e)?.data||{},GY=e=>oO(e).skipEditOrderModal||!1,Pxe=e=>oO(e).skipPaymentBufferModal||!1,BC=e=>{const t=Ze(e,"basket-view");return oO(e)?.basketView??(Dxe(t)?t:Hs.DETAIL)},Dc=({orderId:e,queryString:t}={})=>{const n=e?`/${e}`:"",o=t?`?${t}`:"";return`/failed-payment${n}${o}`},$Y=e=>`${Dc({orderId:e})}/3ds`,rO=e=>`${Dc({orderId:e})}/complete`,UC=e=>Vo(e,"router.location"),tm=e=>Vo(e,"router.location.pathname"),Nxe=(e="",t=[])=>{const n=[jt(),na(),Dc()],o=[rO(),Qg(),...t],r=n.some(i=>zr({path:i,end:!1},e)),a=o.some(i=>zr({path:i,end:!1},e));return r&&!a},Lxe=e=>(Qe.parse(e)||{})["in-checkout-walk"]==="true",pE=(e,t=[])=>{const{pathname:n,search:o}=UC(e);return Nxe(n,t)||Lxe(o)},kxe=()=>de()-document.clientLoadTime,mE=e=>{const n=parseInt(Bde(e),10)+kxe();return CR(n)},It={targetUrl:"/events"},vt=(e,t,n)=>{const{payload:o}=n??{payload:{}};return{id:o?.pageEventId??ct(),sessionId:o?.sessionId??_c(e),timestamp:mE(e),pageViewId:o?.pageViewId??Nn(t),bannerId:ti(t)}},Hx=e=>e==null||typeof e=="string"&&e.trim()==="",Dt=(e,t,n,o)=>{const r=n?.map(i=>{const c=(i?.fields||[])?.filter(d=>!Hx(d?.value))||[];return{...i,...c?.length&&{fields:c}}}),a={pageComponentEvent:{...vt(e,t),pageComponents:r,...o&&{pageViewId:o}}};return{...It,body:a}},Pt=(e,t,n)=>({fields:Object.entries(e).flatMap(([r,a])=>Array.isArray(a)?a.map(i=>({name:r,value:i})):{name:r,value:a}),createdAt:mE(t),type:n}),jxe=e=>Object.entries(e).map(([t,n])=>({pageAttributeType:t,pageAttributeValues:Array.isArray(n)?n:[n]})),oa=(e,t,n,o)=>({...It,body:{pageAttributeEvent:{...vt(e,t),pageAttributeType:n,pageAttributeValues:Array.isArray(o)?o:[o]}}}),Oa=(e,t,n)=>{const{attributes:o}=e.payload;return{...It,body:{pageAttributesEvent:{...vt(t,n),pageAttributes:jxe(o)}}}},Mxe=(e,t,n)=>oa(t,n,"ENABLED_FEATURES",Kg(t)),wxe="PLACE_ORDER",Fxe="PLACE_ORDER_3DS_COMPLETE",Bxe="PLACE_ORDER_POST_EXTERNAL_REDIRECT_3DS_COMPLETE",Uxe="CHECKOUT_COMPLETE_PAGE_RENDERED",HY="CONFIRM_SLOT_MODAL_RENDERED",Gxe="DELIVERY_TYPE_SELECT",$xe="MAP_RENDERED",sm="NAVIGATE_TO_BOOK_SLOT_FLOW",Hxe="OUT_OF_STOCK_MODAL_RENDERED",Vxe="OUT_OF_STOCK_PAGE_RENDERED",Wxe="SELECT_SLOT_ERROR_MODAL_RENDERED",Yxe="SEARCH_PRODUCTS_VISIBLE",VY="SLOTS_RENDERED",WY="SLOT_SELECTED",qxe="SLOTS_ADDRESS_UPDATED",Kxe="CATEGORY_PRODUCTS_VISIBLE",zxe="SHOP_IN_SHOP_CATEGORY_PRODUCTS_VISIBLE",Qxe="HOMEPAGE_PRODUCTS_VISIBLE",Xxe="FAVORITES_PRODUCTS_VISIBLE",Zxe="PERFORMANCE_ROUTE_CHANGE",Jxe="NAVIGATE_TO_TROLLEY",eAe="TROLLEY_RENDERED",tAe="TROLLEY_CHECKOUT",sAe="SUMMARY_RENDERED",nAe="BOP_MOUNT",oAe="OFFER_PRODUCTS_VISIBLE",rAe="SMART_CHECKOUT_WALK_CONTINUE",aAe="SMART_CHECKOUT_WALK_PRODUCTS_RENDERED",iAe="SMART_CHECKOUT_WALK_SUMMARY_REDIRECT",lAe="PROMOTIONS_PRODUCTS_VISIBLE",UF="NAV_BUTTON_CLICKED",cAe="NAV_DISPLAYED",GF="LIST_PRODUCTS_VISIBLE",dAe="SHOPPING_LISTS_VISIBLE",uAe="PERFORMANCE",aO={PERFORMANCE:uAe},YY=[{name:"homepage",startEvents:["PAGE_HOMEPAGE"],endEvents:["HOMEPAGE_PRODUCTS_VISIBLE"]},{name:"slot_booking_confirmation",startEvents:["SLOT_SELECTED"],endEvents:["CONFIRM_SLOT_MODAL_RENDERED"]},{name:"slot_booking_home_delivery",startEvents:["PAGE_HOME_DELIVERY_SLOTBOOKING"],endEvents:["SLOTS_RENDERED"]},{name:"slot_booking_customer_collection",startEvents:["PAGE_COLLECT_SLOTBOOKING"],endEvents:["SLOTS_RENDERED"]},{name:"slot_booking_change_address",startEvents:["SLOTS_ADDRESS_UPDATED"],endEvents:["SLOTS_RENDERED"]},{name:"search",startEvents:["PAGE_SEARCH"],endEvents:["SEARCH_CONTENT_VISIBLE","SEARCH_PRODUCTS_VISIBLE"]},{name:"browse",startEvents:["PAGE_SHOP_PRODUCTS","PAGE_ALL_SHOP_PRODUCTS"],endEvents:["CATEGORY_CONTENT_VISIBLE","CATEGORY_PRODUCTS_VISIBLE","SHOP_IN_SHOP_CATEGORY_PRODUCTS_VISIBLE"]},{name:"favorites",startEvents:["PAGE_FAVORITES"],endEvents:["FAVORITES_CONTENT_VISIBLE","FAVORITES_PRODUCTS_VISIBLE"]},{name:"checkout",startEvents:["PLACE_ORDER"],endEvents:["CHECKOUT_COMPLETE_PAGE_RENDERED"]},{name:"product_details",startEvents:["PAGE_BOP"],endEvents:["BOP_MOUNT"]},{name:"promotion_details",startEvents:["PAGE_OFFERS"],endEvents:["OFFER_PRODUCTS_VISIBLE"]},{name:"shopping_lists",startEvents:["PAGE_LISTS"],endEvents:["SHOPPING_LISTS_VISIBLE"]},{name:"shopping_list_products",startEvents:["PAGE_LIST_DETAILS"],endEvents:["LIST_PRODUCTS_VISIBLE"]},{name:"promotions",startEvents:["PAGE_PROMOTIONS","PAGE_ALL_PROMOTIONS"],endEvents:["PROMOTIONS_PRODUCTS_VISIBLE"]}],pAe=YY.flatMap(e=>[...e.startEvents,...e.endEvents]),mAe=10,Fu=[],qY=e=>{const t=YY.filter(n=>n.endEvents.some(o=>o===e.name));if(!t.length){Fu.push(e),Fu.length>mAe&&Fu.shift();return}for(let n=Fu.length-1;n>=0;n--){const o=Fu[n],r=t.find(a=>a.startEvents.some(i=>i===o.name));if(r){const a=e.timestamp-o.timestamp,i={is_full_page_load:`${e.isFullPageLoad}`,is_user_logged_in:`${e.isUserLoggedIn}`,reporting_level:`${e.reportingLevel}`};e.variant&&(i.variant=e.variant),hAe(r.name,a,i),Fu.splice(n,1);return}}},hAe=(e,t,n)=>{Ue.api.pushMeasurement({type:"client-performance",values:{[e]:t}},{context:{...n,measurement_name:e}})},gAe=e=>pAe.includes(e),EAe=e=>e?Object.entries(e).flatMap(([t,n])=>Hx(n)?[]:Array.isArray(n)?n.filter(o=>!Hx(o)).map(o=>({type:t,value:o})):{type:t,value:n}):[],z=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n,e),pageEventType:e.type,pageEventDescription:e.payload.description,pageEventAttributes:EAe(e.payload.pageEventAttributes)}}}),fAe=(e,t,n)=>{if(typeof window>"u"||!window.performance)return!1;const o=Vp(e.payload.location,n),r=window.performance.now(),a=D("faro")(n),i=IC(n),l=xr(n)!==void 0,c=tV(n),d={type:aO.PERFORMANCE,payload:{description:"Performance mark for the changing of a route",pageEventAttributes:{name:Zxe,pageName:o,timestamp:r,isFullPageLoad:i}}};return a&&qY({name:`PAGE_${o}`,timestamp:i?0:r,isFullPageLoad:i,isUserLoggedIn:l,reportingLevel:c}),z(d,t,n)},KY=e=>{const t=tm(e);return t?document.location.origin+t:document.referrer},yAe=[na(),OR()],WI=(e,t,n)=>{const{pagePartType:o,location:r}=e.payload,{pathname:a}=r;if(yAe.includes(a))return{};const i=Ra(n)?.amount,l=o||Vp(r,n),c=Ol(n);let d=r2(e);const u=Rme(e),p=IC(n);return l==="SEARCH"&&p&&(d="REFRESHED"),{...It,body:{pageViewEvent:{id:Nn(n),timestamp:mE(t),regionId:vn(n),bannerId:ti(n),location:a,pageType:l,referer:KY(t),sessionId:_c(t),retailerCustomerId:ei(t),customerFirstname:c.data["attr.firstName"],customerLastname:c.data["attr.surname"],customerEmail:c.data.email,source:d,sourceEventId:u,transactionId:Ct(n),statistics:{...a===jt()&&{displayType:BC(n)},isFullPageLoad:p,routeChangeCount:JH(n)},...i&&{basketTotalAmount:i}}}}},GC=(e={payload:{}},t,n,o,r)=>{const{payload:a}=e||{},{source:i,sourceEventId:l}=a||{};return{...It,body:{pageViewEvent:{id:Nn(n),timestamp:mE(t),regionId:vn(n),bannerId:ti(n),location:o,pageType:r,referrer:KY(t),sessionId:_c(t),transactionId:Ct(n),...i&&{source:i},...l&&{sourceEventId:l}}}}},YI="customerAddressId",Co={UK_POSTCODE:"UK_POSTCODE",UK_POSTCODE_MAP_BACKUP:"UK_POSTCODE_MAP_BACKUP",INTERNATIONAL:"INTERNATIONAL",MANUAL_FORM:"MANUAL_FORM",MANUAL_FORM_POSTCODE:"MANUAL_FORM_POSTCODE",MANUAL_FORM_MAP:"MANUAL_FORM_MAP",KOREAN_ROAD_NAME:"KOREAN_ROAD_NAME",MAP_LOOKUP:"MAP_LOOKUP"},Rr="addAddress",hE="addAddressDDS",zY="/addresses",iO=`${zY}/add-address`,IAe=`${zY}/confirm-address`,SAe=`${IAe}/:${YI}`,ni=e=>{const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t},CAe=(e,t,n)=>({...It,body:{addressUndeliverableEvent:{...vt(t,n),address:e.payload.addressDescription}}}),vAe=(e,t,n)=>({...It,body:{abandonedAddressSearchEvent:{...vt(t,n),searchText:e.payload.lastSearchString,failedSearches:e.payload.failedSearches}}}),TAe=(e,t,n)=>({...GC(e,t,n,iO,"ADDRESS_ERROR")}),_Ae=(e,t,n)=>({...GC(e,t,n,iO,"ADDRESS_POSTCODE")}),bAe=(e,t,n)=>{const o={type:e.type,payload:{description:'User clicked the "Add new address" button'}};return z(o,t,n)},xAe=(e,t,n)=>{const o={type:e.type,payload:{description:"User clicked the form add address button",pageEventAttributes:{...e.payload}}};return e.payload.missingMandatoryFieldName!==void 0&&(o.payload.pageEventAttributes.missingMandatoryFieldName=`[${e.payload.missingMandatoryFieldName.toString()}]`),z(o,t,n)},AAe=(e,t,n)=>{const o={type:e.type,payload:{description:'User clicked the "edit" button'}};return e.payload.addressId&&(o.payload={...o.payload,pageEventAttributes:{addressId:e.payload.addressId}}),z(o,t,n)},RAe=(e,t,n)=>z({type:e.type,payload:{description:'User clicked the "remove" button',pageEventAttributes:{...e.payload}}},t,n),DAe=(e,t,n)=>z({type:e.type,payload:{description:'User clicked the "cancel" button',pageEventAttributes:{status:e.payload.status}}},t,n),OAe=(e,t,n)=>{const{missingMandatoryField:o,isDeliveryInstructionsFilled:r,additionalDetailsFilled:a,addressNameFilled:i,invalidCharacters:l,invalidFields:c}=e.payload;return z({type:e.type,payload:{description:"User clicked the save address button",pageEventAttributes:{missingMandatoryField:o,isDeliveryInstructionsFilled:r,addressNameFilled:i,...c!==void 0&&{invalidFields:c},...a!==void 0&&{additionalDetailsFilled:a},...l!==void 0&&{invalidCharacters:l}}}},t,n)},PAe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the find address button, again"}},t,n),NAe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the find address button",pageEventAttributes:{...e.payload}}},t,n),LAe=(e,t,n)=>z({type:e.type,payload:{description:"Open dropdown list"}},t,n),kAe=(e,t,n)=>z({type:e.type,payload:{description:"Choose an address from the list",pageEventAttributes:{...e.payload}}},t,n),jAe=(e,t,n)=>{const o=e.payload.addressesImpression.map((r,a)=>zAe({addressId:r.id,position:a},t,ke.ADDRESS_IMPRESSION));return Dt(t,n,o)},MAe=(e,t,n)=>z({type:ke.USER_DETAILS_FORM_MODAL_DISPLAYED,payload:{description:"The modal where to add details such as phone, age confirmation or SMS subscription was shown"}},t,n),wAe=(e,t,n)=>z({type:ke.USER_DETAILS_FORM_MODAL_CLOSED,payload:{description:"The modal where to add details such as phone, age confirmation or SMS subscription was closed",pageEventAttributes:{...e.payload}}},t,n),FAe=(e,t,n)=>z({type:ke.SAVE_DETAILS_BUTTON_CLICKED,payload:{description:"The user clicked on 'Done' when the phone and age confirmation was requested",pageEventAttributes:{...e.payload}}},t,n),BAe=(e,t,n)=>z({type:ke.ADD_ADDRESS_MODAL_DISPLAYED,payload:{description:"A modal was shown with fields to add an address",pageEventAttributes:{...e.payload}}},t,n),UAe=(e,t,n)=>z({type:ke.ADD_ADDRESS_MODAL_CLOSED,payload:{description:"The customer closed the modal by clicking to add an address or a closing button",pageEventAttributes:{...ni(e.payload)}}},t,n),GAe=(e,t,n)=>z({type:ke.SELECT_ADDRESS_MODAL_DISPLAYED,payload:{description:"The modal to select the introduced address or the ones found by the feature was shown",pageEventAttributes:{...ni(e.payload)}}},t,n),$Ae=(e,t,n)=>z({type:ke.SELECT_ADDRESS_MODAL_CLOSED,payload:{description:"The customer closed the modal to select the introduced address or the ones found by the feature",pageEventAttributes:{...ni(e.payload)}}},t,n),HAe=(e,t,n)=>z({type:ke.CONFIRM_ADDRESS_MODAL_DISPLAYED,payload:{description:"The modal to confirm the introduced address was shown",pageEventAttributes:{...ni(e.payload)}}},t,n),VAe=(e,t,n)=>z({type:ke.CONFIRM_ADDRESS_MODAL_CLOSED,payload:{description:"The customer closed the modal to confirm the introduced address",pageEventAttributes:{...ni(e.payload)}}},t,n),WAe=(e,t,n)=>z({type:ke.ZOOM_BUTTON_CLICKED,payload:{description:"The customer zoomed the map in/out",pageEventAttributes:{...ni(e.payload)}}},t,n),YAe=(e,t,n)=>z({type:ke.LOCATE_ME_BUTTON_CLICKED,payload:{description:"The customer zoomed the map in/out"}},t,n),qAe=(e,t,n)=>z({type:ke.SAVE_ADDRESS_MODAL_DISPLAYED,payload:{description:"The modal to save the address was shown",pageEventAttributes:{...ni(e.payload)}}},t,n),KAe=(e,t,n)=>z({type:ke.SAVE_ADDRESS_MODAL_CLOSED,payload:{description:"The customer closed the modal to save the address",pageEventAttributes:{...ni(e.payload)}}},t,n),zAe=({addressId:e,position:t},n,o)=>({fields:[{name:"addressId",value:e},{name:"position",value:t}],createdAt:mE(n),type:o}),QAe=(e,t,n)=>z({type:e.type,payload:{description:"A modal was shown to look up for an address via postcode"}},t,n),XAe=(e,t,n)=>z({type:e.type,payload:{description:"The customer closed the modal to look up for an address via postcode",pageEventAttributes:{...ni(e.payload)}}},t,n),ZAe=(e,t,n)=>z({type:e.type,payload:{description:"The user has ended typing or the timer has triggered an error",pageEventAttributes:{...ni(e.payload)}}},t,n),JAe=(e,t,n)=>z({type:e.type,payload:{description:"The user clicked on the Continue button"}},t,n),eRe=(e,t,n)=>z({type:e.type,payload:{description:"The user clicked on the Enter address manually button"}},t,n),tRe=(e,t,n)=>z({type:e.type,payload:{description:"The customer closed the modal when the selected suggestion was shown"}},t,n),sRe=(e,t,n)=>z({type:e.type,payload:{description:"The user clicked on Continue in the Address Search suggestions",pageEventAttributes:{...ni(e.payload)}}},t,n),nRe={[ke.ADDRESS_LOOKUP_ABANDONED]:vAe,[ke.ADDRESS_LOOKUP_UNDELIVERABLE]:CAe,[ke.ADDRESS_ERROR]:TAe,[ke.ADDRESS_POSTCODE]:_Ae,[ke.ADD_ADDRESS_BUTTON_CLICKED]:bAe,[ke.FORM_ADD_ADDRESS_BUTTON_CLICKED]:xAe,[ke.EDIT_ADDRESS_BUTTON_CLICKED]:AAe,[ke.REMOVE_ADDRESS_BUTTON_CLICKED]:RAe,[ke.CANCEL_BUTTON_CLICKED]:DAe,[ke.SAVE_ADDRESS_BUTTON_CLICKED]:OAe,[ke.ADDRESS_IMPRESSION]:jAe,[ke.FIND_ADDRESS_BUTTON_CLICKED]:NAe,[ke.FIND_ADDRESS_AGAIN_BUTTON_CLICKED]:PAe,[ke.USER_DETAILS_FORM_MODAL_DISPLAYED]:MAe,[ke.USER_DETAILS_FORM_MODAL_CLOSED]:wAe,[ke.SAVE_DETAILS_BUTTON_CLICKED]:FAe,[ke.ADDRESS_DROPDOWN_OPENED]:LAe,[ke.DROPDOWN_ADDRESS_SELECTED]:kAe,[ke.ADD_ADDRESS_MODAL_DISPLAYED]:BAe,[ke.ADD_ADDRESS_MODAL_CLOSED]:UAe,[ke.SELECT_ADDRESS_MODAL_DISPLAYED]:GAe,[ke.SELECT_ADDRESS_MODAL_CLOSED]:$Ae,[ke.CONFIRM_ADDRESS_MODAL_DISPLAYED]:HAe,[ke.CONFIRM_ADDRESS_MODAL_CLOSED]:VAe,[ke.ZOOM_BUTTON_CLICKED]:WAe,[ke.LOCATE_ME_BUTTON_CLICKED]:YAe,[ke.SAVE_ADDRESS_MODAL_DISPLAYED]:qAe,[ke.SAVE_ADDRESS_MODAL_CLOSED]:KAe,[ke.SEARCH_ADDRESS_POSTCODE_MODAL_DISPLAYED]:QAe,[ke.SEARCH_ADDRESS_POSTCODE_MODAL_CLOSED]:XAe,[ke.SEARCH_ADDRESS_POSTCODE_END_TYPING]:ZAe,[ke.CONTINUE_ADDRESS_ADD_BUTTON_CLICKED]:JAe,[ke.ENTER_ADDRESS_MANUALLY_BUTTON_CLICKED]:eRe,[ke.SEARCH_ADDRESS_MODAL_CLOSED]:tRe,[ke.SEARCH_ADDRESS_CONTINUE_CLICKED]:sRe},QY={MEDIUM_RECTANGLE:"MEDIUM_RECTANGLE",PRODUCT_CARD:"PRODUCT_CARD",HORIZONTAL:"HORIZONTAL",DOUBLE_TILE:"TILE",SHOPPABLE:"SHOPPABLE_BANNER"},XY={basket:"CART","logged-in-homepage":"LIHP","logged-out-homepage":"LOHP","product-details":"PRODUCT_DETAILS",categories:"CATEGORY",search:"SEARCH",favorites:"FAVORITES",promotions:"PROMOTIONS","promotion-details":"PROMOTION_DETAILS",regulars:"REGULARS","slot-booking":"SLOT_BOOKING","edit-order":"EDIT_ORDER","order-confirmation":"ORDER_CONFIRMATION"},ZY={STATIC_ADVERT:{click:{type:"IMAGE_CLICKED",description:"User clicked an ad banner image displayed on the page"},impression:{eventType:"IMAGE_IMPRESSION"}},RESPONSIVE_ADVERT:{click:{type:"RESPONSIVE_BANNER_CLICKED",description:"User clicked a responsive banner displayed on the page"},impression:{eventType:"RESPONSIVE_BANNER_IMPRESSION"}}},JY=e=>e.map(({segmentId:t})=>t),$F=e=>(t,n,o)=>{const{id:r,name:a,location:i,placement:l,contentSource:c,targetUrl:d,linkType:u,segments:p,sequence:g,format:E,size:y}=t.payload,I=ZY[e].click;return z({type:I.type,payload:{description:I.description,pageEventAttributes:{entryId:r,entryName:a,location:XY[i],placement:l,contentSource:c||"UNKNOWN",targetUrl:d,linkType:u,...p?.length&&{segmentId:JY(p)},...g!==void 0&&{sequence:g.toString()},...E&&{FORMAT:QY[E]},...y&&{SIZE:y.toString()}}}},n,o)},HF=e=>(t,n,o)=>{const{id:r,name:a,location:i,placement:l,contentSource:c,targetUrl:d,linkType:u,segments:p,sequence:g,format:E,size:y}=t.payload,I=ZY[e].impression,S=[Pt({ENTRY_ID:r,ENTRY_NAME:a,LOCATION:XY[i],PLACEMENT:l,CONTENT_SOURCE:c||"UNKNOWN",...d&&{TARGET_URL:d},...u&&{LINK_TYPE:u},...p?.length&&{SEGMENT_ID:JY(p)},...g!==void 0&&{SEQUENCE:g.toString()},...E&&{FORMAT:QY[E]},...y&&{SIZE:y.toString()}},n,I.eventType)];return Dt(n,o,S,void 0)},oRe={ADVERTISING_BANNER_CLICKED:$F("STATIC_ADVERT"),ADVERTISING_BANNER_IMPRESSION:HF("STATIC_ADVERT"),RESPONSIVE_ADVERTISING_BANNER_CLICKED:$F("RESPONSIVE_ADVERT"),RESPONSIVE_ADVERTISING_BANNER_IMPRESSION:HF("RESPONSIVE_ADVERT")},eq=e=>e.map(({segmentId:t})=>t),rRe=(e,t,n)=>{const{id:o,advertId:r,name:a,location:i,contentSource:l,placement:c,targetUrl:d,linkType:u,segments:p}=e.payload;return z({type:"IMAGE_CLICKED",payload:{description:"User clicked a popup banner image displayed on the page",pageEventAttributes:{entryId:o,entryName:a,location:i,placement:c,contentSource:l,targetUrl:d,linkType:u,...r&&{advertId:r},...p?.length&&{segmentId:eq(p)}}}},t,n)},aRe=(e,t,n)=>{const{id:o,advertId:r,name:a,location:i,contentSource:l,placement:c,targetUrl:d,linkType:u,segments:p}=e.payload;return Dt(t,n,[Pt({ENTRY_ID:o,ENTRY_NAME:a,LOCATION:i,PLACEMENT:c,CONTENT_SOURCE:l,TARGET_URL:d,LINK_TYPE:u,...r&&{ADVERT_ID:r},...p?.length&&{SEGMENT_ID:eq(p)}},t,"IMAGE_IMPRESSION")])},iRe=(e,t,n)=>{const{id:o,advertId:r,name:a}=e.payload;return z({type:"POPUP_CLOSE_BUTTON_CLICKED",payload:{description:"User clicked on a close button on a Pop-Up ad banner",pageEventAttributes:{entryId:o,entryName:a,buttonType:"crossButton",...r&&{advertId:r}}}},t,n)},lRe={POPUP_BANNER_CLICKED:rRe,POPUP_BANNER_IMPRESSION:aRe,POPUP_BANNER_CLOSE:iRe},cRe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked button on the login and register modal",pageEventAttributes:{...e.payload}}},t,n),dRe=(e,t,n)=>z({type:e.type,payload:{description:"A login and register modal was displayed",pageEventAttributes:{...e.payload}}},t,n),uRe=(e,t,n)=>({...It,body:{loginClickedEvent:{...vt(t,n),source:e.payload.source}}}),pRe=(e,t,n)=>({...It,body:{registerClickedEvent:{...vt(t,n),source:e.payload.source}}}),mRe={[on.LOGIN_REGISTER_MODAL_CLICKED]:cRe,[on.LOGIN_REGISTER_MODAL_DISPLAYED]:dRe,[on.LOGIN_CLICKED]:uRe,[on.REGISTER_CLICKED]:pRe},hRe=(e,t)=>{if(!e?.items?.length)return 0;const n=e.items.find(o=>o?.productId===t);return n?.quantity?.quantityInBasket?n.quantity.quantityInBasket:0},$C=({basketId:e,basketTotalValue:t,updateQuantity:n,totalQuantity:o,prevState:r,nextState:a,product:i,addedByFunction:l,addedFromSection:c})=>{const d=i?.productId,u=ts(a)?.[d],p=i?.retailerProductId??u?.retailerProductId,g=IF(i)??IF(u),E=SF(i)??SF(u),y=i?.cmsProductAttributes??u?.cmsProductAttributes??[],I=(i?.offers??u?.offers)?.map(({id:C})=>C)??[];return{body:{basketQuantityUpdateEventV5:{...vt(r,a),totalQuantity:o,basketTotalAmount:t?.amount,basketTotalCurrency:t?.currency,updateQuantity:n,addedByFunction:l,addedFromSection:c,retailerProductId:p,productId:d,priceAmount:g,priceCurrency:E,...I?.length&&{availablePromotionIds:I},...y?.length&&{cmsProductAttributes:y},...e&&{basketId:e}}}}},VF=(e,t,n)=>{const[o]=e.payload.product.map(r=>{const a=dD(r),i=e.type===Re.ADD_BASKET_ITEM?a:-a,l=hRe(e.payload.basket,r?.productId);return $C({basketId:e.payload.basket.basketId,basketTotalValue:e.payload.basket?.totals?.display?.itemPriceAfterPromos??e.payload.basket?.total,updateQuantity:i,totalQuantity:l,prevState:t,nextState:n,product:r,addedByFunction:e.payload.addedByFunction,addedFromSection:e.payload.section})}).slice(-1);return{...It,...o}},gRe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked checkout order button",pageEventAttributes:{orderId:e.payload.orderId,minSpendReached:e.payload.minSpendReached}}},t,n),ERe=(e,t,n)=>z({type:e.type,payload:{description:"User has seen the checkout order button",pageEventAttributes:{minSpendReached:e.payload.minSpendReached}}},t,n),fRe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked book a slot button",pageEventAttributes:{orderId:e.payload.orderId}}},t,n),yRe=(e,t,n)=>z({type:e.type,payload:{description:"User has seen book a slot button"}},t,n),IRe=(e,t,n)=>{const{basketId:o,checkoutCorrelationId:r,activeCheckoutGroupId:a}=is(n);if(!Xe(n)||!r)return{};const i=Ra(n);if(!i)return{};const{currency:l,amount:c}=i;return Oa({payload:{attributes:{CHECKOUT_CORRELATION_ID:r,...a?{ACTIVE_CHECKOUT_GROUP_ID:a}:{},BASKET_ID:o,ORDER_VALUE_AMOUNT:c,ORDER_VALUE_CURRENCY:l}}},t,n)},SRe=e=>{const t=e?.payload?.prevState,n=e?.payload?.nextState,o=n?.data?.basket;return t.data.basket.items?.map(a=>{const i=-1*a.quantity.quantityInBasket,c=$C({basketId:o?.basketId,basketTotalValue:o?.totals?.display?.itemPriceAfterPromos,updateQuantity:i,totalQuantity:0,prevState:t,nextState:n,product:t.data.products.productEntities[a.productId]});return{...It,...c}})},CRe=(e,t,n)=>{const o=e.payload.emptyTrolleyCardImpressions.map(r=>Pt(r,t,"CARD_IMPRESSION"));return Dt(t,n,o)},vRe=(e,t,n)=>{const o=e.payload.unavailableProducts.map(r=>Pt(r,t,"PRODUCT_UNAVAILABLE"));return Dt(t,n,o)},TRe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User clicked on the trolley instant shop card"}}}),_Re=(e,t,n)=>z({type:e.type,payload:{description:"Voucher successfully added to order",pageEventAttributes:{voucherId:e.payload.voucherId,voucherDescription:e.payload.voucherDescription,tickboxName:e.payload.tickboxName,tickboxSelected:e.payload.tickboxSelected}}},t,n),bRe=(e,t,n)=>z({type:e.type,payload:{description:"Voucher unsuccessfully added to order",pageEventAttributes:{voucherId:e.payload.voucherId,failureMessage:e.payload.failureMessage}}},t,n),xRe=(e,t,n)=>z({type:e.type,payload:{description:"User removed voucher",pageEventAttributes:{voucherId:e.payload.voucherId,voucherDescription:e.payload.voucherDescription}}},t,n),ARe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked empty button"}},t,n),RRe=(e,t,n)=>z({type:e.type,payload:{description:"Minimum basket value not reached notification displayed.",pageEventAttributes:{minimumBasketValueAmount:e.payload.minimumBasketValueAmount,basketValueAmount:e.payload.basketValueAmount,basketValueCurrency:e.payload.basketValueCurrency}}},t,n),DRe=(e,t,n)=>z({type:e.type,payload:{description:"Minimum basket value changed notification displayed.",pageEventAttributes:{minimumBasketValueAmount:e.payload.minimumBasketValueAmount,basketValueAmount:e.payload.basketValueAmount,basketValueCurrency:e.payload.basketValueCurrency}}},t,n),ORe=(e,t,n)=>{const o=n.data.basket?.totals?.display?.itemPriceAfterPromos;return{...It,body:{basketQuantityUpdateEventV5:{...vt(t,n),...e.payload,basketTotalAmount:o?.amount,basketTotalCurrency:o?.currency,bannerId:ti(n)}}}},PRe=(e,t,n)=>z({type:e.type,payload:{description:"Some items could add to basket",pageEventAttributes:{orderId:e?.payload?.orderId,productId:e?.payload?.productId?.join(",")}}},t,n),NRe=(e,t,n)=>{const o=[Pt(e.payload.pageComponents,t,Re.SOME_ITEMS_UNABLE_TO_ADD_IMPRESSION)];return Dt(t,n,o,e.payload.pageViewId)},LRe=(e,t,n)=>z({type:e.type,payload:{description:'User confirmed "Add products to order" but the basket was empty',pageEventAttributes:{orderId:e?.payload?.checkoutCorrelationId}}},t,n),kRe=(e,t,n)=>{const{orderId:o}=e.payload;return z({type:Re.ADD_PRODUCT_TO_ORDER_MODAL_DISPLAYED,payload:{description:"After click edit order button show a modal",pageEventAttributes:{orderId:o}}},t,n)},jRe=(e,t,n)=>{const{orderId:o}=e.payload;return z({type:Re.NOT_NOW_BUTTON_CLICKED,payload:{description:"User clicks not now button on add product to order modal",pageEventAttributes:{orderId:o}}},t,n)},MRe=(e,t,n)=>{const{checkoutCorrelationId:o}=e.payload;return z({type:Re.CLOSE_BUTTON_CLICKED,payload:{description:"User clicks close (X) button on add product to order modal",pageEventAttributes:{orderId:o}}},t,n)},wRe=(e,t,n)=>{const o={type:Re.SMALL_ORDER_CHARGE_MODAL_DISPLAYED,payload:{description:"Small Order Charge modal displayed",pageEventAttributes:{orderId:e.payload.orderId}}};return z(o,t,n)},FRe=(e,t,n)=>{const o={type:Re.SMALL_ORDER_CHARGE_MODAL_LEARN_MORE_BUTTON_CLICKED,payload:{description:"User clicked learn more button in Small Order Charge modal",pageEventAttributes:{orderId:e.payload.orderId}}};return z(o,t,n)},BRe=(e,t,n)=>{const o={type:Re.CLOSE_BUTTON_CLICKED,payload:{description:"User clicked close button in Small Order Charge modal",pageEventAttributes:{orderId:e.payload.orderId}}};return z(o,t,n)},URe=(e,t,n)=>{const o={type:Re.SMALL_ORDER_CHARGE_SLOT_BOOKED_LEARN_MORE_BUTTON_CLICKED,payload:{description:"User clicked Small Order Charge Learn More button in Slot Booked modal",pageEventAttributes:{orderId:e.payload.orderId}}};return z(o,t,n)},GRe=(e,t,n)=>{const o={type:Re.SMALL_ORDER_CHARGE_COMPONENT_CLICKED,payload:{description:"User clicked the small order charge information icon or Learn More Link",pageEventAttributes:{orderId:e.payload.orderId,chargeInfo:e.payload.chargeInfo,pageType:e.payload.pageType}}};return z(o,t,n)},$Re={[Re.ADD_BASKET_ITEM]:VF,[Re.CHECKOUT_ORDER_BUTTON_CLICKED]:gRe,[Re.CHECKOUT_ORDER_BUTTON_VIEWED]:ERe,[Re.BOOK_SLOT_BUTTON_CLICKED]:fRe,[Re.BOOK_SLOT_BUTTON_VIEWED]:yRe,[Re.CURRENT_ORDER_ANALYTICS]:IRe,[Re.EMPTY_CART]:SRe,[Re.EMPTY_TROLLEY_CARD_IMPRESSION]:CRe,[Re.UNAVAILABLE_PRODUCTS]:vRe,[Re.REDEEM_PAYMENT_CHECK_BUTTON_CLICKED]:z,[Re.REDIRECT_TO_SLOT_BOOKING]:z,[Re.REMOVE_BASKET_ITEM]:VF,[Re.INSTANT_SHOP_TROLLEY_CARD_CLICKED]:TRe,[Re.INSTANT_SHOP_REMOVE_FROM_BASKET_MODAL]:z,[Re.TROLLEY_VIEW_CHANGE_VIEW_TYPE_BUTTON_CLICKED]:z,[Re.UNAVAILABLE_ITEMS_MODAL_DISPLAYED]:z,[Re.VOUCHER_ADD_SUCCESS]:_Re,[Re.VOUCHER_ADD_FAILURE]:bRe,[Re.VOUCHER_REMOVED]:xRe,[Re.EMPTY_BUTTON_CLICKED]:ARe,[Re.MINIMUM_BASKET_VALUE_NOT_REACHED_NOTIFICATION_DISPLAYED]:RRe,[Re.MINIMUM_BASKET_VALUE_CHANGED_NOTIFICATION_DISPLAYED]:DRe,[Re.REMOVE_ALL_OUT_OF_STOCK_ITEMS_FROM_BASKET]:ORe,[Re.SOME_ITEMS_UNABLE_TO_ADD_MODAL_DISPLAYED]:PRe,[Re.SOME_ITEMS_UNABLE_TO_ADD_IMPRESSION]:NRe,[Re.ADD_PRODUCT_TO_ORDER_WITH_NO_ITEMS_REQUESTED]:LRe,[Re.ADD_PRODUCT_TO_ORDER_MODAL_DISPLAYED]:kRe,[Re.NOT_NOW_BUTTON_CLICKED]:jRe,[Re.CLOSE_BUTTON_CLICKED]:MRe,[Re.SMALL_ORDER_CHARGE_MODAL_DISPLAYED]:wRe,[Re.SMALL_ORDER_CHARGE_MODAL_CLOSE_BUTTON_CLICKED]:BRe,[Re.SMALL_ORDER_CHARGE_MODAL_LEARN_MORE_BUTTON_CLICKED]:FRe,[Re.SMALL_ORDER_CHARGE_COMPONENT_CLICKED]:GRe,[Re.SMALL_ORDER_CHARGE_SLOT_BOOKED_LEARN_MORE_BUTTON_CLICKED]:URe},WF=(e=[])=>e.map(({promoId:t,...n})=>({id:t,...n})),HRe=({origPrice:e,promoPrice:t,unitPrice:n,promoUnitPrice:o,grossPrice:r,referencePrice:a})=>{const i=o?o.price:void 0;return{...t&&{original:e},...t?{current:t}:{current:e},...n&&{unit:{label:n.unit,...n.pricePerSuffix&&{pricePerSuffix:n.pricePerSuffix},...i&&{original:n.price},...i?{current:i}:{current:n.price}}},...r&&{gross:r},...a&&{reference:{...a.price,type:a.type}}}},VRe=(e,t,n)=>{if(e&&t)return{value:t.typicalQuantity.value,uom:t.typicalQuantity.uom,catchWeight:!0};if(n)return{value:n}},WRe=e=>e.reduce((t,n)=>n.type==="LEGAL"?{...t,legal:[...t.legal,n]}:n.type==="CERTIFICATION"?{...t,certification:[...t.certification,n]}:t,{legal:[],certification:[]}),tq=(e,t=[],n,o)=>{const{unitPrice:r,type:a,imageConfig:i,iconAttributes:l,imageIds:c,packSizeDescription:d,...u}=e,{price:p,promoPrice:g,promoUnitPrice:E,grossPrice:y,referencePrice:I,isInShoppingList:S,promotions:C,catchweight:T,icons:_}=e,A=a==="CATCHWEIGHT",R={...u,price:HRe({origPrice:p,promoPrice:g,unitPrice:r,promoUnitPrice:E,grossPrice:y,referencePrice:I}),isInProductList:S||!1,...A&&{catchweight:T},icons:WRe(_),...o},P=WF(C);return R.offers=t.length>0?WF(t):P,R.offer=P.at(0),R.size=VRe(A,T,d),R.attributes=l.map(N=>({icon:N.file.replace("-icon",""),label:N.label})),R},sq=({product:e,bopData:t,bopPromotions:n,detailedImages:o})=>{const r=tq(e,n);return{result:{bopData:t,detailedImages:o,product:r.productId},entities:{product:{[r.productId]:r}}}},nq=se("GET_BOP"),oq={SET_ACTIVE_BOP:"SET_ACTIVE_BOP"},YRe="web_product_page_ws",qRe=e=>({type:"API",payload:{service:YRe,url:`/webproductpagews/v5/products/bop?retailerProductId=${e}`,...nq}}),KRe=e=>({type:oq.SET_ACTIVE_BOP,payload:{productId:e}}),Ti={getBop:qRe,setActiveBop:KRe,types:{GET_BOP:nq,SET_ACTIVE_BOP:oq.SET_ACTIVE_BOP}},zRe=je,QRe=(e=zRe,t)=>{switch(t.type){case Ti.types.GET_BOP.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Ti.types.GET_BOP.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Ti.types.GET_BOP.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:(()=>{const o=t.payload.responseData;return sq(o).result})(),lastUpdated:de()};case Ti.types.SET_ACTIVE_BOP:return{...e,active:t.payload.productId};default:return e}},rq=Y(e=>e.data.bop.details,ts,(e,t)=>{if(e.data?.product&&(e.data.product===e.active||e.active===void 0)){const n=t[e.data.product];if(n)return{...e,data:{product:n,bopData:e.data?.bopData}}}return{...e,data:{product:{}}}}),aq=({data:e})=>e.bop.details.isFetching,iq=({data:e})=>e.bop.details.fetchError?e.bop.details.error:null,lq=Y(e=>e.data.bop.details,e=>e.data?.bopData),nm=({data:e})=>e.bop.details.active,XRe=({data:e})=>e.bop.details.data?.detailedImages,ZRe=({data:e})=>e.bop.details.data?.bopData?.breadcrumbs?.map(t=>t.categoryId)||[],HC=e=>{const t=nm(e);return t?ts(e)[t]:void 0},Eo=e=>t=>{const n=HC(t);if(n)return n[e]},cq=Eo("icons"),JRe=Y(cq,e=>e?.certification),eDe=Y(cq,e=>e?.legal),tDe=Eo("favorite"),sDe=Eo("image"),nDe=Eo("offers"),gE=Eo("offer"),oDe=Eo("attributes"),pu=Eo("price"),dq=Eo("size"),rDe=Eo("guaranteedProductLife"),aDe=Eo("depositPrice"),iDe=Eo("isInProductList"),EE=Eo("name"),lDe=Eo("countryOfOrigin"),uq=({data:e})=>e.bop.details.data?.bopData?.detailedDescription,pq=({data:e})=>e.bop.details.data?.bopData?.fields?.find(t=>t.title==="brand")?.content,lO=Eo("retailerProductId"),mq=Eo("productId"),cDe=Eo("isVerifiedPurchase"),dDe=Eo("seller"),uDe=(e,t,n)=>{const o=e.payload.promoLinkImpressions.map(a=>Pt(a,t,"PROMO_LINK_IMPRESSION")),{pageViewId:r}=e.payload;return Dt(t,n,o,r)},pDe=(e,t,n)=>oa(t,n,"PRODUCT_ID",[mq(n)]),mDe=(e,t,n)=>oa(t,n,"BREADCRUMBS",ZRe(n)),hDe={[ns.PROMO_LINK_IMPRESSION]:uDe,[ns.PRODUCT_IMAGE_CLICKED]:z,[ns.PRODUCT_IMAGE_ZOOMED_IN]:z,[ns.PRODUCT_IMAGE_ZOOMED_OUT]:z,[ns.PRODUCT_IMAGE_CLOSED]:z,[ns.ACCESSIBILITY_IMAGE_ZOOMED_IN]:z,[ns.ACCESSIBILITY_IMAGE_ZOOMED_OUT]:z,[ns.ACCESSIBILITY_SCREEN_NAVIGATION_CLICKED]:z,[ns.ACCESSIBILITY_IMAGE_NAVIGATION_USED]:z,[ns.PRODUCT_ID]:pDe,[ns.BRAND_BUTTON_CLICKED]:z,[ns.BREADCRUMBS]:mDe};function YF(e){return[{type:"productId",value:e.productId},{type:"retailerProductId",value:e.retailerProductId}]}const gDe=(e,t,n)=>({...It,body:{catalogueNoResultsBrowseClickedEvent:{...vt(t,n),term:e.payload.term,locale:e.payload.locale}}}),EDe=(e,t,n)=>z({type:e.type,payload:{description:"Applying filter(s) causes a new page view to be displayed to the user with no results.",pageEventAttributes:e.payload.filtersFromQueryString}},t,n),fDe=(e,t,n)=>z({type:e.type,payload:{description:"The user is on a page that should have results, but applying filters produced no results, so the user clicked the button to clear filters.",pageEventAttributes:e.payload.filtersFromQueryString}},t,n),yDe=(e,t,n)=>({...It,body:{openMenuEvent:{...vt(t,n),...e.payload}}}),IDe=(e,t,n)=>{const{type:o,payload:{menuId:r}}=e;return z({type:o,payload:{description:"User clicked to open a menu",pageEventAttributes:{MENU_OPENED:r}}},t,n)},SDe=(e,t,n)=>z({type:e.type,payload:{description:"On a page view with results, the user clicked the clear all filters button.",pageEventAttributes:e.payload}},t,n),CDe=(e,t,n)=>z({type:e.type,payload:{description:"Monitors when a user clicks the Favorites filter button, showing engagement with the feature to filter search results to favorite products."}},t,n),vDe=(e,t,n)=>{const o=[Pt({},t,e.type)];return Dt(t,n,o)},TDe=(e,t,n)=>{const o=e.payload.product.at(0),r=t.data.products.productEntities[o?.productId];if(!(!r||!("favorite"in o)))return o.favorite===void 0?{...It,body:{pageEvent:{...vt(t,n),pageEventType:"MANUAL_REMOVE_FROM_FAVORITES",pageEventDescription:"User manually removed product from favorites",pageEventAttributes:YF(r)}}}:{...It,body:{pageEvent:{...vt(t,n),pageEventType:"MANUAL_ADD_TO_FAVORITES",pageEventDescription:"User manually added product to favorites",pageEventAttributes:YF(r)}}}},_De=(e,t,n)=>{const{type:o,payload:{pageEventAttributes:r}}=e;return z({type:o,payload:{description:"User clicked button to clear selected filters from the menu drop down",pageEventAttributes:r}},t,n)},bDe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the back to top button."}},t,n),xDe={[ht.CATALOGUE_ATTRIBUTES]:Oa,[ht.CATALOGUE_NO_RESULTS_BROWSE_CLICKED]:gDe,[ht.NO_FILTERED_RESULTS_RETURNED_CLEAR_FILTERS_BUTTON_CLICKED]:fDe,[ht.NO_FILTERED_RESULTS_RETURNED]:EDe,[ht.OPEN_MENU]:yDe,[ht.CLEAR_ALL_FILTERS_BUTTON_CLICKED]:SDe,[ht.OPEN_MENU_CLICKED]:IDe,[ht.FAVORITES_TAB_CLICKED]:z,[ht.LISTS_TAB_CLICKED]:z,[ht.REGULARS_TAB_CLICKED]:z,[ht.SMART_CART_TAB_CLICKED]:z,[ht.CLEAR_SELECTED_FILTERS_BUTTON_CLICKED]:_De,[xt.types.UPDATE_PRODUCTS]:TDe,[ht.SHOW_ALL_FAVORITES_FILTER_BUTTON_CLICKED]:CDe,[ht.SHOW_ALL_FAVORITES_FILTER_BUTTON_IMPRESSION]:vDe,[ht.BACK_TO_TOP_BUTTON_CLICKED]:bDe},ADe=(e,t,n)=>{const o=[Pt({CATEGORY_ID:e.payload.categoryId,EVENT_ID:e.payload.eventId,EVENT_HEADLINE:e.payload.eventHeadline},t,lu.HORIZONTAL_HERO_BANNER_IMPRESSION)];return Dt(t,n,o)},RDe=(e,t,n)=>{const o=[Pt({CATEGORY_ID:e.payload.categoryId,SUB_CATEGORY_ID:e.payload.subCategoryId,SUB_CATEGORY_NAME:e.payload.subCategoryName,SEQUENCE:e.payload.sequence},t,lu.SUB_CATEGORY_IMAGE_IMPRESSION)];return Dt(t,n,o)},DDe=(e,t,n)=>z({type:lu.SUB_CATEGORY_IMAGE_CLICKED,payload:{description:"User clicked an Events sub category",pageEventAttributes:{TYPE:e.payload.linkType,PARENT_CATEGORY_ID:e.payload.parentCategoryId,SUB_CATEGORY_ID:e.payload.subCategoryId,SUB_CATEGORY_NAME:e.payload.subCategoryName,VALUE:e.payload.value}}},t,n),ODe=(e,t,n)=>z({type:lu.CATEGORY_FILTER_OPTION_CLICKED,payload:{description:"User clicked an option in the category filter drop down",pageEventAttributes:{FILTER_OPTION_CLICKED:e.payload.categoryName}}},t,n),PDe={[rn.HORIZONTAL_HERO_BANNER_IMPRESSION]:ADe,[rn.SUB_CATEGORY_IMAGE_IMPRESSION]:RDe,[rn.SUB_CATEGORY_IMAGE_CLICKED]:DDe,[rn.CATEGORY_FILTER_OPTION_CLICKED]:ODe},NDe=(e,t,n)=>oa(t,n,"IN_CHECKOUT_WALK",[pE(n)]),V_=(e,t,n)=>z(e,t,n),LDe=(e,t,n)=>WI({...e,payload:{...e.payload,pagePartType:e.payload.pagePartType||e.type}},t,n),kDe={[Pn]:NDe,[Zn.CHECKOUT_WALK_FREE_GIFT]:LDe,[Zn.ADD_FREE_GIFT_CLICKED]:V_,[Zn.REMOVE_FREE_GIFT_CLICKED]:V_,[Zn.CONTINUE_SHOPPING_CLICKED]:V_},jDe=(e,t,n)=>({...GC(e,t,n,vr(),"APPLY_LOYALTY")}),MDe=(e,t,n)=>({...It,body:{applicableLoyaltyPageComponentEvent:{...vt(t,n),...e.payload}}}),wDe=(e,t,n)=>{const o=[Pt(e.payload.recurringShoppingDefinitionCreateFormImpression,t,Le.RECURRING_SHOPPING_DEFINITION_FORM_CARD_IMPRESSION)];return Dt(t,n,o)},FDe=(e,t,n)=>oa(t,n,Le.VOUCHERS_ADDED_TO_ORDER,e.payload.voucherIds),BDe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the voucher button"}},t,n),UDe=(e,t,n)=>z({type:e.type,payload:{description:"User checked the checkbox agreeing for delivery to be left with concierge"},...vt(t,n)},t,n),GDe=(e,t,n)=>z({type:e.type,payload:{description:"User unchecked the checkbox agreeing for delivery to be left with concierge"},...vt(t,n)},t,n),$De=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the link for the concierge T&C's"},...vt(t,n)},t,n),HDe=(e,t,n)=>z({type:e.type,payload:{description:"User has confirmed their age"}},t,n),VDe=(e,t,n)=>({...It,body:{placeOrderEvent:{...vt(t,n),status:e.payload.status,error:e.payload.error,walletItemId:e.payload.walletItemId,isRecurringShoppingDefinitionCreationRequested:e.payload.isRecurringShoppingDefinitionCreationRequested}}}),WDe=(e,t,n)=>{const{definitionId:o,name:r,frequency:a}=e.payload.recurringShoppingDefinition;return z({type:e.type,payload:{description:"User has created a recurring order",pageEventAttributes:{definitionId:o,recurringOrderName:r,recurringOrderFrequency:`${a.unit.toUpperCase()}_${a.value}`}},...vt(t,n)},t,n)},YDe=({type:e,payload:t},n,o)=>z({type:e,payload:{description:iW[e],pageEventAttributes:{...t}}},n,o),qDe=(e,t,n)=>YDe(e,t,n),KDe=(e,t,n)=>{const o=[Pt(e.payload.impression,t,e.type)];return Dt(t,n,o)},qF=(e,t,n)=>z({type:e.type,payload:{description:iW[e.type],pageEventAttributes:e.payload.pageEventAttributes}},t,n),cO=e=>(t,n)=>{const{description:o,pageEventAttributes:r}=e.payload;return z({type:e.type,payload:{description:o,pageEventAttributes:r}},t,n)},zDe=e=>cO({type:Le.LOYALTY_POINTS_BUTTON_CLICKED,payload:{description:"User clicked the Loyalty points button",pageEventAttributes:e}}),QDe=e=>cO({type:Le.LOYALTY_POINTS_DISPLAYED,payload:{description:"A modal or page to add loyalty points was displayed",pageEventAttributes:e}}),XDe=e=>{},ZDe=e=>cO({type:Le.LOYALTY_POINTS_ADD_FAILURE,payload:{description:"Loyalty points addition failed",pageEventAttributes:e}}),JDe=(e,t,n)=>{const o=[Pt(e.payload.impression,t,e.type)];return Dt(t,n,o,void 0)},eOe={[Le.APPLICABLE_LOYALTY]:em(jDe,MDe),[Le.RECURRING_SHOPPING_DEFINITION_FORM_CARD_IMPRESSION]:wDe,[Le.RECURRING_SHOPPING_DEFINITION_FREQUENCY_SELECTED]:z,[Le.RECURRING_SHOPPING_DEFINITION_LABEL_WRITTEN]:z,[Le.TOAST_NOTIFICATION_DISPLAYED]:z,[Le.PAYMENT_BUFFER_MODAL_DISPLAYED]:z,[Le.FIND_OUT_MORE_BUTTON_CLICKED]:z,[Le.VOUCHERS_ADDED_TO_ORDER]:FDe,[Le.VOUCHER_BUTTON_CLICKED]:BDe,[Le.AGE_CHECK_CONFIRMED]:HDe,[Le.PLACE_ORDER]:VDe,[Le.RECURRING_ORDER_CREATED]:WDe,[Le.PAYMENT_CHECK_BUTTON_CLICKED]:z,[Le.CONCIERGE_CHECK_BOX_CHECKED]:UDe,[Le.CONCIERGE_CHECK_BOX_UNCHECKED]:GDe,[Le.CONCIERGE_TERMS_AND_CONDITIONS_CLICKED]:$De,[Le.PHARMACY_FORM_DISPLAYED]:z,[Le.PHARMACY_FORM_DELETE_ITEM_CLICKED]:z,[Le.PHARMACY_FORM_SUBMIT_CLICKED]:z,[Le.DELIVERY_CARD_IMPRESSION]:KDe,[Le.CHANGE_DELIVERY_BUTTON_CLICKED]:qDe,[Le.SUBMIT_FEEDBACK_BUTTON_CLICKED]:qF,[Le.SUBMIT_FEEDBACK_INTERACTION]:qF,[Le.SUBMIT_FEEDBACK_IMPRESSION]:JDe,[Le.LOYALTY_POINTS_BUTTON_CLICKED]:zDe,[Le.LOYALTY_POINTS_DISPLAYED]:QDe,[Le.LOYALTY_POINTS_ADD_SUCCESS]:XDe,[Le.LOYALTY_POINTS_ADD_FAILURE]:ZDe},tOe=(e,t,n)=>Oa({payload:{attributes:{TOTAL_GRIDS:e.payload.TOTAL_GRIDS,TOTAL_CAROUSELS:e.payload.TOTAL_CAROUSELS,TOTAL_HERO_IMAGE_BANNERS:e.payload.TOTAL_HERO_IMAGE_BANNERS,ENTRY_ID:e.payload.ENTRY_ID}}},t,n),sOe=(e,t,n)=>{const o={ENTRY_ID:e.payload.ENTRY_ID,GRID_ID:e.payload.GRID_ID,GRID_LAYOUT:e.payload.GRID_LAYOUT,SEQUENCE:e.payload.SEQUENCE,GRID_TYPE:e.payload.GRID_TYPE};return e.payload.ENTRY_PUBLISHED_TIMESTAMP&&(o.ENTRY_PUBLISHED_TIMESTAMP=e.payload.ENTRY_PUBLISHED_TIMESTAMP),Dt(t,n,[Pt(o,t,"GRID_IMPRESSION")])},nOe=(e,t,n)=>{const o={ENTRY_ID:e.payload.ENTRY_ID,ENTRY_NAME:e.payload.ENTRY_NAME,GRID_ID:e.payload.GRID_ID,ITEM_TYPE:e.payload.ITEM_TYPE,ITEM_ID:e.payload.ITEM_ID,SEQUENCE:e.payload.SEQUENCE,ALT_TEXT:e.payload.ALT_TEXT};return e.payload.LINK_TYPE&&(o.LINK_TYPE=e.payload.LINK_TYPE),e.payload.LINK_VALUE&&(o.LINK_VALUE=e.payload.LINK_VALUE),e.payload.LABEL&&(o.LABEL=e.payload.LABEL),e.payload.ENTRY_PUBLISHED_TIMESTAMP&&(o.ENTRY_PUBLISHED_TIMESTAMP=e.payload.ENTRY_PUBLISHED_TIMESTAMP),Dt(t,n,[Pt(o,t,"GRID_ITEM_IMPRESSION")])},oOe=(e,t,n)=>z({type:"IMAGE_CLICKED",payload:{description:"User clicked an ad banner image displayed on the page",pageEventAttributes:{entryId:e.payload.BANNER_ID,entryName:e.payload.BANNER_NAME,location:e.payload.LOCATION,placement:e.payload.PLACEMENT,contentSource:e.payload.CONTENT_SOURCE,linkType:e.payload.LINK_TYPE,targetUrl:e.payload.TARGET_URL,segmentId:e.payload.SEGMENT_ID,sequence:e.payload.SEQUENCE}}},t,n),rOe=(e,t,n)=>{const o={ENTRY_ID:e.payload.ENTRY_ID,ENTRY_NAME:e.payload.ENTRY_NAME,SEQUENCE:e.payload.SEQUENCE,HERO_IMAGE_ID:e.payload.HERO_IMAGE_ID,LINK_TYPE:e.payload.LINK_TYPE,TARGET_URL:e.payload.TARGET_URL};return e.payload.ENTRY_PUBLISHED_TIMESTAMP&&(o.ENTRY_PUBLISHED_TIMESTAMP=e.payload.ENTRY_PUBLISHED_TIMESTAMP),Dt(t,n,[Pt(o,t,"HERO_IMAGE_BANNER_IMPRESSION")])},aOe=(e,t,n)=>z({type:"GRID_ITEM_CLICKED",payload:{description:"User Clicked on an image from the Grid",pageEventAttributes:{ENTRY_ID:e.payload.ENTRY_ID,GRID_ID:e.payload.GRID_ID,ITEM_ID:e.payload.ITEM_ID,ITEM_TYPE:e.payload.ITEM_TYPE,SEQUENCE:e.payload.SEQUENCE,LINK_TYPE:e.payload.LINK_TYPE,LINK_VALUE:e.payload.LINK_VALUE}}},t,n),iOe=(e,t,n)=>z({type:"CAROUSEL_ITEM_CLICKED",payload:{description:"User Clicked on an image from the Carousel",pageEventAttributes:{ENTRY_ID:e.payload.ENTRY_ID,GRID_ID:e.payload.GRID_ID,ITEM_ID:e.payload.ITEM_ID,ITEM_TYPE:e.payload.ITEM_TYPE,SEQUENCE:e.payload.SEQUENCE,LINK_TYPE:e.payload.LINK_TYPE,LINK_VALUE:e.payload.LINK_VALUE}}},t,n),lOe=(e,t,n)=>z({type:"NAV_MENU_CLICKED",payload:{description:"User clicked on the navigation menu button",pageEventAttributes:{TOTAL_ITEMS:e.payload.TOTAL_ITEMS}}},t,n),cOe=(e,t,n)=>z({type:"NAV_ITEM_CLICKED",payload:{description:"User clicked on a navigation item",pageEventAttributes:{ITEM_ID:e.payload.ITEM_ID,LABEL:e.payload.LABEL,ITEM_TYPE:e.payload.ITEM_TYPE,CAMPAIGN_ID:e.payload.CAMPAIGN_ID,LOCATION:e.payload.LOCATION,LINK_TYPE:e.payload.LINK_TYPE,LINK_VALUE:e.payload.LINK_VALUE}}},t,n),dOe=(e,t,n)=>Dt(t,n,[Pt({CAMPAIGN_ID:e.payload.CAMPAIGN_ID,CAMPAIGN_NAME:e.payload.CAMPAIGN_NAME,RICH_TEXT_ID:e.payload.RICH_TEXT_ID,SEQUENCE:e.payload.SEQUENCE},t,"RICH_TEXT_IMPRESSION")]),uOe=(e,t,n)=>z({type:"RICH_TEXT_LINK_CLICKED",payload:{description:"User clicked on a link within the rich text component",pageEventAttributes:{RICH_TEXT_ID:e.payload.RICH_TEXT_ID,LINK_TYPE:e.payload.LINK_TYPE,LINK_VALUE:e.payload.LINK_VALUE}}},t,n),pOe={[Ls.COMPONENTIZED_ATTRIBUTES]:tOe,[Ls.GRID_IMPRESSION]:sOe,[Ls.GRID_ITEM_IMPRESSION]:nOe,[Ls.HORIZONTAL_HERO_BANNER_CLICK]:oOe,[Ls.HORIZONTAL_HERO_BANNER_IMPRESSION]:rOe,[Ls.GRID_ITEM_CLICKED]:aOe,[Ls.CAROUSEL_ITEM_CLICKED]:iOe,[Ls.NAV_MENU_CLICKED]:lOe,[Ls.NAV_ITEM_CLICKED]:cOe,[Ls.RICH_TEXT_IMPRESSION]:dOe,[Ls.RICH_TEXT_LINK_CLICKED]:uOe},mOe="PERF_FIRST_INPUT_DELAY",dO={PERF_FIRST_INPUT_DELAY:mOe},hOe=(e,t,n)=>oa(t,n,dO.PERF_FIRST_INPUT_DELAY,e.payload.delay),gOe={[dO.PERF_FIRST_INPUT_DELAY]:hOe},EOe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"Address selection skipped"}}}),fOe=(e,t,n)=>z({type:e.type,payload:{description:"The click and collect map tried to fetch the user location",pageEventAttributes:{didLocationUpdate:e.payload.didLocationUpdate,error:e.payload.error,errorMessage:e.payload.errorMessage||""}}},t,n),yOe=(e,t,n)=>z({type:e.type,payload:{description:"The click and collect search input gained focus"}},t,n),IOe=(e,t,n)=>z({type:e.type,payload:{description:"The user selected an address",pageEventAttributes:{origin:e.payload.origin,addressId:e.payload.addressId}}},t,n),SOe=(e,t,n)=>z({type:e.type,payload:{description:"The user click on a pin on the map",pageEventAttributes:{addressId:e.payload.addressId}}},t,n),COe=(e,t,n)=>z({type:e.type,payload:{description:"The user has clicked on the home delivery tab while on the click and collect page"}},t,n),vOe=(e,t,n)=>oa(t,n,Ns.C_N_C_ADDRESS_SEARCH_TERM,e.payload.searchTerm),TOe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the homepage delivery destination card",pageEventAttributes:{deliveryMethod:e.payload.deliveryMethod}}},t,n),_Oe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the delivery destination header",pageEventAttributes:{deliveryMethod:e.payload.deliveryMethod}}},t,n),bOe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked  'Change address/ Collection point' or 'Choose collection point/ Delivery' buttons",pageEventAttributes:{existingDeliveryMethodChanged:e.payload.existingDeliveryMethodChanged,deliveryMethod:e.payload.deliveryMethod}}},t,n),xOe=(e,t,n)=>z({type:e.type,payload:{description:"The delivery destination search input gained focus"}},t,n),AOe=(e,t,n)=>z({type:e.type,payload:{description:"Map tried to fetch the user location",pageEventAttributes:{didLocationUpdate:!!e.payload.didLocationUpdate,error:!!e.payload.error,errorMessage:e.payload.errorMessage||""}}},t,n),ROe=(e,t,n)=>z({type:e.type,payload:{description:"The delivery destination modal is closed",pageEventAttributes:e.payload}},t,n),DOe=(e,t,n)=>z({type:Ns.DELIVERY_OPTION_MODAL_TRIGGERED,payload:{description:"DDS modal triggered as a result of user action",pageEventAttributes:{...e.payload}}},t,n),OOe=(e,t,n)=>{const o=[Pt(e.payload,t,"HOMEPAGE_BOX_DDS_IMPRESSION")];return Dt(t,n,o)},POe={[Ns.SKIPPED_ADDRESS_SELECTION]:EOe,[Ns.C_N_C_GEOLOCATION_EVENT]:fOe,[Ns.C_N_C_ADDRESS_SEARCH_TERM]:vOe,[Ns.C_N_C_ADDRESS_SEARCH_FOCUS]:yOe,[Ns.C_N_C_ADDRESS_SELECT]:IOe,[Ns.C_N_C_ADDRESS_PIN_CLICK]:SOe,[Ns.C_N_C_HOME_DELIVERY_TAB_CLICKED]:COe,[Ns.HOMEPAGE_DELIVERY_DESTINATION_CARD_CLICKED]:TOe,[Ns.DELIVERY_DESTINATION_HEADER_CLICKED]:_Oe,[Ns.CHANGE_ADDRESS_BUTTON_CLICKED]:bOe,[Ns.DELIVERY_DESTINATIONS_SELECTOR_SEARCH_FOCUS]:xOe,[Ns.DELIVERY_DESTINATIONS_SELECTOR_GEOLOCATION_EVENT]:AOe,[Ns.DELIVERY_DESTINATION_MODAL_CLOSED]:ROe,[Ns.DELIVERY_OPTION_MODAL_TRIGGERED]:DOe,[Ns.HOMEPAGE_BOX_DDS_IMPRESSION]:OOe},NOe=(e,t,n)=>({...It,body:{deliveryPassPlanSeenEvent:{...vt(t,n),plan:e.payload.plan,deliveryPassBenefitGroupId:e.payload.deliveryPassBenefitGroupId,bannerId:ti(n)??null}}}),LOe=(e,t,n)=>({...It,body:{deliveryPassSubscriptionStartedEvent:{...vt(t,n),plan:e.payload.plan,deliveryPassBenefitGroupId:e.payload.deliveryPassBenefitGroupId,bannerId:ti(n)??null}}}),kOe=(e,t,n)=>({...It,body:{deliveryPassTermsConditionsClickedEvent:{...vt(t,n),bannerId:ti(n)??null}}}),jOe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on a 'Try Delivery Pass' or 'Manage Delivery Pass Options' button",pageEventAttributes:{isFreeTrialEligible:e.payload.isFreeTrialEligible,isManageDeliveryPass:e.payload.isManageDeliveryPass}}},t,n),W_=(e,t,n)=>z({type:e.type,payload:{description:`User clicked on a '${e.payload.buttonName}' button`,pageEventAttributes:{subscriptionId:e.payload.subscriptionId,retailerSubscriptionPlanId:e.payload.retailerSubscriptionPlanId,string:e.payload.buttonLabel}}},t,n),MOe=(e,t,n)=>z({type:e.type,payload:{description:"A Delivery Pass plan with its price and length and per default payment details (if any) was displayed in a modal",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),wOe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the button to view all plans"}},t,n),FOe={[bs.ADD_DELIVERY_ADDRESS_SELECTED]:z,[bs.BENEFIT_GROUP_SELECTED]:z,[bs.DELIVERY_PASS_PLAN_SEEN]:NOe,[bs.DELIVERY_PASS_SUBSCRIPTION_STARTED]:LOe,[bs.DELIVERY_PASS_TERMS_CONDITIONS_CLICKED]:kOe,[bs.VIEW_ALL_PLANS_BUTTON_CLICKED]:wOe,[bs.DELIVERY_PASS_BUTTON_CLICKED]:jOe,[bs.BUY_PLAN_BUTTON_CLICKED]:W_,[bs.FREE_TRIAL_BUTTON_CLICKED]:W_,[bs.MANAGE_CURRENT_PLAN_BUTTON_CLICKED]:W_,[bs.SELECTED_DELIVERY_PASS_PLAN_MODAL_DISPLAYED]:MOe},BOe=(e,t,n)=>z({type:e.type,payload:{description:"User expanded cluster breadcrumbs",pageEventAttributes:e.payload.attributes}},t,n),UOe=e=>{const{groupType:t}=e;return["featured","featured_cross_sell","shoppable_banner"].includes((t||"").toLowerCase())},GOe=(e,t,n)=>{const o=e.payload.products.map(a=>{const{missedPromotion:i}=a,l=UOe(a),c=LC(a.productId)(n)||a.featuredProductCampaign,d={retailerProductId:a.retailerProductId,productId:a.productId,sequence:a.sequence,position:a.position,isFavorite:!!a.favorite,rankingScore:a.rankingScore,isPersonalised:!!a.isPersonalised,groupName:a.groupName,clusterName:a.clusterName,groupType:a.groupType,isInList:a.isInProductList,isRegular:!!a.regular,pageEventId:a.pageEventId};if(l&&c&&(d.campaignId=c.campaignId,d.campaignName=c.campaignName,d.advertId=c.externalAdvertId),a.ratingSummary&&(d.productStarRating=a.ratingSummary.overallRating),a.customAnalyticsData&&Object.entries(a.customAnalyticsData).forEach(([u,p])=>{d[u]=p}),a.offers){const u=a.offers.map(p=>({promotionId:p.id,promotionText:p.description,promotionType:p.type,promotionPresentation:p.presentationMode,...i?.id===p.id&&{orderId:a.orderId,missedPromotionProductsRequired:i?.requiredProductQuantity,missedPromotionProductsInBasket:i?.addedProductQuantity,missedPromotionText:i?.missedPromotionText,missedPromotionMessageType:i?.missedPromotionTextType}}));d.promotion=u}if(a.offer){const{description:u,id:p,presentationMode:g}=a.offer;d.promotionId=p,d.promotionText=u,d.promotionPresentation=g}return d}),r={};return r.productImpressionEventV3={...vt(t,n),pageViewId:e.payload.pageViewId,products:o},{...It,body:r}},$Oe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"user clicked on a promotional link",pageEventAttributes:[{type:"promotionId",value:e.payload.promotionId},{type:"productId",value:e.payload.productId},...e.payload.sequence!==void 0?[{type:"sequence",value:`${e.payload.sequence}`}]:[]]}}}),HOe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the ellipsis on a product front of pack",pageEventAttributes:{productId:e.payload.productId,retailerProductId:e.payload.retailerProductId}}},t,n),VOe=(e,t,n)=>{const{missedPromotion:{id:o,missedPromotionText:r,requiredProductQuantity:a,addedProductQuantity:i,missedPromotionTextType:l},orderId:c,productId:d,missedPromotionType:u}=e.payload;return z({type:e.type,payload:{description:"Message shown to the customer",pageEventAttributes:{productId:d,...c&&{orderId:c},missedPromotionId:o,missedPromotionType:u,missedPromotionText:r,missedPromotionProductsRequired:a,missedPromotionProductsInBasket:i,missedPromotionMessageType:l}}},t,n)},WOe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n,e),pageEventType:e.type,pageEventDescription:"User has clicked to reveal Out Of Stock Alternatives",pageEventAttributes:[{type:"productId",value:e.payload.productId},{type:"retailerProductId",value:e.payload.retailerProductId},{type:"totalCount",value:e.payload.totalCount},{type:"hideSubstitutes",value:e.payload.hideSubstitutes},{type:"productSequence",value:`${e.payload.productSequence}`}]}}}),YOe={[Jt.BREADCRUMBS_LIST_CLICKED]:z,[Jt.CLUSTER_EXPANDED]:BOe,[Jt.FOP_CLICKED]:z,[Jt.PRODUCT_IMPRESSION]:GOe,[Jt.PROMO_LINK_CLICKED]:$Oe,[Jt.ELLIPSIS_CLICKED]:HOe,[Jt.MESSAGE_ALERT_DISPLAYED]:VOe,[Jt.SHOW_SUBSTITUTES]:WOe},qOe=(e,t,n)=>({...It,body:{errorEvent:{...vt(t,n),errorType:e.payload.errorType,boundaryType:e.payload.boundaryType}}}),KOe="ERROR",VC={ERROR:KOe},zOe={[VC.ERROR]:qOe},QOe=(e,t,n)=>{const o=e.payload.navigationBarButtonImpressions.map(r=>Pt(r,t,"NAVIGATION_BAR_BUTTON"));return Dt(t,n,o)},XOe=(e,t,n)=>z({type:e.type,payload:{description:"A dropdown to select language was opened",pageEventAttributes:{userAction:e.payload.userAction,...e.payload.localeSelected&&{localeSelected:e.payload.localeSelected}}}},t,n),ZOe=(e={},t,n)=>{const{payload:{analyticsEventId:o,destinationLinkType:r,menuCampaignItemName:a,menuCampaignItemId:i,menuCampaignId:l,position:c}={},type:d}=e;return z({type:d,payload:{description:"User clicked on a menu campaign sub item",pageEventId:o,pageEventAttributes:{destinationLinkType:r,menuCampaignItemName:a,menuCampaignItemId:i,menuCampaignId:l,sequence:c}}},t,n)},JOe=(e,t,n)=>{const{menuCampaignId:o,menuCampaignItemId:r,menuCampaignItemName:a,sequence:i}=e.payload,l=[Pt({menuCampaignItemName:a,menuCampaignItemId:r,menuCampaignId:o,sequence:i},t,"MENU_CAMPAIGN_ITEM_IMPRESSION")];return Dt(t,n,l)},ePe=(e,t,n)=>{const{menuCampaignName:o,menuCampaignId:r,position:a}=e.payload,i=[Pt({menuCampaignName:o,menuCampaignId:r,sequence:a},t,"MENU_CAMPAIGN_IMPRESSION")];return Dt(t,n,i)},tPe=(e,t,n)=>z({type:"MENU_CAMPAIGN_CLICKED",payload:{description:"User clicked on a menu campaign.",pageEventId:e.payload.analyticsEventId,pageEventAttributes:{menuCampaignName:e.payload.menuCampaignName,menuCampaignId:e.payload.menuCampaignId,sequence:e.payload.position}}},t,n),sPe={[Bt.CATALOGUE_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.FAVORITES_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.COUPONS_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.LISTS_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.REGULARS_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.RECIPES_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.RECURRING_ORDERS_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.SHOP_IN_SHOP_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.MENU_CAMPAIGN_IMPRESSION]:ePe,[Bt.MENU_CAMPAIGN_CLICKED]:tPe,[Bt.DELIVERY_PASS_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.MENU_CAMPAIGN_ITEM_CLICKED]:ZOe,[Bt.MENU_CAMPAIGN_ITEM_IMPRESSION]:JOe,[Bt.NAVIGATION_BAR_BUTTON_IMPRESSION]:QOe,[Bt.OFFERS_NAVIGATION_BAR_BUTTON_CLICKED]:z,[Bt.LOCALE_DROPDOWN_OPENED]:XOe,[Bt.SMART_CART_NAVIGATION_BAR_BUTTON_CLICKED]:z},nPe=(e,t,n)=>{const{id:o,label:r,tabPosition:a,isInDropdown:i}=e.payload;return z({type:e.type,payload:{description:"User clicked top tab to be redirected to the page linked to the top tab",pageEventAttributes:{id:o,label:r,positionSeen:a,isInDropdown:i}}},t,n)},oPe=(e,t,n)=>({...It,body:{topTabImpressionsEvent:{...vt(t,n),links:e.payload.links}}}),rPe={[xi.TOP_TAB_CLICKED]:nPe,[xi.TOP_TAB_IMPRESSION]:oPe,[xi.TOP_TAB_DROPDOWN_OPENED]:z},aPe="INSTANT_SHOP_BUTTON_CLICKED",iPe="INSTANT_SHOP_MODAL_DISPLAYED",lPe="INSTANT_SHOP_ADD_TO_CART_CLICKED",dc={INSTANT_SHOP_BUTTON_CLICKED:aPe,INSTANT_SHOP_MODAL_DISPLAYED:iPe,INSTANT_SHOP_ADD_TO_CART_CLICKED:lPe},cPe={[dc.INSTANT_SHOP_BUTTON_CLICKED]:z,[dc.INSTANT_SHOP_MODAL_DISPLAYED]:z,[dc.INSTANT_SHOP_ADD_TO_CART_CLICKED]:z},hq="SET_LANGUAGE_REQUIRES_CONFIRMATION",dPe=e=>({type:hq,payload:e}),gq={setLanguageRequiresConfirmation:dPe,types:{SET_LANGUAGE_REQUIRES_CONFIRMATION:hq}},uPe={active:"",direction:"ltr",strings:{}},pPe=(e=uPe,t)=>{switch(t.type){case gq.types.SET_LANGUAGE_REQUIRES_CONFIRMATION:return{...e,languageRequiresConfirmation:t.payload};default:return e}},WC=({data:e})=>e.locale,Ms=Y(WC,e=>e.active),Eq=Y(Ms,e=>e.split("-")[0]),fq=Y(Ms,e=>e.split("-")[1]),mPe=Y(WC,e=>e.languageRequiresConfirmation),hPe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User changed locale",pageEventAttributes:[{type:"locale",value:e.payload.locale}]}}}),gPe=(e,t,n)=>z({type:e.type,payload:{description:"A modal to select language was displayed",pageEventAttributes:{userAction:e.payload.userAction,...e.payload.localeSelected&&{localeSelected:e.payload.localeSelected}}}},t,n),EPe=(e,t,n)=>oa(t,n,"LOCALE",Ms(t)),fPe={[Pn]:EPe,[_r.LOCALE_CHANGED]:hPe,[_r.LOCALE_MODAL_DISPLAYED]:gPe},yPe={[aO.PERFORMANCE]:z},IPe=e=>-1*e.quantity.quantityInBasket,SPe=e=>e.data.basket?.totals?.display?.itemPriceAfterPromos?.currency,CPe=e=>({amount:0,currency:SPe(e)});function vPe(e,t,n){return e.payload&&e.payload.basketFinalPrice?e.payload.product.filter(o=>o.totalAmount!==void 0).map(o=>{const r=$C({basketId:t.data.basket.basketId,basketTotalValue:e.payload.basketFinalPrice,updateQuantity:o.addedAmount,totalQuantity:o.totalAmount,prevState:t,nextState:n,product:o,addedByFunction:e.payload.addedByFunction,addedFromSection:e.payload.section});return{...It,...r}}):[]}function TPe(e,t,n){return e.payload.productsRemoved.map(o=>{const r=t.data.products.productEntities[o.productId],a=$C({basketId:t.data.basket.basketId,basketTotalValue:CPe(t),updateQuantity:IPe(o),totalQuantity:0,prevState:t,nextState:n,product:r,addedByFunction:e.payload.addedByFunction,addedFromSection:e.payload.section});return{...It,...a}})}const _Pe=(e,t,n)=>z({type:e.type,payload:{description:"A modal was shown to confirm discarding changes to an edited order",pageEventAttributes:{orderId:e.payload.orderId,userAction:e.payload.userAction}}},t,n),bPe=(e,t,n)=>z({type:e.type,payload:{description:"A modal was shown to cancel an upcoming order",pageEventAttributes:{orderId:e.payload.orderId,userAction:e.payload.userAction}}},t,n),xPe=(e,t,n)=>{const o=vPe(e,t,n),r=TPe(e,t,n);return[...o,...r]},APe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the edit order button",pageEventAttributes:{orderId:e.payload.orderId}}},t,n),RPe=(e,t,n)=>{const{orderId:o,status:r,pageEventId:a}=e.payload;return z({type:Gs.EDIT_PAGE_SLOT_BOOKING_CARD_CLICKED,payload:{description:"User clicked slot changing card on order-details",pageEventAttributes:{orderId:o,status:r},pageEventId:a}},t,n)},DPe={[Gs.BUY_ALL_PRODUCTS]:xPe,[Gs.CANCEL_ORDER_MODAL_DISPLAYED]:bPe,[Gs.DISCARD_CHANGES_MODAL_DISPLAYED]:_Pe,[Gs.EDIT_ORDER_BUTTON_CLICKED]:APe,[Gs.EDIT_PAGE_SLOT_BOOKING_CARD_CLICKED]:RPe,[Gs.EDIT_ORDER_PAGE_VIEW_EVENT]:WI},OPe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User clicked the continue shopping button"}}}),PPe="CONTINUE_SHOPPING_BUTTON_CLICKED",yq={CONTINUE_SHOPPING_BUTTON_CLICKED:PPe},NPe={[yq.CONTINUE_SHOPPING_BUTTON_CLICKED]:OPe},LPe=(e,t,n)=>({...It,body:{addFundingInstrumentEvent:{...vt(t,n),action:e.payload.event,walletItemId:e.payload.walletItemId}}}),kPe=(e,t,n)=>({...It,body:{addWalletItemRequestEvent:{...vt(t,n),type:e.payload.event,resultToken:e.payload.resultToken}}}),jPe=(e,t,n)=>({...It,body:{failedPaymentEvent:{...vt(t,n),orderId:e.payload.orderId}}}),MPe=(e,t,n)=>({...It,body:{failedPaymentSuccessEvent:{...vt(t,n),orderId:e.payload.orderId}}}),wPe=(e,t,n)=>({...It,body:{failedPaymentWarningAlertEvent:{...vt(t,n)}}}),FPe=(e,t,n)=>({...It,body:{failedPaymentWarningAlertLinkClickedEvent:{...vt(t,n)}}}),BPe=(e,t,n)=>({...It,body:{failedPaymentWarningModalEvent:{...vt(t,n)}}}),UPe=(e,t,n)=>({...It,body:{failedPaymentWarningModalUpdatePaymentDetailsButtonClickedEvent:{...vt(t,n)}}}),GPe=(e,t,n)=>({...GC(e,t,n,vr(),"PAYMENT_CHECKS")}),$Pe=(e,t,n)=>z({type:"PAYMENT_CHECK_MODAL_DISPLAYED",payload:{description:"Payment check modal displayed",pageEventAttributes:{...e.payload}}},t,n),HPe=(e,t,n)=>{const{customerId:o,orderId:r,paymentChecks:a}=e.payload,i=[],l=({paymentCheckAmount:c,paymentCheckId:d,expiryDate:u,increaseInTotalRequiredBeforeCheckIsAvailable:p,isAvailable:g})=>({...It,body:{paymentCheckEvent:{...vt(t,n),orderId:r,customerId:o,paymentCheckAmount:c.amount,paymentCheckCurrency:c.currency,paymentCheckId:d,expiryDate:u,isAvailable:g,remainingToApply:p&&p.amount}}});return a.availablePaymentChecks&&a.availablePaymentChecks.forEach(c=>{c&&i.push(l({...c,isAvailable:!0}))}),a.checksMissingRequiredTotal&&a.checksMissingRequiredTotal.forEach(c=>{i.push(l({...c,isAvailable:!1}))}),i},VPe=(e,t,n)=>{const o=e.payload.walletItemImpressions.map(r=>Pt(r,t,"WALLET_ITEM_IMPRESSION"));return Dt(t,n,o)},WPe=(e,t,n)=>z({type:e.type,payload:{description:"The payment methods available were displayed",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),YPe=(e,t,n)=>z({type:e.type,payload:{description:"The details for the payment method chosen were displayed",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),qPe=(e,t,n)=>({...It,body:{unauthorizedPostMessageAttemptEvent:{...vt(t,n),description:`Unauthorized postMessage attempt from origin: ${e.payload.origin}.`,bannerId:ti(n)}}}),KPe={[Ot.ADD_WALLET_ITEM]:LPe,[Ot.BACK_TO_SHOP]:z,[Ot.FAILED_PAYMENT]:jPe,[Ot.FAILED_PAYMENT_SUCCESS]:MPe,[Ot.FAILED_PAYMENT_WARNING_ALERT]:wPe,[Ot.FAILED_PAYMENT_WARNING_ALERT_LINK_CLICKED]:FPe,[Ot.FAILED_PAYMENT_WARNING_MODAL]:BPe,[Ot.FAILED_PAYMENT_WARNING_MODAL_UPDATE_PAYMENT_DETAILS_BUTTON_CLICKED]:UPe,[Ot.PAYMENT_CHECK_ADD_MODAL_DISPLAYED]:em(GPe,$Pe),[Ot.PAYMENT_CHECKS_AVAILABILITY_FETCHED_ANALYTICS]:HPe,[Ot.ADD_PAYMENT_METHOD_MODAL_DISPLAYED]:WPe,[Ot.PAYMENT_METHOD_DETAILS_MODAL_DISPLAYED]:YPe,[Ot.WALLET_ITEM_IMPRESSION]:VPe,[Ot.SELECT_WALLET_ITEM]:z,[Ot.ADD_WALLET_ITEM_REQUEST]:kPe,[Ot.UNAUTHORIZED_POST_MESSAGE_ATTEMPT]:qPe},zPe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:mt.RECURRING_ORDER_CARD_CLICKED,pageEventDescription:"The user clicked on the recurring order card"}}}),QPe=(e,t,n)=>z({type:mt.RECURRING_ORDER_CANCEL_MODAL_EVENT,payload:{description:"The recurring shopping definition cancel modal is displayed to the user",pageEventAttributes:{userAction:e.payload.userAction,definitionID:e.payload.definitionID}}},t,n),XPe=(e,t,n)=>z({type:mt.PLACEHOLDER_RECURRING_ORDER_DETAILS_CANCEL_MODAL_EVENT,payload:{description:"The upcoming recurring order cancel modal is displayed to the user",pageEventAttributes:{userAction:e.payload.userAction,definitionID:e.payload.definitionID,referenceID:e.payload.referenceID}}},t,n),ZPe=(e,t,n)=>z({type:mt.MANAGE_RECURRING_ORDER_BUTTON_CLICKED,payload:{description:"The user clicked the manage recurring order button",pageEventAttributes:{definitionId:e.payload.definitionId}}},t,n),JPe=(e,t,n)=>z({type:mt.EDIT_PAYMENT_BUTTON_CLICKED,payload:{description:"User clicks edit payment in order page",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),eNe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks cancel recurring order in order page",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),tNe=(e,t,n)=>z({type:mt.CANCEL_SELECTED_RECURRING_ORDERS_BUTTON_CLICKED,payload:{description:"User clicks cancel selected orders in order page",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),sNe=(e,t,n)=>z({type:mt.CHECKBOX_FOR_UPCOMING_RECURRING_ORDERS_CLICKED,payload:{description:"User clicks checkbox for upcoming orders",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),nNe=(e,t,n)=>z({type:mt.CLEAR_SELECTED_BUTTON_CLICKED,payload:{description:"User clicks clear selected button",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),oNe=(e,t,n)=>z({type:mt.CONFIRM_RECURRING_ORDER_CANCELLATION_MODAL_DISPLAYED,payload:{description:"A modal for confirm order cancellation or not",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),rNe=(e,t,n)=>z({type:mt.CONFIRMED_RECURRING_ORDER_CANCEL_MODAL,payload:{description:"User clicks yes in confirm order cancellation modal",pageEventAttributes:{definitionID:e.payload.definitionId,referenceIds:e.payload.referenceIds}}},t,n),aNe=(e,t,n)=>z({type:mt.NO_BUTTON_CLICKED,payload:{description:"User clicks no in confirm order cancellation modal",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),iNe=(e,t,n)=>z({type:mt.CHOOSE_PAYMENT_METHOD_MODAL_DISPLAYED,payload:{description:"A modal for choose payment method",pageEventAttributes:{definitionID:e.payload.definitionId}}},t,n),lNe=(e,t,n)=>z({type:mt.RECURRING_ORDER_DAY_AND_TIME_MODAL_DISPLAYED,payload:{description:"A modal with recurring order day and time displayed",pageEventAttributes:e.payload}},t,n),cNe=(e,t,n)=>z({type:mt.RECURRING_ORDER_TIME_REJECTED_FROM_DROPDOWN,payload:{description:"The user was shown slot not available message for time selection drop down",pageEventAttributes:e.payload}},t,n),dNe=(e,t,n)=>z({type:mt.RECURRING_ORDER_DAY_AND_TIME_SAVED,payload:{description:"The recurring order definition day and time changes were saved by the user",pageEventAttributes:e.payload}},t,n),uNe=(e,t,n)=>z({type:mt.RECURRING_ORDER_DAY_AND_TIME_MODAL_CLOSED,payload:{description:"A modal with recurring order day and time closed",pageEventAttributes:e.payload}},t,n),pNe={[mt.RECURRING_ORDER_CARD_CLICKED]:zPe,[mt.RECURRING_ORDER_CANCEL_MODAL_EVENT]:QPe,[mt.PLACEHOLDER_RECURRING_ORDER_DETAILS_CANCEL_MODAL_EVENT]:XPe,[mt.NO_BUTTON_CLICKED]:aNe,[mt.CONFIRMED_RECURRING_ORDER_CANCEL_MODAL]:rNe,[mt.CONFIRM_RECURRING_ORDER_CANCELLATION_MODAL_DISPLAYED]:oNe,[mt.CLEAR_SELECTED_BUTTON_CLICKED]:nNe,[mt.CHECKBOX_FOR_UPCOMING_RECURRING_ORDERS_CLICKED]:sNe,[mt.CANCEL_SELECTED_RECURRING_ORDERS_BUTTON_CLICKED]:tNe,[mt.CANCEL_RECURRING_ORDER_BUTTON_CLICKED]:eNe,[mt.EDIT_PAYMENT_BUTTON_CLICKED]:JPe,[mt.MANAGE_RECURRING_ORDER_BUTTON_CLICKED]:ZPe,[mt.CHOOSE_PAYMENT_METHOD_MODAL_DISPLAYED]:iNe,[mt.RECURRING_ORDER_DAY_AND_TIME_MODAL_DISPLAYED]:lNe,[mt.RECURRING_ORDER_TIME_REJECTED_FROM_DROPDOWN]:cNe,[mt.RECURRING_ORDER_DAY_AND_TIME_SAVED]:dNe,[mt.RECURRING_ORDER_DAY_AND_TIME_MODAL_CLOSED]:uNe},mNe={},hNe=(e=mNe,t)=>{switch(t.type){case Cs.SEARCH_SUGGESTION_CLICKED:case Cs.SEARCH_SUGGESTION_CHOSEN:{const{id:n}=t.payload;return{triggerEvent:{id:n,type:"SUGGESTION_SEARCH"}}}case Cs.SEARCH_FORM_SUBMISSION:return{triggerEvent:{id:void 0,type:"TEXT_SEARCH"}};case Cs.BANNER_CLICKED:return{triggerEvent:{id:t.payload.analyticsEventId,type:"BANNER"}};case Bt.MENU_CAMPAIGN_ITEM_CLICKED:return{triggerEvent:{id:t.payload?.analyticsEventId,type:t.payload?.source}};default:return e}},gNe=({data:e})=>e.search.analytics.triggerEvent,ENe=(e,t,n)=>({...It,body:{searchSuggestionClickedEvent:{...vt(t,n),id:e.payload.id,userInput:e.payload.userInput,searchSuggestion:e.payload.searchSuggestion,locale:e.payload.locale,positionInSuggestionList:e.payload.positionInSuggestionList}}}),fNe=(e,t,n)=>{const{id:o}=gNe(n)||{},{searchTerm:r,correctedSearchTerm:a,locale:i,mlModelIds:l,sort:c,searchSuggestionType:d}=e.payload,u=IC(n);return{...It,body:{searchViewEvent:{...vt(t,n),id:ct(),searchTerm:r,correctedSearchTerm:a,locale:i,...o&&{sourceEventId:o},mlModelIds:l,sort:c,source:u?"REFRESHED":d}}}},yNe=(e,t,n)=>{const{searchTerm:o,redirectURL:r,locale:a,id:i}=e.payload;return{...It,body:{searchRedirectEvent:{...vt(t,n),id:i,searchTerm:o,redirectURL:r,locale:a}}}},INe=e=>Object.keys(e).reduce((t,n)=>n==="id"?t:[...t,{type:n,value:e[n]}],[]),SNe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User clicked a search suggestion shown to them to trigger a search.",pageEventAttributes:INe(e.payload)}}}),CNe=(e,t,n)=>{const o=e.payload.searchSuggestionImpressions.map(r=>Pt({searchTerm:r.searchTerm,sequence:r.sequence,searchSuggestionType:r.searchSuggestionType??e.payload.searchSuggestionType,location:r.location},t,e.type));return Dt(t,n,o,e.payload.pageViewId)},vNe={[Cs.SEARCH_PAGE_VIEWED]:fNe,[Cs.SEARCH_SUGGESTION_CHOSEN]:ENe,[Cs.SEARCH_REDIRECT]:yNe,[Cs.SEARCH_SUGGESTION_CLICKED]:SNe,[Cs.SEARCH_SUGGESTION_IMPRESSION]:CNe},TNe=(e,t,n)=>{const o=[Pt({SHOP_IN_SHOP_ID:e.payload.shopInShopId,SHOP_IN_SHOP_HEADLINE:e.payload.shopInShopHeadline},t,Jp.HORIZONTAL_HERO_BANNER_IMPRESSION)];return Dt(t,n,o)},_Ne=(e,t,n)=>{const o=[Pt({SUB_CATEGORY_ID:e.payload.subCategoryId,SUB_CATEGORY_NAME:e.payload.subCategoryName,SEQUENCE:e.payload.sequence},t,Jp.SUB_CATEGORY_IMAGE_IMPRESSION)];return Dt(t,n,o)},bNe=(e,t,n)=>z({type:Jp.SUB_CATEGORY_IMAGE_CLICKED,payload:{description:"User clicked an Shop in Shop sub category",pageEventAttributes:{TYPE:e.payload.linkType,VALUE:e.payload.value,SUB_CATEGORY_ID:e.payload.subCategoryId,SUB_CATEGORY_NAME:e.payload.subCategoryName}}},t,n),xNe={[Ea.HORIZONTAL_HERO_BANNER_IMPRESSION]:TNe,[Ea.SUB_CATEGORY_IMAGE_IMPRESSION]:_Ne,[Ea.SUB_CATEGORY_IMAGE_CLICKED]:bNe},ANe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the delivery pass tab"}},t,n),RNe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the Receipt button"}},t,n),DNe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the button to edit the payment details"}},t,n),ONe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the button to change the auto-renewal status",pageAttributesEvent:{type:"string",value:e.payload.autoRenewalStatus}}},t,n),PNe=(e,t,n)=>z({type:e.type,payload:{description:"The modal to enable the auto renewal Free Delivery Pass was displayed",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),NNe=(e,t,n)=>z({type:e.type,payload:{description:"The modal to cancel the auto renewal of the Delivery Pass plan was displayed",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),LNe=(e,t,n)=>z({type:e.type,payload:{description:"The modal to confirm the change of Delivery Pass plan was displayed",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),kNe=(e,t,n)=>z({type:e.type,payload:{description:"The subscribed Delivery Pass plan summary was displayed",pageEventAttributes:{type:"userAction",value:e.payload.userAction}}},t,n),jNe=(e,t,n)=>Oa({payload:{attributes:{CURRENT_SUBSCRIPTION_ID:e.payload.CURRENT_SUBSCRIPTION_ID}}},t,n),MNe="DELIVERY_PASS_SETTINGS_TAB_CLICKED",wNe="DELIVERY_PASS_RECEIPT_BUTTON_CLICKED",FNe="EDIT_PAYMENT_DETAILS_BUTTON_CLICKED",BNe="AUTO_RENEWAL_BUTTON_CLICKED",UNe="ENABLE_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED",GNe="CANCEL_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED",$Ne="CHANGE_DELIVERY_PASS_PLAN_MODAL_DISPLAYED",HNe="DELIVERY_PASS_SUBSCRIBED_PLAN_MODAL_DISPLAYED",Xn={DELIVERY_PASS_SETTINGS_TAB_CLICKED:MNe,DELIVERY_PASS_RECEIPT_BUTTON_CLICKED:wNe,EDIT_PAYMENT_DETAILS_BUTTON_CLICKED:FNe,AUTO_RENEWAL_BUTTON_CLICKED:BNe,ENABLE_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED:UNe,CANCEL_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED:GNe,CHANGE_DELIVERY_PASS_PLAN_MODAL_DISPLAYED:$Ne,DELIVERY_PASS_SUBSCRIBED_PLAN_MODAL_DISPLAYED:HNe},VNe={[Xn.DELIVERY_PASS_SETTINGS_TAB_CLICKED]:ANe,[Xn.DELIVERY_PASS_RECEIPT_BUTTON_CLICKED]:RNe,[Xn.EDIT_PAYMENT_DETAILS_BUTTON_CLICKED]:DNe,[Xn.AUTO_RENEWAL_BUTTON_CLICKED]:ONe,[Xn.ENABLE_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED]:PNe,[Xn.CANCEL_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED]:NNe,[Xn.CHANGE_DELIVERY_PASS_PLAN_MODAL_DISPLAYED]:LNe,[Xn.DELIVERY_PASS_SUBSCRIBED_PLAN_MODAL_DISPLAYED]:kNe,[Xn.CURRENT_SUBSCRIPTION_ID]:jNe},WNe="LIST_CARD_IMPRESSION",YNe="PRODUCT_ADDED_TO_LIST",qNe="PRODUCT_REMOVED_FROM_LIST",KNe="LIST_CREATED",zNe="LIST_NAME_CHANGED",QNe="LIST_DELETED",XNe="LIST_ACTIONS_MODAL_DISPLAYED",ZNe="EMPTY_LIST_PRODUCT_SEARCH_CLICKED",JNe="ADD_ALL_TO_TROLLEY_BUTTON_CLICKED",eLe="DELETE_LIST_MODAL_DISPLAYED",tLe="EDIT_NAME_MODAL_DISPLAYED",sLe="LIST_ID",nLe="LIST_TOTAL_COUNT",oLe="ADD_TO_FEATURE_MODAL_DISPLAYED",ls={LIST_CARD_IMPRESSION:WNe,PRODUCT_ADDED_TO_LIST:YNe,PRODUCT_REMOVED_FROM_LIST:qNe,LIST_CREATED:KNe,LIST_NAME_CHANGED:zNe,LIST_DELETED:QNe,LIST_ACTIONS_MODAL_DISPLAYED:XNe,EMPTY_LIST_PRODUCT_SEARCH_CLICKED:ZNe,ADD_ALL_TO_TROLLEY_BUTTON_CLICKED:JNe,DELETE_LIST_MODAL_DISPLAYED:eLe,EDIT_NAME_MODAL_DISPLAYED:tLe,LIST_ID:sLe,LIST_TOTAL_COUNT:nLe,ADD_TO_FEATURE_MODAL_DISPLAYED:oLe},rLe=(e,t,n)=>{const o=[Pt(e.payload.listCardImpression,t,"LIST_IMPRESSION")];return Dt(t,n,o)},aLe=(e,t,n)=>z({type:e.type,payload:{description:"A product was added to a list",pageEventAttributes:{listId:e.payload.listId,productId:e.payload.productId,retailerProductId:e.payload.retailerProductId,quantity:1}}},t,n),iLe=(e,t,n)=>z({type:e.type,payload:{description:"A product was removed from a list",pageEventAttributes:{listId:e.payload.listId,productId:e.payload.productId,retailerProductId:e.payload.retailerProductId,quantity:1}}},t,n),lLe=(e,t,n)=>z({type:e.type,payload:{description:"A new list was created",pageEventAttributes:{listId:e.payload.listId}}},t,n),cLe=(e,t,n)=>z({type:e.type,payload:{description:"The name of a list was changed",pageEventAttributes:{listId:e.payload.listId}}},t,n),dLe=(e,t,n)=>z({type:e.type,payload:{description:"A list was deleted",pageEventAttributes:{listId:e.payload.listId}}},t,n),uLe=(e,t,n)=>z({type:e.type,payload:{description:"A modal to delete or edit the name of a list was displayed",pageEventAttributes:{listId:e.payload.listId,userAction:e.payload.userAction}}},t,n),pLe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked to add all items to trolley ",pageEventAttributes:{...e.payload.listId&&{listId:e.payload.listId}},pageEventId:e.payload.sourceEventId}},t,n),mLe=(e,t,n)=>z({type:e.type,payload:{description:"A modal to delete a list was displayed",pageEventAttributes:{listId:e.payload.listId,userAction:e.payload.userAction}}},t,n),hLe=(e,t,n)=>z({type:e.type,payload:{description:"A modal to edit the name of a list was displayed",pageEventAttributes:{listId:e.payload.listId,userAction:e.payload.userAction}}},t,n),gLe=(e,t,n)=>z({type:e.type,payload:{description:"A more options was displayed",pageEventAttributes:{productId:e.payload.productId,retailerProductId:e.payload.retailerProductId}}},t,n),ELe=(e,t,n)=>oa(t,n,ls.LIST_TOTAL_COUNT,e.payload.count),fLe=(e,t,n)=>oa(t,n,ls.LIST_ID,e.payload.listId),yLe={[ls.LIST_CARD_IMPRESSION]:rLe,[ls.PRODUCT_ADDED_TO_LIST]:aLe,[ls.PRODUCT_REMOVED_FROM_LIST]:iLe,[ls.LIST_CREATED]:lLe,[ls.LIST_DELETED]:dLe,[ls.LIST_NAME_CHANGED]:cLe,[ls.LIST_ACTIONS_MODAL_DISPLAYED]:uLe,[ls.EMPTY_LIST_PRODUCT_SEARCH_CLICKED]:z,[ls.ADD_ALL_TO_TROLLEY_BUTTON_CLICKED]:pLe,[ls.DELETE_LIST_MODAL_DISPLAYED]:mLe,[ls.EDIT_NAME_MODAL_DISPLAYED]:hLe,[ls.ADD_TO_FEATURE_MODAL_DISPLAYED]:gLe,[ls.LIST_TOTAL_COUNT]:ELe,[ls.LIST_ID]:fLe},ILe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"The slot booking modal was displayed",pageEventAttributes:[{type:"hasOutOfStock",value:e.payload.hasOutOfStock}]}}}),SLe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User clicked on the calendar date selector."}}}),CLe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User selected a date from the calendar."}}}),vLe=(e,t,n)=>({...It,body:{pageEvent:{...vt(t,n),pageEventType:e.type,pageEventDescription:"User is displayed a notification stating they have no saved address"}}}),TLe=(e,t,n)=>{const o=[Pt(e.payload.alertImpression,t,"ALERT_IMPRESSION")];return Dt(t,n,o)},_Le=(e,t,n)=>{const{slot:o}=e.payload,r={SLOT_ID:o.slotId,SLOT_TYPE:o.type,ORDER_ID:e.orderId,...e.carrierName&&{CARRIER_NAME:e.carrierName}};return z({type:e.type,payload:{description:"User booked a slot",pageEventAttributes:r}},t,n)},bLe=(e,t,n)=>z({type:e.type,payload:{description:e.payload.description,pageEventAttributes:{deliveryMethod:e.payload.deliveryMethod}}},t,n),KF=(e,t,n)=>z({type:e.type,payload:{description:e.payload.description,pageEventAttributes:{deliveryMethod:e.payload.deliveryMethod,deliveryDestinationId:e.payload.deliveryDestinationId}}},t,n),xLe=(e,t,n)=>z({type:e.type,payload:{description:e.payload.description,pageEventAttributes:{deliveryMethod:e.payload.deliveryMethod}}},t,n),zF=(e,t,n)=>z({type:e.type,payload:{description:Wr[e.type]}},t,n),QF=(e,t,n)=>z({type:e.type,payload:{description:e.payload.description}},t,n),ALe=(e,t,n)=>{const o=e.payload.impressions?.map(r=>Pt(r,t,e.type));return Dt(t,n,o)},RLe=(e,t,n)=>{const o=Pt({seasonalSlotPeriodId:e.payload.seasonalSlotPeriodId},t,e.type);return Dt(t,n,[o])},DLe=(e,t,n)=>z({type:e.type,payload:{description:Wr[e.type],pageEventAttributes:{userAction:e.payload.userAction}}},t,n),OLe=(e,t,n)=>Oa({payload:{attributes:{[e.type]:"NoAddressNoOrderHistory"}}},t,n),PLe=({type:e,payload:t},n,o)=>{const{RETAILER_CUSTOMER_ID:r,...a}=t;return z({type:e,payload:{description:Wr[e],pageEventAttributes:{CUSTOMER_ID:r,...a}}},n,o)},Nl=({type:e,payload:t},n,o)=>z({type:e,payload:{description:Wr[e],pageEventAttributes:{...t}}},n,o),NLe=(e,t,n)=>Nl(e,t,n),LLe=(e,t,n)=>Nl(e,t,n),kLe=(e,t,n)=>Nl(e,t,n),jLe=(e,t,n)=>{const o=e.payload.impressions.map(r=>Pt(r,t,e.type));return Dt(t,n,o)},MLe=(e,t,n)=>Nl(e,t,n),wLe=(e,t,n)=>Nl(e,t,n),FLe=(e,t,n)=>Nl(e,t,n),BLe=(e,t,n)=>Nl(e,t,n),ULe=(e,t,n)=>Nl(e,t,n),GLe=(e,t,n)=>Nl(e,t,n),Vx={DELIVERY_OPTIONS_CLICKED:"DELIVERY_OPTIONS_CLICKED",DELIVERY_OPTIONS_INCOMPLETE:"DELIVERY_OPTIONS_INCOMPLETE"},ah={DROP_OFF:"DROP_OFF",ENTRY_INSTRUCTIONS:"ENTRY_INSTRUCTIONS",DELIVERY_ASSETS:"DELIVERY_ASSETS",ADDITIONAL_INFORMATION:"ADDITIONAL_INFORMATION",API_ERROR:"API_ERROR"},XF={CONFIRMED:"CONFIRMED",CLOSED:"CLOSED"},$Le=({type:e,payload:t},n,o)=>{const{trigger:r,deliveryInstructionsEnabled:a,unattendedDeliveryEnabled:i,assetChoiceEnabled:l,dropOffOptionsSelected:c,errorDisplayed:d,modalClosed:u}=t;return z({type:e,payload:{description:Wr[e],pageEventAttributes:{trigger:r,deliveryInstructionsEnabled:a,unattendedDeliveryEnabled:i,assetChoiceEnabled:l,...c?{dropOffOptionsSelected:c}:{},...d?{errorDisplayed:d}:{},modalClosed:u}}},n,o)},HLe=({payload:e},t,n)=>Oa({payload:{attributes:{DELIVERY_OPTIONS:e.selectedDropOff}}},t,n),VLe=({type:e,payload:t},n,o)=>{const{deliveryAssetId:r,preselectedDeliveryAssetId:a}=t;return z({type:e,payload:{description:Wr[e],pageEventAttributes:{deliveryAssetId:r,...a?{preselectedDeliveryAssetId:a}:{}}}},n,o)},WLe={[Ve.SLOT_IMPRESSION]:ALe,[Ve.ALERT_IMPRESSION]:TLe,[Ve.SLOT_BOOKING_MODAL_DISPLAYED]:ILe,[Ve.SLOT_BOOKED]:_Le,[Ve.ADDRESS_SELECTION_DROP_DOWN_CLICKED]:bLe,[Ve.ADDRESS_FROM_DROP_DOWN_SELECTED]:KF,[Ve.COLLECTION_POINT_FROM_DROP_DOWN_SELECTED]:KF,[Ve.CHOOSE_DIFFERENT_COLLECTION_POINT_BUTTON_CLICKED]:xLe,[Ve.ITEM_WINDOW_REDUCED]:zF,[Ve.ITEM_WINDOW_EXPANDED]:zF,[Ve.STANDARD_SLOTS_BUTTON_CLICKED]:QF,[Ve.SAVER_SLOTS_BUTTON_CLICKED]:QF,[Ve.MAP_RENDERED_REASON]:OLe,[Ve.CARRIER_SELECTION_CLICKED]:PLe,[Ve.CONTINUE_CHECKOUT_BUTTON_CLICKED]:NLe,[Ve.CHOOSE_CARRIER_MODAL_DISPLAYED]:LLe,[Ve.SELECT_PICK_UP_POINT_BUTTON_CLICKED]:kLe,[Ve.CARRIER_SELECTION_CARD_IMPRESSION]:jLe,[Ve.EXTERNAL_COLLECTION_POINT_SELECT_BUTTON_CLICKED]:GLe,[Ve.SHIPPING_METHOD_NOT_VALID_MODAL_DISPLAYED]:MLe,[Ve.SELECT_SHIPPING_METHOD_BUTTON_CLICKED]:wLe,[Ve.CHANGE_DELIVERY_METHOD_MODAL_DISPLAYED]:FLe,[Ve.CONTINUE_AND_SEE_TROLLEY_BUTTON_CLICKED]:BLe,[Ve.CHANGE_DELIVERY_METHOD_CANCEL_BUTTON_CLICKED]:ULe,[Ve.DELIVERY_DETAILS_MODAL_DISPLAYED]:$Le,[Ve.DELIVERY_OPTIONS_VIEWED]:HLe,[Ve.DELIVERY_ASSET_CHANGED]:VLe,[Ve.SEASONAL_SLOTS_BANNER_IMPRESSION]:RLe,[Ve.SEASONAL_SLOTS_BANNER_CLICKED]:DLe,[Ve.SLOTBOOKING_NO_SAVED_ADDRESS_DISPLAYED]:vLe,[Ve.CALENDAR_CLICKED_EVENT]:SLe,[Ve.CALENDAR_DATE_SELECTED_EVENT]:CLe},YLe=(e,t,n)=>{const{entryId:o,contentBlockType:r,entryName:a,linkType:i,targetUrl:l,advertId:c,applyDescriptionByType:d=""}=e.payload;let u="User clicked a Content Block html content";return d&&(u=d==="HEADER"?"User clicked a Content Block Header":"User clicked a Content Block in Page"),z({type:e.type,payload:{description:u,pageEventAttributes:{entryId:o,contentBlockType:r,entryName:a,linkType:i,targetUrl:l,advertId:c}}},t,n)},qLe=(e,t,n)=>{const o=[Pt(e.payload.contentBlockImpression,t,"CONTENT_BLOCK_IMPRESSION")];return Dt(t,n,o)},KLe=(e,t,n)=>{const{entryId:o,entryName:r,advertId:a}=e.payload;return z({type:e.type,payload:{description:"User clicked on the close button on a Content Block",pageEventAttributes:{entryId:o,entryName:r,advertId:a}}},t,n)},zLe={[fa.CONTENT_BLOCK_CLICKED]:YLe,[fa.CONTENT_BLOCK_IMPRESSION]:qLe,[fa.CONTENT_BLOCK_CLOSE_BUTTON_CLICKED]:KLe},QLe="SUMMARY_COMPONENT_EXPANDED",XLe="SUMMARY_COMPONENT_COLLAPSED",ZLe="DELIVERY_PASS_LINK_SHOW_IN_COMPONENT",JLe="DELIVERY_PASS_COMPONENT_CLICKED",Fo={SUMMARY_COMPONENT_EXPANDED:QLe,SUMMARY_COMPONENT_COLLAPSED:XLe,DELIVERY_PASS_LINK_SHOW_IN_COMPONENT:ZLe,DELIVERY_PASS_COMPONENT_CLICKED:JLe},eke=(e,t,n)=>Oa({payload:{attributes:{DELIVERY_PASS_LINK_SHOW_IN_COMPONENT:e.payload.value}}},t,n),tke=(e,t,n)=>z({type:e.type,payload:{description:"The user clicked on the Delivery Pass component"}},t,n),ske={[Fo.SUMMARY_COMPONENT_EXPANDED]:z,[Fo.SUMMARY_COMPONENT_COLLAPSED]:z,[Fo.DELIVERY_PASS_LINK_SHOW_IN_COMPONENT]:eke,[Fo.DELIVERY_PASS_COMPONENT_CLICKED]:tke},nke=(e,t,n)=>{const{orderId:o,status:r,pageEventId:a}=e.payload;return z({type:Xt.HOMEPAGE_SLOT_BOOKING_CARD_CLICKED,payload:{description:"User clicked on the homepage left-hand card",pageEventAttributes:{orderId:o,status:r},pageEventId:a}},t,n)},oke=(e,t,n)=>{const{PAGE_EVENT_ID:o,...r}=e.payload.data||{};return z({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,payload:{description:"User clicked on the homepage upcoming order card",pageEventAttributes:{...r},pageEventId:o}},t,n)},rke=(e,t,n)=>{const{pageEventId:o,...r}=e.payload.data||{};return z({type:Xt.MULTIPLE_UPCOMING_ORDERS_CARD_CLICKED,payload:{description:"User clicked on the card indicating that more than one order is coming up",pageEventAttributes:{...r},pageEventId:o}},t,n)},ake=(e,t,n)=>{const{pageEventId:o,...r}=e.payload.data||{};return z({type:Xt.HOMEPAGE_ADD_FUNCTION_CARD_CLICKED,payload:{description:"User clicked on the homepage right-hand card",pageEventAttributes:{...r},pageEventId:o}},t,n)},ike=(e,t,n)=>{const{pageEventId:o,...r}=e.payload.data||{};return z({type:Xt.PRODUCT_CLUSTERS_FILTER_CLICKED,payload:{description:"Customer clicked to select or deselect one of the filters to display products from a cluster",pageEventAttributes:{...r},pageEventId:o}},t,n)},lke=(e,t,n)=>{const o=[Pt(e.payload.data,t,"CARD_IMPRESSION")];return Dt(t,n,o)},cke=(e,t,n)=>{const o=[Pt(e.payload.data,t,Xt.PRODUCT_CLUSTERS_FILTERS_IMPRESSION)];return Dt(t,n,o)},dke={[Xt.HOMEPAGE_SLOT_BOOKING_CARD_CLICKED]:nke,[Xt.HOMEPAGE_ADD_FUNCTION_CARD_CLICKED]:ake,[Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED]:oke,[Xt.MULTIPLE_UPCOMING_ORDERS_CARD_CLICKED]:rke,[Xt.PRODUCT_CLUSTERS_FILTER_CLICKED]:ike,[Xt.HOME_CARD_IMPRESSION]:lke,[Xt.PRODUCT_CLUSTERS_FILTERS_IMPRESSION]:cke},uke=(e,t,n)=>z({type:e.type,payload:{description:"User Clicked Button to Shop for Ingredients",pageEventAttributes:{RECIPE_ID:e.payload.RECIPE_ID}}},t,n),pke=(e,t,n)=>{const{RECIPE_ID:o,GROUP_NAME:r,GROUP_TYPE:a,GROUP_SEQUENCE:i}=e.payload;return z({type:e.type,payload:{description:"User clicked on a recipe card",pageEventId:e.payload.pageEventId,pageEventAttributes:{RECIPE_ID:o,...r&&{GROUP_NAME:r},...a&&{GROUP_TYPE:a},...(i||i===0)&&{GROUP_SEQUENCE:i}}}},t,n)},mke=(e,t,n)=>{const{RECIPE_ID:o}=e.payload;return z({type:"RECIPE_CLICKED",payload:{description:"User clicked on a recipe card",pageEventId:e.payload.pageEventId,pageEventAttributes:{RECIPE_ID:o}}},t,n)},hke=(e,t,n)=>Oa({payload:{attributes:{RECIPE_ID:e.payload.RECIPE_ID,RECIPE_NAME:e.payload.RECIPE_NAME,RECIPE_COLLECTION_ID:e.payload.RECIPE_COLLECTION_ID,RECIPE_COLLECTION_NAME:e.payload.RECIPE_COLLECTION_NAME}}},t,n),gke=(e,t,n)=>{const o=[Pt(e.payload.recipeImpression,t,dE)];return Dt(t,n,o,e.payload.pageViewId)},Eke=(e,t,n)=>{const{RECIPE_ID:o,RECIPE_NAME:r,SEQUENCE:a,SERVES:i,TOTAL_TIME:l}=e.payload.recipeImpression,d=[Pt({RECIPE_ID:o,RECIPE_NAME:r,SEQUENCE:a,SERVES:i,TOTAL_TIME:l},t,dE)];return Dt(t,n,d,e.payload.pageViewId)},fke=(e,t,n)=>{const{RECIPE_COLLECTION_ID:o,GROUP_NAME:r,GROUP_TYPE:a,GROUP_SEQUENCE:i}=e.payload;return z({type:e.type,payload:{description:"User Clicked Collection Impression from the Displayed Collections",pageEventAttributes:{RECIPE_COLLECTION_ID:o,...r&&{GROUP_NAME:r},...a&&{GROUP_TYPE:a},...(i||i===0)&&{GROUP_SEQUENCE:i}}}},t,n)},yke=(e,t,n)=>{const{RECIPE_COLLECTION_ID:o}=e.payload;return z({type:MC,payload:{description:"User Clicked Collection Impression from the Displayed Collections",pageEventId:e.payload.pageEventId,pageEventAttributes:{RECIPE_COLLECTION_ID:o}}},t,n)},Ike=(e,t,n)=>Oa({payload:{attributes:{RECIPE_COLLECTION_ID:e.payload.RECIPE_COLLECTION_ID,RECIPE_COLLECTION_NAME:e.payload.RECIPE_COLLECTION_NAME}}},t,n),Ske=(e,t,n)=>{const o=[Pt(e.payload.collectionImpression,t,uE)];return Dt(t,n,o,e.payload.pageViewId)},Cke=(e,t,n)=>{const{RECIPE_COLLECTION_ID:o,RECIPE_COLLECTION_NAME:r,SEQUENCE:a}=e.payload.collectionImpression,l=[Pt({RECIPE_COLLECTION_ID:o,RECIPE_COLLECTION_NAME:r,SEQUENCE:a},t,uE)];return Dt(t,n,l,e.payload.pageViewId)},vke=(e,t,n)=>z({type:e.type,payload:{description:"The Recipe Search Input Bar gained Focus"}},t,n),Tke=(e,t,n)=>z({type:e.type,payload:{description:"User Clicked Browse Button in Recipe Search"}},t,n),_ke=(e,t,n)=>z({type:e.type,payload:{description:"User Clicked on Load More Button in Recipe All Collections Page"}},t,n),bke=(e,t,n)=>z({type:e.type,payload:{description:"User Clicked on Browse Collections Card from Recipe Homepage"}},t,n),xke=(e,t,n)=>Oa({payload:{attributes:{RECIPE_SEARCH_SOURCE:"RECIPE_TEXT_SEARCH",RECIPE_SEARCH_TERM:e.payload.RECIPE_SEARCH_TERM,RECIPE_SEARCH_RESULTS_COUNT:(e.payload.RECIPE_SEARCH_RESULTS_COUNT??0).toString()}}},t,n),Ake=(e,t,n)=>z({type:"RECIPES_INGREDIENTS_NO_RESULTS",payload:{description:"The ingredient list for a recipe did not include any products for the user to choose from.",pageEventAttributes:{RECIPE_ID:e.payload.RECIPE_ID,SEARCH_TERM:e.payload.SEARCH_TERM}}},t,n),Rke=(e,t,n)=>z({type:BD,payload:{description:"User clicked on a recipe card",pageEventId:e.payload.pageEventId,pageEventAttributes:{RECIPE_CARD_ID:e.payload.RECIPE_CARD_ID,RECIPE_CARD_TITLE:e.payload.RECIPE_CARD_TITLE,TYPE:e.payload.LINK_TYPE,VALUE:e.payload.LINK_PATH}}},t,n),Dke=(e,t,n)=>{const o=[Pt(e.payload.recipeCardImpression,t,UD)];return Dt(t,n,o,e.payload.pageViewId)},Oke=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on save recipe button",pageEventAttributes:{RECIPE_ID:e.payload.RECIPE_ID}}},t,n),Pke=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on unsave recipe button",pageEventAttributes:{RECIPE_ID:e.payload.RECIPE_ID}}},t,n),Nke=(e,t,n)=>z({type:e.type,payload:{description:"User Clicked on Load More Button in Saved Recipes page"}},t,n),Lke=(e,t,n)=>z({type:e.type,payload:{description:"User Clicked on Browse All Recipes Button in Recipe Shop for Ingredients Page",pageEventAttributes:{RECIPE_ID:e.payload.RECIPE_ID}}},t,n),kke=(e,t,n)=>{const o=[Pt(e.payload.buttonImpression,t,VD)];return Dt(t,n,o,e.payload.pageViewId)},jke=(e,t,n)=>z({type:e.type,payload:{description:"User opened the recipe assistant modal by clicking the button"}},t,n),Mke=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the restart button on the recipe assistant modal",pageEventAttributes:{...e.payload}}},t,n),wke=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the button to minimize the recipe assistant"}},t,n),Fke=(e,t,n)=>z({type:e.type,payload:{description:"The user reopened the chat after minimizing it"}},t,n),Bke=(e,t,n)=>z({type:e.type,payload:{description:"User cancelled the chat restart after clicking the Restart Button on the recipe assistant modal"}},t,n),Uke=(e,t,n)=>z({type:e.type,payload:{description:"User clicked the Restart Button on the recipe assistant and restarted the chat"}},t,n),Gke=(e,t,n)=>z({type:e.type,payload:{description:"An error message was displayed to the user on the recipe assistant modal",pageEventAttributes:{...e.payload}}},t,n),$ke=(e,t,n)=>z({type:e.type,payload:{description:"The user clicked 'Try Again' to resend their message after an error"}},t,n),Hke=(e,t,n)=>z({type:e.type,payload:{description:"A message was displayed on the recipe assistant modal",pageEventAttributes:{...e.payload}}},t,n),Vke=(e,t,n)=>z({type:e.type,payload:{description:"User closed the flowout view"}},t,n),Wke={[VW]:vke,[WW]:Tke,[RD]:uke,[DD]:pke,[HW]:mke,[dE]:gke,[OD]:Eke,[MC]:fke,[PD]:yke,[uE]:Ske,[ND]:Cke,[YW]:bke,[qW]:_ke,[kD]:xke,[jD]:hke,[MD]:Ike,[LD]:Ake,[wD]:Rke,[FD]:Dke,[GD]:Oke,[$D]:Pke,[KW]:Nke,[HD]:Lke,[VD]:kke,[WD]:jke,[YD]:Mke,[qD]:wke,[KD]:Fke,[QW]:Bke,[XW]:Uke,[ZW]:Gke,[JW]:$ke,[vh]:Hke,[zW]:Vke},Yke=(e,t,n)=>oa(t,n,zD,e.payload),qke=(e,t,n)=>z({type:e.type,payload:{description:"The user clicked the meal planning button on recipes home page"}},t,n),Kke=(e,t,n)=>z({type:e.type,payload:{description:"User open the meal details screen for a meal",pageEventAttributes:{MEAL_ID:e.payload.MEAL_ID}}},t,n),zke=(e,t,n)=>z({type:e.type,payload:{description:"User clicked search recipes from your meals"}},t,n),Qke=(e,t,n)=>z({type:e.type,payload:{description:"Create new meal dialog displayed"}},t,n),Xke=(e,t,n)=>{const{MEAL_ID:o,NUMBER_OF_INGREDIENTS:r}=e.payload;return z({type:e.type,payload:{description:"User pasted ingredients into their meal from the clipboard",pageEventAttributes:{...o&&{MEAL_ID:o},NUMBER_OF_INGREDIENTS:r}}},t,n)},Zke=(e,t,n)=>z({type:e.type,payload:{description:"Meal was created successfully",pageEventAttributes:{...e.payload}}},t,n),Jke=(e,t,n)=>z({type:e.type,payload:{description:"Edit meal dialog displayed",pageEventAttributes:{MEAL_ID:e.payload.MEAL_ID}}},t,n),eje=(e,t,n)=>z({type:e.type,payload:{description:"Meal was edited successfully",pageEventAttributes:{...e.payload}}},t,n),tje=(e,t,n)=>z({type:e.type,payload:{description:"Cancel editing meal dialog displayed",pageEventAttributes:{MEAL_ID:e.payload.MEAL_ID}}},t,n),sje=(e,t,n)=>z({type:e.type,payload:{description:"User cancelled edit their meal via the dialog",pageEventAttributes:{MEAL_ID:e.payload.MEAL_ID}}},t,n),nje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on create your first meal"}},t,n),oje=(e,t,n)=>z({type:e.type,payload:{description:"Delete meal dialog displayed",pageEventAttributes:{MEAL_ID:e.payload.MEAL_ID}}},t,n),rje=(e,t,n)=>z({type:e.type,payload:{description:"User's meal was successfully deleted",pageEventAttributes:{MEAL_ID:e.payload.MEAL_ID}}},t,n),aje={[zD]:Yke,[eY]:qke,[QD]:Kke,[gTe]:zke,[tY]:Qke,[XD]:Zke,[sY]:Xke,[nY]:Jke,[ZD]:eje,[oY]:tje,[rY]:sje,[aY]:nje,[iY]:oje,[JD]:rje},ije=(e,t,n)=>z({type:e.type,payload:{description:"User clicked confirm request button",pageEventAttributes:{orderId:e.payload.orderId}}},t,n),lje=(e,t,n)=>z({type:e.type,payload:{description:"User cancelled selection of refund request item",pageEventAttributes:{orderId:e.payload.orderId,productId:e.payload.productId}}},t,n),cje=(e,t,n)=>z({type:e.type,payload:{description:"User selected item for refund",pageEventAttributes:{orderId:e.payload.orderId,productId:e.payload.productId,quantity:e.payload.quantity,refundReasonCategory:e.payload.refundReasonCategory,refundReason:e.payload.refundReason,comment:e.payload.comment}}},t,n),dje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked request refund button on refund FOP",pageEventAttributes:{orderId:e.payload.orderId,productId:e.payload.productId}}},t,n),uje={[vi.CONFIRM_REQUEST_BUTTON_CLICKED]:ije,[vi.REFUND_REQUEST_ITEM_CANCELLED]:lje,[vi.REFUND_REQUEST_ITEM_SELECTED]:cje,[vi.REQUEST_REFUND_BUTTON_CLICKED]:dje},pje=({type:e,...t})=>({type:e,payload:t}),U={analyticsEvent:pje},mje="User added a product to regulars",hje="The confirmation modal was displayed",gje="The confirmation modal for removing all regulars from basket was displayed",Eje="User added a product to regulars",fje="User removed a product from regulars",yje="A toast notification was displayed",Ije="User changed a parameter of regular product",mu={[Is.ADD_TO_REGULARS_MODAL_DISPLAYED]:mje,[Is.REMOVE_ALL_REGULARS_MODAL_DISPLAYED]:hje,[Is.REMOVE_ALL_REGULARS_FROM_BASKET_MODAL_DISPLAYED]:gje,[Is.PRODUCT_ADDED_TO_REGULARS]:Eje,[Is.PRODUCT_REMOVED_FROM_REGULARS]:fje,[Is.TOAST_NOTIFICATION_DISPLAYED]:yje,[Is.REGULARS_PARAMETERS_CHANGED]:Ije},{analyticsEvent:hu}=U,Sje=({productId:e,retailerProductId:t})=>hu({type:Is.ADD_TO_REGULARS_MODAL_DISPLAYED,description:mu.ADD_TO_REGULARS_MODAL_DISPLAYED,pageEventAttributes:{productId:e,retailerProductId:t}}),Cje=()=>hu({type:Is.REMOVE_ALL_REGULARS_MODAL_DISPLAYED,description:mu.REMOVE_ALL_REGULARS_MODAL_DISPLAYED}),vje=()=>hu({type:Is.REMOVE_ALL_REGULARS_FROM_BASKET_MODAL_DISPLAYED,description:mu.REMOVE_ALL_REGULARS_FROM_BASKET_MODAL_DISPLAYED}),Tje=({productId:e,retailerProductId:t,frequency:n,quantity:o})=>hu({type:Is.PRODUCT_ADDED_TO_REGULARS,description:mu.PRODUCT_ADDED_TO_REGULARS,pageEventAttributes:{productId:e,retailerProductId:t,addToBasketFrequency:n,quantity:o}}),_je=({productId:e="",retailerProductId:t="",removeAll:n=!1})=>hu({type:Is.PRODUCT_REMOVED_FROM_REGULARS,description:mu.PRODUCT_REMOVED_FROM_REGULARS,pageEventAttributes:{productId:e,retailerProductId:t,removeAll:n}}),bje=e=>hu({type:Is.TOAST_NOTIFICATION_DISPLAYED,description:mu.TOAST_NOTIFICATION_DISPLAYED,pageEventAttributes:{status:e}}),ZF=({productId:e,retailerProductId:t,parameter:n,previousValue:o,currentValue:r})=>hu({type:Is.REGULARS_PARAMETERS_CHANGED,description:mu.REGULARS_PARAMETERS_CHANGED,pageEventAttributes:{productId:e,retailerProductId:t,parameter:n,previousValue:o,currentValue:r}}),xje=(e,t,n)=>oa(t,n,Is.REGULARS_TOTAL_COUNT,e.payload.count),Aje=(e,t,n)=>oa(t,n,Is.REGULARS_IN_TROLLEY_TOTAL_COUNT,e.payload.count),Rje=(e,t,n)=>({...It,body:{basketQuantityUpdateEventV5:{...vt(t,n),...e.payload,totalQuantity:0,addedByFunction:"REGULARS_REMOVED_ALL",bannerId:ti(n)}}}),Dje={[Is.ADD_TO_REGULARS_MODAL_DISPLAYED]:z,[Is.REMOVE_ALL_REGULARS_MODAL_DISPLAYED]:z,[Is.REMOVE_ALL_REGULARS_FROM_BASKET_MODAL_DISPLAYED]:z,[Is.PRODUCT_ADDED_TO_REGULARS]:z,[Is.PRODUCT_REMOVED_FROM_REGULARS]:z,[Is.REGULARS_PARAMETERS_CHANGED]:z,[Is.REGULARS_TOTAL_COUNT]:xje,[Is.REGULARS_IN_TROLLEY_TOTAL_COUNT]:Aje,[Is.REMOVE_ALL_REGULARS_FROM_BASKET]:Rje},Oje=(e,t,n)=>z({type:e.type,payload:{description:"User click the 'add a review' button"}},t,n),Pje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the product reviews icon badge"}},t,n),Nje=(e,t,n)=>z({type:e.type,payload:{description:"User toggled the helpfulness of a review (either marked helpful or removed the helpful status)",pageEventAttributes:{reviewId:e.payload.reviewId,location:e.payload.location,action:e.payload.action}}},t,n),Lje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the view a retailer response button"}},t,n),kje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the hide a retailer response button"}},t,n),JF=(e,t,n)=>z({type:e.type,payload:{description:e.payload.description}},t,n),jje=(e,t,n)=>z({type:e.type,payload:{description:"User sees the toast notification",pageEventAttributes:{productId:e.payload.productId,retailerProductId:e.payload.retailerProductId,reviewRating:e.payload.reviewRating}}},t,n),Mje=(e,t,n)=>z({type:e.type,payload:{description:"User changed sort preference",pageEventAttributes:{preferenceSelect:e.payload.translation}}},t,n),wje=(e,t,n)=>z({type:e.type,payload:{description:"User sees the validation errors",pageEventAttributes:e.payload}},t,n),Fje=(e,t,n)=>{const o=e.payload.reviewImpressions.map(r=>Pt(r,t,zt.PRODUCT_REVIEW_IMPRESSION));return Dt(t,n,o,e.pageViewId)},Bje=(e,t,n)=>{const o=e.payload.overallRatingImpressions.map(r=>Pt(r,t,zt.PRODUCT_OVERALL_RATINGS_DASHBOARD_IMPRESSION));return Dt(t,n,o,e.pageViewId)},Uje=(e,t,n)=>z({type:e.type,payload:{description:"An non-verified user clicks the 'add a review' button"}},t,n),Gje={[zt.ADD_A_REVIEW_BUTTON_CLICKED]:Oje,[zt.PRODUCT_RATINGS_CLICKED]:Pje,[zt.REVIEW_HELPFUL_BUTTON_CLICK]:Nje,[zt.VIEW_RESPONSE_BUTTON_CLICKED]:Lje,[zt.HIDE_RESPONSE_BUTTON_CLICKED]:kje,[zt.SEE_NEXT_REVIEW_PAGE_BUTTON_CLICKED]:JF,[zt.SEE_PREVIOUS_REVIEW_PAGE_BUTTON_CLICKED]:JF,[zt.REVIEW_SUBMITTED_TOAST_DISPLAYED]:jje,[zt.WRITE_REVIEW_ERROR_ALERT_DISPLAYED]:wje,[zt.REVIEW_SORT_PREFERENCE_CHANGED]:Mje,[zt.PRODUCT_REVIEW_IMPRESSION]:Fje,[zt.PRODUCT_OVERALL_RATINGS_DASHBOARD_IMPRESSION]:Bje,[zt.WRITE_NON_VERIFIED_REVIEW_BLOCK_TOAST_DISPLAYED]:Uje,[zt.REVIEW_IMAGE_NAVIGATED]:z,[zt.REVIEW_IMAGE_GALLERY_OPENED]:z,[zt.REVIEW_IMAGE_GALLERY_CLOSED]:z},uO={LISTER_PAGE_URL_LENGTH_LIMIT_BREAK:"LISTER_PAGE_URL_LENGTH_LIMIT_BREAK"},$je=(e,t,n)=>{const{externalAdvertId:o,targetUrlLength:r,productsNumber:a}=e.payload,i=[Pt({externalAdvertId:o,targetUrlLength:r,productsNumber:a},t,uO.LISTER_PAGE_URL_LENGTH_LIMIT_BREAK)];return Dt(t,n,i)},Hje={[uO.LISTER_PAGE_URL_LENGTH_LIMIT_BREAK]:$je},Bo={ORDER_DISCOUNT_FORM_MODAL_DISPLAYED:"ORDER_DISCOUNT_FORM_MODAL_DISPLAYED",ORDER_DISCOUNT_FORM_MODAL_CLOSED:"ORDER_DISCOUNT_FORM_MODAL_CLOSED",ORDER_DISCOUNT_FORM_PROMOTION_IMPRESSION:"ORDER_DISCOUNT_FORM_PROMOTION_IMPRESSION",ORDER_DISCOUNT_DROPDOWN_CLICKED:"ORDER_DISCOUNT_DROPDOWN_CLICKED"},Vje=(e,t,n)=>{const o=e.payload.promotionsFormImpression.map(r=>Pt(r,t,Bo.ORDER_DISCOUNT_FORM_PROMOTION_IMPRESSION));return Dt(t,n,o)},Wje={[Bo.ORDER_DISCOUNT_FORM_MODAL_DISPLAYED]:z,[Bo.ORDER_DISCOUNT_FORM_MODAL_CLOSED]:z,[Bo.ORDER_DISCOUNT_FORM_PROMOTION_IMPRESSION]:Vje,[Bo.ORDER_DISCOUNT_DROPDOWN_CLICKED]:z},Yje=(e,t,n)=>z({type:e.type,payload:{description:"User completed the promotion by adding all the requred products from all the required  groups to the basket.",pageEventAttributes:{promoPageId:e.payload.promoPageId}}},t,n),qje=(e,t,n)=>z({type:e.type,payload:{description:"A product group accordian was expanded",pageEventAttributes:{productGroupSequence:e.payload.productGroupSequence}}},t,n),Kje=(e,t,n)=>z({type:e.type,payload:{description:"A product group accordian was collapsed",pageEventAttributes:{productGroupSequence:e.payload.productGroupSequence}}},t,n),zje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the coupons tab"}},t,n),Qje={[Va.COMBO_PROMO_COMPLETED]:Yje,[Va.COMBO_PROMO_ACCORDION_EXPANDED]:qje,[Va.COMBO_PROMO_ACCORDION_COLLAPSED]:Kje,[Va.COUPONS_TAB_CLICKED]:zje},Xje=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the learn more button on the page.",pageEventAttributes:{...e.payload}}},t,n),Zje=(e,t,n)=>z({type:e.type,payload:{description:"User closed coupon onboarding card.",pageEventAttributes:{...e.payload}}},t,n),Jje=(e,t,n)=>{const o=[Pt({...e.payload},t,e.type)];return Dt(t,n,o)},eMe=(e,t,n)=>{const o=[Pt({...e.payload},t,e.type)];return Dt(t,n,o)},tMe=(e,t,n)=>z({type:e.type,payload:{description:"After encountering an empty coupon page, the customer clicked the promotions button.",pageEventAttributes:{...e.payload}}},t,n),sMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on a coupon presented to them.",pageEventAttributes:{...e.payload}}},t,n),nMe=(e,t,n)=>{const o=[Pt({...e.payload},t,e.type)];return Dt(t,n,o)},oMe=(e,t,n)=>Oa({payload:{attributes:{COUPONS_AVAILABLE:e.payload.COUPONS_AVAILABLE}}},t,n),rMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicked on the promotions tab"}},t,n),aMe={[en.LEARN_MORE_BUTTON_CLICKED]:Xje,[en.ONBOARDING_CARD_CLOSED]:Zje,[en.COUPON_ONBOARDING_CARD_IMPRESSION]:Jje,[en.LEARN_MORE_BUTTON_IMPRESSION]:eMe,[en.PROMOTIONS_TAB_CLICKED]:rMe,[en.EMPTY_COUPONS_PROMO_BUTTON_CLICKED]:tMe,[en.COUPON_CLICKED]:sMe,[en.COUPON_IMPRESSION]:nMe,[en.COUPONS_AVAILABLE]:oMe},Iq=se("GET_CATEGORIES"),Sq="SET_CATEGORY_EVENT",Cq="RESET_CATEGORY_EVENT",vq="SET_CATEGORY_RICH_TEXT_CONTENT",Tq="RESET_CATEGORY_RICH_TEXT_CONTENT_EVENT",iMe=e=>({type:Sq,payload:e}),lMe=()=>({type:Cq}),cMe=({depth:e,isSEOReadableURLEnabled:t=!1})=>({type:"API",payload:{url:`/v1/categories?decoration=false&categoryDepth=${e}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...Iq},isSEOReadableURLEnabled:t,depth:e}),dMe=e=>({type:vq,payload:e}),uMe=()=>({type:Tq}),fr={getCategories:cMe,setCategoryEvent:iMe,resetCategoryEvent:lMe,setCategoryRichTextContent:dMe,resetCategoryRichTextContentEvent:uMe,actionTypes:{GET_CATEGORIES:Iq,SET_CATEGORY_EVENT:Sq,RESET_CATEGORY_EVENT:Cq,SET_CATEGORY_RICH_TEXT_CONTENT:vq,RESET_CATEGORY_RICH_TEXT_CONTENT_EVENT:Tq}},{normalize:pMe}=Al,{categoriesSchema:mMe}=xl,hMe={...je,depth:null,root:null,categories:null,categoryEvent:null,richTextContent:null},gMe=(e=hMe,t)=>{switch(t.type){case fr.actionTypes.GET_CATEGORIES.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case fr.actionTypes.GET_CATEGORIES.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case fr.actionTypes.GET_CATEGORIES.SUCCESS:{const n=t.payload.responseData,o=pMe(n,mMe),r=t.isSEOReadableURLEnabled?nhe(o.entities.categories,o.result):o.entities.categories;return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),root:o.result,categories:r,depth:t.depth}}case fr.actionTypes.SET_CATEGORY_EVENT:return{...e,categoryEvent:t.payload};case fr.actionTypes.RESET_CATEGORY_EVENT:return{...e,categoryEvent:null};case fr.actionTypes.SET_CATEGORY_RICH_TEXT_CONTENT:return{...e,richTextContent:t.payload};case fr.actionTypes.RESET_CATEGORY_RICH_TEXT_CONTENT_EVENT:return{...e,richTextContent:null};default:return e}},_q=({data:e})=>e.categories.isFetching,bq=({data:e})=>e.categories.depth,pO=({data:e})=>e.categories.categories,xq=({data:e})=>e.categories.root,Aq=Y(xq,pO,(e,t)=>e===null?[]:e.map(n=>({id:n,name:t[n].name,fullURLPath:t[n].fullURLPath||"",retailerCategoryId:t[n].retailerId||""}))),EMe=({data:e})=>e.categories.categoryEvent,fMe=({data:e})=>e.categories.richTextContent,Rq=({data:e})=>e.categories.richTextContent?.categoryId||"",yMe=(e,t,n)=>z({type:e.type,payload:{description:"The customer clicked on an item within the text block intended for SEO positioning",pageEventAttributes:{...e.payload}}},t,n),IMe=(e,t,n)=>{const o=[Pt({...e.payload,regionId:vn(n),categoryId:Rq(n)},t,e.type)];return Dt(t,n,o)},SMe=(e,t,n)=>{const o=[Pt({...e.payload,regionId:vn(n),categoryId:Rq(n)},t,e.type)];return Dt(t,n,o)},ip={SEO_TEXT_BLOCK_ITEM_CLICKED:"SEO_TEXT_BLOCK_ITEM_CLICKED",SEO_CATEGORY_DESCRIPTION_LOADED:"SEO_CATEGORY_DESCRIPTION_LOADED",SEO_CATEGORY_DESCRIPTION_IMPRESSION:"SEO_CATEGORY_DESCRIPTION_IMPRESSION"},CMe={[ip.SEO_TEXT_BLOCK_ITEM_CLICKED]:yMe,[ip.SEO_CATEGORY_DESCRIPTION_LOADED]:IMe,[ip.SEO_CATEGORY_DESCRIPTION_IMPRESSION]:SMe},vMe=(e,t,n)=>Dt(t,n,[Pt({},t,"FOOTER_LEGAL_TEXT_IMPRESSION")]),TMe=(e,t,n)=>z({type:"FOOTER_LEGAL_TEXT_LINK_CLICKED",payload:{description:"User clicked on a link within the footer legal text component",pageEventAttributes:{LINK_VALUE:e.payload.LINK_VALUE}}},t,n),qI={FOOTER_LEGAL_TEXT_LINK_CLICKED:"FOOTER_LEGAL_TEXT_LINK_CLICKED",FOOTER_LEGAL_TEXT_IMPRESSION:"FOOTER_LEGAL_TEXT_IMPRESSION"},_Me={[qI.FOOTER_LEGAL_TEXT_LINK_CLICKED]:TMe,[qI.FOOTER_LEGAL_TEXT_IMPRESSION]:vMe},bMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks recurring orders",pageEventAttributes:{customerId:e.payload.customerId,source:e.payload.source}}},t,n),xMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on create recurring order button",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),AMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on learn more button",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),RMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on edit payment button when they finish created",pageEventAttributes:{customerId:e.payload.customerId,value:e.payload.paymentMethodType}}},t,n),DMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on cancle button for existed one recurring order",pageEventAttributes:{customerId:e.payload.customerId,value:e.payload.paymentMethodType}}},t,n),OMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on edit upcoming orders",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),PMe=(e,t,n)=>z({type:e.type,payload:{description:"A modal for create recurring order was displayed",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),NMe=(e,t,n)=>z({type:e.type,payload:{description:"A modal for create recurring order was displayed",pageEventAttributes:{customerId:e.payload.customerId,position:e.payload.position}}},t,n),LMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on address for a recurring order",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),kMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on address for a recurring order",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),jMe=(e,t,n)=>z({type:e.type,payload:{description:"User select a day and time for a recurring order",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),MMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks on choose payment method button",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),wMe=(e,t,n)=>z({type:e.type,payload:{description:"User clicks edit when they created their recurring order",pageEventAttributes:{customerId:e.payload.customerId}}},t,n),FMe="RECURRING_ORDERS_CLICKED",BMe="CREATE_RECURRING_ORDER_BUTTON_CLICKED",UMe="LEARN_MORE_RECURRING_ORDER_BUTTON_CLICKED",GMe="CREATED_RECURRING_ORDER_EDIT_PAYMENT_BUTTON_CLICKED",$Me="CREATED_RECURRING_ORDER_CANCEL_BUTTON_CLICKED",HMe="EDIT_UPCOMING_ORDERS_BUTTON_CLICKED",VMe="CREATE_RECURRING_ORDER_MODAL_DISPLAYED",WMe="IS CANCEL_CREATE_RECURRING_ORDER_CLICKED",YMe="CREATE_RECURRING_ORDER_ADDRESS_CLICKED",qMe="CREATE_RECURRING_ORDER_FREQUENCY_CLICKED",KMe="CREATE_RECURRING_ORDER_TIME_CLICKED",zMe="CREATE_RECURRING_ORDER_CHOOSE_PAYMENT_BUTTON_CLICKED",QMe="EDIT_CREATED_RECURRING_ORDER_CLICKED",Lr={RECURRING_ORDERS_CLICKED:FMe,CREATE_RECURRING_ORDER_BUTTON_CLICKED:BMe,LEARN_MORE_RECURRING_ORDER_BUTTON_CLICKED:UMe,CREATED_RECURRING_ORDER_EDIT_PAYMENT_BUTTON_CLICKED:GMe,CREATED_RECURRING_ORDER_CANCEL_BUTTON_CLICKED:$Me,EDIT_UPCOMING_ORDERS_BUTTON_CLICKED:HMe,CREATE_RECURRING_ORDER_MODAL_DISPLAYED:VMe,CANCEL_CREATE_RECURRING_ORDER_CLICKED:WMe,CREATE_RECURRING_ORDER_ADDRESS_CLICKED:YMe,CREATE_RECURRING_ORDER_FREQUENCY_CLICKED:qMe,CREATE_RECURRING_ORDER_TIME_CLICKED:KMe,CREATE_RECURRING_ORDER_CHOOSE_PAYMENT_BUTTON_CLICKED:zMe,EDIT_CREATED_RECURRING_ORDER_CLICKED:QMe},XMe={[Lr.RECURRING_ORDERS_CLICKED]:bMe,[Lr.CREATE_RECURRING_ORDER_BUTTON_CLICKED]:xMe,[Lr.LEARN_MORE_RECURRING_ORDER_BUTTON_CLICKED]:AMe,[Lr.CREATED_RECURRING_ORDER_EDIT_PAYMENT_BUTTON_CLICKED]:RMe,[Lr.CREATED_RECURRING_ORDER_CANCEL_BUTTON_CLICKED]:DMe,[Lr.EDIT_UPCOMING_ORDERS_BUTTON_CLICKED]:OMe,[Lr.CREATE_RECURRING_ORDER_MODAL_DISPLAYED]:PMe,[Lr.CANCEL_CREATE_RECURRING_ORDER_CLICKED]:NMe,[Lr.CREATE_RECURRING_ORDER_ADDRESS_CLICKED]:LMe,[Lr.CREATE_RECURRING_ORDER_FREQUENCY_CLICKED]:kMe,[Lr.CREATE_RECURRING_ORDER_TIME_CLICKED]:jMe,[Lr.CREATE_RECURRING_ORDER_CHOOSE_PAYMENT_BUTTON_CLICKED]:MMe,[Lr.EDIT_CREATED_RECURRING_ORDER_CLICKED]:wMe},ZMe=(e,t,n)=>{const o=[Pt({POSITION:"top"},t,Ya.SMART_BANNER_IMPRESSION)];return Dt(t,n,o)},JMe=(e,t,n)=>z({type:Ya.SMART_BANNER_CLICKED,payload:{description:"The user clicked on the smart banner to open it"}},t,n),ewe=(e,t,n)=>z({type:Ya.SMART_BANNER_CLOSED,payload:{description:"The user closed the smart banner"}},t,n),twe={[Ya.SMART_BANNER_CLICKED]:JMe,[Ya.SMART_BANNER_CLOSED]:ewe,[Ya.SMART_BANNER_IMPRESSION]:ZMe},swe="CHAT_WITH_US_SESSION_STARTED",nwe="CHAT_WITH_US_SESSION_ENDED",Ip={CHAT_WITH_US_SESSION_STARTED:swe,CHAT_WITH_US_SESSION_ENDED:nwe},Dq={[Ip.CHAT_WITH_US_SESSION_STARTED]:"The user clicked on the chat with us option to start session",[Ip.CHAT_WITH_US_SESSION_ENDED]:"The user clicked on end chat to end the session"},owe=(e,t,n)=>z({type:e.type,payload:{description:Dq.CHAT_WITH_US_SESSION_STARTED}},t,n),rwe=(e,t,n)=>z({type:e.type,payload:{description:Dq.CHAT_WITH_US_SESSION_ENDED}},t,n),awe={[Ip.CHAT_WITH_US_SESSION_STARTED]:owe,[Ip.CHAT_WITH_US_SESSION_ENDED]:rwe},iwe={[Pn]:em(fAe,WI,Mxe),[EC]:WI,[Ds.PAGE_ATTRIBUTES_MULTIPLE]:Oa},lwe=[iwe,nRe,VNe,oRe,lRe,mRe,$Re,hDe,xDe,PDe,kDe,eOe,pOe,gOe,POe,FOe,YOe,_Me,zOe,sPe,rPe,cPe,fPe,yPe,DPe,NPe,KPe,pNe,vNe,xNe,yLe,WLe,zLe,ske,dke,uje,Dje,Wke,aje,Gje,Hje,Wje,Qje,aMe,CMe,XMe,awe,twe],cwe=lwe.reduce((e,t)=>(Object.keys(t).forEach(n=>{e[n]=e[n]?em(e[n],t[n]):t[n]}),e),{}),eB=new Exe,dwe=e=>(eB.getState=e.getState,t=>n=>uH.createMiddleware(cwe,eB.dispatchEvents)(e)(t)(n)),Oq=()=>"/out-of-stock",uwe=(e,t)=>e&&t&&e!==t,pwe=()=>{window&&window.location.reload()},mwe=(e,{regionId:t})=>{const n=At(e),{pathname:o}=e.router.location,r=vn(e),a=t,l=[bc(n),Jd(n),Oq()].includes(o);uwe(r,a)&&!l&&pwe()},mO={handleBasketRegion:mwe},Pq={INVALID_SLOT:"INVALID_SLOT"};function es(e){return f(n=>n.retailerSettings[e])}const hwe=({children:e,assetPath:t})=>{const n=es("theme-asset-version"),[o]=Fp(),r=o.get("themeAssetVersion"),a=t??`/theme-assets/${r||n}/icons/icons.svg`;return s.jsx(sce,{src:a,children:e})},v="default"in w_?w_.default:w_,Ke={xs:0,sm:36,md:48,lg:62},Yf=e=>(...t)=>Pe`
        @media (min-width: ${Ke[e]}em) {
            ${Pe(...t)}
        }
    `,Y_=(e,t)=>(...n)=>Pe`
        @media (min-width: ${Ke[e]}em) {
            @media not all and (min-width: ${Ke[t]}em) {
                ${Pe(...n)}
            }
        }
    `,re={xs:Y_("xs","sm"),sm:Y_("sm","md"),md:Y_("md","lg"),xsUp:Yf("xs"),smUp:Yf("sm"),mdUp:Yf("md"),lgUp:Yf("lg")},br={"xs-up":{mediaQueryKey:"xsUp",breakpointKey:"xs"},"sm-up":{mediaQueryKey:"smUp",breakpointKey:"sm"},"md-up":{mediaQueryKey:"mdUp",breakpointKey:"md"},"lg-up":{mediaQueryKey:"lgUp",breakpointKey:"lg"}},fl={xs:`(min-width: ${Ke.xs}em) and (max-width: ${Ke.sm-.01}em)`,sm:`(min-width: ${Ke.sm}em) and (max-width: ${Ke.md-.01}em)`,md:`(min-width: ${Ke.md}em) and (max-width: ${Ke.lg-.01}em)`,lg:`(min-width: ${Ke.lg}em)`},zn={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},$t={icon:zn[1],badge:zn[1],select:zn[1],"fop-overlay":zn[2],"fop-options":zn[3],dropdown:zn[4],"bottom-bar":zn[5],"sticky-add-button":zn[4],header:zn[5],popup:zn[6],headerWithOverlay:zn[7],"nav-button":zn[5],"top-tabs":zn[6],"content-block-header":zn[6],overlay:zn[7],"collapsible-box":zn[7],"nav-menu":zn[8],"dialog-close":zn[9],"skip-link":zn[10]},gwe=Pe`
    :root {
        --z-index-icon: 1;
        --z-index-badge: 1;
        --z-index-select: 1;
        --z-index-carousel: 1;
        --z-index-fop-overlay: 2;
        --z-index-fop-options: 3;
        --z-index-dropdown: 4;
        --z-index-bottom-bar: 4;
        --z-index-sticky-add-button: 4;
        --z-index-header: 5;
        --z-index-popup: 6;
        --z-index-nav-button: 5;
        --z-index-top-tabs: 6;
        --z-index-content-block-header: 6;
        --z-index-search-suggestion: 6;
        --z-index-overlay: 7;
        --z-index-collapsible-box: 7;
        --z-index-header-with-overlay: 7;
        --z-index-nav-menu: 8;
        --z-index-dialog-close: 9;
        --z-index-notification: 9;
        --z-index-skip-link: 10;
    }
`,Ewe=87.5,fwe=()=>parseFloat(typeof window<"u"&&window.getComputedStyle(document.documentElement).fontSize)||14,ywe=()=>fwe()*(100/Ewe),Iwe=Pe`
    html {
        overflow-x: hidden;
    }

    body {
        background-color: var(--background-color);
        line-break: strict;
    }

    /* stylelint-disable-next-line selector-class-pattern */
    .site--content {
        flex: 1 0 auto;
    }

    /* stylelint-disable-next-line selector-class-pattern */
    .ReactModal__Body--open {
        block-size: 100%;
        overflow: hidden;
        position: fixed;
        inline-size: 100%;
    }

    .scroll-locked {
        position: relative;
        overflow: hidden;
    }

    iframe {
        border: none;
    }

    ${gwe}
`,Swe="Xs",Cwe="Sm",vwe="SmUp",Twe="Md",_we="MdUp",bwe="Lg",q_={},yl=e=>{const t=ywe();if(q_[`${t}-${e}`])return q_[`${t}-${e}`];const n=nce(oce(e,t));return q_[`${t}-${e}`]=n,n},xwe=()=>typeof window<"u"&&yl(window.innerWidth)<Ke.sm,Nq=()=>typeof window<"u"&&yl(window.innerWidth)>=Ke.sm&&yl(window.innerWidth)<Ke.md,Lq=()=>typeof window<"u"&&yl(window.innerWidth)>=Ke.sm,kq=()=>typeof window<"u"&&yl(window.innerWidth)>=Ke.md&&yl(window.innerWidth)<Ke.lg,jq=()=>typeof window<"u"&&yl(window.innerWidth)>=Ke.md,Mq=()=>typeof window<"u"&&yl(window.innerWidth)>=Ke.lg,Awe=()=>{let e=Swe;return Nq()?e=Cwe:Lq()?e=vwe:kq()?e=Twe:jq()?e=_we:Mq()&&(e=bwe),e},Rwe={getViewport:Awe,isXs:xwe,isSm:Nq,isSmUp:Lq,isMd:kq,isMdUp:jq,isLg:Mq,pxToEm:yl},K_={50:.12,100:.3,200:.5,300:.7,400:.85,600:.13,700:.3,800:.46,900:.75},Dwe=e=>{let[,t,n,o,r,a,i]=e;return e.length===4&&([,t,o,a]=e,[,n,r,i]=e),[`${t}${n}`,`${o}${r}`,`${a}${i}`].map(c=>parseInt(c,16))},Owe=e=>{const{red:t,green:n,blue:o}=rce(e);return ace(parseInt(t**2/255,10),parseInt(n**2/255,10),parseInt(o**2/255,10))},tB=(e,t)=>{if(K_[t]){if(t>400){const o=Owe(e);return cF(1-K_[t],e,o)}return cF(K_[t],e,"#ffffff")}return e},Pwe=(e,t="#000",n="#fff")=>{const[o,r,a]=Dwe(e);return(o*299+r*587+a*114)/1e3<128?n:t};v.div`
    align-items: center;
    background-color: ${e=>tB(e.color,e.tone)};
    color: ${e=>Pwe(tB(e.color,e.tone))};
    display: flex;
    padding: 20px;
`;const Jn={sm:30,md:40,lg:50},Bu={xs:4,sm:8},KI=42,wq=45,co={v2:{sm:Jn.lg+Bu.xs*2+Jn.md+Bu.xs*2+Bu.xs*2+1,lgUp:Jn.md+Bu.xs*2+Jn.sm+Bu.sm*2+Bu.xs*2+1}},$=e=>pH(parseFloat(e),14),hO=Pe`
    border: 0;
    clip: rect(0 0 0 0);
    block-size: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    inline-size: 1px;
`,sB=(e,t)=>`
    ::-webkit-scrollbar {
        inline-size: 20px;
        block-size: 27px;
    }

    ::-webkit-scrollbar-track {
        border-radius: 12px;
    }

    ::-webkit-scrollbar-thumb {
        border-radius: 18px;
        background-color: ${e};
        border: 6px solid ${t};
    }

    ::-webkit-scrollbar-button {
        inline-size: 0;
        block-size: 0;
        display: none;
    }

    ::-webkit-scrollbar-corner {
        background-color: transparent;
    }
`,Nwe={fill:m.string,height:m.number,hidden:m.string,name:m.string.isRequired,info:m.bool,success:m.bool,primary:m.bool,warning:m.bool,error:m.bool,width:m.number,verticalAlign:m.string,visible:m.string,source:m.string,lineHeight:m.oneOfType([m.string,m.number])},Lwe=({fill:e,info:t,success:n,primary:o,warning:r,error:a})=>t?"var(--intent-secondary-900)":n?"var(--intent-success)":o?"var(--intent-primary)":r?"var(--intent-warning)":a?"var(--intent-error)":e,Fq=v.svg.withConfig({shouldForwardProp:(e,t)=>!["name","fill","height","width","type"].includes(e)&&t(e)}).attrs(({name:e,"data-test":t})=>({"data-test":t||`icon__${e}`,"data-icon":`icon__${e}`}))`
    line-height: ${e=>e.lineHeight};
    vertical-align: ${e=>e.verticalAlign};
    display: inline-block;
    fill: ${Lwe};
    block-size: ${({height:e})=>typeof e=="string"?e:$(e)};
    min-block-size: ${({height:e})=>typeof e=="string"?e:$(e)};
    inline-size: ${({width:e})=>typeof e=="string"?e:$(e)};
    min-inline-size: ${({width:e})=>typeof e=="string"?e:$(e)};

    [dir="rtl"] &[data-icon="icon__arrow_left"],
    [dir="rtl"] &[data-icon="icon__arrow_right"]
    {
        transform: scaleX(-1);
    }



    ${({visible:e,hidden:t})=>e||t?[re[e||t]`
                  display: ${e?"inline-block":"none"}`,`display: ${e?"none":"inline-block"}`]:null};
`,kwe=({title:e,...t})=>s.jsxs(Fq,{...t,children:[e?s.jsx("title",{children:e}):null,s.jsx("use",{href:t.source})]}),om=v(kwe)``;om.displayName="Icon";const Bq={fill:"currentColor",height:20,width:20,lineHeight:0};Fq.defaultProps=Bq;om.defaultProps=Bq;om.propTypes=Nwe;const pe=e=>{const t=ice(e.name);return s.jsx(om,{source:t,...e})},Uq=v.button`
    inline-size: 100%;
    border: none;
    align-items: center;
    background-color: var(--intent-contrast);
    border-block-end: ${({active:e})=>e?"var(--salt-border-1) solid var(--intent-secondary)":0};
    border-radius: var(--salt-radius-default);
    cursor: pointer;
    display: flex;
    font-weight: 700;
    block-size: ${$(Jn.lg)};
    margin-inline: 0;
    margin-block: 0 ${({active:e})=>e?"0":"var(--salt-spacing-1)"};
    padding-inline: var(--salt-spacing-2);
    padding-block: 0;
`;Uq.displayName="AccordionTitle";const Gq=v(pe)`
    block-size: ${$(18)};
    margin-inline-start: auto;
    transform: ${({active:e})=>e?"rotate(180deg)":"rotate(0deg)"};
    transition: 0.3s transform ease-in-out;
    inline-size: ${$(18)};
`;Gq.displayName="AccordionIcon";const $q=v.section`
    block-size: ${({active:e})=>e?"auto":"0px"};
    overflow: hidden;
    padding: ${({active:e})=>e?"var(--salt-spacing-4)":0};
`;$q.displayName="AccordionContent";const By={StyledAccordionTitle:Uq,StyledIcon:Gq,StyledAccordionContent:$q},jwe={href:m.string,to:m.string,width:m.oneOfType([m.string,m.number]),images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired})).isRequired},Mwe={width:"auto",href:void 0,to:void 0},wwe=1e4,z_=e=>e/3,qf=(e,t,n)=>{const o=e.find(a=>z_(a.width)>=t&&z_(a.width)<n)||{url:"none",height:0},r=z_(o.height);return`
        background-image: url(${o.url});
        block-size: ${$(r)};
        background-size: auto ${r}px;
    `},YC=v.a.withConfig({shouldForwardProp:e=>!["width","images"].includes(e)})`
    background-color: var(--intent-secondary-100);
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer;
    display: block;
    inline-size: ${({width:e})=>e};
    margin-block: 0 var(--salt-spacing-4);
    margin-inline: var(--salt-spacing-2);
    border-radius: var(--border-radius);

    ${({images:e})=>qf(e,Ke.xs*16,Ke.sm*16)}

    ${re.smUp`
        ${({images:e})=>qf(e,Ke.sm*16,Ke.md*16)}
    `}

    ${re.mdUp`
        ${({images:e})=>qf(e,Ke.md*16,Ke.lg*16)}
    `}

    ${re.lgUp`
        ${({images:e})=>qf(e,Ke.lg*16,wwe)}
    `};
`;YC.propTypes=jwe;YC.defaultProps=Mwe;const Hq=v.div`
    display: flex;
    min-block-size: 50vi;
    min-inline-size: 100%;
    margin-block-end: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);

    ${re.smUp`
        flex-basis: 50%;
        flex-grow: 2;
        min-block-size: ${$(270)};
        min-inline-size: ${$(400)};
        margin-block-start: calc(${$(20)} + var(--salt-spacing-2));
    `}

    ${re.mdUp`
        flex-basis: 40%;
    `}

    ${re.lgUp`
        flex-basis: ${Ke.lg/5*2}rem;
    `}
`;Hq.displayName="AdvertisingBanner";const Vq=v.div`
    position: relative;
    inline-size: 100%;
    block-size: 100%;
    border-radius: var(--border-radius);
    overflow: hidden;

    > a {
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        block-size: 100%;
        position: absolute;
        inline-size: 100%;
    }

    img {
        block-size: 100%;
        object-fit: cover;
        object-position: center;
        inline-size: 100%;
    }
`;Vq.displayName="AdvertisingBannerContent";const Wq={AdvertisingBanner:Hq,AdvertisingBannerContent:Vq},Fwe=e=>{const t=f(At);return e&&e.startsWith("/")?`${t||""}${e}`:e},Bwe=()=>{const t=`(${L().formatMessage("accessibility.link.open.in.new.window")})`;return s.jsx(ie,{children:t})},Uwe=({children:e,target:t=""})=>s.jsxs(h.Fragment,{children:[e,t==="_blank"&&s.jsx(Bwe,{})]}),tt=h.forwardRef((e,t)=>{const{children:n,target:o,rel:r,size:a,standalone:i,intent:l,asChild:c,href:d,...u}=e,p=Fwe(d),g=o==="_blank"?"noopener noreferrer":r,E=c?n:s.jsx(Uwe,{target:o,children:n});if(l==="ghost"){const{bold:y,...I}=u;return s.jsx(dF,{href:p,ref:t,intent:l,asChild:c,rel:g,target:o,...I,children:E})}return s.jsx(dF,{href:p,ref:t,size:a,standalone:i,intent:l,asChild:c,rel:g,target:o,...u,children:E})}),Gwe=v.ul`
    list-style: none;
    margin: 0;
    padding: 0;
`,$we=v.li`
    display: none;
    vertical-align: middle;

    &:nth-last-child(-n + 2) {
        display: inline-block;
    }

    ${re.smUp`
        display: inline-block;
    `};
`,gO=v(ee)`
    display: inline-block;
    font-size: var(--salt-text-m-font-size);
    vertical-align: middle;
    margin: 0;

    ${re.smUp`
        font-size: var(--salt-display-font-size);
    `};
`;gO.defaultProps={as:"h1"};const Hwe=v(gO)`
    font-size: var(--salt-display-font-size);
`,Vwe=v(tt).attrs({standalone:!0})`
    display: inline-block;

    && {
        font-weight: bold;
        vertical-align: middle;

        &:hover,
        &:active {
            font-weight: bold;
        }
    }
`,Wwe=v(pe)`
    margin-block: 0;
    margin-inline: var(--salt-spacing-1);
    vertical-align: middle;
    inline-size: ${$(20)};
`,Ywe={List:Gwe,Item:$we,CurrentBreadcrumbText:gO,HeadingBreadcrumb:Hwe,BreadcrumbLinkComponent:Vwe,Chevron:Wwe},qwe=v.section`
    display: flex;
    margin: calc(-1 * var(--salt-spacing-2));
    flex-wrap: wrap;
    transform: translateZ(0);
`,Kwe={CardSection:qwe},zwe=Pe`
    display: flex;
    margin: var(--salt-spacing-2);
    position: relative;
    inline-size: ${({xs:e})=>`calc(${100/e}% - var(--salt-spacing-4))`};

    ${re.smUp`
        inline-size: ${({sm:e})=>`calc(${100/e}% - var(--salt-spacing-4))`};
    `}

    ${re.mdUp`
        inline-size: ${({md:e})=>`calc(${100/e}% - var(--salt-spacing-4))`};
    `};

    ${re.lgUp`
        inline-size: ${({lg:e})=>`calc(${100/e}% - var(--salt-spacing-4))`};
    `}
`,EO=e=>{switch(e){case"start":case"left":return"start";case"end":case"right":return"end";default:return e}},Qwe=v.article`
    ${zwe};
    align-self: stretch;
    background-color: var(--intent-contrast);
    border-radius: var(--border-radius);
    color: ${({muted:e})=>e?"var(--intent-content)":""};
    flex-direction: column;
    justify-content: center;
    padding: var(--salt-spacing-4);
    text-align: ${e=>EO(e.align)||"center"};
`,Xwe=v.div`
    align-items: center;
    display: flex;
    justify-content: center;
    text-align: center;
    margin-inline: 0;
    margin-block: 0 var(--salt-spacing-2);
    ${om} {
        margin-inline-end: var(--salt-spacing-2);
    }
`,Zwe=v.h2`
    font-size: var(--salt-display-font-size);
    margin: 0;
    ${({singleLine:e})=>e&&Pe`
            text-align: start;
            white-space: pre;
            text-overflow: ellipsis;
            overflow: hidden;
            inline-size: 100%;
            padding-inline-end: var(--salt-spacing-4);
        `}
`,Jwe=v.div`
    margin-block-end: var(--salt-spacing-1);
    overflow-wrap: anywhere;
    padding-block-end: var(--salt-spacing-2);
    ${({align:e})=>e?`text-align: ${EO(e)};`:""}
`,eFe=v.div`
    margin-block-start: auto;
    ${({align:e})=>e?`text-align: ${EO(e)};`:""}
`,tFe=v.div`
    position: absolute;
    inset-block-start: 5px;
    inset-inline-end: 5px;

    &:hover {
        cursor: pointer;
    }
`,sFe={Body:Jwe,CardWrapper:Qwe,Footer:eFe,Header:Xwe,HeaderText:Zwe,Options:tFe},Yq=e=>e==="small"?`
        min-inline-size: ${$(243)};
        max-inline-size: ${$(493)};
        `:`min-inline-size: ${$(328)};
  max-inline-size: ${$(663)};`,nFe=Fi`
    0% {
        transform: translateX(0);
    }

    50% {
        transform: translateX(${$(4)});
    }

    100% {
        transform: translateX(0);
    }
`,qq=v(pe)`
    align-self: center;
    position: absolute;
    inset-block-start: calc(50% - ${({height:e})=>$(Number(e||20)/2)});
    inset-inline-end: 0%;
`,oFe=v(tt).attrs({intent:"ghost"})`
    display: block;

    &:hover {
        text-decoration: none;
    }

    &:active {
        text-decoration: none;
    }

    block-size: 100%;
    ${({formatting:e})=>Yq(e)}
`,rFe=v.div`
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.2s;
    border-radius: var(--salt-radius-default);
    background-color: var(--intent-contrast);

    &:hover {
        box-shadow: var(--salt-elevation-shadow-1);

        ${qq} {
            animation: ${nFe} 0.8s ease-in-out;
        }
    }

    overflow: hidden;
    block-size: 100%;
`,aFe=v.div`
    position: relative;
    margin-block: ${({variant:e})=>e==="default"?"var(--salt-spacing-4) 0":"0"};
    margin-inline: ${({variant:e})=>e==="default"?"var(--salt-spacing-4)":"0"};
`,iFe=v.img`
    block-size: ${$(144)};
    object-fit: cover;
    object-position: center;
    inline-size: 100%;
    vertical-align: middle;
`,lFe=v.div`
    display: block;
    position: relative;
    block-size: 100%;
    margin-block: var(--salt-spacing-2);
    margin-inline: var(--salt-spacing-4);
    padding-inline-end: ${$(20)};
    white-space: initial;
    word-break: break-word;
`,cFe=v(O).attrs(()=>({bold:!0,size:"l"}))`
    display: block;
    line-height: normal;
`,dFe=v(O)`
    display: block;
    margin-block-start: var(--salt-spacing-1);
    line-height: normal;
`,uFe=v.div`
    ${({formatting:e})=>Yq(e)}
`,pFe=v(_e)`
    block-size: ${$(144)};
`,mFe=v(_e)`
    block-size: ${$(18)};
    inline-size: ${$(192)};
`,hFe=v(_e)`
    block-size: ${$(16)};
    inline-size: ${$(111)};
    margin-block-start: var(--salt-spacing-1);
`,gFe={Base:oFe,Body:rFe,ImageWrapper:aFe,StyledImage:iFe,TitleWrapper:lFe,Chevron:qq,Content:dFe,Title:cFe,BasePlaceholder:uFe,ImagePlaceholder:pFe,TitlePlaceholder:mFe,ContentPlaceholder:hFe},EFe=e=>e==="small"?243:328,fFe=e=>e==="auto-fill"?"auto-fill":"auto-fit",yFe=v.div`
    display: grid;
    grid-template-columns: ${({formatting:e,gridVariant:t})=>`repeat(${fFe(t)}, minmax(${$(EFe(e))}, 1fr))`};
    grid-gap: var(--salt-spacing-4);
`,IFe={MediaCardSection:yFe},fE={Collection:Kwe,Action:sFe,MediaNavigation:gFe,MediaCollection:IFe},Kf={xs:"var(--salt-spacing-1)",sm:"calc(var(--salt-spacing-1) + var(--salt-spacing-2) / 2)",md:"var(--salt-spacing-2)"},SFe=v.section`
    overflow: hidden;
    position: relative;
    display: flex;
    gap: var(--salt-spacing-4);
    flex-direction: column-reverse;
`,CFe=v.div`
    display: flex;
    justify-content: center;
    align-items: center;
`,vFe=v.ul`
    display: flex;
    align-self: stretch;
    flex-direction: row;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: var(--salt-spacing-2);
    transition: all 250ms linear;
    justify-content: ${({isOverflowing:e})=>e?"center":"flex-start"};
    inline-size: 100%;
`,TFe=v.li`
    flex-basis: ${({applyEqualWidth:e})=>e?"min-content":"100%"};
    flex-shrink: 0;
    transition: all 1ms;
`,_Fe=v.div`
    -ms-overflow-style: none;
    overflow: hidden;
    padding: 0;
    display: flex;
    align-items: center;
    border-radius: var(--border-radius);
`,bFe=v.div`
    display: flex;
    align-items: center;
    padding-block: 0;
    padding-inline: var(--salt-spacing-8);
    gap: var(--salt-spacing-05);
`,xFe=v.div`
    display: flex;
    overflow: auto;
    flex-direction: row;
    align-items: center;
    padding: var(--salt-spacing-2);
    gap: var(--salt-spacing-2);
    -ms-overflow-style: none;

    & > * {
        transition: all 250ms linear;
    }
`,AFe=v.div`
    min-block-size: ${({size:e})=>Kf[e]||Kf.md};
    min-inline-size: ${({size:e})=>Kf[e]||Kf.md};
    border-radius: 50%;
    background-color: ${({active:e})=>e?"var(--intent-primary-900)":"var(--intent-secondary-900)"};
`,qC={Container:SFe,Controls:CFe,Body:_Fe,ControlsInnerContainer:bFe,ItemsContainer:vFe,Item:TFe,IndicatorContainer:xFe,Dot:AFe},RFe=h.forwardRef((e,t)=>{const{formatMessage:n}=L(),o=n("button.loading.aria.label");return s.jsx(Xh,{...e,"aria-label":e.loading?o:e["aria-label"],ref:t})}),x={...RFe,Icon:Xh.Icon,Text:Xh.Text};x.Icon=Xh.Icon;x.Text=Xh.Text;const DFe=v.div`
    align-items: stretch;
    border-radius: var(--salt-radius-default);
    display: flex;
    block-size: ${({size:e})=>$(Jn[e])};
    justify-content: center;
`,OFe=v.input`
    min-inline-size: ${$(35)};
    block-size: 100%;
    border: none;
    padding-block: 0;
    padding-inline: var(--salt-spacing-2);
    background-color: var(--intent-contrast);
    text-align: center;
    font-size: var(--salt-text-l-font-size);
    font-weight: 600;
    font-family: var(--font-family);
    appearance: textfield;

    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
        appearance: none;
        margin-inline: 0;
        margin-block: 0;
    }
`,PFe=v.div`
    align-items: center;
    background-color: var(--intent-contrast);
    display: flex;
    flex: 1 0 20%;
    justify-content: center;
`,fO=v(x)`
    max-inline-size: 100%;
    inline-size: ${({fullWidth:e,text:t,size:n})=>e===!0||t?"100%":$(Jn[n??"md"])};
    min-inline-size: ${({size:e})=>$(Jn[e])};
    ${re.smUp`
        ${({text:e,fullWidth:t})=>e&&t===!1&&"inline-size: auto;"}
    `}
    background-color: ${({disabled:e})=>e?"var(--intent-action-50)":"var(--intent-action)"};
    border: var(--salt-border-1) solid
        ${({disabled:e})=>e?"var(--intent-action-50)":"var(--intent-action)"};
    flex: 1 0 auto;
    white-space: nowrap;
    color: ${({disabled:e})=>e?"var(--intent-content-200)":"var(--intent-action-contrast)"};
    touch-action: manipulation;

    &:hover:enabled {
        background-color: var(--intent-action-900);
        border-color: var(--intent-action-900);
        color: var(--intent-action-900-contrast);
    }
`,NFe=v(fO)`
    background-color: ${({disabled:e})=>e?"var(--intent-action-50)":"var(--intent-action-200)"};
    border: var(--salt-border-1) solid
        ${({disabled:e})=>e?"var(--intent-action-50)":"var(--intent-action-200)"};
    color: ${({disabled:e})=>e?"var(--intent-content-200)":"var(--intent-action-200-contrast)"};

    &:hover:enabled {
        background-color: var(--intent-action-900);
        border-color: var(--intent-action-900);
        color: var(--intent-action-900-contrast);
    }

    border-start-end-radius: 0;
    border-end-end-radius: 0;
    border-inline-end-width: 0;
    border-start-start-radius: var(--salt-radius-default);
    border-end-start-radius: var(--salt-radius-default);
`,LFe=v(fO)`
    border-start-start-radius: 0;
    border-end-start-radius: 0;
    border-inline-start-width: 0;
    border-start-end-radius: var(--salt-radius-default);
    border-end-end-radius: var(--salt-radius-default);
`,zi={Container:DFe,CountInput:OFe,CountInputContainer:PFe,Operator:fO,OperatorLeft:NFe,OperatorRight:LFe},Kq={disabled:.4},kFe=v.div`
    position: relative;
`,zq=v.div`
    background-color: var(--intent-contrast);
    box-shadow: var(--salt-elevation-shadow-1);
    min-block-size: ${$(340)};
    margin-block-start: var(--salt-spacing-2);
    overflow: hidden;
    padding-block: ${$(20)};
    padding-inline: ${$(22)};
    position: absolute;
    inline-size: ${$(296)};
    inset-inline-end: ${`calc(50% - ${$(296/2)})`};
    z-index: ${$t.dropdown};
    border-radius: var(--salt-radius-default);
`;zq.displayName="DatePicker-Container";const jFe=v.div`
    display: flex;
    line-height: 1;
    block-size: ${$(36)};
    margin-block: 0 ${$(8)};
    margin-inline-end: 0;
    inline-size: 100%;
`,Qq=v.div`
    align-items: center;
    display: flex;
    flex-grow: 1;
    font-weight: bold;
    justify-content: center;
    text-transform: uppercase;
`;Qq.displayName="DatePicker-Month";const Xq=v.button`
    align-items: center;
    background-color: inherit;
    border-radius: var(--salt-radius-default);
    cursor: pointer;
    display: flex;
    block-size: ${$(36)};
    justify-content: center;
    inline-size: ${$(36)};
    padding: 0;
`;Xq.displayName="DatePicker-MonthArrow";const MFe=v.table`
    border-spacing: 0;
    position: relative;
`,Zq=v.tr`
    display: flex;
    justify-content: space-between;
    text-align: center;
`;Zq.displayName="DatePicker-Row";const yO=v.td`
    align-items: center;
    background-color: ${({selected:e})=>e?"var(--intent-primary)":"transparent"};
    border: var(--salt-border-1) solid;
    border-color: ${({selected:e})=>e?"var(--intent-primary)":"transparent"};
    border-start-start-radius: var(--border-radius);
    border-start-end-radius: ${({selected:e})=>e?0:"var(--border-radius)"};
    border-end-end-radius: ${({selected:e})=>e?0:"var(--border-radius)"};
    border-end-start-radius: var(--border-radius);
    color: ${({selected:e})=>e?"var(--intent-primary-contrast)":"var(--intent-content)"};
    cursor: pointer;
    display: flex;
    font-size: var(--salt-text-s-font-size);
    font-weight: bold;
    block-size: ${$(36)};
    justify-content: center;
    opacity: ${({muted:e})=>e?Kq.disabled:1};
    padding-block: ${$(3)};
    padding-inline: ${$(6)};
    pointer-events: ${({muted:e})=>e?"none":"auto"};
    text-transform: uppercase;
    inline-size: ${$(36)};

    &:hover {
        border-color: ${({muted:e})=>e?"transparent":"var(--intent-primary)"};
    }
`;yO.displayName="DatePicker-Item";const Jq=v(yO)`
    border-color: var(--intent-primary);
    border-inline-start: 0;
    border-start-start-radius: 0;
    border-start-end-radius: ${({last:e})=>e?"var(--border-radius)":"0"};
    border-end-end-radius: ${({last:e})=>e?"var(--border-radius)":"0"};
    border-end-start-radius: 0;
    border-inline-end-width: ${({last:e})=>e?`${$(1)}`:"0"};
    border-inline-end-style: solid;
`;Jq.displayName="DatePicker-HighlightedItem";const eK=v.th`
    align-items: center;
    background-color: ${({selected:e})=>e?"var(--intent-primary)":"transparent"};
    border: var(--salt-border-1) solid;
    border-color: ${({selected:e})=>e?"var(--intent-primary)":"transparent"};
    border-start-start-radius: var(--border-radius);
    border-start-end-radius: ${({selected:e})=>e?0:"var(--border-radius)"};
    border-end-end-radius: ${({selected:e})=>e?0:"var(--border-radius)"};
    border-end-start-radius: var(--border-radius);
    color: ${({selected:e})=>e?"var(--intent-primary-contrast)":"var(--intent-content)"};
    cursor: auto;
    display: flex;
    font-size: var(--salt-text-s-font-size);
    font-weight: bold;
    block-size: ${$(36)};
    justify-content: center;
    opacity: ${({muted:e})=>e?Kq.disabled:1};
    padding-block: ${$(3)};
    padding-inline: ${$(6)};
    pointer-events: ${({muted:e})=>e?"none":"auto"};
    text-transform: uppercase;
    inline-size: ${$(36)};

    &:hover {
        border-color: transparent;
    }
`;eK.displayName="DatePicker-ItemColumnTitle";const wFe=v.div`
    border: var(--intent-secondary) solid;
    border-block-start-width: var(--salt-border-1);
    border-inline-start-width: 0;
    border-inline-end-width: 0;
    border-block-end-width: 0;
    margin-block-start: var(--salt-spacing-2);
    padding-block-start: var(--salt-spacing-2);
    text-align: center;
`,FFe=v.button`
    border: 0;
    padding: 0;
    text-align: center;
    background-color: inherit;
    color: inherit;
    inline-size: ${({fillSpace:e})=>e?"100%":""};
    block-size: ${({fillSpace:e})=>e?"100%":""};
    cursor: pointer;

    &:hover {
        ${({available:e})=>e&&"cursor: pointer"};
        ${({available:e})=>e&&`
            background-color: var(--intent-primary-100)
        `};
        text-decoration: ${({underline:e})=>e?"underline":"none"};
    }

    &:active {
        color: inherit;
        font-weight: inherit;
        text-decoration: none;
    }
`,BFe={Container:kFe,DatePickerContainer:zq,MonthContainer:jFe,Month:Qq,MonthArrow:Xq,DatePickerTable:MFe,Row:Zq,Item:yO,HighlightedItem:Jq,ItemColumnTitle:eK,Footer:wFe,EmptyButton:FFe},fe=v.dl`
    margin: 0;
    -webkit-margin-after: 0;
    -webkit-margin-before: 0;

    > div {
        display: flex;
    }
`,zI={xs:1,sm:2,md:4,lg:8,xl:16,xxl:32},UFe=v.dt`
    flex: 1 1 auto;
    padding-block: ${({padding:e})=>e?`0 var(--salt-spacing-${zI[e]})`:0};
    padding-inline: ${({padding:e})=>e?`0 var(--salt-spacing-${zI[e]})`:0};
    text-align: ${({align:e})=>e||"start"};
    ${({hyphenate:e})=>e&&"hyphens: auto;word-break: break-word;"}
`,GFe=e=>{switch(e){case"left":case"start":return"start";case"right":case"end":return"end";default:return e}},$Fe=v.dd`
    -webkit-margin-start: 0;
    flex: 1 1 auto;
    font-weight: 600;
    padding-block: ${({padding:e})=>e?`0 var(--salt-spacing-${zI[e]})`:0};
    padding-inline: ${({padding:e})=>e?`var(--salt-spacing-${zI[e]}) 0`:0};
    text-align: ${({align:e})=>GFe(e)||"end"};
    white-space: ${({nowrap:e})=>e?"nowrap":"normal"};
`;fe.DescriptionListTitle=UFe;fe.DescriptionListDescription=$Fe;const HFe=v.div`
    padding-block: var(--salt-spacing-4);
    padding-inline: var(--salt-spacing-1);
`,VFe=v.div`
    padding-block: 0;
    padding-inline: var(--salt-spacing-2);

    ${re.smUp`
        padding-block: var(--salt-spacing-4);
        padding-inline: var(--salt-spacing-2);
    `}
`,WFe=v.div`
    padding-block: 0;
    padding-inline: var(--salt-spacing-2);
`,YFe=v.div`
    display: flex;
    padding-block-start: var(--salt-spacing-2);
    justify-content: space-between;

    ${re.lgUp`
        justify-content: flex-start;
    `};
`,qFe=v.div.withConfig({shouldForwardProp:(e,t)=>!["display"].includes(e)&&t(e)})`
    display: none;
    flex-wrap: wrap;
    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
                display: ${({display:t})=>t||"block"};
            `};
`,KFe=v.div`
    inline-size: ${$(250)};

    a {
        text-decoration: none;
    }
`,zFe=v.div`
    margin-inline-start: ${e=>e.right?"auto":0};
`,wn=v.footer`
    border-block-start: var(--salt-border-1) solid var(--intent-secondary);
    margin-block-start: var(--salt-spacing-8);
`;wn.Leading=HFe;wn.Body=VFe;wn.Supplementary=WFe;wn.Row=YFe;wn.List=KFe;wn.Image=zFe;wn.Visible=qFe;const QFe={justify:m.oneOf(["flex-start","flex-end","center","space-between","space-around","initial","start","inherit"]),align:m.oneOf(["stretch","center","flex-start","flex-end","baseline","initial","inherit"]),gap:m.arrayOf(m.oneOf(["xs","sm","md","lg","xl","xxl",null])),gapSmUp:m.arrayOf(m.oneOf(["xs","sm","md","lg","xl","xxl",null])),gapMdUp:m.arrayOf(m.oneOf(["xs","sm","md","lg","xl","xxl",null])),gapLgUp:m.arrayOf(m.oneOf(["xs","sm","md","lg","xl","xxl",null])),wrap:m.oneOf(["nowrap","unset","wrap","wrap-reverse","initial","inherit"]),direction:m.oneOf(["row","row-reverse","column","column-reverse"])},XFe={justify:"inherit",align:null,wrap:"wrap",direction:"row",gap:null,gapSmUp:null,gapMdUp:null,gapLgUp:null},ZFe={xs:4,sm:8,md:16,lg:32,xl:64,xxl:128},JFe=e=>e.map(t=>t?`${$(ZFe[t])}`:"0").join(" "),zf=e=>e?`gap: ${JFe(e)};`:"",gn=v.div.withConfig({shouldForwardProp:(e,t)=>!["wrap","direction","justify","align","gap"].includes(e)&&t(e)})`
    display: flex;
    flex-flow: ${({direction:e})=>e} ${({wrap:e})=>e};
    flex-basis: ${({basis:e})=>e||"auto"};
    justify-content: ${({justify:e})=>e};
    ${({align:e})=>e&&`align-items:${e}`};

    ${({gap:e})=>zf(e)};

    ${re.smUp`
        ${({gapSmUp:e})=>zf(e)};
    `}

    ${re.mdUp`
        ${({gapMdUp:e})=>zf(e)};
    `}

    ${re.lgUp`
        ${({gapLgUp:e})=>zf(e)};
    `}
`;gn.displayName="Flex";gn.propTypes=QFe;gn.defaultProps=XFe;const eBe=v.div`
    flex-grow: 1;
`;eBe.displayName="FlexGrow";const tK=Fi`
    0% {
        opacity: .5;
    }
    50% {
        opacity: 1;
    }
    100% {
        opacity: .5;
    }
`,tBe=Fi`
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
`,sBe=v.img.withConfig({shouldForwardProp:(e,t)=>!["name","fill","height","width","info","success","primary","warning","error"].includes(e)&&t(e)})`
    display: inline-block;
    line-height: 0;
    vertical-align: middle;
    block-size: ${$(20)};
    inline-size: ${$(20)};
`,sK={ProductAttributeIconImage:sBe},{ProductAttributeIconImage:nBe}=sK,QI=20,XI=`calc(${$(QI)} + var(--salt-spacing-2))`,oBe=18,Wx=20,Sp=Math.max(oBe,Wx),rBe=22,Yx=28,nK=v.div`
    visibility: initial;
    margin-block-end: var(--salt-spacing-2);
    block-size: ${$(QI)};
    inline-size: 100%;
    position: relative;

    :empty {
        display: none;
    }

    ${re.smUp`
        :empty {
            display: block;
        }
    `}
`;nK.displayName="BreadcrumbHeader";const oK=v.div`
    white-space: normal;
    position: static;
`;oK.displayName="BreadcrumbDropdown";const rK=v.button.withConfig({shouldForwardProp:(e,t)=>!["width","height"].includes(e)&&t(e)})`
    inline-size: ${({width:e})=>$(e||QI)};
    block-size: ${({height:e})=>$(e||QI)};
    margin: 0;
    padding: 0;
    border: 0;
    background: transparent;
    cursor: pointer;
`;rK.displayName="BreadcrumbDropdownButton";const aBe=20,aK=v(O)`
    inline-size: ${({breadcrumbChild:e})=>e?`calc(100% - ${$(aBe*2)})`:"100%"};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    vertical-align: top;
`;aK.displayName="BreadcrumbText";const IO=200,SO=`calc(${$(IO)} - var(--salt-spacing-2) * 2)`,nB=5,dg=v.div`
    background-color: ${({active:e})=>e?"var(--intent-action-50)":"var(--intent-contrast)"};
    border-block-end: ${()=>`${$(nB)} solid var(--intent-secondary-100);`};
    display: flex;
    flex-basis: 100%;
    flex-direction: row;
    flex-grow: 1;
    margin: 0;
    padding: var(--salt-spacing-2);
    position: relative;
    text-align: start;

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                border: solid var(--intent-secondary-100);
                border-width: ${$(nB/2)};
                flex-basis: 25%;
                flex-direction: column;
                min-inline-size: ${$(IO)};
            `}

            ${re.mdUp`
                flex-basis: 20%;
            `}

            ${re.lgUp`
                flex-basis: ${Ke.lg/5}rem;
                inline-size:  ${Ke.lg/5}rem;
            `}
        `}
`;dg.displayName="Card";const ug=v.div`
    inline-size: 100%;
    max-block-size: 100%;
    display: flex;
    flex-direction: row;
    margin: 0;
    padding: 0;
    position: relative;
    text-align: start;
    border: 0;
    border-radius: var(--salt-radius-default);

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                flex-direction: column;
                min-inline-size: ${SO};
            `}
        `}
`;ug.displayName="BoxCard";const iBe=v.div`
    display: flex;
    flex-basis: 100%;
    flex-direction: column;
    flex-grow: 1;
    margin: 0;
    position: relative;

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                flex-basis: 25%;
                flex-direction: column;
                min-inline-size: ${$(IO)};
            `}

            ${re.mdUp`
                flex-basis: 20%;
            `}

            ${re.lgUp`
                flex-basis: ${Ke.lg/5}rem;
                inline-size: ${Ke.lg/5}rem;

                ${dg}, ${ug} {
                    inline-size: 100%;
                }
            `}
        `}
`,lBe=v.div`
    background: var(--intent-contrast);
    inset-block: 0;
    inset-inline: 0;
    opacity: 0.5;
    pointer-events: none;
    position: absolute;
    z-index: ${$t["fop-overlay"]};
`,iK=v.a`
    color: ${({presentationMode:e})=>e==="MUTE_STYLE"?"black":"var(--typography-promotion, var(--intent-promotion))"};
    text-decoration: none;

    &:hover {
        text-decoration: underline;
    }
`;iK.displayName="OfferLink";const lK=v(O).attrs({intent:"promotion"})`
    line-height: 18px;
    font-weight: ${({presentationMode:e})=>e==="MUTE_STYLE"?"bold":"normal"};
    text-decoration: none;
`;lK.displayName="OfferText";const cK=v(pe)`
    color: var(--intent-primary);
`;cK.displayName="FopTopBarIcon";const dK=v.div`
    -ms-flex-negative: 0;
    display: flex;
    flex-direction: column;
    background-color: var(--intent-contrast);
    border-start-start-radius: var(--border-radius);
    border-start-end-radius: 0;
    border-end-end-radius: 0;
    border-end-start-radius: var(--border-radius);
    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                border-start-start-radius: var(--border-radius);
                border-start-end-radius: 0;
                border-end-end-radius: 0;
                border-end-start-radius: 0;
        `}
        `};
`;dK.displayName="Header";const ZI=135,Q_=175,cBe=320,dBe=`calc(${$(cBe)-SO} - var(--salt-spacing-4) * 2 - var(--salt-spacing-1) * 2)`,uK=v.div`
    -ms-flex-negative: 0;
    min-inline-size: ${dBe};
    max-inline-size: calc(${$(ZI)} + var(--salt-spacing-1) * 2);
    position: relative;

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                margin-inline-end: 0;
                max-inline-size: unset;
            `}
        `}
`;uK.displayName="Media";const pK=v.div`
    position: absolute;
    inset-block-start: 0;
    inset-inline-end: 0;
    z-index: ${$t["fop-options"]};
`;pK.displayName="ActionsWrapper";const mK=v.div`
    display: flex;
    align-items: flex-start;
    position: absolute;
    inset-block-start: var(--salt-spacing-1);
    inset-inline: var(--salt-spacing-1);
    z-index: ${$t["fop-overlay"]};
`;mK.displayName="ImageTopBar";const hK=v(gn)`
    align-items: flex-start;
    row-gap: var(--salt-spacing-1);
    min-block-size: ${$(rBe)};
    padding-inline-end: 0;
    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                padding-inline-end: ${$(wq)};
            `}
        `};
`;hK.displayName="ImageTopBarTopRow";const gK=v.div`
    position: relative;
`;gK.displayName="ImageTopBarBottomRow";const EK=v.div`
    position: absolute;
    inset-block-start: 0;
    inset-inline: 0;
    padding-block-start: var(--salt-spacing-1);
`;EK.displayName="ImageTopBarBottomRowInner";const uBe=v(ln)``,pBe=v.div`
    padding-inline: var(--salt-spacing-2) var(--salt-spacing-2);
`;pBe.displayName="MissedPromotionFopWrapper";v.div`
    padding-inline: 0;
`;const mBe=v.div`
    inset-block-end: calc(
        -1 * (var(--salt-spacing-4) + ${$(Sp)} / 2)
    );
    position: absolute;
    inline-size: 100%;
    padding-block: var(--salt-spacing-2);
    font-weight: 600;
    background: var(--intent-contrast);
    box-shadow: 0 -1px ${$(1)} 0 rgb(0 0 0 / 7%);

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                inset-block-end: 0px;
            `}
        `}
`;mBe.displayName="MissedPromotion";const KC=v.div`
    inset-block-end: calc(-1 * var(--salt-spacing-4));
    inset-inline: var(--salt-spacing-2);
    line-height: 0;
    position: absolute;

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
            inset-block-end: ${({hasMultipleAttributeGroups:t})=>t?`-${$(Sp/2)}`:`calc(var(--salt-spacing-1) + ${$(Sp)} / 2)`};
        `}
        `}
`;KC.displayName="ImageBottomBar";KC.propTypes={hasMultipleAttributeGroups:m.bool};KC.defaultProps={hasMultipleAttributeGroups:!1};const fK=v.a`
    display: block;
    margin-block: calc(var(--salt-spacing-8) - var(--salt-spacing-1)) var(--salt-spacing-1);
    margin-inline: var(--salt-spacing-1);
    max-block-size: ${$(ZI)};
    max-inline-size: ${$(ZI)};

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                margin-block-start: calc(var(--salt-spacing-8) - var(--salt-spacing-1));
                margin-inline: auto;
                margin-block-end: var(--salt-spacing-1);
                block-size: ${$(Q_)};
                min-block-size: ${$(Q_)};
                max-block-size: unset;
                inline-size: ${$(Q_)};
                max-inline-size: unset;
            `}
        `};
`;fK.displayName="ImageWrapper";const yK=v.img`
    block-size: 100%;
    inline-size: 100%;
`;yK.displayName="StyledImage";const zC=v.div`
    ${e=>e.multiLine?`min-block-size: ${$(Sp)};`:`overflow: hidden; block-size: ${$(Sp)};`}
    margin-block-start: var(--salt-spacing-1);

    svg,
    ${nBe} {
        padding-block-end: var(--salt-spacing-05);
        padding-inline-end: var(--salt-spacing-05);

        &:last-child {
            padding-inline-end: 0;
        }
    }
`;zC.displayName="ProductAttributes";zC.propTypes={multiLine:m.bool};zC.defaultProps={multiLine:!1};const IK=v(pe).attrs(({name:e})=>({fill:e==="favourite"?"var(--intent-primary)":void 0,height:Wx,width:Wx,"data-test":`lifestyle-icon__${e}`}))``;IK.displayName="ProductAttribute";const SK=v(tt).attrs({standalone:!0})`
    display: block;
    min-inline-size: ${$(115)};
    overflow: hidden;
    inline-size: 100%;

    ${re.smUp`
        min-inline-size: ${$(165)};
    `}
`;SK.displayName="Title";const CK=v.div`
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    block-size: ${$(25)};
    margin-block-end: var(--salt-spacing-1);
`;CK.displayName="PriceWrapper";const vK=v.strong.withConfig({shouldForwardProp:(e,t)=>!["type"].includes(e)&&t(e)})`
    color: ${({type:e})=>e==="offer"?"var(--typography-promotion, var(--intent-promotion))":"var(--intent-content)"};
    font-size: var(--salt-display-font-size);
    font-weight: 700;
    margin-inline-end: var(--salt-spacing-1);
`;vK.displayName="Price";const CO=v.s`
    color: var(--intent-content);
    font-size: var(--salt-text-s-font-size);
    font-weight: 400;
`;CO.displayName="StrikethroughPrice";v(CO)`
    float: inline-end;
`;const TK=v(gn)`
    inline-size: calc(100% - (${$(ZI)} + var(--salt-spacing-1) * 2));
    min-inline-size: ${SO};
    padding: var(--salt-spacing-2);
    margin-block-start: 0;
    border-inline-start: 1px solid rgb(0 0 0 / 10%);
    border-block-start: none;
    position: relative;

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
            inline-size: 100%;
            padding-block-start: var(--salt-spacing-1);
            padding-inline: var(--salt-spacing-2);
            padding-block-end: var(--salt-spacing-2);
            margin-block-start: -1px;
            border-inline-start: none;
            border-block-start: 1px solid rgba(0, 0, 0, 0.1);
        `}
        `};
`;TK.displayName="BodyContainer";const _K=v.div`
    flex-direction: column;
    flex-grow: 1;
    max-inline-size: 100%;
    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
            padding-block: ${$(Sp/2)} 0;
            padding-inline: 0;
        `}
        `};
`;_K.displayName="Body";const bK=v.div`
    flex-direction: column;
    text-align: center;
    inline-size: 100%;
`;bK.displayName="Footer";const xK=Pe`
    z-index: ${$t["fop-overlay"]};
`;xK.displayName="NavigationButton";const AK=v.div`
    block-size: ${$(Yx)};
    overflow: auto;
`;AK.displayName="Status";const RK=v.div`
    block-size: ${$(18)};
    margin-inline-end: var(--salt-spacing-1);
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
`;RK.displayName="Size";const DK=v(O)`
    color: ${({branded:e})=>e?"var(--intent-primary)":"currentColor"};
    margin-inline-end: var(--salt-spacing-1);
`;DK.displayName="SizeText";const OK=v.div`
    overflow: hidden;
    block-size: ${$(36)};
    margin-block-end: var(--salt-spacing-1);
`;OK.displayName="OfferContainer";const PK=v.span`
    margin-inline: ${({post:e})=>e&&"var(--salt-spacing-1)"}
        ${({pre:e})=>e&&"var(--salt-spacing-1)"};
`;PK.displayName="CatchWeightText";const oB=404,rB=191,vO=v(iBe)`
    inline-size: 100%;
    margin-block-end: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
    block-size: ${({breadcrumbsHeader:e,firstInGroup:t,status:n})=>`calc(
            ${$(rB)} +
                ${e&&t?XI:"0px"} +
                ${n?`calc(${$(Yx)} + 'var(--salt-spacing-1)')`:"0px"}
        )`};
    /* stylelint-disable-next-line no-descending-specificity */
    ${dg}, ${ug} {
        block-size: ${$(rB)};
    }

    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
            block-size: ${({breadcrumbsHeader:t,status:n})=>`calc(
                    ${$(oB)} +
                        ${t?XI:"0px"} +
                        ${n?`calc(${$(Yx)} + 'var(--salt-spacing-1)')`:"0px"}
                )`};

            ${dg}, ${ug} {
                block-size: ${$(oB)};
            }
        `}
        `}
`;vO.displayName="FixedHeightWrapper";const NK=v(vO)`
    && {
        animation: ${tK} 1s infinite;
        background-image: url('/static/images/fopSkeletonMobile.jpg');
        background-size: 100% 100%;
        background-position: center center;
        background-repeat: no-repeat;
        border: none;
        position: absolute;
        inset-block: ${({firstInGroup:e})=>e?$(XI):0} 0;
        inset-inline: var(--salt-spacing-2) var(--salt-spacing-2);
        margin: 0;
        inline-size: unset;
        min-inline-size: unset;
        padding: 0;

        ${({displayLandscapeLayout:e})=>!e&&Pe`
                ${re.smUp`
                background-image: url("/static/images/fopSkeletonDesktop.jpg");
                inset-block-start: ${XI};
            `}
            `}
    }
`;NK.displayName="FixedHeightSkeleton";const LK=v(SK)`
    block-size: ${$(40)};
    margin-block-end: var(--salt-spacing-1);
    margin-inline-end: ${$(wq)};
    inline-size: auto;
    ${re.smUp`
        margin-inline-end: 0;
        inline-size: 100%;
    `}
`;LK.displayName="FixedHeightTitle";const hBe=v.div`
    display: flex;
    justify-content: center;
    align-items: center;
    margin-inline-end: var(--salt-spacing-2);
    inline-size: ${$(40)};
    block-size: ${$(40)};
    border: var(--salt-border-1) solid var(--intent-secondary-900);
    border-radius: var(--border-radius);
    background: var(--intent-contrast);
`,gBe=v.span`
    ${hO}
`;gBe.displayName="CountryOfOriginA11yPrefix";const EBe=e=>e==="xl"?"var(--salt-display-font-size)":`var(--salt-text-${e}-font-size)`,fBe=e=>e==="xl"?"var(--salt-display-line-height)":`var(--salt-text-${e}-line-height)`,kK=v(ln)`
    > * {
        font-size: ${({size:e})=>e&&EBe(e)};
        line-height: ${({size:e})=>e&&fBe(e)};
    }

    max-inline-size: 100%;
`;kK.displayName="CountryOfOrigin";const nt={FixedHeightWrapper:vO,FixedHeightSkeleton:NK,FixedHeightTitle:LK,ActionsWrapper:pK,Body:_K,BodyContainer:TK,BoxCard:ug,BreadcrumbDropdown:oK,BreadcrumbDropdownButton:rK,BreadcrumbHeader:nK,BreadcrumbText:aK,Card:dg,CatchWeightText:PK,CountryOfOrigin:kK,FopTopBarIcon:cK,Footer:bK,Header:dK,Image:yK,ImageWrapper:fK,Media:uK,NavigationButton:xK,OfferContainer:OK,OfferLink:iK,OfferText:lK,OrderQuantity:hBe,OutOfStockBadge:uBe,Overlay:lBe,Price:vK,PriceWrapper:CK,ProductAttribute:IK,ProductAttributes:zC,Status:AK,Size:RK,SizeText:DK,StrikethroughPrice:CO,ImageTopBar:mK,ImageTopBarTopRow:hK,ImageTopBarBottomRow:gK,ImageTopBarBottomRowInner:EK,ImageBottomBar:KC},yBe=v.div`
    border: 0;
    display: flex;
    flex-wrap: wrap;
    margin-inline: calc(-1 * var(--salt-spacing-2));
`,IBe=v(nt.Card)`
    && {
        border: none;
        block-size: 0;
        padding: 0;
        visibility: hidden;
        inline-size: 0;
    }
`,vo={Container:yBe,Placeholder:IBe},SBe=v(_e)`
    padding-block-end: 100%;
    ${re.smUp`
        inline-size: auto;
        padding-inline-end: 100%;
    `};
`,CBe={PlaceholderImage:SBe},yn={errorMessage:{padding:3},label:{color:"var(--intent-content)","font-size":14,"font-weight":400,padding:4,error:{color:"var(--typography-error, var(--intent-error))"}},checkboxOrRadio:{size:20,label:{padding:2}},outlineBoxShadow:()=>"0 0 3px 2px rgb(59, 153, 252)",dropdown:{arrow:{size:10,color:"var(--intent-content)"}},radio:{off:{color:"var(--intent-content)"},on:{fill:"var(--intent-content)"},disabled:{color:"var(--typography-error, var(--intent-error)"}},checkbox:{off:{color:"var(--intent-content)"},on:{fill:"var(--intent-content)","tick-color":"white"}}},TO=v(pe)`
    border-radius: var(--salt-border-radius);
    block-size: ${$(yn.checkboxOrRadio.size)};
    margin-inline-end: var(--salt-spacing-2);
    inline-size: ${$(yn.checkboxOrRadio.size)};

    input[type='checkbox']:focus + & {
        outline: 5px auto Highlight;
        outline: 5px auto -webkit-focus-ring-color;
    }
`,vBe=v(TO)`
    color: ${yn.checkbox.off.color};
`,TBe=v(TO)`
    > svg {
        fill: ${yn.checkbox.on.fill};

        path:nth-child(2) {
            fill: ${yn.checkbox.on["tick-color"]};
        }
    }
`,_Be=v(O)`
    overflow: hidden;
`,bBe=v(O)`
    align-items: center;
    white-space: ${e=>e.whiteSpace};
    display: block;
    text-overflow: ellipsis;
    overflow: hidden;

    ::after {
        content: '\\0020'; /* space */
    }
`,xBe=v.span`
    font-weight: 400;
`,QC={CheckboxText:bBe,CheckboxIcon:TO,CheckboxIconOff:vBe,CheckboxIconOn:TBe,ContentWrapper:xBe,CheckboxTextWrapper:_Be},oi=v(O)`
    margin-block-start: ${$(yn.errorMessage.padding)};
    display: block;
`;oi.displayName="FormErrorMessage";oi.defaultProps={intent:"error",italic:!0};const ABe=Pe`
    color: ${({hasError:e})=>e?yn.label.error.color:yn.label.color};
    cursor: ${({disabled:e})=>e?"not-allowed":"pointer"};
    display: flex;
    font-weight: ${yn.label["font-weight"]};
    font-size: ${$(yn.label["font-size"])};
    margin-block-end: ${$(yn.label.padding)};
    ${({isRequired:e})=>e&&"&:before { content: '*' }"}
`,RBe=Pe`
    input[type='checkbox'],
    input[type='radio'] {
        block-size: 1px;
        inline-size: 1px;
        margin: -1px;
        opacity: 0;

        &:focus ~ ${om} {
            display: inline-table;
        }
    }
`,DBe=Pe`
    ${ABe}
    ${RBe}
`,jK=v.label`
    ${({visuallyConcealed:e})=>e?hO:DBe}
`,XC=v(pe).attrs(()=>({height:yn.checkboxOrRadio.size,width:yn.checkboxOrRadio.size}))`
    border-radius: 50%;
    margin-inline-end: var(--salt-spacing-2);
`,OBe=v(XC)`
    color: ${yn.radio.off.color};
`,PBe=v(XC)`
    > svg {
        fill: ${yn.radio.on.fill};
    }
`,NBe=v(XC)`
    color: ${yn.radio.disabled.color};
`,LBe=v(O)`
    display: block;

    ::after {
        content: '\\0020'; /* space */
    }
`,kBe=v.span`
    font-weight: 400;
`,Pa={RadioIcon:XC,RadioIconOff:OBe,RadioIconOn:PBe,RadioIconDisabled:NBe,ContentWrapper:kBe,RadioText:LBe},_a=v.div`
    inline-size: ${({fill:e})=>e&&"100%"};
    margin-block-end: ${({last:e})=>e?0:"var(--salt-spacing-4)"};
    position: relative;

    &:last-child {
        margin-block-end: 0;
    }
`,ZC=v.input`
    background-color: ${({hasError:e})=>e?"var(--intent-error-50)":"var(--intent-contrast)"};
    border: var(--salt-border-1) solid
        ${({hasError:e})=>e?"var(--typography-error)":"var(--intent-secondary-800)"};
    border-radius: var(--border-radius);
    color: ${({hasError:e})=>e?"var(--typography-error)":"var(--intent-content)"};
    cursor: text;
    font-family: var(--font-family);
    block-size: ${({blockSize:e})=>$(Jn[e||"md"])};
    padding: var(--salt-spacing-2);
    position: relative;
    inline-size: 100%;
    appearance: none;
    line-height: var(--salt-text-l-line-height);
    font-size: var(--salt-text-l-font-size);

    &::placeholder {
        color: ${({hasError:e})=>e?"var(--typography-error)":"var(--intent-content)"};
    }

    &[readonly] {
        border: none;
    }
`,_O=v(ZC)`
    min-block-size: ${$(150)};
`,MK=Object.freeze(Object.defineProperty({__proto__:null,Checkbox:QC,ErrorMessage:oi,Label:jK,Radio:Pa,Row:_a,Textarea:_O},Symbol.toStringTag,{value:"Module"})),jBe=v.li.withConfig({shouldForwardProp:(e,t)=>!["disabled"].includes(e)&&t(e)})`
    align-items: center;
    border: var(--salt-border-1) solid var(--intent-secondary);
    display: flex;
    flex: 1 0 auto;
    justify-content: space-between;
    overflow: hidden;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-4);

    &:hover {
        background-color: ${({disabled:e})=>e?void 0:"var(--intent-secondary-50)"};
        color: ${({disabled:e})=>e?void 0:"var(--intent-content)"};
        cursor: ${({disabled:e})=>e?"not-allowed":"pointer"};
    }

    &:active {
        background-color: ${({disabled:e})=>e?void 0:"var(--intent-secondary-100)"};
        color: ${({disabled:e})=>e?void 0:"var(--intent-content)"};
    }

    > div {
        margin-block-end: 0;
        padding-block-start: ${$(7)};
    }
`,ba=v.ul`
    display: flex;
    flex-direction: column;
    list-style: none;
    margin: 0;
    padding: 0;

    > li {
        margin-block: ${$(-1)} 0;
        margin-inline: 0;
    }

    > li:first-child {
        border-start-start-radius: var(--border-radius);
        border-start-end-radius: var(--border-radius);
        margin-block-start: 0;
    }

    > li:last-child {
        border-end-start-radius: var(--border-radius);
        border-end-end-radius: var(--border-radius);
    }
`;ba.Row=jBe;const bO=v.li`
    display: ${({inline:e})=>e?"inline-block":"block"};
    margin-block: ${({inline:e})=>e?0:"0 var(--salt-spacing-2)"};
    margin-inline: ${({inline:e})=>e?"var(--salt-spacing-2)":0};

    &:last-child {
        margin-block-end: 0;
    }

    &:empty {
        display: none;
    }
`;bO.displayName="ListItem";const xO=v.ul`
    list-style: none;
    margin: 0;
    padding: 0;
`;xO.displayName="List";xO.Item=bO;const wK={StyledList:xO,ListItem:bO},FK=4,MBe=v.div.withConfig({shouldForwardProp:(e,t)=>!["size"].includes(e)&&t(e)})`
    position: relative;
    inline-size: ${({size:e})=>$(e)};
    block-size: ${({size:e})=>$(e)};
`,wBe=v.svg.withConfig({shouldForwardProp:(e,t)=>!["size","radius"].includes(e)&&t(e)})`
    inline-size: ${({size:e})=>$(e)};
    block-size: ${({size:e})=>$(e)};
    fill: transparent;
    transform: rotate(-90deg);

    & circle {
        stroke-width: ${$(FK)};
        stroke-dashoffset: 0;
        transition: stroke-dashoffset 1s linear;
        stroke-dasharray: ${({radius:e})=>Math.PI*e*2};
    }

    & .path {
        stroke: var(--intent-secondary-900);
    }

    & .progress {
        stroke: ${({colorName:e})=>`var(--intent-${e})`};
        stroke-dashoffset: ${({progress:e,radius:t})=>Math.PI*t*2*((100-e)/100)};
    }
`,FBe=v.div.withConfig({shouldForwardProp:(e,t)=>!["size"].includes(e)&&t(e)})`
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    block-size: ${({size:e})=>$(e)};
    inline-size: ${({size:e})=>$(e)};
    inset-block-start: 0;
    inset-inline-start: 0;
`,BBe={strokeWidth:FK,Wrapper:MBe,Ring:wBe,ContentContainer:FBe},BK=e=>{switch(e){case"start":case"left":return"start";case"end":case"right":return"end";default:return e}},UK=v.div`
    border-start-start-radius: var(--border-radius);
    border-start-end-radius: var(--border-radius);
    flex-shrink: 0;
    padding-block: var(--salt-spacing-2);
    padding-inline: ${({align:e})=>e==="center"?`${$(36)}`:"var(--salt-spacing-4)"} ${$(36)};
    text-align: ${({align:e})=>BK(e)};

    ${({condensed:e=!1})=>!e&&re.smUp`
            padding-block: var(--salt-spacing-4);
            padding-inline: ${$(50)};
    `};
`;UK.displayName="Dialog-Header";const GK=v.div`
    border-end-end-radius: var(--border-radius);
    border-end-start-radius: var(--border-radius);
    display: flex;
    flex-shrink: 0;
    flex-wrap: nowrap;
    ${({flow:e})=>`flex-flow:${e}`};
    padding-block: var(--salt-spacing-4);
    padding-inline: var(--salt-spacing-4);

    ${({condensed:e=!1})=>!e&&re.smUp`
            padding-block: ${$(20)};
            padding-inline: ${$(50)};
            text-align: ${({align:t})=>BK(t)};
    `};
`;GK.displayName="Dialog-Footer";const UBe={width:{sm:492,md:742,lg:984}},GBe=()=>"calc(100vw - var(--salt-spacing-2))",$Be=v.div`
    background-color: var(--background-color);
    border-radius: var(--border-radius);
    display: flex;
    flex-direction: column;
    flex-grow: 0;
    max-inline-size: ${({maxWidth:e})=>$(UBe.width[e])};
    position: relative;
    inline-size: ${GBe};
    -webkit-overflow-scrolling: touch;
    max-block-size: 100%;
    min-block-size: 0;
    overflow: hidden;

    ${({viewHeight:e})=>e&&`block-size: ${e};`}

    ${re.smUp`
        flex-grow: 0;
    `};
`,HBe=v(x)`
    position: absolute;
    inset-block-start: var(--salt-spacing-2);
    inset-inline-end: var(--salt-spacing-2);
    z-index: ${$t["dialog-close"]};
`,VBe=v.div.withConfig({shouldForwardProp:(e,t)=>!["direction"].includes(e)&&t(e)})`
    /* stylelint-disable scss/dollar-variable-pattern */
    ${({grow:e})=>`flex-grow: ${e};`}

    ${re.smUp`
        ${({grow:e})=>`flex-grow: ${e};`}
    `}
    ${({direction:e})=>e==="row"?"block-size":"inline-size"}: 100%;
    ${({direction:e})=>e==="row"?"min-inline-size":"min-block-size"}: var(--salt-spacing-1);
    /* stylelint-enable scss/dollar-variable-pattern */
`,WBe=v.form`
    display: flex;
    flex-direction: column;
    overflow: auto;
`,YBe=v.div`
    display: flex;
    flex-direction: column;
    block-size: 100%;
`,$K={Content:$Be,DialogForm:WBe,StyledHeader:UK,StyledFooter:GK,Fill:VBe,CloseButton:HBe,FlexColumn:YBe},qBe={"navigation-list":"_navigation-list_rphzh_1","navigation-list__item":"_navigation-list__item_rphzh_7","navigation-list__item--bold":"_navigation-list__item--bold_rphzh_21"},HK=Bp.bind(qBe);function no({children:e,className:t,...n}){return s.jsx("ul",{className:HK("navigation-list",t),...n,children:e})}function KBe({bold:e,children:t,className:n,...o}){const r=HK({"navigation-list__item":!0,"navigation-list__item--bold":e},n);return s.jsx("li",{className:r,...o,children:t})}no.Item=KBe;const zBe=v.div`
    display: inline-block;
`,QBe=v.div`
    display: inline-block;
    float: inline-start;
    inline-size: calc(100% - (100px + var(--salt-spacing-2)));
`,XBe=v.div`
    float: inline-start;
    margin-inline-end: var(--salt-spacing-2);
    position: relative;
`,ZBe=v.img`
    inline-size: ${$(100)};
    max-inline-size: ${$(100)};
`,JBe=v(O)`
    display: inline-block;
    margin-block-end: var(--salt-spacing-2);
    min-inline-size: ${$(175)};
    overflow: hidden;

    ${re.smUp`
        block-size: ${$(40)};
    `};
`,eUe={Wrapper:zBe,Body:QBe,Media:XBe,Image:ZBe,Title:JBe},Ll=h.forwardRef((e,t)=>{const{formatMessage:n}=L(),o=n("quantity.badge.number.above.maximum",{count:e.count}),r=e.overflowAccessibilityText||e.accessibilityText;return s.jsx(lce,{overflowText:o,overflowAccessibilityText:r,...e,ref:t})}),X_=(e,t)=>(...n)=>Pe`
        @media (min-width: ${Ke[e]}em) and (max-width: ${Ke[t]}em) {
            @media not screen and (width: ${Ke[t]}em) {
                ${Pe(...n)}
            }
        }
    `,VK=$(40),AO=`
    max-block-size: ${VK};
    @supports (-webkit-line-clamp: 2) {
        block-size: auto;
        min-inline-size: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: initial;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
`,tUe=v(nt.Body)`
    inline-size: 100%;
`;tUe.displayName="Body";v(nt.FixedHeightTitle)`
    ${AO}
    min-inline-size: 100%;
`;const sUe=v.div`
    > ${nt.OfferLink} {
        ${AO}
    }

    margin-block-end: 0;
`;sUe.displayName="OfferContainer";const nUe=v(O)`
    ${AO};

    max-block-size: ${VK};
    margin-block-end: 0;
`;nUe.displayName="Size";const WK=v(Ll)`
    position: absolute;
    inset-block-start: -${$(3)};
    inset-inline-end: -${$(3)};
    z-index: ${$t.badge};
`;WK.displayName="TileQuantityBadge";const YK=v(nt.Media)`
    min-inline-size: auto;
    margin-inline-end: 0;
`;YK.displayName="TileMedia";const oUe=v.a`
    display: block;
    margin-block: 0;
    margin-inline: auto;
`;oUe.displayName="ImageWrapper";const rUe=v.div`
    overflow: auto;
`;rUe.displayName="Status";const qK=v(nt.ImageTopBar)`
    inset-block-start: -${$(10)};
    inset-inline-start: -${$(10)};
`;qK.displayName="ImageTopBar";const yE=v.div`
    -ms-flex-negative: 0;
    display: flex;
    flex-direction: column;
    inline-size: 100%;
    block-size: auto;
    border-radius: var(--salt-radius-default);
    padding-block: var(--salt-spacing-2) var(--salt-spacing-1);
    padding-inline: var(--salt-spacing-2);
    margin: 0;
    background-color: var(--intent-contrast);
`;yE.displayName="Tile";const KK=v(yE)`
    && {
        animation: ${tK} 1s infinite;
        background-color: var(--intent-secondary);
        inline-size: 100%;
        padding-block-start: calc(100% - var(--salt-spacing-1));
        box-shadow: none;
    }
`;KK.displayName="TileSkeleton";const Cp=v.div`
    background-color: var(--intent-contrast);
    inline-size: calc(100% + ${$(50)});
    border-radius: var(--border-radius);
    box-shadow: var(--salt-elevation-shadow-1);
    position: absolute;
    inset-block-start: -${$(5)};
    inset-inline-start: -${$(25)};
    visibility: hidden;
    padding: var(--salt-spacing-2);

    ${re.smUp`
        padding-block: 0 var(--salt-spacing-1);
        padding-inline: var(--salt-spacing-2);
    `}
`;Cp.displayName="Fop";const aUe=v.div`
    -ms-flex-negative: 0;
    display: flex;
    flex-direction: column;
    background-color: var(--intent-contrast);

    ${re.smUp`
        margin-block-end: var(--salt-spacing-2);
        margin-block-start: var(--salt-spacing-1);
    `};
`;aUe.displayName="FopHeader";const iUe=v(gn)`
    inline-size: 100%;
`;iUe.displayName="FopBodyContainer";const Qf=e=>`
    &:nth-child(${e}n) > ${Cp} {
        inset-inline-start: auto;
        inset-inline-end: 0;
    }
    &:nth-child(${e}n + 1) > ${Cp} {
        inset-inline-start: 0;
    }
`,zK="var(--salt-spacing-2)",Xf=e=>{const t=`calc(100% / ${e})`,n=`calc(${t} - ${zK})`;return`
        max-inline-size: ${t};
        &:nth-child(${e}n + 1) {
            border-inline-start-width: 0;
            max-inline-size: ${n};
            margin-inline-start: var(--salt-spacing-2);
        }
        &:nth-child(${e}n) {
            border-inline-end-width: 0;
            max-inline-size: ${n};
            margin-inline-end: var(--salt-spacing-2);
        }
    `},aB=`
    outline: none;
    padding: 0;
    @supports (position: sticky) {
        position: sticky;
    }
    inset-block-end: 0;
    z-index: ${$t.header};
    > ${yE} {
        visibility: hidden;
    }
    > ${Cp} {
        visibility: visible;
    }
`,iB=3,Z_=4,J_=5,eb=7,QK=v.div.attrs({tabIndex:0})`
    contain: layout;
    padding: 0;
    position: relative;
    flex: 1 1 calc(100% / 3);
    flex-wrap: wrap;
    max-inline-size: calc(100% / 3);
    min-inline-size: auto;
    border: solid transparent ${zK};

    ${X_("xs","sm")`
        ${({fopTilesInRow:e})=>Qf(e?.xs||iB)}
        ${({fopTilesInRow:e})=>Xf(e?.xs||iB)}
    `}
    ${X_("sm","md")`
        ${({fopTilesInRow:e})=>Qf(e?.sm||Z_)}
        ${({fopTilesInRow:e})=>Xf(e?.sm||Z_)}
        flex: 1 1 calc(100% / ${({fopTilesInRow:e})=>e?.sm||Z_});
    `}
    ${X_("md","lg")`
        ${({fopTilesInRow:e})=>Qf(e?.md||J_)}
        ${({fopTilesInRow:e})=>Xf(e?.md||J_)}
        flex: 1 1 calc(100% / ${({fopTilesInRow:e})=>e?.md||J_});
    `} {
        /*
            --bar-bottom-height: css variable set to overwrite the inline css (injected first time tile gets focus) variable in the container
        */
    }

    ${re.mdUp`
        --bar-bottom-height: 5px;
    `};
    ${re.lgUp`
        ${({fopTilesInRow:e})=>Qf(e?.lg||eb)}
        ${({fopTilesInRow:e})=>Xf(e?.lg||eb)}
        flex: 1 1 calc(100% / ${({fopTilesInRow:e})=>e?.lg||eb});
    `}
    &:hover {
        position: relative;
        inset-block-end: 0;
        cursor: pointer;
    }

    /* stylelint-disable-next-line selector-class-pattern */
    &.focusWithin {
        ${aB}
        inset-block-start: 0;
        ${re.mdUp`
            z-index: ${$t["fop-overlay"]};
        `};
    }

    &:focus-within {
        ${aB}
        ${re.mdUp`
            z-index: ${$t["fop-overlay"]};
        `};
    }

    &:not(:focus-within) {
        inset-block-end: 0 !important;
    }

    /*
        - @media (hover: none): aiming mobile devices in particular iOS
        - &:not(:hover): on iOS (tested on version 11.4) the event blur get triggered only when focus on other element.
        Losing hover instead of rely on blur
        &:focus-within:not(:hover): reset the position of the wrapper when you tap out
    */
    @media (hover: none) {
        &:not(:hover) > ${Cp} {
            visibility: hidden;
        }
        &:not(:hover) > ${yE} {
            visibility: visible;
        }

        &:focus-within:not(:hover) {
            position: relative;
            inset-block-end: 0 !important;
            z-index: ${$t["fop-overlay"]};
        }
    }
`;QK.displayName="Wrapper";const XK={TileQuantityBadge:WK,TileMedia:YK,ImageTopBar:qK,Tile:yE,TileSkeleton:KK,Fop:Cp,Wrapper:QK},ih=20,Zf=24,lUe=v.progress`
    appearance: none;
    border-radius: ${Zf}px;
    block-size: ${Zf}px;
    inline-size: 100%;
    color: var(--intent-action-50);
    background-color: var(--intent-action-50);

    &::-webkit-progress-bar {
        block-size: ${ih}px;
        border-radius: ${ih}px;
        background-color: var(--intent-action-50);
    }

    &::-webkit-progress-value {
        block-size: ${Zf}px;
        border-radius: ${Zf}px;
        background-color: var(--intent-action);
        position: relative;
        display: ${({value:e})=>!e||e===0?"none":"inline-block"};
    }

    &::-moz-progress-bar {
        block-size: ${({value:e})=>!e||e===0?0:`${ih}px`};
        border-radius: ${ih}px;
        background-color: var(--intent-action);
    }

    &::-ms-fill {
        border: none;
        border-radius: ${ih}px;
        background-color: var(--intent-action);
    }
`,cUe={ProgressBarElement:lUe},dUe=v.div`
    color: var(--intent-content);
    line-height: var(--salt-text-m-line-height);
    padding-block-start: ${$(co.v2.sm)};
    @supports (position: sticky) {
        padding-block-start: 0 !important;
    }

    display: flex;
    block-size: 100vb;
    flex-direction: column;

    ${re.lgUp`
        padding-block-start: ${$(co.v2.lgUp)};
    `}
`,uUe=v.select`
    block-size: 100%;
    opacity: 0;
    position: absolute;
    inset-block-start: 0;
    inset-inline-start: 0;
    inline-size: 100%;
    z-index: ${$t.select};
    appearance: none;
`,pUe=v.span`
    align-items: center;
    box-shadow: ${({focus:e})=>e?yn.outlineBoxShadow():"none"};
    background-color: ${({hasError:e})=>e?"var(--intent-error-50)":"var(--intent-contrast)"};
    border: var(--salt-border-1) solid
        ${({hasError:e})=>e?"var(--typography-error)":"var(--intent-secondary-800)"};
    border-radius: var(--border-radius);
    color: ${({hasError:e})=>e?"var(--typography-error)":"var(--intent-content)"};
    display: flex;
    block-size: ${({size:e})=>$(Jn[e])};
    padding-inline: var(--salt-spacing-2)
        calc(var(--salt-spacing-4) + ${$(yn.dropdown.arrow.size)});
    position: relative;
    inline-size: 100%;
    z-index: ${$t.select-1};
    font-size: var(--salt-text-l-font-size);

    &::after {
        border-block-start: ${()=>`${$(yn.dropdown.arrow.size/2)} solid ${yn.dropdown.arrow.color}`};
        border-inline-start: ${$(yn.dropdown.arrow.size/2)} solid transparent;
        border-inline-end: ${$(yn.dropdown.arrow.size/2)} solid transparent;
        content: '';
        display: inline-block;
        block-size: 0;
        position: absolute;
        inset-inline-end: ${$(10.5)};
        inset-block-start: 50%;
        transform: translateY(-50%);
        inline-size: 0;
    }
`,mUe=v.span`
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`,hUe=v.span`
    color: ${({hasError:e})=>e?"var(--typography-error)":"var(--intent-content)"};
`,Xu={RawSelect:uUe,SelectWrapper:pUe,SelectResult:mUe,Placeholder:hUe},gUe={s:32,m:52,l:64},EUe={s:4,m:5,l:5},Jf=({size:e})=>$(gUe[e]),JC=v.div`
    block-size: ${Jf};
    inline-size: ${Jf};
    margin-inline: auto;

    &::before,
    &::after {
        content: '';
        display: block;
        block-size: ${Jf};
        inline-size: ${Jf};
        border-radius: ${$(60)};
        position: absolute;
        border-width: ${({size:e})=>$(EUe[e])};
        border-style: solid;
    }

    &::before {
        border-color: var(--intent-primary-100);
    }

    &::after {
        animation: ${tBe} 0.6s linear infinite;
        border-color: var(--intent-primary) transparent transparent;
        z-index: ${$t.icon};
    }
`,ZK=v.div`
    inline-size: 70%;
    position: absolute;
    inset-block: 50% 0;
    inset-inline: 50% 0;
    transform: translateX(-50%) translateY(-50%);
`,JK=v(O)`
    display: block;
    margin-block-start: var(--salt-spacing-2);
    font-weight: bold;
    ${cce("break-word")};
    word-break: break-word;
    text-align: center;
`,fUe=v.div`
    overflow-x: scroll;

    ${re.smUp`
        overflow-x: visible;
    `}

    table {
        text-align: end;
        border-collapse: collapse;
        inline-size: 100%;
    }

    th {
        text-align: end;
        padding: var(--salt-spacing-2);

        :nth-child(1) {
            text-align: start;
        }
    }

    tr {
        :nth-child(even) {
            background-color: var(--intent-secondary-100);
        }
    }

    td {
        padding: var(--salt-spacing-2);

        :nth-child(1) {
            text-align: start;
        }
    }

    thead + tbody tr {
        :first-child {
            text-align: inherit;
        }
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        line-height: var(--salt-text-l-line-height);
        font-family: var(--font-family);
    }

    h1 {
        font-size: var(--salt-display-font-size);
        font-weight: 600;
    }

    h2 {
        font-size: var(--salt-text-l-font-size);
        font-weight: 600;
    }

    h3 {
        font-size: var(--salt-text-m-font-size);
        font-weight: 600;
        text-transform: uppercase;
    }

    h4,
    h5,
    h6 {
        font-size: var(--salt-text-m-font-size);
        font-weight: 600;
    }

    p,
    ul,
    ol {
        color: currentcolor;
        display: block;
        font-size: var(--salt-text-m-font-size);
        font-weight: normal;
        line-height: var(--salt-text-l-line-height);
    }

    p {
        margin: 0;
    }

    strong,
    b {
        font-weight: bold;
    }

    a {
        border-radius: var(--border-radius);
        color: var(--intent-content);
        cursor: pointer;
        display: inline-block;
        font-weight: 400;

        &:hover {
            color: var(--intent-content);
            font-weight: 400;
            text-decoration: none;
        }

        &:active {
            color: var(--intent-content);
            font-weight: 400;
            text-decoration: none;
        }
    }
`,yUe=v.div`
    align-items: center;
    background-color: var(--intent-secondary-900);
    border-radius: var(--border-radius);
    color: var(--intent-secondary-contrast);
    display: inline-flex;
    ${({size:e,minSize:t})=>t?`min-block-size: ${$(Jn[t])}`:`block-size: ${$(Jn[e])}`};
    padding: var(--salt-spacing-2);
    vertical-align: middle;
    max-inline-size: 100%;
`,IUe=v(O)`
    margin-inline-end: var(--salt-spacing-2);
`,SUe={StyledTag:yUe,TagText:IUe},{StyledAccordionContent:CUe,StyledAccordionTitle:vUe,StyledIcon:TUe}=By,ez=e=>s.jsxs(vUe,{type:"button","aria-expanded":e.active,...e,children:[e.children,s.jsx(TUe,{height:18,width:18,name:"arrow_down",active:e.active})]}),tz=e=>s.jsx(CUe,{hidden:!e.active,...e,children:e.children}),lB=e=>e.type===ez,_Ue=e=>e.type===tz;class rs extends h.Component{constructor(t){super(t);const n=[];let o=-1;h.Children.map(t.children,r=>{lB(r)&&(o+=1,r.props.active&&n.push(o))}),this.state={activeIndexes:n}}static Title=ez;static Content=tz;static StyledAccordionTitle=By.StyledAccordionTitle;static StyledAccordionContent=By.StyledAccordionContent;static StyledIcon=By.StyledIcon;static displayName="Accordion";handleTitleClick(t,n,o){t.preventDefault();const{activeIndexes:r}=this.state,a=r.indexOf(n)!==-1;o&&o(a),a?this.setState({activeIndexes:r.filter(i=>i!==n)}):this.setState({activeIndexes:[...new Set([...r,n])]})}renderChildren(){const{children:t}=this.props,{activeIndexes:n}=this.state,o=i=>n.indexOf(i)!==-1;let r=0,a=0;return h.Children.map(t,i=>{const l=lB(i),c=_Ue(i);if(l){const{active:d,...u}=i.props,p=r,g=y=>this.handleTitleClick(y,p,i.props.onActiveToggle),E=o(r);return r+=1,h.cloneElement(i,{active:E,...u,onClick:g})}if(c){const{active:d,...u}=i.props,p=o(a);return a+=1,h.cloneElement(i,{active:p,...u})}return i})}render(){return s.jsx("div",{"data-test":this.props["data-test"],children:this.renderChildren()})}}YC.displayName="AdvertisingBanner";const IE=e=>{switch(e){case"end":case"right":return"end";case"start":case"left":return"start";default:return e}},sn=v.div`
    padding-block: var(--salt-spacing-4);
    padding-inline: var(--salt-spacing-2);
    text-align: ${({align:e="left"})=>IE(e)};
`,{List:bUe,Item:ev,CurrentBreadcrumbText:xUe,HeadingBreadcrumb:AUe,BreadcrumbLinkComponent:RUe,Chevron:sz}=Ywe,DUe=(e,t,n)=>s.jsxs(ev,{children:[s.jsx(RUe,{as:t,href:e.url,to:e.to,state:e.navigationState,onClick:()=>n?n(e):{},children:e.name}),s.jsx(sz,{height:16,width:16,name:"arrow_right","aria-hidden":"true"})]},e.id??e.name),OUe=(e,t)=>s.jsx(ev,{children:s.jsx(xUe,{...t,children:e.name})},e.id??e.name),PUe=(e,t)=>s.jsxs(ev,{children:[s.jsx(O,{className:"salt-d--inline-block",...t,children:e}),s.jsx(sz,{name:"arrow_right","aria-hidden":"true"})]}),NUe=(e,t,n,o,r)=>e.length===1&&!o?s.jsx(ev,{children:s.jsx(AUe,{...r,children:e[0].name})}):e.map((a,i)=>e.length>i+1?DUe(a,t,n):OUe(a,r)),rm=({preface:e,trail:t,linkElement:n,"data-test":o,className:r,onClick:a,...i})=>s.jsxs(bUe,{"data-test":o,className:r,children:[e&&PUe(e),NUe(t,n,a,e,i)]});rm.displayName="Breadcrumb";const Bn=e=>{const t=h.useRef();return h.useEffect(()=>{t.current=e},[e]),t.current},nz=v.section`
    background-color: var(--intent-contrast-900);
    box-sizing: border-box;
    inset-block-end: 0;
    box-shadow: var(--salt-elevation-shadow-3);
    inset-inline: 0;
    margin: 0;
    padding: 0;
    position: fixed;
    text-align: ${({align:e})=>IE(e)};
    z-index: ${$t["bottom-bar"]};
`,tv=v.div.withConfig({shouldForwardProp:(e,t)=>!["height"].includes(e)&&t(e)})`
    block-size: ${({height:e})=>$(e)};
`,SE=({align:e="left",children:t=null,id:n,light:o=!1,className:r="",fixedBottomSpacing:a=void 0,"data-test":i=""})=>{const l=h.useRef(null),c=150,[d,u]=h.useState(c),p=Bn(d),g=()=>a||document&&l.current&&l.current.offsetHeight||c;return h.useEffect(()=>{const E=g();E&&u(E)},[]),h.useEffect(()=>{const E=g();E&&p!==E&&u(E)},[d,a]),s.jsxs(h.Fragment,{children:[s.jsx(tv,{height:d}),s.jsx(nz,{"data-test":i,ref:l,align:e,id:n,light:o,className:r,children:t})]})};SE.StyledBottomBar=nz;SE.displayName="BottomBar";const{Header:oz,Body:rz,Footer:az,CardWrapper:iz,HeaderText:LUe,Options:kUe}=fE.Action,jUe={children:m.oneOfType([m.string,m.element,m.array]),chip:m.node,innerRef:m.oneOfType([m.shape(),m.func,m.string]),muted:m.bool,xs:m.number,sm:m.number,md:m.number,lg:m.number},MUe={children:null,chip:void 0,innerRef:void 0,muted:void 0,xs:void 0,sm:void 0,md:void 0,lg:void 0},ri=({innerRef:e,chip:t,...n})=>s.jsxs(iz,{ref:e,...n,children:[t,n.children]}),wUe=e=>s.jsxs(iz,{...e,children:[s.jsx(oz,{children:s.jsx(_e,{className:"salt-m-b--2",height:"25px"})}),s.jsxs(rz,{children:[s.jsx(_e,{height:"15px",className:"salt-m-b--1"}),s.jsx(_e,{height:"15px"})]}),s.jsxs(az,{children:[s.jsx(_e.Button,{className:"salt-d--inline-block salt-m-r--2"}),s.jsx(_e.Button,{className:"salt-d--inline-block"})]})]});ri.Skeleton=wUe;ri.defaultProps=MUe;ri.propTypes=jUe;ri.Header=oz;ri.HeaderText=LUe;ri.Body=rz;ri.Footer=az;ri.Options=kUe;ri.displayName="Card";ri.Skeleton.displayName="SkeletonCard";const{CardSection:FUe}=fE.Collection,BUe={children:m.oneOfType([m.string,m.element,m.array]),className:m.string,xs:m.number,sm:m.number,md:m.number,lg:m.number},UUe={children:null,className:"",xs:1,sm:1,md:3,lg:3},sv=e=>s.jsx(FUe,{...e,children:h.Children.toArray(e.children).filter(t=>t).map(t=>h.cloneElement(t,{xs:e.xs,sm:e.sm,md:e.md,lg:e.lg}))});sv.defaultProps=UUe;sv.propTypes=BUe;sv.displayName="CardCollection";const Yr={ALL_ANCHORS:"ALL_ANCHORS",ALL_SPA_LINKS:"ALL_SPA_LINKS",MIXED:"MIXED"},GUe=()=>({type:Yr.ALL_ANCHORS}),cB=(e=[])=>({type:Yr.MIXED,payload:{anchorLinks:e}}),$Ue={type:Yr.ALL_SPA_LINKS},HUe=(e=$Ue,t)=>{switch(t.type){case Yr.ALL_ANCHORS:case Yr.ALL_SPA_LINKS:return{type:t.type};case Yr.MIXED:return{type:t.type,anchorLinks:[...new Set([...e.anchorLinks||[],...t.payload.anchorLinks.map(n=>n.source)])]};default:return e}},nv=({session:e})=>e.linkTypeDetector||{},VUe=new RegExp("^(?:[a-z]+:)?//","i"),WUe=(e,t)=>{if(VUe.test(e)){const o=new URL(e);return o.pathname=`${t}${o.pathname}`,o.toString()}return`${t}${e}`},YUe=e=>{let t;return typeof e=="string"?t=e:(t=e.pathname||"",e.search&&(e.search.charAt(0)==="?"?t+=e.search:t+=`?${e.search}`)),t},qUe=()=>{const t=`(${L().formatMessage("accessibility.link.open.in.new.window")})`;return s.jsx(ie,{children:t})};class KUe{cache;constructor(){this.cache=new Map}get(t){return this.cache.get(t)}set(t,n){this.get(t)||this.cache.set(t,n)}}const dB=new KUe,zUe=e=>{const t=f(nv);return dB.get(e)?!0:t.anchorLinks?.find(o=>!!e.match(o))?(dB.set(e,!0),!0):!1},lz=h.forwardRef((e,t)=>{const{href:n,intent:o,...r}=e,{standalone:a,bold:i,size:l,...c}=r,d=o==="ghost"?c:r;return s.jsx(tt,{href:n,intent:o,ref:t,...d})}),cz=h.forwardRef((e,t)=>{const{href:n,to:o,children:r,onClick:a,onContextMenu:i,intent:l,...c}=e,{standalone:d,bold:u,size:p,...g}=c,E=l==="ghost"?g:c,y=e.state||o.state;return s.jsx(tt,{asChild:!0,onClick:a,onContextMenu:i,intent:l,ref:t,...E,children:s.jsxs(dce,{to:o,state:y,...E,children:[r,c.target==="_blank"&&s.jsx(qUe,{})]})})}),QUe=h.forwardRef((e,t)=>{const{href:n,to:o,...r}=e;return zUe(n)?s.jsx(lz,{href:n,ref:t,...r}):s.jsx(cz,{to:o,ref:t,...r})}),Ye=h.forwardRef((e,t)=>{const{href:n,to:o,...r}=e,a=f(nv),i=o||n||"",l=YUe(i);return a.type===Yr.ALL_ANCHORS?s.jsx(lz,{href:l,ref:t,...r}):a.type===Yr.MIXED?s.jsx(QUe,{href:l,to:i,ref:t,...r}):s.jsx(cz,{to:i,ref:t,...r})});Ye.displayName="WrappedLink";const{Base:XUe,Body:uB,ImageWrapper:pB,StyledImage:mB,TitleWrapper:dz,Content:ZUe,Title:JUe,BasePlaceholder:eGe,ImagePlaceholder:uz,TitlePlaceholder:tGe,ContentPlaceholder:sGe}=fE.MediaNavigation,nGe=v(uz)`
    background-color: var(--intent-secondary-200);
`,oGe=v(dz)`
    padding-inline-end: 0;
`,rGe=v.img`
    object-fit: cover;
    object-position: center;
    inline-size: 100%;
    vertical-align: middle;
`,RO=ae.forwardRef(({variant:e="default",formatting:t="normal",dynamicHeight:n=!1,src:o,breakpointSrcSet:r,fallbackSrc:a,typeSrcSet:i,href:l,target:c,alt:d,title:u,content:p,onClick:g,to:E,navigationState:y,isLoading:I,loading:S="lazy",decoding:C="async",showContentPlaceholder:T,titleDataTest:_,truncateTitle:A,className:R},P)=>{if(I)return s.jsx(eGe,{"data-test":"media-navigation-card-base-placeholder",formatting:t,className:R,children:s.jsxs(uB,{children:[s.jsx(pB,{variant:e,children:s.jsx(uz,{"data-test":"media-navigation-card-image-placeholder"})}),s.jsxs(dz,{children:[s.jsx(tGe,{"data-test":"media-navigation-card-title-placeholder"}),T&&s.jsx(sGe,{"data-test":"media-navigation-card-content-placeholder"})]})]})});const N=()=>n&&r?s.jsxs("picture",{"data-test":"media-navigation-card-picture",children:[Object.entries(r).map(([k,M])=>{const[w,j]=M;return s.jsxs(ae.Fragment,{children:[s.jsx("source",{media:fl[k],srcSet:w,type:"image/avif"},k),s.jsx("source",{media:fl[k],srcSet:j,type:"image/webp"},k)]})}),s.jsx(rGe,{src:a,alt:d,loading:S,decoding:C})]}):i?s.jsxs("picture",{"data-test":"media-navigation-card-picture",children:[Object.entries(i).map(([k,M])=>s.jsx("source",{srcSet:M,type:k})),s.jsx(mB,{src:a,alt:d,loading:S,decoding:C})]}):o?s.jsx(mB,{alt:d,src:o}):s.jsx(nGe,{});return s.jsx(XUe,{ref:P,as:E?Ye:tt,...E?{to:E}:{href:l},formatting:t,target:c,state:y,onClick:g,className:R,children:s.jsxs(uB,{children:[s.jsx(pB,{variant:e,children:N()}),s.jsxs(oGe,{children:[s.jsx(JUe,{"data-test":_,...A&&{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},children:u}),p&&s.jsx(ZUe,{children:p})]})]})})}),{MediaCardSection:DO}=fE.MediaCollection,aGe={formatting:m.oneOf(["normal","small"]),gridVariant:m.oneOf(["auto-fill","auto-fit"])},iGe={formatting:"normal",gridVariant:"auto-fill"};DO.propTypes=aGe;DO.defaultProps=iGe;const Oe={Collection:sv,Action:ri,MediaNavigationCard:RO,MediaCardCollection:DO},{Dot:hB,IndicatorContainer:lGe}=qC,gB="md",Uu=6,cGe=({currentIndex:e,numberOfItems:t})=>{const[n,o]=h.useState(1),r=h.useRef(e);h.useEffect(()=>{const i=Math.min(Uu,t);e===0?o(1):e===t-1?o(i):e-r.current>1||e-r.current===0?e<i-2?o(e+1):o(i-1):e>r.current?n!==i-1&&o(n+1):e<r.current&&n!==2&&o(n-1),r.current=e},[e]);const a=h.useMemo(()=>{const i=[];if(t<=Uu)for(let l=0;l<t;l+=1){const c=l===e;i.push(s.jsx(hB,{size:gB,active:c,"data-test-type":`${gB}${c?"-active":""}`},l))}else{const l=e+1===t,c=e>0&&!l;for(let d=0;d<Uu;d+=1){let u="md";l?(d===0&&(u="xs"),d===1&&(u="sm")):c?(d===0||d===Uu-1)&&(u="sm"):(d===Uu-1&&(u="xs"),d===Uu-2&&(u="sm"));const p=d===n-1;i.push(s.jsx(hB,{active:p,size:u,"data-test-type":`${u}${p?"-active":""}`},d))}}return i},[e,t,n]);return s.jsx(lGe,{"data-test":"carousel-v2-indicator-container",children:a})},{Controls:dGe,ControlsInnerContainer:uGe}=qC,qx=v(x)`
    cursor: pointer;
`,pGe=v(qx)`
    inline-size: ${$(28)};
`,mGe=v(Ts)`
    block-size: ${$(15)};
`,hGe=(e,t)=>e<0?t-1:e>=t?0:e,pz=({isPaused:e,currentIndex:t,numberOfItems:n,handleNextButtonPress:o,handlePauseButtonPress:r,handlePrevButtonPress:a})=>{const{formatMessage:i}=L(),l=e?"pause":"play";return s.jsxs(dGe,{"data-test":"carousel-v2-controls",role:"toolbar",children:[s.jsx(qx,{"data-test":"carousel-v2-controls-left-button",intent:"tertiary",size:"s",fill:!1,onClick:a,"aria-label":i("scroller.accessibility.viewPrevious"),children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsxs(uGe,{children:[s.jsx(pGe,{"data-test":`carousel-v2-controls-${l}-button`,intent:"tertiary",size:"s",fill:!1,onClick:r,"aria-label":i(`scroller.accessibility.${l}`),children:s.jsx(x.Icon,{name:l})}),s.jsx(mGe,{orientation:"vertical"}),s.jsx(cGe,{currentIndex:hGe(t,n),numberOfItems:n})]}),s.jsx(qx,{"data-test":"carousel-v2-controls-right-button",intent:"tertiary",size:"s",fill:!1,onClick:o,"aria-label":i("scroller.accessibility.viewNext"),children:s.jsx(x.Icon,{name:"arrow_right"})})]})},{Body:gGe,ItemsContainer:EGe,Item:fGe}=qC,tb=(e,t,n)=>{if(!h.isValidElement(e))return null;const o={"data-id":t,...n&&{"data-test":`carousel-v2-item-hidden-${t}`},...n&&{tabIndex:-1}};return s.jsx(fGe,{children:h.cloneElement(e,{...o})},t.toString())},yGe=({bodyRef:e,itemsContainerRef:t,currentIndex:n,children:o,onMouseEnter:r,onMouseLeave:a,onBodyKeyDown:i,onBodyFocus:l,onBodyBlur:c})=>s.jsx(gGe,{tabIndex:-1,ref:e,"data-test":`carousel-v2-body-selected-${n}`,onKeyDown:i,onFocus:l,onBlur:c,children:s.jsxs(EGe,{tabIndex:-1,ref:t,applyEqualWidth:!0,"data-test":"carousel-v2-body-container",snapAlignment:"center",onMouseEnter:r,onMouseLeave:a,children:[o.length>1&&tb(o[o.length-1],o.length,!0),o.map((u,p)=>tb(u,p)),o.length>1&&tb(o[0],-1,!0)]})}),mz=({onVisibilityChange:e})=>{const t=()=>document.visibilityState==="visible",n=()=>e(t());h.useEffect(()=>(document.addEventListener("visibilitychange",n,!1),()=>{document.removeEventListener("visibilitychange",n)}),[])},IGe=(e,t=5e3,n=500)=>{const[o,r]=h.useState(t),[a,i]=h.useState(n),[l,c]=h.useState([]);mz({onVisibilityChange:y=>{y?E("focus"):g("focus")}});const d=l.length!==0;h.useEffect(()=>{if(n&&a===0){const y=setTimeout(()=>{r(t)},n);return()=>{clearTimeout(y)}}return()=>{}},[a,t,n]),h.useEffect(()=>{if(e===void 0||d)return;const y=o!==0;e&&y||!e&&!y||(e&&!y&&p(),!e&&y&&u())},[e,d,o]);const u=h.useCallback(()=>{n&&i(n),r(0)},[n]),p=h.useCallback(()=>{n&&i(0),r(a||t)},[n,a,t]),g=y=>{c(I=>[...I,y]),u()},E=y=>{c(I=>{const S=I.filter(C=>C!==y);return S.length===0&&p(),S})};return{autoPlayIntervalMs:o,pauseCarousel:g,resumeCarousel:E}},SGe=(e,t)=>{const n=h.useRef(),o=h.useRef();h.useEffect(()=>{n.current=e},[e]),h.useEffect(()=>(a(t),()=>{r()}),[t]);const r=h.useCallback(()=>{o.current&&(clearInterval(o.current),o.current=void 0)},[]),a=h.useCallback(i=>{r(),t&&(o.current=setInterval(()=>{n.current?.()},i||t))},[t]);return[a,r]},CGe=45,vGe=(e,t)=>{const n=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.atan2(Math.abs(o),Math.abs(n))*180/Math.PI},EB=e=>e<=CGe,TGe=({ref:e,eventHandlers:t})=>{const{onNext:n,onPause:o,onPrev:r,onResetToCurrent:a,onResume:i}=t,[l,c]=h.useState({clientX:0,clientY:0});let d;const u=E=>{if(E.changedTouches.length!==1)return;const{clientX:y,clientY:I}=E.changedTouches[0];c({clientX:y,clientY:I}),o("mouse")},p=h.useCallback(E=>{if(d!==void 0&&EB(d)){const{clientX:y}=l,{clientX:I}=E.changedTouches[0];I>y?r():n()}else a();i("mouse"),d=void 0},[l]),g=E=>{if(d===void 0&&(d=vGe(l,E.changedTouches[0])),EB(d)){E.preventDefault();const y=E.target.closest("li");if(y){const I=l.clientX-E.changedTouches[0].clientX;e.current?.scroll?.({left:y.offsetLeft+I,behavior:"instant"})}}};h.useEffect(()=>(e.current&&(e.current.addEventListener("touchstart",u,{passive:!0}),e.current.addEventListener("touchend",p,{passive:!0}),e.current.addEventListener("touchmove",g)),()=>{e.current?.removeEventListener("touchstart",u),e.current?.removeEventListener("touchend",p),e.current?.removeEventListener("touchmove",g)}),[e.current,p])},_Ge=5,bGe=3,xGe=10,AGe=250,RGe=(e,t,n)=>{const[o,r]=h.useState(new Array(_Ge).fill(0)),a=h.useMemo(()=>Vr(c=>{c<0?t():e()},AGe,{leading:!0,trailing:!1}),[n.current]),i=(c,d)=>!!(c.some(u=>d>u*bGe)||c.every(u=>u===d)&&d>xGe),l=c=>{const d=Math.abs(c.deltaX),u=Math.abs(c.deltaY);d>u&&(c.preventDefault(),c.deltaMode!==WheelEvent.DOM_DELTA_PIXEL?a(c.deltaX):(i(o,d)&&a(c.deltaX),r(p=>[...p.slice(1),d])))};h.useEffect(()=>(n.current&&n.current.addEventListener("wheel",l),()=>{n.current?.removeEventListener("wheel",l)}),[n.current,o])},DGe=(e,t,n)=>{const o=r=>{const a=["ArrowLeft","ArrowRight"],i=r.key,l={ArrowLeft:t,ArrowRight:e};a.includes(i)&&l[i]?.(r)};h.useEffect(()=>(n.current&&n.current.addEventListener("keydown",o),()=>{n.current?.removeEventListener("keydown",o)}),[n.current])},OGe=(e,t,n)=>{const[o,r]=h.useState(!1),a=(c,d="smooth")=>{if(!e.current||!t)return;const u=t[c+1];!u||typeof u?.offsetLeft!="number"||e.current.scroll?.({left:u.offsetLeft,behavior:o?"instant":d})};h.useEffect(()=>{if(window){const{matches:c}=window.matchMedia("(prefers-reduced-motion)");r(c)}},[]),TGe({ref:e,eventHandlers:n});const{onNext:i,onPrev:l}=n;return RGe(i,l,e),DGe(i,l,e),{scrollToCarouselItem:a}},PGe=2,NGe=({bodyRef:e,listChildren:t,length:n,moveToItem:o})=>{const r=()=>{if(!(t&&e.current))return;const a=Math.abs(e.current.scrollLeft-t[t.length-1].offsetLeft)<PGe;e.current.scrollLeft===0?o(n-1):a&&o(0)};h.useEffect(()=>(e.current?.addEventListener("scroll",r,{passive:!0}),()=>{e.current?.removeEventListener("scroll",r)}),[e,t,n,o])},LGe=(e,t,n,o)=>{const r=h.useRef(null);h.useEffect(()=>{if(!e?.current)return;const a=()=>{o(n,"instant")},i=new ResizeObserver(l=>{const d=l[0]?.contentRect.width??0;d!==0&&(!r.current||r.current?.width!==d)&&(r.current={width:d},a())});return i.observe(e.current),()=>i.disconnect()},[e?.current,t,n])},{Container:kGe}=qC,jGe=750,MGe=e=>[...e].every(t=>t instanceof HTMLElement),wGe=({isVisible:e,startFromIndex:t=0,activeItemIndex:n,loopIntervalMs:o,playDelayMs:r,areControlsHidden:a,children:i,fwBodyRef:l,onCurrentIndexChange:c,...d},u)=>{const p=h.useRef(null),g=l||p,E=h.useMemo(()=>i?.length||0,[i]),y=E>1,[I,S]=h.useState(!1),[C,T]=h.useState(t),[_,A]=h.useState(),{autoPlayIntervalMs:R,pauseCarousel:P,resumeCarousel:N}=IGe(e,o,r),[k]=SGe(()=>{G()},y?R:0),M=h.useCallback(he=>{he&&A(MGe(he.children)?he.children:void 0)},[]),w=he=>_?.[he+1]?.querySelector("a")?.focus();h.useEffect(()=>{c(C);let he;return I&&(he=setTimeout(()=>w(C),jGe)),()=>{he&&clearTimeout(he)}},[C,I]);const j=h.useCallback(he=>{R&&k();const Ie=he??C;K(Ie,"auto"),T(Ie)},[_,R]);NGe({bodyRef:g,listChildren:_,length:E,moveToItem:j}),h.useEffect(()=>{n!==void 0&&j(n)},[n]);const G=he=>{he?.preventDefault(),R&&k(),S(!!he),T(Ie=>{const Fe=Ie+1;return K(Fe),Fe})},W=he=>{he?.preventDefault(),R&&k(),S(!!he),T(Ie=>{const Fe=Ie-1;return K(Fe),Fe})},H=he=>{const Ie=C+(he.shiftKey?-1:1);Ie<E&&Ie>-1&&(he.preventDefault(),R&&k(),S(!1),T(Ie),w(Ie))},{scrollToCarouselItem:K}=OGe(g,_,{onNext:G,onResetToCurrent:()=>K(C),onResume:N,onPause:P,onPrev:W});LGe(g,_,C,K);const X=()=>{R?P("button"):N("button")},q=h.useCallback(()=>P("mouse"),[]),ne=h.useCallback(()=>N("mouse"),[]),ue=h.useCallback(he=>{const Ie=he.relatedTarget;g.current&&!g.current.contains(Ie)&&(P("focus"),w(C))},[C]),oe=h.useCallback(he=>{const Ie=he.relatedTarget;g.current&&!g.current.contains(Ie)&&N("focus")},[]),ye=he=>{he.key==="Tab"&&H(he)};return h.useEffect(()=>{R&&k(),K(t,"auto"),T(t)},[t,_]),h.useEffect(()=>{const he=C===0,Ie=C===E-1;(he||Ie)&&K(C)},[C]),s.jsxs(kGe,{ref:u,...d,children:[y&&!a&&s.jsx(pz,{isPaused:!!R,currentIndex:C,numberOfItems:E,handlePrevButtonPress:()=>W(),handleNextButtonPress:()=>G(),handlePauseButtonPress:X}),s.jsx(yGe,{bodyRef:g,itemsContainerRef:M,currentIndex:C,onMouseEnter:q,onMouseLeave:ne,onBodyKeyDown:ye,onBodyFocus:ue,onBodyBlur:oe,children:i})]})},FGe=h.forwardRef(wGe),BGe={expanded:!1,onToggle:()=>{},aria:void 0,name:void 0},ov=ae.createContext(BGe),rv=()=>h.useContext(ov),UGe=v.button`
    padding-block: 0;
    padding-inline: 0;
    background: transparent;
    border: none;
    color: currentcolor;
    inline-size: 100%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-align: start;
`,GGe=({children:e})=>{const{expanded:t,onToggle:n,aria:o,name:r}=rv();return s.jsx(UGe,{type:"button",onClick:n,"aria-label":t?o?.expandedLabel:o?.collapsedLabel,"aria-expanded":t,"data-test":`${r||"collapsible-box"}-control-section-${t?"expanded":"collapsed"}`,children:e})},hz="all 300ms ease-in-out;",gz="ADD_MISSED_PROMOTIONS",$Ge=e=>({type:gz,payload:e}),fo={addMissedPromotions:$Ge,types:{ADD_MISSED_PROMOTIONS:gz}},HGe=D("cat.evt"),VGe=D("seo.cf"),OO=D("di"),Ez=({uri:e,category:t,filters:n,sortOption:o,offset:r,pageToken:a,isRetailerCategoryId:i,additionalParams:l})=>(c,d)=>c(yt.getCataloguePage(e,t,n,o,r,a,i,l)).then(u=>{if(!u)return;const{payload:{responseData:p}}=u,{entities:g,categoryEvent:E,richTextContent:y,result:{productGroups:I,missedPromotions:S,breadcrumbs:C,retailerCategoryId:T}}=p,_=d();return c(xt.setProducts(g)),YGe(c,{uri:e,category:t,filters:n,sortOption:o,pageToken:a,isRetailerCategoryId:i,additionalParams:l},p),S?.length&&c(fo.addMissedPromotions(S)),HGe(_)&&(c(fr.resetCategoryEvent()),E&&c(fr.setCategoryEvent(E))),VGe(_)&&(c(fr.resetCategoryRichTextContentEvent()),y&&c(fr.setCategoryRichTextContent(y))),{products:Kp()(p),productGroups:I,breadcrumbs:C,retailerCategoryId:T}}),WGe=({uri:e,category:t,filters:n={},sortOption:o=void 0,pageToken:r,additionalParams:a={},isRetailerCategoryId:i})=>l=>l(yt.getNextCataloguePage(e,t,n,o,r,a,i)).then(c=>{if(!c)return;const{payload:{responseData:d}}=c,{entities:u,result:{productGroups:p,missedPromotions:g,nextPageToken:E}}=d;return l(xt.setProducts(u)),g?.length&&l(fo.addMissedPromotions(g)),{products:Kp()(d),nextPageToken:E,productCount:qp(p).length}}),YGe=(e,t,n)=>{const{uri:o,category:r,filters:a,sortOption:i,pageToken:l,isRetailerCategoryId:c,additionalParams:d}=t,{entities:u,result:{productGroups:p}}=n,g=p?.find(y=>y.type==="featured_cross_sell")?.products;if(g?.find(y=>!u.product[y])){const I=p.reduce((S,{products:C})=>[...S,...C],[]).findIndex(S=>S===g[0]);e(yt.getCataloguePage(o,r,a,i,I,l,c,d,!0)).then(({payload:{responseData:S}})=>{e(xt.setProducts(S.entities))})}},qGe=(e,t,n)=>{const o=e.map(a=>a.id);if(n)return o;const r=ts(t);return o.filter(a=>!r[a])},KGe=(e={},t={})=>Object.entries(e).reduce((n,[o,r])=>{const a=t[o];return a&&!a.featuredProductCampaign?{...n,[o]:{...a,featuredProductCampaign:{...r}}}:n},{}),fB=(e={},t={},n=[])=>{const o={};if(n.forEach(a=>{o[a.productId]=a}),!Object.keys(t).length)return o;const r=KGe(t,{...e,...o});return{...o,...r}},zGe=(e,t,n)=>{const o=Hn(t);return e(xt.decorateProductsPPWSAction(n)).then(r=>{const{payload:{responseData:a}}=r,i={};return a.products.forEach(l=>{i[l.productId]=si(l,o??[],OO(t))}),a.missedPromotions?.length&&e(fo.addMissedPromotions(a.missedPromotions)),e(xt.setProducts({product:i}))})},ai=({products:e,ignoreProductCache:t=!1,featuredProductsData:n={},updateProducts:o=!1})=>(r,a)=>{const i=a(),l=qGe(e,i,t);if(l.filter(d=>!!d).length===0){if(!Object.keys(n).length)return Promise.resolve();const d=fB(ts(i),n);return Object.keys(d).length&&r(xt.setProducts({product:d})),Promise.resolve()}return r(xt.decorateProductsPPWSAction(l)).then(d=>{const{payload:{responseData:u}}=d,p=u.products.map(E=>si(E,Hn(i)??[],OO(i))),g=fB(ts(i),n,p);return u.missedPromotions?.length&&r(fo.addMissedPromotions(u.missedPromotions)),r(o?xt.updateProducts({product:g?Object.values(g):[],upsert:!0}):xt.setProducts({product:g}))})},av=({productIds:e,ignoreProductCache:t=!1})=>(n,o)=>{const r=o(),a=ts(r),i=t?e:e.filter(l=>!a[l]);return i.filter(l=>!!l).length===0?Promise.resolve():n(xt.decorateProductsPPWSAction(i)).then(l=>{const{payload:{responseData:c}}=l,d={};return c.products.forEach(u=>{d[u.productId]=si(u,Hn(r)??[],OO(r))}),c.missedPromotions?.length&&n(fo.addMissedPromotions(c.missedPromotions)),n(xt.setProducts({product:d}))})},iv=e=>(t,n)=>{const o=n();return zGe(t,o,e)},PO=se("GET_BASKET_PRODUCTS"),fz="SET_BASKET_FETCHING_DONE",QGe=()=>({type:"API",payload:{url:"/v5/products/basket",...PO}}),XGe=({limit:e,transformerConfig:t})=>({type:"API",payload:{url:`/v5/product-pages/basket?limit=${e}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...PO},transformerConfig:t}),ZGe=()=>({type:fz}),od={getBasketProducts:QGe,getPPWSBasketProducts:XGe,setFetchingDone:ZGe,types:{GET_BASKET_PRODUCTS:PO,SET_BASKET_FETCHING_DONE:fz}},yB=D("pdct.ppws"),IB=D("seo.rdbl"),SB=D("di"),Oc=()=>(e,t)=>{const n=t(),o=bde(n),r={imageFormats:Hn(n)??[],isSEOReadableURLEnabled:IB(n),isDynamicImagesEnabled:SB(n)},a={limit:o,transformerConfig:r},i=yB(n)?od.getPPWSBasketProducts:od.getBasketProducts;return e(i(a)).then(l=>{if(l){let{payload:{responseData:c}}=l;yB(n)&&(c=yp(c,Hn(n)??[],IB(n),SB(n)));const{entities:d,result:u}=c;for(const g in d.product)d.product[g]===void 0&&delete d.product[g];e(xt.updateProducts({product:d.product?Object.values(d.product):[],upsert:!0}));const{missedPromotions:p}=u||{};p?.length&&e(fo.addMissedPromotions(p))}}).then(()=>{e(od.setFetchingDone())})},JGe=e=>({event:"page_view",session_id:e.sessionId,page_view_id:e.pageViewId,page_type:e.pagePartType||e.pageType,customer_id:e.customerId,osp_transaction_id:e.ospTransactionId,transaction_type:e.isBasketUnderEdit?"edit":"new",region_id:e.regionId,banner_id:e.bannerId,region_name:e.regionName,banner_name:e.bannerName,cart_value:e.basketTotalAmount?Number(e.basketTotalAmount):null,customer_email:e.customerData?.data?.email,customer_first_name:e.customerData?.data?.["attr.firstName"],customer_last_name:e.customerData?.data?.["attr.surname"],is_logged_in:!!e.isLoggedIn}),e0e=e=>({event:"pageview",page:e.page,pageViewId:e.pageViewId,pageType:e.pagePartType||e.pageType,sessionId:e.sessionId,loggedInStatus:e.isLoggedIn,retailerCustomerId:e.customerId,customerEmail:e.customerData?.data?.email,customerFirstname:e.customerData?.data?.["attr.firstName"],customerLastname:e.customerData?.data?.["attr.surname"],transactionId:e.ospTransactionId,source:e.source,basketTotalAmount:e.basketTotalAmount}),t0e=e=>!e.isSendingSegmentsToDatalayerEnabled||!e.isLoggedIn?null:{event:"active_segments",...(e.customerSegments||[]).reduce((n,o)=>({...n,[o.name]:o.shortCodes}),{})},rd=(e,t={})=>{const n=_c(e),o=Nn(e),r=Vp(window.location,e),a=ei(e),i=Ct(e),l=Ar(e),c=sa(e),d=yC(e),u=xR(e),p=Zd(e),g=Ra(e)?.amount,E=Ol(e),y=Xe(e),I=D("seg.dl")(e),S=tO(e)?.customerSegments,{pagePartType:C,source:T,page:_}=t,A=()=>{const k=JGe({sessionId:n,pageViewId:o,pageType:r,pagePartType:C,customerId:a,ospTransactionId:i,isBasketUnderEdit:l,regionId:c,bannerId:d,regionName:u,bannerName:p,basketTotalAmount:g,customerData:E,isLoggedIn:y});te.sendEvent({GA:k,WA:null})},R=()=>{const k=e0e({page:_,pageViewId:o,pagePartType:C,pageType:r,sessionId:n,isLoggedIn:y,customerId:a,customerData:E,ospTransactionId:i,source:T,basketTotalAmount:g});te.sendEvent({GA:k,WA:null})},P=()=>{const k=t0e({isSendingSegmentsToDatalayerEnabled:I,isLoggedIn:y,customerSegments:S});te.sendEvent({GA:k,WA:null})};return{sendGA4Event:A,sendUAEvent:R,sendActiveSegmentsEvent:P,sendPageViewEvent:()=>{A(),R(),P()}}},NO=()=>{const e=Yd();return{sendUAPageViewEvent:a=>{rd(e.getState(),a).sendUAEvent()},sendGA4PageViewEvent:()=>{rd(e.getState()).sendGA4Event()},sendActiveSegmentsEvent:()=>{rd(e.getState()).sendActiveSegmentsEvent()},sendPageViewEvent:a=>{rd(e.getState(),a).sendPageViewEvent()}}},dl={INITIAL:"INITIAL",LOADING:"LOADING",LOADED:"LOADED"},s0e="EXPANDED_TROLLEY",pg="expandedTrolley",n0e={loadingState:dl.INITIAL,setLoadingState:()=>{}},o0e=7,yz=ae.createContext(n0e),LO=()=>h.useContext(yz),CE=()=>f(xc),kO=(e,t)=>{const[n,o]=h.useState(e);return h.useEffect(()=>{const r=setTimeout(()=>o(e),t);return()=>{clearTimeout(r)}},[e,t]),n},r0e=()=>{const[e,t]=h.useState([]),n=f(ts),{loadingState:o,setLoadingState:r}=LO();return h.useEffect(()=>{if(!e.length)return;o!==dl.LOADING&&r(dl.LOADING);const a=e.filter(i=>!n[i]);Oi(e,a)||(!a.length&&o!==dl.LOADED&&r(dl.LOADED),t(a))},[e,o,n,r]),{loadingIds:e,setLoadingIds:t}},a0e=()=>{const t=F(),{loadingIds:n,setLoadingIds:o}=r0e(),r=h.useCallback(a=>{const i=a.slice(0,25);t(ai({products:i.map(c=>({id:c})),updateProducts:!0})),o([...n,...i]);const l=a.slice(25);l.length&&setTimeout(()=>r(l),250)},[t,n,o]);return r},jO=()=>{const e=f(ts),t=CE(),n=a0e(),[o,r]=h.useState([]),a=h.useCallback(l=>{const c=t.findIndex(({productId:u})=>u===l);if(c===-1)return;const d=t.slice(0,c+2).filter(({productId:u})=>!e[u]&&!o.includes(u)).map(({productId:u})=>u);r([...new Set([...o,...d])])},[t,o,e]),i=kO(o,250);return h.useEffect(()=>{i.length!==0&&(n(i),r(o.filter(l=>!i.includes(l))))},[i]),a},MO=()=>{const e=F(),t=Ne(),{sendUAPageViewEvent:n}=NO();return h.useCallback(o=>{e(My(t,o)),n({page:t.pathname,pagePartType:o})},[e,t])},i0e=()=>{const e=F(),t=f($e(pg)),n=MO();return h.useCallback(()=>{t||(e(J.openModal(pg)),n(s0e))},[e,t,n])},Iz=(e=!0)=>{const t=F(),{setLoadingState:n}=LO(),o=f($e(pg)),r=MO();return h.useCallback(()=>{o&&(t(J.closeModal()),e&&r(),n(dl.INITIAL))},[o,t,e,n,r])},l0e=e=>{const t=Ne(),n=Bn(t);h.useEffect(()=>{!t||Oi(n,t)||e()},[n,t,e]),h.useEffect(()=>(window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}))},c0e=()=>{const e=jO(),t=CE(),n=f(r=>Ze(r,"seller-sales-enabled")==="true"),o=f(_C);h.useEffect(()=>{(n?o?.reduce((a,i)=>[...a,...i?.items?.map(l=>l)||[]],[]):t?.map(({productId:a})=>a))?.slice(0,o0e)?.forEach(a=>e(a))},[])},d0e=()=>{const e=F(),t=f($e(pg)),n=Bn(t),o=h.useRef(!1);h.useEffect(()=>{!o.current&&n!==void 0&&n!==t&&t&&(o.current=!0,e(Oc()))},[n,t,e])},u0e=e=>{const t=h.useRef(null);return h.useLayoutEffect(()=>{const n=t?.current;if(!n)return()=>{};const o=new ResizeObserver(([r])=>{e(n,r)});return o.observe(n),()=>{o.disconnect()}},[e,t]),t},Sz=()=>{const[e,t]=h.useState(void 0),n=kO(e,250),o=h.useCallback(a=>{const i=a?.clientHeight;i&&t(`${i}px`)},[]);return[u0e(o),n]},wO=v.div`
    ${({isExpanded:e,overflow:t})=>e&&t?`overflow: ${t};`:`
        overflow-x: hidden;
        overflow-y: auto;
    `}
`,Cz=v(wO)`
    transition: ${hz};
    ${({isExpanded:e,maxHeight:t,isScrollHidden:n})=>e?`
        opacity: 1;
        visibility: visible;
        ${n?"overflow: hidden;":""}
        ${t?`max-block-size: ${t};`:""}
    `:`
        opacity: 0;
        ${n?"visibility: visible;":"visibility: hidden;"}
        ${n?"overflow: hidden;":""}
        max-block-size: 0px;
    `}
`,p0e=({children:e,maxHeight:t,overflow:n,isScrollHidden:o})=>{const{expanded:r,name:a}=rv(),[i,l]=Sz();return s.jsx(Cz,{isExpanded:r,"aria-hidden":!r,maxHeight:t||l,overflow:n,isScrollHidden:o,"data-test":`${a||"collapsible-box"}-content-expanded`,children:s.jsx(wO,{ref:i,isExpanded:r,overflow:n,children:e})})},m0e=v(pe)`
    transform: ${({down:e})=>e?"rotate(0deg)":"rotate(180deg)"};
    fill: currentcolor;
    transition: ${hz};
`,h0e=v.span`
    display: flex;
    align-items: center;
    margin-inline-start: var(--salt-spacing-2);
`,g0e=()=>{const{expanded:e,name:t}=rv();return s.jsx(h0e,{"data-test":`${t||"collapsible-box"}-toggle-switch`,children:s.jsx(m0e,{down:!e,name:"arrow_down",height:18,width:18})})},E0e=({children:e,maxHeight:t})=>{const{expanded:n,name:o}=rv(),[r,a]=Sz();return s.jsx(Cz,{isExpanded:!n,"aria-hidden":n,maxHeight:t||a,"data-test":`${o||"collapsible-box"}-content-collapsed`,children:s.jsx(wO,{ref:r,children:e})})},Je=({expanded:e=!1,children:t,onToggle:n=()=>{},aria:o,name:r})=>s.jsx(ov.Provider,{value:{expanded:e,onToggle:n,aria:o,name:r},children:s.jsx(xe,{children:t})});Je.ControlSection=GGe;Je.ToggleSwitch=g0e;Je.ContentExpanded=p0e;Je.ContentCollapsed=E0e;Je.displayName="CollapsibleBox";const kn=h.createContext({currentBreakpoint:void 0}),vz=({children:e})=>{const[t,n]=h.useState(void 0);return h.useEffect(()=>{const o=Object.keys(fl).map(i=>({breakpoint:i,result:window.matchMedia(fl[i])})),r={xs:()=>{},sm:()=>{},md:()=>{},lg:()=>{}};o.forEach(({breakpoint:i,result:l})=>{r[i]=c=>{c.matches&&n(i)};try{l.addEventListener("change",r[i])}catch{l.addListener(r[i])}});const a=o.find(({result:i})=>i.matches);return a&&n(a.breakpoint),()=>{o.forEach(({breakpoint:i,result:l})=>{try{l.removeEventListener("change",r[i])}catch{l.removeListener(r[i])}})}},[]),s.jsx(kn.Provider,{value:{currentBreakpoint:t},children:e})};vz.displayName="BreakpointsProvider";const mg=({currentBreakpoint:e,breakpoint:t})=>{if(!e||!t||!(e in Ke)||!(t in br))return!1;const n=Ke[e],o=Ke[br[t].breakpointKey];return n<o},f0e={breakpoint:m.oneOf(["sm-up","md-up","lg-up"]),children:m.oneOfType([m.arrayOf(m.node),m.node]).isRequired,display:m.string,remainInDom:m.bool},y0e={breakpoint:null,display:"block",remainInDom:!0},I0e=v.div.withConfig({shouldForwardProp:(e,t)=>!["display"].includes(e)&&t(e)})`
    display: ${({display:e})=>e};

    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
        display: none;
    `}
`,Lt=({children:e,breakpoint:t,display:n,remainInDom:o})=>{const{currentBreakpoint:r}=h.useContext(kn);return o?s.jsx(I0e,{breakpoint:t,display:n,children:e}):mg({currentBreakpoint:r,breakpoint:t})?e:null};Lt.defaultProps=y0e;Lt.propTypes=f0e;const S0e={children:m.node.isRequired,renderTo:m.string.isRequired},vE=({children:e,renderTo:t})=>qde(s.jsx(h.Fragment,{children:e}),t);vE.propTypes=S0e;const FO="transition: all 0.3s ease-in-out;",Tz=16,C0e=28,v0e=Jn.md,T0e=2,_0e=2*Tz+T0e,_z=_0e+v0e+C0e+Tz,bz=ae.createContext(),lv=()=>h.useContext(bz),b0e={children:m.element},x0e={children:null},A0e=v.div`
    inset: 0;
    position: fixed;
    background-color: rgb(0 0 0 / 75%);
    opacity: 0.7;
    ${FO}
    ${({expanded:e})=>!e&&`
        opacity: 0;
        visibility: hidden;
    `}
    z-index: ${$t.overlay};

    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
            display: none;
    `}
`,R0e=v.div`
    ${({sticky:e})=>e?`
        position: fixed;
        inset-block-end: 0;
    `:`
        position: static;
        inset-block-end: auto;
    `};
    inset-inline: 0;
    z-index: ${$t["collapsible-box"]};
    ${({sticky:e,breakpoint:t})=>e?re[br[t].mediaQueryKey]`
            position: static;
            inset-block-end: auto;
    `:""}
`,D0e=Pe`
    ${re.sm`
        border-end-end-radius: 0;
        border-end-start-radius: 0;
        box-shadow: var(--salt-elevation-shadow-3);
    `}
    ${re.md`
        border-end-end-radius: 0;
        border-end-start-radius: 0;
        box-shadow: var(--salt-elevation-shadow-3);
    `}
`,O0e=v(xe)`
    ${({breakpoint:e})=>e==="lg-up"&&D0e}

    ${re.xs`
        border-end-end-radius: 0;
        border-end-start-radius: 0;
        box-shadow: var(--salt-elevation-shadow-3);
    `}
`,BO=({children:e})=>{const{breakpoint:t,expanded:n,onToggle:o,stickyBarEnabled:r,name:a}=lv();return s.jsxs(h.Fragment,{children:[r&&s.jsx(A0e,{expanded:n,onClick:o,breakpoint:t}),s.jsx(R0e,{sticky:r,breakpoint:t,id:a?`${a}-summary-box`:"summary-box","data-test":`${a||"styled-summary"}-box`,children:s.jsx(O0e,{breakpoint:t,children:e})})]})};BO.propTypes=b0e;BO.defaultProps=x0e;const P0e={children:m.node},N0e={children:null},L0e=v.button`
    padding-inline: 0;
    padding-block: 0;
    background: transparent;
    border: none;
    color: currentcolor;
    inline-size: 100%;
    cursor: pointer;
`,k0e=v.span`
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-align: start;
`,UO=({children:e})=>{const{breakpoint:t,expanded:n,onToggle:o,name:r,aria:a}=lv(),{formatMessage:i}=L(),l=i("order.details.summary.title"),c=i("summary.total"),d=()=>a?.contentLabel&&a?.totalPrice?`${a?.contentLabel} - ${c} ${a?.totalPrice}`:a?.contentLabel?a?.contentLabel:a?.totalPrice?`${l} - ${c} ${a?.totalPrice}`:l;return s.jsx(L0e,{visible:!0,breakpoint:t,onClick:o,"aria-expanded":n,tabIndex:"0",type:"button","data-test":`${r||"summary"}-control-section-${n?"expanded":"collapsed"}`,"aria-label":d(),children:s.jsx(k0e,{children:e})})};UO.propTypes=P0e;UO.defaultProps=N0e;const j0e={down:m.bool.isRequired},M0e=v(pe)`
    ${FO}
    ${({down:e})=>!e&&"transform: rotate(180deg);"}
`,xz=({down:e})=>s.jsx(M0e,{down:e,name:"arrow_down",height:18,width:18,fill:!0});xz.propTypes=j0e;const w0e={children:m.node},F0e={children:null},B0e=v.span`
    display: flex;
    align-items: center;
    margin-inline-start: var(--salt-spacing-2);

    &::before {
        content: '';
        position: absolute;
        inset-block-start: 0;
        inset-inline-end: 0;
        block-size: ${$(45)};
        inline-size: 50%;
    }
    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
            &:before {
                content: none;
            }
    `}
    ${({expanded:e,concealedWhenActive:t})=>e&&t&&"display: none;"}
`,GO=({children:e})=>{const{expanded:t,concealable:n,hiddenByParent:o,breakpoint:r,name:a,reverseToggleBreakpoint:i}=lv(),{currentBreakpoint:l}=h.useContext(kn),c=r&&mg({currentBreakpoint:l,breakpoint:r}),d=i&&!mg({currentBreakpoint:l,breakpoint:i});let u=c?t:!t;return d&&(u=!u),s.jsxs(B0e,{"data-test":`${a||"collapsible-box"}-toggle-switch${(n&&t||o)&&"-concealed"||""}`,active:t,concealedWhenActive:n,breakpoint:r,children:[e&&s.jsx(Je.StyledToggleSwitchText,{"data-test":`${a||"collapsible-box"}-toggle-switch-text`,children:s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("strong",{children:e})})}),s.jsx(xz,{down:u})]})};GO.propTypes=w0e;GO.defaultProps=F0e;const U0e={children:m.node},G0e={children:null},$0e=$(64),H0e=$(28),V0e=v.div`
    max-block-size: 0;
    opacity: 0;
    overflow: hidden auto;
    visibility: hidden;
    ${FO}
    ${({expanded:e,maxHeight:t})=>e&&`
        max-block-size: ${t||`calc(100vh - (${$0e} + (2 * var(--salt-spacing-4)) + ${H0e} + var(--salt-spacing-2)))`};
        opacity: 1;
        visibility: visible;
        padding-block-start: var(--salt-spacing-2);
        &:last-of-type {
            margin-block-end: 0;
        }
    `}
    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
            max-block-size: ${({expanded:t})=>t&&"100vh"};
    `}
`,$O=({children:e})=>{const{expanded:t,contentMaxHeight:n,breakpoint:o,name:r,aria:a}=lv();return s.jsx(V0e,{expanded:t,"aria-hidden":!t,tabIndex:0,maxHeight:Number(n),"data-test":`${r||"collapsible-box"}-content`,breakpoint:o,name:r,children:s.jsxs(s.Fragment,{children:[a?.contentLabel&&s.jsx(ie,{children:a.contentLabel}),e]})})};$O.propTypes=U0e;$O.defaultProps=G0e;const W0e={expanded:m.bool,onToggle:m.func,children:m.node,breakpoint:m.oneOf(["xs-up","sm-up","md-up","lg-up"]),stickyBarEnabled:m.bool,overlay:m.bool,sticky:m.bool,name:m.string,aria:m.shape({contentLabel:m.string,totalPrice:m.string})},Y0e={children:null,breakpoint:"sm-up",stickyBarEnabled:!0,overlay:void 0,sticky:!0,name:void 0,aria:void 0,expanded:!1,onToggle:()=>{}},cs=({children:e,...t})=>{const{sticky:n,breakpoint:o}=t,[r,a]=h.useState(!1);return h.useEffect(()=>{a(!0)},[]),s.jsxs(bz.Provider,{value:t,children:[s.jsx(BO,{children:e}),n&&r&&s.jsx(vE,{renderTo:"#StickyCollapsibleSummary",children:s.jsx(Lt,{breakpoint:o,remainInDom:!1,children:s.jsx(tv,{height:_z})})})]})};cs.propTypes=W0e;cs.defaultProps=Y0e;cs.ControlSection=UO;cs.ToggleSwitch=GO;cs.Content=$O;const{Container:ey,CountInput:CB,CountInputContainer:vB,Operator:TB,OperatorLeft:_B,OperatorRight:sb}=zi;let q0e=class extends h.Component{static displayName="Counter";static Container=ey;static CountInput=CB;static CountInputContainer=vB;static Operator=TB;static OperatorLeft=_B;static OperatorRight=sb;static defaultProps={interval:1,max:99,min:1,size:"md",count:1,plusDisabled:!1,minusDisabled:!1,action:void 0,addInfo:!1,addIcon:void 0};inputRef;constructor(t){super(t),this.onCountBlur=this.onCountBlur.bind(this),this.onCountKeyDown=this.onCountKeyDown.bind(this),this.onCountClick=this.onCountClick.bind(this),this.onOperatorMouseDown=this.onOperatorMouseDown.bind(this),this.onOperatorClick=this.onOperatorClick.bind(this),this.handleQuantityUpdate=this.handleQuantityUpdate.bind(this),this.inputRef=h.createRef(),this.state={preventOperatorClick:!1}}componentDidUpdate(t){t.count!==this.props.count&&this.inputRef&&this.inputRef.current&&(this.inputRef.current.value=String(this.props.count))}handleQuantityUpdate(t){const{count:n=1,min:o=1,max:r=99,onQuantityUpdate:a}=this.props;if(t===""){this.inputRef.current&&(this.inputRef.current.value=String(n));return}let i=parseInt(t,10);isNaN(i)&&(i=n),i<o?i=o:i>r&&(i=r);const l=document.activeElement===this.inputRef.current;if(i===n&&!l){this.inputRef.current&&(this.inputRef.current.value=String(n));return}a(i)}onCountClick(){this.inputRef.current?.select()}onCountKeyDown(t){t.key==="Enter"&&this.inputRef.current?.blur(),t.key==="Tab"&&this.inputRef.current&&this.handleQuantityUpdate(this.inputRef.current.value)}onCountBlur(t){this.handleQuantityUpdate(t.target.value)}onOperatorMouseDown(){document.activeElement===this.inputRef.current&&this.setState({preventOperatorClick:!0})}onOperatorClick(t){if(this.state.preventOperatorClick){this.setState({preventOperatorClick:!1});return}const{count:n=1,min:o=1,max:r=99,interval:a=1,onQuantityUpdate:i}=this.props,c=n+(t??a);c>=o&&c<=r&&i(c)}render(){const{interval:t,max:n,min:o,onQuantityUpdate:r,count:a,plusDisabled:i,minusDisabled:l,addText:c,addTextAlternative:d,increaseQuantityTextAlternative:u,decreaseQuantityTextAlternative:p,editQuantityTextAlternative:g,quantityDescriptionTextAlternative:E,action:y,addInfo:I,addIcon:S,...C}=this.props;return a===0&&I?s.jsx(ey,{...C,children:s.jsxs(x,{onClick:y,intent:"secondary",fill:!0,"data-test":"counter-button","aria-label":d,children:[s.jsx(x.Icon,{name:S}),s.jsx(x.Text,{children:c})]})}):a===0?s.jsx(ey,{...C,children:s.jsx(TB,{type:"button",fullWidth:!0,appearance:"action",onClick:()=>this.onOperatorClick(t),disabled:i,"data-synthetics":"add-button","data-test":"counter-button","aria-label":d,className:C.className,children:c})}):s.jsxs(ey,{...C,children:[s.jsx(ie,{children:E}),s.jsx(_B,{type:"button",appearance:"action",disabled:l,onClick:()=>this.onOperatorClick(-(t??1)),onMouseDown:this.onOperatorMouseDown,...C,"data-test":"counter:decrement","aria-label":p,children:s.jsx(pe,{name:"minus",height:18})}),s.jsx(vB,{children:s.jsx(CB,{defaultValue:a,type:"number",min:o,max:n,onBlur:this.onCountBlur,onKeyDown:this.onCountKeyDown,onClick:this.onCountClick,ref:this.inputRef,"aria-label":g,"data-test":"quantity-in-basket","data-synthetics":"quantity-in-basket"})}),I?s.jsx(sb,{type:"button",appearance:"action",onClick:y,"data-test":"counter:increment","data-synthetics":"add-button","aria-label":u,children:s.jsx(pe,{name:S,height:18})}):s.jsx(sb,{type:"button",appearance:"action",disabled:i,onClick:()=>this.onOperatorClick(t),onMouseDown:this.onOperatorMouseDown,...C,"data-test":"counter:increment","data-synthetics":"add-button","aria-label":u,children:s.jsx(pe,{name:"plus",height:18})})]})}};const HO=v(q0e)``;HO.displayName="Counter";const Az={padding:m.oneOf(["xs","sm","md","lg","xl",null]),hyphenate:m.bool},Rz={padding:"sm",hyphenate:!1},{DescriptionListTitle:VO,DescriptionListDescription:WO}=fe,K0e=v.div``,z0e=()=>s.jsxs("div",{children:[s.jsxs("div",{className:"salt-m-b--2 salt-d--flex",children:[s.jsx(_e,{height:"15px",width:"25%"}),s.jsx(_e,{height:"15px",className:"salt-m-l--4"})]}),s.jsxs("div",{className:"salt-m-b--2 salt-d--flex",children:[s.jsx(_e,{height:"15px",width:"25%"}),s.jsx(_e,{height:"15px",className:"salt-m-l--4"})]}),s.jsxs("div",{className:"salt-d--flex",children:[s.jsx(_e,{height:"15px",width:"25%"}),s.jsx(_e,{height:"15px",className:"salt-m-l--4"})]})]});VO.propTypes=Az;VO.defaultProps=Rz;WO.propTypes=Az;WO.defaultProps=Rz;fe.Title=e=>s.jsx(VO,{...e});fe.Description=e=>s.jsx(WO,{...e});fe.Skeleton=z0e;fe.Group=K0e;const Q0e={xs:4,sm:8,md:16,lg:32,xl:64,xxl:128},ty=e=>{switch(e.length){case 1:return nc(e[0]);case 2:case 3:return`${nc(e[1])}`;case 4:return`${nc(e[3])} ${nc(e[1])}`;default:return"0"}},sy=e=>{switch(e.length){case 1:case 2:return`${nc(e[0])}`;case 3:case 4:return`${nc(e[0])} ${nc(e[2])}`;default:return"0"}},nc=e=>e?`${$(Q0e[e])}`:"0",X0e=e=>e.map(t=>nc(t)).join(" "),ny=e=>e?`gap: ${X0e(e)};`:"",Q=v.div.withConfig({shouldForwardProp:(e,t)=>!["wrap","direction","justify","align","gap"].includes(e)&&t(e)})`
    display: flex;
    flex-flow: ${({direction:e="row"})=>e} ${({wrap:e="wrap"})=>e};
    flex-basis: ${({basis:e})=>e||"auto"};
    justify-content: ${({justify:e="inherit"})=>e};
    ${({align:e})=>e&&`align-items:${e}`};

    ${({gap:e})=>ny(e)};

    ${({margin:e})=>e&&`margin-block: ${sy(e)};`};
    ${({margin:e})=>e&&`margin-inline: ${ty(e)};`};

    ${({additionalCss:e})=>e};

    ${re.smUp`
        ${({gapSmUp:e})=>ny(e)}

        ${({wrapSmUp:e})=>e&&`flex-wrap: ${e};`}

        ${({marginSmUp:e})=>e&&`margin-block: ${sy(e)};`}

        ${({marginSmUp:e})=>e&&`margin-inline: ${ty(e)};`}

        ${({directionSmUp:e})=>e&&`flex-direction: ${e};`}
    `}

    ${re.mdUp`
        ${({gapMdUp:e})=>ny(e)}

        ${({wrapMdUp:e})=>e&&`flex-wrap: ${e};`}

        ${({marginMdUp:e})=>e&&`margin-block: ${sy(e)};`}

        ${({marginMdUp:e})=>e&&`margin-inline: ${ty(e)};`}

        ${({directionMdUp:e})=>e&&`flex-direction: ${e};`}
    `}

    ${re.lgUp`
        ${({gapLgUp:e})=>ny(e)}

        ${({directionLgUp:e})=>e&&`flex-direction: ${e};`}

        ${({marginLgUp:e})=>e&&`margin-block: ${sy(e)};`}

        ${({marginLgUp:e})=>e&&`margin-inline: ${ty(e)};`}

        ${({additionalCssLgUp:e})=>e}
    `}
`;Q.displayName="Flex";const rr=v.div`
    flex-grow: 1;
`;rr.displayName="FlexGrow";wn.displayName="Footer";const Z0e={trail:m.arrayOf(m.shape({position:m.string.isRequired,name:m.string.isRequired})).isRequired},Dz=v.ul`
    list-style: none;
    margin: 0;
    padding: 0;
`,Oz=v.li`
    display: inline-block;
    vertical-align: middle;
`,Pz=v(pe).attrs({"aria-hidden":"true"})`
    margin-block: 0;
    margin-inline: var(--salt-spacing-2);
    vertical-align: middle;
    inline-size: ${$(20)};
`,Nz=(e,t)=>e>t+1,am=({trail:e})=>s.jsx(Dz,{children:e.map((t,n)=>s.jsx(Oz,{"data-test":"progress-steps-item","aria-current":t.selected?"step":void 0,children:s.jsxs(O,{size:"l",bold:t.selected,children:[t.position,". ",t.name,Nz(e.length,n)?s.jsx(Pz,{name:"arrow_right"}):null]})},t.name))});am.propTypes=Z0e;am.List=Dz;am.Item=Oz;am.Chevron=Pz;am.isLastItem=Nz;const Lz=v.div`
    color: ${({light:e})=>e?"var(--intent-content)":"var(--intent-contrast)"};
    line-height: 3;
    float: inline-start;
`,kz=v.div`
    &::after {
        clear: both;
        content: '';
        display: table;
    }
`,J0e=v.div`
    float: inline-end;
`,YO=({messages:e,trail:t,url:n="",onClick:o=()=>{},v2Enabled:r=!1,"data-test":a})=>{const{formatMessage:i}=L();return s.jsx(SE,{"data-test":"checkout-bottom-bar",light:r,id:"checkout-progress",children:s.jsxs(kz,{className:"salt-p--4",children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:i("checkout.walk.progress.accessibility.title")})}),s.jsx(Lz,{light:r,children:s.jsx(am,{trail:t})}),s.jsx(J0e,{children:s.jsx(x,{"data-synthetics":"next-step",intent:"action",onClick:o,asChild:!0,children:s.jsx(Ye,{intent:"ghost",to:n,"data-test":a?`${a}-link`:void 0,children:s.jsx(x.Text,{children:e.button})})})})]})})};YO.Progress=Lz;YO.CheckoutBarContentWrapper=kz;const{Label:Rn}=MK,e$e={hasError:m.bool,visuallyConcealed:m.bool,isRequired:m.bool},t$e={hasError:!1,visuallyConcealed:!1,isRequired:!1};Rn.propTypes=e$e;Rn.defaultProps=t$e;Rn.displayName="Label";const{RadioIconOff:s$e,RadioIconOn:n$e,RadioIconDisabled:o$e,RadioText:r$e,ContentWrapper:a$e}=Pa,i$e={bold:m.bool,checked:m.bool,children:m.node,"data-test":m.string,error:m.string,label:m.oneOfType([m.string,m.node]).isRequired,last:m.bool,value:m.string.isRequired,disabled:m.bool,role:m.string},l$e={bold:!0,checked:!1,children:void 0,"data-test":void 0,error:"",last:!1,disabled:!1,role:void 0},c$e=v(_a)`
    overflow: inherit;
`,Ao=({bold:e,checked:t,children:n,error:o,label:r,value:a,last:i,disabled:l,"data-test":c,role:d,...u})=>s.jsx(c$e,{last:i,children:s.jsxs(Rn,{hasError:!!o,role:d,children:[s.jsx("input",{value:a,type:"radio",disabled:l,...u,checked:t}),t&&!l&&s.jsx(n$e,{name:"radio_on"}),!t&&!l&&s.jsx(s$e,{name:"radio_off"}),l&&s.jsx(o$e,{name:"status_no"}),s.jsxs(O,{"data-test":c,intent:o?"error":void 0,children:[s.jsx(r$e,{asChild:!0,bold:e,children:s.jsx("strong",{children:r})}),s.jsxs(a$e,{children:[n,!!o&&s.jsx(oi,{children:o})]})]})]})});Ao.propTypes=i$e;Ao.defaultProps=l$e;Ao.displayName="Radio";const d$e=(()=>{let e=0;return{next(){return e+=1,`uid-${e}`}}})(),Dr=({onBlur:e,onFocus:t,onChange:n,value:o,children:r,placeholder:a="",size:i="md",id:l="",error:c,label:d="",hideLabel:u,helperText:p="",flush:g=!1,className:E,fill:y,...I})=>{const C=h.useRef(l||d$e.next()).current,T=`${C}-error-message`,_=!!c,[A,R]=h.useState(!1),P=G=>{R(!0),t?.(G)},N=G=>{R(!1),e?.(G)},k=G=>{n?.(G)},M=()=>{const G=K=>Array.isArray(K.props?.children)&&K.props.children.length>0,W=K=>G(K)&&K.type!=="option"?K.props.children.map(X=>W(X).flat()):[K],H=h.Children.toArray(r).map(K=>W(K).flat()).flat().filter(K=>K.type==="option"&&K.props.value===o).pop();return H&&H.props.children||s.jsx(Xu.Placeholder,{hasError:_,children:a})},w=G=>{const W={...I,onBlur:N,onFocus:P,onChange:k};return s.jsxs(Xu.RawSelect,{id:G,value:o,"aria-invalid":_?!0:void 0,"aria-describedby":_?T:void 0,...W,children:[a&&s.jsx("option",{value:"",disabled:!0,selected:!0,children:a}),r]})},j=I["data-test"]&&I["data-test"]!==""?`${I["data-test"]}-select-result`:"select-result";return s.jsxs(_a,{"data-test":"input-wrapper",fill:y,className:E,children:[!!d&&s.jsx(Rn,{visuallyConcealed:!!u,hasError:!!c,htmlFor:C,isRequired:I.required,children:d}),p&&s.jsx(O,{className:"salt-d--block salt-m-b--1",children:p}),s.jsxs(Xu.SelectWrapper,{hasError:_,size:i,focus:A,children:[s.jsx(Xu.SelectResult,{"data-test":j,children:M()}),w(C)]}),_&&s.jsx(oi,{"data-test":"form-field-error-message",id:T,children:c})]})};Dr.displayName="Select";const{ErrorMessage:u$e,Row:p$e}=MK,{CheckboxIconOff:m$e,CheckboxIconOn:h$e,CheckboxText:g$e,CheckboxTextWrapper:E$e}=QC,Lo=({bold:e,children:t,label:n,input:o,meta:r,className:a,labelClassName:i,whiteSpace:l,last:c,...d})=>{const u=s.jsx("input",{type:"checkbox",...o,...d}),p=r&&r.touched&&r.invalid||!1,g=r?r.error:"";return s.jsx(p$e,{className:a,last:c,children:s.jsxs(Rn,{className:i,hasError:p,children:[u,o.checked?s.jsx(h$e,{name:"checkbox_on"}):s.jsx(m$e,{name:"checkbox_off"}),s.jsxs(E$e,{children:[s.jsx(g$e,{whiteSpace:l,bold:e,children:n}),t,p&&s.jsx(u$e,{children:g})]})]})})};Lo.displayName="Checkbox";const f$e={error:"",meta:{touched:!1,invalid:!1},onChange:()=>{},requiredMessage:"",validation:{}},y$e=(e,t=!0)=>({...f$e,...e,value:e.value||(t?"":null)}),bB=(e,{checked:t,value:n,type:o})=>({...e,[n]:{value:n,checked:o==="radio"?!0:t}}),qO=e=>{class t extends h.Component{static getCheckboxValue({checkboxes:o,isCheckboxGroup:r}){const a=Object.keys(o).map(i=>o[i]).reduce((i,{checked:l,value:c})=>l?[...i,c]:i,[])||null;return r?a:a[0]||null}static getRadioValue({radios:o}){const r=Object.keys(o).map(a=>o[a]).filter(a=>a.checked);return r.length?r[0]:null}static generateGenericFieldState(o){const r=["error","meta","name","onChange","requiredMessage","type","validation","value"];return t.filterAttrs(o,r)}static setRadioGroupToUnchecked(o){const r={...o};return Object.keys(r).reduce((a,i)=>({...a,[i]:{...r[i],checked:!1}}),{})}static filterAttrs(o,r){return Object.keys(o).filter(a=>!!r.includes(a)).reduce((a,i)=>({...a,[i]:o[i]}),{})}static generateCheckboxState(o,r){const a=["error","meta","isCheckboxGroup","name","onChange","requiredMessage","type","validation"],i=t.filterAttrs(o,a),l=({checked:d,value:u},p={})=>({...p,[u]:{value:u,checked:!!d}});let c={};return r?r.checkboxes[o.value]?c={...r}:c={...r,...i,checkboxes:l(o,r.checkboxes)}:c={...i,checkboxes:l(o)},c}static generateRadioState(o,r){const a=["error","name","meta","onChange","requiredMessage","type","validation"],i=t.filterAttrs(o,a),l=({checked:d,value:u},p={})=>({...p,[u]:{value:u,checked:!!d}});let c={};return r?r.radios[o.value]?c={...r}:c={...r,...i,radios:l(o,r.radios)}:c={...i,radios:l(o)},c}constructor(){super(),this.createFieldStateObj=this.createFieldStateObj.bind(this),this.generateFieldProps=this.generateFieldProps.bind(this),this.getFieldValue=this.getFieldValue.bind(this),this.getFieldValues=this.getFieldValues.bind(this),this.isValid=this.isValid.bind(this),this.onBlur=this.onBlur.bind(this),this.onChange=this.onChange.bind(this),this.onFocus=this.onFocus.bind(this),this.registerField=this.registerField.bind(this),this.validateField=this.validateField.bind(this),this.resetForm=this.resetForm.bind(this),this.updateForm=this.updateForm.bind(this),this.setFieldDefaults=this.setFieldDefaults.bind(this),this.defaults={},this.state={}}onFocus(o){this.clearError(o.target.name)}onBlur(o){this.validateField(o.target.name)}onChange(o){const{target:{name:r,type:a,value:i,checked:l}}=o;this.setState(c=>{const d={...c[r]};if(a==="radio"){const u=t.setRadioGroupToUnchecked(c[r].radios);d.radios=bB(u,{type:a,value:i,checked:l})}else a==="checkbox"?d.checkboxes=bB(d.checkboxes,{type:a,value:i,checked:l}):d.value=i;return{[r]:d}},()=>this.state[r].onChange(o))}setError(o,r){this.setState(a=>{const i=a[o];return i.hasError=!0,i.error=r,i.meta={error:r,invalid:!0,touched:!0},{[o]:i}})}getFieldValues(){return Object.keys(this.state).reduce((o,r)=>({...o,[r]:this.getFieldValue(this.state[r].name)}),{})}getFieldValue(o){const r=this.state[o];let a=r.value;return r.type==="radio"?a=t.getRadioValue(r):r.type==="checkbox"&&(a=t.getCheckboxValue(r)),a}setFieldDefaults(o){this.defaults[o]||(this.defaults[o]={...this.state[o]})}createFieldStateObj(o){const r=this.state[o.name];let a={};return o.type==="radio"?a=t.generateRadioState(o,r):o.type==="checkbox"?a=t.generateCheckboxState(o,r):!this.state[o.name]||this.state[o.name].value===null?a=t.generateGenericFieldState(o):a={...this.state[o.name]},a}clearError(o){this.setState(r=>{const a=r[o];return a.hasError=!1,a.error="",a.meta={error:"",invalid:!1,touched:!1},{[o]:a}})}isValid(){return!Object.keys(this.state).filter(o=>!this.validateField(o)).length}validateField(o){const r=this.state[o],a=this.getFieldValue(o);let i,l;r.requiredMessage&&!a?(l=r.requiredMessage,i=!0):r.validation&&r.validation.test&&(l=r.validation.error,typeof r.validation.test=="function"?i=!r.validation.test(a):i=!new RegExp(r.validation.test).test(a));let c;return i&&l?(this.setError(o,l),c=!1):(this.clearError(o),c=!0),c}generateFieldProps({name:o,type:r,value:a}){const i={error:this.state[o].error,meta:this.state[o].meta,name:this.state[o].name,onBlur:this.onBlur,onChange:this.onChange,onFocus:this.onFocus};return r==="radio"?(i.checked=this.state[o].radios[a].checked,i.value=this.state[o].radios[a].value):r==="checkbox"?(i.checked=this.state[o].checkboxes[a].checked,i.value=this.state[o].checkboxes[a].value):i.value=this.state[o].value,i}registerField(o,r=!0){const a=y$e(o,r);return this.state[o.name]=this.createFieldStateObj(a),this.setFieldDefaults(o.name),this.generateFieldProps(a)}resetForm(){Object.keys(this.defaults).forEach(o=>{this.setState({[o]:this.defaults[o]})})}updateForm(o){this.setState(r=>({...r,...Object.keys(o).map(a=>Object.assign(r[a],{value:o[a]}))}))}render(){const o={...this.props,registerField:this.registerField,validateField:this.validateField,isValid:this.isValid,getFieldValues:this.getFieldValues,resetForm:this.resetForm,updateForm:this.updateForm};return s.jsx(e,{...o})}}return t},I$e=()=>{let e=0;return{next(){return e+=1,`uid-${e}`}}},jz=I$e(),Mz=({input:e,meta:t,label:n,...o})=>{const r=jz.next();return s.jsxs(_a,{children:[s.jsx(Rn,{hasError:t.touched&&t.invalid,htmlFor:r,isRequired:o.required,children:n}),s.jsx(_O,{as:"textarea",hasError:t.touched&&t.invalid,id:r,...e,...o}),t.touched&&t.invalid&&s.jsx(oi,{children:t.error})]})};Mz.displayName="TextareaField";const wz=({id:e,type:t="text",input:n,meta:o={touched:!1,invalid:!1},label:r,last:a=!1,hideLabel:i=!1,required:l,className:c,size:d,...u},p)=>{const g=jz.next(),E=e||g;return s.jsxs(_a,{"data-test":"input-wrapper",last:a,children:[s.jsx(Rn,{visuallyConcealed:i,hasError:o.touched&&o.invalid,htmlFor:E,isRequired:l,children:r}),s.jsx(ZC,{type:t,className:c,ref:p,hasError:o.touched&&o.invalid,blockSize:d,...n,...u,id:E}),o.touched&&o.invalid&&s.jsx(oi,{id:`${E}-error`,"data-test":"form-field-error-message",role:"alert",children:o.error})]})};wz.displayName="InputField";const Wo=h.forwardRef(wz),S$e={children:m.oneOfType([m.string,m.element,m.array]),xs:m.number,sm:m.number,md:m.number,lg:m.number},C$e={children:null},Fz=v.article`
    align-self: stretch;
    background-color: var(--intent-contrast);
    border-radius: var(--salt-radius-default);
    display: flex;
    flex-direction: column;
    justify-content: center;
    margin:var(--salt-spacing-1);
    padding: 0;
    text-align: center;
    inline-size: ${"calc(100% - var(--salt-spacing-2))"};
    @supports(--css: variables) {
        block-size: calc((100vmax - var(--frameBoxPosition, 0)) - var(--salt-spacing-8));
        position: relative;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    ${re.smUp`
        inline-size: ${"calc(100% - var(--salt-spacing-2))"};
    `}

    ${re.mdUp`
        inline-size: ${"calc(100% - var(--salt-spacing-2))"};
        padding: var(--salt-spacing-4);
        block-size: auto;
    `};

    ${re.lgUp`
        inline-size: ${"calc(100% - var(--salt-spacing-2))"};
    `}

    iframe {
        inline-size: 100%;
        @media (hover: none) {
            min-block-size: 100%;
        }
    }
`,cv=e=>s.jsx(Fz,{...e,children:e.children});cv.defaultProps=C$e;cv.propTypes=S$e;cv.FrameBoxWrapper=Fz;ba.displayName="GridList";const v$e={children:m.node,title:m.string,tight:m.bool},T$e={children:void 0,tight:!1,title:void 0},Bz=v(O)`
    margin-block-end: ${({tight:e})=>!e&&"var(--salt-spacing-2)"};
    text-align: center;
`,js=({children:e,title:t,tight:n})=>s.jsxs("div",{children:[t?s.jsx(Bz,{tight:n,asChild:!0,bold:!0,children:s.jsx("h2",{children:t})}):null,s.jsx("div",{children:e})]}),_$e=()=>s.jsxs("div",{children:[s.jsx(_e,{height:"24px",className:"salt-m-b--4"}),s.jsx(fe.Skeleton,{})]});js.Title=Bz;js.Skeleton=_$e;js.propTypes=v$e;js.defaultProps=T$e;const Uz="var(--intent-contrast)",b$e={targetName:m.string.isRequired,children:m.oneOfType([m.arrayOf(m.node),m.node])},x$e={children:void 0},A$e=v.div`
    inline-size: 100%;
    block-size: 20px;
    background-color: ${Uz};
    position: relative;
    text-align: center;
    font-weight: bold;
`,R$e=v.div`
    border: 2px solid ${Uz};
    min-inline-size: 60px;
    min-block-size: 30px;
    position: relative;
`,hg=e=>s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx(A$e,{children:e.targetName}),s.jsx(R$e,{children:e.children})]});hg.propTypes=b$e;hg.defaultProps=x$e;hg.displayName="GtmTarget";const{ProductAttributeIconImage:D$e}=sK,O$e={src:m.string,"data-test":m.string,alt:m.string,fill:m.string,height:m.number,name:m.string,info:m.bool,success:m.bool,primary:m.bool,warning:m.bool,error:m.bool,width:m.number,ariaHidden:m.bool},P$e={src:void 0,"data-test":void 0,alt:void 0,fill:"currentColor",height:20,width:20,name:void 0,info:void 0,success:void 0,primary:void 0,warning:void 0,error:void 0,svgDefsEnabled:!1,ariaHidden:!1},dv=({src:e,alt:t,"data-test":n,ariaHidden:o,...r})=>e?s.jsx(D$e,{src:e,alt:t,className:r.className,"data-test":n,"aria-hidden":o}):s.jsx(pe,{"data-test":n??`lifestyle-icon__${r.name}`,...r});dv.displayName="ProductAttributeIcon";dv.propTypes=O$e;dv.defaultProps=P$e;const N$e=v(dv)``,L$e={children:m.arrayOf(m.element)},k$e={children:null},im=v.div`
    display: flex;
    align-items: end;
    position: relative;
    inline-size: auto;

    > ${_a} {
        inline-size: auto;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
        justify-content: center;
    }

    > ${_a} ${ZC} {
        border-start-end-radius: 0;
        border-end-end-radius: 0;
    }
`;im.defaultProps=k$e;im.propTypes=L$e;const Be=({inline:e,children:t,innerRef:n,...o})=>s.jsx(wK.StyledList,{...o,ref:n,children:ae.Children.map(t,r=>r&&h.isValidElement(r)&&ae.cloneElement(r,{inline:e}))});Be.Item=wK.ListItem;const{strokeWidth:j$e,Wrapper:M$e,Ring:w$e,ContentContainer:F$e}=BBe,B$e={children:m.element,autoProgress:m.bool,progressValue:m.number,colorName:m.string,size:m.number,className:m.string},U$e={children:void 0,progressValue:void 0,autoProgress:!0,colorName:"primary",size:58,className:""},kl=({children:e,progressValue:t,autoProgress:n,colorName:o,size:r,className:a})=>{const[i,l]=h.useState(0),c=r/2,d=r/2-j$e/2;return!n&&i!==t&&l(t),h.useEffect(()=>{if(n){const u=setTimeout(()=>{l(100)},10);return()=>clearTimeout(u)}return()=>{}}),s.jsxs(M$e,{size:r,className:a,children:[s.jsxs(w$e,{viewBox:`0 0 ${r} ${r}`,progress:i,colorName:o,size:r,radius:d,children:[s.jsx("circle",{className:"path",r:d,cx:c,cy:c}),s.jsx("circle",{className:"progress",r:d,cx:c,cy:c})]}),s.jsx(F$e,{colorName:o,size:r,children:e})]})};kl.displayName="ProgressRing";kl.propTypes=B$e;kl.defaultProps=U$e;const G$e=v.span.withConfig({shouldForwardProp:(e,t)=>!["height","width","name"].includes(e)&&t(e)}).attrs(({svg:e,name:t,"data-test":n})=>({dangerouslySetInnerHTML:{__html:e},"data-test":n||`icon__${t}`}))`
    display: block;
    line-height: 0;

    > svg {
        block-size: ${({height:e})=>e};
        inline-size: ${({width:e})=>e};
    }
`,$$e=v(G$e)``,H$e=v.span`
    display: block;
    line-height: 0;
`,Kx=({type:e,title:t})=>{const n={width:138,height:36},o=e==="default"?"logo":"small",r=e==="default"?`calc(var(--logo-${e}-width, ${n.width}) / 14 * 1rem)`:`calc(var(--logo-${e}-width) / 14 * 1rem)`,a=e==="default"?`calc(var(--logo-${e}-height, ${n.height}) / 14 * 1rem)`:`calc(var(--logo-${e}-height) / 14 * 1rem)`,i=`logo${o==="small"?"_small":""}`;return s.jsx(H$e,{children:s.jsx(pe,{name:i,width:r,height:a,title:t})})};Kx.LogoIcon=$$e;m.string.isRequired,m.string.isRequired;const gg={label:{color:"var(--intent-primary-contrast)","font-size":10},selectedIconFill:"var(--intent-primary-900)",unselectedIconFill:"var(--intent-primary)",stroke:"#ffffff","fill-opacity":1,"stroke-weight":2,selectedIconScale:1.84,unselectedIconScale:1.38,location:{fill:"#3c96ff","fill-opacity":1,stroke:"#ffffff","stroke-opacity":1,"stroke-weight":2,scale:6}};v(O)`
    color: ${gg.label.color};
    font-size: ${$(gg.label["font-size"])};
    block-size: 20px;
    padding-block-start: 1px;
    position: absolute;
    text-align: center;
    inline-size: 20px;
`;v(pe)`
    position: absolute;

    > svg {
        fill: ${()=>gg.unselectedIconFill};
    }
`;const V$e=()=>{const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const n=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),n},W$e=()=>!window||!window?.innerHeight?!1:document.documentElement.scrollHeight>window.innerHeight,Eg=()=>{document.documentElement.style.overflow="hidden",W$e()?document.documentElement.style.width=`calc(100% - ${V$e()}px)`:document.documentElement.style.width="100%"},Ai=()=>{document.documentElement.style.overflow="",document.documentElement.style.width=""},da=h.forwardRef((e,t)=>{const{isSSRNavigation:n,label:o}=e,{formatMessage:r}=L(),a=r(o);if(n){const{href:u,isSSRNavigation:p,...g}=e;return s.jsx(Zh.Link,{ref:t,asChild:!0,children:u?s.jsx(tt,{href:u,...g,children:a}):s.jsx("a",{...g,children:a})})}const{to:i,href:l,isSSRNavigation:c,...d}=e;return s.jsx(Zh.Link,{ref:t,asChild:!0,children:i?s.jsx(Ye,{to:i,...d,children:a}):s.jsx("a",{...d,children:a})})}),st=e=>t=>({actions:vl(e,t)});class Y$e extends h.Component{static getDerivedStateFromError(){return{hasError:!0}}constructor(t){super(t),this.state={hasError:!1}}componentDidCatch(t){try{throw t}catch(n){this.props.actions.analyticsEvent({type:VC.ERROR,boundaryType:this.props.type,errorType:"ERROR_BOUNDARY"}),Ue.api.pushError(n instanceof Error?n:new Error(`GracefulErrorBoundary error: ${JSON.stringify(n)}`),{context:{requestId:this.props.requestId,message:`ErrorBoundary (${this.props.type}) component caught the following error: ${n instanceof Error?n.message:"unknown"}`,type:this.props.type}})}}render(){return this.state.hasError&&!this.props.fallback?s.jsx("div",{"data-test":"default-error",children:"Error"}):this.state.hasError?this.props.fallback:this.props.children}}const q$e=e=>({requestId:fC(e)}),K$e=st({analyticsEvent:U.analyticsEvent}),z$e=we(q$e,K$e),Q$e=z$e(Y$e),uv=(e,t)=>n=>o=>s.jsx(Q$e,{type:e,fallback:t,children:s.jsx(n,{...o})}),xB=[{duration:"-1",string:"settings.accessibility.notification.system-default",displayAsNumberOfSeconds:!1},{duration:"0",string:"settings.accessibility.notification.do-not-dismiss",displayAsNumberOfSeconds:!1},{duration:"5",string:"settings.accessibility.notification.duration",displayAsNumberOfSeconds:!0},{duration:"10",string:"settings.accessibility.notification.duration",displayAsNumberOfSeconds:!0},{duration:"20",string:"settings.accessibility.notification.duration",displayAsNumberOfSeconds:!0},{duration:"30",string:"settings.accessibility.notification.duration",displayAsNumberOfSeconds:!0},{duration:"60",string:"settings.accessibility.notification.duration",displayAsNumberOfSeconds:!0}],JI="-1",pv="accessibility-notification-duration-seconds",Gz=se("GET_ACCESSIBILITY_SETTINGS"),$z=se("UPDATE_ACCESSIBILITY_SETTINGS"),Hz={service:"web_customer_preference_ws",pathPrefix:{client:"/api/customer-preferences",server:"/core-api"}},X$e=()=>({type:"API",payload:{url:`/v1/customer-preferences?preferenceKeys=${pv}`,...Hz,...Gz}}),Z$e=e=>({type:"API",payload:{url:"/v1/customer-preferences-batch",options:{method:"PUT",body:e},...Hz,...$z}}),gd={getAccessibilitySettings:X$e,updateAccessibilitySettings:Z$e,types:{GET_ACCESSIBILITY_SETTINGS:Gz,UPDATE_ACCESSIBILITY_SETTINGS:$z}},J$e={data:{},...je,error:null},e1e=e=>e.reduce((t,n)=>({...t,[n.preferenceKey]:n}),{}),t1e=(e=J$e,t)=>{switch(t.type){case gd.types.GET_ACCESSIBILITY_SETTINGS.PENDING:return{...e,isFetching:!0,fetchError:!1};case gd.types.GET_ACCESSIBILITY_SETTINGS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case gd.types.GET_ACCESSIBILITY_SETTINGS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:e1e(t.payload.responseData)};default:return e}},Vz=({data:e})=>e.customer.accessibilitySettings,s1e=e=>{if(!e||e===JI)return;const t=Number(e);if(!isNaN(t))return t===0?null:t*1e3},oy={value:new Set(["default"]),has(e){return this.value.has(e)},subscribers:Array(),publish(){this.subscribers.forEach(e=>e())},unsubscribe(e,t){const n=this.subscribers.indexOf(t);this.subscribers.splice(n,1),this.value.delete(e),this.publish()},subscribe(e,t){this.value.add(e),this.subscribers.push(t),this.publish()}},n1e=v(Zh.Container)`
    --salt-notification-inset-inline-end: 0rem;

    ${re.smUp`
        --salt-notification-inset-inline-end: ${({context:e,width:t})=>e==="drawer"?t:"0rem"};
    `};
    position: ${({context:e})=>e==="drawer"||e==="modal"?"fixed":"relative"};
    visibility: ${({hide:e})=>e?"hidden":"visible"};
`,o1e=({context:e="default",width:t="360px"})=>{const[n,o]=h.useState(!1),{notifications:r}=Zh.useNotifications(),a=L(),{data:i}=f(Vz)??{},l=()=>{const S=(oy.has("drawer")||oy.has("modal"))&&e==="default";o(S)};h.useEffect(()=>(oy.subscribe(e,l),()=>{oy.unsubscribe(e,l)}),[]);const c=I=>typeof I=="string"?a.formatMessage(I):"formattedMessage"in I?I.formattedMessage:a.formatMessage(I.key,I.substitutions),d=I=>({warning:a.formatMessage("accessibility.warning.message"),info:a.formatMessage("accessibility.info.message"),error:a.formatMessage("accessibility.error.message"),success:a.formatMessage("accessibility.success.message")})[I],u=r.map(I=>({...I,a11y:{labels:{prefix:d(I.intent)}},text:c(I.text)})),p=i?.[pv]?.preferenceValue,g=!!p&&p!==JI,y=s1e(p??JI);return s.jsx(n1e,{context:e,notifications:u,hide:n,width:t,ariaLabels:{closeButton:a.formatMessage("filter.accessibility.bottom.sheet.close.button")},overridePersistence:g,duration:y})},Wz=uv("salt:notifications",s.jsx("div",{"data-test":"notifications-error"}))(o1e),{Button:r1e,notify:Zu}=Zh,a1e={close:Zu.close,getNotifications:Zu.getNotifications},Z={...a1e,success:(e,t)=>Zu.success(e,t),error:(e,t)=>{const n={...t,stack:new Error().stack};return Zu.error(e,n)},warning:(e,t)=>Zu.warning(e,t),info:(e,t)=>Zu.info(e,t)},i1e=({size:e="m",className:t,children:n,...o})=>s.jsxs(ZK,{children:[s.jsx(JC,{size:e,className:t,...o}),n&&s.jsx(JK,{size:e,children:n})]}),l1e=({size:e="m",className:t,children:n,...o})=>s.jsxs(Q,{direction:"column",justify:"center",align:"center",children:[s.jsx(JC,{size:e,className:t,...o}),n&&s.jsx(JK,{size:e,children:n})]}),c1e=({size:e="m",className:t,...n})=>s.jsx(ZK,{children:s.jsx(JC,{size:e,className:t,...n})}),_s=({size:e="m",className:t,...n})=>s.jsx(JC,{size:e,className:t,...n});_s.WithCaption=i1e;_s.WithCustomCaption=l1e;_s.WithContainer=c1e;const{Fill:Ju,FlexColumn:d1e,Content:u1e,CloseButton:AB,StyledFooter:lm,StyledHeader:cm,DialogForm:p1e}=$K,Pc={fill:{grow:m.number,direction:m.oneOf(["row","column"])},modal:{children:m.oneOfType([m.arrayOf(m.node),m.node]),onRequestClose:m.func,showCloseIcon:m.bool,loadingPlaceholder:m.oneOf(["skeleton","spinner"]),viewHeight:m.string,scrollToTop:m.bool},styledModal:{isLoading:m.bool,onRequestClose:m.func,maxWidth:m.oneOf(["sm","md","lg"])},header:{align:m.string,condensed:m.bool},body:{lastUpdated:m.number,condensed:m.bool},footer:{flow:m.oneOf(["column","inherit","initial","nowrap","row","wrap","row nowrap","column wrap"]),align:m.string,condensed:m.bool}},gu={modal:{onRequestClose:void 0,loadingPlaceholder:"skeleton",showCloseIcon:!0,scrollToTop:!1},styledModal:{isLoading:!1,onRequestClose:void 0,maxWidth:"sm"},header:{align:"center",condensed:!1},body:{lastUpdated:0,condensed:!1},footer:{flow:void 0,align:"center",condensed:!1}},Yz=v(u1e)`
    ${({context:e})=>e==="drawer"&&Pe`
            position: fixed;
            inset-block-start: 0;
            inset-inline-end: 0;
            block-size: 100%;
            border-start-end-radius: 0;
            border-end-end-radius: 0;
            inline-size: ${$(360)};
            ${re.xs`
                min-inline-size: 100%;
                border-start-start-radius: 0;
                border-end-start-radius: 0;
            `}
        `}
    ${({asBottomSheet:e=!1})=>e&&re.xs`
                position: fixed;
                inset-block-end: 0;
                inset-inline-start: 0;
                min-inline-size: 100%;
                border-start-start-radius: 0;
                border-start-end-radius: 0;
                border-end-start-radius: 0;
                border-end-end-radius: 0;
            `}
    ${({additionalCss:e})=>e}
`;cm.propTypes=Pc.header;cm.defaultProps=gu.header;cm.displayName="Modal-Header";const m1e=()=>[s.jsx(cm,{"data-test":"skeleton-modal-content-header",children:s.jsx(_e,{height:"15px",width:"250px"})},"header"),s.jsxs(jl,{"data-test":"skeleton-modal-content-body",children:[s.jsx(_e.Typography,{className:"salt-m-b--2"}),s.jsx(_e.Typography,{className:"salt-m-b--2"}),s.jsx(_e.Typography,{className:"salt-m-b--2"}),s.jsx(_e.Typography,{className:"salt-m-b--2"}),s.jsx(_e,{className:"salt-m-b--2",height:"15px",width:"150px"})]},"body"),s.jsx(lm,{"data-test":"skeleton-modal-content-footer",children:s.jsx(x,{fill:!0,intent:"primary",disabled:!0,children:s.jsx(_e.Button,{size:"s"})})},"footer")],h1e=()=>[s.jsx(cm,{"data-test":"spinner-modal-content-header"},"header"),s.jsx(jl,{"data-test":"spinner-modal-content-body",children:s.jsx(_s,{className:"salt-m-y--16"},"inner")},"body"),s.jsx(lm,{"data-test":"spinner-modal-content-footer"},"footer")],g1e={skeleton:s.jsx(m1e,{}),spinner:s.jsx(h1e,{})};let KO=class extends ae.Component{bodyElRef;constructor(t){super(t),this.handleScroll=this.handleScroll.bind(this),this.initBotShadow=this.initBotShadow.bind(this),this.bodyElRef=ae.createRef(),t.bodyElRef&&(this.bodyElRef=t.bodyElRef)}componentDidMount(){window.addEventListener("scroll",this.handleScroll,!0),this.initBotShadow()}componentDidUpdate(t){t.lastUpdated!==this.props.lastUpdated&&setTimeout(()=>this.initBotShadow,0)}componentWillUnmount(){window.removeEventListener("scroll",this.handleScroll,!0)}handleScroll(){this.bodyElRef.current&&(this.putShadow('[name="modal-header-shadow"]',"inset 0px 3px 6px 0px rgba(158,158,158,0.5)",!0),this.putShadow('[name="modal-footer-shadow"]',"inset 0px -3px 6px 0px rgba(158,158,158,0.5)"))}putShadow(t,n,o=!1){const r=document.querySelector(t),a=this.bodyElRef.current,i=a?.scrollHeight??0,l=a?.offsetHeight??0,c=a?.scrollTop??0,d=Math.abs(i-l),u=o?0:d;if(r){const p=r.style.boxShadow&&r.style.boxShadow!=="none";o&&c>u&&!p&&(r.style.boxShadow=n),!o&&c<u&&!p&&(r.style.boxShadow=n),c===u&&p&&(r.style.boxShadow="none")}}initBotShadow(){const t=document.querySelector('[name="modal-footer-shadow"]'),n=this.bodyElRef.current,o=n?.scrollHeight??0,r=n?.clientHeight??0;t&&o>r&&(t.style.boxShadow="inset 0px -3px 6px 0px rgba(158,158,158,0.5)")}render(){return s.jsx("div",{id:"modal-body",ref:this.bodyElRef,className:this.props.className,"data-test":this.props["data-test"],children:this.props.children})}};const jl=v(KO)`
    flex-grow: 1;
    overflow: auto;
    padding: var(--salt-spacing-4);

    ${({condensed:e=!1})=>!e&&re.smUp`
            padding-block: ${$(20)};
            padding-inline: ${$(50)};
    `};
`;jl.displayName="Modal-Body";jl.propTypes=Pc.styledBody;jl.defaultProps=gu.styledBody;KO.propTypes=Pc.body;KO.defaultProps=gu.body;jl.displayName="Modal-Body";jl.propTypes=Pc.styledBody;jl.defaultProps=gu.styledBody;lm.displayName="Modal-Footer";lm.propTypes=Pc.footer;lm.defaultProps=gu.footer;Ju.propTypes=Pc.fill;Ju.defaultProps={grow:1,direction:"row"};const zO=e=>{const{onRequestClose:t,maxWidth:n,viewHeight:o,alternativeBackground:r,isLoading:a,loadingPlaceholder:i="skeleton",closeMessage:l,children:c,showCloseIcon:d,intl:u,isOpen:p,scrollToTop:g,aria:E,onAfterOpen:y,asBottomSheet:I,additionalCss:S,context:C="modal",skipFocusFirst:T,condensed:_,...A}=e,R=h.useRef(!1),P=h.useRef(null),N=Bn(p)??!1,k=Bn(a)??!1,M=h.useCallback(()=>{if(P.current&&!a&&!T){const H=[...P.current.querySelectorAll('a, button, input, textarea, select, details, [tabindex]:not([tabindex="-1"])')].filter(K=>!K.hasAttribute("disabled"));H.length>0&&H[0].focus()}},[a]),w=h.useCallback(()=>{y&&y(),M()},[y,M]),j=h.useCallback(H=>{P.current=H},[]),G=h.useCallback(()=>g?"ReactModal__Body--open":null,[g]);if(h.useEffect(()=>{k&&!a&&M()},[k,a,M]),h.useEffect(()=>{if(N!==p)if(p){const H=document.documentElement.style.overflow==="hidden";R.current=H,Eg()}else R.current||Ai()},[N,p]),h.useEffect(()=>(p&&Eg(),()=>{Ai()}),[]),!p)return null;const W=ae.Children.map(c,H=>ae.isValidElement(H)&&(H.type===B.Header||H.type===B.Footer||H.type===B.Body)?ae.cloneElement(H,{condensed:_}):H);return s.jsxs(gp,{id:"modal",...A,contentRef:j,onAfterOpen:w,bodyOpenClassName:G(),isOpen:p,aria:E,children:[s.jsx(Ju,{onClick:t,"data-test":"modal-top-fill"}),s.jsxs(d1e,{children:[s.jsx(Ju,{onClick:t,direction:"column",maxWidth:n}),s.jsxs(Yz,{maxWidth:n,viewHeight:o,alternativeBackground:r,asBottomSheet:I,additionalCss:S,context:C,children:[a?g1e[i]:W,t&&d&&s.jsx(AB,{size:"s",fill:!1,intent:"tertiary","aria-label":l||u.formatMessage("modal.close"),onClick:t,children:s.jsx(AB.Icon,{"data-test":"icon__close_default",name:"close_default"})})]}),s.jsx(Ju,{onClick:t,direction:"column",grow:3})]}),s.jsx(Ju,{onClick:t}),s.jsx(Wz,{context:C})]})},Qi=v(zO)`
    ${()=>(gp.defaultStyles.overlay.backgroundColor="rgba(0, 0, 0, 0.75)",gp.defaultStyles.overlay.zIndex=$t.overlay,"")};
    display: flex;
    block-size: 100%;
    font-family: var(--font-family);
`;zO.propTypes=Pc.modal;zO.defaultProps=gu.modal;Qi.displayName="Modal";Qi.propTypes=Pc.styledModal;Qi.defaultProps=gu.styledModal;Qi.Content=Yz;Qi.Body=jl;Qi.Header=cm;Qi.Footer=lm;Qi.ModalForm=p1e;Qi.ReactModal=gp;const B=Tt(Ht)(Qi);B.displayName="Modal";const E1e={breakpoint:m.oneOf(["sm-up","md-up","lg-up"]).isRequired,children:m.oneOfType([m.arrayOf(m.node),m.node]).isRequired,display:m.string,remainInDom:m.bool,as:m.oneOfType([m.string,m.func])},f1e=v.div.withConfig({shouldForwardProp:(e,t)=>!["display"].includes(e)&&t(e)})`
    display: none;

    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
                display: ${({display:t})=>t||"block"};
            `};
`,Kt=({breakpoint:e,children:t,display:n,remainInDom:o,as:r})=>{const{currentBreakpoint:a}=h.useContext(kn),i=mg({currentBreakpoint:a,breakpoint:e});return o?s.jsx(f1e,{breakpoint:e,display:n,as:r,children:t}):i?null:t};Kt.propTypes=E1e;Kt.defaultProps={display:"block",remainInDom:!0,as:void 0};const dr=()=>{const{currentBreakpoint:e}=h.useContext(kn);return e},qz=v.div`
    position: relative;
`,Kz=v.div`
    background-color: var(--intent-contrast);
    border-radius: var(--salt-radius-default);
    box-shadow: var(--salt-elevation-shadow-1);
    display: ${({isOpen:e})=>e?"block":"none"};
    position: absolute;
    /* stylelint-disable-next-line declaration-block-no-redundant-longhand-properties -- The ternary is causing this to fail if shorthand is initial */
    inset-inline-start: ${({align:e})=>e==="left"?"0":"initial"};
    /* stylelint-disable-next-line declaration-block-no-redundant-longhand-properties -- The ternary is causing this to fail if shorthand is initial */
    inset-inline-end: ${({align:e})=>e==="right"?"0":"initial"};
    inset-block-start: ${({verticalAlign:e})=>e==="top"?"0":"calc(100% + var(--salt-spacing-2))"};
    white-space: ${({textWrap:e})=>e?"normal":"nowrap"};
    inline-size: 100%;
    min-inline-size: 100%;
    z-index: ${$t.dropdown};
    overflow-x: hidden;
    ${re.smUp`
        inline-size: ${({fill:e})=>e?"100%":"auto"};
    `};
`,zz=v.div`
    max-block-size: ${({maxHeight:e})=>e||$(400)};
    padding-inline: var(--salt-spacing-2);
    padding-block: var(--salt-spacing-2);
    overflow-y: auto;
`;v.div`
    display: block;

    ${re.smUp`
        display: inline-block;
        block-align: start;
    `};

    & + & {
        border: solid var(--salt-intent-secondary-100);
        border-block-width: var(--salt-border-1) 0;
        border-inline-width: 0;
        margin-block-start: var(--salt-spacing-2);
        padding-block-start: var(--salt-spacing-2);

        ${re.smUp`
            border-block-width: 0;
            border-inline-width: 0 var(--salt-border-1);
            margin-block: 0;
            margin-inline: 0 var(--salt-spacing-2);
            padding-block: 0;
            padding-inline: 0 var(--salt-spacing-2);
        `};
    }
`;const y1e=v.div`
    background-color: var(--intent-contrast);
    border-radius: var(--salt-radius-default);
    margin-block: var(--salt-spacing-2);
    margin-inline: var(--salt-spacing-2);
    text-align: center;
`,RB="close_default",DB="arrow_down",Qz=h.forwardRef(({iconName:e,text:t,isOpen:n,...o},r)=>s.jsxs(x,{ref:r,...o,children:[e&&s.jsx(x.Icon,{name:e,"data-test":`icon__${e}`}),t&&s.jsx(x.Text,{children:t}),s.jsx(x.Icon,{name:n?RB:DB,"data-test":n?`icon__${RB}`:`icon__${DB}`})]})),I1e="ko-KR",S1e={hasChildren:m.bool,numPanes:m.number,name:m.string,href:m.oneOfType([m.string,m.shape()]),icon:m.string,count:m.number,iconUrl:m.string,ItemComponent:m.func,itemComponentType:m.string,id:m.string,onClickListItem:m.func,onMouseOverListItem:m.func,generateItemUrl:m.func,onKeyDownListItem:m.func,paneIndex:m.number.isRequired,parentItemObj:m.shape({data:m.array,selectedItemId:m.string,name:m.string,parentItemObj:m.shape(),retailerId:m.string}),selected:m.bool,selectedItemId:m.string,header:m.bool,linkElement:m.oneOfType([m.string,m.func,m.elementType]),firstItem:m.bool,retailerCategoryId:m.string,intl:m.any.isRequired},C1e={hasChildren:!1,id:void 0,name:"",href:"",icon:null,count:void 0,iconUrl:"",ItemComponent:null,itemComponentType:null,selected:!1,parentItemObj:null,selectedItemId:"",header:!1,onClickListItem:void 0,onMouseOverListItem:void 0,onKeyDownListItem:void 0,generateItemUrl:void 0,linkElement:void 0,firstItem:!1,numPanes:null,retailerCategoryId:void 0},v1e=v.li`
    white-space: normal;
    ${re.lgUp`
        inline-size: auto;
    `}
`,OB=v(tt)`
    align-items: center;
    display: flex;
    justify-content: space-between;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-4);
    font-size: var(--salt-text-m-font-size);
    inline-size: 100%;
    ${re.lgUp`
        padding-block: var(--salt-spacing-2);
        padding-inline: var(--salt-spacing-4) var(--salt-spacing-1);
        background-color: ${({selected:e})=>e?"var(--intent-secondary-100)":"var(--intent-contrast)"};
    `}

    &:hover,
    &:focus {
        outline-offset: -${$(2)};
        background-color: var(--intent-secondary-100);
        text-decoration: ${({hasSubPanes:e})=>e?"none":"underline"};
    }
`,T1e=v.div`
    text-decoration: none;
`,_1e=v.div`
    align-items: center;
    display: flex;
    justify-content: space-between;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-4);
`,fg=20,b1e=v.img`
    block-size: ${fg}px;
    inline-size: ${fg}px;
    display: inline-block;
`,x1e=v(O)`
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    inline-size: calc(100% - ${fg+8}px);
    display: inline-block;
`,zx=16,A1e=v.div`
    display: flex;
    align-items: center;
    inline-size: calc(100% - ${zx}px);
    min-block-size: ${fg}px;
`;class mv extends h.Component{getItemComponent(){const{ItemComponent:t,itemComponentType:n,paneIndex:o,firstItem:r}=this.props;return t?n==="link"?s.jsx(t,{linkElement:OB,"data-first":r?`nav-pane-${o}`:void 0}):s.jsx(_1e,{children:s.jsx(t,{"data-first":r?`nav-pane-${o}`:void 0})}):null}getNavItemLink(){const{intl:t,hasChildren:n,onClickListItem:o,onMouseOverListItem:r,onKeyDownListItem:a,paneIndex:i,parentItemObj:l,selected:c,selectedItemId:d,numPanes:u,header:p,linkElement:g,firstItem:E,generateItemUrl:y,retailerCategoryId:I,count:S}=this.props,{id:C,name:T,href:_,icon:A,iconUrl:R}=this.props,P=t.locale,N=y&&y(p?l.name:T,C,I||l.retailerId),k={hasChildren:n,id:C,paneIndex:i,parentItemObj:l,selectedItemId:d},M=i<u-1,w=n&&M,j=!!S,G=!!(_||N),W=G?g:"a",H=G?void 0:"0",K=A?s.jsx(pe,{name:A,height:fg,className:"salt-m-r--2"}):R&&s.jsx(b1e,{src:R,alt:"",className:"salt-m-r--2"}),X=R?x1e:O,q=!!(p||R),ne=!w&&l&&p,oe=P===I1e?`${T} ${t.formatMessage("navigation.all")}`:`${t.formatMessage("navigation.all")} ${T}`;return s.jsxs(OB,{as:W,href:_||N,to:_||N,"aria-haspopup":w,"aria-expanded":w?!p&&c:void 0,onClick:ye=>o&&o(ye,k),onMouseOver:()=>r&&r(k),onFocus:()=>{},onKeyDown:ye=>a&&a(ye,k),selected:c,"data-test":T,"data-first":E?`nav-pane-${i}`:void 0,hasSubPanes:w,tabIndex:H,standalone:!!G,children:[s.jsxs(A1e,{children:[K,s.jsx(X,{size:"m",bold:q,children:ne?oe:T})]}),j&&s.jsx(T1e,{children:s.jsx(Ll,{intent:"secondary",count:S,"data-test":"nav-list-item-badge"})}),w&&s.jsx(pe,{name:"arrow_right",height:zx,width:zx,fill:null})]})}render(){const t=this.getItemComponent()||this.getNavItemLink();return s.jsx(v1e,{role:"menuitem",children:t})}}mv.propTypes=S1e;mv.defaultProps=C1e;mv.displayName="NavListItem";const QO=Ht(mv),R1e={data:m.arrayOf(m.shape()),onClickListItem:m.func.isRequired,onMouseOverListItem:m.func.isRequired,generateItemUrl:m.func.isRequired,onKeyDownListItem:m.func.isRequired,paneIndex:m.number.isRequired,parentItemObj:m.shape({data:m.array,selectedItemId:m.string,parentItemObj:m.shape(),id:m.string,name:m.string}),selectedItemId:m.string,numPanes:m.number.isRequired,linkElement:m.oneOfType([m.string,m.func,m.elementType]),onClickListHeaderItem:m.func.isRequired,additionalBrowseShopLinks:m.arrayOf(m.shape()),menuCampaigns:m.arrayOf(m.shape())},D1e={data:[],parentItemObj:{},selectedItemId:"",linkElement:void 0,additionalBrowseShopLinks:[],menuCampaigns:[]},O1e=v.ul`
    list-style: none;
    margin: 0;
    padding: 0;
    position: relative;
    inline-size: 100%;
`,P1e=({paneIndex:e,linkElement:t,onClickListHeaderItem:n,onKeyDownListItem:o,onMouseOverListItem:r,additionalBrowseShopLinks:a,containsFirstItem:i,isLgDevice:l})=>(l&&e===0||!l&&e===1)&&a&&a.map(u=>s.jsx(QO,{header:!0,onClickListItem:n,onKeyDownListItem:o,linkElement:t,onMouseOverListItem:r,name:u.message,href:u.href,paneIndex:e,firstItem:i,count:u.count},u.message)),Xz=({data:e,onClickListItem:t,onMouseOverListItem:n,paneIndex:o,parentItemObj:r,selectedItemId:a,numPanes:i,linkElement:l,onKeyDownListItem:c,generateItemUrl:d,containsFirstItem:u,isLgDevice:p})=>e.map((g,E)=>{const y=!!g.children.length,I=a===g.id,S=!p&&o===0;return s.jsx(QO,{linkElement:l,hasChildren:y,numPanes:i,id:g.id,name:g.name,icon:g.icon,count:g.count,href:g.href,retailerCategoryId:g.retailerId,ItemComponent:g.component,itemComponentType:g.componentType,onClickListItem:(C,T)=>{g.onClick&&g.onClick(),t(C,{retailerCategoryId:g.retailerId,categoryName:g.name,...T})},onMouseOverListItem:n,onKeyDownListItem:c,paneIndex:o,parentItemObj:r,selected:I,selectedItemId:a,firstItem:(u||S)&&E===0,generateItemUrl:d,iconUrl:g.iconUrl,role:"menuitem"},g.id)}),N1e=({onClickListItem:e,onMouseOverListItem:t,paneIndex:n,parentItemObj:o,selectedItemId:r,numPanes:a,linkElement:i,onKeyDownListItem:l,menuCampaigns:c,isLgDevice:d})=>(d&&n===0||!d&&n===1)&&Xz({data:c,onClickListItem:e,onMouseOverListItem:t,paneIndex:n,parentItemObj:o,selectedItemId:r,numPanes:a,linkElement:i,onKeyDownListItem:l,containsFirstItem:!0,isLgDevice:d}),L1e=({paneIndex:e,linkElement:t,onClickListHeaderItem:n,onKeyDownListItem:o,onMouseOverListItem:r,parentItemObj:a,generateItemUrl:i,isLgDevice:l})=>{const c=e!==0,d=Object.keys(a).length!==0;return(l||c)&&d&&s.jsx(QO,{header:!0,onClickListItem:n,onKeyDownListItem:o,linkElement:t,name:a.name,id:a.id,paneIndex:e,onMouseOverListItem:r,parentItemObj:a,"data-test":"header",firstItem:!0,generateItemUrl:i})},k1e=({data:e,onClickListItem:t,onMouseOverListItem:n,paneIndex:o,parentItemObj:r,selectedItemId:a,numPanes:i,linkElement:l,onKeyDownListItem:c,generateItemUrl:d,isLgDevice:u})=>Xz({data:e,onClickListItem:t,onMouseOverListItem:n,paneIndex:o,parentItemObj:r,selectedItemId:a,numPanes:i,linkElement:l,onKeyDownListItem:c,generateItemUrl:d,isLgDevice:u}),hv=({data:e,onClickListItem:t,onMouseOverListItem:n,paneIndex:o,parentItemObj:r,selectedItemId:a,numPanes:i,linkElement:l,onKeyDownListItem:c,onClickListHeaderItem:d,additionalBrowseShopLinks:u,generateItemUrl:p,menuCampaigns:g})=>{const y=dr()==="lg",I=!!g?.length;return s.jsxs(O1e,{id:`nav-menu-pane-${o}`,"aria-labelledby":"nav-menu-button",role:"menu",children:[N1e({onClickListItem:t,onMouseOverListItem:n,paneIndex:o,parentItemObj:r,selectedItemId:a,numPanes:i,linkElement:l,onKeyDownListItem:c,menuCampaigns:g,isLgDevice:y}),P1e({paneIndex:o,linkElement:l,onMouseOverListItem:n,onClickListHeaderItem:d,onKeyDownListItem:c,additionalBrowseShopLinks:u,containsFirstItem:!I,isLgDevice:y}),L1e({paneIndex:o,linkElement:l,onMouseOverListItem:n,onClickListHeaderItem:d,onKeyDownListItem:c,parentItemObj:r,generateItemUrl:p,isLgDevice:y}),k1e({data:e,onClickListItem:t,onMouseOverListItem:n,paneIndex:o,parentItemObj:r,selectedItemId:a,numPanes:i,linkElement:l,onKeyDownListItem:c,generateItemUrl:p,isLgDevice:y})]})};hv.propTypes=R1e;hv.defaultProps=D1e;hv.displayName="NavList";const j1e=v(hv)``,gv={MENU_CAMPAIGNS:"MENU_CAMPAIGNS"},M1e=({isInDropdown:e,numberOfVisibleTabs:t=0,tabs:n})=>(e?n.slice(t):n.slice(0,t)).map((r,a)=>{const{label:i,id:l}=r,d=(e?t:0)+a+1;return{id:l,label:i,positionSeen:d,isInDropdown:e}}),w1e=(e,t)=>{const n="([^&?/]*)";return{KEYWORD:`search\\?.*q=${n}`,CATEGORY:t?`categories.*/${n}`:`sublocationId=${n}`,PROMOTION:`/offers.*/${n}`,SHOP_IN_SHOP_TEMPLATED:`\\/shop-in-shop\\/${n}`,CMS_STATIC_PAGE:`\\/content\\/${n}`}[e]},F1e=(e,t,n)=>{const o=e.match(new RegExp(w1e(t,n)));return o?o[1]:void 0},Qx={tabsAnalyticsTransformer:M1e,extractUniqueIdentifierFromURL:F1e},kt={FOP:"FOP",KEYWORD:"KEYWORD",PROMOTION:"PROMOTION",PROMOTIONS_LANDING:"PROMOTIONS_LANDING",BOP:"BOP",CATEGORY:"CATEGORY",INTERNAL_PAGE:"INTERNAL_PAGE",WEB_ADDRESS:"WEB_ADDRESS",INTERNAL_WEB_ADDRESS:"INTERNAL_WEB_ADDRESS",ABSOLUTE_WEB_ADDRESS:"ABSOLUTE_WEB_ADDRESS",CMS_STATIC_PAGE:"CMS_STATIC_PAGE",SLOT_BOOKING:"SLOT_BOOKING",FAVORITES:"FAVORITES",ORDERS:"ORDERS",SHOP_IN_SHOP:"SHOP_IN_SHOP",SHOP_IN_SHOP_TEMPLATED:"SHOP_IN_SHOP_TEMPLATED",RETAIL_BANNER:"RETAIL_BANNER",DEFAULT_TAB:"DEFAULT_TAB"},Ev=(e,{threshold:t=0,rootMargin:n="0%",freezeOnceVisible:o=!1})=>{const[r,a]=h.useState(void 0),i=r?.isIntersecting&&o,l=([c])=>{a(c)};return h.useEffect(()=>{const c=e?.current;if(!!!window.IntersectionObserver||i||!c)return()=>{};const u={threshold:t,root:null,rootMargin:n},p=new IntersectionObserver(l,u);return p.observe(c),()=>p.disconnect()},[e?.current,n,i,t]),r},TE=e=>{const t=h.useRef(null),n=Ev(t,{freezeOnceVisible:!0}),o=h.useMemo(()=>!!n?.isIntersecting,[n]);return h.useEffect(()=>{o&&e()},[o,e]),t},B1e=()=>{const e=F(),t=h.useCallback(({menuCampaignName:i,menuCampaignId:l,index:c})=>{e(U.analyticsEvent({type:Bt.MENU_CAMPAIGN_DETAIL_IMPRESSION,menuCampaignName:i,menuCampaignId:l,index:c}));const d={event:"view_menu_campaign",id:l,index:c,name:i};te.sendEvent({GA:d,WA:null})},[e]),n=h.useCallback(({menuCampaignItemName:i,menuCampaignItemId:l,menuCampaignId:c,position:d})=>{e(U.analyticsEvent({type:Bt.MENU_CAMPAIGN_ITEM_IMPRESSION,menuCampaignItemName:i,menuCampaignItemId:l,menuCampaignId:c,sequence:d}));const u={ecommType:"enhanced",eventCategory:"E-commerce",event:"view_promotion",eventAction:"MENU_CAMPAIGN_ITEM_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Menu Campaign",id:l,name:i,creative:"",position:`Menu campaign item ${d}`}]}}};te.sendEvent({GA:u,WA:null})},[e]),o=h.useCallback(({destinationLinkType:i,menuCampaignName:l,menuCampaignItemId:c,menuCampaignId:d,analyticsEventId:u,source:p,menuCampaignItemName:g,position:E,index:y,fileName:I})=>{e(U.analyticsEvent({type:Bt.MENU_CAMPAIGN_ITEM_CLICKED,destinationLinkType:i,menuCampaignName:l,menuCampaignItemId:c,menuCampaignId:d,menuCampaignItemName:g,position:E,index:y,fileName:I,...u?{analyticsEventId:u}:{},...p?{source:p}:{}}));const S={ecommType:"enhanced",eventCategory:"E-commerce",event:"select_promotion",eventAction:"MENU_CAMPAIGN_ITEM_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"Menu Campaign",id:c,name:g,creative:I,position:`Menu campaign item ${E}`}]}}};te.sendEvent({GA:S,WA:null})},[e]),r=h.useCallback(({menuCampaignName:i,menuCampaignId:l,position:c,fileName:d})=>{e(U.analyticsEvent({type:Bt.MENU_CAMPAIGN_CLICKED,menuCampaignName:i,menuCampaignId:l,position:c,fileName:d}));const u={ecommType:"enhanced",eventCategory:"E-commerce",event:"select_promotion",eventAction:"MENU_CAMPAIGN_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"Menu Campaign",id:l,name:i,creative:d,position:`Menu ${c}`}]}}};te.sendEvent({GA:u,WA:null})},[e]),a=h.useCallback(i=>{e(U.analyticsEvent({type:Bt.MENU_CAMPAIGN_ITEM_LIST_IMPRESSION,menuCampaignItemList:i}));const l={ecommType:"enhanced",eventCategory:"E-commerce",event:"view_promotion",eventAction:"MENU_CAMPAIGN_ITEM_LIST_IMPRESSION",ecommerce:{promoView:{promotions:i.map(c=>({promotionType:"Menu Campaign",id:c.id,name:c.name,creative:c.creative,position:`Menu campaign item ${c.position}`}))}}};te.sendEvent({GA:l,WA:null})},[e]);return{reportMenuCampaignDetailImpression:t,reportMenuCampaignItemImpression:n,reportMenuCampaignItemClick:o,reportMenuCampaignClick:r,reportMenuCampaignItemListImpression:a}},U1e={onKeyDownListItem:m.func.isRequired,paneIndex:m.number.isRequired,parentItemObj:m.shape({iconUrl:m.string.isRequired,id:m.string,menuCampaignId:m.string.isRequired,menuCampaignIndex:m.number.isRequired,menuCampaignName:m.string.isRequired,name:m.string}).isRequired,items:m.arrayOf(m.shape()),onItemClick:m.func.isRequired},G1e={items:[]},PB=e=>[kt.WEB_ADDRESS,kt.ABSOLUTE_WEB_ADDRESS,kt.CATEGORY,kt.PROMOTION,kt.PROMOTIONS_LANDING].includes(e?.target?.linkType);let nb=[],ry="";const ob=e=>e?e.substring(e.lastIndexOf("/")+1):"",XO=e=>{const t=Ne(),[n,o]=h.useState(ct()),r=h.useRef([]),{items:a,onItemClick:i,onKeyDownListItem:l,paneIndex:c,parentItemObj:d}=e,{iconUrl:u,menuCampaignId:p,menuCampaignIndex:g,menuCampaignName:E,name:y}=d,I=B1e(),S=({targetUrl:N})=>{if(!N)return"";const k=Js(N),M=Qe.parse(k.search);return{...k,search:`?${Qe.stringify({...M,source:"IMAGE_CLICKED",sourceEventId:n})}`}},C=()=>{ry!==t&&(ry=t,nb=[])},T=()=>{r.current.length&&(I.reportMenuCampaignItemListImpression(r.current),r.current=[])};h.useEffect(()=>(ry=ry||t,C(),I.reportMenuCampaignClick({menuCampaignId:p,menuCampaignName:E,position:g.toString(),fileName:ob(u)}),I.reportMenuCampaignDetailImpression({menuCampaignId:p,menuCampaignName:E,index:g}),()=>{T()}),[d.id]);const _=h.useCallback(({destinationLinkType:N,menuCampaignItemId:k,targetUrl:M,position:w,index:j,fileName:G,menuCampaignItemName:W})=>{let H={};Qx.extractUniqueIdentifierFromURL(M,"KEYWORD")&&(H={source:"IMAGE_CLICKED"}),I.reportMenuCampaignItemClick({analyticsEventId:n,destinationLinkType:N,menuCampaignName:y,menuCampaignItemId:k,menuCampaignId:p,menuCampaignItemName:W,position:w,index:j,fileName:G,...H}),o(ct())},[]),A=h.useCallback(({menuCampaignItemId:N,fileName:k,position:M,menuCampaignItemName:w})=>{const j={promotionType:"Menu Campaign",id:N,name:w,creative:k,position:`Menu campaign item ${M}`},G=`${g}-${M}`;nb.includes(G)||(nb.push(G),r.current.push(j)),I.reportMenuCampaignItemImpression({menuCampaignItemName:w,menuCampaignItemId:N,menuCampaignId:p,position:M})},[a]);if(!a.length)return null;const R=({reportImpression:N,children:k})=>{const M=TE(N);return s.jsx("div",{ref:M,"data-test":"menu-campaigns-item",children:k})};R.propTypes={reportImpression:m.func.isRequired,children:m.element.isRequired};const P={paneIndex:c,parentItemObj:d};return s.jsxs("div",{className:"salt-p-b--2 salt-m--4 lg:salt-m-r--0 lg:salt-p-b--1 lg:salt-p-x--1",children:[y&&s.jsx(O,{size:"l",className:"salt-m-t--4",children:y}),s.jsx("div",{className:"salt-m-t--4",children:s.jsx(Oe.MediaCardCollection,{formatting:"small",gridVariant:"auto-fill",tabIndex:"0","aria-label":y,"data-first":`nav-pane-${c}`,onKeyDown:N=>l&&l(N,P),"data-test":"menu-campaigns",children:a.map((N,k)=>s.jsx(R,{reportImpression:()=>{A({menuCampaignItemId:N.id,menuCampaignItemName:N.name,position:k,fileName:ob(N.imageUrl)})},children:s.jsx(Oe.MediaNavigationCard,{variant:"fullImage",formatting:"small",src:N.imageUrl,alt:N.altText,title:N.label,href:PB(N)?N.targetUrl:void 0,to:PB(N)?void 0:S(N),target:N.target?.openInNewTab?"_blank":void 0,onClick:M=>{_({destinationLinkType:N.target?.linkType,menuCampaignItemId:N.id,menuCampaignItemName:N.name,targetUrl:N?.targetUrl,position:k,index:k,fileName:ob(N.imageUrl)}),i(M,P)}},N.id)},N.id))})})]})};XO.propTypes=U1e;XO.defaultProps=G1e;const $1e={data:m.arrayOf(m.shape()),showSpinner:m.bool,messages:m.shape({back:m.string,products:m.string}).isRequired,numPanes:m.number.isRequired,onClickListBack:m.func.isRequired,onClickListItem:m.func.isRequired,onClickListHeaderItem:m.func.isRequired,onMouseOverListItem:m.func.isRequired,onKeyDownListItem:m.func.isRequired,generateItemUrl:m.func.isRequired,paneIndex:m.number.isRequired,activePaneIndex:m.number,parentItemObj:m.shape({name:m.string,id:m.string,iconUrl:m.string,menuCampaignId:m.string,menuCampaignIndex:m.number,menuCampaignName:m.string}),prevPaneSelectedItemId:m.string,selectedItemId:m.string,linkElement:m.oneOfType([m.string,m.func,m.elementType]),additionalBrowseShopLinks:m.arrayOf(m.shape()),menuCampaigns:m.arrayOf(m.shape())},H1e={data:[],showSpinner:!1,activePaneIndex:0,parentItemObj:{},prevPaneSelectedItemId:"",selectedItemId:"",linkElement:void 0,additionalBrowseShopLinks:[],menuCampaigns:[]},V1e=Fi`
    0% { opacity: 0; }
    100% { opacity: 1; }
`,NB=25,LB=(e,t)=>e?t>1?$(550):$(300):$(240),W1e=v.div.withConfig({shouldForwardProp:(e,t)=>!["data","containsMenuCampaigns"].includes(e)&&t(e)})`
    background-color: ${({containsMenuCampaigns:e})=>e?"var(--background-color)":"var(--intent-contrast)"};
    box-sizing: border-box;
    overflow: hidden auto;
    backface-visibility: hidden;
    inline-size: 100%;
    max-block-size: calc(
        100vb - (var(--salt-spacing-4) - ${$(Jn.lg+NB+KI)})
    );

    ${re.lgUp`
        overflow-y: scroll;
        ${({containsMenuCampaigns:e})=>e?sB("var(--intent-secondary-900)","var(--background-color)"):sB("var(--intent-secondary-900)","var(--intent-contrast)")}
        ${({data:e})=>e.length?Pe`
                      animation: ${V1e} 0.2s;
                  `:""}
        max-inline-size: ${({containsMenuCampaigns:e,data:t})=>Pe`
            ${LB(e,t[0]?.children?.length)}
        `};
        max-block-size: calc(100vh - (var(--salt-spacing-8) - ${$(Jn.md+Jn.sm+NB+KI)}));
        opacity: ${({data:e})=>e.length?1:0};
        inline-size: ${({containsMenuCampaigns:e,data:t})=>Pe`
            ${LB(e,t[0]?.children?.length)}
        `};
        border-inline-start: var(--salt-border-1) solid var(--intent-secondary);

        &:first-child {
            border-inline-start: 0;
        }
        `}
`,Y1e=v.button`
    display: flex;
    flex-direction: row;
    align-items: center;
    inline-size: 100%;
    line-height: 0;
    padding-block: var(--salt-spacing-4);
    padding-inline: var(--salt-spacing-4) 0;
    background-color: transparent;
    border: none;

    &:hover,
    &:focus {
        outline: none;
        background-color: var(--intent-secondary-100);
    }
`,fv=e=>{const{activePaneIndex:t,additionalBrowseShopLinks:n,data:o,generateItemUrl:r,linkElement:a,menuCampaigns:i,messages:l,numPanes:c,onClickListHeaderItem:d,onClickListItem:u,onKeyDownListItem:p,onMouseOverListItem:g,paneIndex:E,parentItemObj:y,prevPaneSelectedItemId:I,selectedItemId:S,showSpinner:C}=e,T={paneIndex:E,parentItemObj:y},_=o[0]?.navContentType===gv.MENU_CAMPAIGNS&&o[0]?.children?.length>0;return s.jsx(W1e,{"data-test":"nav-pane",data:o,numPanes:c,paneIndex:E,activePaneIndex:t,prevPaneSelectedItemId:I,containsMenuCampaigns:_,children:C?s.jsx(_s,{"data-test":"nav-pane-spinner",className:"salt-m-t--16"}):s.jsxs(h.Fragment,{children:[E!==0&&s.jsx(Lt,{breakpoint:"lg-up",children:s.jsxs(Y1e,{type:"button",onFocus:A=>A.stopPropagation(),onClick:A=>e.onClickListBack(A,T),children:[s.jsx(pe,{verticalAlign:"middle",name:"arrow_left",height:18,width:18}),s.jsx(O,{className:"salt-m-l--2 salt-d--inline-block",size:"l",children:e.messages.back})]})}),_?s.jsx(XO,{items:o[0].children,paneIndex:E,parentItemObj:{iconUrl:y.iconUrl,id:y.id,menuCampaignId:y.menuCampaignId,menuCampaignIndex:y.menuCampaignIndex,menuCampaignName:y.menuCampaignName,name:y.name},onKeyDownListItem:p,eventData:T,onItemClick:u}):s.jsx(j1e,{linkElement:a,onMouseOverListItem:g,data:o,messages:l,numPanes:c,onClickListItem:u,onClickListHeaderItem:d,onKeyDownListItem:p,paneIndex:E,parentItemObj:y,selectedItemId:S,generateItemUrl:r,additionalBrowseShopLinks:n,menuCampaigns:i})]})})};fv.propTypes=$1e;fv.defaultProps=H1e;fv.displayName="NavPane";const q1e=v(fv)``,K1e=e=>{e&&e()},kB=(e,t,{activePaneIndex:n,goToChildPane:o,goToPreviousPane:r,reset:a,keyboard:i})=>{const{charCode:l,keyCode:c}=e,d=l||c;d===i.ESC?K1e(a):d===i.ARROW_LEFT&&n>0?r(t.paneIndex):(d===i.ARROW_RIGHT||d===i.ENTER)&&t.hasChildren&&o(e,t)},z1e={categoriesDictionary:m.shape({categories:m.shape(),rootCategories:m.array}),"data-test":m.string,"data-loading":m.bool,entryPointsInHeader:m.arrayOf(m.shape()),additionalBrowseShopLinks:m.arrayOf(m.shape()),menuCampaigns:m.arrayOf(m.shape()),messages:m.shape({back:m.string,products:m.string,title:m.string,browse:m.string,attributeTitle:m.string}).isRequired,numPanes:m.number,onShowNavigation:m.func.isRequired,onHideNavigation:m.func,generateItemUrl:m.func.isRequired,currentBreakpoint:m.string.isRequired,paneWidth:m.number,linkElement:m.oneOfType([m.string,m.func,m.elementType]),keyboard:m.objectOf(m.number).isRequired,actions:m.shape({onOpen:m.func.isRequired,onOpenLgUp:m.func.isRequired,onFirstPaneDisplayed:m.func.isRequired,analyticsEvent:m.func.isRequired}).isRequired,location:m.shape({pathname:m.string}).isRequired,overheadContentHeight:m.number,theme:m.shape().isRequired,onToggleDropdown:m.func},Q1e={numPanes:3,categoriesDictionary:void 0,"data-test":void 0,"data-loading":!1,entryPointsInHeader:[],additionalBrowseShopLinks:[],menuCampaigns:[],paneWidth:240,linkElement:void 0,overheadContentHeight:0,onToggleDropdown:()=>{}},X1e=v.div`
    position: fixed;
    inset: 0;
    ${dR("transform .2s linear opacity")}
    background-color: rgb(0 0 0 / 75%);
    block-size: 100%;
    opacity: 0.7;
    inline-size: 100%;
    z-index: ${$t.overlay};
`,Zz=300,jB=25,MB=e=>({overheadContentHeight:t})=>{let n=jB;n+=t?t+jB:0,n=e?`calc( ${$(n)} + var(--salt-spacing-8) + ${$(Jn.md+Jn.sm)})`:`calc( ${$(n)} + var(--salt-spacing-4) + ${$(Jn.lg)})`;let o;return typeof window<"u"&&typeof document<"u"&&(o=window.innerHeight),`calc(${o?`${o}px`:"100vh"} - ${n})`},Z1e=v(zz)`
    display: flex;
    inline-size: ${({children:e})=>100*e.length}%;
    max-block-size: ${MB()};
    margin: 0;
    padding: 0;

    --nav-panel-direction: -1;

    html[dir='rtl'] & {
        --nav-panel-direction: 1;
    }

    transform: translateX(
        ${({activePaneIndex:e,children:t})=>`calc(var(--nav-panel-direction) * ${e*(100/t.length)}%)`}
    );
    transition: transform ${Zz}ms ease-in-out;
    ${re.lgUp`
        max-block-size: ${MB(!0)};
        transform: translateX(0);
        inline-size: 100%;
    `}
    overflow-y: hidden;
`,J1e=v(qz)`
    position: relative;
`,eHe=v(Kz)`
    z-index: ${$t["nav-menu"]};
    max-inline-size: 525px;
    inline-size: ${"calc(100vi - var(--salt-spacing-4))"};
    ${re.mdUp`
        max-inline-size: 455px;
    `}
    ${re.lgUp`
        inline-size: auto;
        max-inline-size: initial;
    `}
    display: ${({isDropdownOpen:e})=>e?"block":"none"};
`,Th={data:[],parentItemObj:{},selectedItemId:""},tHe=()=>[Th,Th,Th],sHe=({panes:e,paneIndex:t})=>e.map((n,o)=>t!==null&&o>=t?{...n,...Th}:n),nHe=({categoriesDictionary:e,parentCategoryId:t})=>t&&e.categories[t]?{...e.categories[t]}:{},oHe=({categoriesDictionary:e,paneIndex:t,parentCategoryId:n})=>((n&&e.categories[n]&&t>-1?e.categories[n].children:e.rootCategories)||[]).map(r=>e.categories[r]),rHe=(e,t)=>[Jz(e,t)],Jz=(e,t)=>e.find(n=>n.id===t),aHe=e=>{const t=e.map((n,o)=>n.Component?{id:`links${o}`,component:n.Component,componentType:n.componentType,children:{}}:{id:`links${o}`,href:n.href,name:n.message,icon:n.icon,children:n.children||{},onClick:n.onClick,count:n.count});return[{...Th,data:t}]},iHe=({menuCampaigns:e,categoriesDictionary:t,clearPanesAfterIndex:n=null,currentPanes:o,highlightedCategoryId:r=null,paneIndex:a=-1,parentCategoryId:i=null,isLgDevice:l})=>{const c=oHe({categoriesDictionary:t,paneIndex:a,parentCategoryId:i}),d=sHe({panes:o,paneIndex:n}),u=l?a:a-1,p=Jz(e,i)||nHe({categoriesDictionary:t,parentCategoryId:i}),g=p.navContentType===gv.MENU_CAMPAIGNS?rHe(e,i):c;return d[u]={...d[u],data:g,parentItemObj:p,selectedItemId:r||"",menuCampaigns:e},d},e4=Pe`
    z-index: ${({isOpen:e})=>e?$t["nav-menu"]:$t["nav-button"]};
`,lHe=v(Qz)`
    ${e4};
`,cHe=e=>e==="alternate"?"var(--header-top-bar-background-color-contrast)":void 0,wB=v(x)`
    ${e4};

    color: ${({headerColorScheme:e})=>cHe(e)};
`;let rb=!1,ab=!1;class ZO extends h.Component{constructor(t){super(t),this.state={panes:tHe(this.props.numPanes),activePaneIndex:0,isDropdownOpen:!1},this.navListItemIntentTimer=null,this.onClickListBack=this.onClickListBack.bind(this),this.onClickListItem=this.onClickListItem.bind(this),this.onClickListHeaderItem=this.onClickListHeaderItem.bind(this),this.onMouseOverListItem=this.onMouseOverListItem.bind(this),this.onKeyDownListItem=this.onKeyDownListItem.bind(this),this.preparePane=this.preparePane.bind(this),this.generateMenuData=this.generateMenuData.bind(this),this.goToPreviousPane=this.goToPreviousPane.bind(this),this.goToChildPane=this.goToChildPane.bind(this),this.addWindowResizeListener=this.addWindowResizeListener.bind(this),this.removeWindowResizeListener=this.removeWindowResizeListener.bind(this),this.windowResize=this.windowResize.bind(this),this.toggleDropdownButton=this.toggleDropdownButton.bind(this),this.resetDropdown=this.resetDropdown.bind(this),this.onDropdownMouseUp=this.onDropdownMouseUp.bind(this),this.withDelayedMouseInteraction=this.withDelayedMouseInteraction.bind(this)}componentDidMount(){this.regeneratePanesState(),this.generateMenuData(),this.addWindowResizeListener()}componentDidUpdate(t,n){const{categoriesDictionary:o}=this.props;this.props.location.pathname!==t.location.pathname&&this.setState({isDropdownOpen:!1}),Oi(t.categoriesDictionary,o)||this.regeneratePanesState(),n.isDropdownOpen!==this.state.isDropdownOpen&&this.props.onToggleDropdown(this.state.isDropdownOpen)}componentWillUnmount(){Ai(),this.removeWindowResizeListener()}isLgDevice(){return this.props.currentBreakpoint==="lg"}withDelayedMouseInteraction(t){clearTimeout(this.navListItemIntentTimer);const n=250;this.navListItemIntentTimer=setTimeout(()=>{t()},n)}onMouseOverListItem({hasChildren:t,id:n,paneIndex:o,selectedItemId:r}){this.withDelayedMouseInteraction(()=>{if(this.isLgDevice())if(!t)this.setState(a=>({panes:this.preparePane({parentCategoryId:a.id,clearPanesAfterIndex:o+1,paneIndex:a.paneIndex,highlightedCategoryId:null,currentPanes:a.panes,activePaneIndex:o})}));else{const a=o<this.props.numPanes-1;r!==n&&a&&this.setState(i=>{const l=t?o+1:o;return{panes:this.preparePane({parentCategoryId:n,clearPanesAfterIndex:o+1,paneIndex:o+1,highlightedCategoryId:null,currentPanes:i.panes}),activePaneIndex:l}})}})}onClickListItem(t,n,o){return this.goToChildPane(t,n,o)}onClickListHeaderItem(t,n){this.resetMenuAndPanes(n)}onClickListBack(t,{paneIndex:n}){t.stopPropagation(),t.preventDefault(),this.goToPreviousPane(n)}onKeyDownListItem(t,n){kB(t,n,{activePaneIndex:this.state.activePaneIndex,goToChildPane:this.goToChildPane,goToPreviousPane:this.goToPreviousPane,keyboard:this.props.keyboard})}onDropdownMouseUp(){this.generateMenuData(),this.removeWindowResizeListener()}getNavButton(t,n){return s.jsxs(h.Fragment,{children:[s.jsx(Kt,{breakpoint:"lg-up",display:"inline-block",children:s.jsx(lHe,{intent:t?"tertiary-contrast":"tertiary",size:"s",isOpen:t,text:this.props.messages.title,id:"nav-menu-button","data-test":"shop-button","aria-controls":t?"nav-menu":void 0,"aria-expanded":t,"aria-haspopup":"true",onClick:()=>{t||this.props.actions.onOpenLgUp(),n()},onMouseUp:t?void 0:this.onDropdownMouseUp})}),s.jsx(Lt,{breakpoint:"lg-up",display:"inline-block",children:s.jsxs(wB,{isOpen:t,intent:t?"tertiary-contrast":"tertiary","data-test":"shop-button","aria-label":this.props.messages.title,onClick:()=>{t||this.props.actions.onOpen(),n()},headerColorScheme:this.props.headerColorScheme,onMouseUp:t?void 0:this.onDropdownMouseUp,children:[s.jsx(wB.Icon,{name:`${t?"close_default":"menu"}`,"data-test":`${t?"icon__close_default":"icon__menu"}`}),s.jsx(ie,{children:this.props.messages.attributeTitle})]})})]})}goToChildPane(t,{hasChildren:n,id:o,paneIndex:r,retailerCategoryId:a,categoryName:i,parentItemObj:l},c){if(n&&r<(this.isLgDevice()?this.props.numPanes-1:this.props.numPanes))return t.persist(),t.stopPropagation(),t.preventDefault(),this.isLgDevice()?(setTimeout(()=>{document.querySelector(`[data-first="nav-pane-${r+1}"]`)?.focus()},0),this.setState(u=>{const p=l?l.id:null;let g=this.preparePane({parentCategoryId:p,clearPanesAfterIndex:r,paneIndex:r,highlightedCategoryId:o,currentPanes:u.panes});return n&&(g=this.preparePane({parentCategoryId:o,clearPanesAfterIndex:r+1,paneIndex:r+1,highlightedCategoryId:null,currentPanes:g})),{panes:g,activePaneIndex:r+1}})):this.setState(u=>({panes:this.preparePane({parentCategoryId:o,clearPanesAfterIndex:r+1,paneIndex:r+1,highlightedCategoryId:o,currentPanes:u.panes}),activePaneIndex:r+1}));if(a){this.props.actions.analyticsEvent({type:rn.SELECT_CATEGORY_GA4_EVENT,location:"browse",categoryName:i,retailerCategoryId:a});const u={event:"select_category",id:a,location:"browse",name:i};te.sendEvent({GA:u,WA:null})}return c&&c()}windowResize(){ab!==this.isLgDevice()&&(ab=this.isLgDevice(),this.resetMenuAndPanes())}addWindowResizeListener(){rb||(rb=!0,ab=this.isLgDevice(),window.addEventListener("resize",this.windowResize))}removeWindowResizeListener(){rb=!1,window.removeEventListener("resize",this.windowResize)}goToPreviousPane(t){let n=0;if(!this.isLgDevice()){n=Zz;const o=this.state.panes[t-2]&&this.state.panes[t-2].selectedItemId||null;this.setState(r=>({panes:this.preparePane({parentCategoryId:o,clearPanesAfterIndex:t-1,paneIndex:t-1,highlightedCategoryId:o,currentPanes:r.panes}),activePaneIndex:t-1}))}setTimeout(()=>{t!==0&&document.querySelector(`[data-first="nav-pane-${t-1}"]`)?.focus()},n)}preparePane({clearPanesAfterIndex:t=null,currentPanes:n,highlightedCategoryId:o=null,paneIndex:r=-1,parentCategoryId:a=null}){const{categoriesDictionary:i,menuCampaigns:l}=this.props;return iHe({menuCampaigns:l,categoriesDictionary:i,clearPanesAfterIndex:t,currentPanes:n,highlightedCategoryId:o,paneIndex:r,parentCategoryId:a,isLgDevice:this.isLgDevice()})}resetMenuAndPanes(t){t&&t(),this.generateMenuData()}generateMenuData(){this.setState(t=>({panes:this.preparePane({parentCategoryId:null,clearPanesAfterIndex:-1,paneIndex:0,highlightedCategoryId:null,currentPanes:t.panes}),activePaneIndex:0}))}regeneratePanesState(){this.setState(t=>({panes:this.preparePane({parentCategoryId:t.panes[t.activePaneIndex].parentItemObj.id,clearPanesAfterIndex:null,paneIndex:t.activePaneIndex,highlightedCategoryId:null,currentPanes:t.panes}),activePaneIndex:t.activePaneIndex}))}generatePanes(t){const n=[],{entryPointsInHeader:o,linkElement:r,messages:a,additionalBrowseShopLinks:i,generateItemUrl:l,menuCampaigns:c}=this.props,d=aHe(o);d.push(...this.state.panes);const u=this.state.panes.filter(y=>y.data.length>0),p=this.isLgDevice()?u:d,g=this.isLgDevice()?this.props.numPanes:this.props.numPanes+1,E=Math.min(p.length,g);for(let y=0;y<E;y+=1){const I=p[y-1]?p[y-1].selectedItemId:null,S={...p[y].parentItemObj},C=y!==0;n.push(s.jsx(q1e,{linkElement:r,data:p[y].data,showSpinner:C&&this.props["data-loading"],messages:a,paneIndex:y,numPanes:g,activePaneIndex:this.state.activePaneIndex,onClickListBack:this.onClickListBack,onClickListItem:(T,_)=>this.onClickListItem(T,_,t),onClickListHeaderItem:T=>this.onClickListHeaderItem(T,t),onMouseOverListItem:this.onMouseOverListItem,onKeyDownListItem:this.onKeyDownListItem,parentItemObj:S,prevPaneSelectedItemId:I,selectedItemId:p[y].selectedItemId,generateItemUrl:l,additionalBrowseShopLinks:i,menuCampaigns:c},S?.id??y))}return this.state.isDropdownOpen&&this.state.activePaneIndex===0&&!this.props["data-loading"]&&this.props.actions.onFirstPaneDisplayed(),n}toggleDropdownButton(){const t=!this.state.isDropdownOpen;t===!0?(this.generateMenuData(),this.props.onShowNavigation(),Eg(),this.addWindowResizeListener()):(Ai(),this.props.onHideNavigation(),this.removeWindowResizeListener()),this.setState(()=>({isDropdownOpen:t}))}resetDropdown(){Ai(),this.removeWindowResizeListener(),this.setState({isDropdownOpen:!1})}render(){const{isDropdownOpen:t,activePaneIndex:n}=this.state,{overheadContentHeight:o}=this.props;return s.jsxs(J1e,{as:"nav",id:"navigation-dropdown","data-test":this.props["data-test"],onKeyDown:r=>kB(r,{},{reset:this.resetDropdown,keyboard:this.props.keyboard}),children:[t&&s.jsx(X1e,{"data-test":"overlay",onClick:this.toggleDropdownButton}),this.getNavButton(t,this.toggleDropdownButton),s.jsx(eHe,{isOpen:!0,"data-test":"styled-dropdown",id:"nav-menu",isDropdownOpen:t,children:s.jsx(Z1e,{activePaneIndex:n,overheadContentHeight:o,children:this.generatePanes(this.resetDropdown)})})]})}}function dHe(e){const t=dr();return s.jsx(ZO,{...e,currentBreakpoint:t})}ZO.defaultProps=Q1e;ZO.propTypes=z1e;const uHe=e=>({location:UC(e)}),pHe=we(uHe)(v(dHe)``);no.displayName="NavigationList";const{ProgressBarElement:mHe}=cUe,hHe={progress:m.number},gHe={progress:0},yv=({progress:e})=>s.jsx(mHe,{value:e});yv.displayName="ProgressBar";yv.propTypes=hHe;yv.defaultProps=gHe;const EHe={ringContent:m.element,status:m.string,achievedStatus:m.string,progressFraction:m.string,completed:m.bool,ariaText:m.string,textSize:m.oneOf(["xs","s","m","l","xl"]),textPadding:m.oneOf(["xs","sm","md","lg","xl",null]),textPaddingLeft:m.oneOf(["xs","sm","md","lg","xl",null]),textAs:m.oneOf(["h2","h3","h4","h5","span","p"]),colorName:m.oneOf(["action","promotion"]),size:m.number,overrideText:m.element},FB={xs:4,sm:8,md:16,lg:32,xl:64,xxl:128},t4=v.div`
    display: flex;
    flex-wrap: nowrap;
    position: relative;
    inline-size: 100%;
    align-items: center;
`,s4=v.div.withConfig({shouldForwardProp:(e,t)=>!["size"].includes(e)&&t(e)})`
    position: relative;
    inline-size: ${({size:e})=>$(e)};
    block-size: ${({size:e})=>$(e)};
`,n4=v.div.withConfig({shouldForwardProp:(e,t)=>!["size"].includes(e)&&t(e)})`
    align-items: center;
    padding: ${({padding:e})=>$(FB[e])};
    padding-inline-start: ${({paddingLeft:e})=>$(FB[e])};
    inline-size: calc(100% - ${({size:e})=>e}px);
`,o4=e=>{const[t,n]=e.split("/");return Math.round(parseInt(t,10)/parseInt(n,10)*100)},fHe=v(O)`
    overflow: hidden;
    text-overflow: ellipsis;
`,ra=({status:e,achievedStatus:t,progressFraction:n,completed:o,textSize:r,textPadding:a,textPaddingLeft:i,textAs:l,ariaText:c,colorName:d,size:u,overrideText:p,ringContent:g})=>{const E=l;return s.jsxs(t4,{"data-test":"progress-status-box",children:[s.jsx("div",{"aria-hidden":"true","data-test":"progress-status-animation",children:o?s.jsx(s4,{size:u,children:s.jsx(pe,{name:"status_yes",height:u,width:u,success:!0})}):s.jsx(kl,{colorName:d,progressValue:o4(n),autoProgress:!1,size:u,children:g})}),s.jsx(n4,{size:u,padding:a,paddingLeft:i,"aria-hidden":c?"true":"false",children:p||s.jsxs(h.Fragment,{children:[s.jsx(fHe,{asChild:!0,size:r,className:"salt-d--block",children:s.jsx(E,{children:e})}),s.jsx(O,{asChild:!0,size:r,bold:!0,children:s.jsx(E,{children:t})})]})}),c&&s.jsx(ie,{asChild:!0,children:s.jsx("h1",{children:c})})]})};ra.propTypes=EHe;ra.defaultProps={ringContent:null,overrideText:null,status:null,achievedStatus:null,progressFraction:null,completed:!1,textSize:"m",textPadding:"md",textPaddingLeft:"md",textAs:"span",colorName:"action",size:58,ariaText:null};ra.Wrapper=t4;ra.IconWrapper=s4;ra.TextWrapper=n4;ra.getPercentageFromFractionString=o4;const{StyledTag:yHe,TagText:IHe}=SUe,JO=({icon:e,size:t="sm",minSize:n,children:o,onClick:r,as:a,buttonAriaLabel:i,className:l,dataTestId:c})=>s.jsxs(yHe,{as:a,size:t,minSize:n,className:l,"data-test":c,children:[e&&s.jsx(pe,{name:e}),s.jsx(IHe,{bold:!0,children:o}),s.jsx(x,{size:"s",intent:"tertiary",fill:!1,onClick:r,"aria-label":i,children:s.jsx(x.Icon,{name:"close_default"})})]});JO.displayName="Tag";const SHe={show:m.bool},r4=v.div`
    display: ${({show:e})=>e?"block":"none"};
    ${re.mdUp`
        display: block;
    `}
`;r4.propTypes=SHe;const CHe=v.a`
    font-weight: 600;
    display: flex;
    align-items: center;
    text-decoration: none;
    min-block-size: ${$(40)};
    min-inline-size: ${$(40)};
    padding-inline: var(--salt-spacing-4);
    position: absolute;
    inset-block-start: 0;
    inset-inline-start: 0;
    z-index: ${$t["skip-link"]};
    background-color: #ff9f1c;
    border: none;
    border-radius: var(--salt-radius-default);
    color: #000;
    text-align: start;
    vertical-align: middle;

    &:hover,
    &:active,
    &:enabled {
        background-color: #ff9f1c;
        border: none;
        color: #000;

        &:visited {
            background-color: #e2e8edff;
        }
    }

    &:not(:focus, :active) {
        ${hO}
    }
`,_E=({text:e,location:t,testId:n,onClick:o})=>s.jsx(CHe,{"data-test":n,href:t,onClick:o,children:s.jsx(O,{bold:!0,children:e})});_E.displayName="SkipLink";const Il="CUSTOMER_COLLECTION",xa="HOME_DELIVERY",vHe=e=>{if(e.length){const t=e.map(r=>parseFloat(r.deliveryPrice.amount)),n=Math.min(...t),o=Math.max(...t);return{min:n,max:o,currency:e[0].deliveryPrice.currency}}return null},a4=(e,t,n)=>{const o=n({amount:e.min,currency:e.currency});if(e.min===e.max)return o;const r=n({amount:e.max,currency:e.currency});return t.formatMessage("slots.price.range",{minPrice:o,maxPrice:r})},ws=F,Me=f,yg=(e,t)=>{const n={KG:e("bop.catch.weight.unit.kg"),G:e("bop.catch.weight.unit.g")};return t&&Object.keys(n).includes(t)?n[t]:""},ii=(e,t,n,o={})=>{const r=e(Number(t.amount),{...o,style:"currency",currency:t.currency,currencyDisplay:n?"code":void 0});return n?.includes("{value}")?n.replace("{value}",r.replace(t.currency,"").trim()):r},He=()=>{const{formatNumber:e}=L(),t=Me(Bi);return(n,o)=>ii(e,n,t,o)},THe=({price:e})=>{const{formatNumber:t}=L(),n=Me(Bi);return ii(t,e,n)},i4=()=>{const{formatMessage:e}=L(),t=He();return({item:n,withDescription:o=!0})=>{if(!n)return"";const r=parseFloat(n.price.amount)===0?e({id:"delivery-details.delivery-asset-selector.option.price.free.label"}):t(n.price);return o&&n.description?e({id:"delivery-details.delivery-asset-selector.option.label.with-description"},{name:n.displayValue,priceLabel:r,description:n.description}):e({id:"delivery-details.delivery-asset-selector.option.label"},{name:n.displayValue,price:r})}},eP="STANDARD",Qa="ON_DEMAND",Ig="AVAILABLE",l4="GEOWIDGET",tP="GRID",c4="SIMPLE",d4="FIXED",_h="standard",vp="saver",bE=e=>{const t=L(),n=He();return e.type===xa?e.deliveryPrice?a4(e.deliveryPrice,t,n):"":t.formatMessage(e.subtitle)},Xx=(e,t)=>!Nd(e)&&!vR(e,t),u4=e=>e.slotEndDateTimeISO!==void 0,p4=e=>e.onDemandProperties!==void 0,sP=e=>{const t=Ni(),{deliveryEndDate:n,deliveryStartDate:o,deliveryTimeInMinutes:r,collectionTimeInMinutes:a}=e;if(r!==void 0){const i=Ox(r,t),l=Ox(a||0,i);return mC(l)?void 0:{type:"fixed",...Xx(i,l)&&{startDate:i},endDate:l}}if(n)return{type:"fixed",...(o?Xx(o,n):!1)&&{startDate:o},endDate:n}},m4=e=>{const n=Ni(),{deliveryEndDate:o,deliveryStartDate:r,deliveryTimeInMinutes:a,collectionTimeInMinutes:i}=e;if(a!==void 0)return i?a<1440?{type:"relative",maxDays:Math.ceil(i/1440)}:{type:"relative",minDays:Math.ceil(a/1440),maxDays:Math.ceil(a/1440+(i||0)/1440)}:{type:"relative",maxDays:Math.floor(a/1440)};if(o)return mC(o)?sP(e):{type:"relative",...(r?Xx(r,o):!1)&&{minDays:kI(r,n)},maxDays:kI(o,n)}},_He=e=>({deliveryStartDate:e.slotDateTimeISO,deliveryEndDate:e.slotEndDateTimeISO}),bHe=e=>{const{onDemandProperties:t}=e;return{deliveryTimeInMinutes:t.deliveryTimeInMinutes,collectionTimeInMinutes:t.collectionTimeInMinutes}},xHe=(e,t)=>{let n;if(u4(t)?n=_He(t):p4(t)&&(n=bHe(t)),!!n)return e==="FIXED"?sP(n):m4(n)},h4=(e,t)=>{switch(e.type){case"fixed":{const{startDate:n,endDate:o}=e;if(n){const r=HH(n,o)?aC:Sr;return t.formatMessage("delivery.fixed.date.format.full",{startDate:gt(n,r),endDate:gt(o,Sr)})}return Nd(o)?t.formatMessage("delivery.relative.date.today"):ng(o)?t.formatMessage("delivery.relative.date.tomorrow"):t.formatMessage("delivery.fixed.date.format.short",{date:gt(o,Sr)})}case"relative":{const{minDays:n,maxDays:o}=e;return n?t.formatMessage("delivery.relative.date.format.full",{minDays:n,maxDays:o}):o===0?t.formatMessage("delivery.relative.date.today"):o===1?t.formatMessage("delivery.relative.date.tomorrow"):t.formatMessage("delivery.relative.date.format.short",{days:o})}default:return""}},AHe=(e,t,n)=>{if(!t)return"";const o=xHe(e,t);return o?h4(o,n):""},RHe=(e,t,n)=>{if(!t||!e)return"";const o=e==="FIXED"?sP(t):m4(t);return o?h4(o,n):""},g4=(e,t,n,o)=>{const r=AHe(e,t,o);return r?o.formatMessage("carriers-slot-booking.slot-title",{carrierName:n,additionalInfo:r}):n},DHe=e=>{if(u4(e)){const t=e.slotEndDateTimeISO.split("T")[0];return{SLOT_TYPE:eP,INTERVAL_TIME_ZONE_ID:e.timeZoneId,INTERVAL_START:e.slotDateTimeISO,INTERVAL_END:e.slotEndDateTimeISO,INTERVAL_START_DATE:t||"",IS_AVAILABLE:e.attributes.includes("AVAILABLE"),...e.attributes.includes("AVAILABLE")&&{DELIVERY_PRICE_AMOUNT:e.deliveryPrice.amount,DELIVERY_PRICE_CURRENCY:e.deliveryPrice.currency}}}else if(p4(e)){const t="1",{collectionTimeInMinutes:n}=e.onDemandProperties;return{SLOT_TYPE:Qa,PRICE_DISPLAYED:e.deliveryPrice.amount,PRICE_CURRENCY:e.deliveryPrice.currency,DELIVERY_TIME_IN_MINUTES:`${e.onDemandProperties.deliveryTimeInMinutes}`,SEQUENCE:t,...n&&{COLLECTION_TIME_IN_MINUTES:`${n}`}}}return{}},E4=se("SLOTS_ANALYTICS_SEEN"),OHe=e=>({type:"API",payload:{url:"/v2/slots/analytics/seen",...E4,service:"ecomslots",pathPrefix:{client:"/api/ecomslots",server:"/core-api"},options:{method:"POST",body:{...e}}}}),PHe={seenSlots:OHe,types:{SLOTS_ANALYTICS_SEEN:E4}},NHe=D("sl.df"),LHe=({seenSlots:e})=>async(t,n)=>{const o=n(),r=NHe(o),a=e?.length;r&&a&&await t(PHe.seenSlots({seenSlots:e}))},Zx={seenSlots:LHe},kHe=e=>{const t=e.match(/[+-]\d{2}:\d{2}$/);if(t)return t[0]},f4=e=>{const t="deliveryPrice"in e?e.deliveryPrice.amount:void 0,n="deliveryPrice"in e?e.deliveryPrice.currency:void 0,o=kHe(e.slotDateTimeISO),r="slotEndDateTimeISO"in e?e.slotEndDateTimeISO:e.endTimeISO;return{SLOT_INTERVAL_START:LI(e.slotDateTimeISO),SLOT_INTERVAL_END:LI(r),IS_AVAILABLE:e.attributes.includes(Ig),SLOT_TYPE:eP,...t?{DELIVERY_PRICE_AMOUNT:t}:{},...n?{DELIVERY_PRICE_CURRENCY:n}:{},...o?{SLOT_INTERVAL_TIME_OFFSET:o}:{}}},jHe=D("sv.sl"),MHe=D("sv.sl.vb"),wHe=D("sv.sl.def"),FHe="slotGroup",BHe=Y(wHe,e=>e?vp:_h),UHe=e=>{const n=e.router.location?.query?.[FHe];return n!==vp&&n!==_h?null:n},dm=Y(jHe,MHe,BHe,UHe,(e,t,n,o)=>{if(!(!e||t))return o||n}),Ed="slot-booked",y4="grocery",Iv=`${Ed}=true`,nP=`${Ed}=${y4}`,Jx="page-reloaded",$r="saverslots",GHe="date",$He="SLOT_BOOKING_PAGE",HHe="SEASONAL_SLOT_LINK",VHe="SLOT_BOOKING_PAGE_TEST",WHe="SLOT_BOOKING_PAGE_TEST_2",YHe={id:"check-slots",title:"delivery.type.name.cnc",subtitle:"carriers-selection.customer.collection.title",iconDescription:"Collection",iconUrl:"images/300x300.png",slotTimesDisplayMode:"FIXED",view:tP,type:Il},qHe=250,BB=8,ad=(e,t)=>{if(!(!e||!t))return qe(e,qe.ISO_8601).tz(t).format()},ml=e=>qe.parseZone(e).format("YYYYMMDD"),I4=e=>qe.parseZone(e).format("YYYY-MM-DD"),KHe=/\[.*]/,Fn=e=>e?.replace(KHe,""),eA=(e,t)=>ml(Fn(e))!==ml(Fn(t)),zHe=(e,t)=>{if(!e||!t)return[];const n=e.endOf("day"),o=t.endOf("day"),r=Math.round(o.diff(n,"days",!0)),a=[];for(let i=0;i<=r;i+=1)a.push(e.clone().add(i,"days"));return a},UB=(e,t)=>{const n=Vt.parseZone(e),o=Vt(t,"HH:mm").utcOffset(n.utcOffset(),!0);return n.set({hour:o.hour(),minutes:o.minutes()})},QHe=(e,t)=>{const n=Vt.parseZone(Fn(e.localizedStartTime)),o=Vt.parseZone(Fn(t.localizedEndTime));if(n.isSame(o)){const r=Vt.parseZone(Fn(e.localizedEndTime)),a=Vt.parseZone(Fn(t.localizedEndTime));return r.valueOf()-a.valueOf()}return n.valueOf()-o.valueOf()},XHe=e=>e.partId===$r,S4=(e,t,n)=>{const o=xE(e,t),r=n.find(({intervals:l})=>l.some(c=>c.intervalId===o)),i=eA(e,t)&&r&&r?.partId!==$r;return!r?.partId||i?null:r.partId},ZHe=(e,t,n)=>{const o=Vt.parseZone(e.start);if(XHe(t)){const l=Vt.parseZone(e.end);return Vt.duration(l.diff(o)).asMinutes()>=n}const r=t,a=UB(e.end,r.start),i=UB(e.end,r.end);return o.isBetween(a,i,null,"[)")},xE=(e,t)=>{const n=Vt.parseZone(Fn(e)).format("HHmm"),o=Vt.parseZone(Fn(t)).format("HHmm");return`${n}-${o}`},JHe=e=>{const t=new Map;return e.forEach(n=>{const o=xE(n.localizedStartTime,n.localizedEndTime);t.has(o)||t.set(o,{intervalId:o,start:Fn(n.localizedStartTime),end:Fn(n.localizedEndTime),order:t.size,timeZoneId:n.timeZoneId})}),[...t.values()].sort((n,o)=>n.intervalId.localeCompare(o.intervalId)).map((n,o)=>({...n,order:o}))},eVe=e=>e.map(({partId:t,start:n,end:o})=>({partId:t,start:n,end:o,intervals:[]})),tVe=(e,t,n)=>{const o=JHe(e),r=eVe(t);return o.forEach(a=>{for(let i=0;i<r.length;i+=1){const l=r[i];if(l&&ZHe(a,l,n)){l.intervals.push(a);return}}}),r.map(({partId:a,intervals:i})=>({partId:a,intervals:i}))},sVe=(e,t)=>{const n=new Map;for(const o of e){const r=Vt.utc(o.slotWindow.startTime).tz(t),i=Vt.utc(o.slotWindow.endTime).tz(t).diff(r,"minutes"),l=`${r.day()}-${r.hour()}-${r.minute()}-${i}`;n.has(l)||n.set(l,[]),n.get(l)?.push(o)}return n},nVe=(e,t,n,o)=>{const r=t.diff(e,"minutes");for(const a of[1,2]){const i=e.clone().add(a,"weeks"),l=`${i.day()}-${i.hour()}-${i.minute()}-${r}`,c=n.get(l);if(!c)continue;const d=c.find(u=>Vt.utc(u.slotWindow.startTime).tz(o).isSame(i,"minute"));if(d?.deliveryPrice)return d.deliveryPrice}},oVe=(e,t,n,o)=>{const r=Vt.utc(e).tz(n),a=Vt.utc(t).tz(n);return Vt.duration(a.diff(r)).asMinutes()<o?r.isBefore(r.clone().set({hour:20,minute:30}))?7:6:r.isBefore(r.clone().set({hour:18,minute:0}))?5:4},C4=se("GET_DEFAULT_SHIPPING_GROUP_TYPE"),rVe=(e,t)=>{let n="";if(t){const o=new URLSearchParams;o.set("deliveryDestinationId",t),n=`?${o.toString()}`}return{type:"API",payload:{url:`/v1/default-shipping-group/${e}${n}`,service:"checkoutgroups",pathPrefix:{client:"/api/checkout-groups",server:"/core-api"},...C4}}},Uy={getDefaultShippingGroupType:rVe,types:{GET_DEFAULT_SHIPPING_GROUP_TYPE:C4}},aVe={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null,error:null,value:null},iVe=(e=aVe,t)=>{switch(t.type){case Uy.types.GET_DEFAULT_SHIPPING_GROUP_TYPE.PENDING:return{...e,isFetching:!0};case Uy.types.GET_DEFAULT_SHIPPING_GROUP_TYPE.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload||null};case Uy.types.GET_DEFAULT_SHIPPING_GROUP_TYPE.SUCCESS:{const{defaultShippingGroupType:n}=t.payload.responseData;return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),value:n}}default:return e}},lVe=({data:e})=>e.delivery.defaultShippingGroup.value,cVe="shippingGroup",dVe=e=>e.router.location.search,um=Y([pE,nu,Zg,PR,dVe],(e,t,n,o,r)=>{if(!e&&!t)return o;const a=new URLSearchParams(r).get(cVe);return a&&!t?a:n}),pm=Y([nu,lVe,PR,um],(e,t,n,o)=>e?t===o:n===o),uVe={error:null,isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null,data:null},pVe={CARRIER:"CARRIER"},Sv=({data:e})=>e.delivery.slotbooking?.data?.carriers||[],oP=e=>{const t=e.router.location?.search||"";return Qe.parse(t)?.carrierId??null},mVe=e=>e.data.delivery.slotsConfiguration.data,hVe=()=>Vt().format("YYYY-MM-DDTHH:mm:ss.SSS[Z]"),v4=e=>!!e&&"onDemandProperties"in e,T4=({standardSlots:e,onDemandSlots:t,carriers:n})=>{const o=[...new Set(n.map(({carrierId:a})=>a))].map(a=>[a,[],[]]);[e,t].forEach((a,i)=>{a.forEach(l=>{const c=o.find(([d])=>d===l.carrierId);c&&c[i+1].push(l)})});const r=o.filter(([,a,i])=>!!a.length||!!i.length);return Object.fromEntries(r.map(([a,i,l])=>[a,{standardSlots:i,onDemandSlots:l}]))},_4=({groupedSlots:e,selectedCarrier:t,carriersEnabled:n,standardSlots:o,onDemandSlots:r})=>{if(!n)return{standardSlots:o,onDemandSlots:r};const a={standardSlots:[],onDemandSlots:[]};return t?.type===xa&&e[t.id]||a},ur=({data:e})=>e.delivery.slotbooking,rP=Y(ur,({data:e})=>e?.days),gVe=Y(rP,e=>{if(!e)return[];let t=!1;return e.filter(n=>t||n.hasAnyAvailableSlot?(t=!0,!0):!1)}),Eu=Y(ur,({data:e})=>e?.partsOfDay),aP=Y(ur,({data:e})=>e?.slots||[]),iP=Y(aP,e=>e.filter(({attributes:t})=>t?.includes(Ig))),AE=Y(ur,({data:e})=>e?.onDemandSlots||[]),EVe=Y(AE,e=>!!e.length),lP=Y([iP,AE,Sv],(e,t,n)=>T4({standardSlots:e,onDemandSlots:t,carriers:n})),fVe=Y([aP,AE,Sv],(e,t,n)=>T4({standardSlots:e,onDemandSlots:t,carriers:n})),yVe=Y([oP,lP],(e,t)=>!e||!t?.[e]?null:t[e].standardSlots[0]||t[e].onDemandSlots[0]);D("sl.c");const b4=D("sv.sl.sti"),cP=Y(D("sv.sl"),D("sv.sl.vb"),(e,t)=>e&&!t),dP=Y(Eu,(e=[])=>e?.filter(({partId:t})=>t!==$r).some(({intervals:t})=>t.length)),uP=Y(cP,Eu,dP,(e,t,n)=>{if(!e||!t)return!1;const o=t.find(({partId:a})=>a===$r),r=o?o.intervals.length>0:!1;return n&&r});Y(cP,Eu,dP,(e,t,n)=>{if(!e||!t)return!1;const o=t.find(({partId:a})=>a===$r),r=o?o.intervals.length>0:!1;return!n&&r});const IVe=Y(cP,Eu,dm,dP,(e,t,n,o)=>!t||!o?!1:t.find(({partId:a})=>a===$r)&&e?n!==vp:!0),SVe=Y(Eu,uP,dm,(e,t,n)=>{if(!t)return e;const o=n===vp;return e?.filter(({partId:r})=>r===$r?o:!o)}),RE=e=>Y(mVe,t=>!t||!e?!1:t.shippingGroups?.find(o=>o.shippingGroupType===e)?.slotDisplayMode===pVe.CARRIER),Xi=e=>{const t=um(e);return RE(t)(e)},mm=Y(ur,e=>e.debouncedSlotListingRequests>0||e.pendingSlotListingRequests>0),pP=Y(iP,EVe,(e,t)=>!e.length&&!t?!1:e.length?e.some(n=>n.attributes.includes("AVAILABLE")):t),hm=Y([Sv,lP,mm,ur,pP],(e,t,n,o,r)=>{if(n||!o.data||!r)return[];const a=e.filter(i=>i.carrierId in t).map(i=>{const l=[...t[i.carrierId].standardSlots,...t[i.carrierId].onDemandSlots];return{id:i.carrierId,title:i.name,deliveryPrice:vHe(l),type:xa,iconUrl:i.iconUrl,iconDescription:i.iconDescription,slotTimesDisplayMode:i.slotTimesDisplayMode,view:i.slotBookingComponent}});return a.push(YHe),a}),x4=Y([hm],e=>e.length?e[0]:null),Ml=Y([oP,hm,x4],(e,t,n)=>e?t.find(o=>o.id===e)??null:n),A4=Y([Xi,Ml],(e,t)=>e&&t?.view!==tP),Cv=Y([lP,Ml,Xi,iP,AE],(e,t,n,o,r)=>_4({groupedSlots:e,selectedCarrier:t,carriersEnabled:n,standardSlots:o,onDemandSlots:r})),CVe=Y([fVe,Ml,Xi,aP,AE],(e,t,n,o,r)=>_4({groupedSlots:e,selectedCarrier:t,carriersEnabled:n,standardSlots:o,onDemandSlots:r})),R4=Y([CVe],({standardSlots:e})=>{const t={};for(const n of e){const o=`${n.slotDayId}|${n.slotPartId}|${n.slotIntervalId}`;t[o]=n.slotId}return t}),mP=Y([Cv],({standardSlots:e})=>e.filter(t=>t.slotPartId)),hP=Y(ur,({data:e})=>e?.seasonalSlotPeriods||[]),gP=Y(Vi,qi,(e,t)=>{if(!e||e.deliveryDestinationId!==t)return;const n=e?.slotId,o=e?.start,r=e?.end,a=xE(o,r);if(!(!n||!o||!r||!a))return{slotId:n,slotDayId:ml(Fn(e?.start)),slotDateTimeISO:o,slotEndDateTimeISO:r,slotIntervalId:a,slotPartId:null,timeZoneId:e.timeZoneId,carrierId:e?.carrierId||"",attributes:[],slotType:e.slotType,deliveryPrice:{amount:"0",currency:""}}}),EP=Y([Cv],e=>e.onDemandSlots),vVe=Y([EP],e=>!!e.length),TVe=Y(ur,({data:e})=>e?.checkoutGroupsChanged||!1);Y(ur,e=>e.didInvalidate);const DE=Y(ur,mm,(e,t)=>!e.lastUpdated||t),D4=Y(ur,mm,(e,t)=>!t&&e.fetchError),_Ve=Y(Eu,e=>{if(!e)return null;const t=e.find(n=>n.intervals.length>0);return t?t.intervals[0].timeZoneId:null}),bVe=Y(ur,e=>e.successRequestParams),xVe=Y(ur,e=>e.persistedPreviousAddress);Y(ur,({data:e})=>e?.slotListingId);const AVe=Y(Ys,mP,(e,t)=>e===pt.vanDelivery.method?t.filter(o=>o.attributes?.includes("GREEN")&&o.attributes?.includes("AVAILABLE")).map(o=>o.slotId):[]),RVe=(e,t)=>({partId:`part${t}`,start:Ze(e,`fulfillment-times-of-day-start-${t}`),end:Ze(e,`fulfillment-times-of-day-end-${t}`)}),DVe=e=>Number(e.retailerSettings["slot-booking-saver-slots-minimum-length-in-minutes"]),OVe=e=>{const t=parseInt(Ze(e,"fulfillment-times-of-day"),10),n=[];for(let o=1;o<=t;o+=1)n.push(RVe(e,o));return n},O4=e=>Number(e.retailerSettings["fake-slot-lead-time-minutes"]),PVe=(e,t)=>`${t?`${t}-`:""}${e}`,Or=()=>{const e=F(),[t,n]=h.useState(new Set),o=f(dm),r=He(),a=f(Ct),i=f(ei),{onDemandSlots:l}=f(Cv),c=f(RC),d=L(),u=p=>{const{type:g,title:E}=p,y=g===xa&&p.deliveryPrice?a4(p.deliveryPrice,d,r):"";return{carrierName:g===xa?E:d.formatMessage(E),priceSubtitle:y}};return{carrierSelectionClicked:({item:p})=>{const{carrierName:g,priceSubtitle:E}=u(p);return e(U.analyticsEvent({type:Ve.CARRIER_SELECTION_CLICKED,ORDER_ID:a,RETAILER_CUSTOMER_ID:i,CARRIER_NAME:g,PRICE:E}))},continueCheckoutButtonClicked:()=>e(U.analyticsEvent({type:Ve.CONTINUE_CHECKOUT_BUTTON_CLICKED,ORDER_ID:a})),chooseCarrierModalDisplayed:()=>e(U.analyticsEvent({type:Ve.CHOOSE_CARRIER_MODAL_DISPLAYED,ORDER_ID:a})),selectPickUpPointButtonClicked:()=>e(U.analyticsEvent({type:Ve.SELECT_PICK_UP_POINT_BUTTON_CLICKED,ORDER_ID:a})),carrierSelectionCardImpression:({items:p})=>{const g=p.map((E,y)=>{const{carrierName:I,priceSubtitle:S}=u(E);return{CARRIER_NAME:I,PRICE:S,POSITION:y.toString()}});return e(U.analyticsEvent({type:Ve.CARRIER_SELECTION_CARD_IMPRESSION,impressions:g}))},selectExternalCollectionPointClicked:p=>{e(U.analyticsEvent({type:Ve.SELECT_PICK_UP_POINT_BUTTON_CLICKED,ORDER_ID:a,POSTCODE:p?.address_details?.post_code,EXTERNAL_COLLECTION_POINT_ID:p.name}))},invalidShippingMethodModalDisplayed:()=>e(U.analyticsEvent({type:Ve.SHIPPING_METHOD_NOT_VALID_MODAL_DISPLAYED,ORDER_ID:a})),selectShippingMethodButtonClicked:()=>e(U.analyticsEvent({type:Ve.SELECT_SHIPPING_METHOD_BUTTON_CLICKED,ORDER_ID:a})),basketChangedModalDisplayed:({addressId:p})=>e(U.analyticsEvent({type:Ve.CHANGE_DELIVERY_METHOD_MODAL_DISPLAYED,ORDER_ID:a,ADDRESS_ID:p})),basketChangedModalConfirmButtonClicked:()=>e(U.analyticsEvent({type:Ve.CONTINUE_AND_SEE_TROLLEY_BUTTON_CLICKED,ORDER_ID:a})),basketChangedModalCancelButtonClicked:()=>e(U.analyticsEvent({type:Ve.CHANGE_DELIVERY_METHOD_CANCEL_BUTTON_CLICKED,ORDER_ID:a})),courierSlotImpression:p=>{if(p){const g=DHe(p);e(U.analyticsEvent({type:Ve.SLOT_IMPRESSION,impressions:[g]})),e(Zx.seenSlots({seenSlots:p.slotId?[p.slotId]:[]}))}},standardSlotsImpressionForGrid:p=>{const g=new Set,E=p.filter(({slotDayId:y})=>{const I=PVe(y,o);return t.has(I)?!1:(g.add(I),!0)});if(E.length>0){const y=E.map(f4);e(U.analyticsEvent({type:Ve.SLOT_IMPRESSION,impressions:y})),n(I=>new Set([...I,...g]))}},dataFeedForGrid:p=>{const g=[...l.map(E=>E.slotId),...p];e(Zx.seenSlots({seenSlots:g}))},expressCollectionSlotImpression:p=>{e(U.analyticsEvent({type:Ve.SLOT_IMPRESSION,impressions:[p]}))},deliveryDetailsModalDisplayed:p=>e(U.analyticsEvent({type:Ve.DELIVERY_DETAILS_MODAL_DISPLAYED,...p})),deliveryOptionsViewed:p=>e(U.analyticsEvent({type:Ve.DELIVERY_OPTIONS_VIEWED,...p})),deliveryAssetChanged:p=>e(U.analyticsEvent({type:Ve.DELIVERY_ASSET_CHANGED,...p})),smallOrderChargeSlotImpression:p=>{e(U.analyticsEvent({type:Ve.SLOT_IMPRESSION,impressions:[{chargeInfo:p}]}))},defaultDeliveryDestinationIdAvailable:()=>{e(U.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{DEFAULT_DELIVERY_DESTINATION_ID_AVAILABLE:c}}))}}},fP="invalidSlot",NVe=v.span`
    vertical-align: middle;
`,LVe=v(Q)`
    flex-grow: 1;
`,GB=v(x)`
    flex: 1 1 0;
`,P4=()=>{const{formatMessage:e}=L(),t=F(),n=Ge(),o=f($e(fP)),r=f(D("m.la.h")),{invalidShippingMethodModalDisplayed:a,selectShippingMethodButtonClicked:i}=Or(),l=()=>t(J.closeModal()),c=()=>{i(),t(J.closeModal());const d=Tr({inCheckoutWalk:!0});n(d)};return h.useEffect(()=>{o&&a()},[o]),s.jsx(B,{isOpen:o,onRequestClose:l,asBottomSheet:!0,children:s.jsxs(B.ModalForm,{"data-test":"invalid-slot-modal",children:[s.jsx(B.Header,{align:"left",children:s.jsxs(ee,{as:"h1",children:[s.jsx(pe,{"data-test":"invalid-slot-modal-info-icon",name:"info_default",width:24,height:24,verticalAlign:"middle",className:"salt-m-r--1"}),s.jsx(NVe,{children:e("slot-invalid-view.title")})]})}),s.jsx(B.Body,{children:e("slot-invalid-view.content")}),s.jsx(B.Footer,{align:r?"left":"center",className:"salt-gap-x--2",children:s.jsxs(LVe,{direction:"column",directionSmUp:"row-reverse",gap:["sm"],children:[s.jsx(GB,{intent:"primary",onClick:c,fill:!0,"data-test":"invalid-slot-modal-confirm-button",children:s.jsx(x.Text,{children:e("slot-invalid-view.confirm-button")})}),s.jsx(GB,{intent:"secondary",onClick:l,fill:!0,"data-test":"invalid-slot-modal-cancel-button",children:s.jsx(x.Text,{children:e("slot-invalid-view.cancel-button")})})]})})]})})},N4="LEGACY_ADD_SERVER_SIDE_NOTIFICATIONS",L4="LEGACY_CLEAR_SERVER_SIDE_NOTIFICATIONS",kVe=e=>({type:N4,payload:{serverSideNotifications:e}}),jVe=e=>({type:L4,payload:{serverSideNotifications:e}}),ro={types:{LEGACY_ADD_SERVER_SIDE_NOTIFICATIONS:N4,LEGACY_CLEAR_SERVER_SIDE_NOTIFICATIONS:L4},LEGACY_addServerSideNotifications:kVe,LEGACY_clearServerSideNotifications:jVe},an={AGE_CONFIRMATION_COOKIE:"ageConfirmed",NOTIFIED_BOOKSLOT:"notified_bookslot",NOTIFIED_EXPIRY:"notified_expiry",NOTIFIED_LOGIN:"notified_login",OPTANON_CONSENT:"OptanonConsent",PRIVACY_ACCEPTED:"privacyAccepted",SELECTED_PLAN_ID:"selectedPlanId",SSO_LOGIN_COMPLETE:"sso.loginComplete",SSO_REGISTRATION_COMPLETE:"sso.registrationComplete"},vv=D("1trust");D("ot.cstm");const k4=se("UPDATE_COOKIE_CONSENT"),MVe=e=>()=>uce("/cookie-consent").then(t=>t.json()).then(t=>e({type:k4.SUCCESS,payload:t})),j4={actionTypes:{UPDATE_COOKIE_CONSENT:k4},updateCookieConsent:MVe},wVe={},FVe=(e=wVe,t)=>{switch(t.type){case j4.actionTypes.UPDATE_COOKIE_CONSENT.SUCCESS:return t.payload;default:return e}},BVe=e=>e.cookieConsent,yP=e=>Y(BVe,vv,(t={},n)=>n?t[e]||!1:!0),IP=yP("language"),UVe=yP(an.NOTIFIED_BOOKSLOT),GVe=yP(an.NOTIFIED_LOGIN),fn=({basePath:e="",queryString:t=""}={})=>{const n=t?`?${t}`:"";return`${e===""?"/":e}${n}`},Yo=({basePath:e="",queryString:t=""}={})=>{const n=t?`?${t}`:"";return`${e}/login${n}`},Pr=({basePath:e=""}={})=>`${e}/settings`,jd=()=>`${Pr()}/login-details`,Md=({basePath:e="",queryString:t=""}={})=>{const n=t.length?`?${t}`:"";return`${Pr({basePath:e})}/user-details${n}`},_n={SAVING:"SAVING",LOYALTY:"LOYALTY",DELIVERY:"DELIVERY"},$Ve={PROMOTION_BY_PAYMENT_METHOD_APPLIED:"PROMOTION_BY_PAYMENT_METHOD_APPLIED",LOYALTY_POINTS_TO_BE_REFUNDED:"LOYALTY_POINTS_TO_BE_REFUNDED",LOYALTY_POINTS_REMOVED:"LOYALTY_POINTS_REMOVED"},lp={PROMOTIONS_AVAILABLE:"PROMOTIONS_AVAILABLE",SELECTED_PROMOTION_CHANGED:"SELECTED_PROMOTION_CHANGED",SELECTED_PROMOTION_REPLACED_BY_VOUCHER:"SELECTED_PROMOTION_REPLACED_BY_VOUCHER",...$Ve},HVe={CHECKOUT_WALK:"checkout-walk"},eS={BASKET:"basket",ORDERS:"orders"},fd={RETURN:"RETURN",CANCEL:"CANCEL",SAVE:"SAVE"},Gu={GENERAL_DISCOUNT_LIMITED:"general_discount_limited",GENERAL_DISCOUNT_ANY:"general_discount_any",DELIVERY_DISCOUNT_LIMITED:"delivery_discount_limited",DELIVERY_DISCOUNT_ANY:"delivery_discount_any",LOYALTY_DISCOUNT_LIMITED:"loyalty_discount_limited",LOYALTY_DISCOUNT_ANY:"loyalty_discount_any"},hc="none-exclusive",VVe="pre-applied",fu=e=>e.forEach(t=>{switch(t.type){case lp.LOYALTY_POINTS_REMOVED:Z.warning("payment.promotion.loyalty.removal.notification");break;case lp.LOYALTY_POINTS_TO_BE_REFUNDED:Z.warning("payment.promotion.loyalty.refund.notification");break;case lp.PROMOTION_BY_PAYMENT_METHOD_APPLIED:Z.success("payment.promotion.success.notification");break}}),WVe=(e,t="basket.add.item.error")=>{switch(e){case"basket-ws-70":return"max.quantity.in.trolley.error";default:return t}},YVe=(e,t="basket.add.item.error")=>{switch(e){case"EXCEEDED_MAX_QUANTITY":case"LIMITED_AVAILABILITY":return"fop.max.quantity.toast.generic";case"OUT_OF_STOCK":return"fop.oos.toast";default:return t}},Tv=({productId:e,quantity:t,maxQuantityReached:n})=>({productId:e,quantity:{quantityInBasket:t,maxQuantityReached:n}});function M4(e){return!!e?.promotionId}function SP(e){return!!e?.promotionId}const qVe=(e={})=>async(t,n)=>{const{sendAnalytics:o=!1,withUpdatedItemsResponse:r,updatedItems:a,fetchAllocatedPaymentChecks:i,location:l,productGroupingType:c}=e,d=n(),u=l||d?.router?.location,p=await t(Iue(u)),g=e?.cartType||p;try{const y=(await t(mn.getCart({fetchAllocatedPaymentChecks:i,sendAnalytics:o,withUpdatedItemsResponse:r,updatedItems:a,cartType:g,productGroupingType:c,location:u})))?.payload?.responseData;return y?bi(y):null}catch{return Z.error("toast.notification.generic.error"),null}},KVe=({fetchAllocatedPaymentChecks:e,appliedPaymentCheckId:t}={fetchAllocatedPaymentChecks:!1,appliedPaymentCheckId:void 0})=>async n=>{try{const r=(await n(mn.getCheckoutCart({fetchAllocatedPaymentChecks:e,appliedPaymentCheckId:t})))?.payload?.responseData;return r?bi(r):null}catch{return Z.error("toast.notification.generic.error"),null}},zVe=({paymentMethodGroup:e,fetchAllocatedPaymentChecks:t=!1,appliedPaymentCheckId:n=void 0})=>async o=>{try{const a=(await o(mn.updateCheckoutCart({paymentMethodGroup:e,fetchAllocatedPaymentChecks:t,appliedPaymentCheckId:n})))?.payload?.responseData?.pricingNotifications;a&&fu(a);return}catch{Z.error("toast.notification.generic.error")}},Yt={getBasket:qVe,getCheckoutBasket:KVe,updateCheckoutCart:zVe},dt={PAY_NOW:"PAY_NOW",CASH_ON_DELIVERY:"CASH_ON_DELIVERY",B2B_DEFERRED_PAYMENT:"B2B_DEFERRED_PAYMENT",INSTALMENTS:"PAYMENTS_INSTALMENTS",L_PAY:"L_PAY",KAKAOPAY:"KAKAOPAY",NAVERPAY:"NAVERPAY",LOYALTY:"LOYALTY",UNKNOWN:"UNKNOWN"},at={UNKNOWN:"UNKNOWN",CARDS:"CARDS",PAYPAL:"PAYPAL",APPLE_PAY:"APPLE_PAY",GOOGLE_PAY:"GOOGLE_PAY",VISA_MOBILE:"VISA_MOBILE",INVOICE:"INVOICE",BLIK:"BLIK",BANK_TRANSFER:"BANK_TRANSFER",CARD_INSTALMENTS:"CARD_INSTALMENTS",CASH_ON_DELIVERY:"CASH_ON_DELIVERY",L_PAY:"L_PAY",KAKAOPAY:"KAKAOPAY",NAVERPAY:"NAVERPAY"},QVe={AT_CHECKOUT:"AT_CHECKOUT"},kr={AMEX:"AMEX",AMERICAN_EXPRESS:"AMERICAN EXPRESS",CB:"CB",DISCOVER:"DISCOVER",MAESTRO:"MAESTRO",MASTERCARD:"MASTERCARD",MASTERCARD_DEBIT:"MASTERCARD_DEBIT",VISA:"VISA",VISA_DEBIT:"VISA_DEBIT",VISA_ELECTRON:"VISA_ELECTRON",VISA_PURCHASING:"VISA_PURCHASING",PAYMENT_CARD:"PAYMENT_CARD",VISA_PHONE:"VISA_PHONE"},CP={PayPal:"PayPal",Datacash:"Datacash",Bambora:"Bambora",MammockPsp:"MammockPsp",CasinoHub:"CasinoHub",Mastercard:"Mastercard",Conexflow:"Conexflow",Braintree:"Braintree"},vP={Braintree:"Braintree",MammockPsp:"MammockPsp",Payex:"Payex",IcaInvoice:"IcaInvoice",Primer:"Primer",Autopay:"Autopay",Toss:"Toss"},w4={FakePsp:"FakePsp",Unknown:"Unknown"},XVe={DATACASH:"DATACASH"},ZVe={...CP,...vP},ys={...CP,...vP,...w4},$B=(e,t)=>{const[n]=Object.entries(e).find(([,o])=>o===t)||[];return n};class bh{rawId;constructor(t){this.rawId=t}get id(){return bh.isAPsp(this.rawId)?this.rawId:w4.Unknown}get name(){return $B(HB,this.id)}get activeName(){return $B(VB,this.id)}isKnown(){return this.id in ZVe}isSavedWallet(){return this.id in CP}isAddCardExternalRedirect(){return this.id===ys.Mastercard&&!D("pay.mcdhf")}static fromName(t){return new bh(HB[t]||t)}static fromActiveName(t){return new bh(VB[t]||t)}static isAPsp(t){return t in ys}}const HB={PAYPAL:ys.PayPal,DATACASH:ys.Datacash,BRAINTREE_PSPWEB:ys.Braintree,BAMBORA:ys.Bambora,MAMMOCK_PSP:ys.MammockPsp,BRAINTREE:ys.Conexflow,COURGETTE:ys.CasinoHub,PAYEX:ys.Payex,ICE_INVOICE:ys.IcaInvoice,MASTERCARD:ys.Mastercard,UNKNOWN:ys.Unknown,FAKE_PSP:ys.FakePsp,PRIMER:ys.Primer,AUTOPAY:ys.Autopay,TOSS:ys.Toss},VB={PAYPAL:ys.PayPal,DATACASH:ys.Datacash,BRAINTREE_PSPWEB:ys.Braintree,BRAINTREE:ys.Conexflow,BAMBORA:ys.Bambora,MAMMOCK_FAKE_PSP:ys.MammockPsp,COURGETTE:ys.CasinoHub,PAYEX:ys.Payex,ICEINVOICE:ys.IcaInvoice,MASTERCARD:ys.Mastercard,UNKNOWN:ys.Unknown,FAKE_PSP:ys.FakePsp,PRIMER:ys.Primer,AUTOPAY:ys.Autopay,TOSS:ys.Toss},{denormalize:JVe}=Al,{decoratedOrderSchema:e2e}=xl,As=Y(e=>Ki(e,e.data.orders.current.order.order),e=>e.data.orders.current.order,(e,t)=>({...t,order:e}));Y(As,({order:e})=>e?.slotType===Qa&&e?.deliveryMethod===pt.clickAndCollect.method);const t2e=Y(As,({order:e})=>e?.slotType===Qa&&e?.deliveryMethod===pt.vanDelivery.method),s2e=Y(As,({order:e})=>!!e?.dates?.confirmOrderChangesBy),_v=(e,t)=>Ct(e)===t,OE=Y(As,({order:e})=>e&&{deliveryStartDate:e.dates.deliveryStartDate,deliveryEndDate:e.dates.deliveryEndDate,addressNickName:e.addressNickName,addressNotes:e.addressNotes,address:e.address,additionalInformation:e.additionalInformation,timeZoneId:e.dates.timeZoneId,deliveryType:e.deliveryType,deliveryMethod:e.deliveryMethod,slotType:e.slotType,shippingGroupType:e.shippingGroupType,carrierId:e.carrierId,externalAddress:e.externalAddress}),F4=Y(OE,e=>e?.deliveryStartDate),n2e=Y(As,e=>e.order&&{confirmOrderChangesBy:e.order.dates.confirmOrderChangesBy,orderId:e.order.orderId,timeZoneId:e.order.dates.timeZoneId}),Nc=Y(As,({order:e})=>e&&{orderId:e.orderId,totalItems:e?.totalItems,charges:e?.charges,buybacks:e?.buybacks,orderLevelPromotions:e?.orderLevelPromotions,orderTotals:e?.orderTotals,savings:e?.orderTotals.promoSavings,itemsRetailPrice:e?.orderTotals.retailPrice,depositsPrice:e?.orderTotals.depositsPrice,environmentalHandlingPrice:e?.orderTotals.environmentalHandlingPrice,finalPrice:e?.orderTotals.finalPrice,totalPrice:e?.orderTotals.totalPrice,vouchersSavingsPrice:e?.orderTotals?.vouchersSavingsPrice,taxComponents:e?.orderTotals.taxesTotals.taxes.components,appliedVouchers:e?.appliedVouchers||[],paymentInfo:e?.paymentInfo,itemPriceAfterPromos:e?.orderTotals.itemPriceAfterPromos,loyalty:e?.loyalty,smallOrderChargeThresholds:e?.smallOrderChargeThresholds,paymentMethodSavingsPrice:e?.orderTotals?.paymentMethodPromoSavings,...e?.charges,...e?.buybacks}),o2e=Y(is,e=>({...e,vouchersSavingsPrice:e.totals?.vouchersSavingsPrice,appliedVouchers:e.vouchers||[],depositsPrice:e?.totals?.depositsPrice,environmentalHandlingPrice:e?.totals?.environmentalHandlingPrice,taxesTotals:e?.totals?.taxesTotals,savings:e?.totals?.savingsPrice,paymentMethodSavingsPrice:e?.totals?.paymentMethodSavingsPrice})),TP=Y(Nc,e=>e?.totalItems||0),li=Y(As,ts,(e,t)=>{const n=JVe(e.order,e2e,{product:t});return{...e,order:n}}),wd=Y(As,({order:e})=>e?.loyalty?.earned||null),_P=Y(As,({order:e})=>e?.loyalty?.spent),bP=Y(As,({order:e})=>!!e?.rebookable),r2e=Y(li,({order:e})=>e?.itemsOnCheckout),xP=Y(li,({order:e})=>e?.items),a2e=Y(li,({order:e})=>e?.missingItems),i2e=Y(li,({order:e})=>e?.returnedItems),AP=Y(li,({order:e})=>e?.groupedProducts),bv=Y(li,({order:e})=>e?.sellers);Y(li,({order:e})=>e?.primarySellerId);const l2e=Y(li,({order:e})=>e?.primarySellerName),c2e=Y(li,({order:e})=>e?.substitutedItems?.reduce((t,n)=>(t.push([n,...n.substitutes]),t),[]));Y(li,({order:e})=>e?.substitutedItems);const PE=Y(As,({order:e})=>e?.external),d2e=Y(As,({order:e})=>e?.paymentInfo?.chargeTime===QVe.AT_CHECKOUT),u2e=e=>Y(li,({order:t})=>t?.items?.find(n=>n?.product?.productId===e)?.product?.price?.unit),xv=()=>"/register",p2e=({basePath:e=""}={})=>`${e}/logout`,ed="ORDER_DISCOUNT_SUMMARY",m2e={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null,error:null,data:null,didInvalidateConfirmationData:!1,isCancelled:!1},h2e=(e=m2e,t)=>{switch(t.type){case wo.types.SELECT_SLOT.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null,didInvalidateConfirmationData:!1};case wo.types.SELECT_SLOT.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case wo.types.GET_SLOT_BOOKING_LIMITED_PRODUCTS.ERROR:return{...e,isFetching:!1,fetchError:!0};case wo.types.SET_SELECTED_SLOT:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),didInvalidate:!1,isCancelled:!1,error:null,data:{...t.payload,deliveryPrice:t.deliveryPrice,deliveryType:t.deliveryType,minimumOrder:t.minimumOrder,ecoSlot:t.ecoSlot}};case wo.types.CLEAR_SELECTED_SLOT:return{...e,didInvalidate:!0};case wo.types.CANCEL_SELECTED_SLOT:return{...e,isCancelled:!0};case wo.types.INVALIDATE_SLOTS_CONFIRMATION_DATA:return{...e,didInvalidateConfirmationData:!0};default:return e}},B4=({control:e})=>!e.delivery.slot.didInvalidate&&!e.delivery.slot.isFetching&&!!e.delivery.slot.lastUpdated,g2e=e=>e.control.delivery.slot.data?.deliveryType,E2e=e=>e.control.delivery.slot.data?.deliveryPrice,f2e=e=>e.control.delivery.slot.data?.ecoSlot||!1,NE=e=>e.control.delivery.slot.data?.slot?.minimumCheckoutThreshold,y2e=e=>e.control.delivery.slot.data?.slot?.originalMinimumCheckoutThreshold,Av=({control:e})=>e.delivery.slot.data?.slot?.startTime,Rv=({control:e})=>e.delivery.slot.data?.slot?.type,U4=({control:e})=>e.delivery.slot.data?.slot?.deliveryMethod,G4=({control:e})=>e.delivery.slot.data?.slot?.deliveryTimeInMinutes,$4=({control:e})=>e.delivery.slot.data?.slot?.collectionTimeInMinutes,Dv=({control:e})=>e.delivery.slot.data?.slot?.endTime,gm=({control:e})=>e.delivery.slot.data?.slot?.timeZoneId,RP=({control:e})=>e.delivery.slot.data?.slot?.expiryTime,I2e=({control:e})=>e.delivery.slot.data?.slot?.slotId,S2e=({control:e})=>e.delivery.slot.data?.slot,wl=({control:e})=>e.delivery.slot.data?.confirmationData,C2e=Y(wl,e=>e?.slotRegionId),H4=Y(wl,e=>e?.invalidVouchers||[]),V4=Y(wl,e=>e?.regionChanged??!1),W4=Y(wl,e=>e?.totalChanged??!1),Y4=Y(wl,e=>e?.itemPriceAfterPromos),DP=({control:e})=>e.delivery.slot.data?.slot?.latestUpdateTime,OP=Y(wl,e=>e?.limitedProducts||[]),Ov=Y(wl,e=>e?.draftBasketId),v2e=Y(wl,e=>e?.otherCheckoutGroupsChanged??!1),Pv=({control:e})=>e.delivery.slot.data?.slot?.address,PP=({control:e})=>!!e.delivery.slot.data?.slot?.minimumCheckoutThresholdChanged,NP=e=>e.control.delivery.slot.fetchError,q4=e=>e.control.delivery.slot.error,LE=e=>e.control.delivery.slot.isFetching,T2e=e=>e.control.delivery.slot.didInvalidateConfirmationData,_2e=e=>e.control.delivery.slot.isCancelled,Nv=Y(wl,e=>!!e),K4=Y(Nv,B4,NP,(e,t,n)=>!e&&t&&!n);Y(Rv,U4,Av,Dv,D("md.sl"),(e,t,n,o,r)=>e&&t&&n&&o?su({slotType:e,deliveryMethod:t,start:n,end:o},r):!1);const z4=60,b2e=24*z4,x2e=[{unit:"day",value:b2e},{unit:"hour",value:z4},{unit:"minute",value:1}],Lv=(e,t="long",n=!1)=>{const o=", ",r=(a,i)=>e.formatNumber(a,{style:"unit",unit:i,unitDisplay:t});return a=>{if(!a)return"";const i=[];let l=0;return x2e.forEach(({unit:c,value:d})=>{if(n&&c!=="minute")return;const u=Math.floor((a-l)/d);u>0&&(i.push(r(u,c)),l+=u*d)}),i.join(o)}},Zi=(e="long",t=!1)=>{const n=L();return Lv(n,e,t)},A2e=(e,t,n)=>{const o=tg(t)?t:"UTC";let r,a;return tg(e)?(r=n?sg(o):e,a=!1):(r=o,a=!0),{displayTimeZoneId:r,showTimeZoneAbbreviation:a}},kv=(e,t,n)=>{const o=tg(t)?t:"UTC";let r,a;return tg(e)?(r=n?sg(o):e,a=Px(e)!==Px(sg(o))):(r=o,a=!0),{displayTimeZoneId:r,showTimeZoneAbbreviation:a}},Q4=D("mtz"),X4=({dateIsoFrom:e,dateIsoTo:t,timeZoneId:n,dateFormat:o,timeFormat:r,local:a})=>{const i=f(Q4),l=f(Xd),c=f(Rt);if(!e||!t)return null;if(!i)return jH(e,t,o,r);if(c)return null;const{displayTimeZoneId:d,showTimeZoneAbbreviation:u}=kv(n,l,a);return kH(e,t,d,o,r,u)},R2e=e=>{const t=X4(e);return t?s.jsx(h.Fragment,{children:t}):null},D2e=e=>({defaultTimeZoneId:Xd(e),multiTimeZoneEnabled:Q4(e),isServerRendered:Rt(e)}),qn=Tt(we(D2e))(R2e),tA=({basketSlot:e})=>{const t=f(Zt),n=f(Mt),{start:o,end:r,timeZoneId:a}=e;return s.jsx(qn,{dateIsoFrom:o,dateIsoTo:r,timeZoneId:a,dateFormat:t,timeFormat:n})},O2e=()=>`${Pr()}/customerDetails`,tS=()=>`${Pr()}/language`,Sg=()=>`${Pr()}/wallet`,Xa=()=>`${Pr()}/addresses`,LP=()=>`${Pr()}/delivery`,ar=({queryString:e=""}={})=>`${Pr()}/delivery-pass${e}`,Tp=()=>`${Pr()}/loyalty`,sS=()=>`${Pr()}/accessibility`,nS=()=>`${Pr()}/marketing`,oS=()=>`${Pr()}/delivery-preferences`,rS=()=>`${Pr()}/help-centre`,P2e=Object.freeze(Object.defineProperty({__proto__:null,settingsAccessibilityPath:sS,settingsAddressesPath:Xa,settingsCustomerDetailsPath:O2e,settingsDeliveryPassPath:ar,settingsDeliveryPath:LP,settingsDeliveryPreferencesPath:oS,settingsHelpCentrePath:rS,settingsLanguagePath:tS,settingsLoginDetailsPath:jd,settingsLoyaltyPath:Tp,settingsMarketingPath:nS,settingsPath:Pr,settingsUserDetailsPath:Md,settingsWalletPath:Sg},Symbol.toStringTag,{value:"Module"})),kP="changeDestinationConfirmationModal",Fd="visitorDeliveryDestinationSelectorModal",Em="deliveryDestinationCustomerCollection",_p="homeDeliveryAddressChangeModal",fm="yourDeliveryMethod",gc="chooseDeliveryMethod",jv="deliveryDestinationsMapLookup",Z4="chooseDeliveryAddress",J4=se("GET_HOME_DELIVERY_DESTINATIONS"),e3=se("GET_CUSTOMER_COLLECTION_DELIVERY_DESTINATIONS"),t3=se("GET_SELECTED_DELIVERY_DESTINATION_DETAILS"),s3=se("GET_SUPPORTED_PROPOSITIONS"),n3=se("REMOVE_SLOT_IN_CURRENT_SESSION"),o3="INVALIDATE_CUSTOMER_COLLECTION_DELIVERY_DESTINATIONS",r3="INVALIDATE_HOME_DELIVERY_DESTINATIONS",a3=(e,t)=>({type:"API",payload:{url:`/ecomdeliverydestinations/v4/delivery-addresses?deliveryMethod=${t}`,options:{method:"GET"},service:"ecomdeliverydestinations",...e}}),N2e=()=>a3(J4,"HOME_DELIVERY"),L2e=()=>a3(e3,"CUSTOMER_COLLECTION"),i3=e=>({type:"API",payload:{url:`/ecomdeliverydestinations/v4/delivery-addresses/${e}`,options:{method:"GET"},service:"ecomdeliverydestinations",...t3}}),l3=se("UPDATE_SELECTED_DELIVERY_DESTINATION"),k2e=({deliveryDestinationId:e,customerId:t,visitorId:n,regionId:o})=>({type:"API",payload:{url:"/v2/sessions/active",service:"customersessions",pathPrefix:{client:"/api/customersessions",server:"/core-api"},options:{method:"PUT",headers:{"visitor-id":n,"customer-id":t||""},body:{deliveryDestinationId:e,regionId:o}},...l3}}),j2e=e=>({type:"API",payload:{url:`/customersessions/v1/sessions/customers/${e}/slot`,options:{method:"DELETE"},service:"customersessions",...n3}}),M2e=()=>({type:"API",payload:{url:"/ecomdeliverydestinations/v1/supported-propositions",options:{method:"GET"},service:"ecomdeliverydestinations",...s3}}),w2e=(e,t)=>J.openModal(kP,{previous:e,deliveryDestination:t}),F2e=()=>({type:r3}),B2e=()=>({type:o3}),hn={getHomeDeliveryDestinations:N2e,getCustomerCollectionDeliveryDestinations:L2e,getSelectedDeliveryDestinationData:i3,updateDeliveryDestinationInSession:k2e,removeSlotInCurrentSession:j2e,openChangeDeliveryDestinationConfirmationModal:w2e,invalidateHomeDeliveryDestinations:F2e,invalidateCustomerCollectionDeliveryDestinations:B2e,getSupportedPropositions:M2e,types:{GET_HOME_DELIVERY_DESTINATIONS:J4,GET_CUSTOMER_COLLECTION_DELIVERY_DESTINATIONS:e3,GET_SELECTED_DELIVERY_DESTINATION_DETAILS:t3,UPDATE_SELECTED_DELIVERY_DESTINATION:l3,REMOVE_SLOT_IN_CURRENT_SESSION:n3,INVALIDATE_CUSTOMER_COLLECTION_DELIVERY_DESTINATIONS:o3,INVALIDATE_HOME_DELIVERY_DESTINATIONS:r3,GET_SUPPORTED_PROPOSITIONS:s3}},U2e=e=>{e(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking after changing delivery destination",pageEventAttributes:{componentLocation:"Body",componentType:"Toast",linkType:"Link",userInteraction:"LINK_CLICKED"}}))},G2e=(e,t)=>()=>e.customerId?t:t(ro.LEGACY_addServerSideNotifications([_o.LEGACY_showSlotBookingNotificationForNotLoggedInUser.key])),$2e=()=>Z.success("delivery.destination.method.update.success",{id:"delivery-destinations-updated-toast"}),H2e=()=>Z.error("delivery.destination.method.update.failed",{id:"delivery-destinations-update-failed-toast"}),V2e=(e,t)=>()=>t(Wa.setSelectedAddress({addressId:e.addressId,deliveryDestinationId:e.deliveryDestinationId})),W2e=e=>hn.updateDeliveryDestinationInSession(e),Y2e=(e,t)=>async()=>{if(!e){await t(Yt.getBasket());return}await t({type:"SKIP_REFRESH_BASKET"})},q2e=e=>()=>e(J.closeModal()),c3=({shouldRefreshPage:e,currentPathname:t,targetPath:n,targetPathFull:o,skipActionType:r,dispatch:a,navigate:i})=>e&&t!==o&&t!==Xa()?i(n):a({type:r}),K2e=({shouldRefreshPage:e,currentPathname:t,basePath:n,dispatch:o,navigate:r})=>c3({shouldRefreshPage:e,currentPathname:t,targetPath:fn(),targetPathFull:fn({basePath:n}),skipActionType:"SKIP_REDIRECT_TO_HOMEPAGE",dispatch:o,navigate:r}),z2e=({shouldRefreshPage:e,currentPathname:t,basePath:n,dispatch:o,navigate:r})=>c3({shouldRefreshPage:e,currentPathname:t,targetPath:jt(),targetPathFull:jt({basePath:n}),skipActionType:"SKIP_REDIRECT_TO_TROLLEY_PAGE",dispatch:o,navigate:r}),Q2e=({shouldRefreshPage:e,currentPathname:t,basePath:n,dispatch:o,navigate:r,redirectToTrolley:a})=>()=>(a?z2e:K2e)({shouldRefreshPage:e,currentPathname:t,basePath:n,dispatch:o,navigate:r}),X2e=(e,t)=>()=>(e&&window.location.reload(),t),d3=(e,t,n,o,r,a,i=!1)=>r(W2e(e)).then(Y2e(t,r)).then(V2e(e,r)).then(q2e(r)).then($2e).then(G2e(e,r)).then(Q2e({shouldRefreshPage:t,currentPathname:n,basePath:o,dispatch:r,navigate:a,redirectToTrolley:i})).then(X2e(t,r)).catch(H2e),Z2e=[],J2e=(e=Z2e,t)=>{switch(t.type){case ro.types.LEGACY_ADD_SERVER_SIDE_NOTIFICATIONS:return[...e,...t.payload.serverSideNotifications];case ro.types.LEGACY_CLEAR_SERVER_SIDE_NOTIFICATIONS:return t.payload.serverSideNotifications;default:return e}},u3=({control:e})=>e.notifications,eWe=({product:e,meta:t,featuredProductCampaigns:n})=>{const{brand:o,variant:r,price:a,quantity:i,isFavorite:l,isOnPromotion:c,position:d,productId:u}=tn(e),p=Vn(e,n),g=e.ratingSummary?.overallRating,E={item_id:e.retailerProductId||null,item_name:e.name,index:d||null,item_brand:o,hfss_display_restriction_group:e.hfssDisplayRestrictionGroup??null,item_list_name:null,item_variant:r,price:a,rating:g?Number(g):null,quantity:Number(i),is_on_promotion:c,is_favorite:l,is_featured:!!p,featured_campaign_id:p?.campaignId||null,featured_campaign_name:p?.campaignName||null,...Pl(e?.categoryPath??[]),seller_id:e.seller?.id||null};return Rc({productId:u,item:E,meta:t})},tWe=e=>{const t=e.map(n=>tn(n));return{event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventAction:"BeginCheckout",eventLabel:"Not Set",ecommerce:{checkout:{actionField:{step:1},products:t}}}},sWe=e=>{const{meta:t,cartOrderId:n,basketProducts:o,basketTotal:r,groupId:a,featuredProductCampaigns:i}=e,l=o.map(c=>eWe({product:c,meta:t,featuredProductCampaigns:i}));return{event:"begin_checkout",ecommerce:{currency:r?.currency||null,value:r?.amount?Number(r.amount):null,osp_transaction_id:n,group_id:a,items:l}}},jP=e=>{const t=ho(e);return tWe(t)},MP=(e,t)=>{const n=Ct(e)||null,o=ho(e),r=Ra(e),a=or(e),i=Qs(e);return sWe({meta:t,cartOrderId:n,basketProducts:o,basketTotal:r,groupId:a,featuredProductCampaigns:i})},ci=()=>{const e=Yd();return t=>{const n=e.getState(),o=jP(n);te.sendEvent({GA:o,WA:null});const r=MP(n,t);te.sendEvent({GA:r,WA:null})}},_o={LEGACY_isPromotionsAvailableNotification:{key:"LEGACY_isPromotionsAvailableNotification",notifier:({dispatch:e,location:t,state:n})=>{Z.info("toggleablepromotions.notification.promotions.available",{link:s.jsx(da,{to:jt(),label:"toggleablepromotions.notification.promotions.link",onClick:()=>{e(My(t,ed)),rd(n,{page:t.pathname,pagePartType:ed}).sendPageViewEvent(),e(cp({type:Bo.ORDER_DISCOUNT_FORM_MODAL_DISPLAYED,description:"A modal for order promotions is displayed",source:"orderPromotionsAlert"})),e(J.openModal("discountOnOrder"))}}),id:"toggleablePromotionsToast-toggleablepromotions.notification.promotions.available"})},id:"toggleablePromotionsToast-toggleablepromotions.notification.promotions.available"},LEGACY_isSelectedPromotionsChangedNotification:{key:"LEGACY_isSelectedPromotionsChangedNotification",notifier:({dispatch:e,location:t,state:n})=>{Z.info("toggleablepromotions.notification.promotions.selected.promotion.changed",{link:s.jsx(da,{to:jt(),label:"toggleablepromotions.notification.promotions.link",onClick:()=>{e(My(t,ed)),rd(n,{page:t.pathname,pagePartType:ed}).sendPageViewEvent(),e(cp({type:Bo.ORDER_DISCOUNT_FORM_MODAL_DISPLAYED,description:"A modal for order promotions is displayed",source:"orderPromotionsAlert"})),e(J.openModal("discountOnOrder"))}}),id:"toggleablePromotionsToast-toggleablepromotions.notification.promotions.selected.promotion.changed"})},id:"toggleablePromotionsToast-toggleablepromotions.notification.promotions.selected.promotion.changed"},LEGACY_isSelectedPromotionsReplacedByVoucherNotification:{key:"LEGACY_isSelectedPromotionsReplacedByVoucherNotification",notifier:({dispatch:e,location:t,state:n})=>{Z.info("toggleablepromotions.notification.promotions.selected.promotion.replaced.by.voucher",{link:s.jsx(da,{to:jt(),label:"toggleablepromotions.notification.promotions.link",onClick:()=>{e(My(t,ed)),rd(n,{page:t.pathname,pagePartType:ed}).sendPageViewEvent(),e(cp({type:Bo.ORDER_DISCOUNT_FORM_MODAL_DISPLAYED,description:"A modal for order promotions is displayed",source:"orderPromotionsAlert"})),e(J.openModal("discountOnOrder"))}}),id:"toggleablePromotionsToast-toggleablepromotions.notification.promotions.selected.promotion.replaced.by.voucher"})},id:"toggleablePromotionsToast-toggleablepromotions.notification.promotions.selected.promotion.replaced.by.voucher"},LEGACY_showBasketMergeSucceedPriceChanged:{key:"LEGACY_showBasketMergeSucceedPriceChanged",notifier:()=>{Z.info("basket.merge.notification.review.trolley",{link:s.jsx(da,{to:jt(),label:"basket.merge.prices.promos.changed.notification"})})}},LEGACY_showBasketMergeSucceed:{key:"LEGACY_showBasketMergeSucceed",notifier:()=>{Z.info("basket.merge.notification.review.trolley",{link:s.jsx(da,{to:jt(),label:"basket.merge.success.notification"})})}},LEGACY_showBasketMergeFailed:{key:"LEGACY_showBasketMergeFailed",notifier:()=>{Z.error("basket.merge.failure.notification",{link:s.jsx(da,{to:jt(),label:"basket.merge.notification.review.trolley"})})}},LEGACY_showBasketMergeFailedViaToken:{key:"LEGACY_showBasketMergeFailedViaToken",notifier:()=>{Z.error("basket.merge.via.cart.token.failure.notification",{link:s.jsx(da,{to:jt(),label:"basket.merge.notification.review.trolley"})})}},LEGACY_handleLoggedOutNotification:{key:"LEGACY_handleLoggedOutNotification",notifier:()=>{Z.info("basket.add.availability.reminder",{link:s.jsx(da,{to:Yo(),label:"basket.add.availability.reminder.login.or.register"}),id:"logged-out-add-toast"})},id:"logged-out-add-toast"},LEGACY_showSlotBookingNotificationForNotLoggedInUser:{key:"LEGACY_showSlotBookingNotificationForNotLoggedInUser",notifier:({dispatch:e})=>{Z.info("delivery.destination.visitor.slot.reminder",{link:s.jsx(da,{to:Tr({inCheckoutWalk:!1}),label:"delivery.destination.visitor.slot.reminder.book.link",onClick:()=>e(U2e)}),id:"delivery-destinations-bookSlotToast"})},id:"delivery-destinations-bookSlotToast"},LEGACY_expiredNotification:{key:"LEGACY_expiredNotification",notifier:({dispatch:e,state:t})=>{Z.info("basket.slot.expired.notification.text",{link:s.jsx(da,{to:Tr({inCheckoutWalk:!1}),label:"basket.slot.expired.notification.link",onClick:()=>{e(U.analyticsEvent({type:Le.BEGIN_CHECKOUT}));const n=jP(t);te.sendEvent({GA:n,WA:null});const o=MP(t);te.sendEvent({GA:o,WA:null})}}),id:"ExpiryNotification0"})},id:"ExpiryNotification0"},LEGACY_minimumOrderChangedNotification:{key:"LEGACY_minimumOrderChangedNotification",notifier:({intl:e,state:t})=>{const n=NE(t),o=Bi(t),{formatNumber:r}=e;if(!n)return;const a=ii(r,n,o);Z.info({key:"minimum.order.changed.notification.text",substitutions:{amount:a}},{id:"min.spend.toast"})},id:"min.spend.toast"},LEGACY_showExpressCollectionBookedToast:{key:"LEGACY_showExpressCollectionBookedToast",notifier:({intl:e,state:t})=>{const n=xn(t);if(!n)return;const o=e.formatMessage("slotbooking.confirm.alert.express.collection",{timeSpan:Lv(e)(n.deliveryTimeInMinutes),addressName:n.nickname});Z.success({formattedMessage:o},{id:"slotbooking.confirm.alert"})},id:"slotbooking.confirm.alert"},LEGACY_showFastDeliverBookedToast:{key:"LEGACY_showFastDeliverBookedToast",notifier:({intl:e,state:t})=>{xn(t)&&Z.success({formattedMessage:e.formatMessage("slotbooking.fast.delivery.booked.alert")},{id:"slotbooking.confirm.alert"})},id:"slotbooking.confirm.alert"},LEGACY_showSlotBookedToast:{key:"LEGACY_showSlotBookedToast",notifier:({intl:e,state:t})=>{const n=xn(t);if(!n)return;const o=e.formatMessage("slotbooking.confirm.alert",{dateAndTime:s.jsx(tA,{basketSlot:n}),addressName:n.nickname});Z.success({formattedMessage:o},{id:"slotbooking.confirm.alert"})},id:"slotbooking.confirm.alert"},LEGACY_showMultidayOrStandardCustomerCollectioBookedToast:{key:"LEGACY_showMultidayOrStandardCustomerCollectioBookedToast",notifier:({intl:e,state:t})=>{const n=xn(t);if(!n)return;const o=e.formatMessage("slotbooking.confirm.alert.for.collection",{dateAndTime:s.jsx(tA,{basketSlot:n}),addressName:n.nickname});Z.success({formattedMessage:o},{id:"slotbooking.confirm.alert"})},id:"slotbooking.confirm.alert"}},p3=()=>{const e=f(u3),t=F(),n=Ne(),o=L(),r=f(a=>a);return h.useEffect(()=>{e.forEach(a=>{_o[a].notifier({dispatch:t,location:n,intl:o,state:r})}),e.length&&t(ro.LEGACY_clearServerSideNotifications([]))},[e]),null},m3=se("GET_CONCIERGE_DELIVERY"),h3="SET_CONCIERGE_DELIVERY",g3=se("SAVE_CONCIERGE_DELIVERY"),nWe=(e,t=!1)=>({type:"API",payload:{service:"ecomslots",pathPrefix:{client:"/api/ecomslots",server:"/core-api"},url:`/v1/slots/${e}/concierge`,...m3},isFakeAvailabilityEnabled:t}),oWe=(e,t=!1)=>({type:h3,conciergeDelivery:e??!1,isFakeAvailabilityEnabled:t}),rWe=({slotId:e,isLeftAtConcierge:t,orderId:n})=>({type:"API",payload:{service:"ecomslots",pathPrefix:{client:"/api/ecomslots",server:"/core-api"},url:`/v1/slots/${e}/concierge`,options:{method:"POST",body:{isLeftAtConcierge:t,orderId:n}},...g3}}),Zr={getConciergeDelivery:nWe,setConciergeDelivery:oWe,saveConciergeDelivery:rWe,types:{GET_CONCIERGE_DELIVERY:m3,SET_CONCIERGE_DELIVERY:h3,SAVE_CONCIERGE_DELIVERY:g3}},aWe={initialValue:!1,currentValue:!1,lastUpdated:null,wasFakeSlotBookingPageShown:!1},iWe=(e=aWe,t)=>{switch(t.type){case Zr.types.GET_CONCIERGE_DELIVERY.SUCCESS:{if(t?.isFakeAvailabilityEnabled)return{...e,lastUpdated:de(),wasFakeSlotBookingPageShown:t.payload?.responseData?.isLeftAtConcierge??!1};const n=t.payload?.responseData?.isLeftAtConcierge??!1;return{...e,lastUpdated:de(),initialValue:n,currentValue:n}}case Zr.types.SET_CONCIERGE_DELIVERY:return t?.isFakeAvailabilityEnabled?{...e,wasFakeSlotBookingPageShown:t?.conciergeDelivery}:{...e,currentValue:t?.conciergeDelivery??!1};default:return e}},kE=({control:e})=>e.delivery?.conciergeDelivery?.currentValue??!1,lWe=({control:e})=>e.delivery?.conciergeDelivery,E3=({control:e})=>e.delivery?.conciergeDelivery?.lastUpdated??null,f3=({control:e})=>e.delivery?.conciergeDelivery?.wasFakeSlotBookingPageShown??!1,y3=se("CHECKOUT"),I3=se("GET_OVERRIDE_PAYMENT_METHOD_GROUPS"),S3=se("GET_PAYMENT_CHECKOUT_SUMMARY"),C3=se("GET_ORDER_MULTI_PAYMENTS"),v3=se("GET_PAYMENT_CHECKOUT_SUMMARY_WITH_PAYMENT_METHOD_GROUPS"),Mv=e=>({type:"API",payload:{service:"orderpayment",pathPrefix:{client:"/api/orderpayment",server:"/core-api"},...e}}),cWe=({leftAtConcierge:e,sellerIds:t=[],productIds:n,orderTotalAmount:o})=>Mv({url:"/v1/payment-method-groups",options:{method:"POST",body:{leftAtConcierge:e,sellerIds:t,productIds:n,orderTotalAmount:o}},...I3}),dWe=()=>Mv({url:"/v1/payment-checkout-summary",options:{method:"GET"},...S3}),uWe=({sellerIds:e,productIds:t})=>Mv({url:"/v2/payment-checkout-summary",options:{method:"POST",body:{sellerIds:e,productIds:t}},...v3}),pWe=e=>Mv({url:`/v1/order-payments/${e}`,options:{method:"GET"},...C3}),mWe=({billingAddressId:e,paymentMethod:t,paymentCheckIds:n,recurringOrder:o,psp:r})=>({type:"API",payload:{url:"/v1/orderpayment/checkout",options:{headers:{...r?{"X-Override-Psp":r}:{}},method:"POST",body:{billingAddressId:e,paymentMethod:t,paymentCheckIds:n,recurringOrder:o}},...y3}}),qr={getOverridePaymentMethodGroups:cWe,getPaymentCheckoutSummary:dWe,getOrderMultiPayments:pWe,orderPaymentCheckout:mWe,getPaymentCheckoutSummaryWithPaymentMethodGroups:uWe,types:{CHECKOUT:y3,GET_OVERRIDE_PAYMENT_METHOD_GROUPS:I3,GET_PAYMENT_CHECKOUT_SUMMARY:S3,GET_ORDER_MULTI_PAYMENTS:C3,GET_PAYMENT_CHECKOUT_SUMMARY_WITH_PAYMENT_METHOD_GROUPS:v3}},hWe=Wn(["pay.slct","oed"]),gWe=D("pcs.v2"),EWe=e=>(t,n)=>{if(!e)return Promise.resolve(null);const o=n(),r=kE(o),a=(NR(o)||[]).map(u=>u.sellerId),i=(_l(o)||[]).map(u=>u.productId),c=Kue(o)?.amount||"",d=Ze(o,"seller-sales-enabled")==="true";return!c||d&&!a?.length||!i?.length?Promise.resolve(null):t(qr.getOverridePaymentMethodGroups({leftAtConcierge:r,sellerIds:a,orderTotalAmount:c,productIds:i})).catch(u=>{throw Z.error("request.error.title"),u})},fWe=()=>(e,t)=>{const n=t(),o=NR(n).map(i=>i.sellerId),r=(_l(n)||[]).map(i=>i.productId);return Ze(n,"seller-sales-enabled")==="true"&&!o?.length||!r?.length?Promise.resolve(null):e(qr.getPaymentCheckoutSummaryWithPaymentMethodGroups({sellerIds:o.length>0?o:void 0,productIds:r})).catch(i=>{throw Z.error("request.error.title"),i})},yWe=()=>async(e,t)=>{hWe(t())&&(gWe(t())?await e(sr.getOrderPaymentCheckoutSummaryWithPaymentMethodGroups()):await e(qr.getPaymentCheckoutSummary()))},IWe=e=>(t,n)=>{const o=n(),r=xn(o),a=D("pay.slct")(o),i=D("pay.pmf")(o);return!(a&&i)||!r?Promise.resolve(null):t(e())},sr={getOverridePaymentMethodGroups:EWe,getOrderPaymentCheckoutSummaryWithPaymentMethodGroups:fWe,getPaymentCheckoutSummaryService:yWe,withOverridePaymentMethodGroups:IWe},T3=se("GET_AVAILABLE_PROMOTION_SELECTIONS"),_3=se("GET_PROMOTION_DESCRIPTIONS"),b3=se("SUBMIT_PROMOTION_SELECTIONS"),x3="SET_TOGGLEABLE_PROMOTIONS",SWe=e=>({type:"API",payload:{service:"promotionspresentation",pathPrefix:{client:"/api/promotionspresentation",server:"/core-api"},...e}}),CWe=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},...e}}),vWe=()=>SWe({url:"/v1/available-promotion-selections",...T3}),TWe=e=>({type:"API",payload:{url:"/v2/descriptions",service:"promotions",options:{body:e,method:"PUT"},pathPrefix:{client:"/api/promotions",server:"/core-api"},..._3}}),_We=(e,t)=>CWe({url:"/v1/carts/active/promotion-selections/order-promotions",options:{body:{orderId:t,promotionSelections:e},method:"PUT"},...b3}),bWe=e=>({type:x3,payload:{toggleablePromotions:e}}),$a={getAvailablePromotionSelections:vWe,getPromotionDescriptions:TWe,setToggleablePromotions:bWe,submitOrderPromotionSelections:_We,actionTypes:{GET_AVAILABLE_PROMOTION_SELECTIONS:T3,GET_PROMOTION_DESCRIPTIONS:_3,SUBMIT_PROMOTION_SELECTIONS:b3,SET_TOGGLEABLE_PROMOTIONS:x3}},WB=(e,t,n)=>(e.applicationGroups.forEach(o=>{o.applicationSubgroups.forEach((r,a)=>{xWe(o,r,a),AWe(t,r),n&&DWe(r)})}),RWe(t,e.preAppliedPromotions),e),xWe=(e,t,n)=>{t.applicationGroupName=`${e.promotionType}_${n+1}`},AWe=(e,t)=>{t.promotions.forEach(n=>{n.description=e[n.promotionId]})},RWe=(e,t)=>{t.forEach(n=>{n.description=e[n.promotionId]})},DWe=e=>{e.limitPerOrder===1&&e.promotions.length&&e.promotions.push({promotionId:hc,selected:!e.promotions.some(t=>t.selected),changeable:!0,description:"None of the above",validityTime:{}})},OWe=e=>e.applicationGroups.reduce((t,n)=>(n.applicationSubgroups.forEach(o=>{if(o.limitPerOrder===1){const r=o.promotions.find(a=>a.selected);r&&(t[o.applicationGroupName]=r.promotionId)}if(!o.limitPerOrder){const r=o.promotions.reduce((a,i)=>(i.selected&&a.push(i.promotionId),a),[]);r.length&&(t[o.applicationGroupName]=r)}}),t),{}),PWe=e=>e.applicationGroups.reduce((t,n)=>(t[n.promotionType]=n.applicationSubgroups,t),{}),NWe=e=>e?.reduce((t,n)=>{const o=n.promotionType;return t[o]||(t[o]=[]),t[o].push(n),t},{})??{},LWe=e=>{const t=[];return{availablePromotions:e.map(o=>{const[r,a]=o.promotions.reduce(([i,l],c)=>(!c.selected&&!c.changeable?l.push(c):c.changeable&&i.push(c),[i,l]),[[],[]]);return t.push(...a),{...o,promotions:r}}),unavailablePromotions:t}},kWe=(e,t)=>e.reduce((n,o)=>{const{promotions:r}=o,a=r.filter(i=>!i.changeable&&i.selected);return a.length&&n.push(...a.map(i=>({promotionType:t,promotionId:i.promotionId,description:i.description}))),n},[]),jWe=e=>{const{applicationGroups:t,preAppliedPromotions:n}=e,o=NWe(n);return[_n.SAVING,_n.LOYALTY,_n.DELIVERY].reduce((a,i)=>{const c=t.find(y=>y.promotionType===i)?.applicationSubgroups??[],d=o[i]||[],{availablePromotions:u,unavailablePromotions:p}=LWe(c),g=kWe(c,i),E=[...d,...g];return a[i]={availablePromotions:u??[],unavailablePromotions:p??[],preAppliedPromotions:E??[]},a},{})??{}},MWe=e=>e.applicationGroups.reduce((t,n)=>(n.applicationSubgroups.forEach(o=>o.promotions.forEach(r=>{r.promotionId!==hc&&t.push(r.promotionId)})),t),[]),wWe=e=>e.preAppliedPromotions.map(t=>t.promotionId),wP=(e,t)=>e.applicationGroups.reduce((n,o)=>(o.applicationSubgroups.forEach(r=>{n.push(...t(r.promotions))}),n),[]),FWe=e=>wP(e,n=>n.filter(({changeable:o,promotionId:r})=>o&&r!==hc).map(({promotionId:o,selected:r})=>({promotionId:o,selected:r}))),BWe=e=>wP(e,n=>n.filter(({changeable:o,selected:r})=>!o&&r).map(({promotionId:o})=>o)),UWe=e=>wP(e,n=>n.filter(({selected:o})=>o).map(({promotionId:o})=>o)),GWe=e=>e.applicationGroups.reduce((t,n)=>(n.applicationSubgroups.forEach(o=>{o.limitPerOrder===1&&o.promotions.some(({changeable:r})=>!r)&&t.push(o.promotions.filter(({promotionId:r})=>r!==hc))}),t),[]),A3=(e,t)=>t.reduce((n,o)=>{const r=o.filter(({changeable:i})=>i),a=o.filter(({changeable:i})=>!i);return!r.length&&a.length?n.push(...a.map(({promotionId:i})=>({promotionId:i,selected:!1}))):a.length&&r.every(({promotionId:i})=>!e.find(l=>l.promotionId===i)?.selected)&&n.push(...a.map(({promotionId:i})=>({promotionId:i,selected:!1}))),n},[]),$We=e=>e.applicationGroups.reduce((t,n)=>(t[n.promotionType]=n.applicationSubgroups.flatMap(o=>o.promotions.filter(r=>r.selected&&r.promotionId!==hc).map(r=>r.description)),t),{}),HWe=e=>e.preAppliedPromotions.reduce((t,n)=>(t[n.promotionType]=(t[n.promotionType]||[]).concat(n.description),t),{}),VWe=(e,t)=>{const n={};return[...new Set([...Object.keys(e),...Object.keys(t)])].forEach(r=>{n[r]=(e[r]||[]).concat(t[r]||[])}),n},WWe=e=>Object.values(e).flat().length>0,YWe=e=>Object.values(e).flat().length>0,R3=e=>{let t=!1;return e.applicationGroups.forEach(n=>n.applicationSubgroups.forEach(o=>{o.promotions.length&&(t=!0)})),t},D3=e=>e.preAppliedPromotions.length>0,ym=(e,t,n)=>{if(!t.activeFrom&&!t.activeTo)return{};const o=e.formatMessage("toggleablepromotions.modal.expires.today"),r=e.formatMessage("toggleablepromotions.modal.expires.tomorrow"),a=P=>e.formatMessage("toggleablepromotions.modal.expires",{date:P}),i=P=>e.formatMessage("toggleablepromotions.modal.place.order.date",{date:P}),l=P=>e.formatMessage("toggleablepromotions.modal.place.order.daterange",{dateRange:P}),c=P=>e.formatMessage("toggleablepromotions.modal.place.order.from",{date:P}),d=P=>e.formatMessage("toggleablepromotions.modal.select.slot.date",{date:P}),u=P=>e.formatMessage("toggleablepromotions.modal.select.slot.daterange",{dateRange:P}),p=P=>e.formatMessage("toggleablepromotions.modal.select.slot.from.date",{date:P}),g=P=>e.formatMessage("toggleablepromotions.modal.select.slot.until.date",{date:P}),E=!!t.activeFrom,y=E&&mC(t.activeFrom),I=E&&Nd(t.activeFrom),S=E&&ng(t.activeFrom),C=E&&!y&&!I,T=!!t.activeTo,_=T&&Nd(t.activeTo),A=T&&ng(t.activeTo),R=T&&!_;if(!E||y||I){if(_)return{tag:o,...t.validityType==="SELECT_SLOT"&&{label:g(qs(n,t.activeTo))}};if(A)return{tag:r,...t.validityType==="SELECT_SLOT"&&{label:g(qs(n,t.activeTo))}};if(!T)return{};if(R)return{label:t.validityType==="SELECT_SLOT"?g(qs(n,t.activeTo)):a(qs(n,t.activeTo))}}if(S&&A)return{label:t.validityType==="SELECT_SLOT"?d(qs(n,t.activeFrom)):i(qs(n,t.activeFrom)),tag:r};if(C){if(!T)return{label:t.validityType==="SELECT_SLOT"?p(qs(n,t.activeFrom)):c(qs(n,t.activeFrom))};if(vR(t.activeFrom,t.activeTo))return{label:t.validityType==="SELECT_SLOT"?d(qs(n,t.activeFrom)):i(qs(n,t.activeFrom))};if(R)return{label:t.validityType==="SELECT_SLOT"?u(`${qs(n,t.activeFrom)} - ${qs(n,t.activeTo)}`):l(`${qs(n,t.activeFrom)} - ${qs(n,t.activeTo)}`)}}return{}},O3=(e,t)=>e===_n.SAVING?t===1?Gu.GENERAL_DISCOUNT_ANY:Gu.GENERAL_DISCOUNT_LIMITED:e===_n.DELIVERY?t===1?Gu.DELIVERY_DISCOUNT_ANY:Gu.DELIVERY_DISCOUNT_LIMITED:t===1?Gu.LOYALTY_DISCOUNT_ANY:Gu.LOYALTY_DISCOUNT_LIMITED,qWe=e=>{const t=[];e.SAVING&&t.push(...e.SAVING),e.DELIVERY&&t.push(...e.DELIVERY),e.LOYALTY&&t.push(...e.LOYALTY);let n=0;return t.reduce((o,r,a)=>(r.promotions.forEach(i=>{o[i.promotionId]={orderDiscountFormSectionSequence:a,promotionIdSequence:n,orderDiscountFormSection:O3(r.applicationGroupName.split("_")[0],r.limitPerOrder)},n+=1}),o),{})},KWe=e=>{const t=[_n.SAVING,_n.DELIVERY,_n.LOYALTY],n=[];let o=0,r=0;const a=(i,l,c,d)=>{n.push({promotionId:i.promotionId,orderDiscountFormSectionSequence:r,promotionIdSequence:o++,orderDiscountFormSection:O3(l,d),promotionIdIsSelected:c,promotionIdText:i.description,validityTime:i.validityTime})};return t.forEach(i=>{const l=e[i];if(!l)return;const{availablePromotions:c,preAppliedPromotions:d,unavailablePromotions:u}=l;c.length>0&&(c.forEach(p=>{p.promotions.forEach(g=>{a(g,i,g.selected,p.limitPerOrder)})}),r++),d.length>0&&(d.forEach(p=>{a({promotionId:p.promotionId,description:p.description,validityTime:{validityType:"PLACE_ORDER",activeFrom:"",activeTo:""}},i,!0)}),r++),u.length>0&&(u.forEach(p=>{a(p,i,!1)}),r++)}),n},P3=Ro(["pbpm","pcs.v2"]),Bd=()=>e=>e($a.getAvailablePromotionSelections()).then(({payload:{responseData:t}})=>e(zWe(t))),zWe=e=>(t,n)=>{const o=MWe(e),r=wWe(e),a=D("tp.no")(n()),i=[...o,...r];return i.length===0?t($a.setToggleablePromotions(WB(e,{},a))):t($a.getPromotionDescriptions(i)).then(({payload:{responseData:l}})=>{const c=l.reduce((d,u)=>(d[u.promotionId]=u.displayName,d),{});t($a.setToggleablePromotions(WB(e,c,a)))}).catch(()=>{Z.error("request.error.title")})},QWe=e=>(t,n)=>{const{data:{basket:{orderId:o}}}=n();return o?t($a.submitOrderPromotionSelections(e,o)).then(()=>t(Yt.getBasket()).then(()=>(P3(n())&&t(sr.getOrderPaymentCheckoutSummaryWithPaymentMethodGroups()),t(Bd())))).catch(()=>{Z.error("request.error.title")}):null},XWe=e=>async(t,n)=>{const{data:{basket:{orderId:o}}}=n();try{if(!o)throw new Error("Toggleable promotions applying: no orderId provided");return await t($a.submitOrderPromotionSelections(e,o)),{isSuccessful:!0}}catch(r){const a=r instanceof Error?r:new Error(String(r));return Ue.api.pushError(new Error("Couldn't apply toggleable promotions selection"),{context:{errorMessage:a.message}}),Z.error("toggleablepromotions.apply.error"),{isSuccessful:!1}}},ZWe=()=>async(e,t)=>{try{await e(Yt.getBasket()),P3(t())&&await e(sr.getOrderPaymentCheckoutSummaryWithPaymentMethodGroups()),await e(Bd()),Z.success("toggleablepromotions.apply.success")}catch(n){const o=n instanceof Error?n:new Error(String(n));Ue.api.pushError(new Error("Couldn't refetch toggleable promotions after applying"),{context:{errorMessage:o.message}})}},yu=(e=void 0,t=!1)=>(n,o)=>{const{router:{location:r},session:{isLoggedIn:a}}=o(),i=o(),l=D("tp")(i)||D("tp.new")(i);if(a&&l&&e){const c=e.some(p=>p.type===lp.PROMOTIONS_AVAILABLE),d=e.some(p=>p.type===lp.SELECTED_PROMOTION_CHANGED),u=e.some(p=>p.type===lp.SELECTED_PROMOTION_REPLACED_BY_VOUCHER);if(c||d||u)return n(Bd()).then(()=>{if(![HVe.CHECKOUT_WALK].some(g=>r.pathname.includes(g))){const g=["toggleablePromotionsToast-toggleablepromotions.notification.promotions.available","toggleablePromotionsToast-toggleablepromotions.notification.promotions.selected.promotion.changed","toggleablePromotionsToast-toggleablepromotions.notification.promotions.selected.promotion.replaced.by.voucher"],E=Z.getNotifications().find(y=>g.includes(y.id));E?.id&&Z.close(E.id),n(c?ro.LEGACY_addServerSideNotifications([_o.LEGACY_isPromotionsAvailableNotification.key]):d?ro.LEGACY_addServerSideNotifications([_o.LEGACY_isSelectedPromotionsChangedNotification.key]):ro.LEGACY_addServerSideNotifications([_o.LEGACY_isSelectedPromotionsReplacedByVoucherNotification.key]))}});if(t)return n(Bd())}return Promise.resolve()},cp=e=>(t,n)=>{const{data:{basket:{basketId:o},toggleablePromotions:{data:r}},router:{location:{pathname:a}}}=n(),i=new RegExp("orders/[0-9]+/details"),l=a.match(i);let c,d=!1;if(l&&([,c]=l[0].split("/")),c&&(d=_v(n(),c)),e.type===Bo.ORDER_DISCOUNT_FORM_MODAL_DISPLAYED){const{type:u,description:p,source:g}=e;t(U.analyticsEvent({type:u,description:p,pageEventAttributes:{source:g,basketid:o,...d&&{orderid:c}}}))}else if(e.type===Bo.ORDER_DISCOUNT_FORM_MODAL_CLOSED){const{type:u,description:p,userAction:g,hasSelectionChange:E,selectedPromotionId:y}=e;t(U.analyticsEvent({type:u,description:p,pageEventAttributes:{basketid:o,userAction:g,hasSelectionChange:E,selectedPromotionId:y?[...y,...BWe(r)]:UWe(r),...d&&{orderid:c}}}))}},JWe=()=>(e,t)=>{const{data:{basket:{orderId:n}}}=t();e(U.analyticsEvent({type:Bo.ORDER_DISCOUNT_DROPDOWN_CLICKED,description:"The dropdown for order promotions is clicked",pageEventAttributes:{orderid:n}}))},FP=e=>async t=>t(Ti.getBop(e)).then(n=>{if(n){const{responseData:o}=n.payload,{result:{product:r},entities:a}=sq(o);return t(Ti.setActiveBop(r)),t(xt.updateProducts({product:[a.product[r]],upsert:!0})),a.product[r]}return null});function Jr({method:e,body:t,contentType:n,clientRouteId:o,csrfToken:r}){const a={...o&&{"client-route-id":o},...r&&{"X-CSRF-TOKEN":r},...n&&{"content-type":n}};return typeof window<"u"&&(a["ecom-request-source"]="web",a["ecom-request-source-version"]=CC(window.__INITIAL_STATE__)),{method:e,credentials:"same-origin",body:t,headers:a}}const N3=async e=>{const{basePath:t,clientRouteId:n,csrfToken:o,requestId:r,target:a}=e,i=go({basePath:t,target:a});return fetch(i,Jr({method:"GET",clientRouteId:n,csrfToken:o})).then(l=>{if(!l.ok)throw new Error("Cannot fetch metadata");return l.json()}).catch(l=>{Ue.api.pushError(new Error(`Analytics metadata: Error fetching metadata (${l.message})`),{context:{requestId:r,url:i,errorData:JSON.stringify(l,Object.getOwnPropertyNames(l))}})})},eYe=async e=>N3({...e,target:"/cart/v1/meta/carts/active/products"}),tYe=async(e,t)=>N3({...t,target:`/cart/v1/meta/checkouts/${e}/products`}),ko={fetchAnalyticsMetadataByActiveCart:eYe,fetchAnalyticsMetadataByCheckoutId:tYe},BP=e=>e?.price&&e.price?.current&&{currencyCode:e.price.current.currency},wv=({products:e,basket:t,page:n,addedByFunction:o,productListName:r,position:a,category:i})=>{const l=t?.totals?.display?.itemPriceAfterPromos?.amount,c=t?.basketId;return{event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"ADD_BASKET_ITEM",eventLabel:"Add to Cart",ecommerce:{add:{actionField:{list:r},products:e.map(d=>tn(d,i,a))},...BP(e.at(0))},...l&&{basketTotalAmount:l},...c&&{basketId:c},...o&&{addedByFunction:o},page:n}},Fv=({addedByFunction:e,basket:t,products:n,productListName:o,position:r,page:a,section:i,featuredProductCampaigns:l})=>{const c=t?.totals?.display?.itemPriceAfterPromos?.amount||null,d=GP(n),u=n[0]?.price?.current?.currency;return d.map(p=>{const g=k3(p);return{event:"add_to_cart",ecommerce:{currency:u||null,cart_value:c?Number(c):null,cart_update_value:null,value:g,osp_transaction_id:t?.orderId||null,items:UP({product:p,position:r,productListName:o,page:a,section:i,featuredProductCampaigns:l})},cart_function:e}})},Bv=({products:e,basket:t,page:n,addedByFunction:o,productListName:r,position:a,category:i})=>{const l=t?.totals?.display?.itemPriceAfterPromos?.amount,c=t?.basketId;return{event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"REMOVE_BASKET_ITEM",eventLabel:"Remove from Cart",ecommerce:{remove:{actionField:{list:r},products:e.map(d=>tn(d,i,a))},...BP(e[0])},...l&&{basketTotalAmount:l},...c&&{basketId:c},...o&&{addedByFunction:o},page:n}},Uv=({addedByFunction:e,basket:t,products:n,productListName:o,position:r,page:a,section:i,featuredProductCampaigns:l})=>{const c=t?.totals?.display?.itemPriceAfterPromos?.amount||null,d=GP(n),u=n[0]?.price?.current?.currency;return d.map(p=>{const g=k3(p);return{event:"remove_from_cart",ecommerce:{currency:u||null,cart_value:c?Number(c):null,cart_update_value:null,value:g,osp_transaction_id:t?.orderId||null,items:UP({product:p,position:r,productListName:o,page:a,section:i,featuredProductCampaigns:l})},cart_function:e}})},sYe=({products:e,cartType:t,currencyCode:n,total:o,orderId:r,groupId:a,position:i,page:l,meta:c,featuredProductCampaigns:d})=>GP(e).map(p=>({event:"view_cart",type:t,ecommerce:{currency:n||null,cart_value:o?Number(o):null,osp_transaction_id:r??null,group_id:a||null,items:UP({product:p,position:i,productListName:ks(l,"",t==="expanded"?"quick-view-trolley":""),page:l,meta:c,isEnhanced:!0,featuredProductCampaigns:d})}})),UP=e=>{const{position:t,product:n,productListName:o,page:r,section:a,isEnhanced:i,meta:l,featuredProductCampaigns:c}=e;return n.map(d=>{const u=Ba(d,"offers")?d.offers:[],p=Ba(d,"ratingSummary")?d?.ratingSummary?.overallRating:null,g=Ba(d,"retailerProductId")?d.retailerProductId:null,E=Ba(d,"brand")?d.brand:null,y=Ba(d,"size")?d.size:null,I=Ba(d,"favorite")?d.favorite:null,S=Ba(d,"categoryPath")?d.categoryPath:null,C=Ba(d,"seller")?d.seller:null,T=Ba(d,"hfssDisplayRestrictionGroup")?d.hfssDisplayRestrictionGroup:null,_=Vn(d,c),A=!!u?.length,R=rYe(u),P=d.price?.current?.amount,N=o||ks(r,"",a||""),k=Ld(N),{campaignId:M=null,campaignName:w=null}=_||{},j={item_id:g,item_name:d.name,index:t??null,item_brand:E||null,hfss_display_restriction_group:T||null,item_list_name:N,item_variant:y?.value.toString()||null,price:P?Number(P):null,rating:p?Number(p):null,quantity:L3(d)||null,is_on_promotion:A,is_favorite:!!I,is_featured:k&&!!_,featured_campaign_id:k?M:null,featured_campaign_name:k?w:null,promotion_ids:A&&R?R:null,seller_id:C?.id||null,can_add_to_cart:oYe(d),...Pl(S??[])};if(i){const G=l?.items?.find(({productId:ye})=>d.productId===ye);if(!G)return j;const{meta:{itemListName:W,favorite:H,featured:{campaignName:K,campaignId:X}={}}}=G,q=W??j.item_list_name,ne=Ld(q),ue=X??j.featured_campaign_id,oe=K??j.featured_campaign_name;return{...j,is_favorite:H??j.is_favorite,item_list_name:q,is_featured:ne&&!!(K||X||j.is_featured),featured_campaign_id:ne?ue:null,featured_campaign_name:ne?oe:null}}return j})};function Ba(e,t){return t in e}function nYe(e,t){return t in e}const L3=e=>typeof e.quantity=="object"?e.quantity?.quantityInBasket:nYe(e,"quantity")&&typeof e.quantity!="object"?e.quantity:Ba(e,"quantityInBasket")&&e.quantityInBasket?e.quantityInBasket:e.addedAmount?e.addedAmount:0,oYe=e=>Ba(e,"available")&&!!(e.available&&!e.maxQuantityReached),rYe=e=>e?.filter(t=>t.retailerPromotionId)?.map(t=>t.retailerPromotionId).join(","),GP=(e,t=15)=>{function*n(o,r){for(let a=0;a<o.length;a+=r)yield o.slice(a,a+r)}return[...n(e,t)]},k3=e=>e.reduce((t,n)=>{const o=L3(n),r=n?.price?.current?.amount??0;return t+Number(r)*o},0),aYe=e=>({event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"MERGE_BASKET_CONFLICT",eventLabel:"Basket merge conflict",ecommerce:{merge:{products:e.map(t=>tn(t))},...BP(e[0])}}),j3=se("GET_CHECKOUT_WALK"),M3="TOGGLE_FREE_GIFT_SELECTED",w3="CLEAR_CHECKOUT_WALK",iYe=()=>({type:"API",payload:{url:"/v2/checkout-walk",...j3}}),lYe=(e,t,n)=>({type:M3,payload:{productId:e,promotionId:t,selected:n}}),cYe=()=>({type:w3}),Hr={getCheckoutWalk:iYe,toggleFreeGiftSelected:lYe,clearCheckoutWalk:cYe,types:{GET_CHECKOUT_WALK:j3,TOGGLE_FREE_GIFT_SELECTED:M3,CLEAR_CHECKOUT_WALK:w3}},Gv=D("pbpm"),F3=e=>{const t=WVe(e);Z.error(t)},dYe=()=>Z.error("basket.remove.item.error"),$P=e=>async t=>{const o=(await t(Rs.addBasketItems(e)))?.payload?.responseData,r=o?.basketUpdateResult?.items?.map(Tv)||[],a=await t(Yt.getBasket({withUpdatedItemsResponse:!0,updatedItems:r}));return a?(o?.basketUpdateResult?.items?.length&&await t(xt.updateProducts({product:o?.basketUpdateResult.items.map(i=>({productId:i.productId,basketLines:i.basketLines}))})),{basket:Xg({basket:a,updatedItems:r}),limitedItems:o?.limitedItems||[],pricingNotifications:o?.pricingNotifications||[]}):null},uYe=e=>async(t,n)=>{const r=(await t(Rs.addBasketFreeGiftItem(e)).then(l=>{t(Hr.toggleFreeGiftSelected(e.productId,e.promotionId,!0));const c=n();if(Gv(c)){const{payload:{responseData:{pricingNotifications:d}}}=l;fu(d)}return l}).catch(l=>{Z.error("basket.add.item.error"),Z.error("toast.notification.generic.error"),Ue.api.pushError(new Error("Could not add free gift to the basket: "),{context:{error:JSON.stringify(l)}}),t(Hr.toggleFreeGiftSelected(e.productId,e.promotionId,!1))}))?.payload?.responseData,a=r?.basketUpdateResult?.items?.map(Tv)||[],i=await t(Yt.getBasket({withUpdatedItemsResponse:!0,updatedItems:a}));return i?(r?.basketUpdateResult?.items?.length&&await t(xt.updateProducts({product:r?.basketUpdateResult.items.map(l=>({productId:l.productId,basketLines:l.basketLines}))})),{basket:Xg({basket:i,updatedItems:a}),limitedItems:r?.limitedItems||[],pricingNotifications:r?.pricingNotifications||[]}):null},B3=e=>async t=>{const o=(SP(e[0])?await t(Rs.removeBasketFreeGiftItem(e[0])):await t(Rs.removeBasketItems(e)))?.payload?.responseData,r=o?.basketUpdateResult?.items?.map(Tv)||[],a=await t(Yt.getBasket({withUpdatedItemsResponse:!0,updatedItems:r}));return a?(o?.basketUpdateResult?.items?.length&&await t(xt.updateProducts({product:o?.basketUpdateResult?.items.map(i=>({productId:i.productId,basketLines:i.basketLines}))})),{basket:Xg({basket:a,updatedItems:r}),limitedItems:o?.limitedItems||[],pricingNotifications:o?.pricingNotifications||[]}):null},pYe=e=>async(t,n)=>{const r=(await t(Rs.removeBasketFreeGiftItem(e)).then(l=>{t(Hr.toggleFreeGiftSelected(e.productId,e.promotionId,!1));const c=n();if(Gv(c)){const{payload:{responseData:{pricingNotifications:d}}}=l;fu(d)}return l}).catch(()=>{Ue.api.pushError(new Error("Could not remove free gift from the basket")),t(Hr.toggleFreeGiftSelected(e.productId,e.promotionId,!0))}))?.payload?.responseData,a=r?.basketUpdateResult?.items?.map(Tv)||[],i=await t(Yt.getBasket({withUpdatedItemsResponse:!0,updatedItems:a}));return i?(r?.basketUpdateResult?.items?.length&&await t(xt.updateProducts({product:r?.basketUpdateResult?.items.map(l=>({productId:l.productId,basketLines:l.basketLines}))})),{basket:Xg({basket:i,updatedItems:a}),limitedItems:r?.limitedItems||[],pricingNotifications:r?.pricingNotifications||[]}):null},mYe=()=>(e,t)=>{const n=t(),o=new qd,r="logged-out-add-toast",a=Z.getNotifications().filter(i=>i.id===r).length!==0;!Xe(n)&&!xc(n).length&&!a&&!o.get(an.NOTIFIED_LOGIN)&&(GVe(n)&&o.set(an.NOTIFIED_LOGIN,!0,{secure:!0,path:fn({basePath:At(n)})}),aV(n)?e(J.openModal("loginPrompt")):e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_handleLoggedOutNotification.key])))},hYe=async(e,t)=>{e(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Body",componentType:"Toast",linkType:"Link",userInteraction:"LINK_CLICKED"}}));const n=t(),o=Oo(n),r=await ko.fetchAnalyticsMetadataByActiveCart(o);e(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:r}));const a=jP(n);te.sendEvent({GA:a,WA:null});const i=MP(n,r);te.sendEvent({GA:i,WA:null})},bp="logged-in-no-slot-toast";let YB=!1;const gYe=e=>{Z.close(bp),e(hYe)},EYe=()=>(e,t)=>{const n=t(),o=new qd,r=Z.getNotifications().filter(a=>a.id===bp).length!==0;!Xe(n)||sE(n)||r||o.get(an.NOTIFIED_BOOKSLOT)||YB||(YB=!0,UVe(n)&&o.set(an.NOTIFIED_BOOKSLOT,!0,{secure:!0,path:fn({basePath:At(n)})}),Z.info("order.slot.bookSlot.reminder",{link:s.jsx(da,{to:Tr({inCheckoutWalk:!1}),label:"order.slot.bookSlot.reminder.book.link",onClick:()=>e(gYe)}),id:bp}))},qB=({basket:e,payload:t,addedByFunction:n,quantity:o=1,type:r})=>a=>a(U.analyticsEvent({type:r,basket:e,page:t.page,position:t.position,section:t.section,productListName:t.productListName,product:[{...t.product,quantity:o}],addedByFunction:n})),fYe=({basketItems:e,limitedItems:t,productId:n})=>o=>{const r=t?.find(a=>a.productId===n);if(r)Z.error(YVe(r.reason));else{const a=e?.find(i=>i.productId===n);a&&o(xt.updateProducts({product:[{productId:n,maxQuantityReached:!!a.quantity.maxQuantityReached}]}))}},U3=({items:e,response:t,itemsAnalyticsPayload:n,addedByFunction:o})=>(r,a)=>{const i=a(),l=Qs(i),{basket:c,limitedItems:d,pricingNotifications:u}=t;c&&(mO.handleBasketRegion(i,c),e.forEach(p=>{const{productId:g,quantity:E}=p;if(r(fYe({basketItems:c.items,limitedItems:d,productId:g})),n){const y=n.find(I=>I.product.productId===g);if(y){const I={...y.product,quantity:E||1};r(qB({basket:c,payload:y,addedByFunction:o||y.addedByFunction,quantity:E,type:Re.ADD_BASKET_ITEM}));const S=wv({products:[I],basket:c,page:y.page,addedByFunction:o||y.addedByFunction,productListName:y.productListName,position:y.position});te.sendEvent({GA:S,WA:null}),r(qB({basket:c,payload:y,addedByFunction:o||y.addedByFunction,quantity:E,type:Re.ADD_TO_CART_GA4})),Fv({basket:c,products:[I],addedByFunction:o||y.addedByFunction||null,page:y.page,productListName:y.productListName||null,position:y.position,featuredProductCampaigns:l}).forEach(T=>{te.sendEvent({GA:T,WA:null})})}}Gv(i)&&fu(u),r(yu(u,[eS.BASKET,eS.ORDERS].some(y=>i.router.location.pathname.includes(y))))}))};let HP=[];const yYe=e=>{HP.push(e)},IYe=()=>{HP=[]},SYe=async(e,t)=>{const n=HP.slice(),o=OV(n);IYe();const r=Object.keys(o).map(a=>{const i={productId:a,...M4(n[0])&&{promotionId:n[0]?.promotionId},quantity:o[a]};return lW({item:i,getState:t,itemsAnalyticsPayload:n})});try{const a=SP(r[0])?await e(uYe(r[0])):await e($P(r));return a?(e(U3({items:r,response:a,itemsAnalyticsPayload:n})),a):null}catch(a){const i=a?.code;F3(i)}return null},CYe=Vr(SYe,250),vYe=()=>e=>(t,n)=>{const{productId:o,quantity:r}=e.product;t(mYe()),t(EYe()),t(Rs.setBatchAdd(o,r||1)),yYe(e),CYe(t,n)},TYe=(e,t)=>async(n,o)=>{try{const r=e.map(i=>lW({item:i,getState:o,itemsAnalyticsPayload:t||[]})),a=await n($P(r));return a?(n(U3({items:r,response:a,itemsAnalyticsPayload:t,addedByFunction:"OFFER_ADD_ALL"})),a):null}catch(r){const a=r?.code;F3(a)}return null},_Ye=({basketItems:e,productId:t,retailerProductId:n})=>(o,r)=>{if(e){const d=e.find(p=>p.productId===t),u=d&&d.quantity?!!d.quantity.maxQuantityReached:!1;o(xt.updateProducts({product:[{productId:t,maxQuantityReached:u}]}))}const a=r(),i=xC(a,t)<=1,l=jye(a,t);i&&l&&o(FP(n))},bYe=({basket:e,product:t,page:n,position:o,section:r,addedByFunction:a,quantity:i=1,featuredProductCampaigns:l})=>c=>{const d=Bv({products:[t],basket:e,page:n,addedByFunction:a,position:o,productListName:"basket: other"});return te.sendEvent({GA:d,WA:null}),Uv({products:[t],basket:e,page:n,addedByFunction:a,position:o,productListName:"basket: other",featuredProductCampaigns:l}).forEach(p=>{te.sendEvent({GA:p,WA:null})}),c(U.analyticsEvent({type:Re.REMOVE_BASKET_ITEM,basket:e,page:n,position:o,section:r,product:[{...t,quantity:i}],addedByFunction:a}))},G3=({addedByFunction:e,items:t,decoratedItems:n})=>async(o,r)=>{const a=r(),i=Qs(a);try{const l=SP(t[0])?await o(pYe(t[0])):await o(B3(t));if(!l)return null;const{basket:c,pricingNotifications:d}=l;return mO.handleBasketRegion(a,c),t.forEach(u=>{const{productId:p}=u,g=n.find(y=>y.product.productId===p);if(!g)return;const{retailerProductId:E}=g.product;o(_Ye({basketItems:c?.items||[],productId:p,retailerProductId:E})),o(bYe({basket:c,product:g.product,page:g.page,position:g.position,section:g.section,quantity:u.quantity,addedByFunction:e||g.addedByFunction,featuredProductCampaigns:i}))}),Gv(a)&&fu(d),o(yu(d,[eS.BASKET,eS.ORDERS].some(u=>a.router.location.pathname.includes(u)))),l}catch{dYe()}return null};let VP=[];const xYe=e=>{VP.push(e)},AYe=()=>{VP=[]},RYe=({dispatch:e,addedByFunction:t})=>{const n=VP.slice(),o=OV(n);AYe();const r=Object.keys(o).map(a=>({productId:a,quantity:o[a],...M4(n[0])&&{promotionId:n[0]?.promotionId}}));return e(G3({addedByFunction:t,items:r,decoratedItems:n}))},DYe=Vr(RYe,250),OYe=e=>t=>n=>{const{productId:o,quantity:r}=t.product;n(Rs.setBatchRemove(o,r||1)),xYe(t),DYe({dispatch:n,addedByFunction:e})},PYe=e=>t=>{const{items:n,decoratedItems:o}=e;return t(G3({addedByFunction:"SMART_SHOP_REMOVE",items:n,decoratedItems:o}))},NYe=()=>async(e,t)=>{const n=t();await e(Rs.emptyCart());const o=xc(n);o.length&&await e(xt.updateProducts({product:o.map(i=>({productId:i.productId,basketLines:[]}))}));const r=await e(Yt.getBasket({withUpdatedItemsResponse:!0})),a=t();return e(U.analyticsEvent({type:Re.EMPTY_CART,prevState:n,nextState:a})),r},ir={createBatchAddToBasket:vYe,addMultipleItemsToBasketAtOnce:TYe,createBatchRemoveFromBasket:OYe,instantShopRemoveFromBasket:PYe,addBasketItems:$P,removeBasketItems:B3,emptyBasket:NYe},LYe=[vr(),na(),OR()];function kYe(e){return!LYe.includes(e)}const jYe=[jt(),vr(),zg()],MYe=({path:e="/",actionType:t,checkoutRestrictions:n})=>{const o=t===mn.types.GET_CART.SUCCESS,r=n?.includes(Pq.INVALID_SLOT)??!1;return o?jYe.some(i=>zr({path:i,end:!1},e))&&r:r};function wYe(e,t){const n=Rt(t);return kYe(e)&&!n}const KB="slot-price-changed-toast",FYe=({state:e,basket:t})=>n=>{const o=e.data.basket?.lastUpdated,r=e.data.basket?.slot?.slotId,a=t?.slot?.slotId;o&&r!==a&&n(yt.setLastFetchedCatalogueLocation(void 0))},BYe=({dispatch:e,getState:t})=>n=>o=>{const r=t(),a=n(o),i=o.type===Pn,l=o?.payload?.location||r.router.location,c=l?.pathname;if((i||Bue(o,r))&&wYe(c,r)&&e(Yt.getBasket({sendAnalytics:i,location:l})),[mn.types.GET_CART.SUCCESS,mn.types.GET_CHECKOUT_CART.SUCCESS].includes(o.type)){const d=pV(o);if(o?.sendAnalytics&&d)try{e(U.analyticsEvent({type:Re.CURRENT_ORDER_ANALYTICS,...d}))}catch{}(d||o.payload?.basket)&&mO.handleBasketRegion(r,d||o.payload?.basket);const u=Z.getNotifications().find(g=>g.id===KB);MYe({path:c,checkoutRestrictions:d?.checkout?.checkoutRestrictions,actionType:o.type})?e(J.openModal(fP)):d?.checkout?.delivery?.deliveryPriceChanged&&!u&&Z.info("slot-price-changed.toast",{id:KB}),e(FYe({state:r,basket:d})),d?.slot&&Z.getNotifications().find(E=>E?.id===bp)&&Z.close(bp)}return a},UYe=({dispatch:e})=>t=>n=>{const o=t(n);return n.type===Pn&&e(kde()),o},$3=e=>({type:"API",payload:{service:"customerloyalty",pathPrefix:{client:"/api/customerloyalty",server:"/core-api"},...e}}),H3=se("GET_CUSTOMER_LOYALTY"),GYe=()=>$3({url:"/v1/web/loyalty/balance",options:{method:"GET"},...H3}),yd={getCustomerLoyalty:GYe,actionTypes:{GET_CUSTOMER_LOYALTY:H3}},$Ye=D("r.glorc"),HYe=D("loyalty"),VYe=({dispatch:e,getState:t})=>n=>o=>{const r=t(),a=n(o);return r.session.isLoggedIn&&o.type===Pn&&HYe(r)&&$Ye(r)&&!Rt(r)&&e(yd.getCustomerLoyalty()),a},WYe=/\/checkout\/3ds\/continue\/?(\?.*)?$/,YYe=/\/checkout\/3ds\/?(\?.*)?$/,qYe=/\/checkout\/summary\/?(\?.*)?$/,KYe=/\/delivery-pass\/subscription\/?(\?.*)?$/,zYe=/\/failed-payment(\/[a-zA-Z0-9-+]*)?\/3ds\/?(\?.*)?$/,QYe=/\/failed-payment(\/[a-zA-Z0-9-+]*)?\/?(\?.*)?$/,XYe=/\/settings\/delivery-pass\/?(\?.*)?$/,ZYe=/\/settings\/wallet\/?(\?.*)?$/,JYe=/\/delivery-pass\/benefit-group-selection\/?(\?.*)?$/,eqe=/\/orders\/?(\?.*)?$/,tqe=[WYe,YYe,KYe,JYe,zYe,QYe,XYe,ZYe],sqe=D("tp.pci"),V3=D("gtm.rl"),nqe=D("cs.pe");D("gpc");const oqe=D("ro.su"),aS=Y(nqe,oqe,(e,t)=>{const n=[...tqe];return e||n.push(qYe),t&&n.push(eqe),n}),rqe=Y(sqe,V3,(e,t)=>e||t),aqe=[{featureFlag:"co.wfe",paths:[/\/checkout\/complete\/?(\?.*)?$/]}],iqe=({getState:e,dispatch:t})=>n=>o=>{if(o.type!==Pn||!o.payload)return n(o);const r=e(),a=nv(r);if(rqe(r)){if(!!aS(r).find(l=>!!o.payload.location.pathname.match(l)))return a.type!==Yr.ALL_ANCHORS&&t(GUe()),n(o);a.type!==Yr.MIXED&&t(cB(aS(r)))}return aqe.forEach(i=>{D(i.featureFlag)(r)&&a.type!==Yr.MIXED&&t(cB(i.paths))}),n(o)},W3=se("CONFIRM_SLOT"),lqe=e=>({type:"API",payload:{service:"ecomslots",pathPrefix:{client:"/api/ecomslots",server:"/core-api"},url:"/v1/slots/confirm",options:{body:e,method:"PUT"},...W3}}),WP={confirmSlot:lqe,types:{CONFIRM_SLOT:W3}},cqe=D("sen"),YP=new qd,Y3=e=>`ExpiryNotification${e}`,dqe=e=>{e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_expiredNotification.key]))},uqe=(e,t)=>{const n=e.split(",").map(i=>Number(i)).sort((i,l)=>i-l),o=Math.ceil(qg(t,Ni())/(1e3*60)),r=n.findIndex(i=>i>o),a=n[r];switch(r){case-1:return;case 0:return{key:"basket.slot.soon.expiring.final.notification",substitutions:{timeToExpiry:a}};default:return{key:"basket.slot.soon.expiring.notification",substitutions:{timeToExpiry:a}}}},qP=({state:e},t)=>{t&&(Z.close(Y3(t)),YP.remove(an.NOTIFIED_EXPIRY,{path:fn({basePath:At(e)})}))},q3=({dispatch:e,state:t},n,o,r)=>{qP({state:t},n),o(),YP.set(an.NOTIFIED_EXPIRY,r,{path:fn({basePath:At(t)})})},pqe=({dispatch:e,state:t},n)=>{q3({dispatch:e,state:t},n,()=>dqe(e),0)},mqe=({dispatch:e,state:t},n,o,r)=>{const a=uqe(o,r),i=a?.substitutions?.timeToExpiry;a&&i?Number(n)!==Number(i)&&q3({dispatch:e,state:t},n,()=>Z.info(a,{id:Y3(i)}),i):qP({state:t},n)},hqe=(e,t)=>{const o=Ct(e)!==t?.orderId,r=!!TC(e)&&!t?.slot;return o&&r},gqe=(e,t)=>{const n=$i(e);return!!n&&n!==t?.deliveryDestinationId},Eqe=({dispatch:e,getState:t})=>n=>o=>{const r=t(),a=n(o),i=o.type===WP.types.CONFIRM_SLOT.SUCCESS,l=o.type===mn.types.GET_CART.SUCCESS||o.type===mn.types.GET_CHECKOUT_CART.SUCCESS;if(!i&&!l)return a;const c=Ze(r,"slot-expiry-notifications-intervals");if(cqe(r)&&c!=="-1"){const u=Number(YP.get(an.NOTIFIED_EXPIRY)??0),p=pV(o),g=hqe(r,p),E=gqe(r,p);if(i||g||E)return qP({state:r},u),a;const y=bue(r),I=p?.slot?.expiryTime;!I&&y?pqe({dispatch:e,state:r},u):I&&c?.length&&mqe({dispatch:e,state:r},u,c,I)}return a},zB=e=>{const t=Vt(e.startTime),n=Vt(e.endTime);return e.type==="ON_DEMAND"?{}:{slot_start_time:t.format($n),slot_end_time:n.format($n)}},fqe=({dispatch:e,getState:t})=>{let n=null;const o=()=>{const r=n?.payload?.confirmationData?.limitedProducts||[];if(!r.length)return;const a=t(),i=is(a),l=r.map(u=>({...u,quantity:u.missingAmount})),c=Bv({products:l,basket:i,page:"slot-booking",addedByFunction:"CONFIRM_SLOT"});te.sendEvent({GA:c,WA:null}),Uv({products:l,basket:i,page:"slot-booking",addedByFunction:"CONFIRM_SLOT",productListName:null,section:"out-of-stock",featuredProductCampaigns:Qs(a)}).forEach(u=>{te.sendEvent({GA:u,WA:null})}),e(U.analyticsEvent({type:Re.REMOVE_BASKET_ITEM,basket:i,product:l,addedByFunction:"CONFIRM_SLOT",page:"slot-booking",section:"out-of-stock"}))};return r=>a=>{const i=r(a),l=t(),c=a.type===wo.types.SET_SELECTED_SLOT,d=a.type===WP.types.CONFIRM_SLOT.SUCCESS;if(!c&&!d)return i;const u=!!a.payload?.confirmationData?.draftBasketId;if(c&&u)return n=a,i;if(c&&!u){e({...a,type:Ve.SLOT_BOOKED}),e({...a,type:Ve.GA4_SLOT_BOOKED});const{payload:{slot:p},deliveryPrice:g}=a,E=ya(p.startTime),y=Ct(l)??"",I=or(l),S={event:"slot_booked",method:lg[p.deliveryMethod],osp_transaction_id:y,group_id:I,...zB(p),slot_date:E.format(Ta),slot_day:E.isoWeekday(),slot_type:p.type,slot_price:parseFloat(g.amount),site_id:""};return te.sendEvent({GA:S,WA:null}),n=null,i}if(d){if(n){e({...n,type:Ve.SLOT_BOOKED}),e({...n,type:Ve.GA4_SLOT_BOOKED});const{payload:{slot:p},deliveryPrice:g}=n,E=ya(p.startTime),y=Ct(l)??"",I=or(l),S={event:"slot_booked",method:lg[p.deliveryMethod],osp_transaction_id:y,group_id:I,...zB(p),slot_date:E.format(Ta),slot_day:E.isoWeekday(),slot_type:p.type,slot_price:parseFloat(g.amount),site_id:""};te.sendEvent({GA:S,WA:null}),o(),n=null}return i}return i}},yqe=e=>Object.values(mn.types).find(t=>t.SUCCESS===e.type);function Iqe(e){return e.type===Pn&&e.payload?.isFirstRendering}const Sqe=({dispatch:e,getState:t})=>n=>o=>{const r=n(o),a=t();if(Iqe(o)||yqe(o)){const c=zs(a),d=ome(a);d&&!c.isFetching&&c.data?.deliveryDestinationId!==d&&e(hn.getSelectedDeliveryDestinationData(d))}const i=Hp(a);if(D("dds.a")(a)&&i&&o.type===Rs.types.ADD_BASKET_ITEM.SUCCESS){const c=a.data.basket?.items||[],u=zs(a)?.data?.deliveryDestinationId;if(!c.length&&!u){const p=Xe(a);e(J.openModal(p?fm:Fd))}}return r},K3=()=>"/delivery-pass",Lc=({queryString:e=""}={})=>`${K3()}/subscription${e}`,Cqe=()=>`${K3()}/benefit-group-selection`,vqe=e=>`/api/customer/v1/benefit-groups/delivery-pass/subscription/${e}/receipt`,z3="failed-payment-not-updatable",Tqe="3ds",_qe="reason",Q3="pay.nsc",bqe="pay.ew",X3="pay.ywlt",xqe="dp.freetrial",KP="m.la.h",Z3="pay.slct",Aqe="pay.invoice",J3="lumpSum",qt={VISA:"visa",MASTERCARD:"mastercard",AMEX:"amex",PAYPAL:"paypal",INVOICE:"invoice",FINANCING_OPTION_ICON:"financing_option_1",BLIK:"blik",BANK_TRANSFER:"bank_transfer",PAYMENT_CARD:"payment_card",VISA_PHONE:"visa_phone",GOOGLE_PAY:"google_pay",APPLE_PAY:"apple_pay",SMARTNEY:"smartney",ONEY:"oney",L_PAY:"lpay",NAVERPAY:"naverpay",KAKAOPAY:"kakaopay"},Rqe=({pathname:e})=>{switch(e){case ar():case Lc():return`${e}?openPaymentModal=true`;case vr():case Sg():default:return e}},zP=e=>{const t=/^https:\/\/[a-zA-Z0-9-]+\.mastercard\.com$/,{hostname:n}=window.location,r=`https://pspweb.${n.indexOf("www.")===0?n.split("www.")[1]:n}`;return e===r||t.test(e)},Dqe=({lastFourDigits:e,expiryMonth:t,expiryYear:n})=>{const o=`**** ${e}`,r=n?`(${t}/${n.slice(-2)})`:"";return e&&t&&n?`${o} ${r}`:e?o:r},Oqe=e=>{e.notification===z3&&Pqe();const t=QB({queryParams:e,key:Tqe});if(!t)return;const n=QB({queryParams:e,key:_qe});Nqe(n||t)},QB=({queryParams:e,key:t})=>{const n=e[t];return!n||typeof n=="string"?n:Array.isArray(n)?n[0]:n},Pqe=()=>Z.error(e5[z3]),Nqe=e=>{const t=e5[`3ds-${e}`];t&&Z.error(t)},e5={"failed-payment-not-updatable":"payment.failed.not.updatable","3ds-failure":"order.cow.3ds.failure","3ds-cancelled":"order.cow.3ds.user.cancelled","3ds-token-not-found":"payments.notification.token.not.found.error"},Lqe=({dispatch:e,getState:t})=>{const n=t(),o=D("mins")(n),r=PP(n);if(!o||!r)return;const a=NE(n),i=Ra(n);e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_minimumOrderChangedNotification.key])),e(U.analyticsEvent({type:Re.MINIMUM_BASKET_VALUE_CHANGED_NOTIFICATION_DISPLAYED,minimumBasketValueAmount:a?.amount,basketValueAmount:i?.amount,basketValueCurrency:i?.currency}))},kqe=({getState:e,dispatch:t})=>n=>o=>{if(o.type!==Pn||!o.payload)return n(o);const r=e(),{data:{basket:{slot:a}}}=r,i=D("oosa")(r),l=D("bt.spl")(r),c=D("sl.fd")(r),d=D("misbc")(r),u=u3(r),p=Qe.parse(o.payload.location.search),E=[...u.map(y=>_o[y]),...Z.getNotifications()].find(y=>y.id===jqe[Ed]);return i&&a&&p[Ed]&&!E&&Mqe(t,a,c),a&&p["min-spend-changed"]&&!d&&Lqe({dispatch:t,getState:e}),l&&a&&p[Ed]===y4&&Uqe(),Oqe(p),n(o)},jqe={"slot-booked":"slotbooking.confirm.alert"},Mqe=(e,t,n=!1)=>{const o=t.deliveryMethod===pt.clickAndCollect.method,r=t.deliveryMethod===pt.vanDelivery.method,a=t.slotType===Qa;if(a&&r&&n){Fqe(e);return}if(o){if(a){wqe(e);return}Bqe(e);return}e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_showSlotBookedToast.key]))},wqe=e=>{e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_showExpressCollectionBookedToast.key]))},Fqe=e=>{e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_showFastDeliverBookedToast.key]))},Bqe=e=>{e(ro.LEGACY_addServerSideNotifications([_o.LEGACY_showMultidayOrStandardCustomerCollectioBookedToast.key]))},Uqe=()=>{Z.success("slotbooking.grocery.slot.booked.info")},xp="outOfStockAlternatives",ib="out-of-stock-alternatives-modal-name-header-label",Gqe="OUT_OF_STOCK_ALTERNATIVES",$qe=({dispatch:e,getState:t})=>n=>o=>{const r=t(),a=n(o),i=$e(xp)(r);return o.type===Pn&&!o.payload?.isFirstRendering&&i&&e(J.closeModal()),a},oo={ASSISTANT:"ASSISTANT",USER:"USER"},Ks={CREATE_CHAT:se("CREATE_CHAT"),SEND_MESSAGE:se("SEND_MESSAGE"),GET_CHAT_HISTORY:se("GET_CHAT_HISTORY"),SET_CHAT:"SET_CHAT",SET_SHOW_REFRESH_DIALOG:"SET_SHOW_REFRESH_DIALOG",CLEAR_CHAT:"CLEAR_CHAT",DISABLE_FLOWOUT:"DISABLE_FLOWOUT"},QP={service:"ecomllminterface",pathPrefix:{client:"/api/chat",server:"/core-api"}},Hqe=()=>({type:"API",payload:{url:"/v1/chat",options:{method:"POST"},...QP,...Ks.CREATE_CHAT},timestamp:de()}),Vqe=e=>({type:Ks.SET_CHAT,payload:{chatId:e}}),Wqe=()=>({type:Ks.CLEAR_CHAT}),XB=()=>({type:Ks.DISABLE_FLOWOUT}),XP=e=>({type:Ks.SET_SHOW_REFRESH_DIALOG,payload:{showRefreshDialog:e}}),Yqe=(e,t)=>({type:"API",payload:{url:`/v1/chat/${e}/messages?imageFormat=avif`,options:{method:"PUT",body:{message:t}},...QP,...Ks.SEND_MESSAGE},message:t,timestamp:de()}),qqe=e=>({type:"API",payload:{url:`/v1/chat/${e}/messages?imageFormat=avif`,...QP,...Ks.GET_CHAT_HISTORY}});class t5{name;constructor(t){this.name=t}store(t,n){let o;if(n){const r=de()+n;o=CR(r)}try{localStorage.setItem(this.name,JSON.stringify({data:t,expiryTime:o}))}catch(r){Ue.api.pushError(r instanceof Error?r:new Error(`cacheStore error: ${JSON.stringify(r)}`),{context:{items:JSON.stringify(Object.keys(localStorage)),attempted:JSON.stringify(t).slice(0,50),attemptedSize:JSON.stringify(t).length.toString(),isIncognito:JSON.stringify(!window.indexedDB)}})}}get(){const t=localStorage.getItem(this.name);return t?JSON.parse(t):null}remove(){localStorage.removeItem(this.name)}exists(){return localStorage.getItem(this.name)!==null}hasExpired(){const t=de(),n=localStorage.getItem(this.name);if(n){const o=JSON.parse(n);return o.expiryTime&&t>eg(o.expiryTime)}return!1}}let ul;function lh(e,t,n){ul||(ul=new t5("recipe-chat-cache")),ul.store({chatId:e,isOpen:t},n?eg(n)-de():void 0)}function Kqe(){ul&&ul.remove()}function s5(){if(!(typeof window>"u")&&(ul||(ul=new t5("recipe-chat-cache")),!ul.hasExpired()))return ul.get()?.data}const zqe=e=>t=>n=>{switch(n.type){case Ks.SEND_MESSAGE.PENDING:{const{chatId:o,messageHistory:r}=e.getState().data.recipes.chat.data;if(!r)break;if(e.dispatch(U.analyticsEvent({type:vh,CHAT_ID:o,MESSAGE_FROM:oo.USER,MESSAGE_TYPE:zl.TEXT,SEQUENCE:r.length})),o){const a={event:"recipe_assistant_message",id:o,index:r.length,origin:oo.USER,type:zl.TEXT};te.sendEvent({GA:a,WA:null})}break}case Ks.CLEAR_CHAT:case Ks.CREATE_CHAT.PENDING:Kqe();break;case Ks.CREATE_CHAT.SUCCESS:{const{chatId:o,expiryTime:r}=n.payload.responseData,a=$e("recipesChatModal")(e.getState());if(lh(o,a,r),e.dispatch(U.analyticsEvent({type:vh,CHAT_ID:o,MESSAGE_FROM:oo.ASSISTANT,MESSAGE_TYPE:zl.TEXT,SEQUENCE:0})),o){const i={event:"recipe_assistant_message",id:o,index:0,origin:oo.ASSISTANT,type:zl.TEXT};te.sendEvent({GA:i,WA:null})}break}case Ks.GET_CHAT_HISTORY.SUCCESS:{const{chatId:o,expiryTime:r}=n.payload.responseData,a=$e("recipesChatModal")(e.getState());lh(o,a,r);break}case Ks.SEND_MESSAGE.SUCCESS:{const{chatId:o,responseMessage:r,expiryTime:a}=n.payload.responseData,i=$e("recipesChatModal")(e.getState()),{messageHistory:l}=e.getState().data.recipes.chat.data;if(lh(o,i,a),!l)break;if(e.dispatch(U.analyticsEvent({type:vh,CHAT_ID:o,MESSAGE_FROM:r.role,MESSAGE_TYPE:r.results&&r.results.length>0?zl.RECIPE_IMPRESSION:zl.TEXT,SEQUENCE:l.length})),o){const c={event:"recipe_assistant_message",id:o,index:l.length,origin:r.role,type:r.results&&r.results.length>0?zl.RECIPE_IMPRESSION:zl.TEXT};te.sendEvent({GA:c,WA:null})}break}case J.actionTypes.OPEN_MODAL:{if(n.payload?.modalName!=="recipesChatModal")break;const{chatId:o,expiryTime:r}=e.getState().data.recipes.chat.data;o&&lh(o,!0,r);break}case J.actionTypes.CLOSE_MODAL:{const{chatId:o,expiryTime:r}=e.getState().data.recipes.chat.data,a=!!s5()?.isOpen;if(!$e("recipesChatModal")(e.getState())){if(a)return t(J.openModal("recipesChatModal"));break}o&&lh(o,!1,r);break}}return t(n)},Qqe=e=>t=>n=>{const o=t(n);if(n.type===Pn){const r=e.getState(),a=$e("recipesChatModal")(r),i=n?.payload?.location?.state?.recipeCardClickedInMobile;a&&i&&e.dispatch(J.closeModal())}return o},Xqe={token:""},Zqe=(e=Xqe)=>e,Na=({session:e})=>e.csrf.token,n5=e=>typeof e=="object"&&e!==null;class sA extends Error{statusCode;code;data;constructor(t,n,o,r,a){super(t),this.statusCode=n,this.message=o,this.data=r,this.code=a}hasData=()=>n5(this.data);hasCode=()=>typeof this.code=="string"&&this.code.length>0}function Jqe(e){let t;const n=e.headers&&e.headers.get("content-type");return n&&n.includes("application/json")?t=e.json().catch(()=>Promise.resolve({})):t=e.text().catch(()=>Promise.resolve("")),Promise.all([t,e.status,e.ok])}function eKe([e,t,n]){if(!n){const o=`Request failed with status code ${t}`;return Promise.reject(n5(e)?new sA(o,t,typeof e.message=="string"?e.message:o,e.data,e.code):new sA(o,t,o))}return Promise.resolve(e)}function tKe(e,t,n,o,r=""){const a=e.pathPrefix?e.pathPrefix.client??"":"/api",i=`${r}${a}${e.url}`;return fetch(i,{credentials:"same-origin",...t}).then(Jqe).then(eKe).then(l=>(e.onSuccess&&n(e.onSuccess),n({type:e.SUCCESS,payload:{responseData:l},...o}))).catch(l=>{throw n({type:e.ERROR,payload:l,skipLoginRedirect:!!e.skipLoginRedirect,error:!0,...o}),l})}const sKe=({dispatch:e,getState:t})=>n=>o=>{if(o.type!=="API")return n(o);const{payload:r,type:a,...i}=o,{options:l={}}=r,{body:c,headers:d={},method:u}=l,p=u&&u!=="GET"?{"X-CSRF-TOKEN":Na(t())}:{};c&&(Object.keys(d).some(y=>y.toLowerCase()==="content-type")||(l.body=JSON.stringify(c),l.headers={...d,"content-type":"application/json; charset=utf-8"})),l.headers={...p,"client-route-id":Do(t()),"ecom-request-source":"web","ecom-request-source-version":CC(t()),accept:"application/json; charset=utf-8",...l.headers},e({type:r.PENDING,...i});const g=At(t());return tKe(r,l,e,i,g)},ZP=new qd,nKe={sameSite:"strict",secure:!0,path:"/"},oKe=()=>{ZP.set(an.AGE_CONFIRMATION_COOKIE,!0,{...nKe,domain:window.location.hostname})},JP=()=>{ZP.remove(an.AGE_CONFIRMATION_COOKIE,{path:"/",domain:window.location.hostname})},rKe=()=>!!ZP.get(an.AGE_CONFIRMATION_COOKIE),aKe=({getState:e})=>t=>{let n=!0;return o=>{if(o.error&&(o.payload?.statusCode===401||o.payload?.statusCode===403)&&!o.skipLoginRedirect){n=!1,JP();const r=At(e()),a=`${window.location.pathname}${window.location.search||""}`;return window.location.replace(Yo({basePath:r,queryString:`destination=${encodeURIComponent(a)}`})),Promise.resolve()}return n&&t(o)}},iKe="SET_ADD_CARD_FRAME_URL",lKe="RESET_ADD_CARD_FRAME_URL",cKe=se("SUBMIT_ADD_CARD_REFERENCE"),nA={actionTypes:{SET_ADD_CARD_FRAME_URL:iKe,RESET_ADD_CARD_FRAME_URL:lKe,SUBMIT_ADD_CARD_REFERENCE:cKe}},dKe=(e=ms.addWalletItemModal,t)=>{switch(t.type){case nA.actionTypes.SET_ADD_CARD_FRAME_URL:return{...e,datacashUrl:t.payload};case nA.actionTypes.RESET_ADD_CARD_FRAME_URL:return{...e,datacashUrl:null};default:return e}},o5="SET_ADD_WALLET_PSPWEB_FRAME_URL",r5="RESET_ADD_WALLET_PSPWEB_FRAME_URL",uKe=e=>({type:o5,payload:e}),pKe=()=>({type:r5}),iS={setAddWalletPspwebFrameUrl:uKe,resetAddWalletPspwebFrameUrl:pKe,actionTypes:{SET_ADD_WALLET_PSPWEB_FRAME_URL:o5,RESET_ADD_WALLET_PSPWEB_FRAME_URL:r5}},mKe=(e=ms.addWalletItemModal,t)=>{switch(t.type){case iS.actionTypes.SET_ADD_WALLET_PSPWEB_FRAME_URL:return{...e,pspwebUrl:t.payload};case iS.actionTypes.RESET_ADD_WALLET_PSPWEB_FRAME_URL:return{...e,pspwebUrl:null};default:return e}},hKe=({control:e})=>e?.addPspwebWalletItemModal?.pspwebUrl,gKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}},EKe=(e=gKe,t)=>{switch(t.type){case"GET_CART_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}};case"GET_CART_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}};case"GET_CART_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{belowGrid:n.advertisingBanners?.belowGrid||[]}}}default:return e}},fKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}},yKe=(e=fKe,t)=>{switch(t.type){case"GET_CATEGORY_PAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_CATEGORY_PAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_CATEGORY_PAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{aboveGrid:n.advertisingBanners?.aboveGrid||[],withinGrid:n.advertisingBanners?.withinGrid||[]}}}default:return e}},IKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}},SKe=(e=IKe,t)=>{switch(t.type){case"GET_SEARCH_PAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_SEARCH_PAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_SEARCH_PAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{aboveGrid:n.advertisingBanners?.aboveGrid||[],withinGrid:n.advertisingBanners?.withinGrid||[]}}}default:return e}},CKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}},vKe=(e=CKe,t)=>{switch(t.type){case"GET_PROMOTIONS_PAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_PROMOTIONS_PAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_PROMOTIONS_PAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{aboveGrid:n.advertisingBanners?.aboveGrid||[],withinGrid:n.advertisingBanners?.withinGrid||[]}}}default:return e}},TKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[]}},_Ke=(e=TKe,t)=>{switch(t.type){case"GET_PROMOTION_DETAILS_PAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[]}};case"GET_PROMOTION_DETAILS_PAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[]}};case"GET_PROMOTION_DETAILS_PAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{aboveGrid:n.advertisingBanners?.aboveGrid||[]}}}default:return e}},bKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{hero:[],aboveGrid:[],withinGrid:[]}},xKe=(e=bKe,t)=>{switch(t.type){case"GET_HOMEPAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{hero:[],aboveGrid:[],withinGrid:[]}};case"GET_HOMEPAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{hero:[],aboveGrid:[],withinGrid:[]}};case"GET_HOMEPAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{hero:n.advertisingBanners?.hero||[],aboveGrid:n.advertisingBanners?.aboveGrid||[],withinGrid:n.advertisingBanners?.withinGrid||[]}}}default:return e}},AKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}},RKe=(e=AKe,t)=>{switch(t.type){case"GET_FAVORITES_PAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_FAVORITES_PAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],withinGrid:[]}};case"GET_FAVORITES_PAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{aboveGrid:n.advertisingBanners?.aboveGrid||[],withinGrid:n.advertisingBanners?.withinGrid||[]}}}default:return e}},DKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}},OKe=(e=DKe,t)=>{switch(t.type){case"GET_SLOT_BOOKING_PAGE_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}};case"GET_SLOT_BOOKING_PAGE_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}};case"GET_SLOT_BOOKING_PAGE_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{belowGrid:n?.advertisingBanners?.belowGrid||[]}}}default:return e}},Gy=se("GET_PRODUCT_DETAILS_PAGE_ADVERTS"),PKe=e=>{const t=Qe.stringify({page:"PRODUCT_DETAILS",key:e},{sort:!1});return{type:"API",retailerProductId:e,payload:{url:`/v1/content?${t}`,...Gy}}},NKe={},LKe=(e=NKe,t)=>{switch(t.type){case Gy.PENDING:return{...e,[t.retailerProductId]:{...je,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],belowGrid:[]}}};case Gy.ERROR:return{...e,[t.retailerProductId]:{...je,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{aboveGrid:[],belowGrid:[]}}};case Gy.SUCCESS:return{...e,[t.retailerProductId]:{...je,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:t.payload.responseData.advertSettings,placement:{aboveGrid:t.payload.responseData.advertisingBanners?.aboveGrid||[],belowGrid:t.payload.responseData.advertisingBanners?.belowGrid||[]}}};default:return e}},kKe={...je,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}},jKe=(e=kKe,t)=>{switch(t.type){case"GET_ORDER_CONFIRMATION_ADVERTS_PENDING":return{...e,isFetching:!0,fetchError:!1,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}};case"GET_ORDER_CONFIRMATION_ADVERTS_ERROR":return{...e,isFetching:!1,fetchError:!0,settings:{randomizeInitialHorizontalAdvert:!1},placement:{belowGrid:[]}};case"GET_ORDER_CONFIRMATION_ADVERTS_SUCCESS":{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),settings:n.advertSettings,placement:{belowGrid:n.advertisingBanners?.belowGrid||[]}}}default:return e}},MKe=Us({cartPage:EKe,categoryPage:yKe,searchPage:SKe,promotionsPage:vKe,promotionDetailsPage:_Ke,homepage:xKe,favoritesPage:RKe,productDetailsPage:LKe,slotBookingPage:OKe,orderConfirmationPage:jKe}),al={THIS_ORDER_ONLY:"THIS_ORDER_ONLY",THIS_AND_FUTURE_ORDERS:"THIS_AND_FUTURE_ORDERS"},mh="WEEKS",wKe=[mh],a5="WEEKS_1",FKe="WEEKS_2",BKe="WEEKS_3",UKe="WEEKS_4",er="NONE",Sl="recurringshopping",GKe={[a5]:{unit:mh,value:1},[FKe]:{unit:mh,value:2},[BKe]:{unit:mh,value:3},[UKe]:{unit:mh,value:4}},Ko="recurring-shopping-definition-create-frequency",hr="recurring-shopping-definition-create-name",$Ke={recurringShoppingDefinition:"",recurringName:"",editRecurringOrderOption:al.THIS_ORDER_ONLY},HKe=(e=$Ke,t)=>{switch(t.type){case Le.RECURRING_SHOPPING_DEFINITION_LABEL_WRITTEN:return{...e,recurringName:t.payload.data.recurringFrequencyName};case Le.RECURRING_SHOPPING_DEFINITION_FREQUENCY_SELECTED:return{...e,recurringShoppingDefinition:t.payload.data.recurringFrequency};case"RECURRING_SHOPPING_DEFINITION_FORM_RESET":return{...e,recurringName:void 0,recurringShoppingDefinition:void 0};case"EDIT_RECURRING_ORDER_OPTION":return{...e,editRecurringOrderOption:t.payload.editOption};default:return e}},$v=({data:{checkout:e}})=>e,i5=Y($v,e=>e?.recurringName),jE=Y($v,e=>e?.recurringShoppingDefinition),VKe=Y($v,e=>e?.recurringShoppingDefinition===er&&!e?.recurringName||e?.recurringName&&e.recurringShoppingDefinition&&e.recurringShoppingDefinition!==er||!e?.recurringShoppingDefinition&&!e?.recurringName),WKe=Y($v,e=>({recurringName:e?.recurringName&&e?.recurringShoppingDefinition&&e?.recurringShoppingDefinition!==er||e?.recurringShoppingDefinition===er&&!e?.recurringName||!e?.recurringShoppingDefinition&&!e?.recurringName,recurringShoppingDefinition:e?.recurringShoppingDefinition&&e?.recurringShoppingDefinition!==er||e?.recurringShoppingDefinition===er&&!e?.recurringName||!e?.recurringShoppingDefinition&&!e?.recurringName})),l5=({data:e})=>e.checkout.editRecurringOrderOption,c5="SET_UNSELECTED_PAYMENT_WARNING",d5="INITIATE_PAYMENT",u5="FINISH_PAYMENT",p5="SET_TO_SAVE_PAYMENT_METHOD",m5="SET_IS_TO_SAVE_PAYMENT_METHOD_VALID",h5="SET_PAYMENT_OPTION_AND_TYPE",g5="SET_FINANCING_OPTION",E5="SET_FINANCING_PROVIDERS",YKe=e=>({type:c5,payload:{show:e}}),qKe=e=>({type:p5,payload:{toSavePaymentMethod:e}}),KKe=e=>({type:m5,payload:{isToSavePaymentMethodValid:e}}),zKe=()=>({type:d5}),QKe=()=>({type:u5}),XKe=e=>({type:h5,payload:{options:e}}),ZKe=e=>({type:g5,payload:{financingOption:e}}),JKe=({retailerFinancingProviderId:e,financingProviderId:t})=>({type:E5,payload:{financingProviderId:t,retailerFinancingProviderId:e}}),Gt={setUnselectedPaymentWarning:YKe,initiatePayment:zKe,finishPayment:QKe,setToSavePaymentMethod:qKe,setIsToSavePaymentMethodValid:KKe,setPaymentOptionAndType:XKe,setFinancingOption:ZKe,setFinancingProviders:JKe,actionTypes:{SET_UNSELECTED_PAYMENT_WARNING:c5,INITIATE_PAYMENT:d5,FINISH_PAYMENT:u5,SET_TO_SAVE_PAYMENT_METHOD:p5,SET_IS_TO_SAVE_PAYMENT_METHOD_VALID:m5,SET_PAYMENT_OPTION_AND_TYPE:h5,SET_FINANCING_OPTION:g5,SET_FINANCING_PROVIDERS:E5}},ZB={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null},f5={unselectedPaymentMethodWarning:!1,isPaymentActive:!1,toSavePaymentMethod:!0,isToSavePaymentMethodValid:!0,paymentOption:"UNKNOWN",paymentType:null,threeDsRecoveryUrls:{...ZB,data:{}},paymentChecks:{...ZB,availablePaymentChecks:[],checksMissingRequiredTotal:[]}},eze=(e=f5,t)=>{switch(t.type){case Gt.actionTypes.SET_UNSELECTED_PAYMENT_WARNING:return{...e,unselectedPaymentMethodWarning:t.payload.show};case Gt.actionTypes.INITIATE_PAYMENT:return{...e,isPaymentActive:!0};case Gt.actionTypes.FINISH_PAYMENT:return{...e,isPaymentActive:!1};case Gt.actionTypes.SET_TO_SAVE_PAYMENT_METHOD:return{...e,toSavePaymentMethod:t.payload.toSavePaymentMethod};case Gt.actionTypes.SET_IS_TO_SAVE_PAYMENT_METHOD_VALID:return{...e,isToSavePaymentMethodValid:t.payload.isToSavePaymentMethodValid};case Gt.actionTypes.SET_PAYMENT_OPTION_AND_TYPE:return{...e,paymentOption:t.payload.options.paymentOption,paymentType:t.payload.options.paymentType};case Gt.actionTypes.SET_FINANCING_OPTION:return{...e,financingOption:t.payload.financingOption};case Gt.actionTypes.SET_FINANCING_PROVIDERS:return{...e,financingProviderId:t.payload.financingProviderId,retailerFinancingProviderId:t.payload.retailerFinancingProviderId};default:return e}},tze=({control:e})=>e.payments.unselectedPaymentMethodWarning,sze=({control:e})=>e.payments.isPaymentActive,ME=({control:e})=>e.payments.toSavePaymentMethod,eN=e=>{const t=jE(e);return!!(t&&t!==er)},nze=({control:e})=>e.payments.isToSavePaymentMethodValid,tN=({control:e})=>e.payments.paymentOption,oze=({control:e})=>e.payments.paymentType,Im=Y(tN,oze,(e,t)=>({paymentOption:e,paymentType:t})),sN=({control:e})=>e.payments.retailerFinancingProviderId,nN=({control:e})=>e.payments.financingProviderId,y5=({control:e})=>e.payments.financingOption;function oN(...e){return(t,n)=>e.reduce((o,r)=>r(o,n),t)}const rze=(e=Qo,t)=>{switch(t.type){case Rs.types.ADD_BASKET_ITEM.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Rs.types.REMOVE_BASKET_ITEM.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Rs.types.ADD_BASKET_ITEM.SUCCESS:case Rs.types.ADD_BASKET_FREE_GIFT_ITEM.SUCCESS:case Rs.types.REMOVE_BASKET_ITEM.SUCCESS:case Rs.types.REMOVE_BASKET_FREE_GIFT_ITEM.SUCCESS:return{...e,limitedPromotionIds:t.payload.responseData.limitedPromotionIds};case Rs.types.EMPTY_CART.SUCCESS:return{...e,limitedPromotionIds:[]};default:return e}},I5=se("BASKET_CHECKOUT_START"),aze=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/checkout-start",options:{body:{shippingGroupType:e},method:"POST"},...I5}}),$y={basketCheckoutStart:aze,types:{BASKET_CHECKOUT_START:I5}},ize=(e=Qo,t)=>{switch(t.type){case $y.types.BASKET_CHECKOUT_START.PENDING:return{...e,isFetching:!0,fetchError:!1};case $y.types.BASKET_CHECKOUT_START.SUCCESS:return{...e,lastUpdated:de(),isFetching:!1,fetchError:!1};case $y.types.BASKET_CHECKOUT_START.ERROR:return{...e,error:t.payload,isFetching:!1,fetchError:!0};default:return e}},S5=se("ADD_VOUCHER_TO_BASKET"),C5=se("ADD_VOUCHER_WITH_MARKETING_CONSENT"),v5=se("REMOVE_VOUCHER_FROM_BASKET"),lze=e=>({type:"API",payload:{url:"/v1/carts/active/vouchers",pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",options:{body:[e],method:"POST"},...S5}}),cze=(e,t)=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},options:{method:"PUT",body:{voucherCode:e,consentProvided:t}},url:"/v2/carts/active/vouchers",...C5}}),dze=e=>({type:"API",payload:{url:`/v1/carts/active/vouchers/${e}`,pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",options:{method:"DELETE"},...v5}}),ec={addVoucherToBasket:lze,removeVoucherFromBasket:dze,addVoucherWithMarketingPreferences:cze,types:{ADD_VOUCHER_TO_BASKET:S5,REMOVE_VOUCHER_FROM_BASKET:v5,ADD_VOUCHER_WITH_MARKETING_CONSENT:C5}},uze=(e=Qo,t)=>{switch(t.type){case ec.types.REMOVE_VOUCHER_FROM_BASKET.SUCCESS:return{...t.payload.responseData,isFetching:!1,fetchError:!1,isVoucherError:!1,isVoucherFetching:!1,lastUpdated:de(),voucher:void 0};case ec.types.REMOVE_VOUCHER_FROM_BASKET.ERROR:case ec.types.ADD_VOUCHER_WITH_MARKETING_CONSENT.ERROR:return{...e,isFetching:!1,fetchError:!0,isVoucherError:!0,isVoucherFetching:!1,lastUpdated:de(),error:t.payload};case ec.types.ADD_VOUCHER_WITH_MARKETING_CONSENT.PENDING:return{...e,isVoucherFetching:!0,isVoucherError:!1,lastUpdated:de()};case ec.types.ADD_VOUCHER_WITH_MARKETING_CONSENT.SUCCESS:return{...e,isVoucherFetching:!1,isVoucherError:!1,lastUpdated:de()};default:return e}},T5=se("ADD_LOYALTY_UNITS_TO_BASKET"),_5=se("REMOVE_LOYALTY_UNITS_FROM_BASKET"),pze=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/loyalty",options:{...e&&{body:{intendedPoints:e}},method:"POST"},...T5}}),mze=()=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/loyalty",options:{method:"DELETE"},..._5}}),lS={addLoyaltyUnitsToBasket:pze,removeLoyaltyUnitsFromBasket:mze,types:{ADD_LOYALTY_UNITS_TO_BASKET:T5,REMOVE_LOYALTY_UNITS_FROM_BASKET:_5}},hze=(e=Qo,t)=>{switch(t.type){case lS.types.ADD_LOYALTY_UNITS_TO_BASKET.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case lS.types.REMOVE_LOYALTY_UNITS_FROM_BASKET.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};default:return e}},b5="REMOVE_APPLIED_PAYMENT_CHECKS_FROM_BASKET",gze=()=>({type:b5}),rN={removedAppliedPaymentChecksFromBasket:gze,types:{REMOVE_APPLIED_PAYMENT_CHECKS_FROM_BASKET:b5}},Eze=(e=Qo,t)=>{switch(t.type){case rN.types.REMOVE_APPLIED_PAYMENT_CHECKS_FROM_BASKET:return{...e,appliedPaymentChecks:null,removedPaymentChecks:null,totals:{...e.totals,paymentSplit:{paidByLoyalty:void 0,remainingPayment:void 0}}};default:return e}},fze=oN(_ue,rze,uze,hze,Eze,ize),x5=se("MERGE_BASKET_VIA_CART_TOKEN"),A5="SET_MERGE_RESULT",R5="CLEAR_MERGE_RESULT",D5=se("MERGE_BASKET"),yze=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/merge-items",options:{method:"POST",body:{...e&&{visitorId:e},...!e&&{mergeBaseBasketToOrderEdition:!0}}},...D5}}),Ize=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v9/baskets/merge",options:{headers:{"content-type":"application/jwt"},method:"POST",body:e},...x5}}),Sze=({limitedItems:e,destination:t,sourceEventId:n})=>({type:A5,payload:{limitedItems:e,destination:t,sourceEventId:n}}),Cze=()=>({type:R5}),yr={mergeBasketViaCartToken:Ize,mergeBasket:yze,setMergeResult:Sze,clearMergeResult:Cze,types:{MERGE_BASKET_VIA_CART_TOKEN:x5,MERGE_BASKET:D5,SET_MERGE_RESULT:A5,CLEAR_MERGE_RESULT:R5}},JB={...je,mergeResults:{}},vze=(e=JB,t)=>{switch(t.type){case yr.types.MERGE_BASKET_VIA_CART_TOKEN.ERROR:case yr.types.MERGE_BASKET.ERROR:return{...e,isFetching:!1,fetchError:!0,lastUpdated:de(),error:t.payload};case yr.types.MERGE_BASKET_VIA_CART_TOKEN.SUCCESS:case yr.types.MERGE_BASKET.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),mergeResults:t.payload.responseData};case yr.types.SET_MERGE_RESULT:return{...e,lastUpdated:de(),mergeResults:t.payload};case yr.types.CLEAR_MERGE_RESULT:return JB;default:return e}},O5={items:[],currentInFlightRequests:0,currentBouncedAddItemRequests:0,currentBouncedRemoveItemRequests:0,maximumInFlightRequests:0},Hv=(e=[],t=[])=>{const n=new Map(e.map(o=>[o.productId,{...o,quantity:{...o.quantity}}]));for(const{productId:o,delta:r}of t){const i=(n.get(o)?.quantity?.quantityInBasket??0)+r;n.set(o,{productId:o,quantity:{maxQuantityReached:!1,quantityInBasket:Math.max(0,i)}})}return Array.from(n.values())},P5=e=>e&&(e.currentInFlightRequests>=1||e.currentBouncedAddItemRequests>=1||e.currentBouncedRemoveItemRequests>=1),Tze=e=>e?e.currentInFlightRequests+e.currentBouncedAddItemRequests+e.currentBouncedRemoveItemRequests>1:!1,cS=e=>{const{currentInFlightRequests:t}=e;if(t===1)return{currentInFlightRequests:0,maximumInFlightRequests:0};const n=t-1;return{...e,currentInFlightRequests:n>=0?n:0}},N5=e=>({currentInFlightRequests:e.currentInFlightRequests+1,maximumInFlightRequests:e.maximumInFlightRequests+1}),_ze=e=>({...e,...N5(e),currentBouncedRemoveItemRequests:0}),bze=(e,t)=>({...e,currentBouncedRemoveItemRequests:1,items:Hv(e.items,[{productId:t.productId,delta:-t.quantity}])}),xze=(e,t)=>{const n=t?.items?.map(o=>({productId:o.productId,delta:o.quantity}))??[];return{...e,...cS(e),items:Hv(e.items,n)}},Aze=e=>({...e,...N5(e),currentBouncedAddItemRequests:0}),Rze=(e,t)=>({...e,currentBouncedAddItemRequests:1,items:Hv(e.items,[{productId:t.productId,delta:t.quantity}])}),Dze=(e,t)=>Tze(e)?{...e,...cS(e)}:{...e,...cS(e),items:t},Oze=(e,t)=>{const n=t?.items?.map(o=>({productId:o.productId,delta:-o.quantity}))??[];return{...e,...cS(e),items:Hv(e.items,n)}},Pze=(e,t)=>{const n=t?.withUpdatedItemsResponse??!1,o=t?.updatedItems||[],r=t.payload.responseData;if(!r)return e;const i=bi(r)?.items?.map(jx(o||[]))||[];return n?i?.length?Dze(e,i):{...O5}:P5(e)?e:{...e,items:i}},Nze=(e=O5,t)=>{switch(t.type){case Rs.types.BATCH_REMOVE_BASKET_ITEM:return bze(e,t);case Rs.types.REMOVE_BASKET_ITEM.PENDING:case Rs.types.REMOVE_BASKET_FREE_GIFT_ITEM.PENDING:return _ze(e);case Rs.types.REMOVE_BASKET_ITEM.ERROR:case Rs.types.REMOVE_BASKET_FREE_GIFT_ITEM.ERROR:return xze(e,t);case Rs.types.BATCH_ADD_BASKET_ITEM:return Rze(e,t);case Rs.types.ADD_BASKET_ITEM.PENDING:case Rs.types.ADD_BASKET_FREE_GIFT_ITEM.PENDING:return Aze(e);case Rs.types.ADD_BASKET_ITEM.ERROR:case Rs.types.ADD_BASKET_FREE_GIFT_ITEM.ERROR:return Oze(e,t);case mn.types.GET_CART.SUCCESS:case mn.types.GET_CHECKOUT_CART.SUCCESS:return Pze(e,t);default:return e}},Lze={data:null,isFetching:!1,fetchError:!1,error:null,lastUpdated:null},kze=(e=Lze,t)=>{switch(t.type){case od.types.GET_BASKET_PRODUCTS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case od.types.GET_BASKET_PRODUCTS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case od.types.GET_BASKET_PRODUCTS.SUCCESS:{const{imageFormats:n,isSEOReadableURLEnabled:o,isDynamicImagesEnabled:r}=t.transformerConfig||{};return{...e,data:t.transformerConfig?yp(t.payload.responseData,n,o,r).result:t.payload.responseData.result}}case od.types.SET_BASKET_FETCHING_DONE:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de()};case Rs.types.EMPTY_CART.SUCCESS:return{...e,data:null};default:return e}},jze=(e,t)=>e.some(n=>n.promoId===t.promoId)?e.map(n=>{if(n.promoId===t.promoId){const[o]=n.counters,[r]=t.counters;return{...n,counters:[{...o,productIds:[...new Set([...o.productIds,...r.productIds])]}]}}return n}):[...e,t],Mze=(e,t)=>t.reduce((n,o)=>jze(n,o),e),wze=ms.products.missedPromotions,Fze=(e=wze,t)=>{switch(t.type){case fo.types.ADD_MISSED_PROMOTIONS:return Mze(e,t.payload||[]);default:return e}},Bze=Us({benefitGroupsAddresses:gSe,benefits:_Se,subscription:sSe,selectedSubscription:PSe,contentful:LSe}),Uze=(e,t)=>e.productId===t.productId?{...e,selected:t.selected}:e,Gze=(e,t)=>e.promotionId===t.promotionId?{...e,products:e.products.map(n=>Uze(n,t))}:e,$ze=(e,t)=>e.productGroups[0]?.freeGifts?{...e,productGroups:[{...e.productGroups[0],freeGifts:{...e.productGroups[0].freeGifts,promotions:e.productGroups[0].freeGifts.promotions?.map(n=>Gze(n,t))}}]}:e,Hze=(e=ms.checkoutWalk,t)=>{switch(t.type){case Hr.types.GET_CHECKOUT_WALK.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null,data:{...e.data,shouldRefetch:!1}};case Hr.types.GET_CHECKOUT_WALK.ERROR:return{...e,isFetching:!1,fetchError:!0};case Hr.types.GET_CHECKOUT_WALK.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...t.payload.responseData.result,shouldRefetch:!1}};case Hr.types.CLEAR_CHECKOUT_WALK:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e.data,shouldRefetch:!0}};case Hr.types.TOGGLE_FREE_GIFT_SELECTED:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e.data,pages:(e.data.pages||[]).map(n=>$ze(n,t.payload)),shouldRefetch:!1}};default:return e}},Iu=({data:e})=>e.checkoutWalk,L5=({data:e})=>e.checkoutWalk?.data?.pages?.length||0,Vze=({data:e})=>Vo(e,"checkoutWalk.data.pages[0].pageKey",null),aN=e=>e.pathname.split("/").slice(-1)[0],k5=e=>Y(Iu,t=>{const n=aN(e),o=t?.data?.pages?.find(r=>r.pageKey===n);if(o)return{...o,pageIndex:t.data.pages.indexOf(o)}}),Wze=()=>Y(Iu,e=>{const t=e.data?.pages?.find(o=>o.productGroups[0]?.freeGifts);let n=0;return t?.productGroups[0]?.freeGifts?.promotions?.reduce((o,r)=>{const a=r.products.reduce((i,l)=>(n+=1,l.selected?i+1:i),0);return{...o,availableProductsCount:n,allSelectedCount:o.allSelectedCount+a,[r.promotionId]:a}},{allSelectedCount:0,availableProductsCount:0})||{allSelectedCount:0,availableProductsCount:0}}),j5=se("GET_FAILED_ORDER_PAYMENTS"),Yze=se("VALIDATE_EXTERNAL_WALLET_UPDATE_PAYMENT"),qze=se("UPDATE_FAILED_ORDER_PAYMENT"),Kze=e=>({type:"API",payload:{options:{body:{resultToken:e},method:"POST"},pathPrefix:{client:"/api/orderpayment",server:"/core-api"},url:"/v1/update-order-payment/validate",...Yze}}),zze=({orderId:e,paymentMethod:t,payerForRecurringOrder:n})=>({type:"API",payload:{options:{body:JSON.stringify({orderId:e,paymentMethod:t,...n!==void 0&&{recurringOrder:{edit:{replacePayment:n}}},frontendContext:{redirectUrl:`${window.location.origin}${$Y(e)}`}}),method:"POST",headers:{"content-type":"application/vnd.ocado.orderpayment.failed-payment-flow+json"}},pathPrefix:{client:"/api/orderpayment",server:"/core-api"},url:"/v1/update-order-payment",...qze}}),Qze=e=>({type:"API",payload:{url:`/payospgateway/v1/customers/${e}/failed-payments`,service:"payospgateway",...j5}}),Id={getFailedOrderPayments:Qze,validateUpdatePayment:Kze,updateFailedOrderPayment:zze,actionTypes:{GET_FAILED_ORDER_PAYMENTS:j5}},Xze=D("fppco"),M5=D("fpdev"),w5=e=>Xze(e)||M5(e),F5=(e,t)=>Y(M5,Jze,(n,o)=>n?o.find(r=>r.orderId===t):void 0)(e),Zze=(e=ms.orders.failedPayments,t)=>{switch(t.type){case Id.actionTypes.GET_FAILED_ORDER_PAYMENTS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Id.actionTypes.GET_FAILED_ORDER_PAYMENTS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Id.actionTypes.GET_FAILED_ORDER_PAYMENTS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),orders:t.payload.responseData.map(({updateTime:n,orderId:o,saleId:r})=>({updateTime:n,orderId:o||r}))};default:return e}},iN=({data:e})=>e.orders.failedPayments,Vv=({data:e})=>e.orders.failedPayments.orders&&e.orders.failedPayments.orders.length||0,Jze=({data:e})=>e.orders.failedPayments.orders,Wv=e=>Y(iN,({orders:t})=>{const n=t&&t.length&&t.sort((o,r)=>qg(o.updateTime,r.updateTime));return n&&n[0]?n[0]:null})(e),lN=e=>{const{isFetching:t}=iN(e);return!Rt(e)&&w5(e)&&Vv(e)>0&&!t},e4e=e=>Vv(e)?Wv(e).orderId:"",Yv=300,{GET_FAVORITES_CATALOGUE:t4e,GET_NEXT_FAVORITES_CATALOGUE_PAGE:s4e,GET_CROSS_SELL_PRODUCTS:n4e}=yt.types,B5=se("HAS_FAVORITES"),U5="CLEAR_HAS_FAVORITES",o4e=e=>t=>t({type:"API",payload:{service:"customerfavorites",pathPrefix:{client:"/api/customer-favorites",server:"/core-api"},url:`/v1/customers/has-favorites?regionId=${e}`,...B5}}),r4e=()=>e=>e({type:U5}),a4e=({category:e,filters:t,sortOption:n,isRetailerCategoryId:o,pageToken:r,transformerConfig:a,isCrossSellUpdate:i=!1,retailerCategoryId:l})=>(c,d)=>{const u=d(),p=Qe.stringify({...o?{retailerCategoryId:e}:{categoryId:e},...t&&{filters:Qe.stringify(t,{arrayFormat:"separator",arrayFormatSeparator:","})},sortOptionId:n,pageToken:r,tag:"web",includeAdditionalPageInfo:!r,maxProductsToDecorate:gC(u),maxPageSize:Yv},{skipEmptyString:!0});return c({type:"API",transformerConfig:a,retailerCategoryId:l,payload:{url:`/v6/product-pages/favorites?${p}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...r?s4e:t4e,...i?n4e:{}}})},id={fetchFavorites:o4e,getPPWSFavoritesPage:a4e,clearFavorites:r4e,actionTypes:{HAS_FAVORITES:B5,CLEAR_HAS_FAVORITES:U5}},i4e=(e=ms.favorite,t)=>{switch(t.type){case id.actionTypes.HAS_FAVORITES.PENDING:return{...e,isFetching:!0,fetchError:!1};case id.actionTypes.HAS_FAVORITES.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case id.actionTypes.HAS_FAVORITES.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),hasFavorites:t.payload.responseData.hasFavorites};case id.actionTypes.CLEAR_HAS_FAVORITES:return ms.favorite;default:return e}},l4e=({data:e})=>e.favorite,c4e={},d4e=(e=c4e,t)=>{switch(t.type){case J.actionTypes.OPEN_MODAL:{const{modalName:n,options:o}=t.payload;return{[n]:{isOpen:!0,options:o}}}case J.actionTypes.CLOSE_MODAL:return{};default:return e}},{denormalize:u4e}=Al,{ordersSchema:p4e}=xl;function m4e(e,t,n){return n.indexOf(e)===t}const h4e=(e=ms.orders.past,t)=>{switch(t.type){case wu.actionTypes.GET_PAST_ORDERS.PENDING:case wu.actionTypes.GET_PAST_ORDERS_PAGE.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case wu.actionTypes.GET_PAST_ORDERS.ERROR:case wu.actionTypes.GET_PAST_ORDERS_PAGE.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case wu.actionTypes.GET_PAST_ORDERS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),retentionPeriod:t.payload.responseData.retentionPeriod,nextPageToken:t.payload.responseData.nextPageToken,orders:t.payload.responseData.result};case wu.actionTypes.GET_PAST_ORDERS_PAGE.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),retentionPeriod:t.payload.responseData.retentionPeriod,nextPageToken:t.payload.responseData.nextPageToken,orders:[...e.orders,...t.payload.responseData.result].filter(m4e)};default:return e}},G5=Y(e=>e.data.orders.past,e=>e.data.orders.orderEntities,(e,t)=>{const n=u4e(e.orders,p4e,{order:t});return n.includes(void 0)?{isFetching:e.isFetching,nextPageToken:e.nextPageToken,lastUpdated:e.lastUpdated,orders:[]}:{isFetching:e.isFetching,nextPageToken:e.nextPageToken,lastUpdated:e.lastUpdated,orders:n}}),g4e=({data:e})=>e.orders.past.retentionPeriod,{denormalize:E4e}=Al,{ordersSchema:f4e}=xl,y4e=(e=ms.orders.all,t)=>{switch(t.type){case Fy.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Fy.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Fy.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),fetchSuccess:!0,retentionPeriod:t.payload.responseData.retentionPeriod,orders:t.payload.responseData.result};default:return e}},cN=Y(e=>e.data.orders.all,e=>e.data.orders.orderEntities,(e,t)=>{const n=E4e(e.orders,f4e,{order:t});return{...e,orderEntitiesLastUpdated:t.lastUpdated,orders:n.includes(void 0)?[]:n}}),I4e=e=>{const t=n=>qe(n).tz(e.dates.timeZoneId).format("YYYY-MM-DDTHH:mm:ss.SSSZ");return{deliveryStartDate:t(e.dates.deliveryStartDate),deliveryEndDate:t(e.dates.deliveryEndDate),orderAvailableAfter:t(e.dates.orderAvailableAfter),timeZoneId:e.dates.timeZoneId}},S4e=e=>({definitionId:e.definitionId,definitionName:e.definitionName,referenceId:e.referenceId,cancelable:e.cancelable,addressName:e.addressName,dates:I4e(e)}),C4e=(e=[])=>e?.map(t=>S4e(t))??[],qu=e=>"orderId"in e?e?.orderId:e?.referenceId,$5=se("GET_RECURRING_ORDER_PLACEHOLDERS"),H5=se("CANCEL_RECURRING_ORDER_PLACEHOLDER"),v4e=()=>({type:"API",payload:{service:Sl,url:"/v2/web/definitions/upcoming-orders",pathPrefix:{client:`/api/${Sl}`,server:"/core-api"},...$5}}),T4e=(e,t)=>({type:"API",payload:{url:`/recurringshopping/v1/web/definitions/${e}/upcoming-order/${t}`,service:Sl,options:{method:"DELETE"},...H5}}),Sd={getRecurringShoppingPlaceholders:v4e,cancelRecurringOrderPlaceholder:T4e,actionTypes:{GET_RECURRING_ORDER_PLACEHOLDERS:$5,CANCEL_RECURRING_ORDER_PLACEHOLDER:H5}},_4e={...je,data:[]},b4e=(e=_4e,t)=>{switch(t.type){case Sd.actionTypes.GET_RECURRING_ORDER_PLACEHOLDERS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Sd.actionTypes.GET_RECURRING_ORDER_PLACEHOLDERS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Sd.actionTypes.GET_RECURRING_ORDER_PLACEHOLDERS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),fetchSuccess:!0,data:C4e(t.payload.responseData)};default:return e}},x4e=({data:e})=>e.orders.recurring,V5=Y(x4e,e=>e.placeholders),A4e=(e,t)=>Y(V5,n=>({...n,order:n?.data?.filter(o=>o.referenceId===t)[0]}))(e),W5=se("CANCEL_RECURRING_SHOPPING_DEFINITION"),Y5=se("GET_RECURRING_SHOPPING_DEFINITIONS"),R4e=()=>({type:"API",payload:{url:"/v2/web/definitions",pathPrefix:{client:`/api/${Sl}`,server:"/core-api"},service:Sl,...Y5}}),D4e=e=>({type:"API",payload:{url:`/recurringshopping/v1/web/definitions/${e}`,service:Sl,options:{method:"DELETE"},...W5}}),xh={cancelRecurringShoppingDefinition:D4e,getRecurringShoppingDefinitions:R4e,actionTypes:{CANCEL_RECURRING_SHOPPING_DEFINITION:W5,GET_RECURRING_SHOPPING_DEFINITIONS:Y5}},O4e={...je,data:[],error:null,currentlyEdited:null,fetchSuccess:!1},P4e=(e=O4e,t)=>{switch(t.type){case xh.actionTypes.GET_RECURRING_SHOPPING_DEFINITIONS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case xh.actionTypes.GET_RECURRING_SHOPPING_DEFINITIONS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case xh.actionTypes.GET_RECURRING_SHOPPING_DEFINITIONS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),fetchSuccess:!0,data:t.payload.responseData};default:return e}},qv=({data:e})=>e.orders.recurring.definitions,N4e=Y(qv,e=>e?.data||[]),dN=e=>Y(N4e,t=>t?.find(n=>n?.definitionId===e)??null),q5="SET_EDIT_RECURRING_DEFINITION_DATA",K5="SET_EDIT_RECURRING_DEFINITION_STATE",z5=se("FETCH_EDIT_RECURRING_DEFINITION_ADDRESS_DETAILS"),Q5=se("FETCH_EDIT_RECURRING_DEFINITION_DETAILS"),X5=se("FETCH_EDIT_RECURRING_DEFINITION_SLOTS_OFFERING"),Z5=se("UPDATE_RECURRING_DEFINITION_SLOT"),L4e=e=>({type:q5,payload:e}),k4e=e=>({type:K5,payload:e}),j4e=e=>({type:"API",payload:{url:`/v4/delivery-addresses/${e}`,service:"ecomdeliverydestinations",pathPrefix:{client:"/api/ecomdeliverydestinations",server:"/core-api"},...z5}}),M4e=e=>({type:"API",payload:{url:`/v1/web/definitions/${e}`,service:"recurringshopping",pathPrefix:{client:"/api/recurringshopping",server:"/core-api"},...Q5}}),w4e=e=>({type:"API",payload:{url:`/v1/web/definitions/${e}/delivery-window/slots-offering-for-edit`,service:"recurringshopping",pathPrefix:{client:"/api/recurringshopping",server:"/core-api"},...X5}}),F4e=({definitionId:e,dayOfWeekIso:t,startTime:n,endTime:o})=>({type:"API",payload:{url:`/v1/web/definitions/${e}/delivery-window`,service:"recurringshopping",pathPrefix:{client:"/api/recurringshopping",server:"/core-api"},options:{body:{dayOfWeekIso:t,startTime:n,endTime:o},method:"PUT"},...Z5}}),Vs={setEditRecurringDefinitionData:L4e,fetchEditRecurringDefinitionAddressDetails:j4e,setEditRecurringDefinitionState:k4e,fetchEditRecurringDefinitionDetails:M4e,fetchEditRecurringDefinitionSlotsOffering:w4e,updateRecurringDefinitionSlot:F4e,types:{SET_EDIT_RECURRING_DEFINITION_DATA:q5,SET_EDIT_RECURRING_DEFINITION_STATE:K5,FETCH_EDIT_RECURRING_DEFINITION_ADDRESS_DETAILS:z5,FETCH_EDIT_RECURRING_DEFINITION_DETAILS:Q5,FETCH_EDIT_RECURRING_DEFINITION_SLOTS_OFFERING:X5,UPDATE_RECURRING_DEFINITION_SLOT:Z5}},B4e={...je,data:null,error:null},eU={RECURRING_ALREADY_EXISTS:"RECURRING_ALREADY_EXISTS",NO_SLOTS:"NO_SLOTS"},U4e=(e=B4e,t)=>{switch(t.type){case Vs.types.SET_EDIT_RECURRING_DEFINITION_DATA:return t.payload?{...e,data:{...e.data,...t.payload}}:{...e,data:null};case Vs.types.SET_EDIT_RECURRING_DEFINITION_STATE:return{...e,...t.payload};default:return e}},J5="SHOW_RECURRING_ORDER_CREATED_NOTIFICATION",e6="HIDE_RECURRING_ORDER_CREATED_NOTIFICATION",G4e=e=>({type:J5,payload:{name:e}}),$4e=()=>({type:e6}),dS={showRecurringOrderCreatedNotification:G4e,hideRecurringOrderCreatedNotification:$4e,types:{SHOW_RECURRING_ORDER_CREATED_NOTIFICATION:J5,HIDE_RECURRING_ORDER_CREATED_NOTIFICATION:e6}},tU={showRecurringOrderCreatedNotification:!1},H4e=(e=tU,t)=>{switch(t.type){case dS.types.SHOW_RECURRING_ORDER_CREATED_NOTIFICATION:return{...e,showRecurringOrderCreatedNotification:!0,name:t.payload.name};case dS.types.HIDE_RECURRING_ORDER_CREATED_NOTIFICATION:return tU;default:return e}},V4e=e=>e.data.orders.recurring.notifications,t6=se("GET_PRIMARY_SUGGESTIONS"),s6=se("GET_REFINED_SUGGESTIONS"),n6=se("GET_FOLLOW_ON_SUGGESTIONS"),o6="LOAD_SMART_SEARCH_SUGGESTIONS",W4e="SET_DISPLAYED_SUGGESTIONS_TYPE",r6="SET_ITEM_ADDED_TO_BASKET",uN=e=>({url:`/v1/${e}`,service:"websearchconfigws",pathPrefix:{client:"/api/search",server:"/core-api"}}),Y4e=({searchTerm:e="",limit:t=2e4,maxSuggestionsToDisplay:n=10,regionId:o})=>({type:"API",payload:{...uN(`suggestions/primary?searchTerm=${e}&limit=${t}&regionId=${o}`),...t6},maxSuggestionsToDisplay:n}),q4e=(e,t,n=10)=>({type:"API",payload:{...uN(`suggestions/refined?searchTerm=${e}&limit=${n}&regionId=${t}`),...s6}}),K4e=(e,t,n=10)=>({type:"API",payload:{...uN(`suggestions/follow-on?searchTerm=${e}&limit=${n}&regionId=${t}`),...n6}}),z4e=e=>({type:r6,payload:{itemAddedToBasket:e}}),Q4e=e=>({type:o6,payload:{data:e}}),Ur={getPrimarySuggestions:Y4e,getRefinedSuggestions:q4e,getFollowOnSuggestions:K4e,loadSmartSearchSuggestions:Q4e,updateItemAddedToBasket:z4e,actionTypes:{GET_PRIMARY_SUGGESTIONS:t6,GET_REFINED_SUGGESTIONS:s6,GET_FOLLOW_ON_SUGGESTIONS:n6,LOAD_SMART_SEARCH_SUGGESTIONS:o6,SET_DISPLAYED_SUGGESTIONS_TYPE:W4e,SET_ITEM_ADDED_TO_BASKET:r6}},X4e="FOLLOW_ON_SEARCH_SUGGESTION",Z4e="REFINED_SEARCH_SUGGESTION",oA=e=>e?.itemAddedToBasket?[X4e,e.followOn]:[Z4e,e.refined],J4e=ms.search.suggestions,e3e=e=>e.type===Pn,t3e=(e=J4e,t)=>{if(e3e(t))return{...e,isSearchPage:t.payload.location.pathname.endsWith("search")};switch(t.type){case Ur.actionTypes.GET_REFINED_SUGGESTIONS.PENDING:case Ur.actionTypes.GET_FOLLOW_ON_SUGGESTIONS.PENDING:case Ur.actionTypes.GET_PRIMARY_SUGGESTIONS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Ur.actionTypes.GET_PRIMARY_SUGGESTIONS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Ur.actionTypes.GET_PRIMARY_SUGGESTIONS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};case Ur.actionTypes.SET_ITEM_ADDED_TO_BASKET:return e.smartSearchSuggestions?{...e,smartSearchSuggestions:{...e.smartSearchSuggestions,itemAddedToBasket:t.payload.itemAddedToBasket}}:e;case Ur.actionTypes.LOAD_SMART_SEARCH_SUGGESTIONS:return{...e,lastUpdated:de(),isFetching:!1,smartSearchSuggestions:t.payload.data};case Rs.types.ADD_BASKET_ITEM.SUCCESS:return e.isSearchPage&&e.smartSearchSuggestions?{...e,smartSearchSuggestions:{...e.smartSearchSuggestions,itemAddedToBasket:!0}}:e;default:return e}},a6=({data:e})=>e.search.suggestions,pN=({data:e})=>e.search.suggestions.smartSearchSuggestions,i6=se("GET_SEARCH_REDIRECTS"),l6="SET_SEARCH_REDIRECT_URL",c6="CLEAR_SEARCH_REDIRECT_URL",s3e=e=>({type:"API",payload:{service:"websearchconfigws",pathPrefix:{client:"/api/search",server:"/core-api"},url:`/v1/redirects/active?regionId=${e}`,...i6}}),n3e=(e,t)=>({type:l6,payload:{redirectURL:e,redirectSearchTerm:t}}),o3e=()=>({type:c6}),Ku={getSearchRedirects:s3e,setSearchRedirectUrl:n3e,clearSearchRedirectUrl:o3e,actionTypes:{GET_SEARCH_REDIRECTS:i6,SET_SEARCH_REDIRECT_URL:l6,CLEAR_SEARCH_REDIRECT_URL:c6}},r3e={...je,data:[],redirectURL:null,redirectSearchTerm:null},a3e=(e=r3e,t)=>{switch(t.type){case Ku.actionTypes.GET_SEARCH_REDIRECTS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Ku.actionTypes.GET_SEARCH_REDIRECTS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Ku.actionTypes.GET_SEARCH_REDIRECTS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};case Ku.actionTypes.SET_SEARCH_REDIRECT_URL:return{...e,redirectURL:t.payload.redirectURL,redirectSearchTerm:t.payload.redirectSearchTerm};case Ku.actionTypes.CLEAR_SEARCH_REDIRECT_URL:return{...e,redirectURL:null};default:return e}},d6=({data:e})=>e.search.redirects.data,i3e=Us({suggestions:t3e,analytics:hNe,redirects:a3e}),u6=se("GET_INSTANT_SHOP_AVAILABILITY"),p6=se("ADD_INSTANT_SHOP_PRODUCTS"),l3e=()=>({type:"API",payload:{url:"/v1/instant-shop",pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",...u6}}),c3e=()=>({type:"API",payload:{url:"/v2/instant-shop",pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",options:{body:{},method:"POST"},...p6}}),uS={getInstantShopAvailability:l3e,addInstantShopProductsToBasket:c3e,types:{GET_INSTANT_SHOP_AVAILABILITY:u6,ADD_INSTANT_SHOP_PRODUCTS:p6}},d3e={...je,available:!1},u3e=(e=d3e,t)=>{switch(t.type){case uS.types.GET_INSTANT_SHOP_AVAILABILITY.ERROR:return{...e,isFetching:!1,fetchError:!0,lastUpdated:de(),error:t.payload};case uS.types.GET_INSTANT_SHOP_AVAILABILITY.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),available:!!t.payload.responseData?.available};default:return e}},wE=({data:e})=>!!e.instantShop?.available,mN=se("GET_ORDER"),m6=se("EDIT_ORDER"),p3e=se("CANCEL_ORDER"),h6=se("CANCEL_ORDER_CHANGES"),m3e=se("CHANGE_ORDER_STATUS"),h3e=e=>({type:"API",payload:{url:`/v6/orders/${e}`,service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},...mN}}),g3e=e=>({type:"API",payload:{url:`/v6/orders/${e}/decorated`,service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},...mN}}),E3e=(e,t)=>({type:"API",payload:{url:"/v2/sessions/order-edit",service:"customersessions",pathPrefix:{client:"/api/customersessions",server:"/core-api"},options:{method:"POST",body:{orderId:e,regionId:t}},...m6}}),f3e=(e,t)=>({type:"API",payload:{url:`/v2/sessions/order-edit/${e}?regionId=${t}`,service:"customersessions",pathPrefix:{client:"/api/customersessions",server:"/core-api"},options:{method:"DELETE"},...h6}}),y3e=e=>({type:"API",payload:{url:`/v6/orders/${e}/cancel`,service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},options:{method:"PUT"},...p3e}}),I3e=e=>e(jt()),Ia={getOrder:h3e,getDecoratedOrder:g3e,editOrder:E3e,cancelOrderChanges:f3e,cancelOrder:y3e,saveChanges:I3e,actionTypes:{GET_ORDER:mN,EDIT_ORDER:m6,CANCEL_ORDER_CHANGES:h6,CHANGE_ORDER_STATUS:m3e}},S3e={isFetching:!1,fetchError:!1,lastUpdated:null,order:null,error:null},C3e=(e=S3e,t)=>{switch(t.type){case Ia.actionTypes.GET_ORDER.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Ia.actionTypes.GET_ORDER.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Ia.actionTypes.GET_ORDER.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),order:t.payload.responseData.result};default:return e}},Kv="refunds",g6=se("CALCULATE_SELECTED_ITEMS"),E6="CLEAR_SELECTED_ITEMS",v3e=(e,t)=>({type:"API",payload:{url:`/refunds/v6/order-refund-request-summary-view?locale=${t}`,options:{method:"POST",body:e},service:Kv,...g6}}),T3e=()=>({type:E6}),oc={calculateSelectedItems:v3e,clearSelectedItems:T3e,actionTypes:{CALCULATE_SELECTED_ITEMS:g6,CLEAR_SELECTED_ITEMS:E6}},_3e=(e=ms.orders.current.refunds.summary,t)=>{switch(t.type){case oc.actionTypes.CALCULATE_SELECTED_ITEMS.SUCCESS:return{...t.payload.responseData,isFetching:!1,fetchError:!1,error:null};case oc.actionTypes.CALCULATE_SELECTED_ITEMS.PENDING:return{...ky,isFetching:!0,fetchError:!1,error:null};case oc.actionTypes.CALCULATE_SELECTED_ITEMS.ERROR:return{...ky,isFetching:!1,fetchError:!0,error:t.payload};case oc.actionTypes.CLEAR_SELECTED_ITEMS:return ky;default:return e}},f6=se("GET_CREATED_REFUND_REQUEST_VIEW"),b3e=(e,t)=>({type:"API",payload:{url:`/refunds/v4/orders/${e}/created-refund-requests-view?locale=${t}`,service:Kv,...f6}}),Ah={fetchCreatedRefundRequest:b3e,actionTypes:{GET_CREATED_REFUND_REQUEST_VIEW:f6}},x3e=(e=ms.orders.current.refunds.createdRefundRequest,t)=>{switch(t.type){case Ah.actionTypes.GET_CREATED_REFUND_REQUEST_VIEW.SUCCESS:return{...t.payload.responseData,isFetching:!1,fetchError:!1,error:null};case Ah.actionTypes.GET_CREATED_REFUND_REQUEST_VIEW.PENDING:return{...Nx.createdRefundRequest,isFetching:!0,fetchError:!1,error:null};case Ah.actionTypes.GET_CREATED_REFUND_REQUEST_VIEW.ERROR:return{...Nx.createdRefundRequest,isFetching:!1,fetchError:!0,error:t.payload};default:return e}},y6=se("GET_NEW_REFUND_REQUEST_VIEW"),I6="UPDATE_ITEM",A3e=(e,t)=>({type:"API",payload:{url:`/refunds/v4/orders/${e}/new-refund-request-view?locale=${t}`,...y6,service:Kv}}),R3e=(e,t,n)=>({type:I6,payload:{itemId:e,quantity:t,refundReason:n}}),rc={fetchNewRefundRequestView:A3e,updateItem:R3e,actionTypes:{GET_NEW_REFUND_REQUEST_VIEW:y6,UPDATE_ITEM:I6}},D3e=(e,t)=>{const{itemId:n,quantity:o,refundReason:r}=t;return e.map(a=>{const i=a;return a.itemId===n&&(i.selectedQuantity=o,i.selectedRefundReason=r),i})},O3e=(e=ms.orders.current.refunds.newRefundRequest,t)=>{switch(t.type){case rc.actionTypes.GET_NEW_REFUND_REQUEST_VIEW.PENDING:return{isFetching:!0,fetchError:!1,error:null};case rc.actionTypes.GET_NEW_REFUND_REQUEST_VIEW.ERROR:return{isFetching:!1,fetchError:!0,error:t.payload};case rc.actionTypes.GET_NEW_REFUND_REQUEST_VIEW.SUCCESS:return{...t.payload.responseData,isFetching:!1,fetchError:!1,error:null};case rc.actionTypes.UPDATE_ITEM:return{...e,availableItems:D3e(e.availableItems,t.payload)};default:return e}},S6=se("PLACE_REFUND_REQUEST"),P3e=(e,t)=>({type:"API",payload:{url:`/refunds/v4/orders/${e}/refund-requests`,options:{method:"POST",body:t},service:Kv,...S6}}),Hy={placeRefundRequest:P3e,actionTypes:{PLACE_REFUND_REQUEST:S6}},{placeRefundRequest:N3e}=ms.orders.current.refunds,L3e=(e=N3e,t)=>{switch(t.type){case Hy.actionTypes.PLACE_REFUND_REQUEST.PENDING:return{isFetching:!0,fetchError:!1,error:null};case Hy.actionTypes.PLACE_REFUND_REQUEST.ERROR:return{isFetching:!1,fetchError:!0,error:t.payload};case Hy.actionTypes.PLACE_REFUND_REQUEST.SUCCESS:return{...t.payload.responseData,isFetching:!1,fetchError:!1,error:null};default:return e}},k3e=Us({summary:_3e,createdRefundRequest:x3e,newRefundRequest:O3e,placeRefundRequest:L3e}),C6=se("GET_LOYALTY_SETTINGS"),j3e=()=>$3({url:"/v1/web/loyalty/configurations/latest/display-type",...C6}),Vy={getLoyaltySettings:j3e,actionTypes:{GET_LOYALTY_SETTINGS:C6}},M3e={error:null,fetchError:!1,isFetching:!1,lastUpdated:null,data:null},w3e={error:null,fetchError:!1,isFetching:!1,lastUpdated:null,lastModified:null,balance:null,registered:!1},F3e={error:null,fetchError:!1,isFetching:!1,lastUpdated:null,data:null},B3e=(e=M3e,t)=>{switch(t.type){case Vy.actionTypes.GET_LOYALTY_SETTINGS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Vy.actionTypes.GET_LOYALTY_SETTINGS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Vy.actionTypes.GET_LOYALTY_SETTINGS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},hN=({data:e})=>Vo(e,"loyaltySettings.data.loyaltyDisplayType",null),U3e=(e=w3e,t)=>{switch(t.type){case yd.actionTypes.GET_CUSTOMER_LOYALTY.PENDING:return{...e,isFetching:!0,fetchError:!1};case yd.actionTypes.GET_CUSTOMER_LOYALTY.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case yd.actionTypes.GET_CUSTOMER_LOYALTY.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),balance:t.payload.responseData.balance,registered:t.payload.responseData.registered};default:return e}},FE=({data:e})=>e.customer.loyalty,Cg=e=>FE(e).balance,G3e=e=>FE(e).isFetching,zv=e=>!!FE(e).registered,v6=e=>Cg(e)?.units!==void 0&&zv(e),T6=se("GET_APPLICABLE_LOYALTY"),$3e=()=>({type:"API",payload:{pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",url:"/v1/carts/active/applicable-loyalty",...T6}}),Wy={getApplicableLoyalty:$3e,actionTypes:{GET_APPLICABLE_LOYALTY:T6}},H3e=D("loy.waon"),V3e=(e=F3e,t)=>{switch(t.type){case Wy.actionTypes.GET_APPLICABLE_LOYALTY.PENDING:return{...e,isFetching:!0,fetchError:!1};case Wy.actionTypes.GET_APPLICABLE_LOYALTY.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Wy.actionTypes.GET_APPLICABLE_LOYALTY.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:t.payload.responseData};default:return e}},aa=({data:e})=>e.applicableLoyalty.data,_6=Y(aa,e=>e),b6=({data:e})=>e.applicableLoyalty.isFetching,x6=({data:e})=>e.applicableLoyalty.fetchError,Qv=Y(aa,e=>e?.unusedUnitsReason),BE=Y(aa,e=>e&&e.balance),A6=Y(aa,e=>e?.minSpend),W3e=Y(aa,e=>e?.minSpendShortfall),rA=Y(aa,e=>e?.redeemable||null),gN=Y(BE,e=>e?.units||0),R6=Y(A6,e=>e?.units||0),EN=Y(rA,e=>e?.units||0),Y3e=Y(H3e,EN,gN,(e,t,n)=>e?n>0:t>0),q3e=Y(Qv,e=>e==="BALANCE_BELOW_MIN"),K3e=Y(Qv,e=>e==="APPLICABLE_ITEMS_BELOW_MIN"),z3e=Y(Qv,e=>e==="UNAPPLICABLE_ITEMS_RESTRICTED"),Q3e=Y(R6,gN,(e,t)=>e===0?0:t<e?t/e:1),X3e=Y(EN,gN,(e,t)=>e>0&&e<t),Z3e=Y(Qv,e=>!e||!["BALANCE_ZERO","APPLICABLE_ITEMS_BELOW_MIN","BALANCE_BELOW_MIN"].includes(e)),J3e=Y(aa,e=>e?.spendIncrementStep);Y(aa,e=>e?.orderOfferedPrice);const e5e=Y(aa,e=>e?.spendConversionRate),t5e=Y(aa,e=>e?.maxSpend),s5e=Y(aa,e=>e?.amountToBePaidByCustomer),n5e=Y(t5e,e=>e?.units||0),o5e=Y(aa,e=>e?.minMonetarySpend),r5e=Y(aa,e=>e?.leftToSpend?.units),D6=se("GET_DRAFT_BASKET"),O6=se("ADD_ITEMS_DRAFT_BASKET"),P6=se("REMOVE_ITEMS_DRAFT_BASKET"),a5e=e=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:`/v1/carts/${e}`,...D6}}),i5e=({draftBasketId:e,items:t})=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:`/v1/carts/${e}/add-items`,options:{body:t,method:"POST"},...O6}}),l5e=({draftBasketId:e,items:t})=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:`/v1/carts/${e}/remove-items`,options:{body:t,method:"POST"},...P6}}),ua={getDraftBasket:a5e,addItemsToDraftBasket:i5e,removeItemsFromDraftBasket:l5e,types:{GET_DRAFT_BASKET:D6,ADD_ITEMS_DRAFT_BASKET:O6,REMOVE_ITEMS_DRAFT_BASKET:P6}},c5e=(e=Qo,t)=>{switch(t.type){case ua.types.GET_DRAFT_BASKET.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case ua.types.GET_DRAFT_BASKET.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case ua.types.GET_DRAFT_BASKET.SUCCESS:{if(!t.payload?.responseData)return{...Qo,isFetching:!1,fetchError:!0,error:new Error("No cart data"),lastUpdated:de()};const o=bi(t.payload.responseData);return{...Qo,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),...o}}case ua.types.ADD_ITEMS_DRAFT_BASKET.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case ua.types.ADD_ITEMS_DRAFT_BASKET.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case ua.types.ADD_ITEMS_DRAFT_BASKET.SUCCESS:{const n=t.payload?.responseData?.basketUpdateResult;if(!n)return{...Qo,isFetching:!1,fetchError:!0,error:new Error("No cart data"),lastUpdated:de()};const o=bi(n);return{...Qo,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),...o}}case ua.types.REMOVE_ITEMS_DRAFT_BASKET.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case ua.types.REMOVE_ITEMS_DRAFT_BASKET.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case ua.types.REMOVE_ITEMS_DRAFT_BASKET.SUCCESS:{const n=t.payload?.responseData?.basketUpdateResult;if(!n)return{...Qo,isFetching:!1,fetchError:!0,error:new Error("No cart data"),lastUpdated:de()};const o=bi(n);return{...Qo,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),...o}}default:return e}},N6="UPDATE_ADD_ADDRESS_ORIGIN",d5e=e=>({type:N6,payload:{origin:e}}),L6={types:{UPDATE_ADD_ADDRESS_ORIGIN:N6},updateAddAddressOrigin:d5e},u5e=(e="",t)=>{switch(t.type){case L6.types.UPDATE_ADD_ADDRESS_ORIGIN:return t.payload.origin;default:return e}},k6=e=>e?.control?.addAddressOrigin,j6=e=>k6(e)||Xa(),p5e=e=>k6(e)===Xa(),M6=se("VALIDATE_ADDRESS"),m5e=e=>({type:"API",payload:{url:"/v2/addresses",service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"PUT",body:e},...M6}}),Yy={types:{VALIDATE_ADDRESS:M6},validateAddress:m5e},sU={...ms.customer.addressValidation},h5e=(e=ms.customer.addressValidation,t)=>{switch(t.type){case Yy.types.VALIDATE_ADDRESS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,data:t.payload.responseData};case Yy.types.VALIDATE_ADDRESS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null,data:sU};case Yy.types.VALIDATE_ADDRESS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload.responseData,data:sU};default:return e}},g5e=({data:e})=>e.customer.addressValidation.data,w6=se("FETCH_CUSTOMER_ADDRESS_DETAILS"),E5e=e=>({type:"API",payload:{url:`/v2/accounts/current/addresses/${e}`,service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},...w6}}),Rh={types:{FETCH_CUSTOMER_ADDRESS_DETAILS:w6},fetchCustomerAddressDetails:E5e},f5e=e=>{const t={...e,formattedAddress:e.address};return delete t.address,t},y5e=(e=ms.customer.addressDetails,t)=>{switch(t.type){case Rh.types.FETCH_CUSTOMER_ADDRESS_DETAILS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,data:f5e(t.payload.responseData)};case Rh.types.FETCH_CUSTOMER_ADDRESS_DETAILS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null,data:null};case Rh.types.FETCH_CUSTOMER_ADDRESS_DETAILS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload,data:null};default:return e}},I5e=({data:e})=>e?.customer?.addressDetails?.data||{formattedAddress:""},F6=se("FETCH_NEW_ADDRESS_FIELDS"),S5e=(e,t)=>{const n=new URLSearchParams;return e&&n.append("areaLookupId",e),t&&n.append("formVersion",t),{type:"API",payload:{url:`/v1/address-form${n.toString()?`?${n.toString()}`:""}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},...F6}}},Cd={types:{FETCH_NEW_ADDRESS_FIELDS:F6},fetchNewAddressFields:S5e},{addressFields:B6}=ms.customer,{formSection:nU}=B6;function C5e(e=B6,t){switch(t.type){case Cd.types.FETCH_NEW_ADDRESS_FIELDS.SUCCESS:return{...e,fetchError:!1,isFetching:!1,formSection:t.payload.responseData};case Cd.types.FETCH_NEW_ADDRESS_FIELDS.PENDING:return{...e,fetchError:!1,isFetching:!0,formSection:nU};case Cd.types.FETCH_NEW_ADDRESS_FIELDS.ERROR:return{...e,isFetching:!1,fetchError:!0,formSection:nU};default:return e}}const U6=e=>e.data.retailer.addressFields,v5e=e=>U6(e).formSection.fields,T5e=e=>U6(e).isFetching,_5e={...je,fetchError:!1,isFetching:!1,error:null,preferences:{preferences:[],sections:[]}},b5e=(e=_5e,t)=>{switch(t.type){case"GET_MARKETING_PREFERENCES_PENDING":return{...e,isFetching:!0,fetchError:!1};case"GET_MARKETING_PREFERENCES_SUCCESS":return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),preferences:A5e(t.payload.responseData)};case"GET_MARKETING_PREFERENCES_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};default:return e}},x5e=({data:e})=>e.customer.marketingPreferences,A5e=({sections:e,...t})=>{const n=e.flatMap(r=>r.groups).flatMap(r=>r.preferences),o=e.map(r=>({...r,footers:r.footers.filter(a=>a.headerText||a.descriptionText)}));return{preferences:n,sections:o,...t}},R5e={"raw-produce-segregation":"rawProduceSegregation"},oU={ERROR:"error",SUCCESS:"success"},D5e={preferences:{},...je,error:null},O5e=(e=D5e,t)=>{switch(t.type){case"GET_DELIVERY_PREFERENCES_PENDING":return{...e,isFetching:!0,fetchError:!1};case"GET_DELIVERY_PREFERENCES_SUCCESS":{const{preferenceKey:n,preferenceValue:o}=t.payload.responseData,r=R5e[n],a={preferenceKey:n,preferenceValue:o==="true"};return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),preferences:{...!!r&&{[r]:a}}}}case"GET_DELIVERY_PREFERENCES_ERROR":return{...e,isFetching:!1,fetchError:!0,error:t.payload};default:return e}},P5e=({data:e})=>e.customer.deliveryPreferences,N5e=e=>{if(!e)return null;switch(e.toUpperCase()){case kr.AMEX:case kr.AMERICAN_EXPRESS:return qt.AMEX;case kr.CB:return"carte_bancaire";case kr.DISCOVER:return"discover";case kr.MAESTRO:return"maestro";case kr.MASTERCARD:case kr.MASTERCARD_DEBIT:return qt.MASTERCARD;case kr.VISA:case kr.VISA_DEBIT:case kr.VISA_ELECTRON:case kr.VISA_PURCHASING:return qt.VISA;case kr.PAYMENT_CARD:return qt.PAYMENT_CARD;case kr.VISA_PHONE:return qt.VISA_PHONE;default:return null}},G6=({cardType:e,paymentMethod:t})=>{const n=N5e(e);if(n)return n;switch(t){case at.PAYPAL:return qt.PAYPAL;case at.APPLE_PAY:return qt.APPLE_PAY;case at.GOOGLE_PAY:return qt.GOOGLE_PAY;case at.VISA_MOBILE:return qt.VISA_PHONE;case at.INVOICE:return qt.INVOICE;case at.BANK_TRANSFER:return qt.BANK_TRANSFER;case at.BLIK:return qt.BLIK;case at.L_PAY:return qt.L_PAY;case at.CARD_INSTALMENTS:return qt.SMARTNEY;case at.NAVERPAY:return qt.NAVERPAY;case at.KAKAOPAY:return qt.KAKAOPAY;default:return qt.PAYMENT_CARD}},pS="pspweb",fN=se("GET_PSP_FRAME_URL"),$6=se("CREATE_WALLET_ITEM"),L5e=e=>({type:"API",payload:{service:pS,url:`/${pS}/v1/wallet-items`,options:{method:"POST",body:{resultToken:e}},...$6}}),k5e=(e,t="")=>({type:"API",payload:{url:`/v2/wallet/${e}/create-url${t?`?${t}`:""}`,...fN}}),j5e=({url:e})=>({type:"API",payload:{service:pS,url:`/${pS}/v1/wallet-items/creation-sessions`,options:{method:"POST",body:{requestOriginSource:{platform:"WEB",url:e}}},...fN}}),yN={getPspFrameUrl:k5e,createWalletItemCreationSession:j5e,createWalletItem:L5e,types:{GET_PSP_FRAME_URL:fN,CREATE_WALLET_ITEM:$6}},H6="UPDATE_DEFAULT_WALLET_ITEM",M5e=e=>({type:H6,payload:{walletItemId:e}}),V6={updateDefaultWalletItem:M5e,types:{UPDATE_DEFAULT_WALLET_ITEM:H6}},W6=se("GET_WALLET_ITEMS"),rU="walletservice",w5e=e=>({type:"API",payload:{service:rU,url:`/${rU}/v3/wallet-items?${Qe.stringify({customerId:e})}`,...W6}}),qy={getWalletItems:w5e,types:{GET_WALLET_ITEMS:W6}},F5e=({cardNumber:e,cardType:t,paymentMethod:n,...o})=>({lastFourDigits:e&&e.length>=4?e.slice(-4):"",cardTypeDisplayName:G6({cardType:t,paymentMethod:n}),cardNumber:e,cardType:t,...o}),aU=({walletItemId:e,fundingInstrumentId:t,defaultWalletItem:n,paymentMethodType:o,details:r,expired:a})=>({walletItemId:e,fundingInstrumentId:t,isDefault:n,paymentMethodGroup:dt.PAY_NOW,paymentMethod:o,details:F5e({...r,paymentMethod:o}),expired:a}),B5e=(e,t)=>({...e,items:[t,...e.items.map(n=>({...n,isDefault:n.isDefault&&!t.isDefault}))]}),U5e=(e,t)=>({...e,items:e.items.map(n=>({...n,isDefault:n.walletItemId===t}))}),G5e=(e=ms.wallet,t)=>{switch(t.type){case qy.types.GET_WALLET_ITEMS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case qy.types.GET_WALLET_ITEMS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case qy.types.GET_WALLET_ITEMS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),items:t.payload.responseData.map(aU)};case V6.types.UPDATE_DEFAULT_WALLET_ITEM:return U5e(e,t.payload.walletItemId);case nA.actionTypes.SUBMIT_ADD_CARD_REFERENCE.SUCCESS:case yN.types.CREATE_WALLET_ITEM.SUCCESS:return B5e(e,aU(t.payload.responseData));default:return e}},UE=({data:e})=>e.customer.wallet,$5e=(e=ms.wallet,t)=>{switch(t.type){case ag.types.REMOVE_WALLET_ITEM.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case ag.types.REMOVE_WALLET_ITEM.SUCCESS:return{...e,items:e.items.filter(n=>n.walletItemId!==t.id)};default:return e}},Y6=se("GET_ALTERNATIVES"),q6=se("GET_ALTERNATIVES_V2"),K6="SET_ACTIVE_ALTERNATIVES",z6="web_product_page_ws",H5e=e=>({type:"API",payload:{service:z6,url:`/webproductpagews/v5/products/alternatives?retailerProductId=${e}`,...Y6}}),V5e=(e,t)=>({type:"API",payload:{service:z6,url:"/webproductpagews/v5/products/alternatives",options:{method:"POST",body:{...e&&{fulfillment:{fulfillmentId:e.slotId,regionId:e.slotRegionId}},productId:t}},...q6}}),W5e=e=>({type:K6,payload:{productId:e}}),Ua={getAlternatives:H5e,setActiveAlternatives:W5e,getAlternativesV2:V5e,types:{GET_ALTERNATIVES:Y6,GET_ALTERNATIVES_V2:q6,SET_ACTIVE_ALTERNATIVES:K6}},Y5e=(e=ms.products.alternatives,t)=>{switch(t.type){case Ua.types.GET_ALTERNATIVES.PENDING:case Ua.types.GET_ALTERNATIVES_V2.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Ua.types.GET_ALTERNATIVES.ERROR:case Ua.types.GET_ALTERNATIVES_V2.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Ua.types.GET_ALTERNATIVES.SUCCESS:case Ua.types.GET_ALTERNATIVES_V2.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData,lastUpdated:de()};case Ua.types.SET_ACTIVE_ALTERNATIVES:return{...e,active:t.payload.productId};default:return e}},Q6=({data:e})=>e.products.alternatives,X6=se("GET_PROMOTION_DETAILS"),Z6=se("GET_PROMOTION_IDS"),{GET_CATALOGUE:q5e,GET_PROMOTION_CATALOGUE:K5e,GET_NEXT_CATALOGUE_PAGE:z5e,GET_NEXT_PROMOTION_CATALOGUE_PAGE:Q5e}=yt.types,X5e=(e,t,n,o,r,a)=>{const i=Qe.stringify({sortOptionId:r,category:a});return{type:"API",payload:{url:t?`/v4/promotion/retailer-id/${e}?${i}`:`/v4/promotion/${e}?${i}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...X6},isDynamicIamgesEnabled:n,imageFormats:o}},Z5e=e=>({type:"API",payload:{url:`/v1/seo/offer?id=${e}`,...Z6}}),J5e=(e,t,n,o,r)=>a=>a({type:"API",payload:{url:`/v6/products/promotions?${oE({category:e,filters:t,sortOption:n,pageToken:o,isRetailerCategoryId:r})}`,...o?z5e:q5e}}),e6e=(e,t,n,o,r,a)=>(i,l)=>{const c=l(),d=Qe.stringify({regionId:vn(c),...a?{retailerCategoryId:t}:{categoryId:t},filters:Qe.stringify(n,{arrayFormat:"separator",arrayFormatSeparator:","}),sortOptionId:o,pageToken:r,includeAdditionalPageInfo:!r,maxProductsToDecorate:gC(c),maxPageSize:Yv},{skipEmptyString:!0});return i({type:"API",payload:{url:`/v1/pages/promotions?${d}`,service:"productquerylayer",pathPrefix:{client:"/api/product-listing-pages",server:"/core-api"},...r?Q5e:K5e},transformerConfig:e})},yi={getPromotionDetails:X5e,getPromotionIds:Z5e,getPQLPromotionsPage:e6e,getPromotionsPage:J5e,actionTypes:{GET_PROMOTION_DETAILS:X6,GET_PROMOTION_IDS:Z6}},t6e=(e,t,n)=>({...e,products:e.products.map(o=>si(o,n,t))}),s6e=e=>e.map(({sortOptionId:t,messageKey:n,selected:o})=>({id:t,messageKey:n,selected:o})),IN=(e,t,n)=>{const o={promotionPageType:e.promotionPageType,breadcrumbs:e.breadcrumbs,sortOptions:s6e(e.sortOptions),promoId:e.promoId,description:e.description,longDescription:e.longDescription,retailerPromotionId:e.retailerPromotionId,promotionGroups:e.promotionGroups.map(r=>t6e(r,t,n)),presentationMode:e.presentationMode,missedPromotions:e.missedPromotions};return dH(o,BV)},n6e=ms.products.offers,o6e=(e=n6e,t)=>{switch(t.type){case yi.actionTypes.GET_PROMOTION_DETAILS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case yi.actionTypes.GET_PROMOTION_DETAILS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case yi.actionTypes.GET_PROMOTION_DETAILS.SUCCESS:{const{payload:n,isDynamicImagesEnabled:o,imageFormats:r}=t,a=n.responseData,i=IN(a,o,r);return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:i.result}}case yi.actionTypes.GET_PROMOTION_IDS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case yi.actionTypes.GET_PROMOTION_IDS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case yi.actionTypes.GET_PROMOTION_IDS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e.data,promoId:t.payload.responseData.id,retailerPromotionId:t.payload.responseData.retailerId,description:t.payload.responseData.encodedName}};default:return e}},Ec=({data:e})=>e.products.offers.data,SN=({data:e})=>e.products.offers.isFetching,J6=({data:e})=>e.products.offers.error,Ky=se("GET_SHOP_IN_SHOP"),r6e="RESET_SHOP_IN_SHOP",e8=e=>({type:"API",pageId:e,payload:{url:`/v1/shop-in-shop/${e}`,...Ky}}),a6e=()=>({type:r6e}),i6e=(e=ms.shopInShop,t)=>{switch(t.type){case Ky.PENDING:return{...e,isFetching:!0,fetchError:void 0};case Ky.ERROR:return{...e,isFetching:!1,fetchError:t.payload,pageId:t.pageId};case Ky.SUCCESS:return{...e,isFetching:!1,fetchError:void 0,id:t.payload?.responseData?.id,name:t.payload?.responseData?.name,label:t.payload?.responseData?.label,images:t.payload?.responseData?.images,contentFormat:t.payload?.responseData?.contentFormat,componentItems:t.payload?.responseData?.componentItems,html:t.payload?.responseData?.html,productIds:t.payload?.responseData?.productIds,pageId:t.pageId};default:return e}},l6e=e=>e.data.shopInShop,t8=se("GET_RECOMMENDED_PRODUCTS"),c6e="web_product_page_ws",d6e=()=>({type:"API",payload:{url:"/webproductpagews/v5/products/recommendations/promotions",service:c6e,...t8}}),lb={types:{GET_RECOMMENDED_PRODUCTS:t8}},u6e=je,p6e=(e=u6e,t)=>{switch(t.type){case lb.types.GET_RECOMMENDED_PRODUCTS.PENDING:return{...e,data:void 0,isFetching:!0,fetchError:!1,error:null};case lb.types.GET_RECOMMENDED_PRODUCTS.ERROR:return{...e,data:void 0,isFetching:!1,fetchError:!0,error:t.payload};case lb.types.GET_RECOMMENDED_PRODUCTS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData,lastUpdated:de()};default:return e}},m6e=({data:e})=>e.shopperOptimisations.recommendations,h6e={recommendedProductsReducer:p6e},g6e=e=>({type:"regular",name:"fop.headertitle.regulars",clusterBreadcrumbs:[],additionalProductAttributes:[{}],products:[e]}),E6e=(e,t)=>({...e,products:[...e.products,t]}),f6e=e=>e.products.length>0?e:void 0,y6e=e=>{const n=[...e].find(o=>o.type==="regular");if(n)return f6e(n)},I6e=(e,t)=>{if(e)return{...e,products:[...e.products.filter(n=>n!==t)]}},S6e=(e,t)=>e.map(n=>{if(n.productId!==t.productId)return n;const{productId:o,frequency:r,quantity:a}=t;return{productId:o,frequency:r,quantity:a}});function C6e(e){return e.map(t=>t.productId)}function v6e(e,t){return Object.values(e).reduce((n,o)=>{const{quantity:r,frequency:a}=t.find(i=>i.productId===o.productId);return{...n,[o.productId]:{...o,regular:{quantity:r,frequency:a}}}},{})}function T6e(e){return Object.keys(e).length===0}function _6e(e){return e.length===0}function b6e(e,t){if(_6e(e)||T6e(t))return;const n=sC(t,C6e(e));return v6e(n,e)}const x6e={regulars:{...je,data:[]},list:{productGroup:void 0},addToRegularsModal:{productId:""},actionInProgress:[]},Sm="regulars",Cm="/v1/regulars",vm={client:"/api/regulars",server:"/core-api"},A6e=()=>({type:"API",payload:{service:Sm,url:Cm,options:{method:"GET"},pathPrefix:vm,...Su.types.FETCH_REGULARS}}),R6e=e=>({type:"API",payload:{service:Sm,url:Cm,options:{method:"POST",body:e},pathPrefix:vm,...Su.types.CREATE_REGULAR},regular:e}),D6e=()=>({type:"API",payload:{service:Sm,url:Cm,options:{method:"DELETE"},pathPrefix:vm,...Su.types.REMOVE_ALL_REGULARS}}),O6e=e=>({type:"API",payload:{service:Sm,url:`${Cm}/${e}`,options:{method:"DELETE"},pathPrefix:vm,...Su.types.REMOVE_REGULAR},productId:e}),P6e=e=>({type:"API",payload:{service:Sm,url:Cm,options:{method:"PUT",body:e},pathPrefix:vm,...Su.types.UPDATE_REGULAR},...e}),N6e=Object.freeze(Object.defineProperty({__proto__:null,BASE_PATH:Cm,SERVICE:Sm,addRegular:R6e,fetchRegulars:A6e,pathPrefix:vm,removeAllRegulars:D6e,removeRegular:O6e,updateRegular:P6e},Symbol.toStringTag,{value:"Module"})),s8="SET_SELECTED_PRODUCT",n8="REGULARS_SET_PRODUCT_GROUPS",L6e=se("FETCH_REGULARS"),k6e=se("REMOVE_ALL_REGULARS"),j6e=se("CREATE_REGULAR"),M6e=se("REMOVE_REGULAR"),w6e=se("UPDATE_REGULAR"),F6e={SET_SELECTED_PRODUCT:s8,REGULARS_SET_PRODUCT_GROUPS:n8,FETCH_REGULARS:L6e,REMOVE_ALL_REGULARS:k6e,CREATE_REGULAR:j6e,REMOVE_REGULAR:M6e,UPDATE_REGULAR:w6e},{GET_CATALOGUE:B6e,GET_REGULARS_CATALOGUE:U6e}=yt.types,G6e=e=>({type:s8,payload:e}),$6e=e=>({type:n8,payload:{groups:e}}),H6e=({category:e,transformerConfig:t})=>n=>{const o=Qe.stringify({...e&&{categoryId:e},limit:50,tag:["web","regulars"]},{skipEmptyString:!0});return n({type:"API",transformerConfig:t,payload:{url:`/v5/product-pages/regulars?${o}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...U6e}})},V6e=({category:e})=>t=>{const n=Qe.stringify({...e&&{category:e}},{skipEmptyString:!0});return t({type:"API",payload:{url:`/v5/products/regulars?${n}`,...B6e}})},Su={...N6e,getRegularsPage:V6e,getPPWSRegularsPage:H6e,setSelectedProduct:G6e,setProductGroups:$6e,types:F6e},{setSelectedProduct:Xv,setProductGroups:o8,fetchRegulars:CN,addRegular:W6e,removeAllRegulars:Y6e,removeRegular:q6e,updateRegular:K6e,getRegularsPage:z6e,getPPWSRegularsPage:Q6e,types:Fa}=Su;function X6e(e,t){return t.filter(n=>n.productId!==e)}function Z6e(e=x6e,t){switch(t.type){case Fa.SET_SELECTED_PRODUCT:return{...e,addToRegularsModal:{...t.payload}};case Fa.FETCH_REGULARS.PENDING:return{...e,regulars:{...e.regulars,isFetching:!0,fetchError:!1}};case Fa.FETCH_REGULARS.ERROR:return{...e,regulars:{...e.regulars,isFetching:!1,fetchError:!0,data:[]}};case Fa.FETCH_REGULARS.SUCCESS:return{...e,regulars:{...e.regulars,isFetching:!1,fetchError:!1,data:t.payload.responseData}};case Fa.REMOVE_ALL_REGULARS.SUCCESS:return{...e,regulars:{...e.regulars,isFetching:!1,fetchError:!1,data:[]},list:{productGroup:void 0}};case Fa.CREATE_REGULAR.SUCCESS:return{...e,regulars:{...e.regulars,isFetching:!1,fetchError:!1,data:[...e.regulars.data,t.regular]},list:{...e.list,productGroup:e.list.productGroup&&e.list.productGroup.products.length>0?E6e(e.list.productGroup,t.regular.productId):g6e(t.regular.productId)}};case Fa.REMOVE_REGULAR.SUCCESS:return{...e,regulars:{...e.regulars,isFetching:!1,fetchError:!1,data:X6e(t.productId,e.regulars.data)},list:{...e.list,productGroup:I6e(e.list.productGroup,t.productId)}};case Fa.UPDATE_REGULAR.PENDING:return{...e,actionInProgress:[...e.actionInProgress,t.productId]};case Fa.UPDATE_REGULAR.ERROR:return{...e,actionInProgress:e.actionInProgress.filter(n=>n!==t.productId)};case Fa.UPDATE_REGULAR.SUCCESS:return{...e,regulars:{...e.regulars,data:S6e(e.regulars.data,t)},actionInProgress:e.actionInProgress.filter(n=>n!==t.productId)};case Fa.REGULARS_SET_PRODUCT_GROUPS:return{...e,list:{...e.list,productGroup:y6e(t.payload.groups)}};default:return e}}function r8(e){return e?e.map(t=>t.productId):[]}function J6e(e){return e.data.customer.regulars?.addToRegularsModal}function e8e(e,t){return e.data.customer.regulars?.actionInProgress.includes(t)}function a8(e){return e.data.customer.regulars?.regulars.isFetching}function Cu(e){return e.data.customer.regulars?.regulars?.data||[]}function t8e(e,t){return Y(Cu,n=>n.find(o=>o.productId===t))(e)}const s8e=e=>Y(Cu,mo,(t,n)=>{const o=Object.keys(n),r=r8(t),a=o.filter(i=>!r.includes(i));return sC(n,a)})(e),n8e=e=>Y(Cu,b2,(t,n)=>{if(!n)return n;const o=r8(t);return n.map(r=>({...r,products:r.products.filter(a=>!o.includes(a))})).filter(r=>r.products.length!==0)})(e);function o8e(e){return e.data.customer.regulars.list.productGroup}const r8e=Y(Cu,mo,(e,t)=>b6e(e,t)),a8e=Y(o8e,r8e,(e,t)=>{if(!(!e||!t))return{group:e,products:t}}),i8=se("GET_HOMEPAGE_RECIPE_COMPONENTS"),i8e=()=>({type:"API",payload:{url:"/v1/recipes/components/home?imageFormat=avif",...i8,...Yi}}),zy={getHomePageComponents:i8e,types:{GET_HOMEPAGE_RECIPE_COMPONENTS:i8}},l8e=["http","https"],c8e=["H1","H2","H3","H4","H5","H6","P","DIV","SPAN","BR","B","I","U","LI","OL","UL","TABLE","TR","TD","TH","TBODY","THEAD","TFOOT","A","FONT","CAPTION"],d8e=["WIDTH","HEIGHT","HREF","COLOR","FACE","ID","CLASS","STYLE","TARGET","SCOPE"],u8e=RegExp(`^(${l8e.join("|")}):`,"gim");uR.addHook("afterSanitizeAttributes",e=>{e.hasAttribute("href")&&(e.tagName!=="A"||"protocol"in e&&!e.protocol.match(u8e))&&e.removeAttribute("href")});const Ri=e=>uR.sanitize(e,{ALLOWED_TAGS:c8e,ALLOWED_ATTR:d8e}),p8e=e=>uR.sanitize(e),so=e=>{try{const t=pce(e);return typeof t=="string"?p8e(t):Array.isArray(t)?t.map(so):t instanceof Object?(Object.keys(t).forEach(n=>{const o=t[n];t[n]=so(o)}),t):e}catch{return""}},ay={RECIPE_GROUP:"RECIPE_GROUP",COLLECTION_GROUP:"COLLECTION_GROUP",EXPANDED_COLLECTION:"EXPANDED_COLLECTION",SAVED_RECIPES:"SAVED_RECIPES"},fc={CATEGORY:"CATEGORY",SEARCH:"SEARCH"},m8e={WITHIN_GRID:"WITHIN_GRID"},mS={RECIPE_CARD:"RECIPE_CARD",COLLECTION_CARD:"COLLECTION_CARD"},Ud={default:"avif",fallback:"webp"},Ir=(e,t=0,n=0,o=Ud.default)=>{const r=ps.parseUrl(e.replace("{width}",`${t}`).replace("{height}",`${n}`),{sort:!1});return r.query.fm=o,ps.stringifyUrl(r,{sort:!1})},h8e=e=>{const r={...e};return r?.image?.url&&(r.image.url=Ir(r.image.url,960,200),r.image.fallbackUrl=Ir(r.image.url,960,200,Ud.fallback)),r.homePageEntities=[],e?.homePageEntities.forEach(a=>{if(a.type===ay.COLLECTION_GROUP&&a.collections?.length>0){const i={...a};i.collections=a.collections.map(l=>hS(l)),r.homePageEntities.push(i)}if(a.type===ay.RECIPE_GROUP&&a.recipes?.length>0){const i={...a};i.recipes=a.recipes.map(l=>vd(l,488)),r.homePageEntities.push(i)}if(a.type===ay.EXPANDED_COLLECTION){const i={...a};a.recipes?.length>0&&(i.recipes=a.recipes.map(l=>vd(l,488))),a.collections?.length>0&&(i.collections=a.collections.map(l=>hS(l))),r.homePageEntities.push(i)}if(a.type===ay.SAVED_RECIPES&&a.recipes?.length>0){const i={...a};i.recipes=a.recipes.map(l=>vd(l,488)),r.homePageEntities.push(i)}}),so(r)},vd=(e,t=640)=>{const n={...e},o=n.image.url;return n.image.url=Ir(o,t,t),n.image.fallbackUrl=Ir(o,t,t,Ud.fallback),so(n)},hS=e=>{const r={...e},a=r.image.url;r.image.url=Ir(a,700,338),r.image.fallbackUrl=Ir(a,700,338,Ud.fallback);const i=r.recipes?.map(l=>vd(l,420))||[];return r.recipes=i,so(r)},g8e=e=>{const n={...e},o=n.recipes?.map(r=>vd(r,420))||[];return n.recipes=o,so(n)},E8e=e=>{const n={...e},o=n.recipes?.map(r=>vd(r,420))||[];return n.recipes=o,so(n)},f8e=e=>{const t={...e},n=t.collections?.map(o=>hS(o))||[];return t.collections=n,so(t)},y8e=e=>{const o={...e},r=o.image.url;return o.image.url=Ir(r,700,338),so(o)},I8e=e=>{const t={...e},n=t.homePageComponents?.map(o=>y8e(o))||[];return t.homePageComponents=n,so(t)},S8e=e=>{const t=r=>{const a=r.products.map(i=>tq(i));return{...r,products:a}},n=e.ingredientSearch.map(r=>t(r)),o={...e,ingredientSearch:n};return so(o)},l8=e=>e.flatMap(n=>n.placement===m8e.WITHIN_GRID?n.items:[]).map(n=>{const o={...n};return o.fields=n.format===mS.RECIPE_CARD?C8e(n.fields):v8e(n.fields),o}),C8e=(e,t=640)=>{const n={...e},o=n.image.url;return n.image.url=Ir(o,t,t),n.image.fallbackUrl=Ir(o,t,t,Ud.fallback),so(n)},v8e=e=>{const r={...e},a=r.image.url;r.image.url=Ir(a,700,338),r.image.fallbackUrl=Ir(a,700,338,Ud.fallback);const i=r.recipeImages?.map(({url:l,altText:c})=>({url:Ir(l,240,240),fallbackUrl:Ir(l,240,240,Ud.fallback),altText:c}));return r.recipeImages=i,so(r)},T8e=e=>{const n={...e},o=n.image.url;return n.image.url=Ir(o,420,420),so(n)},_8e=(e=ms.recipes.homePageComponents,t)=>{switch(t.type){case zy.types.GET_HOMEPAGE_RECIPE_COMPONENTS.PENDING:return{...e,isFetching:!0,fetchError:!1};case zy.types.GET_HOMEPAGE_RECIPE_COMPONENTS.ERROR:return{...e,isFetching:!1,fetchError:!0};case zy.types.GET_HOMEPAGE_RECIPE_COMPONENTS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:I8e(t.payload.responseData),lastUpdated:de()};default:return e}},b8e=({data:e})=>e.recipes.homePageComponents,c8=se("GET_RECIPES_HOME"),x8e=()=>({type:"API",payload:{url:"/v1/recipes/home?imageFormat=avif",...c8,...Yi}}),Qy={getRecipesHome:x8e,types:{GET_RECIPES_HOME:c8}},A8e={...je,error:null,data:{image:void 0,homePageEntities:[]}},R8e=(e=A8e,t)=>{switch(t.type){case Qy.types.GET_RECIPES_HOME.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Qy.types.GET_RECIPES_HOME.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Qy.types.GET_RECIPES_HOME.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:h8e(t.payload.responseData),lastUpdated:de()};default:return e}},D8e=({data:e})=>e.recipes.homePage,O8e=({data:e})=>e.recipes.homePage.data?.image,GE=({data:e})=>e.recipes.homePage.data?.homePageEntities||[],Xy=se("GET_RECIPE_SEARCH"),P8e=({searchTerm:e,limit:t,offset:n})=>({type:"API",payload:{url:`/v1/recipes/search?${new URLSearchParams({searchTerm:e,limit:t?.toString()??"50",offset:n?.toString()??"0",imageFormat:"avif"}).toString()}`,...Xy,...Yi}}),N8e=(e=ms.recipes.searchPage,t)=>{switch(t.type){case Xy.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Xy.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Xy.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:E8e(t.payload.responseData),lastUpdated:de()};default:return e}},d8=({data:e})=>e.recipes.searchPage,iU=({data:e})=>e.recipes.searchPage.data?.totalRecipes,La=()=>"/recipes",u8=({basePath:e="",queryString:t}={})=>{const n=t?`?${t}`:"";return`${e}${La()}${n}`},Td=({basePath:e="",queryString:t=""}={})=>{const n=t?`?${t}`:"";return`${e}${La()}/collections${n}`},L8e=(e,t,{basePath:n="",queryString:o}={})=>{const r=o?`?${o}`:"";return`${n}${Td()}/${e}/${t}${r}`},p8=(e,t,{basePath:n="",queryString:o}={})=>{const r=o?`?${o}`:"";return`${n}${La()}/${e}/${t}${r}`},gS=({basePath:e="",queryString:t}={})=>{const n=t?`?${t}`:"";return`${e}${La()}/search-results${n}`},k8e=(e,t,{basePath:n="",queryString:o}={})=>{const r=o?`?${o}`:"";return`${n}${La()}/${e}/${t}/ingredients${r}`},m8=()=>`${La()}/saved-recipes`,Dh=se("GET_RECIPE_DETAILS"),vN=se("SAVE_RECIPE"),TN=se("UNSAVE_RECIPE"),h8="SET_CURRENT_RECIPE",j8e=({recipeCollectionId:e,recipeId:t})=>{const n=new URLSearchParams({imageFormat:"avif",...e&&{collectionId:e}});return{type:"API",payload:{url:`/v1/recipes/${t}?${n.toString()}`,...Dh,...Yi}}},M8e=e=>({type:h8,payload:{recipeId:e}}),w8e=e=>({type:"API",payload:{url:`/v1/recipes/${e}/save`,options:{method:"PUT"},...Yi,...vN},recipeId:e}),F8e=e=>({type:"API",payload:{url:`/v1/recipes/${e}/save`,options:{method:"DELETE"},...Yi,...TN},recipeId:e}),_N={getRecipeDetails:j8e,saveRecipe:w8e,unsaveRecipe:F8e,types:{GET_RECIPE_DETAILS:Dh,SAVE_RECIPE:vN,UNSAVE_RECIPE:TN}},B8e=(e={...je,error:null},t)=>{switch(t.type){case Dh.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Dh.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Dh.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:{...e.data,[t.payload.responseData.recipeId]:vd(t.payload.responseData)},lastUpdated:de()};case vN.SUCCESS:return e.data?.[t.recipeId]?{...e,isFetching:!1,fetchError:!1,data:{...e.data,[t.recipeId]:{...e.data[t.recipeId],isSaved:!0}},lastUpdated:de()}:e;case TN.SUCCESS:return e.data?.[t.recipeId]?{...e,isFetching:!1,fetchError:!1,data:{...e.data,[t.recipeId]:{...e.data[t.recipeId],isSaved:!1}},lastUpdated:de()}:e;case h8:return{...e,currentRecipe:t.payload.recipeId};case Pn:{const n=zr({path:p8(":recipeSlug",":recipeId")},t.payload.location.pathname||"");return n?{...e,currentRecipe:n.params.recipeId}:e}default:return e}},g8=({data:e})=>e.recipes.detailsPage,U8e=({data:e})=>e.recipes.detailsPage.error,Un=e=>{const t=g8(e);if(t.data&&t.currentRecipe&&t.currentRecipe in t.data)return t.data[t.currentRecipe]},G8e=e=>Un(e)?.slug,$8e=e=>Un(e)?.title,H8e=e=>Un(e)?.description,V8e=e=>Un(e)?.author,W8e=e=>Un(e)?.publishedDate,Y8e=e=>Un(e)?.collectionId,q8e=e=>({collectionId:Un(e)?.collectionId,collectionTitle:Un(e)?.collectionTitle,collectionSlug:Un(e)?.collectionSlug}),K8e=e=>({recipeId:Un(e)?.recipeId,recipeTitle:Un(e)?.title,recipeSlug:Un(e)?.slug}),z8e=e=>Un(e)?.method,Q8e=e=>Un(e)?.ingredients,X8e=e=>Un(e)?.servings,Z8e=e=>Un(e)?.totalTimeMinutes,J8e=e=>Un(e)?.prepTimeMinutes,eQe=e=>Un(e)?.cookingTimeMinutes,Zy=se("GET_SHOP_FOR_INGREDIENTS"),E8="SET_INGREDIENT_PRODUCT_ENTITIES",tQe=({recipeCollectionId:e,recipeId:t})=>{const n=new URLSearchParams({imageFormat:"avif",...e&&{collectionId:e}});return{type:"API",payload:{url:`/v1/recipes/${t}/ingredients?${n.toString()}`,...Zy,...Yi}}},sQe=()=>({type:E8}),nQe=(e={...je},t)=>{switch(t.type){case Zy.PENDING:return{...e,isFetching:!0,fetchError:!1,setProductEntities:!1,error:null};case Zy.ERROR:return{...e,isFetching:!1,fetchError:!0,setProductEntities:!1,error:t.payload};case Zy.SUCCESS:return{...e,isFetching:!1,fetchError:!1,setProductEntities:!1,data:S8e(t.payload.responseData),lastUpdated:de()};case E8:return{...e,setProductEntities:!0,isFetching:!1,fetchError:!1,error:null,lastUpdated:de()};default:return e}},oQe=({data:e})=>e.recipes.shopForIngredientsPage,rQe=({data:e})=>e.recipes.shopForIngredientsPage.error,aQe=({data:e})=>e.recipes.shopForIngredientsPage.data?.slug,iQe=({data:e})=>({recipeId:e.recipes.shopForIngredientsPage.data?.recipeId,recipeTitle:e.recipes.shopForIngredientsPage.data?.title,recipeSlug:e.recipes.shopForIngredientsPage.data?.slug}),lQe=({data:e})=>({collectionId:e.recipes.shopForIngredientsPage.data?.collectionId,collectionTitle:e.recipes.shopForIngredientsPage.data?.collectionTitle,collectionSlug:e.recipes.shopForIngredientsPage.data?.collectionSlug}),bN=({data:e})=>e.recipes.shopForIngredientsPage.data?.ingredientSearch,cQe=({data:e})=>e.recipes.shopForIngredientsPage.setProductEntities,f8=se("GET_RECIPE_COLLECTION_DETAILS"),dQe=e=>({type:"API",payload:{url:`/v1/recipes/collections/${e}?imageFormat=avif`,...f8,...Yi}}),Jy={getRecipeCollectionDetails:dQe,types:{GET_RECIPE_COLLECTION_DETAILS:f8}},uQe=(e={...ms.recipes.collectionDetailsPage,error:null},t)=>{switch(t.type){case Jy.types.GET_RECIPE_COLLECTION_DETAILS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Jy.types.GET_RECIPE_COLLECTION_DETAILS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Jy.types.GET_RECIPE_COLLECTION_DETAILS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:hS(t.payload.responseData),lastUpdated:de(),error:null};default:return e}},pQe=({data:e})=>e.recipes.collectionDetailsPage,mQe=({data:e})=>({collectionId:e.recipes.collectionDetailsPage.data?.collectionId,collectionTitle:e.recipes.collectionDetailsPage.data?.title,collectionSlug:e.recipes.collectionDetailsPage.data?.slug}),hQe=({data:e})=>e.recipes.collectionDetailsPage.error,gQe=({data:e})=>e.recipes.collectionDetailsPage.data?.slug,y8=({data:e})=>e.recipes.collectionDetailsPage.data?.title,EQe=({data:e})=>e.recipes.collectionDetailsPage.data?.description,fQe=({data:e})=>e.recipes.collectionDetailsPage.data?.image,yQe=({data:e})=>e.recipes.collectionDetailsPage.data?.recipes,I8="SET_RECIPES",IQe=e=>({type:I8,payload:e}),SQe={data:{}},CQe=(e=SQe,t)=>{switch(t.type){case I8:{const o=(e.data[t.payload.searchTerm]??[]).concat(t.payload.recipes);return{data:{[t.payload.searchTerm]:[...new Map(o.map(r=>[r.recipeId,r])).values()]},lastUpdated:de()}}default:return e}},S8=({data:e})=>e.recipes.recipeEntities.data,C8="SET_RECIPE_COLLECTIONS",xN=e=>({type:C8,payload:e});xN.match=e=>e.type===C8;const vQe=(e={},t)=>{if(xN.match(t)){const n=e?.collections||[];let o=[];if(t.payload.clear)o=t.payload.collections;else{const a=n.concat(t.payload.collections);o=[...new Map(a.map(i=>[i.collectionId,i])).values()]}return{collections:o,lastUpdated:de()}}return e},v8=({data:e})=>e.recipes.collectionEntities?.collections,eI=se("GET_RECIPE_COLLECTIONS"),TQe=({limit:e,offset:t})=>({type:"API",payload:{url:`/v1/recipes/collections?${new URLSearchParams({limit:e.toString(),offset:t.toString(),imageFormat:"avif"}).toString()}`,...eI,...Yi}}),_Qe={...je,error:null},bQe=(e=_Qe,t)=>{switch(t.type){case eI.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case eI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case eI.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,data:f8e(t.payload.responseData),lastUpdated:de()};default:return e}},xQe=({data:e})=>e.recipes.collectionsPage,AQe=({data:e})=>e.recipes.collectionsPage.data?.totalCollections,T8=se("GET_SAVED_RECIPES"),RQe="CLEAR_SAVED_RECIPES",DQe=e=>{const n=(e-1)*50,o=new URLSearchParams({limit:"50",offset:n.toString(),imageFormat:"avif"});return{type:"API",page:e,payload:{url:`/v1/recipes/saved-recipes?${o.toString()}`,...T8,...Yi}}},OQe=()=>({type:"CLEAR_SAVED_RECIPES"}),ld={getSavedRecipes:DQe,clear:OQe,types:{GET_SAVED_RECIPES:T8,CLEAR_SAVED_RECIPES:RQe}},PQe=(e=ms.recipes.savedRecipesPage,t)=>{switch(t.type){case ld.types.GET_SAVED_RECIPES.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case ld.types.GET_SAVED_RECIPES.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case ld.types.GET_SAVED_RECIPES.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:{totalRecipes:t.payload.responseData.totalRecipes,[t.page]:g8e(t.payload.responseData)?.recipes||[],...e?.data},error:null};case ld.types.CLEAR_SAVED_RECIPES:return ms.recipes.savedRecipesPage;default:return e}},NQe=({data:e})=>e.recipes.savedRecipesPage,LQe=({data:e})=>e.recipes.savedRecipesPage?.data?.totalRecipes||0,kQe=({data:e},t)=>{const n=e.recipes.savedRecipesPage.data;return n?[...Array(t).keys()].map(r=>n?.[r+1]||[]).flat():[]},Oh=se("GET_SEARCH_PAGE_RECIPE_ADVERTS"),jQe=e=>({type:"API",searchTerm:e,payload:{url:"/v1/recipes/adverts?imageFormat=avif",options:{method:"PUT",body:{key:e,pageDto:fc.SEARCH}},...Oh}}),MQe={fetchSearchPageRecipeAdverts:jQe,types:{GET_SEARCH_PAGE_RECIPE_ADVERTS:Oh}},wQe={...je,data:void 0,error:null},FQe=(e=wQe,t)=>{switch(t.type){case Oh.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Oh.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Oh.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:{[t.searchTerm]:l8(t.payload.responseData)},lastUpdated:de()};default:return e}},BQe=e=>{const{searchTerm:t}=Qp(e);return e.data.recipes.searchPageRecipeAdverts.data?.[t]||[]},Ph=se("GET_CATEGORY_PAGE_RECIPE_ADVERTS"),UQe=e=>({type:"API",categoryId:e,payload:{url:"/v1/recipes/adverts?imageFormat=avif",options:{method:"PUT",body:{key:e,pageDto:fc.CATEGORY}},skipLoginRedirect:!0,...Ph}}),GQe={fetchCategoryPageRecipeAdverts:UQe,types:{GET_CATEGORY_PAGE_RECIPE_ADVERTS:Ph}},$Qe={...je,data:void 0,error:null},HQe=(e=$Qe,t)=>{switch(t.type){case Ph.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Ph.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Ph.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData?l8(t.payload.responseData):[],lastUpdated:de()};default:return e}},VQe=e=>e.data.recipes.categoryPageRecipeAdverts.data||[],WQe=(e,t=0,n=0)=>e.replace("{width}",`${t}`).replace("{height}",`${n}`),YQe=(e,t=640)=>{const n={...e},o=n.image.url;return n.image.url=WQe(o,t,t),so(n)},_8=(e,t=640)=>{const n={...e},o=n.results?.map(r=>YQe(r,t));return n.results=o,so(n)},qQe=e=>{const t={...e};return so(t)},KQe=(e,t=640)=>{const n={...e},o=n.messageHistory.map(r=>_8(r,t));return n.messageHistory=o,so(n)},zQe=(e,t=640)=>{const n={...e},o=_8(n.responseMessage,t);return n.responseMessage=o,so(n)},iy={isFetching:{CREATE_CHAT:!1,GET_CHAT_HISTORY:!1,SEND_MESSAGE:!1},isFlowoutDisabled:!1,data:{}},QQe=(e=iy,t)=>{switch(t.type){case Ks.CREATE_CHAT.PENDING:return{isFlowoutDisabled:!1,isFetching:{...iy.isFetching,CREATE_CHAT:!0},error:null,data:iy.data};case Ks.GET_CHAT_HISTORY.PENDING:return{...e,isFetching:{...e.isFetching,GET_CHAT_HISTORY:!0},error:null};case Ks.CREATE_CHAT.ERROR:{const n=Math.max(t.timestamp+2e3-de(),0);return{...e,isFetching:{...e.isFetching,CREATE_CHAT:!1},error:t.type,remainingLoadingTime:n}}case Ks.GET_CHAT_HISTORY.ERROR:return{...e,isFetching:{...e.isFetching,GET_CHAT_HISTORY:!1},error:t.type};case Ks.CREATE_CHAT.SUCCESS:{const{chatId:n,expiryTime:o,initialMessage:r}=qQe(t.payload.responseData),a=Math.max(t.timestamp+2e3-de(),0);return{...e,isFetching:{...e.isFetching,CREATE_CHAT:!1},error:null,remainingLoadingTime:a,data:{chatId:n,expiryTime:o,messageHistory:[r]}}}case Ks.DISABLE_FLOWOUT:return{...e,isFlowoutDisabled:!0,error:null};case Ks.GET_CHAT_HISTORY.SUCCESS:return e.isFetching.GET_CHAT_HISTORY?{...e,isFetching:{...e.isFetching,GET_CHAT_HISTORY:!1},error:null,data:KQe(t.payload.responseData)}:e;case Ks.SEND_MESSAGE.PENDING:{const{messageHistory:n=[]}=e.data,o=e.error==="SEND_MESSAGE_ERROR"&&n[n.length-1]?.messageId==="temp";return{...e,isFetching:{...e.isFetching,SEND_MESSAGE:!0},error:null,remainingLoadingTime:void 0,data:{...e.data,messageHistory:[...o?n.slice(0,-1):n,{message:t.message,role:oo.USER,messageId:"temp"}]}}}case Ks.SEND_MESSAGE.ERROR:{let n;t.payload instanceof sA&&t.payload.statusCode===500&&t.payload.hasCode()&&(n=t.payload.code);const o=n?.startsWith("LLM")?`SEND_MESSAGE_ERROR_${n==="LLM-001"?"RETRY":"FATAL"}`:"SEND_MESSAGE_ERROR";return{...e,isFetching:{...e.isFetching,SEND_MESSAGE:!1},error:o}}case Ks.SEND_MESSAGE.SUCCESS:{if(!e.isFetching.SEND_MESSAGE)return e;const{chatId:n,expiryTime:o,userMessageId:r,responseMessage:a}=zQe(t.payload.responseData),{messageHistory:i=[]}=e.data,l=Math.max(t.timestamp+2e3-de(),0);return{...e,isFetching:{...e.isFetching,SEND_MESSAGE:!1},error:null,remainingLoadingTime:l,data:{chatId:n,expiryTime:o,messageHistory:[...i.slice(0,-1),{...i[i.length-1],messageId:r},a]}}}case Ks.SET_CHAT:{const{chatId:n}=t.payload;return{...e,error:null,data:{...e.data,chatId:n}}}case Ks.CLEAR_CHAT:return iy;case Ks.SET_SHOW_REFRESH_DIALOG:return{...e,showRefreshDialog:t.payload.showRefreshDialog};default:return e}},b8=e=>e.data.recipes.chat.isFetching,Zv=e=>e.data.recipes.chat.data.chatId,XQe=e=>e.data.recipes.chat.data.expiryTime,x8=e=>e.data.recipes.chat.data.messageHistory??[],ZQe=e=>e.data.recipes.chat.isFlowoutDisabled,AN=e=>e.data.recipes.chat.error,JQe=({data:{recipes:e}})=>e.chat.remainingLoadingTime,A8=({data:{recipes:e}})=>!!e.chat.showRefreshDialog,R8=e=>x8(e).findLastIndex(n=>!!n.results),e9e=Us({homePageComponents:_8e,homePage:R8e,searchPage:N8e,recipeEntities:CQe,collectionEntities:vQe,detailsPage:B8e,shopForIngredientsPage:nQe,collectionDetailsPage:uQe,collectionsPage:bQe,savedRecipesPage:PQe,searchPageRecipeAdverts:FQe,categoryPageRecipeAdverts:HQe,chat:QQe}),$E={service:"mealplanning",pathPrefix:{client:"/api/meals",server:"/core-api"}},tI=se("GET_MEALS"),Jv=(e="")=>{const t=new URLSearchParams;return e&&t.set("sort_by",e),{type:"API",payload:{url:`/v1/meals${t.size?`?${t.toString()}`:""}`,...tI,...$E}}},t9e={RECIPE:"RECIPE"},s9e=e=>{const t=Tc(e);return t<=-14?"mealplanning.meal-plan.previous-plan-header-title":t<=-7?"mealplanning.meal-plan.last-week-header-title":t<=0?"mealplanning.meal-plan.this-week-header-title":t<=7?"mealplanning.meal-plan.next-week-header-title":"mealplanning.meal-plan.future-plan-header-title"},n9e=e=>e===0?"date.today":e===1?"date.tomorrow":null,o9e=e=>{const t=BH(e.start,e.end),n=(Array.isArray(t)?t:[]).map(o=>{const r=Tc(o);return{relativeNameTranslationId:n9e(r),dayNameString:qs(Ja,o),dayStatus:r===0?"CURRENT":r<0?"PAST":"FUTURE",date:qs(bH,o)}});return{...e,weekString:s9e(e.start),weekStart:gt(e.start,Dx),weekEnd:gt(e.end,Dx),weekIntervalString:Vg(e.start,e.end,AH),days:n}},r9e=e=>{const t=e.weeks.filter((n,o)=>o>2||n.days.length>0);return{...e,weeks:t.map(o9e)}},a9e=e=>{const t={...e};return t.meals=e.meals.map(n=>n.type===t9e.RECIPE?T8e(n):n),t},i9e=(e=je,t)=>{switch(t.type){case tI.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case tI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case tI.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:a9e(t.payload.responseData)};default:return e}},l9e=({data:e})=>e.mealPlanning.meals.isFetching,c9e=({data:e})=>e.mealPlanning.meals.data?.meals,D8=({data:e})=>e.mealPlanning.meals.data?.sortOptions,Tm=({data:e})=>e.mealPlanning.meals.data?.sortedBy,d9e=({data:e})=>e.mealPlanning.meals.data?.totalMeals,u9e=({data:e})=>e.mealPlanning.meals.data?.totalRecipes,sI=se("GET_MEAL_PLAN"),p9e=()=>({type:"API",payload:{url:"/v1/meals/plan",...sI,...$E}}),m9e={...je,data:{weeks:[],meals:[]}},h9e=(e=m9e,t)=>{switch(t.type){case sI.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case sI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case sI.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:r9e(t.payload.responseData)};default:return e}},g9e=({data:e})=>e.mealPlanning.mealPlan.data,E9e=Us({meals:i9e,mealPlan:h9e}),O8=se("GET_REVIEWS"),RN=se("UPDATE_REVIEW_HELPFULNESS"),f9e=(e,t={})=>{const n=Object.keys(t).length>0?`?${Qe.stringify(t)}`:"";return{type:"API",payload:{service:DN,url:`/ecomreviews/v1/products/${e}/reviews${n}`,...O8}}},DN="ecomreviews",y9e=e=>({type:"API",payload:{service:DN,url:"/ecomreviews/v1/reviews/helpfulness",options:{method:"POST",body:{reviewId:e}},...RN}}),I9e=e=>({type:"API",payload:{service:DN,url:"/ecomreviews/v1/reviews/helpfulness",options:{method:"PUT",body:{reviewId:e}},...RN}}),cd={getReviewsData:f9e,postReviewHelpfulness:y9e,deleteReviewHelpfulness:I9e,types:{GET_REVIEWS:O8,UPDATE_REVIEW_HELPFULNESS:RN}},S9e=je,C9e=(e=S9e,t)=>{switch(t.type){case cd.types.GET_REVIEWS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case cd.types.GET_REVIEWS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case cd.types.GET_REVIEWS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData,lastUpdated:de()};case cd.types.UPDATE_REVIEW_HELPFULNESS.SUCCESS:{if(!e.data)return e;const n=t.payload.responseData;return{...e,data:{...e.data,reviews:e.data.reviews.map(o=>o.id===n.id?{...o,...n}:o)}}}default:return e}},P8=({data:e})=>e.bop.reviews,N8=({data:e})=>e.bop.reviews.data?.ratingHistogram,L8=({data:e})=>e.bop.reviews.data?.reviews,ON=({data:e})=>e.bop.reviews.data?.metadata.sortOptions,PN=({data:e})=>e.bop.reviews.data?.reviewCount,v9e=({data:e})=>e.bop.reviews.data?.metadata.nextPage,eT=Eo("ratingSummary"),T9e=({data:e},t)=>e.products.productEntities[t]?.ratingSummary,nI=se("GET_FOOTER_LINKS"),k8=()=>({type:"API",payload:{url:"/v3/content/footer-links",...nI}}),_9e=(e=ms.footer,t)=>{switch(t.type){case nI.PENDING:return{...e,isFetching:!0,fetchError:!1};case nI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.error};case nI.SUCCESS:{const{responseData:n}=t.payload;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),links:{sections:n.columns,contact:n.contactUs||n.contactLink,social:n.socialMedia,legalText:n.legalText}}}default:return e}},b9e=({data:{content:{footer:e}}})=>({lastUpdated:e.lastUpdated}),ep={value:"",encodedName:void 0},lU={WebAddressTarget:e=>({value:e.url}),StaticPageTarget:e=>({value:e.staticPage}),SearchTarget:e=>({value:e.searchTerm}),ShopInShopTarget:e=>({value:e.shop}),CategoryTarget:e=>({value:e.categoryId,encodedName:e.nameHierarchy.map(t=>Cn(t).toLowerCase()).join("/")}),PromotionTarget:e=>({value:e.promotionId,encodedName:Cn(e.description).toLowerCase()}),PromotionsLandingTarget:()=>({...ep}),ProductTarget:e=>({value:e.retailerProductId,encodedName:Cn(e.description).toLowerCase()}),FavoritesTarget:()=>({...ep}),OrdersTarget:()=>({...ep}),SlotBookingTarget:()=>({...ep})},ao=({basePath:e="",queryString:t}={})=>{const n=t?`?${t}`:"";return`${e}/products${n}`},bo=(e,{basePath:t="",queryString:n}={})=>{const o=n?`?${n}`:"";return e?`${t}/categories/${e}${o}`:`${t}/categories${o}`},Sa=(e,t,{basePath:n="",queryString:o}={})=>{const r=o?`?${o}`:"";return t?`${n}/categories/${t}/${e}${r}`:e?`${n}/categories/${e}${r}`:`${n}/categories${r}`},di=(e,{basePath:t="",queryString:n}={})=>{const o=n?`?${n}`:"";return e?`${t}/promotions/${e}${o}`:`${t}/promotions${o}`},Nh=(e,t,{basePath:n="",queryString:o}={})=>{const r=o?`?${o}`:"";return t?`${n}/promotions/${t}/${e}${r}`:e?`${n}/promotions/${e}${r}`:`${n}/promotions${r}`},_m=({queryString:e}={})=>`/favorites${e?`?${e}`:""}`,Za=(e=!1,{basePath:t="",queryString:n}={})=>{const o=n?`?${n}`:"";return e?`${t}/search${o}`:`${ao({basePath:t})}/search${o}`},qa=(e,t,{basePath:n="",queryString:o=""}={})=>{const r=o?`?${o}`:"";return t?`${n}/offers/${t}/${e}${r}`:`${n}/offers/${e}${r}`},Uo=(e,t,{basePath:n="",queryString:o}={})=>{const r=o?`?${o}`:"";return t?`${ao({basePath:n})}/${t}/${e}${r}`:`${ao({basePath:n})}/${e}/details${r}`},kc=(e,{isSEOReadableURLEnabled:t})=>{const n=Cn(e);if(t)return n?.toLowerCase()},NN=e=>`/content/${e}`,x9e="/shop-in-shop/:pageId",vg=e=>x9e.replace(/:pageId/,e),A9e={SearchTarget:(e,t,n)=>Za(t,{basePath:n,queryString:`q=${encodeURIComponent(e.value)}`}),PromotionTarget:(e,t,n)=>qa(e.value,t&&e.encodedName?e.encodedName:void 0,{basePath:n}),PromotionsLandingTarget:()=>di(),ProductTarget:(e,t)=>Uo(e.value,t&&e.encodedName?e.encodedName:void 0),CategoryTarget:(e,t,n)=>t?Sa(e.value,e.encodedName||""):ao({basePath:n,queryString:`sublocationId=${e.value}`}),StaticPageTarget:e=>NN(e.value),WebAddressTarget:e=>e.value,FavoritesTarget:()=>_m(),OrdersTarget:()=>lo(),SlotBookingTarget:()=>Ui(),ShopInShopTarget:e=>vg(e.value)},R9e=(e,t)=>t?`${e?.endsWith("/")?e.substring(0,e.length-1):e}${t}`:e,LN=(e,t,n,o,r)=>{const a=n?o?.toLowerCase():o;switch(e){case kt.FOP:return Za(n,{queryString:`q=${t}`});case kt.KEYWORD:return Za(n,{queryString:`q=${t}`});case kt.PROMOTION:return qa(t,n?a:"");case kt.PROMOTIONS_LANDING:return di();case kt.BOP:return Uo(t,n?a:void 0);case kt.CATEGORY:{const i=`sublocationId=${t}`;return n?Sa(t,a):ao({queryString:i})}case kt.CMS_STATIC_PAGE:return NN(t);case kt.SLOT_BOOKING:return Ui();case kt.FAVORITES:return _m();case kt.ORDERS:return lo();case kt.SHOP_IN_SHOP:case kt.SHOP_IN_SHOP_TEMPLATED:return vg(t);case kt.WEB_ADDRESS:case kt.ABSOLUTE_WEB_ADDRESS:case kt.INTERNAL_PAGE:case kt.INTERNAL_WEB_ADDRESS:return t;case kt.RETAIL_BANNER:return R9e(t,r);case kt.DEFAULT_TAB:return"/";default:return""}},D9e=(e,t)=>{switch(e){case kt.FOP:case kt.KEYWORD:return encodeURIComponent(t);default:return encodeURI(t)}},O9e=(e,t={isSEOReadableURLEnabled:!1},n)=>{if(!e)return"";const o=e.linkType,r=e.ids&&e.ids[0]||e.values&&e.values[0]||e.value&&e.value||"",{isSEOReadableURLEnabled:a=!1}=t,i=typeof e.encodedName=="string"?e.encodedName:"",l=a?i:"",c=D9e(o,r);return LN(o,c,a,l,n)},P9e=e=>e===kt.CATEGORY||e===kt.PROMOTION,N9e=(e,t)=>e.__typename===t,L9e={WebAddressTarget:kt.ABSOLUTE_WEB_ADDRESS,ProductTarget:kt.BOP,CategoryTarget:kt.CATEGORY,StaticPageTarget:kt.CMS_STATIC_PAGE,FavoritesTarget:kt.FAVORITES,SearchTarget:kt.KEYWORD,OrdersTarget:kt.ORDERS,ShopInShopTarget:kt.SHOP_IN_SHOP_TEMPLATED,PromotionsLandingTarget:kt.PROMOTIONS_LANDING,SlotBookingTarget:kt.SLOT_BOOKING,PromotionTarget:kt.PROMOTION},j8=e=>{const t=e.__typename;if(!t||!(t in lU))return;const n={typeName:t,openInNewTab:e.shouldBeOpenedInNewTab},o=lU[t],r=N9e(e,t)?o(e):{...ep};return{...n,...ep,...r}},k9e=(e,t=!1)=>{const n=L9e[e.__typename],o=!!e.shouldBeOpenedInNewTab;if(!n)throw new Error(`Unknown linkType for __typename ${e.__typename}`);switch(e.__typename){case"WebAddressTarget":return{linkType:n,openInNewTab:o,values:[e.url],value:e.url};case"StaticPageTarget":return{linkType:n,openInNewTab:o,values:[e.staticPage],value:e.staticPage};case"SearchTarget":return{linkType:n,openInNewTab:o,values:[e.searchTerm]};case"ShopInShopTarget":return{linkType:n,openInNewTab:o,values:[e.shop]};case"CategoryTarget":{let r;return e.nameHierarchy&&Array.isArray(e.nameHierarchy)&&(r=e.nameHierarchy.map(a=>Cn(a).toLowerCase()).join("/")),{linkType:n,openInNewTab:o,values:[t?e.retailerCategoryId:e.categoryId],...r?{encodedName:r}:{}}}case"PromotionTarget":return{linkType:n,openInNewTab:o,values:[t?e.retailerPromotionId:e.promotionId],encodedName:e.description?Cn(e.description).toLowerCase():void 0};case"ProductTarget":return{linkType:n,openInNewTab:o,values:[e.retailerProductId],encodedName:e.description?Cn(e.description).toLowerCase():void 0};case"FavoritesTarget":case"OrdersTarget":case"PromotionsLandingTarget":case"SlotBookingTarget":return{linkType:n,openInNewTab:o};default:throw new Error(`Unsupported target type: ${e.__typename}`)}},j9e=(e,{isSEOReadableURLEnabled:t=!1}={},n="")=>{if(!e)return"";const o=j8(e);if(!o)return"";const r=A9e[o.typeName];return r?r(o,t,n):""},M9e=(e,t={isSEOReadableURLEnabled:!1},n)=>O9e(e,t,n),Aa={normalizeTarget:j8,normalizeToLegacyTarget:k9e,calculateUrl:j9e,calculateLegacyTargetUrl:M9e},oI=se("FETCH_TOPTABS"),M8=(e="",t=!1)=>({type:"API",payload:{url:"/v1/content/top-tabs",...oI},isSEOReadableURLEnabled:t,basePath:e}),w9e=e=>{const t=e.linkType;return[kt.ABSOLUTE_WEB_ADDRESS,kt.RETAIL_BANNER].includes(t)},F9e=(e,t,n)=>e.map(r=>({...r,targetURL:Aa.calculateLegacyTargetUrl(r.target,{isSEOReadableURLEnabled:t},n),isExternalLink:w9e(r.target),encodedTargetValue:r.default?void 0:encodeURI(r.target.value).toLowerCase()})),B9e=(e=ms.topTabs,t)=>{switch(t.type){case oI.PENDING:return{...e,isFetching:!0,fetchError:!1};case oI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case oI.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:t.payload.responseData?F9e(t.payload.responseData,t.isSEOReadableURLEnabled,t.basePath):[]};default:return e}},rI=se("GET_CONTENT_BLOCKS"),U9e=e=>{const t=e?.target?.linkType;return t==="WEB_ADDRESS"||t==="ABSOLUTE_WEB_ADDRESS"},G9e=(e,t)=>e.map(n=>n?.target?{...n,targetUrl:Aa.calculateLegacyTargetUrl(n.target,{isSEOReadableURLEnabled:t}),isExternalLink:U9e(n)}:{...n}),$9e=(e=ms.contentBlocks,t)=>{switch(t.type){case rI.PENDING:return{...e,isFetching:!0,fetchError:!1};case rI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.error};case rI.SUCCESS:{const{responseData:n}=t.payload;return n.length>0?{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),blocks:G9e(n,t.isSEOReadableURLEnabled)}:e}default:return e}},w8=se("GET_STATIC_CONTENT_V2"),F8=e=>({type:"API",pageId:e,payload:{url:`/v2/content/page/${e}`,...w8}}),cb={GET_STATIC_CONTENT_V2:w8},H9e={...je,content:"",pageId:null},V9e=(e=H9e,t)=>{switch(t.type){case cb.GET_STATIC_CONTENT_V2.PENDING:return{...e,isFetching:!0,fetchError:!1};case cb.GET_STATIC_CONTENT_V2.ERROR:return{...e,isFetching:!1,fetchError:!0,pageId:t.pageId};case cb.GET_STATIC_CONTENT_V2.SUCCESS:return{...e,isFetching:!1,fetchError:!1,content:t.payload.responseData.html,componentItems:t.payload.responseData.componentItems,pageTitle:t.payload.responseData.name,pageId:t.pageId};default:return e}},W9e=Us({staticContentPage:V9e,contentBlocks:$9e,footer:_9e,topTabs:B9e}),Y9e={},db={...je,productIds:[]},q9e=(e=Y9e,t)=>{switch(t.type){case"GET_LISTER_PAGE_PENDING":return{...e,[t.advertId]:{...db,isFetching:!0}};case"GET_LISTER_PAGE_SUCCESS":return{...e,[t.advertId]:{...db,productIds:t.payload.responseData.productIds}};case"GET_LISTER_PAGE_ERROR":return{...e,[t.advertId]:{...db,fetchError:!0}};default:return e}},K9e=(e=ms.toggleablePromotions,t)=>{switch(t.type){case $a.actionTypes.GET_AVAILABLE_PROMOTION_SELECTIONS.PENDING:case $a.actionTypes.GET_PROMOTION_DESCRIPTIONS.PENDING:return{...e,isFetching:!0,fetchError:!1};case $a.actionTypes.GET_AVAILABLE_PROMOTION_SELECTIONS.ERROR:case $a.actionTypes.GET_PROMOTION_DESCRIPTIONS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case $a.actionTypes.SET_TOGGLEABLE_PROMOTIONS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:t.payload.toggleablePromotions};default:return e}},B8=se("GET_NEXT_AVAILABLE_SLOT"),z9e=e=>({type:"API",payload:{pathPrefix:{client:"/api/ecomslots",server:"/core-api"},service:"ecomslots",url:"/v1/slots/next-available-slot",options:{method:"POST",body:{deliveryDestinationId:e}},...B8}}),aI={fetchNextAvailableSlot:z9e,types:{GET_NEXT_AVAILABLE_SLOT:B8}},Q9e={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null,error:null,data:null},U8=e=>{if(!e)return null;const t=e?.pricedSlot,n=t?.slotWindow,o=n?.startTime,r=n?.endTime,a=t?.timeZoneId,i=e?.deliveryAddress;return{startTime:ad(o,a),endTime:ad(r,a),timeZoneId:a,address:i,type:t?.type,deliveryMethod:i?.deliveryMethod,collectionTimeInMinutes:t?.onDemandProperties?.collectionTimeInMinutes,deliveryTimeInMinutes:t?.onDemandProperties?.deliveryTimeInMinutes}},X9e=(e=Q9e,t)=>{switch(t.type){case aI.types.GET_NEXT_AVAILABLE_SLOT.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case aI.types.GET_NEXT_AVAILABLE_SLOT.ERROR:{const n=t.payload;return{...e,isFetching:!1,fetchError:!0,error:n,lastUpdated:de(),data:null}}case aI.types.GET_NEXT_AVAILABLE_SLOT.SUCCESS:{const n=t.payload.responseData,o=U8(n);return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:o}}default:return e}},Z9e=({data:e})=>e.delivery.nextAvailableSlot,J9e={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null,error:null,data:null,debouncedSlotListingRequests:0,pendingSlotListingRequests:0,lastSlotListingRequestStartTime:null,successRequestParams:null,persistedPreviousAddress:void 0},G8=se("GET_SLOTS"),$8="SET_SLOTS",H8="SET_SLOTS_ERROR",V8="REQUEST_SLOTS_DEBOUNCED",W8="INVALIDATE_SLOTS",Y8="PERSIST_PREVIOUS_SELECTED_ADDRESS",q8="CLEAR_PERSISTED_PREVIOUS_SELECTED_ADDRESS",e7e=({deliveryDestinationId:e,shippingGroupType:t,viewingLocation:n,pageViewId:o,sessionId:r,regionId:a,requestStartTime:i})=>({type:"API",payload:{url:"/v1/slots",service:"ecomslots",pathPrefix:{client:"/api/ecomslots",server:"/core-api"},options:{method:"POST",body:{...t?{shippingGroupType:t}:{},deliveryDestinationId:e,regionId:a,...r?{analyticsData:{sessionId:r,viewingLocation:n,platform:"WEB",...o?{pageViewId:o}:{}}}:{}}},...G8},requestStartTime:i}),t7e=({data:e,requestStartTime:t,successRequestParams:n})=>({type:$8,payload:{data:e,requestStartTime:t,successRequestParams:n}}),s7e=e=>({type:H8,payload:e}),n7e=()=>({type:V8}),o7e=()=>({type:W8}),r7e=()=>({type:Y8}),a7e=()=>({type:q8}),To={getSlots:e7e,setSlots:t7e,setSlotsError:s7e,requestSlotsDebounced:n7e,invalidateSlots:o7e,persistPreviouslySelectedAddress:r7e,clearPersistedPreviouslySelectedAddress:a7e,types:{GET_SLOTS:G8,SET_SLOTS:$8,SET_SLOTS_ERROR:H8,REQUEST_SLOTS_DEBOUNCED:V8,INVALIDATE_SLOTS:W8,PERSIST_PREVIOUS_SELECTED_ADDRESS:Y8,CLEAR_PERSISTED_PREVIOUS_SELECTED_ADDRESS:q8}},i7e=(e=J9e,t)=>{switch(t.type){case To.types.REQUEST_SLOTS_DEBOUNCED:return{...e,debouncedSlotListingRequests:e.debouncedSlotListingRequests+1};case To.types.GET_SLOTS.PENDING:return{...e,isFetching:!0,didInvalidate:!1,lastSlotListingRequestStartTime:t.requestStartTime,pendingSlotListingRequests:e.pendingSlotListingRequests+1,debouncedSlotListingRequests:0};case To.types.SET_SLOTS_ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload||null,pendingSlotListingRequests:Math.max(e.pendingSlotListingRequests-1,0),successRequestParams:null};case To.types.SET_SLOTS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:(!e.lastSlotListingRequestStartTime||Vt(t.payload?.requestStartTime).isSameOrAfter(Vt(e.lastSlotListingRequestStartTime)))&&t.payload?t.payload.data:e?.data,pendingSlotListingRequests:Math.max(e.pendingSlotListingRequests-1,0),successRequestParams:t.payload?.successRequestParams};case To.types.INVALIDATE_SLOTS:return{...e,didInvalidate:!0};case To.types.PERSIST_PREVIOUS_SELECTED_ADDRESS:return{...e,persistedPreviousAddress:!0};case To.types.CLEAR_PERSISTED_PREVIOUS_SELECTED_ADDRESS:return{...e,persistedPreviousAddress:!1};default:return e}},K8=se("GET_DELIVERY_OPTIONS"),z8=se("UPDATE_DELIVERY_OPTIONS"),Q8="SET_DELIVERY_OPTIONS",l7e=(e,t,n)=>({type:"API",payload:{url:`/ecomfulfillments/v1/orders/${e}/delivery-details-draft/options?deliveryDestinationId=${t}&regionId=${n}`,options:{method:"GET"},service:"ecomfulfillments",...K8},lastRequested:de()}),c7e=({orderId:e,regionId:t,deliveryDestinationId:n,data:o})=>({type:"API",payload:{url:`/ecomfulfillments/v1/orders/${e}/delivery-details-draft?deliveryDestinationId=${n}&regionId=${t}`,options:{method:"PUT",body:o},service:"ecomfulfillments",...z8}}),d7e=e=>({type:Q8,payload:e}),dd={getDeliveryOptions:l7e,updateDeliveryOptions:c7e,setDeliveryOptions:d7e,types:{GET_DELIVERY_OPTIONS:K8,UPDATE_DELIVERY_OPTIONS:z8,SET_DELIVERY_OPTIONS:Q8}},u7e={...je,options:null,error:null,lastRequested:null},p7e=(e=u7e,t)=>{switch(t.type){case dd.types.GET_DELIVERY_OPTIONS.PENDING:return{...e,lastRequested:t.lastRequested,isFetching:!0,fetchError:!1,error:null};case dd.types.GET_DELIVERY_OPTIONS.ERROR:return e.lastRequested!==t.lastRequested?e:{...e,isFetching:!1,fetchError:!0,error:t.payload};case dd.types.GET_DELIVERY_OPTIONS.SUCCESS:return e.lastRequested!==t.lastRequested?e:{...e,isFetching:!1,fetchError:!1,lastUpdated:t.lastRequested,options:t.payload.responseData};case dd.types.SET_DELIVERY_OPTIONS:return{...e,options:t.payload,lastUpdated:de()};default:return e}},X8=se("GET_SLOT_DISPLAY_MODES"),m7e=e=>({type:"API",payload:{url:`/v1/slot-display-modes${e?`?regionId=${e}`:""}`,service:"checkoutgroups",pathPrefix:{client:"/api/checkout-groups",server:"/core-api"},...X8}}),iI={getSlotDisplayModes:m7e,types:{GET_SLOT_DISPLAY_MODES:X8}},h7e=(e=uVe,t)=>{switch(t.type){case iI.types.GET_SLOT_DISPLAY_MODES.PENDING:return{...e,isFetching:!0};case iI.types.GET_SLOT_DISPLAY_MODES.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case iI.types.GET_SLOT_DISPLAY_MODES.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:{shippingGroups:t.payload.responseData}};default:return e}},g7e={smallOrderChargeThresholds:[],error:null,isFetching:!1},Z8=se("GET_SMALL_ORDER_CHARGE"),E7e=({regionId:e,shippingGroupType:t,deliveryDestinationId:n})=>({type:"API",payload:{url:`/v1/charges/small-order-charge/thresholds?regionId=${e}&shippingGroupType=${encodeURI(t)}&deliveryDestinationId=${encodeURI(n)}`,service:"charges",pathPrefix:{client:"/api/charges",server:"/core-api"},...Z8}}),lI={getSmallOrderCharge:E7e,types:{GET_SMALL_ORDER_CHARGE:Z8}},f7e=(e=g7e,t)=>{switch(t.type){case lI.types.GET_SMALL_ORDER_CHARGE.PENDING:return{...e,isFetching:!0};case lI.types.GET_SMALL_ORDER_CHARGE.ERROR:return{...e,isFetching:!1,error:t.payload};case lI.types.GET_SMALL_ORDER_CHARGE.SUCCESS:return{isFetching:!1,error:null,smallOrderChargeThresholds:t.payload.responseData};default:return e}},y7e={charges:f7e,nextAvailableSlot:X9e,slotbooking:i7e,deliveryDetails:p7e,defaultShippingGroup:iVe,slotsConfiguration:h7e},I7e={slot:h2e},S7e="SET_SELECTED_ADDRESS_ID",C7e={types:{SET_SELECTED_ADDRESS_ID:S7e}},v7e=(e=null,t)=>{switch(t.type){case C7e.types.SET_SELECTED_ADDRESS_ID:return t.selectedAddressId;case Wa.types.SET_SELECTED_ADDRESS:return t.selectedAddress.addressId;default:return e}},J8=({control:e})=>e.delivery.selectedAddressId,eQ="RESET_ACTIVE_CUSTOMER_COLLECTION_DELIVERY_DESTINATION",tQ="TOGGLE_ACTIVE_CUSTOMER_COLLECTION_DELIVERY_DESTINATION",sQ="SET_GEOCODE",nQ="CLEAR_GEOCODE_ERROR",oQ="SET_GEOCODE_SEARCH_QUERY",rQ="UPDATE_NEARBY_COLLECTION_POINTS",aQ="NEARBY_COLLECTION_POINTS_FETCHING",iQ="NEARBY_COLLECTION_POINTS_FETCHING_ERROR",lQ="CLEAR_SEARCH_RESULT",cQ="SET_GEO_LOCATION_LOOKUP_STATUS",dQ="CLEAR_SINGLE_COLLECTION_POINT_FILTER",uQ="CLEAR_ALL_COLLECTION_POINT_FILTERS",pQ="APPLY_COLLECTION_POINT_FILTERS",T7e=()=>({type:eQ}),_7e=e=>({type:tQ,payload:e}),b7e=e=>({type:oQ,payload:{query:e}}),x7e=({geocode:e,error:t})=>({type:sQ,payload:{geocode:e,error:t}}),A7e=()=>({type:nQ}),R7e=()=>({type:lQ}),D7e=({addresses:e,location:t,nonDefaultLocationExists:n,limit:o})=>({type:rQ,payload:{addresses:e,location:t,nonDefaultLocationExists:n,limit:o}}),O7e=({complete:e})=>({type:cQ,payload:e}),P7e=()=>({type:aQ}),N7e=()=>({type:iQ}),L7e=e=>({type:dQ,payload:e}),k7e=()=>({type:uQ}),j7e=e=>({type:pQ,payload:e}),Ss={toggleActiveCustomerCollection:_7e,resetActiveCustomerCollection:T7e,setGeocode:x7e,clearGeocodeError:A7e,setGeocodeSearchQuery:b7e,updateNearbyCollectionPoints:D7e,setNearbyCollectionPointsFetching:P7e,setNearbyCollectionPointsFetchingError:N7e,clearSearchResult:R7e,setGeolocationLookupStatus:O7e,clearSingleCollectionPointFilter:L7e,clearAllCollectionPointFilters:k7e,applyCollectionPointFilters:j7e,types:{TOGGLE_ACTIVE_CUSTOMER_COLLECTION_DELIVERY_DESTINATION:tQ,RESET_ACTIVE_CUSTOMER_COLLECTION_DELIVERY_DESTINATION:eQ,SET_GEOCODE:sQ,CLEAR_GEOCODE_ERROR:nQ,SET_GEOCODE_SEARCH_QUERY:oQ,UPDATE_NEARBY_COLLECTION_POINTS:rQ,NEARBY_COLLECTION_POINTS_FETCHING:aQ,NEARBY_COLLECTION_POINTS_FETCHING_ERROR:iQ,CLEAR_SEARCH_RESULT:lQ,SET_GEO_LOCATION_LOOKUP_STATUS:cQ,CLEAR_SINGLE_COLLECTION_POINT_FILTER:dQ,CLEAR_ALL_COLLECTION_POINT_FILTERS:uQ,APPLY_COLLECTION_POINT_FILTERS:pQ}},dp={SERVICED:"SERVICED",LOCKER:"LOCKER",MOBILE:"MOBILE"},tp={isFetching:!1,fetchError:!1,didInvalidate:!1,lastUpdated:null},M7e={id:"cncId",labelId:"delivery.collection.type.collectionPoint.text",selected:!1,sortOrder:0,supportedType:dp.SERVICED},w7e={id:"lockerId",labelId:"delivery.collection.type.locker.text",selected:!1,sortOrder:1,supportedType:dp.LOCKER,requiredFeatureFlag:"cptfl"},F7e={id:"mobileId",labelId:"delivery.collection.type.mobile.text",selected:!1,sortOrder:2,supportedType:dp.MOBILE,requiredFeatureFlag:"cptfm"},kN={filters:[M7e,w7e,F7e],nearbyCollectionPointsStatus:{...tp},nearbyCollectionPointsOrderWithDistance:[],geocodeLookupComplete:!1,activeCustomerCollection:null},B7e=(e,t)=>e.filter(n=>!t.map(o=>o.id).includes(n.id)).concat(t),U7e=(e=kN,t)=>{switch(t.type){case Ss.types.CLEAR_SINGLE_COLLECTION_POINT_FILTER:return{...e,filters:e.filters.filter(n=>n.id!==t.payload.id).concat({...t.payload,selected:!1})};case Ss.types.CLEAR_ALL_COLLECTION_POINT_FILTERS:return{...e,filters:e.filters.map(n=>({...n,selected:!1}))};case Ss.types.APPLY_COLLECTION_POINT_FILTERS:{const n=B7e(e.filters,t.payload);return{...e,filters:n,activeCustomerCollection:G7e(e.activeCustomerCollection,n)}}default:return e}},G7e=(e,t)=>e&&t.filter(n=>n.selected).map(n=>n.supportedType).includes(e.collectionPointType)?e:null,$7e=e=>e.data.delivery.clickAndCollect.collectionPoints.filters.filter(t=>!t.requiredFeatureFlag||D(t.requiredFeatureFlag)(e)).sort((t,n)=>t.sortOrder-n.sortOrder),H7e={error:null,lastUpdated:null,query:null,result:null},V7e=(e=H7e,t)=>{switch(t.type){case Ss.types.SET_GEOCODE:return{...e,result:t.payload.geocode||null,error:t.payload.error||null};case Ss.types.SET_GEOCODE_SEARCH_QUERY:return{...e,query:t.payload.query,lastUpdated:de()};case Ss.types.CLEAR_GEOCODE_ERROR:return{...e,error:null};case Ss.types.CLEAR_SEARCH_RESULT:return{query:null,result:null,error:null,lastUpdated:de()};default:return e}},aA=(e,t)=>{const o=cy(t.latitude-e.latitude),r=cy(t.longitude-e.longitude),a=cy(e.latitude),i=cy(t.latitude),l=Math.sin(ly(o))*Math.sin(ly(o))+Math.sin(ly(r))*Math.sin(ly(r))*Math.cos(a)*Math.cos(i);return 2*6371*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))},ly=e=>e/2,cy=e=>e*Math.PI/180,W7e=(e,t=10)=>e.length===0?e:(e.sort((n,o)=>n.distance-o.distance),e.slice(0,t)),Y7e=(e,t)=>aA(e,t)*1e3,q7e=(e,t,n)=>W7e(e.map(o=>({deliveryDestinationId:o.deliveryDestinationId,distance:Y7e(o.coordinates,t)})),n),K7e=(e=kN,t)=>{switch(t.type){case Ss.types.NEARBY_COLLECTION_POINTS_FETCHING:return{...e,nearbyCollectionPointsStatus:{...e.nearbyCollectionPointsStatus,isFetching:!0}};case Ss.types.NEARBY_COLLECTION_POINTS_FETCHING_ERROR:return{...e,nearbyCollectionPointsStatus:{...e.nearbyCollectionPointsStatus,isFetching:!1}};case Ss.types.UPDATE_NEARBY_COLLECTION_POINTS:{const n=q7e(t.payload.addresses,t.payload.location,t.payload.limit);return{...e,nearbyCollectionPointsOrderWithDistance:n,nearbyCollectionPointsStatus:{...e.nearbyCollectionPointsStatus,isFetching:!1,lastUpdated:de()},nonDefaultLocationExists:t.payload.nonDefaultLocationExists}}case Ss.types.SET_GEO_LOCATION_LOOKUP_STATUS:return{...e,geocodeLookupComplete:t.payload};default:return e}},z7e=({data:e})=>e.delivery.clickAndCollect.collectionPoints.geocodeLookupComplete,mQ=({data:e})=>e.delivery.clickAndCollect.collectionPoints.nonDefaultLocationExists,Q7e=(e=kN,t)=>{switch(t.type){case Ss.types.RESET_ACTIVE_CUSTOMER_COLLECTION_DELIVERY_DESTINATION:return{...e,activeCustomerCollection:null};case Ss.types.TOGGLE_ACTIVE_CUSTOMER_COLLECTION_DELIVERY_DESTINATION:return{...e,activeCustomerCollection:t.payload===e.activeCustomerCollection?void 0:t.payload};default:return e}},X7e=Us({collectionPoints:oN(U7e,K7e,Q7e),search:V7e}),Z7e={homeDelivery:{...tp,data:{}},customerCollection:{...tp,data:{}},selectedDeliveryDestination:{...tp,data:void 0},supportedPropositions:{...tp,data:void 0}},J7e=e=>e?.reduce((t,n)=>(t[n.deliveryDestinationId]=n,t),{}),iA=e=>({...e,isFetching:!1,fetchError:!1,lastUpdated:de()}),dy=e=>({...e,isFetching:!0,fetchError:!1,didInvalidate:!1}),uy=(e,t)=>({...e,isFetching:!1,fetchError:!0,error:t,lastUpdated:null,data:{}}),cU=(e,t)=>({...iA(e),data:J7e(t.payload?.responseData)}),{types:{GET_HOME_DELIVERY_DESTINATIONS:ub,GET_CUSTOMER_COLLECTION_DELIVERY_DESTINATIONS:pb,GET_SELECTED_DELIVERY_DESTINATION_DETAILS:mb,INVALIDATE_HOME_DELIVERY_DESTINATIONS:eXe,INVALIDATE_CUSTOMER_COLLECTION_DELIVERY_DESTINATIONS:tXe,GET_SUPPORTED_PROPOSITIONS:hb}}=hn,sXe=(e=Z7e,t)=>{switch(t.type){case ub.PENDING:return{...e,homeDelivery:dy(e.homeDelivery)};case ub.SUCCESS:return{...e,homeDelivery:cU(e.homeDelivery,t)};case ub.ERROR:return{...e,homeDelivery:uy(e.homeDelivery,t.payload)};case eXe:return{...e,homeDelivery:{...e.homeDelivery,didInvalidate:!0}};case pb.PENDING:return{...e,customerCollection:dy(e.customerCollection)};case pb.SUCCESS:return{...e,customerCollection:cU(e.customerCollection,t)};case pb.ERROR:return{...e,customerCollection:uy(e.customerCollection,t.payload)};case tXe:return{...e,customerCollection:{...e.customerCollection,didInvalidate:!0}};case mb.PENDING:return{...e,selectedDeliveryDestination:dy(e.selectedDeliveryDestination)};case mb.SUCCESS:return{...e,selectedDeliveryDestination:{...iA(e.selectedDeliveryDestination),data:t.payload?.responseData}};case mb.ERROR:return{...e,selectedDeliveryDestination:uy(e.selectedDeliveryDestination,t.payload)};case hb.PENDING:return{...e,supportedPropositions:dy(e.supportedPropositions)};case hb.SUCCESS:return{...e,supportedPropositions:{...iA(e.supportedPropositions),data:t.payload?.responseData}};case hb.ERROR:return{...e,supportedPropositions:uy(e.supportedPropositions,t.payload)};default:return e}},hQ=se("GET_SUPPORTED_DELIVERY_METHODS"),nXe=()=>({type:"API",payload:{url:"/ecomdeliverydestinations/v1/supported-delivery-methods",options:{method:"GET"},service:"ecomdeliverydestinations",...hQ}}),_d={getSupportedDeliveryMethods:nXe,types:{GET_SUPPORTED_DELIVERY_METHODS:hQ}},oXe={...tp,data:[]},rXe=(e=oXe,t)=>{switch(t.type){case _d.types.GET_SUPPORTED_DELIVERY_METHODS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case _d.types.GET_SUPPORTED_DELIVERY_METHODS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case _d.types.GET_SUPPORTED_DELIVERY_METHODS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:t.payload.responseData};default:return e}},aXe=null,gQ="PREPARE_TEMPORARY_DELIVERY_DESTINATION",iXe=e=>({type:gQ,temporaryDeliveryDestination:e}),EQ=se("GET_DELIVERY_DESTINATION_DELIVERABILITY"),lXe=({latitude:e,longitude:t,postalCode:n})=>({type:"API",payload:{url:"/ecomdeliverydestinations/v2/deliverability",options:{method:"PUT",body:{latitude:e,longitude:t,postalCode:n}},service:"ecomdeliverydestinations",...EQ}}),fQ=se("CREATE_TEMPORARY_DELIVERY_DESTINATION"),cXe=({visitorId:e,latitude:t,longitude:n,postalCode:o,formattedAddress:r})=>({type:"API",payload:{url:"/ecomdeliverydestinations/v2/temporary-delivery-destinations",options:{method:"POST",body:{visitorId:e,latitude:t,longitude:n,postalCode:o,formattedAddress:r}},service:"ecomdeliverydestinations",...fQ}}),dXe=se("GET_TEMPORARY_DELIVERY_DESTINATION"),uXe=e=>({type:"API",payload:{url:`/ecomdeliverydestinations/v4/delivery-addresses/${e}`,options:{method:"GET"},service:"ecomdeliverydestinations",...dXe}}),Di={getDeliveryDestinationDeliverability:lXe,prepareTemporaryDeliveryDestination:iXe,createTemporaryDeliveryDestination:cXe,getTemporaryDeliveryDestination:uXe,types:{PREPARE_TEMPORARY_DELIVERY_DESTINATION:gQ,GET_DELIVERY_DESTINATION_DELIVERABILITY:EQ,CREATE_TEMPORARY_DELIVERY_DESTINATION:fQ}},pXe=(e=aXe,t)=>{switch(t.type){case Di.types.GET_DELIVERY_DESTINATION_DELIVERABILITY.DISPATCH:case Di.types.CREATE_TEMPORARY_DELIVERY_DESTINATION.SUCCESS:case J.actionTypes.CLOSE_MODAL:return null;case Di.types.PREPARE_TEMPORARY_DELIVERY_DESTINATION:return t.temporaryDeliveryDestination;default:return e}},mXe={supportedDeliveryMethods:rXe,clickAndCollect:X7e,destinations:sXe},hXe={conciergeDelivery:iWe,selectedAddressId:v7e,selectedDeliveryDestinationId:eme,temporaryDeliveryDestination:pXe},gXe=Us({...mXe,...y7e}),EXe=Us({...hXe,...I7e}),yQ=se("GET_FOP_CONFIG"),fXe="ssproductdisplayconfiguration",yXe="/v1/fop-configuration",IXe={service:fXe,url:yXe,pathPrefix:{client:"/api/visualconfiguration",server:"/core-api"},...yQ},SXe=()=>({type:"API",payload:IXe}),Lh={fetchFopConfigAction:SXe,types:{GET_FOP_CONFIG:yQ}},sp={xs:4,sm:8,md:16,lg:32,xl:64,xxl:128},jc=e=>{if(!e)return"";const t=e.top?sp[e.top]:0,n=e.bottom?sp[e.bottom]:0,o=e.left?sp[e.left]:0,r=e.right?sp[e.right]:0;return Pe`
        padding-block: ${$(t)} ${$(n)};
        padding-inline: ${$(o)} ${$(r)};
    `},IQ=e=>e?Pe`
        border: ${()=>`${e.px}px ${e.style} var(--intent-${e.color}-${e.tone})`};
    `:"",SQ=(e={width:0,height:0},t)=>Pe`
        max-inline-size: ${$(e.width)};
        max-block-size: ${$(e.height)};
        inline-size: ${t?$(e.width):"100%"};
        block-size: ${$(e.height)};
        display: unset;
        min-block-size: ${t?"unset":$(e.height)};
        min-inline-size: ${t?$(e.width):"unset"};
    `,CXe=(e={width:0,height:0},t={})=>{const n=CQ(t);return e.width+n},CQ=(e={})=>{const t=e.left?sp[e.left]:0,n=e.right?sp[e.right]:0;return t+n},vXe=(e={width:0,height:0},t={},n={})=>{const o=CQ(n),r=CXe(e,t);return o+r},vQ=(e=0,t)=>Pe`
    font-size: var(--salt-text-${t}-font-size);
    min-block-size: calc(
        ${e} * var(--salt-text-${t}-line-height) *
            var(--salt-text-${t}-font-size)
    );
    display: ${e&&t?"unset":"none"};
`,ES=(e=0,t,n=0)=>Pe`
    font-size: var(--salt-text-${t}-font-size);
    min-block-size: calc(
        (
                ${e} * var(--salt-text-${t}-line-height) *
                    var(--salt-text-${t}-font-size)
            ) +
            (var(--salt-spacing-1) * ${Math.max(n-1,0)})
    );
`,fS=(e,t)=>typeof e>"u"||typeof t>"u"?0:e*t,Ql=e=>e==="sm"?"s":e==="md"?"m":e==="lg"?"l":e,TXe=e=>{const t={...e};return["title","promotion","packSize","unitPrice","price","grossPrice","referencePrice"].forEach(o=>{t.portrait[o]?.fontSize&&(t.portrait[o].fontSize=Ql(t.portrait[o].fontSize)),t.landscape[o]?.fontSize&&(t.landscape[o].fontSize=Ql(t.landscape[o].fontSize))}),t.portrait.price?.strikethrough&&(t.portrait.price.strikethrough=Ql(t.portrait.price.strikethrough)),t.landscape.price?.strikethrough&&(t.landscape.price.strikethrough=Ql(t.landscape.price.strikethrough)),t.portrait?.catchWeightLabel&&(t.portrait.catchWeightLabel=Ql(t.portrait.catchWeightLabel)),t.landscape?.catchWeightLabel&&(t.landscape.catchWeightLabel=Ql(t.landscape.catchWeightLabel)),t.portrait?.countryOfOrigin&&(t.portrait.countryOfOrigin=Ql(t.portrait.countryOfOrigin)),t.landscape?.countryOfOrigin&&(t.landscape.countryOfOrigin=Ql(t.landscape.countryOfOrigin)),t},Es=e=>e==="xl"?"l":e,_Xe={...je,data:null},bXe=(e=_Xe,t)=>{switch(t.type){case Lh.types.GET_FOP_CONFIG.PENDING:return{...e,isFetching:!0,fetchError:!1};case Lh.types.GET_FOP_CONFIG.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Lh.types.GET_FOP_CONFIG.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:TXe(t.payload.responseData),lastUpdated:de()};default:return e}},xXe=({data:e})=>e.visualConfig.fop.data,AXe="ssproductdisplayconfiguration",RXe="/v1/fop-list-configuration",TQ=se("GET_PRODUCT_LIST_CONFIG"),DXe={service:AXe,url:RXe,pathPrefix:{client:"/api/visualconfiguration",server:"/core-api"},...TQ},OXe=()=>({type:"API",payload:DXe}),kh={fetchProductListConfigAction:OXe,types:{GET_PRODUCT_LIST_CONFIG:TQ}},PXe={...je,data:null},NXe=(e=PXe,t)=>{switch(t.type){case kh.types.GET_PRODUCT_LIST_CONFIG.PENDING:return{...e,isFetching:!0,fetchError:!1};case kh.types.GET_PRODUCT_LIST_CONFIG.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case kh.types.GET_PRODUCT_LIST_CONFIG.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData,lastUpdated:de()};default:return e}},LXe=({data:e})=>e.visualConfig.productList.data,_Q=se("GET_ELIGIBILITY"),bQ=se("GET_DELIVERY_FREQUENCY"),xQ=se("GET_RO_SIGN_UP_SLOTS"),kXe=se("CHECKOUT"),AQ=se("RESERVE_RO_SU_SLOT"),RQ=se("RELEASE_RO_SU_SLOT"),bm=e=>({type:"API",payload:{service:Sl,pathPrefix:{client:"/api/recurringshopping",server:""},...e}}),jXe=()=>bm({url:"/v1/web/eligibility",..._Q}),MXe=()=>bm({url:"/v1/web/frequencies",...bQ}),wXe=e=>bm({url:`/v1/web/slots-offering?deliveryDestinationId=${e}`,...xQ}),FXe=e=>bm({url:"/v1/web/signup",options:{method:"POST",body:e},...kXe}),BXe=(e,t)=>bm({url:`/v1/web/slots/${t}/reservation`,options:{method:"PUT",body:{deliveryDestinationId:e}},...AQ}),UXe=e=>bm({url:`/v1/web/slots/${e}`,options:{method:"DELETE"},...RQ}),xo={getEligibility:jXe,getDeliveryFrequency:MXe,getSlots:wXe,checkout:FXe,reserveSlot:BXe,releaseSlot:UXe,actionTypes:{GET_ELIGIBILITY:_Q,GET_DELIVERY_FREQUENCY:bQ,GET_RO_SIGN_UP_SLOTS:xQ,RESERVE_RO_SU_SLOT:AQ,RELEASE_RO_SU_SLOT:RQ}},GXe={...je,data:{}},$Xe=(e=GXe,t)=>{switch(t.type){case xo.actionTypes.GET_ELIGIBILITY.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case xo.actionTypes.GET_ELIGIBILITY.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case xo.actionTypes.GET_ELIGIBILITY.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),fetchSuccess:!0,data:t.payload.responseData};default:return e}},HXe={...je,data:{}},VXe=(e=HXe,t)=>{switch(t.type){case xo.actionTypes.GET_DELIVERY_FREQUENCY.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case xo.actionTypes.GET_DELIVERY_FREQUENCY.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case xo.actionTypes.GET_DELIVERY_FREQUENCY.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),fetchSuccess:!0,data:t.payload.responseData};default:return e}},WXe={...je,data:{}},YXe=(e=WXe,t)=>{switch(t.type){case xo.actionTypes.GET_RO_SIGN_UP_SLOTS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case xo.actionTypes.GET_RO_SIGN_UP_SLOTS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case xo.actionTypes.GET_RO_SIGN_UP_SLOTS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),fetchSuccess:!0,data:t.payload.responseData};default:return e}},DQ="SET_RO_SIGN_UP_FORM_STATE",qXe=e=>({type:DQ,payload:e}),xm={setState:qXe,types:{SET_RO_SIGN_UP_FORM_STATE:DQ}},it={LEARN_MORE:"LEARN_MORE",ADDRESS:"ADDRESS",ADDRESS_CLOSE:"ADDRESS_CLOSE",FREQUENCY:"FREQUENCY",FREQUENCY_CLOSE:"FREQUENCY_CLOSE",SLOT_BOOKING:"SLOT_BOOKING",SLOT_BOOKING_CLOSE:"SLOT_BOOKING_CLOSE",SUMMARY:"SUMMARY",SUMMARY_CLOSE:"SUMMARY_CLOSE",PAYMENT:"PAYMENT",PAYMENT_CLOSE:"PAYMENT_CLOSE",ORDER_CONFIRMATION:"ORDER_CONFIRMATION"},OQ=5,Mc="modal-header",PQ={deliveryDestinationId:"",frequency:{value:"-1",unit:""},dayOfWeek:"",slotId:"",name:"",from:"",to:""},KXe={definition:{name:"",frequency:{name:void 0,unit:"",value:"-1"},deliveryWindow:{day:"",from:"",to:","}},order:{orderId:"",deliveryAddress:{nickname:"",addressId:""},deliveryWindow:{startDateTime:"",endDateTime:"",timezone:""},price:{final:{amount:"",currency:""}}}},zXe={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7},lA=[it.ADDRESS,it.FREQUENCY,it.SLOT_BOOKING,it.SUMMARY,it.PAYMENT,it.ORDER_CONFIRMATION],QXe={dialogType:void 0,data:PQ,orderComplete:KXe,paymentAuthUrl:void 0},XXe=(e=QXe,t)=>{switch(t.type){case xm.types.SET_RO_SIGN_UP_FORM_STATE:return{...e,...t.payload};default:return e}},ZXe=Us({eligibility:$Xe,frequency:VXe,slots:YXe,form:XXe}),NQ=se("GET_COMPOSABLE_NAVBAR"),JXe=()=>({type:"API",payload:{url:"/v1/composable-content/navbar",...NQ}}),jh={getComposableNavbar:JXe,actionTypes:{GET_COMPOSABLE_NAVBAR:NQ}},eZe=e=>"link"in e?{type:e.link.linkType,metadata:{label:e.label,path:e.link.targets[0].value}}:{type:e.type},tZe=e=>{const t=e.includes?.Entry.reduce((o,r)=>({...o,[r.sys.id]:eZe(r.fields)}),{}),n=e.items[0].fields.items;return!t||!n?[]:n.filter(o=>t[o.sys.id]).map(o=>t[o.sys.id])},sZe={...je},nZe=(e=sZe,t)=>{switch(t.type){case jh.actionTypes.GET_COMPOSABLE_NAVBAR.PENDING:return{...e,isFetching:!0,fetchError:!1};case jh.actionTypes.GET_COMPOSABLE_NAVBAR.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.error};case jh.actionTypes.GET_COMPOSABLE_NAVBAR.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),items:tZe(t.payload.responseData)};default:return e}},LQ=se("GET_COUPONS_COUNT"),oZe=()=>({type:"API",payload:{url:"/v4/promotion/coupons/count",service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...LQ}}),cI={getCouponsCount:oZe,actionTypes:{GET_COUPONS_COUNT:LQ}},kQ=se("GET_COUPONS_PAGE"),rZe=e=>({type:"API",payload:{url:"/v4/promotion/coupons",service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...kQ},isDynamicImagesEnabled:e}),up={getCouponsPage:rZe,actionTypes:{GET_COUPONS:kQ}},aZe={...je,value:0},iZe=(e=aZe,t)=>{switch(t.type){case cI.actionTypes.GET_COUPONS_COUNT.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case cI.actionTypes.GET_COUPONS_COUNT.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case cI.actionTypes.GET_COUPONS_COUNT.SUCCESS:return{...e,isFetching:!1,fetchError:!1,value:t.payload.responseData.count};case up.actionTypes.GET_COUPONS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,value:t.payload.responseData.length};default:return e}},jN=({data:e})=>e.coupons.count.value,dI=se("GET_COUPON_DETAILS"),uI=se("GET_COUPON_PROMOTION_IDS"),lZe=(e,t,n,o,r)=>{const a=r?`?sortOptionId=${r}`:"";return{type:"API",payload:{url:t?`/v4/promotion/retailer-id/${e}${a}`:`/v4/promotion/${e}${a}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},...dI},isDynamicImagesEnabled:n,imageFormats:o}},cZe=e=>({type:"API",payload:{url:`/v1/seo/offer?id=${e}`,...uI}}),dZe={...je,data:{promotionPageType:"UNKNOWN",sortOptions:[],promoId:"",retailerPromotionId:"",description:"",promotionGroups:[{products:[],quantity:0}]}},uZe=(e=dZe,t)=>{switch(t.type){case dI.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case dI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case dI.SUCCESS:{const{payload:n,isDynamicImagesEnabled:o,imageFormats:r}=t,a=n.responseData;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:IN(a,o,r).result}}case uI.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case uI.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case uI.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e.data,promoId:t.payload.responseData.id,retailerPromotionId:t.payload.responseData.retailerId,description:t.payload.responseData.encodedName}};default:return e}},jQ=({data:e})=>e.coupons.couponDetailsPage.data,pZe=({data:e})=>e.coupons.couponDetailsPage.isFetching,gb={width:50,height:50},mZe=(e,t)=>e.map(n=>({...n,products:n.products.map(o=>{const{image:r}=o;if(!r)return o;const{availableFormats:a,availableResolutions:i,imageId:l,path:c}=r,d=a2(a,t),u=i.sort((g,E)=>g.width<E.width?-1:1),p=u.some(g=>g.width===gb.width&&g.height===gb.height)?gb:u[0];return{...o,image:{imageId:l,path:`${c}/${p?.width}x${p?.height}.${d}`}}})})),hZe={...je,data:[]},gZe=(e=hZe,t)=>{switch(t.type){case up.actionTypes.GET_COUPONS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case up.actionTypes.GET_COUPONS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case up.actionTypes.GET_COUPONS.SUCCESS:{const{isDynamicImagesEnabled:n,payload:o}=t,r=o.responseData;return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:mZe(r,n)}}default:return e}},EZe=({data:e})=>e.coupons.couponsPage.data,fZe=({data:e})=>e.coupons.couponsPage.isFetching,yZe=({data:e})=>e.coupons.couponsPage.error,IZe=Us({count:iZe,couponsPage:gZe,couponDetailsPage:uZe}),MN=se("GET_COMPONENTIZED_HOMEPAGE"),SZe=D("seo.ra"),CZe=D("apo.pf.exp"),{GET_HOMEPAGE_CATALOGUE:vZe,FILTER_CATALOGUE:TZe}=yt.types,_Ze=({tag:e,limit:t,decoratedOnly:n,category:o,filters:r,sortOption:a,offset:i,pageToken:l,transformerConfig:c})=>(d,u)=>{const p=u(),g=AR(p),E=Ze(p,"display-home-sublocation");return d({type:"API",transformerConfig:c,payload:{url:`/v5/product-pages?${oE({category:o,...E&&e.includes("lihp")&&E.trim()!==""&&{category:E},filters:r,sortOption:a,pageToken:l,isRetailerCategoryId:SZe(p),offset:i,limit:t,decoratedOnly:n,tag:e})}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},options:{...g?{ContentExperienceUserId:g}:{},maxRetries:1},...vZe},...e.includes("lihp")&&{isProductFiltersEnabled:CZe(p)}})},MQ=e=>({type:"API",payload:{service:"contentfulhelper",pathPrefix:{client:"/api/contentfulhelper",server:"/core-api"},...e}}),bZe=()=>MQ({url:"/v2/contentful/loggedinhomepage/platform/web",...MN}),xZe=()=>MQ({url:"/v2/contentful/loggedouthomepage/platform/web",...MN}),AZe=e=>({type:TZe,payload:e}),hl={getPPWSHomepagePage:_Ze,fetchLoggedInComponentizedHomepage:bZe,fetchLoggedOutComponentizedHomepage:xZe,filterCatalogue:AZe,actionTypes:{GET_COMPONENTIZED_HOMEPAGE:MN}},RZe={...je},DZe=(e=RZe,t)=>{switch(t.type){case hl.actionTypes.GET_COMPONENTIZED_HOMEPAGE.PENDING:return{...e,isFetching:!0,fetchError:!1};case hl.actionTypes.GET_COMPONENTIZED_HOMEPAGE.ERROR:return{...e,isFetching:!1,fetchError:!0};case hl.actionTypes.GET_COMPONENTIZED_HOMEPAGE.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData.items.map(n=>({...n,items:n.items})),lastUpdated:de()};default:return e}},wQ=e=>e.data.homepage,FQ=se("GET_HOMEPAGE_PROMOTION"),OZe=()=>({type:"API",payload:{service:"web_product_page_ws",url:"/v6/products/promotions?filters=boolean%3DfavoritesOnly&sort=favorite",...FQ}}),pI={getHomepageFavOnOffer:OZe,actionTypes:{GET_HOMEPAGE_PROMOTION:FQ}},PZe={...je},NZe=(e=PZe,t)=>{switch(t.type){case pI.actionTypes.GET_HOMEPAGE_PROMOTION.PENDING:return{...e,isFetching:!0,fetchError:!1};case pI.actionTypes.GET_HOMEPAGE_PROMOTION.ERROR:return{...e,isFetching:!1,fetchError:!0};case pI.actionTypes.GET_HOMEPAGE_PROMOTION.SUCCESS:return{...e,isFetching:!1,fetchError:!1,promotion:t.payload.responseData};default:return e}},LZe=e=>e.data.experimentation?.promotion?.result?.productGroups,kZe=e=>e.data.experimentation?.isFetching??!1,tT={isFetching:!1,fetchError:!1,lastUpdated:null,data:void 0},Tg=(e,t,n)=>{switch(t.type){case qr.types[n].PENDING:return{...e,isFetching:!0,fetchError:!1};case qr.types[n].ERROR:return{...e,isFetching:!1,fetchError:!0,data:void 0};case qr.types[n].SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e?.data,...t?.payload?.responseData}};default:return e}},jZe=(e=tT,t)=>t.type==="GET_OVERRIDE_PAYMENT_METHOD_GROUPS_SUCCESS"?{...Tg(e,t,"GET_OVERRIDE_PAYMENT_METHOD_GROUPS"),data:{...e.data,overridePaymentMethodGroups:t?.payload?.responseData}}:Tg(e,t,"GET_OVERRIDE_PAYMENT_METHOD_GROUPS"),MZe=(e=tT,t)=>Tg(e,t,"GET_PAYMENT_CHECKOUT_SUMMARY"),wZe=(e=tT,t)=>Tg(e,t,"GET_ORDER_MULTI_PAYMENTS"),FZe=(e=tT,t)=>Tg(e,t,"GET_PAYMENT_CHECKOUT_SUMMARY_WITH_PAYMENT_METHOD_GROUPS"),BQ=se("GET_CHECKOUT_VALIDATION"),UQ="GET_CHECKOUT_VALIDATION_DIRECT_SUCCESS",BZe=()=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},options:{method:"PUT"},url:"/v1/carts/active/checkout-restrictions",...BQ}}),UZe=(e,t)=>({type:UQ,payload:{products:e,cartSplitRequired:t}}),ud={getCheckoutValidation:BZe,setLimitedProducts:UZe,types:{GET_CHECKOUT_VALIDATION:BQ,GET_CHECKOUT_VALIDATION_DIRECT_SUCCESS:UQ}},GZe="EXCEEDED_MAX_QUANTITY",$Ze="LIMITED_AVAILABILITY",HZe="OUT_OF_STOCK",VZe="TIME_RESTRICTION",wN=328,GQ=184,WZe={isFetching:!1,fetchError:!1,lastUpdated:null,data:void 0},YZe=(e=WZe,t)=>{switch(t.type){case ud.types.GET_CHECKOUT_VALIDATION.PENDING:return{...e,isFetching:!0,fetchError:!1};case ud.types.GET_CHECKOUT_VALIDATION.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de()};case ud.types.GET_CHECKOUT_VALIDATION.ERROR:return{...e,isFetching:!1,fetchError:!0};case ud.types.GET_CHECKOUT_VALIDATION_DIRECT_SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{...e.data,cartSplitRequired:t?.payload.cartSplitRequired,limitedProducts:t?.payload.products}};default:return e}},qZe=e=>e.data.checkoutValidation,$Q=Y(qZe,({data:e})=>e),KZe=Y($Q,e=>e?.limitedProducts||[]),zZe=(e=!1,t)=>t.type==="UPDATE_AGE_CONFIRMATION_COOKIE"?t.value:e,HQ=({session:e})=>e.ageConfirmed,VQ=se("GET_DEFAULT_BILLING_ADDRESS"),WQ=se("POST_BILLING_ADDRESS"),YQ="SET_BILLING_ADDRESS",qQ=se("GET_BILLING_ADDRESS_VALIDATION"),QZe=()=>({type:"API",payload:{url:"/address/v1/billing-addresses/default",service:"webaddressws",...VQ}}),XZe=e=>({type:"API",payload:{url:"/address/v1/billing-addresses",options:{method:"POST",body:e},service:"webaddressws",...WQ}}),ZZe=e=>({type:YQ,payload:e}),JZe=()=>({type:"API",payload:{url:"/v1/address/billing-address-validation",...qQ}}),Jo={type:{GET_DEFAULT_BILLING_ADDRESS:VQ,POST_BILLING_ADDRESS:WQ,SET_BILLING_ADDRESS:YQ,GET_BILLING_ADDRESS_VALIDATION:qQ},getDefaultBillingAddress:QZe,postBillingAddress:XZe,setBillingAddress:ZZe,getBillingAddressValidationRules:JZe},eJe=(e={...je,data:{}},t)=>{switch(t.type){case Jo.type.GET_DEFAULT_BILLING_ADDRESS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Jo.type.GET_DEFAULT_BILLING_ADDRESS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Jo.type.GET_DEFAULT_BILLING_ADDRESS.SUCCESS:{const{addressDetails:n,customerDetails:o}=t.payload.responseData;return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:{billingAddressId:t.payload.responseData?.billingAddressId,...n,...o}}}case Jo.type.POST_BILLING_ADDRESS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Jo.type.POST_BILLING_ADDRESS.SUCCESS:{const{addressDetails:n,customerDetails:o}=t.payload.responseData;return{...e,data:{billingAddressId:t.payload.responseData?.billingAddressId,...n,...o},isFetching:!1,fetchError:!1,lastUpdated:de(),error:null}}case Jo.type.SET_BILLING_ADDRESS:return{...e,data:{...t.payload}};default:return e}},tJe=(e={...je,data:{}},t)=>{switch(t.type){case Jo.type.GET_BILLING_ADDRESS_VALIDATION.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case Jo.type.GET_BILLING_ADDRESS_VALIDATION.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case Jo.type.GET_BILLING_ADDRESS_VALIDATION.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},KQ=se("GET_TERMS_AND_CONDITIONS"),sJe=()=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},url:"/v1/carts/active/checkout-summary-terms",...KQ}}),mI={type:{GET_TERMS_AND_CONDITIONS:KQ},getTermsAndConditions:sJe},nJe=(e={...je,data:{termsAndConditions:[]}},t)=>{switch(t.type){case mI.type.GET_TERMS_AND_CONDITIONS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case mI.type.GET_TERMS_AND_CONDITIONS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case mI.type.GET_TERMS_AND_CONDITIONS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:t.payload.responseData};default:return e}},oJe=e=>e.data.checkoutTermsAndConditions.data.termsAndConditions,rJe=e=>e.data.checkoutTermsAndConditions.fetchError,aJe=e=>e.data.checkoutTermsAndConditions.isFetching,zQ=se("FETCH_AVAILABLE_PAYMENT_CHECKS"),dU="paymentchecks",iJe=({basketTotal:e,orderId:t})=>({type:"API",payload:{service:dU,pathPrefix:{client:`/api/${dU}`,server:"/core-api"},url:"/v1/payment-checks/available",...zQ,options:{method:"POST",body:{basketTotal:e,orderId:t}}}}),hI={fetchAvailablePaymentChecks:iJe,actionTypes:{FETCH_AVAILABLE_PAYMENT_CHECKS:zQ}},lJe={...je,availablePaymentChecks:[],checksMissingRequiredTotal:[]},cJe=(e=lJe,t)=>{switch(t.type){case hI.actionTypes.FETCH_AVAILABLE_PAYMENT_CHECKS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case hI.actionTypes.FETCH_AVAILABLE_PAYMENT_CHECKS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case hI.actionTypes.FETCH_AVAILABLE_PAYMENT_CHECKS.SUCCESS:return{...e,...t.payload.responseData,isFetching:!1,fetchError:!1,error:null,lastUpdated:de()};default:return e}},dJe=({data:e})=>({...e.payments.paymentChecks}),QQ="PSPS_FETCHED",uJe=(e=void 0,t)=>({type:QQ,payload:{fetchedPsps:t,...e?{fetchedPaymentFlow:e}:{}}}),XQ={pspsFetched:uJe,actionTypes:{PSPS_FETCHED:QQ}},np={CARD:"CARD",PAYPAL:"PAYPAL"},yS={SAVED:"SAVED",NON_SAVED:"NON_SAVED"},pJe="all",mJe={psps:{all:[],[yS.SAVED]:[],[yS.NON_SAVED]:[]}},hJe=(e=mJe,t)=>{switch(t.type){case XQ.actionTypes.PSPS_FETCHED:{const{fetchedPaymentFlow:n,fetchedPsps:o}=t.payload,r=n||pJe;return{psps:{...e.psps,[r]:o}}}default:return e}},gJe=({data:e})=>e.payments.pspConfig.psps.all,EJe=e=>({data:t})=>t.payments.pspConfig.psps[e].map(o=>bh.fromActiveName(o.type));Y(gJe,e=>e.find(n=>n.type===XVe.DATACASH)?.amexSupported||!1);const uU="pspweb",ZQ=se("GET_CHECKOUT_BASE_RECOVER_URL"),fJe=()=>({type:"API",payload:{service:uU,url:`/${uU}/v2/checkout/recover-urls`,...ZQ}}),gI={getCheckoutBaseRecoverUrl:fJe,types:{GET_CHECKOUT_BASE_RECOVER_URL:ZQ}},yJe=(e=f5.threeDsRecoveryUrls,t)=>{switch(t.type){case gI.types.GET_CHECKOUT_BASE_RECOVER_URL.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case gI.types.GET_CHECKOUT_BASE_RECOVER_URL.ERROR:return{...e,isFetching:!1,fetchError:!0};case gI.types.GET_CHECKOUT_BASE_RECOVER_URL.SUCCESS:return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{pspweb:{url:t.payload.responseData.checkoutRecoverUrl}}};default:return e}},IJe=({data:e})=>e&&e.payments&&e.payments.threeDsRecoveryUrls&&e.payments.threeDsRecoveryUrls.isFetching,JQ=({data:e})=>e&&e.payments&&e.payments.threeDsRecoveryUrls&&e.payments.threeDsRecoveryUrls.data,SJe=({data:e})=>e&&e.payments&&e.payments.threeDsRecoveryUrls&&e.payments.threeDsRecoveryUrls.lastUpdated,e9=se("GET_FINANCING_PLANS"),pU="walletservice",CJe=({path:e,body:t})=>({type:"API",payload:{service:pU,url:`/${pU}/v2/financing-plans/calculate/${e}`,options:{method:"POST",body:t},...e9}}),EI={fetchFinancingPlans:CJe,types:{GET_FINANCING_PLANS:e9}},vJe=je,TJe=(e=vJe,t)=>{switch(t.type){case EI.types.GET_FINANCING_PLANS.PENDING:return{...e,isFetching:!0,fetchError:!1,error:null};case EI.types.GET_FINANCING_PLANS.ERROR:return{...e,isFetching:!1,fetchError:!0,error:t.payload};case EI.types.GET_FINANCING_PLANS.SUCCESS:return{...e,isFetching:!1,fetchError:!1,data:t.payload.responseData,lastUpdated:de()};default:return e}},_Je=({data:e})=>e.payments.instalments.data,bJe=({data:e})=>e.payments.instalments.isFetching,t9=se("GET_ACTIVE_PAYMENT_METHOD_GROUPS"),xJe=()=>{const e="walletservice";return{type:"API",payload:{service:e,url:`/${e}/v1/payment-method-groups`,...t9}}},fI={fetchActivePaymentMethodGroups:xJe,types:{GET_ACTIVE_PAYMENT_METHOD_GROUPS:t9}},AJe={activePaymentMethodGroups:{isFetching:!1,fetchError:!1,lastUpdated:null,data:[]}},RJe=({data:e})=>e.payments.paymentMethodGroups.activePaymentMethodGroups.data,DJe=(e=AJe,t)=>{switch(t.type){case fI.types.GET_ACTIVE_PAYMENT_METHOD_GROUPS.PENDING:return{...e,activePaymentMethodGroups:{...e.activePaymentMethodGroups,isFetching:!0,fetchError:!1}};case fI.types.GET_ACTIVE_PAYMENT_METHOD_GROUPS.ERROR:return{...e,activePaymentMethodGroups:{...e.activePaymentMethodGroups,isFetching:!1,fetchError:!0}};case fI.types.GET_ACTIVE_PAYMENT_METHOD_GROUPS.SUCCESS:return{...e,activePaymentMethodGroups:{isFetching:!1,fetchError:!1,data:t.payload.responseData,lastUpdated:de()}};default:return e}},s9=se("GET_PAYMENT_METHOD_GROUPS_METADATA"),n9=se("GET_PAYMENT_METHOD_PROMOTIONS"),OJe=({groups:e,amount:t})=>({type:"API",payload:{pathPrefix:{client:"/api/walletservice",server:"/core-api"},options:{method:"POST",body:{groups:e,amount:t}},service:"walletservice",url:"/v2/payment-method-groups/metadata",...s9}}),PJe=()=>({type:"API",payload:{service:"web_basket_ws",pathPrefix:{client:"/api/cart",server:"/core-api"},options:{method:"GET"},url:"/v1/carts/active/checkout-summary/payment-groups-promotions",...n9}}),yI={fetchPaymentMethodGroupsMetadata:OJe,types:{GET_PAYMENT_METHOD_GROUPS_METADATA:s9}},II={fetchPaymentMethodGroupPromotions:PJe,types:{GET_PAYMENT_METHOD_PROMOTIONS:n9}},NJe={isFetching:!1,fetchError:!1,lastUpdated:null,promotionsFetching:!1,promotionsFetchError:!1},HE=({data:e})=>e.payments.paymentMethodGroupsMetadata.data,LJe=({data:e})=>e.payments.paymentMethodGroupsMetadata.isFetching,FN=Y(HE,e=>e?.find(t=>t.name===dt.INSTALMENTS)),mU=(e,t)=>{if(!e?.length||!t?.length)return e||void 0;const n=new Map(e.map(o=>[o.paymentMethodGroupId,{...o}]));return t.forEach(o=>{const r=n.get(o.paymentMethodGroupId);r&&(r.promotion=!0,o.financingProviderId&&r.financingProviders?.length&&(r.financingProviders=r.financingProviders.map(a=>a.financingProviderId===o.financingProviderId?{...a,promotion:!0}:a)))}),Array.from(n.values())},kJe=(e=NJe,t)=>{switch(t.type){case yI.types.GET_PAYMENT_METHOD_GROUPS_METADATA.PENDING:return{...e,isFetching:!0,fetchError:!1};case yI.types.GET_PAYMENT_METHOD_GROUPS_METADATA.ERROR:return{...e,isFetching:!1,fetchError:!0};case yI.types.GET_PAYMENT_METHOD_GROUPS_METADATA.SUCCESS:{const n=t.payload.responseData,o=mU(n,e.promotions);return{...e,isFetching:!1,fetchError:!1,data:o,lastUpdated:de()}}case II.types.GET_PAYMENT_METHOD_PROMOTIONS.PENDING:return{...e,promotionsFetching:!0,promotionsFetchError:!1};case II.types.GET_PAYMENT_METHOD_PROMOTIONS.ERROR:return{...e,promotionsFetching:!1,promotionsFetchError:!0};case II.types.GET_PAYMENT_METHOD_PROMOTIONS.SUCCESS:{const n=t.payload.responseData,o=mU(e.data,n);return{...e,promotionsFetching:!1,promotionsFetchError:!1,promotions:n,data:o}}default:return e}},jJe=Us({paymentChecks:cJe,pspConfig:hJe,threeDsRecoveryUrls:yJe,instalments:TJe,paymentMethodGroups:DJe,paymentMethodGroupsMetadata:kJe}),MJe={...je,data:null,error:null},wJe=(e=MJe,t)=>{switch(t.type){case Lx.types.GET_ACTIVE_SESSION.ERROR:return{...e,isFetching:!1,fetchError:!0,lastUpdated:de(),error:t.payload};case Lx.types.GET_ACTIVE_SESSION.SUCCESS:return{...e,isFetching:!1,fetchError:!1,error:null,lastUpdated:de(),data:{type:t.payload.responseData?.type}};default:return e}},SI=se("GET_POP_UP_BANNER"),FJe=()=>({type:"API",payload:{url:"/v1/pop-up?platform=WEB",service:"adverts",pathPrefix:{client:"/api/adverts",server:"/core-api"},...SI}}),BJe={...je,data:null,vrTestingMeta:{disableAnimation:!1,disableDelay:!1}},UJe=(e=BJe,t)=>{switch(t.type){case SI.PENDING:return{...e,isFetching:!0,data:null};case SI.SUCCESS:return{...e,isFetching:!1,lastUpdated:de(),data:t.payload?.responseData||null};case SI.ERROR:return{...e,isFetching:!1,fetchError:!0,data:null};default:return e}},GJe={...je,data:{optedIn:!1}},$Je=(e=GJe,t)=>{switch(t.type){case"GET_VOUCHERS_MARKETING_PREFERENCES_PENDING":return{...e,isFetching:!0,fetchError:!1};case"GET_VOUCHERS_MARKETING_PREFERENCES_SUCCESS":return{...e,isFetching:!1,fetchError:!1,lastUpdated:de(),data:{optedIn:t.payload.responseData.optedIn}};case"GET_VOUCHERS_MARKETING_PREFERENCES_ERROR":return{...e,isFetching:!1,fetchError:!0};default:return e}},HJe=({data:e})=>e.customer.vouchersMarketingPreferences.data.optedIn,VJe=({data:e})=>e.customer.vouchersMarketingPreferences.isFetching,WJe=(e,t)=>Us({data:Us({applicableLoyalty:V3e,adverts:MKe,basket:fze,basketMerge:vze,basketSpeculation:Nze,checkout:HKe,checkoutTermsAndConditions:nJe,checkoutValidation:YZe,draftBasket:c5e,instantShop:u3e,categories:gMe,checkoutWalk:Hze,content:W9e,customer:Us({details:EEe,accessibilitySettings:t1e,addresses:bIe,addressDetails:y5e,addressValidation:h5e,billingAddress:eJe,billingAddressValidation:tJe,loyalty:U3e,marketingPreferences:b5e,deliveryPreferences:O5e,preferences:Rxe,wallet:oN(G5e,$5e),regulars:Z6e,segments:__e,vouchersMarketingPreferences:$Je}),delivery:gXe,deliveryPass:Bze,favorite:i4e,locale:pPe,orders:Us({all:y4e,pending:Qpe,past:h4e,current:Us({order:C3e,refunds:k3e}),orderEntities:oIe,failedPayments:Zze,recurring:Us({definitions:P4e,editDefinition:U4e,placeholders:b4e,notifications:H4e})}),popupBanner:UJe,recurringOrdersSignUp:ZXe,payments:jJe,visualConfig:Us({fop:bXe,productList:NXe}),products:Us({alternatives:Y5e,catalogue:Khe,basket:kze,offers:o6e,productEntities:Nye,missedPromotions:Fze}),bop:Us({details:QRe,reviews:C9e}),shopperOptimisations:Us({recommendations:h6e.recommendedProductsReducer}),retailer:Us({addressFields:C5e,retailerConfig:Lme}),loyaltySettings:B3e,search:i3e,shopInShop:i6e,recipes:e9e,mealPlanning:E9e,listerPage:q9e,toggleablePromotions:K9e,coupons:IZe,composableNavbar:nZe,homepage:DZe,experimentation:NZe,orderPayment:Us({paymentMethodGroups:jZe,orderPaymentCheckoutSummary:MZe,orderMultiPayments:wZe,orderPaymentCheckoutSummaryWithPaymentMethodGroups:FZe})}),session:Us({csrf:Zqe,features:Ade,metadata:Mde,additionalDetails:CEe,isSuperuser:(n=!1)=>n,isLoggedIn:(n=!1)=>n,ageConfirmed:zZe,linkTypeDetector:HUe,customerSession:wJe}),control:Us({modal:d4e,notifications:J2e,addWalletItemModal:dKe,addPspwebWalletItemModal:mKe,payments:eze,addAddressOrigin:u5e,delivery:EXe}),router:Ode({initialLocation:e,basePath:t}),retailerSettings:(n={})=>n,cookieConsent:FVe}),YJe=window.__INITIAL_STATE__,qJe=window.location,KJe=(e=[],t=YJe,n=qJe)=>{const o=WJe(n,t?.session?.metadata?.basePath);return mce(o,t,Tt(hce(...e,UYe,og,zde,iqe,kqe,BYe,VYe,sKe,aKe,Eqe,Sqe,fqe,$qe,zqe,Qqe,mxe,dwe),window.__WEB_THEMING_EXTENSION__?window.__WEB_THEMING_EXTENSION__():r=>r,window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__():r=>r))},zJe=KJe();function o9(e,t=!0,n=cR){const o=e.map((r,a)=>{const i=r.Component?s.jsx(r.Component,{}):r.Component,l=r.key??a;return r.index||!r.children?s.jsx(uF,{path:r.path,element:i,index:r.index},l):s.jsx(uF,{path:r.path,element:i,children:o9(r.children,!1)},l)});return t?s.jsx(n,{children:o}):o}const r9=({updateCookieConsent:e})=>{const t=new qd,n=o=>{o.name===an.OPTANON_CONSENT&&new URLSearchParams(o.value).get("groups")&&e()};return h.useEffect(()=>(t.addChangeListener(n),()=>{t.removeChangeListener(n)}),[]),null};r9.propTypes={updateCookieConsent:m.func};const QJe=e=>({updateCookieConsent:j4.updateCookieConsent(e)}),XJe=we(null,QJe)(r9),ZJe=({children:e})=>{const t=F(),n=Ne(),o=Hg(),{sendPageViewEvent:r}=NO(),a=ae.useRef(!0);return ae.useMemo(()=>{n.state?.silent||(t(Rde(n,o,a.current)),a.current=!1,r({page:n.pathname}))},[n]),s.jsx(ae.Fragment,{children:e})};function JJe({graphQLErrors:e}){return e.some(t=>t?.extensions?.code==="context-error")}function eet(e){const t=`${window.location.pathname}${window.location.search||""}`,n=`destination=${encodeURIComponent(t)}`;return Yo({basePath:e,queryString:n})}function tet(e){return gce({onError(t){JJe(t)&&(JP(),window.location.replace(eet(e)))}})}function set({children:e}){const t=f(At),n=f(Do),o=f(Na),r=f(CC),a=ae.useMemo(()=>{const i=Ece({isClient:!0,initialState:window.__URQL_DATA__});return new fce({url:`${t??""}/graphql`,exchanges:[Ice,tet(t),i,Sce],fetchOptions:()=>({credentials:"same-origin",headers:{"x-csrf-token":o,"ecom-request-source":"web","ecom-request-source-version":r,...n&&{"client-route-id":n}}})})},[t]);return s.jsx(yce,{value:a,children:e})}function net({children:e}){const[t,n]=h.useState(null),o=f(V3),r=Ne(),a=f(aS);return h.useMemo(()=>{if(typeof window>"u")return!1;const l=!!window.gtmLoaded,c=a.some(E=>!!t?.match(E)),d=a.some(E=>!!r?.pathname?.match(E)),u=t!==null&&c&&!d,p=t!==null&&!c&&d,g=o&&l;return u&&!g||p||d&&g?!0:(n(r.pathname),!1)},[t,a,r,o])?(window.location.reload(),null):e}const oet=["md","lg"],ret=()=>{const e=dr(),t=f(oue),n=f(rue),o=f(At),r=f(Xe),a=typeof e<"u"&&oet.includes(e);return h.useEffect(()=>{const c=()=>{const{protocol:u,hostname:p,port:g=""}=window.location;return`${u}//${p}${g&&":"}${g}`},d=u=>{window&&u.origin===c()&&u.data?.type==="LOGIN_SUCCESS"&&window.location.reload()};return r||window.addEventListener("message",d),()=>{window.removeEventListener("message",d)}}),t&&!r&&(a||!a&&n)?s.jsx("iframe",{title:"sso-iframe","data-test":"sso-iframe",src:Yo({basePath:o,queryString:"silent=true"}),style:{display:"none"}}):null},aet=()=>{const e=F(),t=za.updateCustomerPreferenceSkipPaymentBufferModal;return h.useCallback(n=>{e(za.setCustomerPreferenceSkipPaymentBufferModal(n)),e(t(n))},[e])},iet=()=>{const e=F(),t=za.updateCustomerPreferenceSkipEditOrderModal;return h.useCallback(n=>{e(za.setCustomerPreferenceSkipEditOrderModal(n)),e(t(n))},[e])},cet=e=>{const t=za.getCustomerPreferenceSkipEditOrderModal;return e.dispatch(n=>n(t()))},det=e=>{const t=za.getCustomerPreferenceSkipPaymentBufferModal;return e.dispatch(n=>n(t()))},uet=e=>{const t=za.getCustomerPreferenceBasketView;return e.dispatch(n=>n(t()))},a9=e=>({type:"UPDATE_AGE_CONFIRMATION_COOKIE",value:e}),pet=se("GET_CUSTOMER_SEGMENTS"),met="customersegments",het="/v1/customer-segments/short-code-lists",get={service:met,pathPrefix:{client:"/api/customer-segments",server:"/core-api"}},Eet=()=>({type:"API",payload:{url:het,...get,...pet}}),fet={getCustomerSegments:Eet},yet=async e=>e.dispatch(t=>t(fet.getCustomerSegments())),hU={Collection:"COLLECTION",HomeDelivery:"HOME_DELIVERY"},Iet={MaxProductsReached:"MAX_PRODUCTS_REACHED"},gU={ListNameInvalid:"LIST_NAME_INVALID",MaxListsReached:"MAX_LISTS_REACHED"},Cet={ListNameInvalid:"LIST_NAME_INVALID"},vet={Standard:"STANDARD"},Tet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetFooter"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"footer"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactUs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"shouldBeOpenedInNewTab"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StaticPageTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"staticPage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WebAddressTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"columns"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"links"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"target"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"shouldBeOpenedInNewTab"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StaticPageTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"staticPage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WebAddressTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}}]}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"socialMedia"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"serviceId"}},{kind:"Field",name:{kind:"Name",value:"profileUrl"}},{kind:"Field",name:{kind:"Name",value:"tooltip"}}]}},{kind:"Field",name:{kind:"Name",value:"feedbackEmail"}},{kind:"Field",name:{kind:"Name",value:"legalText"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstItem"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"richText"}}]}},{kind:"Field",name:{kind:"Name",value:"secondItem"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"richText"}}]}}]}}]}}]}}]},_et={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMenuCampaigns"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"menuCampaigns"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"menuCampaignId"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"iconUrl"}},{kind:"Field",name:{kind:"Name",value:"items"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"menuCampaignItemId"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"imageUrl"}},{kind:"Field",name:{kind:"Name",value:"altText"}},{kind:"Field",name:{kind:"Name",value:"target"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"shouldBeOpenedInNewTab"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WebAddressTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StaticPageTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"staticPage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SearchTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchTerm"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ShopInShopTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shop"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CategoryTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"categoryId"}},{kind:"Field",name:{kind:"Name",value:"retailerCategoryId"}},{kind:"Field",name:{kind:"Name",value:"nameHierarchy"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PromotionTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"promotionId"}},{kind:"Field",name:{kind:"Name",value:"retailerPromotionId"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductTarget"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productId"}},{kind:"Field",name:{kind:"Name",value:"retailerProductId"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}}]}}]}}]}}]}}]},bet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShoppingListsOnLoggedInHomePage"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingLists"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListId"}}]}}]}}]},xet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCompletedOrders"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"completedOrders"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"retentionPeriod"}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}},{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"orderId"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"region"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"retailerRegionId"}}]}},{kind:"Field",name:{kind:"Name",value:"prices"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"total"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currency"}},{kind:"Field",name:{kind:"Name",value:"amount"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"recurringOrderDefinition"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}}]}},{kind:"Field",name:{kind:"Name",value:"slot"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"InternalOrderSlot"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"start"}},{kind:"Field",name:{kind:"Name",value:"end"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"shippingGroupType"}},{kind:"Field",name:{kind:"Name",value:"carrier"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"carrierId"}}]}},{kind:"Field",name:{kind:"Name",value:"externalLocker"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"externalLockerId"}}]}},{kind:"Field",name:{kind:"Name",value:"deliveryDestination"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deliveryMethod"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"address"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"timeZone"}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ImportedOrderSlot"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"start"}},{kind:"Field",name:{kind:"Name",value:"end"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"timeZone"}}]}}]}}]}}]}}]}}]}}]},Aet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShoppingListCreate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shoppingListCreateInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ShoppingListCreateInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shoppingListCreateInput"},value:{kind:"Variable",name:{kind:"Name",value:"shoppingListCreateInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"shoppingListId"}}]}},{kind:"Field",name:{kind:"Name",value:"success"}},{kind:"Field",name:{kind:"Name",value:"failureReason"}}]}}]}}]},Ret={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShoppingListDelete"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shoppingListDeleteInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ShoppingListDeleteInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shoppingListDeleteInput"},value:{kind:"Variable",name:{kind:"Name",value:"shoppingListDeleteInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"success"}}]}}]}}]},Det={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShoppingListUpdateName"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shoppingListUpdateNameInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ShoppingListUpdateNameInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListUpdateName"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shoppingListUpdateNameInput"},value:{kind:"Variable",name:{kind:"Name",value:"shoppingListUpdateNameInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"shoppingListId"}},{kind:"Field",name:{kind:"Name",value:"name"}}]}},{kind:"Field",name:{kind:"Name",value:"success"}},{kind:"Field",name:{kind:"Name",value:"failureReason"}}]}}]}}]},Oet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShoppingListAddProduct"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shoppingListAddProductInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ShoppingListAddProductInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListAddProduct"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shoppingListAddProductInput"},value:{kind:"Variable",name:{kind:"Name",value:"shoppingListAddProductInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"success"}},{kind:"Field",name:{kind:"Name",value:"failureReason"}}]}}]}}]},Pet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShoppingListRemoveProduct"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shoppingListRemoveProductInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ShoppingListRemoveProductInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListRemoveProduct"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shoppingListRemoveProductInput"},value:{kind:"Variable",name:{kind:"Name",value:"shoppingListRemoveProductInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"success"}}]}}]}}]},Net={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShoppingListsForListsModal"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingLists"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListId"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"products"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productId"}}]}}]}}]}}]},Let={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CartAddShoppingList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"addShoppingListInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CartAddShoppingListInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cartAddShoppingList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"addShoppingListInput"},value:{kind:"Variable",name:{kind:"Name",value:"addShoppingListInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"successfulUpdates"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"product"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productId"}}]}},{kind:"Field",name:{kind:"Name",value:"quantity"}}]}},{kind:"Field",name:{kind:"Name",value:"unsuccessfulUpdates"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"product"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productId"}}]}},{kind:"Field",name:{kind:"Name",value:"quantity"}},{kind:"Field",name:{kind:"Name",value:"reason"}}]}}]}}]}}]},ket={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShoppingList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shoppingListId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shoppingListId"},value:{kind:"Variable",name:{kind:"Name",value:"shoppingListId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListId"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"productCount"}},{kind:"Field",name:{kind:"Name",value:"offerCount"}},{kind:"Field",name:{kind:"Name",value:"lastModifiedDateTime"}},{kind:"Field",name:{kind:"Name",value:"prices"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"basePrice"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"}}]}},{kind:"Field",name:{kind:"Name",value:"discountedPrice"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"}}]}},{kind:"Field",name:{kind:"Name",value:"savings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"products"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productId"}}]}}]}}]}}]},jet={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShoppingLists"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"width"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isAlcoholBlurringEnabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isAgeRestrictedVisibilityEnabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingLists"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shoppingListId"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"productCount"}},{kind:"Field",name:{kind:"Name",value:"offerCount"}},{kind:"Field",name:{kind:"Name",value:"prices"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"discountedPrice"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"products"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productId"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"isAlcohol"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isAlcoholBlurringEnabled"}}}]}]},{kind:"Field",name:{kind:"Name",value:"primaryImage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"Variable",name:{kind:"Name",value:"width"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}}]}},{kind:"Field",name:{kind:"Name",value:"restrictions"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isAgeRestrictedVisibilityEnabled"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"restrictedVisibility"}}]}}]}}]}}]}}]},Met={"\n    query GetFooter {\n        footer {\n            contactUs {\n                __typename\n                shouldBeOpenedInNewTab\n                ... on StaticPageTarget {\n                    staticPage\n                }\n                ... on WebAddressTarget {\n                    url\n                }\n            }\n            columns {\n                title\n                links {\n                    text\n                    target {\n                        __typename\n                        shouldBeOpenedInNewTab\n                        ... on StaticPageTarget {\n                            staticPage\n                        }\n                        ... on WebAddressTarget {\n                            url\n                        }\n                    }\n                }\n            }\n            socialMedia {\n                serviceId\n                profileUrl\n                tooltip\n            }\n            feedbackEmail\n            legalText {\n                firstItem {\n                    id\n                    name\n                    richText\n                }\n                secondItem {\n                    id\n                    name\n                    richText\n                }\n            }\n        }\n    }\n":Tet,"\n    query GetMenuCampaigns {\n        menuCampaigns {\n            menuCampaignId\n            name\n            label\n            iconUrl\n            items {\n                menuCampaignItemId\n                name\n                label\n                imageUrl\n                altText\n                target {\n                    __typename\n                    shouldBeOpenedInNewTab\n                    ... on WebAddressTarget {\n                        url\n                    }\n                    ... on StaticPageTarget {\n                        staticPage\n                    }\n                    ... on SearchTarget {\n                        searchTerm\n                    }\n                    ... on ShopInShopTarget {\n                        shop\n                    }\n                    ... on CategoryTarget {\n                        categoryId\n                        retailerCategoryId\n                        nameHierarchy\n                    }\n                    ... on PromotionTarget {\n                        promotionId\n                        retailerPromotionId\n                        description\n                    }\n                    ... on ProductTarget {\n                        productId\n                        retailerProductId\n                        description\n                    }\n                }\n            }\n        }\n    }\n":_et,"\n    query GetShoppingListsOnLoggedInHomePage {\n        shoppingLists {\n            shoppingListId\n        }\n    }\n":bet,"\n    query GetCompletedOrders($first: Int!, $after: String) {\n        completedOrders(first: $first, after: $after) {\n            retentionPeriod\n            pageInfo {\n                endCursor\n                hasNextPage\n            }\n            edges {\n                node {\n                    orderId\n                    status\n                    region {\n                        retailerRegionId\n                    }\n                    prices {\n                        total {\n                            currency\n                            amount\n                        }\n                    }\n                    recurringOrderDefinition {\n                        name\n                    }\n                    slot {\n                        __typename\n                        ... on InternalOrderSlot {\n                            start\n                            end\n                            type\n                            shippingGroupType\n                            carrier {\n                                carrierId\n                            }\n                            externalLocker {\n                                externalLockerId\n                            }\n                            deliveryDestination {\n                                deliveryMethod\n                                name\n                                address {\n                                    timeZone\n                                }\n                            }\n                        }\n                        ... on ImportedOrderSlot {\n                            start\n                            end\n                            name\n                            timeZone\n                        }\n                    }\n                }\n            }\n        }\n    }\n":xet,"\n    mutation ShoppingListCreate($shoppingListCreateInput: ShoppingListCreateInput!) {\n        shoppingListCreate(shoppingListCreateInput: $shoppingListCreateInput) {\n            shoppingList {\n                __typename\n                shoppingListId\n            }\n            success\n            failureReason\n        }\n    }\n":Aet,"\n    mutation ShoppingListDelete($shoppingListDeleteInput: ShoppingListDeleteInput!) {\n        shoppingListDelete(shoppingListDeleteInput: $shoppingListDeleteInput) {\n            success\n        }\n    }\n":Ret,"\n    mutation ShoppingListUpdateName($shoppingListUpdateNameInput: ShoppingListUpdateNameInput!) {\n        shoppingListUpdateName(shoppingListUpdateNameInput: $shoppingListUpdateNameInput) {\n            shoppingList {\n                __typename\n                shoppingListId\n                name\n            }\n            success\n            failureReason\n        }\n    }\n":Det,"\n    mutation ShoppingListAddProduct($shoppingListAddProductInput: ShoppingListAddProductInput!) {\n        shoppingListAddProduct(shoppingListAddProductInput: $shoppingListAddProductInput) {\n            shoppingList {\n                __typename\n            }\n            success\n            failureReason\n        }\n    }\n":Oet,"\n    mutation ShoppingListRemoveProduct(\n        $shoppingListRemoveProductInput: ShoppingListRemoveProductInput!\n    ) {\n        shoppingListRemoveProduct(shoppingListRemoveProductInput: $shoppingListRemoveProductInput) {\n            shoppingList {\n                __typename\n            }\n            success\n        }\n    }\n":Pet,"\n    query GetShoppingListsForListsModal {\n        shoppingLists {\n            shoppingListId\n            name\n            products {\n                productId\n            }\n        }\n    }\n":Net,"\n    mutation CartAddShoppingList($addShoppingListInput: CartAddShoppingListInput!) {\n        cartAddShoppingList(addShoppingListInput: $addShoppingListInput) {\n            successfulUpdates {\n                product {\n                    productId\n                }\n                quantity\n            }\n            unsuccessfulUpdates {\n                product {\n                    productId\n                }\n                quantity\n                reason\n            }\n        }\n    }\n":Let,"\n    query GetShoppingList($shoppingListId: ID!) {\n        shoppingList(shoppingListId: $shoppingListId) {\n            shoppingListId\n            name\n            productCount\n            offerCount\n            lastModifiedDateTime\n            prices {\n                basePrice {\n                    amount\n                    currency\n                }\n                discountedPrice {\n                    amount\n                    currency\n                }\n                savings {\n                    amount\n                    currency\n                }\n            }\n            products {\n                productId\n            }\n        }\n    }\n":ket,"\n    query GetShoppingLists(\n        $width: Int!\n        $isAlcoholBlurringEnabled: Boolean!\n        $isAgeRestrictedVisibilityEnabled: Boolean!\n        $first: Int\n    ) {\n        shoppingLists {\n            shoppingListId\n            name\n            productCount\n            offerCount\n            prices {\n                discountedPrice {\n                    amount\n                    currency\n                }\n            }\n            products(first: $first) {\n                productId\n                description\n                isAlcohol @include(if: $isAlcoholBlurringEnabled)\n                primaryImage(width: $width) {\n                    url\n                }\n                restrictions @include(if: $isAgeRestrictedVisibilityEnabled) {\n                    restrictedVisibility\n                }\n            }\n        }\n    }\n":jet};function ia(e){return Met[e]??{}}const i9=ia(`
    query GetMenuCampaigns {
        menuCampaigns {
            menuCampaignId
            name
            label
            iconUrl
            items {
                menuCampaignItemId
                name
                label
                imageUrl
                altText
                target {
                    __typename
                    shouldBeOpenedInNewTab
                    ... on WebAddressTarget {
                        url
                    }
                    ... on StaticPageTarget {
                        staticPage
                    }
                    ... on SearchTarget {
                        searchTerm
                    }
                    ... on ShopInShopTarget {
                        shop
                    }
                    ... on CategoryTarget {
                        categoryId
                        retailerCategoryId
                        nameHierarchy
                    }
                    ... on PromotionTarget {
                        promotionId
                        retailerPromotionId
                        description
                    }
                    ... on ProductTarget {
                        productId
                        retailerProductId
                        description
                    }
                }
            }
        }
    }
`),wet=()=>{const e=Ne(),t=F(),n=f(eV);mz({onVisibilityChange:o=>{o||n||t(B_(!0))}}),h.useEffect(()=>{if(!n&&document.visibilityState==="hidden"){t(B_(!0));return}n&&document.visibilityState==="visible"&&t(B_(!1))},[e.pathname])};function EU(e){return e==="ar-SA"?"ar-SA-u-nu-latn":e??"en-GB"}const Fet=({children:e})=>{const t=f(WC);return $H(t.active),s.jsxs(h.Fragment,{children:[s.jsx(Gn,{htmlAttributes:{lang:EU(t.active),dir:t.direction??"ltr"}}),s.jsx(Cce,{textComponent:"span",locale:EU(t.active),messages:t.strings,defaultLocale:"en-GB",children:e})]})},Bet=D("intlkey"),Uet=({children:e})=>{const t=f(Bet),n=L(),o=h.useRef([]),r=h.useRef(new Set);h.useEffect(()=>{const c=()=>{for(;o.current.length;){const d=o.current.pop();d&&Ue.api.pushError(d.translationError,{context:{errorData:JSON.stringify(d?.errorData)}})}};return window.addEventListener("load",c),()=>{window.removeEventListener("load",c)}},[]);const a=(c,d)=>{typeof document<"u"&&c[d]===void 0&&i(d)},i=c=>{const{locale:d}=n,u=`${c}-${d}`;if(!r.current.has(u)){r.current.add(u);const p=new Error("Translation missing"),g={id:c,locale:d};document.readyState==="complete"?Ue.api.pushError(p,{context:{errorData:JSON.stringify(g)}}):o.current.push({translationError:p,errorData:g})}},l=h.useMemo(()=>({...n,formatMessage:(c,d)=>{const u=typeof c=="string"?c:c.id;return t?u:(typeof u<"u"&&a(n.messages,u),n.formatMessage({id:u,defaultMessage:" "},d))}}),[n]);return s.jsx(vce.Provider,{value:l,children:e})},Get=(e,t)=>{if(t&&Object.keys(t).length>0){const n=Object.keys(t).map(o=>`{${o}}`).join(",");return`${e} with placeholders ${n}`}return e},b=({id:e,values:t={}})=>{const n=ae.useMemo(()=>Get(e,t),[e,t]);return s.jsx(Nt,{id:e,defaultMessage:n,...Object.keys(t).length>0&&{values:t}})},yc={AWCV:"AWCV",FJPY:"FJPY",CGVB:"CGVB",FKSN:"FKSN",LWCD:"LWCD",SNXC:"SNXC",YBKD:"YBKD",MJSA:"MJSA"},$et=D("gtm.tgt"),Het=D("gtm.r"),vu=({children:e,targetName:t})=>{const n=f(Het);if(!f($et))return e||null;const r=ae.Children.toArray(e);return r.length>0?(r[0]=ae.cloneElement(r[0],{"data-gtm-target":t}),n?s.jsx(hg,{targetName:t,children:r}):r):n?s.jsx(hg,{targetName:t,children:s.jsx("div",{"data-gtm-target":t})}):s.jsx("div",{"data-gtm-target":t})},Vet=({targetNameKey:e,children:t})=>!e||!yc[e]?s.jsx(h.Fragment,{children:t}):s.jsx(vu,{targetName:yc[e],children:t}),Wet=v.div`
    position: relative;
    display: inline-block;
    inset-block-start: ${$(3)};
    margin-inline-end: var(--salt-spacing-1);
`,Os=({title:e,titleValues:t,titleAs:n="h2",titleIcon:o,description:r,primaryButton:a,secondaryButton:i,image:l,gtmTargetNameKey:c})=>{const d=!!a&&"to"in a&&!!a.to,u=!!a&&"onClick"in a&&!!a.onClick,g=a&&a.text?{asButton:u,asLink:d}:!1,E=i&&i.text?{asButton:!!i.onClick}:!1,y={image:!!l,title:!!e&&!!n||!!o,titleText:!!e,titleIcon:!!o,description:!!r,primaryButton:g,secondaryButton:E},I=a&&typeof y.primaryButton!="boolean"&&y.primaryButton.asButton,S=a&&typeof y.primaryButton!="boolean"&&y.primaryButton.asLink,C=i&&typeof y.secondaryButton!="boolean"&&y.secondaryButton.asButton,T=(y.title||y.description)&&(y.primaryButton||y.secondaryButton)?"salt-d--flex salt-m-t--8":"salt-d--flex";return s.jsxs(h.Fragment,{children:[y.image&&s.jsx(Q,{justify:"center",className:"salt-m-b--4",children:s.jsx(pe,{name:l,height:250,width:250})}),y.title&&s.jsxs("div",{className:y.description?"salt-m-b--4":void 0,children:[y.titleIcon&&s.jsx(Wet,{children:s.jsx(pe,{name:o})}),s.jsx(ee,{className:"salt-d--inline",as:n,children:y.titleText&&s.jsx(b,{id:e??"",values:t})})]}),y.description&&s.jsx(O,{size:"l",children:s.jsx(Vet,{targetNameKey:c,children:s.jsx(b,{id:r??""})})}),y.primaryButton&&s.jsxs("div",{className:T,children:[u&&I&&s.jsx(x,{intent:"primary",fill:!0,loading:a.loading,onClick:a.onClick,...a.aria,children:s.jsx(x.Text,{children:s.jsx(b,{id:a.text})})}),S&&d&&a.to&&s.jsx(x,{asChild:!0,intent:"primary",fill:!0,...a.aria,children:s.jsx(Ye,{intent:"ghost",to:a.to,children:s.jsx(x.Text,{children:s.jsx(b,{id:a.text})})})})]}),y.secondaryButton&&s.jsx("div",{className:"salt-d--flex",children:C&&s.jsx(x,{className:y.primaryButton?"salt-m-t--1":void 0,intent:"secondary",fill:!0,loading:i.loading,onClick:i.onClick,...i.aria,children:s.jsx(x.Text,{children:s.jsx(b,{id:i.text})})})})]})},l9=h.createContext({});function BN(){return h.useContext(l9)}l9.Provider;const Yet=()=>window.location.reload(),jn=({errorMessageKey:e,showRefreshLink:t=!1,statusCode:n})=>{const o=BN();return o&&n&&(o.statusCode=n),s.jsx(V,{fixed:!0,"data-test":"in-page-error",className:"salt-m-t--16",children:s.jsx(V.Item,{colStart:{sm:3,md:4,lg:5},colSpan:{xs:12,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:"status_no",title:"error.in.page.title",titleAs:"h1",description:e??"error.in.page.default.message",primaryButton:t?{text:"error.in.page.refresh.link",onClick:Yet}:void 0})})})};class qet extends h.Component{static getDerivedStateFromError(){return{hasError:!0}}constructor(t){super(t),this.state={hasError:!1}}componentDidUpdate(t){this.state.hasError&&this.props.location.pathname!==t.location.pathname&&this.setState({hasError:!1})}componentDidCatch(t){try{throw t}catch(n){this.props.actions.analyticsEvent({type:VC.ERROR,boundaryType:this.props.type,errorType:"ERROR_BOUNDARY"}),Ue.api.pushError(n instanceof Error?n:new Error(`ErrorBoundary error: ${JSON.stringify(n)}`),{context:{requestId:this.props.requestId,message:`ErrorBoundary (${this.props.type}) component caught the following error: ${n instanceof Error?n.message:"unknown"}`}})}}render(){return this.state.hasError?s.jsx(jn,{}):this.props.children}}const Ket=e=>({requestId:fC(e)}),zet=st({analyticsEvent:U.analyticsEvent}),Qet=we(Ket,zet),UN=Qet(qet),c9=h.createContext({fop:null,productList:null}),VE=()=>h.useContext(c9),Xet=({children:e})=>{const t=F(),n=f(xXe),o=f(LXe),r=i=>{if(i.data.type==="VISUAL_CONFIG"&&i.data.payload.type==="FOP"){const l=i.data.payload.data;t({type:Lh.types.GET_FOP_CONFIG.SUCCESS,payload:{responseData:l}})}if(i.data.type==="VISUAL_CONFIG"&&i.data.payload.type==="PRODUCT_LIST"){const l=i.data.payload.data;t({type:kh.types.GET_PRODUCT_LIST_CONFIG.SUCCESS,payload:{responseData:l}})}};h.useEffect(()=>(window.addEventListener("message",r),()=>window.removeEventListener("message",r)),[]);const a=h.useMemo(()=>({fop:n,productList:o}),[n,o]);return s.jsx(c9.Provider,{value:a,children:e})},Zet=mH`${Iwe}`,Jet=({children:e})=>{const t=Ne();return s.jsx(Fet,{children:s.jsx(hwe,{children:s.jsxs(h.Fragment,{children:[s.jsx(Zet,{}),s.jsx(Uet,{children:s.jsx(vz,{children:s.jsx(Xet,{children:s.jsx(UN,{location:t,type:"app",children:e})})})})]})})})},ett=D("loyalty"),ttt=D("pb.pl"),stt=D("cf.mc.on"),ntt=D("seo.rdbl"),ott=D("cfop"),rtt=D("alc.blur");typeof window=="object"&&document.querySelector("#app")&&B.ReactModal.setAppElement("#app");function d9(){const e=F(),t=f(yC)??null;return wet(),h.useEffect(()=>{e(Pde()),perfMetrics.onFirstInputDelay(n=>{e(U.analyticsEvent({type:dO.PERF_FIRST_INPUT_DELAY,delay:n}))})},[]),s.jsxs(Jet,{children:[s.jsx(ret,{}),s.jsx(dUe,{"data-osp-retailer":t,children:s.jsx(pR,{})})]})}d9.fetchData=({context:e})=>{const{store:t,cookies:n}=e,o=t.dispatch,r=t.getState(),a=[o(fr.getCategories({depth:1,isSEOReadableURLEnabled:ntt(r)}))];return Xe(r)&&rtt(r)&&o(a9(!!n.get(an.AGE_CONFIRMATION_COOKIE))),Xe(r)&&a.push(uet(t)),ott(r)&&(a.push(o(Lh.fetchFopConfigAction())),a.push(o(kh.fetchProductListConfigAction()))),Xe(r)&&a.push(cet(t)),ttt(r)&&Xe(r)&&a.push(det(t)),ett(r)&&a.push(o(Vy.getLoyaltySettings())),stt(r)&&a.push(e.urqlClient.query(i9,{})),Xe(r)&&a.push(yet(t)),Xe(r)&&a.push(o(gd.getAccessibilitySettings())),Promise.all(a)};const cA=({reload:e,to:t=""})=>(e?window.location.reload():window.location.replace(t),null),dA=(e,t)=>t&&!e.includes(t)?WUe(e,t):e;function att({to:e,basePath:t}){const n=BN();return n&&typeof e=="string"&&(n.url=dA(e,t)),null}function itt({to:e}){const t=Ge();return ae.useLayoutEffect(()=>{t(e,{replace:!0})},[]),null}const En=e=>{const t=f(nv),n=f(At),{to:o=""}=e;if(typeof window>"u")return s.jsx(att,{to:o,basePath:n});const r=o;return t.type===Yr.ALL_ANCHORS?s.jsx(cA,{to:dA(r,n)}):t.type===Yr.MIXED&&!!t.anchorLinks?.find(i=>!!r.match(i))?s.jsx(cA,{to:dA(r,n)}):e.unstable__customRedirectImplementation?s.jsx(itt,{to:o}):s.jsx(Tce,{to:o,replace:!0})};En.displayName="Redirect";function ltt(e,t){const n=`${e}${t}`;return Yo({queryString:`destination=${encodeURIComponent(n)}`})}const $s=(e,t,n)=>{const o=r=>{const a=Ne();return f(e)?s.jsx(t,{...r}):s.jsx(En,{to:ltt(n||a.pathname,a.search)})};return o.fetchData=r=>e(r.context.store.getState())&&t.fetchData?t.fetchData(r):null,o},ctt=e=>t=>t(Yy.validateAddress(e)).then(n=>n.payload.responseData.id),dtt={validateAddress:ctt},utt=(e,t)=>n=>n(eo.getDeliverabilityByAddressDetails(e,t)).then(o=>o.payload.responseData),u9=e=>t=>t(eo.postCustomerAddresses(e)).then(n=>n.payload.responseData),ptt=e=>t=>t(eo.fetchAddressesBySearchTerm(e)).then(n=>n.payload.responseData),mtt=(e,t=!0)=>n=>n(eo.fetchDetailsForAddress(e)).then(o=>{const r=o.payload.responseData,{latitude:a,longitude:i,postcode:l}=r;return n(Di.getDeliveryDestinationDeliverability({latitude:a,longitude:i,postalCode:l})).then(c=>{const{deliverability:d}=c.payload.responseData,u=gtt(d,t);return{...r,deliverable:u}})}),htt=e=>t=>t(eo.fetchDetailsForAddress(e)).then(n=>n.payload.responseData),gtt=(e,t)=>{switch(e){case"DELIVERABLE":return!0;case"DELIVERABLE_BY_OTHER_STORE":return t===!0;default:return!1}},Ap={getDeliverabilityByAddressDetails:utt,postCustomerAddresses:u9,fetchDetailsForAddress:mtt};function Ett(e,t,n){const{type:o}=n;t(U.analyticsEvent({type:VC.ERROR,boundaryType:o,errorType:"ERROR_BOUNDARY"})),Ue.api.pushError(e,{context:{message:`(${o}): ${e.message}`,...n}})}function ftt(e,t){if(!t.componentStack)return e;const n=new Error(e.message);return n.name=`React ErrorBoundary ${e.name}`,n.stack=t.componentStack,n}function Et({fallback:e=s.jsx(jn,{}),type:t,additionalErrorAttributes:n,children:o}){const r=F(),a=f(fC);return s.jsx(_ce,{fallback:e,onError:(i,l)=>{Ett(ftt(i,l),r,{requestId:a,type:t,...n})},children:o})}const WE=e=>{const t=DIe(e),n=OIe(e);return D("addl.s")(e)?n:t},Gd=e=>{const t=WE(e);return[Co.MANUAL_FORM,Co.MANUAL_FORM_POSTCODE].includes(t)},{analyticsEvent:ytt}=U;function Bs(){const e=F(),t=n=>e(ytt(n));return{addressImpression:n=>t({type:ke.ADDRESS_IMPRESSION,addressesImpression:n}),toastNotificationDisplayed:({message:n,messageId:o})=>t({type:ke.TOAST_NOTIFICATION_DISPLAYED,description:"A toast notification was displayed",pageEventAttributes:{message:n,messageId:o}}),addressPostCode:()=>t({type:ke.ADDRESS_POSTCODE}),findAddressButtonClicked:n=>{t({type:ke.FIND_ADDRESS_BUTTON_CLICKED,...n})},addressDropdownOpened:()=>t({type:ke.ADDRESS_DROPDOWN_OPENED}),dropdownAddressSelected:n=>t({type:ke.DROPDOWN_ADDRESS_SELECTED,...n}),addAddressButtonClicked:()=>t({type:ke.ADD_ADDRESS_BUTTON_CLICKED}),formAddAddressButtonClicked:n=>t({type:ke.FORM_ADD_ADDRESS_BUTTON_CLICKED,...n}),saveAddressButtonClicked:n=>t({type:ke.SAVE_ADDRESS_BUTTON_CLICKED,...n}),editAddressButtonClicked:n=>t({type:ke.EDIT_ADDRESS_BUTTON_CLICKED,addressId:n}),removeAddressButtonClicked(n,o){t({type:ke.REMOVE_ADDRESS_BUTTON_CLICKED,addressId:n,isLastAddress:o})},cancelButtonClicked(n){t({type:ke.CANCEL_BUTTON_CLICKED,status:n})},findAddressAgainButtonClicked:()=>t({type:ke.FIND_ADDRESS_AGAIN_BUTTON_CLICKED}),userDetailsFormModalDisplayed(){t({type:ke.USER_DETAILS_FORM_MODAL_DISPLAYED})},userDetailsFormModalClosed:n=>{t({type:ke.USER_DETAILS_FORM_MODAL_CLOSED,button:n})},saveDetailsButtonClickedEvent:n=>{t({type:ke.SAVE_DETAILS_BUTTON_CLICKED,...n})},addAddressSuccess:()=>{t({type:ke.ADD_ADDRESS_SUCCESS});const n={event:"add_address_success"};te.sendEvent({GA:n,WA:null})},addressLookupAbandoned:({lastSearchString:n,failedSearches:o})=>{t({type:ke.ADDRESS_LOOKUP_ABANDONED,lastSearchString:n,failedSearches:o});const r={event:"event",eventCategory:"Address Lookup",eventAction:"Abandoned",eventLabel:n,eventValue:"1"};te.sendEvent({GA:r,WA:null})},addressLookupAbandonedGA4:()=>{t({type:ke.ADDRESS_LOOKUP_ABANDONED_GA4});const n={event:"address_lookup_abandoned"};te.sendEvent({GA:n,WA:null})},addressLookupAddressNotFound:()=>{t({type:ke.ADDRESS_LOOKUP_ADDRESS_NOT_FOUND});const n={event:"address_lookup_address_not_found"};te.sendEvent({GA:n,WA:null})},addressLookupAddressSelected:()=>{t({type:ke.ADDRESS_LOOKUP_ADDRESS_SELECTED});const n={event:"address_lookup_address_selected"};te.sendEvent({GA:n,WA:null})},addressLookupSuccess:()=>{t({type:ke.ADDRESS_LOOKUP_SUCCESS});const n={event:"address_lookup_success"};te.sendEvent({GA:n,WA:null})},addressLookupUndeliverable:n=>{t({type:ke.ADDRESS_LOOKUP_UNDELIVERABLE,addressDescription:n});const o={event:"event",eventAction:"Undeliverable",eventCategory:"Address Lookup",eventLabel:n,eventValue:"1"};te.sendEvent({GA:o,WA:null})},addressLookupUndeliverableGA4:()=>{t({type:ke.ADDRESS_LOOKUP_UNDELIVERABLE_GA4});const n={event:"address_lookup_undeliverable"};te.sendEvent({GA:n,WA:null})},removeAddress:()=>{t({type:ke.REMOVE_ADDRESS});const n={event:"remove_address"};te.sendEvent({GA:n,WA:null})},updateAddress:()=>{t({type:ke.UPDATE_ADDRESS});const n={event:"update_address"};te.sendEvent({GA:n,WA:null})},addressLookupSelected:({lastSearchString:n,failedSearches:o})=>{t({type:ke.ADDRESS_LOOKUP_SELECTED,lastSearchString:n,failedSearches:o});const r={event:"event",eventCategory:"Address Lookup",eventAction:"AddressSelected",eventLabel:"",eventValue:"1"};te.sendEvent({GA:r,WA:null})},addAddressModalDisplayed:n=>t({type:ke.ADD_ADDRESS_MODAL_DISPLAYED,activeFlow:n}),addAddressModalClosed:(n,o,r)=>t({type:ke.ADD_ADDRESS_MODAL_CLOSED,buttonClicked:n,isMissingMandatoryField:o,...r}),selectAddressModalDisplayed:n=>t({type:ke.SELECT_ADDRESS_MODAL_DISPLAYED,matchesFound:n}),selectAddressModalClosed:(n,o,r,a)=>t({type:ke.SELECT_ADDRESS_MODAL_CLOSED,buttonClicked:n,addressTypeSelected:o,positionSelectedAddress:r,isInDeliverabilityArea:a}),confirmAddressModalDisplayed:()=>t({type:ke.CONFIRM_ADDRESS_MODAL_DISPLAYED}),confirmAddressModalClosed:(n,o,r)=>t({type:ke.CONFIRM_ADDRESS_MODAL_CLOSED,buttonClicked:n,distanceFromOriginal:o,isInDeliverabilityArea:r}),zoomButtonClickedEvent:n=>t({type:ke.ZOOM_BUTTON_CLICKED,zoomType:n}),locateMeButtonClickedEvent:()=>t({type:ke.LOCATE_ME_BUTTON_CLICKED}),saveAddressModalDisplayed:n=>t({type:ke.SAVE_ADDRESS_MODAL_DISPLAYED,isThereMissingInfo:n}),saveAddressModalClosed:(n,o,r)=>t({type:ke.SAVE_ADDRESS_MODAL_CLOSED,buttonClicked:n,isMissingMandatoryField:o,...r}),searchAddressPostcodeModalDisplayed:()=>t({type:ke.SEARCH_ADDRESS_POSTCODE_MODAL_DISPLAYED}),searchAddressPostcodeModalClosed:n=>t({type:ke.SEARCH_ADDRESS_POSTCODE_MODAL_CLOSED,status:n}),searchAddressPostcodeEndTyping:(n,o,r)=>t({type:ke.SEARCH_ADDRESS_POSTCODE_END_TYPING,results:n,searchBarFilled:o,errorState:r}),continueAddressAddButtonClicked:()=>t({type:ke.CONTINUE_ADDRESS_ADD_BUTTON_CLICKED}),enterAddressManuallyButtonClicked:()=>t({type:ke.ENTER_ADDRESS_MANUALLY_BUTTON_CLICKED}),searchAddressModalClosed:()=>t({type:ke.SEARCH_ADDRESS_MODAL_CLOSED}),searchAddressContinueClicked:(n,o,r)=>t({type:ke.SEARCH_ADDRESS_CONTINUE_CLICKED,results:n,searchBarFilled:o,errorState:r})}}function Itt(e){return Object.entries(e).map(([t,n])=>({fieldId:t,value:n}))}const Stt=(e,t,n)=>{if(t)e.formAddAddressButtonClicked({isAddressGeocoded:!0,isAddressDeliverable:!0,missingMandatoryField:!1,missingMandatoryFieldName:[]}),n("CONFIRMATION_FORM");else{e.formAddAddressButtonClicked({isAddressGeocoded:!0,isAddressDeliverable:!1,missingMandatoryField:!1,missingMandatoryFieldName:[]});const o="settings.addresses.alert.nondeliverable";e.toastNotificationDisplayed({message:o,messageId:"non_delivery_address"}),Z.error(o)}},Ctt=(e,t)=>{const{validateAddress:n,sendAnalytics:o,setVisibleComponent:r,fetchDetailsForAddress:a}=t;n(Itt(e)).then(i=>{if(i)a(i).then(l=>Stt(o,l.deliverable,r));else throw Error("not found")}).catch(()=>{const i="addresses.error-address.title.label";o.toastNotificationDisplayed({message:i,messageId:"address_error"}),Z.error(i),o.formAddAddressButtonClicked({isAddressGeocoded:!1,missingMandatoryField:!1,missingMandatoryFieldName:[]})})},GN=({id:e,hasRequiredSymbol:t=!1,label:n="",helperText:o="",errorMessage:r="",children:a=s.jsx("span",{children:"missing input..."}),className:i="",isVisuallyConcealed:l=!1})=>{const{formatMessage:c}=L(),d=!!r;return s.jsxs(_a,{className:i,"data-test":GN.dataTestId,children:[n&&s.jsxs(h.Fragment,{children:[s.jsx(Rn,{hasError:d,htmlFor:e,visuallyConcealed:l,isRequired:t,children:n}),t?s.jsx(ie,{children:c("validation.msg.required")}):null]}),o&&(l?s.jsx(ie,{children:o}):s.jsx(O,{className:"salt-d--block salt-m-b--1",children:o})),a,d&&s.jsx(oi,{role:"alert","data-test":"form-field-error-message",children:r})]})};GN.dataTestId="input-wrapper";function vtt(e,t){const n=e.split(".");try{return n.reduce((o,r)=>o[r],t).message}catch{return""}}function $N(e,t){if(t.formState.errors){if(!e.includes("."))return t.formState.errors[e]?.message??""}else return"";return vtt(e,t.formState.errors)}function p9({id:e,label:t,"data-test":n,hasRequiredSymbol:o=!1,errorMessage:r="",inputOptions:a={},className:i,defaultValue:l}){return s.jsx(Wo,{id:e,input:a,label:t,hideLabel:!t,className:i,required:o,"data-test":n||`input-${e}`,meta:{error:r,touched:!!r,invalid:!!r},defaultValue:l})}function nr({name:e,label:t,hasRequiredSymbol:n=!0,required:o,min:r,max:a,pattern:i,valueAsNumber:l,validate:c,deps:d,className:u,defaultValue:p,...g}){const E=po();return s.jsx(p9,{id:String(g.id??e),"data-test":g["data-test"],label:t,errorMessage:$N(e,E),hasRequiredSymbol:n&&(o?.value??!1),inputOptions:{...E.register(e,{valueAsNumber:l,required:o,pattern:i,min:r,max:a,deps:d,validate:c}),...g},className:u,defaultValue:p})}function Am({name:e,label:t,helperText:n,options:o,required:r,placeholder:a="",onBlur:i,onFocus:l,onChangeCallback:c=()=>{},validate:d,deps:u,ariaLabel:p,defaultValue:g=void 0,"data-test":E,resetOnInvalidState:y=!1,mode:I}){const[S,C]=h.useState(g),T=po(),_=(P=S)=>o.find(N=>N.value===P),A=(P=g)=>{T.setValue(e,P),C(P)};h.useEffect(()=>(T.register(e,{validate:d,required:r,deps:u}),g!==void 0&&!y&&A(),g!==void 0&&y&&_(g)&&A(),g!==void 0&&y&&!_(g)&&A(void 0),!_()&&y&&A(),()=>T.unregister(e)),[e,g,o.map(P=>P.value).join("")]);const R=P=>{T.setValue(e,P.target.value),I!=="onSubmit"&&(T.trigger(),T.clearErrors(e)),C(P.target.value),c(P)};return s.jsx(Dr,{error:$N(e,T),label:t,id:e,"data-test":E??e,required:r?.value,"aria-label":p,placeholder:a,helperText:n,onChange:R,onBlur:i,onFocus:l,value:S,children:o.map(({value:P,label:N,dataTest:k})=>s.jsx("option",{value:P,"data-test":k,children:N},P))})}function Ttt({onClick:e,label:t}){return s.jsx(x,{type:"submit",intent:"primary",fill:!0,onClick:e,className:"salt-m-y--4",children:s.jsx(b,{id:t})})}function _tt({dataTest:e,defaultValues:t,submitButton:n,fields:o,hooks:r=void 0}){const a=Dn({mode:"onBlur",defaultValues:t??{}});return s.jsx(On,{...a,children:s.jsxs("form",{"data-test":e,onSubmit:a.handleSubmit(i=>{const{fields:l,...c}=i;n.onSubmit(c)}),children:[o.map(({fieldId:i,title:l,required:c,...d})=>s.jsx(nr,{name:i,label:l,required:c,hasRequiredSymbol:!!c,...d},i)),s.jsx(Ttt,{onClick:()=>r?.beforeSubmit?.(a.getValues()),label:n.label})]})})}function btt(e){return e.reduce((t,n)=>({...t,[n.fieldId]:n.value??""}),{})}function xtt(e,t){return m9(e).filter(Rtt(Att(t)))}function Att(e){return e.filter(t=>t.isRequired).map(t=>t.fieldId)}function m9(e){return Object.keys(e).filter(t=>e[t]==="")}const Rtt=e=>t=>e.includes(t);function fU(e,t){if(e.isRequired)return{value:!0,message:t("validation.msg.required")}}function yU(e){const t=e.validations||[];if(t.length>1)throw Error("We don't support more than one regex validation per field right now");if(t.length===1)return{value:new RegExp(t[0].regex),message:t[0].errorMessage}}const Dtt=Object.freeze(["description","value","validations","isRequired"]);function Ott([e]){return!Dtt.includes(e)}function Ptt(e,t){const n=Object.entries(e).filter(Ott).reduce((o,[r,a])=>({...o,[r]:a}),{});return fU(e,t)&&(n.required=fU(e,t)),yU(e)&&(n.pattern=yU(e)),n}function Ntt(e,t){return t.filter(n=>{if(!n.isRequired||!n.validations||n.validations.length===0)return!1;const o=new RegExp(n.validations[0].regex),r=e[n.fieldId];return r&&!o.test(r)}).map(n=>n.fieldId)}function ac({formFields:e,dataTest:t,hooks:n=void 0,submitButton:o}){const r=L();return s.jsx(_tt,{dataTest:t,hooks:n,submitButton:o,defaultValues:btt(e),fields:e.map(a=>Ptt(a,r.formatMessage))})}ac.getRequiredEmptyValuesKeys=xtt;ac.getInvalidCharactersFields=Ntt;ac.getEmptyValuesKeys=m9;const Ltt=()=>s.jsx("div",{"data-test":"add-address-spinner",children:s.jsx("div",{className:"salt-m-t--16",children:s.jsx(_s,{size:"l"})})}),IU="logged.in.home.page.title",bt=({title:e=IU,meta:t="page.description",seoFriendlyMeta:n={metaDescriptionTagline:"",pageDescription:""},values:o={},skipFormatTitle:r=!1,tagline:a="page.tagline",pattern:i="page.title.pattern.with.separator"})=>{const l=L(),c=f(Zd)||"",d=l.formatMessage("page.title.separator"),u=l.formatMessage(i,{name:c,tagline:l.formatMessage(a),separator:l.formatMessage("page.title.separator"),title:r&&e!==IU?e:l.formatMessage(e,o)}),p=n.pageDescription&&n.metaDescriptionTagline?`${n.pageDescription}${d}${c}${d}${l.formatMessage(n.metaDescriptionTagline)}`:l.formatMessage(t);return s.jsxs(Gn,{children:[s.jsx("title",{children:u}),s.jsx("meta",{name:"description",content:p})]})},ktt=v(x)`
    position: absolute;
    inset-inline-start: var(--salt-spacing-2);

    @media (min-width: ${Ke.sm}em) {
        inset-inline-start: var(--salt-spacing-4);
    }
`;function sT({children:e,titleTextId:t,headingTextId:n,buttonTestId:o,onBack:r}){const a=typeof r=="function";return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:t}),s.jsx(sn,{children:s.jsxs(Q,{direction:"row",align:"center",children:[a&&s.jsx(ktt,{size:"s",intent:"tertiary",fill:!1,onClick:r,"data-test":o,children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsx(ee,{as:"h1",className:a?"salt-p-l--2 sm:salt-p-l--0":"",children:s.jsx(b,{id:n})})]})}),s.jsx(h.Fragment,{children:e})]})}const jtt="address-form-back";function h9({onBack:e,children:t}){const n=f($e(Rr)),o=f($e(hE));return s.jsx(sT,{titleTextId:"addresses.add-address.title",headingTextId:"addresses.add-address.heading",buttonTestId:jtt,onBack:e,children:n||o?s.jsx(h.Fragment,{children:t}):s.jsx(V,{className:"salt-m-y--16 salt-m-x--16",children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:t})})})}const Mtt="add-address-form";function HN({formFields:e,onSubmit:t,onBack:n}){const o=[Co.MANUAL_FORM,Co.UK_POSTCODE,Co.MANUAL_FORM_MAP,Co.INTERNATIONAL,Co.MANUAL_FORM_POSTCODE],r=Bs(),a=f(WE),i=f(D("mfm")),l=f(Gd);h.useEffect(()=>{(l?i:o.includes(a))&&r.addAddressModalDisplayed(a)},[]);const c=g=>{if(e==="NOT-READY")return;const E=ac.getInvalidCharactersFields(g,e),y=ac.getRequiredEmptyValuesKeys(g,e),I=ac.getEmptyValuesKeys(g),S={isAddressGeocoded:!1,missingMandatoryField:y.length>0,missingMandatoryFieldName:y,invalidCharacters:E.length>0};if(a===Co.MANUAL_FORM_MAP){const C={};I.forEach(T=>{C[T]=!0}),r.addAddressModalClosed(Rr,S.missingMandatoryField,C)}else(S.missingMandatoryField||S.invalidCharacters)&&r.formAddAddressButtonClicked(S)},d=()=>Array.isArray(e)&&e.length,u=()=>e.map(g=>({...g,disabled:g.isOn===!1})),p=()=>{if(e==="NOT-READY")return s.jsx(Ltt,{});if(d())return s.jsx(ac,{dataTest:Mtt,submitButton:{label:"addresses.add-address-button",onSubmit:t},formFields:u(),hooks:{beforeSubmit:c}});throw Ue.api.pushError(new Error("formFields from Backend is malformed"),{context:{formFields:JSON.stringify(e)}}),Error("Wrong or missing fields")};return s.jsx(h9,{onBack:n,children:p()})}const wtt=(e,t)=>e.find(n=>n.fieldId===t);function Ftt(e,t){return t&&Object.entries(t).forEach(([n,o])=>{const r=wtt(e,n);r&&(r.value=o)}),e}function Btt(e){const[t,n]=h.useState(!0),o=f(T5e);return h.useEffect(()=>{n(!1)},[]),o||t&&!e}function VN(e,t){const[n,o]=h.useState(),r=f(Rt),a=f(v5e),i=Btt(r),l=F(),c=u=>l(Cd.fetchNewAddressFields(u,t));return h.useEffect(()=>{r||c(e)},[e]),[i?"NOT-READY":Ftt(a,n),o]}const Utt=()=>f(Ar),nT=()=>f(zs),YE=()=>f(is),g9=e=>!e.isFetching&&(!e.lastUpdated||e.didInvalidate)&&!e.fetchError,Gtt=()=>{const e=y9(),t=f(ou),n=f(ru),o=F();return e||t?()=>{g9(n)&&o(hn.getCustomerCollectionDeliveryDestinations())}:()=>{}},E9=()=>{const e=f9(),t=f(Rl),n=F();return e?()=>{g9(t)&&n(hn.getHomeDeliveryDestinations())}:()=>{}},f9=()=>f(VR),y9=()=>f(QV),wc=()=>{const e=nT(),{deliveryDestinationId:t}=YE();return e.data?.deliveryDestinationId===t?e:{...e,data:void 0}},Rm=(e=!0,t=!1)=>{const n=F(),o=Ge(),r=f(xr),a=f(Gp),{pathname:i}=f(UC),l=f(At),c=fn({basePath:l});return({addressId:d,deliveryDestinationId:u,regionId:p})=>d3({addressId:d,deliveryDestinationId:u,regionId:p,customerId:r,visitorId:a},e,i,c,n,o,t)},$tt=()=>{const e=f(pm);return Utt()?e:!0},WN=()=>{const e=wc();return t=>t.deliveryDestinationId===e.data?.deliveryDestinationId},I9=e=>async t=>{try{const{payload:{responseData:n}}=await t(hn.getHomeDeliveryDestinations()),o=n.find(r=>r.addressId===e);return o?{addressId:e,...o}:null}catch(n){throw Z.error("request.error.title"),n}},YN={getHomeDeliveryDestinationIdByAddressId:I9,updateDeliveryDestination:d3};function qE(){const e=F(),t=f(Hp),n=f(p5e),o=Rm(!1);return async r=>{try{const a=await e(YN.getHomeDeliveryDestinationIdByAddressId(r));return a&&t&&n&&await o({addressId:a.addressId,deliveryDestinationId:a.deliveryDestinationId,regionId:a.resolvedRegionId}),a||{addressId:r}}catch{return{addressId:r}}}}const ot=()=>{const e=BN();return e&&(e.statusCode=404),s.jsx(V,{fixed:!0,className:"salt-m-y--16",children:s.jsx(V.Item,{colStart:{sm:3,md:4,lg:5},colSpan:{xs:12,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:"info_default",title:"not.found.page.title",titleAs:"h1",description:"not.found.page.subtitle",primaryButton:{text:"not.found.page.go.back.button.text",to:"/"}})})})},Htt={submitLabelId:m.string.isRequired,onSubmit:m.func.isRequired,onEdit:m.func,onCancel:m.func,defaultValues:m.shape({nickname:m.string,notes:m.string}),showAddressLine2:m.bool,showDeliveryInstructions:m.bool,addressLine2Label:m.string,isAddressLine2Required:m.bool},Vtt={defaultValues:{nickname:"",notes:""},onEdit:void 0,onCancel:void 0,showAddressLine2:!1,showDeliveryInstructions:!0,addressLine2Label:"address.form.field.apartmentNumber",isAddressLine2Required:!1},Eb=v(rr)`
    inline-size: 50%;
`;function oT({submitLabelId:e,onSubmit:t,onEdit:n,onCancel:o,defaultValues:r,showAddressLine2:a,showDeliveryInstructions:i,addressLine2Label:l,isAddressLine2Required:c=!1}){const[d,u]=h.useState(!1),p=Bs(),g=L(),E=f(WE)==="MANUAL_FORM_MAP",y=f(Up),I=f(A=>Ze(A,"validation-address-client-name-max-chars")),S=Dn({mode:"onBlur",defaultValues:r}),C=new RegExp(y),T=async()=>{await(async()=>{await S.trigger()})();const R=S.getValues("nickname"),P=S.getValues("notes"),N=ac.getEmptyValuesKeys(S.getValues());if(E){const k={};N.forEach(M=>{k[M]=!0}),p.saveAddressModalClosed("saveAddress",!R,k)}else p.saveAddressButtonClicked({missingMandatoryField:!R,addressNameFilled:!!R,isDeliveryInstructionsFilled:!!P,invalidFields:!S.formState.isValid})},_=A=>{d||(u(!0),t(A,()=>u(!1)))};return s.jsx(On,{...S,children:s.jsxs("form",{"data-test":"confirm-address-form",onSubmit:S.handleSubmit(_),children:[s.jsxs("div",{className:"salt-m-y--8",children:[a&&s.jsx(nr,{name:"addressLine2",label:g.formatMessage(l),placeholder:g.formatMessage(l),required:{value:c,message:g.formatMessage("validation.msg.required")},maxLength:I,pattern:{value:C,message:g.formatMessage("validation.form.restricted.chars")}}),s.jsx(nr,{name:"nickname",label:g.formatMessage("settings.address.book.add.modal.nickname.label"),placeholder:g.formatMessage("settings.address.book.add.modal.nickname.placeholder"),required:{value:!0,message:g.formatMessage("validation.msg.required")},maxLength:I,pattern:{value:C,message:g.formatMessage("validation.form.restricted.chars")}}),i&&s.jsx(nr,{name:"notes",label:g.formatMessage("settings.address.book.add.modal.notes.label"),placeholder:g.formatMessage("settings.address.book.add.modal.notes.placeholder"),maxLength:I,pattern:{value:C,message:g.formatMessage("validation.form.restricted.chars")}})]}),s.jsxs(Q,{justify:"space-between",align:"center",wrap:"nowrap",gap:["sm"],children:[n&&s.jsx(Eb,{children:s.jsx(x,{fill:!0,onClick:n,intent:"secondary","data-test":"address-edit-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.confirm-created-address-map.edit"})})})}),o&&s.jsx(Eb,{children:s.jsx(x,{fill:!0,onClick:o,intent:"secondary","data-test":"address-cancel-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.confirm-address.cancel"})})})}),s.jsx(Eb,{children:s.jsx(x,{type:"submit",fill:!0,onClick:T,intent:"primary","data-test":"address-submit-button",disabled:d,children:s.jsx(x.Text,{children:s.jsx(b,{id:e})})})})]})]})})}oT.propTypes=Htt;oT.defaultProps=Vtt;const Wtt=m.shape({formattedAddress:m.string,addressId:m.string,nickname:m.string,notes:m.string}),Ytt={addressDetails:Wtt},qtt="addresses.confirm-address.heading";S9.propTypes={children:m.element.isRequired};function S9({children:e}){const t=f($e(Rr));return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"addresses.confirm-address.title"}),s.jsx(sn,{children:s.jsx(ee,{as:"h1","data-test":qtt,children:s.jsx(b,{id:"addresses.confirm-address.heading"})})}),t&&s.jsx(h.Fragment,{children:e}),!t&&s.jsx(V,{className:"salt-m-y--16",children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:e})})]})}function Ktt({onClick:e}){const t=F();return s.jsx(x,{"data-test":"address-edit-button",intent:"secondary",fill:!0,onClick:()=>{t(U.analyticsEvent({type:ke.EDIT_ADDRESS_BUTTON_CLICKED})),e()},children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.confirm-address.edit"})})})}function C9({texts:{formattedAddress:e,additionalInformation:t}}){return s.jsxs("div",{className:"salt-m-y--4",children:[s.jsx(O,{bold:!0,children:s.jsx(b,{id:"addresses.confirm-address.selection.label"})}),s.jsx("div",{className:"salt-m-x--1 salt-m-y--1"}),s.jsx(O,{children:e}),t?s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-x--1 salt-m-y--1"}),s.jsx(O,{children:t})]}):null]})}const{addressDetails:ztt}=Ytt;function rT({submitLabelId:e,onSubmit:t,addressDetails:n,editButtonHandler:o}){const r=F(),a=Ge(),i=Bs(),l=f($e(Rr)),c=f(j6),d=!f(D("daddi")),{formattedAddress:u,nickname:p,notes:g,additionalInformation:E}=n,y=()=>{i.cancelButtonClicked("cancel button"),l?r(J.closeModal()):a(c)};return u?n?s.jsx(S9,{children:s.jsxs(h.Fragment,{children:[s.jsx(C9,{texts:{formattedAddress:u,additionalInformation:E}}),o&&s.jsx(Ktt,{onClick:o}),s.jsx(oT,{onCancel:y,onSubmit:t,defaultValues:{nickname:p,notes:g},submitLabelId:e,showDeliveryInstructions:d})]})}):s.jsx(ot,{}):s.jsx(_s,{})}rT.propTypes={onSubmit:m.func.isRequired,submitLabelId:m.string,addressDetails:ztt.isRequired,editButtonHandler:m.func};rT.defaultProps={submitLabelId:"addresses.confirm-address.heading.add",editButtonHandler:void 0};const v9=se("ADD_CUSTOMER_ADDRESS"),T9=se("ADD_CUSTOMER_ADDRESS_WITH_POSTCODE_UPDATE"),_9=se("ADD_VALIDATED_CUSTOMER_ADDRESS"),b9=({id:e,details:t,nickname:n,notes:o,formattedAddress:r},a=v9)=>({type:"API",payload:{url:"/v4/accounts/current/addresses",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{method:"POST",body:{id:e,additionalInformation:t||"",nickname:n,notes:o,primary:!0,formattedAddress:r}},...a}}),Qtt=({id:e,details:t,nickname:n,notes:o,postcode:r,formattedAddress:a})=>({type:"API",payload:{url:"/v4/accounts/current/addresses",service:"web_customer_ws",pathPrefix:{client:"/api/customer",server:"/core-api"},options:{method:"POST",body:{id:e,additionalInformation:t,nickname:n,notes:o,primary:!0,postcode:r,formattedAddress:a}},...T9}}),Xtt=({id:e,nickname:t,notes:n,additionalInformation:o,formattedAddress:r})=>b9({id:e,nickname:t,notes:n,details:o,formattedAddress:r},_9),qN={types:{ADD_CUSTOMER_ADDRESS:v9,ADD_CUSTOMER_ADDRESS_WITH_POSTCODE_UPDATE:T9,ADD_VALIDATED_CUSTOMER_ADDRESS:_9},addAddress:b9,addAddressWithPostcodeUpdate:Qtt,addValidatedAddress:Xtt},Ztt=e=>t=>t(qN.addAddress(e)).then(n=>n.payload.responseData.addressId).catch(n=>{throw Z.error("request.error.title"),new Error(n)}),Jtt=e=>t=>t(qN.addAddressWithPostcodeUpdate(e)).then(n=>n.payload.responseData.addressId).catch(n=>{throw Z.error("request.error.title"),new Error(n)}),est=({id:e,nickname:t,notes:n,additionalInformation:o,formattedAddress:r})=>a=>a(qN.addValidatedAddress({id:e,nickname:t,notes:n,additionalInformation:o,formattedAddress:r})).then(i=>i.payload.responseData.addressId).catch(i=>{throw Z.error("request.error.title"),new Error(i)}),IS={addCustomerAddress:Ztt,addCustomerAddressWithPostcodeUpdate:Jtt,addValidatedAddress:est},x9=({onEdit:e,onConfirm:t})=>{const n=Bs(),o=F(),r=Ge(),a=f(g5e),i=qE(),l=f(D("mfm")),c=f(j6),d=u=>{o(IS.addValidatedAddress({id:a.id,nickname:u.nickname,notes:u.notes,additionalInformation:a.additionalInformation,formattedAddress:a.formattedAddress})).then(p=>i(p)).then(()=>{l||r(c)}),n.addAddressSuccess(),t&&t()};return s.jsx(rT,{editButtonHandler:e,addressDetails:a,onSubmit:d})};x9.defaultProps={onConfirm:()=>{}};const tst="addresses-postcode-input",sst="addresses-find-button",A9=({onChange:e,onSubmit:t,isButtonFullWidth:n=!1,postCodeRegExp:o=/^[A-Za-z0-9 ]*$/g,initialValues:r={postcode:""},sendAnalytics:a})=>{const i=Dn({defaultValues:r,mode:"all"}),l=L(),c=h.useMemo(()=>({value:!0,message:l.formatMessage("settings.address.postcode.required.error.a11y")}),[l]),d=h.useMemo(()=>{const y=l.formatMessage("settings.address.book.add.modal.postcode.error");return{value:o,message:y}},[l,o]),u=l.formatMessage("settings.address.book.add.modal.postcode.label"),p=l.formatMessage("settings.address.book.add.modal.postcode.placeholder"),g=l.formatMessage("settings.address.book.add.modal.postcode.placeholder.aria.label"),E=y=>{let I=!1;return i.handleSubmit(S=>{I=!0,t(S)})(y).then(()=>{if(!I){const S={postCodeUndeliverable:!1,postCodeNotFound:!1,postCodeInvalidCharacters:!0};a.findAddressButtonClicked(S)}})};return s.jsx(On,{...i,children:s.jsxs("form",{onChange:e,onSubmit:E,children:[s.jsx(nr,{name:"postcode",label:u,"data-test":tst,"data-pii":"true",hasRequiredSymbol:!1,placeholder:p,"aria-label":g,required:c,pattern:d,maxLength:10}),s.jsx(_a,{children:s.jsx(x,{fill:n,intent:"primary",type:"submit","data-test":sst,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.add.modal.find.button"})})})})]})})},KN=(e,t)=>(n=" ")=>n.match(e)?void 0:t,aT=e=>t=>t.replace(/\s/g,"").length>0?void 0:e,zN=()=>{const e=L(),t=f(Up),n=f(r=>Ze(r,"validation-address-client-name-max-chars")),o=h.useMemo(()=>({label:e.formatMessage("settings.address.book.add.modal.nickname.label"),placeholder:e.formatMessage("settings.address.book.add.modal.nickname.placeholder"),requiredMessage:e.formatMessage("settings.address.addressName.required.error.a11y"),restrictedCharsMessage:e.formatMessage("validation.form.restricted.chars")}),[]);return s.jsx(nr,{name:"nickname",label:o.label,"data-test":"addresses-nickname-input","data-pii":"true","aria-live":"polite",placeholder:o.placeholder,"aria-label":o.label,required:{value:!0,message:o.requiredMessage},hasRequiredSymbol:!0,validate:{notWhiteSpace:aT(o.requiredMessage),validateAgainstMask:KN(t,o.restrictedCharsMessage)},maxLength:n})},iT=({name:e="notes",label:t="settings.address.book.add.modal.notes.label",ariaLabel:n,formattedPlaceholder:o,required:r=!1,requiredMessage:a,maxLength:i})=>{const{formatMessage:l}=L(),c=f(Up),d=f(g=>Ze(g,"validation-address-client-instructions-max-chars")),u=i||d,p={notesLabel:l(t),ariaLabel:n||l(t),notesPlaceholder:o!==void 0?o:l("settings.address.book.add.modal.notes.placeholder"),restrictedCharsMessage:l("validation.form.restricted.chars"),required:a?l(a):""};return s.jsx(nr,{name:e,label:p.notesLabel,"data-test":"addresses-notes-input","data-pii":"true",hasRequiredSymbol:r,placeholder:p.notesPlaceholder,"aria-label":p.ariaLabel,required:{value:r,message:p.required},validate:{...r?{notWhiteSpace:aT(p.required)}:{},validateAgainstMask:KN(c,p.restrictedCharsMessage)},maxLength:u})},nst=e=>e?.map(({formattedAddress:t,id:n})=>({value:n,label:t}))??[],ost=({addresses:e,handleSubmit:t,sendAnalytics:n})=>{const o=L(),r=po(),a=!f(D("daddi")),i=r.getValues()?.id,l=h.useMemo(()=>nst(e),[e]),c=h.useMemo(()=>({placeholder:o.formatMessage("settings.address.book.add.modal.select.address.placeholder"),label:o.formatMessage("settings.address.book.add.modal.select.address.label"),required:o.formatMessage("settings.address.full.required.error.a11y")}),[]);if(!e?.length)return null;const d=()=>{n.addressDropdownOpened()},u=()=>{n.dropdownAddressSelected({}),n.addressLookupAddressSelected()};return s.jsxs("form",{onSubmit:r.handleSubmit(t),children:[s.jsx(Am,{name:"id",placeholder:c.placeholder,label:c.label,required:{value:!0,message:c.required},onFocus:d,onChangeCallback:u,options:l,"data-test":"addresses-list-select"}),i&&s.jsxs(h.Fragment,{children:[s.jsx(zN,{}),a&&s.jsx(iT,{})]}),s.jsx("input",{type:"submit",hidden:!0})]})},R9=se("VALIDATE_ADDRESS"),D9=se("ADDRESS_LOOKUP"),O9=se("ADDRESS_LOOKUP_BY_POSTCODE"),P9=se("ADDRESS_LOOKUP_BY_SEARCH_TERM"),N9=se("ADDRESS_LOOKUP_BY_COORDINATES"),rst=e=>({type:"API",payload:{url:"/v1/addresses/areas",service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{headers:{"content-type":"application/x-www-form-urlencoded"},method:"PUT",body:Qe.stringify({query:e})},...R9}}),ast=(e,t,n)=>({type:"API",payload:{url:`/v3/address-lookup?countryCode=${t}&limit=${n}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",body:e},...D9}}),ist=(e,t)=>({type:"API",payload:{url:`/v3/address-lookup/by-postcode?countryCode=${t}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",body:{postcode:e}},...O9}}),lst=(e,t,n,o)=>{const r=new URLSearchParams;return t&&r.append("countryCode",t),n&&r.append("pageToken",n),o&&r.append("maxPageSize",o.toString()),{type:"API",payload:{url:`/v3/address-lookup/by-search-term${r.toString()?`?${r.toString()}`:""}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",body:{query:e}},...P9}}},cst=(e,t,n)=>({type:"API",payload:{url:`/v3/address-lookup/by-coordinates?countryCode=${t}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",headers:{visitorid:n,"visitor-id":n},body:e},...N9}}),KE={types:{FETCH_LOOKUP_AREAS:R9,ADDRESS_LOOKUP:D9,ADDRESS_LOOKUP_BY_POSTCODE:O9,ADDRESS_LOOKUP_BY_SEARCH_TERM:P9,ADDRESS_LOOKUP_BY_COORDINATES:N9},fetchLookupAreas:rst,addressLookup:ast,addressLookupByPostcode:ist,addressLookupBySearchTerm:lst,addressLookupByCoordinates:cst},dst=e=>t=>t(KE.fetchLookupAreas(e)).then(n=>n.payload.responseData),ust=(e,t,n)=>o=>o(KE.addressLookup(e,t,n)).then(r=>r.payload.responseData),pst=(e,t)=>n=>n(KE.addressLookupByPostcode(e,t)).then(o=>o.payload.responseData),mst=(e,t,n,o)=>r=>r(KE.addressLookupBySearchTerm(e,t,n,o)).then(a=>a.payload.responseData),hst=(e,t,n)=>o=>o(KE.addressLookupByCoordinates(e,t,n)).then(r=>r.payload.responseData),QN={addressLookup:ust,addressLookupByPostcode:pst,addressLookupBySearchTerm:mst};function gst({setAreaLookupId:e,setVisibleComponent:t}){const n=Bs(),o=F(),r=f(_R);h.useEffect(()=>{n.addressPostCode()},[]);const a=({postcode:i})=>{const l={postCodeUndeliverable:!1,postCodeNotFound:!1,postCodeInvalidCharacters:!1};dst(i)(o).then(c=>{if(c.length===0){n.addressLookupAddressNotFound();const u="settings.addresses.alert.no.areas.found";return n.toastNotificationDisplayed({message:u,messageId:"address_error"}),Z.error(u)}n.findAddressButtonClicked(l);const d=c[0].id;return e(d),t("FORM")}).catch(c=>{const d=c.statusCode===404?"settings.addresses.alert.no.areas.found":"toast.notification.generic.error";l.postCodeUndeliverable=c.statusCode===400,l.postCodeNotFound=c.statusCode===404,c.statusCode===404&&n.addressLookupAddressNotFound(),n.findAddressButtonClicked(l),n.toastNotificationDisplayed({message:d,messageId:"address_error"}),Z.error(d)})};return s.jsx(h9,{children:s.jsx(A9,{onSubmit:a,postCodeRegExp:new RegExp(r),isButtonFullWidth:!0,sendAnalytics:n})})}const L9=({actions:e,onSubmit:t,onConfirm:n})=>{const o=f(WE)===Co.MANUAL_FORM_POSTCODE,r=Bs(),[a,i]=h.useState(""),[l,c]=VN(a),{validateAddress:d,fetchDetailsForAddress:u}=e,[p,g]=h.useState(o?"LOOKUP":"FORM"),E=y=>{t(y,{validateAddress:d,sendAnalytics:r,setVisibleComponent:g,fetchDetailsForAddress:u}),c(y)};switch(p){case"LOOKUP":return s.jsx(gst,{setVisibleComponent:g,setAreaLookupId:i});case"CONFIRMATION_FORM":return s.jsx(x9,{onEdit:()=>g("FORM"),onConfirm:n});case"FORM":default:return s.jsx(HN,{formFields:l,onSubmit:E})}};L9.defaultProps={onSubmit:Ctt,onConfirm:()=>{}};const k9=e=>s.jsx(Et,{type:"AddAddress::route",children:s.jsx(L9,{...e})});k9.fetchData=({store:e})=>e.dispatch(Cd.fetchNewAddressFields());const Est=st({analyticsEvent:U.analyticsEvent,validateAddress:dtt.validateAddress,fetchDetailsForAddress:Ap.fetchDetailsForAddress}),j9=we(null,Est)(k9),M9={routes:{createEditUrl:e=>SAe.replace(`:${YI}`,e)},params:{route:{CUSTOMER_ADDRESS_ID:YI}}},{analyticsEvent:fst}=U;function yst(){return{customerAddressId:nn()[YI]}}const Ist=(e,{dispatch:t})=>t(fst({type:ke.ADDRESS_IMPRESSION,addressesImpression:e}));function Sst(e){const t=F(),n=f(Gd);h.useEffect(()=>{n&&e.length&&Ist(e,{dispatch:t})},[JSON.stringify(e)])}const Cst=({actions:e,isServerRendered:t,addressDetails:n})=>{const{customerAddressId:o}=yst(),r=Ge();return h.useEffect(()=>{if(!t){const{fetchCustomerAddressDetails:a}=e;a(o)}},[]),s.jsx(rT,{submitLabelId:"addresses.confirm-address.heading.update",addressDetails:n,onSubmit:({nickname:a,notes:i})=>{e.updateCustomerAddress({id:o,nickname:a,notes:i}).catch(()=>{const l={event:"event",eventCategory:"Settings",eventAction:"UPDATE_CUSTOMER_ADDRESS_SUCCESS",eventLabel:"Not Set"};te.sendEvent({GA:l,WA:null}),Z.error("request.error.title")}).then(()=>{const l={event:"event",eventCategory:"Settings",eventAction:"UPDATE_CUSTOMER_ADDRESS_ERROR",eventLabel:"Not Set"};te.sendEvent({GA:l,WA:null}),r(Xa())})}})},w9=e=>s.jsx(Et,{type:"EditAddress::route",children:s.jsx(Cst,{...e})});w9.fetchData=({store:e,params:t})=>{const{CUSTOMER_ADDRESS_ID:n}=M9.params.route;e.dispatch(Rh.fetchCustomerAddressDetails(t[n]))};const vst=e=>({isServerRendered:Rt(e),addressDetails:I5e(e)}),Tst=st({fetchCustomerAddressDetails:Rh.fetchCustomerAddressDetails,updateCustomerAddress:wI.updateCustomerAddress}),_st=we(vst,Tst)(w9),bst=(e,t)=>t.map(({condition:n,failComponent:o})=>({meetsCondition:n(e),failComponent:o})),SU=(e,t)=>bst(e,t).filter(n=>!n.meetsCondition),Ic=(e,t)=>{const n={failedConditions:m.arrayOf(m.shape({condition:m.func,failComponent:m.func}))},o={failedConditions:[]};function r({failedConditions:i,...l}){const c=i.length?i[0].failComponent:t;return c?s.jsx(c,{...l}):null}return r.propTypes=n,r.defaultProps=o,r.fetchData=i=>{const l=SU(i.store.getState(),e);let c=l.length?l[0].failComponent:t;return c.WrappedComponent&&(c=c.WrappedComponent),c.fetchData?c.fetchData(i):null},we(i=>({failedConditions:SU(i,e)}))(r)},xst=(e,{isUserLoggedIn:t=Xe}={})=>[{path:"/addresses/add-address",Component:$s(t,e.Main),children:[{index:!0,Component:Ic([{condition:n=>Gd(n),failComponent:ot}],j9)}]},{path:"/addresses/confirm-address/:customerAddressId",Component:$s(t,e.Main),children:[{index:!0,Component:Ic([{condition:n=>Gd(n),failComponent:ot}],_st)}]}],F9=D("di"),B9=e=>(t,n)=>{const o=n(),r=Hn(o)??[];return t(Ua.getAlternatives(e)).then(a=>{if(a){const{responseData:i}=a.payload;t(Ua.setActiveAlternatives(e));const l=i?.alternatives?.reduce((d,u)=>({...d,[u.productId]:si(u,r,F9(o))}),{});t(xt.setProducts({product:l}));const{missedPromotions:c}=i?.result||{};c?.length&&t(fo.addMissedPromotions(c))}})},Ast=(e,t,n)=>(o,r)=>{const a=r(),i=Hn(a)??[];return o(Ua.getAlternativesV2(t,n)).then(l=>{if(l){const{responseData:c}=l.payload;o(Ua.setActiveAlternatives(e));const d=c.alternatives.reduce((p,g)=>({...p,[g.productId]:si(g,i,F9(a))}),{});o(xt.setProducts({product:d}));const u=c.missedPromotions||{};u?.length&&o(fo.addMissedPromotions(u))}}).catch(()=>!1)},CU=e=>{switch(e){case"xs":return"var(--salt-spacing-1)";case"sm":return"var(--salt-spacing-2)";case"md":return"var(--salt-spacing-4)";case"lg":return"var(--salt-spacing-8)";case"xl":return"var(--salt-spacing-16)";default:return"unset"}},U9=v.div`
    display: grid;
    position: relative;
    gap: ${({mobileGap:e})=>CU(e)};

    ${re.smUp`
         grid-template-columns: repeat(auto-fill, minmax(${$(184)}, 1fr));
         gap: ${({gap:e})=>CU(e)};
    `}
`,G9=v.div`
    display: grid;

    &.aligned-right {
        ${({indexOnSmallScreen:e=3})=>`grid-row: ${e+1};`}
    }

    ${re.smUp`
        grid-column: span 2;
        ${({rowIndex:e=1})=>`grid-row: ${e};`}

        &.aligned-right {
            ${({rowIndex:e=1})=>`grid-row: ${e};`}
            grid-column-end: -1;
        }

        &:empty {
            display: none;
        }
    }
 `}
`,XN=({page:e,product:t,productId:n})=>f(r=>e==="regulars"?n?kye(r,n):t:n?Da(r,n):t),Fs={Portrait:"portrait",Landscape:"landscape",Default:"default"},ZN=h.createContext(null),ss=()=>{const e=h.useContext(ZN);if(e)return e;throw new Error("Fop components must be used within FopDataProvider boundary")},Rst=({page:e,product:t,overrideConfig:n={},children:o,displayLandscapeLayout:r,inViewRef:a,sendFopImpression:i,...l})=>{const[c,d]=h.useState(!1),u=h.useCallback(()=>{d(!0)},[]),{ref:p,inView:g}=nC({triggerOnce:!0,threshold:.5}),E=h.useCallback(A=>{p(A),a&&a(A)},[a]),{currentBreakpoint:y}=h.useContext(kn),I=typeof r<"u"?r:y==="xs",{fop:S}=VE(),C=h.useMemo(()=>r===!0?Fs.Landscape:r===!1?Fs.Portrait:Fs.Default,[r]),T=h.useMemo(()=>S?mR({},S,n):null,[S,n]),_=h.useMemo(()=>({page:e,config:T,product:t,displayLandscapeLayout:I,ref:E,hasBeenViewed:g,layoutType:C,sendFopImpression:i&&!c,updateHasSentImpression:u,...l}),[e,T,t,I,l,c,i]);return s.jsx(ZN.Provider,{value:_,children:o})},lT=uv("configurable-fop:data-provider",s.jsx(_e,{height:"100%",width:"100%"}))(Rst),Dst=({page:e,product:t,overrideConfig:n={},children:o,displayLandscapeLayout:r,sendFopImpression:a,...i})=>{const l=h.useRef(null),[c,d]=h.useState(!1),u=h.useCallback(()=>{d(!0)},[]),{currentBreakpoint:p}=h.useContext(kn),g=typeof r<"u"?r:p==="xs",{fop:E}=VE(),y=h.useMemo(()=>r===!0?Fs.Landscape:r===!1?Fs.Portrait:Fs.Default,[r]),I=h.useMemo(()=>E?mR({},E,n):null,[E,n]),S=h.useMemo(()=>({page:e,config:I,product:t,displayLandscapeLayout:g,ref:l,hasBeenViewed:!1,layoutType:y,sendFopImpression:a&&!c,updateHasSentImpression:u,...i}),[e,I,t,g,i,c,a]);return s.jsx(ZN.Provider,{value:S,children:o})},Ost=uv("configurable-fop:old-data-provider",s.jsx(_e,{height:"100%",width:"100%"}))(Dst),Ee=e=>{const t=f(Kg);return e.map(n=>t.includes(n))},Pst=v.div.attrs({inert:""})`
    filter: blur(5px);
    pointer-events: none;
    user-select: none;
`,vU=v.div`
    position: relative;

    .blur > * {
        filter: blur(5px);
        pointer-events: none;
        user-select: none;
    }
`,TU=v.div`
    display: flex;
    position: absolute;
    z-index: 3;
    inline-size: 100%;
    block-size: 100%;
`,Ji=({children:e,isActive:t,overlay:n,verificationRequired:o})=>{const r=f(HQ),[a,i]=Ee(["alc.blur","age.vis"]),d=a&&t&&!r||i&&o;if(typeof e=="function"){if(!d)return s.jsx(h.Fragment,{children:e({})});const u={blurClassName:"blur",aria:{"aria-hidden":!0,inert:""}};return s.jsxs(vU,{children:[n&&s.jsx(TU,{children:n}),e(u)]})}return d?s.jsxs(vU,{children:[n&&s.jsx(TU,{children:n}),s.jsx(Pst,{"aria-hidden":!0,children:e})]}):s.jsx(h.Fragment,{children:e})},ft=()=>{const e=F();return n=>{e(U.analyticsEvent(n))}},$9=({data:e},t)=>e.products.missedPromotions.find(n=>n.promoId===t),H9=(e,t,n)=>Y($9,o=>o?.counters.find(r=>r.productIds.includes(n)))(e,t),Nst=(e,t,n)=>Y(H9,o=>o?.productIds||[])(e,t,n),Lst=(e,t,n)=>Y(H9,o=>o?.requiredProductQuantity||0)(e,t,n),kst=(e,t)=>Y(xc,n=>n.reduce((o,{quantity:r,productId:a})=>t.includes(a)?o+r.quantityInBasket:o,0))(e),JN=(e,t,n)=>Y($9,o=>{if(!o)return;const r=o.countBy==="ALL_PRODUCTS"?Nst(e,t,n):[n];return{basketQuantity:kst(e,r),requiredQuantity:Lst(e,t,n)}})(e,t);function jst(){const{product:{productId:e,offer:t}}=ss(),n=f(D("fop.mp")),o=f(p=>t?JN(p,t.id,e):void 0,rp),r=o?.basketQuantity,a=o?.requiredQuantity;if(!n||!r||!a)return null;const i=r%a||a,l=a-i,c=t?.description,d=l===0?"PromotionComplete":"PromotionIncomplete";return{id:t?.id,missedPromotionProductsRequired:a,missedPromotionProductsInBasket:i,missedPromotionText:c,missedPromotionMessageType:d}}const Mst=e=>({type:Jt.GA_IMPRESSION,payload:{...e}}),wst=e=>({type:Jt.GA_BATCH_IMPRESSION,payload:{...e}}),Fst=e=>({type:Jt.GA_PRODUCT_CLICK,payload:{...e}}),Bst=e=>({type:Jt.GA4_PRODUCT_CLICK,payload:{...e}}),Rp={makeImpression:Mst,makeBatchImpression:wst,productClickGAEvent:Fst,productClickGa4Event:Bst},Ust=e=>({type:Jt.FOP_CLICKED,payload:{...e}}),Gst={fopClickEvent:Ust},$st=(e,t)=>{switch(t){case"WEIGHT":return e("fop.price.per.100gram",{price:""});case"CAPACITY":return e("fop.price.per.100ml",{price:""});case"LENGTH":return e("fop.price.per.meter",{price:""});case"EACH":return e("fop.price.per.each",{price:""});case"DOSE":return e("fop.price.per.dose",{price:""});default:return""}},Hst=(e,t,n)=>{if(e.type===Ut.CLUSTER)return"";if(e.type===Ut.GROUP&&t==="regulars")return n("fop.group.title.suggested");const o=DC.includes(e.type)?"other":e.type;if(e.unitOfMeasureGroup!==void 0){const r=$st(n,e.unitOfMeasureGroup);return`${n(`fop.group.title.${o}`)} - ${r}`}return n(`fop.group.title.${o}`)},V9=(e,t,n)=>{const o=e.clusterBreadcrumbs?.at(-1);return o?o.name:(e.type===Ut.GROUP&&t==="regulars"&&n("fop.group.title.suggested"),n(`fop.group.title.${e.type}`))},_U=(e,t,n,o)=>{let r=t.type;const a=V9(t,n,o),i=t.clusterBreadcrumbs?.at(-1);return i?r=i.id:DC.includes(t.type)&&(r="other"),{categoryId:r,clusterName:a,level:t.clusterBreadcrumbs?t.clusterBreadcrumbs.length:0,productClusterSequence:t.products&&t.products.indexOf(e.productId)}},Vst=(e,t)=>{const n=t?[t,...e]:[...e];return n.length>0?n.map(r=>r.name).join(" > "):null},eL=()=>{const e=F(),t=f(au),n=f(Nn),o=f(Ct),r=f(A2),a=ft(),i=jst(),{formatMessage:l}=L(),[c]=Ee(["cxe.by"]),{product:d,hasBeenViewed:u,group:p,page:g,subPage:E,fopPositionOnPage:y,sendFopImpression:I,rootBreadcrumb:S,pageEventId:C,customAnalyticsData:T,updateHasSentImpression:_}=ss(),A=Vst(t,S);return{sendFopProductLinkEvent:()=>{const{name:k,retailerProductId:M,price:w}=d,{current:{amount:j,currency:G}}=w||{current:{amount:"",currency:""}},W=ks(g,E,p.section),H=Vn(d,p.featuredProductCampaigns);e(Rp.productClickGAEvent({productName:k,productId:M,productPrice:j,productPosition:y,currencyCode:G,productListName:W}));const K={eventLabel:M,ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"product_click",event:"productClick",ecommerce:{currencyCode:G,click:{actionField:{list:W},products:[{name:k,id:M,price:j,position:y}]}}};te.sendEvent({GA:K,WA:null}),e(Rp.productClickGa4Event({product:d,position:y,page:g,productListName:W}));const X={event:"select_item",ecommerce:{currency:G,items:[Zp({product:d,position:y,productListName:W,page:g,featuredProductCampaign:H})]}};te.sendEvent({GA:X,WA:null})},sendFopImpressionEvent:()=>{if(u&&I){const k=Vn(d,p.featuredProductCampaigns);a({type:Jt.QUEUE_PRODUCT_IMPRESSION,group:p,page:g,productListName:ks(g,E,p.section),pageEventId:C||ct(),sequence:y,position:y,product:d,rankingScore:g==="search"?r[d.productId]:null,cluster:_U(d,p,g,l),groupType:p.type,orderId:o,pageViewId:n,missedPromotion:i,category:A,customAnalyticsData:T}),te.queueProductImpressionEvent({GA:{group:p,page:g,productListName:ks(g,E,p.section),pageEventId:C||ct(),sequence:y,position:y,product:d,rankingScore:g==="search"?r[d.productId]:null,cluster:_U(d,p,g,l),groupType:p.type,orderId:o,pageViewId:n,missedPromotion:i,category:A,customAnalyticsData:T,isPersonalised:p&&p.type===Ut.PERSONALIZED,featuredProductCampaign:k},WA:null}),_()}},onFopContainerClick:()=>{const k=d.featuredProductCampaign?.externalAdvertId,M={productId:d.productId,sequence:y,...k?{advertId:k}:{}};e(Gst.fopClickEvent({description:"User clicked on a FOP",pageEventAttributes:M})),MI(g,d,p.type)&&e(L2([d],c))}}},zE=(e="")=>`${e}/coupons`,QE=(e,t,{basePath:n="",queryString:o=""}={})=>{const r=o?`?${o}`:"";return`${zE(n)}/${t}/${e}${r}`},bU={DELIVERY:"home_delivery",LOYALTY:"loyalty",OFFER:"promotion",COUPON:"coupons",APPLIED_PROMO:"status_yes",FREE_GIFT:"free_gift",PAYMENT_PROMOTION:"payment_card"},XE=e=>bU[e]||bU.OFFER,cT=e=>{const t=f(D("fop.cpn")),o=f(is)?.limitedPromotionIds,r=f(l=>l.data.basket.items.some(c=>c.productId===e.productId)),a=l=>{const c=l.type==="COUPON",d=!!(c&&e.basketLines?.some(g=>g.appliedPromoIds.includes(l.id))&&r),u=d||!o?.includes(l.id);return{shouldShowPromotion:t&&c?u:!0,shouldShowCoupon:u,isCouponApplied:d,isCoupon:c,isFopCouponsEnabled:t}};return{validatePromotion:a,shouldShowUnavailablePromotion:l=>{if(!l.limitReached||l.type==="FREE_GIFT")return!0;const p=a(l);return p.isCoupon?r?!!p.isCouponApplied:typeof o>"u"?!1:!o.includes(l.id):!1}}},W9=v(Ye)`
    font-size: inherit;
    color: ${({presentationMode:e,isCoupon:t})=>t?"var(--coupon-style, var(--typography-promotion))":e==="MUTE_STYLE"?"var(--intent-content)":"var(--typography-promotion)"};
    text-decoration: none;

    &:hover {
        text-decoration: underline;
    }
`,Y9=v(O)`
    font-weight: ${({presentationMode:e})=>e==="MUTE_STYLE"?"bold":"normal"};
    color: ${({presentationMode:e,isCoupon:t})=>t?"var(--coupon-style, var(--typography-promotion))":e==="MUTE_STYLE"?"var(--intent-content)":"var(--typography-promotion)"};
    text-decoration: none;
    ${({isConfigurable:e})=>!e&&Pe`
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: block-axis;
        `}
`,_g=v(O)`
    color: ${({isOffer:e,presentationMode:t})=>t==="MUTE_STYLE"||!e?"var(--intent-content)":"var(--typography-promotion)"};

    ${({isSingleLine:e})=>e&&Pe`
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: block-axis;
        `}
`,uA=e=>`calc(
            var(--salt-text-${e}-line-height) * var(--salt-text-${e}-font-size)
        )`,q9=v(pe)`
    ${({isCoupon:e,isCouponApplied:t})=>{let n="";return e&&(t?n="var(--intent-success-900)":n="var(--coupon-style, var(--typography-promotion))"),`
            fill: ${n};
        `}}
`,Wst=({offer:e,isOfferLink:t,url:n,sendAnalytics:o})=>{const{product:r,config:a,displayLandscapeLayout:i}=ss(),{isInCurrentCatalog:l}=r,{formatMessage:c}=L(),{validatePromotion:d}=cT(r),{isCouponApplied:u,isCoupon:p,isFopCouponsEnabled:g}=d(e),E=XE(u?"APPLIED_PROMO":e.type),y=(_,A)=>{const R=s.jsxs(Y9,{"data-test":"fop-offer-text",presentationMode:e.presentationMode,isConfigurable:!!a,size:_,intent:e.presentationMode==="MUTE_STYLE"?void 0:"promotion","aria-hidden":!0,isCoupon:g&&p,children:[A&&s.jsx(q9,{name:E,height:uA(_),width:uA(_),verticalAlign:"bottom","data-test":"fop-offer-icon",success:u,className:"salt-m-r--1",isCoupon:g&&p,isCouponApplied:u}),e.description]});return l&&t?s.jsxs(W9,{to:n,presentationMode:e.presentationMode,onClick:()=>o(),isCoupon:g&&p,children:[R,s.jsx(ie,{children:c("fop.standard.promotion.accessibility.text",{offerMessage:e.description})})]}):R};if(!a)return y("m",!0);const{landscape:{promotion:I},portrait:{promotion:S}}=a,C=!i&&Es(S?.fontSize),T=i&&Es(I?.fontSize);return T?y(T,I?.icon||u):C?y(C,S?.icon||u):null},Yst=v(Ye).withConfig({shouldForwardProp:e=>!["numberOfLines","fontSize","presentationMode"].includes(String(e))})`
    display: flex;
    align-items: center;
    block-size: ${({numberOfLines:e,fontSize:t})=>`calc(${e} * var(--salt-text-${t}-line-height) * var(--salt-text-${t}-font-size))`};
    color: ${({presentationMode:e})=>e==="MUTE_STYLE"?"var(--intent-content)":"var(--typography-promotion, var(--intent-promotion))"};
    text-decoration: none;

    &:hover {
        text-decoration: underline;
    }
`,qst=v(O).withConfig({shouldForwardProp:e=>!["numberOfLines","presentationMode"].includes(String(e))})`
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: ${({numberOfLines:e})=>e};
    -webkit-box-orient: block-axis;
    overflow: hidden;
    color: ${({presentationMode:e})=>e==="MUTE_STYLE"?"var(--intent-content)":"var(--typography-promotion, var(--intent-promotion))"};
`,fb=30,{getPercentageFromFractionString:Kst}=ra,zst=Fi`
  from {transform: translateY(100%); opacity: 0;}
  to {transform: translateY(0); opacity: 1}`,Qst=Fi`
  from {transform: translateY(0); opacity: 1}
  to {transform: translateY(100%); opacity: 0;}`,Xst=v.div`
    border-radius: var(--salt-radius-default);
    background-color: var(--intent-contrast-500);
    inline-size: fit-content;
    block-size: 100%;
    align-items: center;
    overflow: hidden;
    padding: var(--salt-spacing-1);
    gap: var(--salt-spacing-1);
    animation-name: ${({isDisplayed:e})=>e?zst:Qst};
    animation-duration: 0.3s;
`,Zst=v(Xst)`
    ${({fullWidth:e})=>e&&"width: 100%;"}
`,Jst=({productId:e,offer:t,isDisplayed:n,onAnimationEnd:o,url:r,sendAnalytics:a,missedPromotionQuantities:i,fullWidth:l=!0})=>{const{formatMessage:c}=L(),d=F(),u=f(Ct),{config:p,displayLandscapeLayout:g}=ss();h.useEffect(()=>{t&&P()},[i.basketQuantity]);const{basketQuantity:E,requiredQuantity:y}=i,I=E%y||y,S=y-I,C=S===0&&E>0,T=t.description,_=C?"":`${I}/${y}`,R=C?E>0?c("fop.added.missed.promotion.complete.text.alternative",{quantity:E,offerMessage:T}):c("fop.not.added.missed.promotion.complete.text.alternative",{offerMessage:T}):E>0?c("fop.added.missed.promotion.not.complete.text.alternative",{quantity:E,offerMessage:T,basketQuantity:E,requiredQuantity:y}):c("fop.not.added.missed.promotion.not.complete.text.alternative",{offerMessage:T,basketQuantity:E,requiredQuantity:y}),P=()=>{const k={id:t.id,requiredProductQuantity:y,addedProductQuantity:I,toAddProductQuantity:S,missedPromotionText:t.description,missedPromomotionTextAlternative:R,missedPromotionTextType:S===0?"PromotionComplete":"PromotionIncomplete"};d(U.analyticsEvent({type:Jt.MESSAGE_ALERT_DISPLAYED,orderId:u,missedPromotion:k,productId:e,missedPromotionType:t.type}))},N=(k=2,M="m")=>s.jsxs(Zst,{fullWidth:l,maxHeight:k,className:"salt-d--flex",isDisplayed:n,onAnimationEnd:o,"data-retailer-anchor":"fop-missed-promotion",children:[C?s.jsx(pe,{name:"status_yes",height:fb,width:fb,fill:"var(--intent-success-900)"}):s.jsx(kl,{colorName:"action",progressValue:Kst(_),autoProgress:!1,size:fb,children:s.jsx(O,{size:"s",bold:!0,children:_})}),s.jsx(Yst,{onClick:a,fontSize:M,"aria-label":R,href:r,numberOfLines:k,presentationMode:t.presentationMode,children:s.jsx(qst,{size:M,numberOfLines:k,presentationMode:t.presentationMode,children:T})})]});if(p){const{portrait:{promotion:k},landscape:{promotion:M}}=p,w=g?M?.numberOfLines:k?.numberOfLines,j=Es(g?M?.fontSize:k?.fontSize);return w&&j?N(w,j):null}return N()},ent=(e,t)=>{const[n,o]=h.useState("");return h.useEffect(()=>{t&&o(t)},[e,t]),{ariaLiveText:n}},bg=({message:e,productQuantity:t})=>{const n=ent(t,e);return s.jsx(ie,{"aria-live":"polite","aria-relevant":"text","aria-atomic":"true",role:"status",children:t>0?n.ariaLiveText:""})},tnt=({missedPromotionQuantities:e,offer:t,productId:n})=>{const{formatMessage:o}=L(),a=f(y=>bC(y,n))?.quantity?.quantityInBasket;if(!e||!a)return s.jsx(bg,{message:"Not in use.",productQuantity:0});const{basketQuantity:i,requiredQuantity:l}=e,c=i%l||l,u=l-c===0&&i>0,p=t.description,E=u?a>0?o("fop.added.missed.promotion.complete.text.alternative",{quantity:a,offerMessage:p}):o("fop.not.added.missed.promotion.complete.text.alternative",{offerMessage:p}):a>0?o("fop.added.missed.promotion.not.complete.text.alternative",{quantity:a,offerMessage:p,basketQuantity:i,requiredQuantity:l}):o("fop.not.added.missed.promotion.not.complete.text.alternative",{offerMessage:p,basketQuantity:i,requiredQuantity:l});return s.jsx(bg,{message:E,productQuantity:a})},tL=({list:e,fullWidth:t=!0,passedOffer:n})=>{const o=F(),{config:r,product:{offer:a,productId:i,retailerProductId:l,name:c},noOfferLink:d,displayLandscapeLayout:u,fopPositionOnPage:p,page:g,subPage:E,group:{section:y}}=ss(),I=n||a,S=f(H=>I&&JN(H,I.id,i)),C=f(D("seo.rdbl")),T=f(D("seo.ra")),_=!!(S&&I?.requiredProductQuantity&&S.basketQuantity>0),[A,R]=h.useState(_);if(h.useEffect(()=>{_&&R(!0)},[_]),!I)return null;const P=()=>{_||R(!1)},N=()=>{o(U.analyticsEvent({type:Jt.PROMO_LINK_CLICKED,promotionId:I.id,productId:i})),o(U.analyticsEvent({type:Jt.GA_FOP_PROMO_LINK_CLICKED,itemId:l,itemName:c,index:p,promotionId:I.retailerPromotionId,promotionName:I.description,list:e||ks(g,E,y)}));const H={event:"select_item_promotion",id:l,name:c,index:p,promotion_id:I.retailerPromotionId,promotion_name:I.description,list:e||ks(g,E,y)};te.sendEvent({GA:H,WA:null})},k=Cn(I.description),M=C?k.toLowerCase():void 0,w=T?I.retailerPromotionId:I.id,j=I.type==="COUPON"?QE(w,k):qa(w,M),G=!d,W=()=>{if(A&&S){const H=s.jsx(Jst,{productId:i,offer:I,missedPromotionQuantities:S,isDisplayed:_,onAnimationEnd:P,url:j,sendAnalytics:N,fullWidth:t});if(!r)return H;const K=u&&r.landscape.promotion?.numberOfLines&&r.landscape.promotion?.numberOfLines>=2,X=!u&&r.portrait.promotion?.numberOfLines&&r.portrait.promotion?.numberOfLines>=2;if(K||X)return H}return s.jsx(Wst,{offer:I,isOfferLink:G,url:j,sendAnalytics:N})};return s.jsxs(h.Fragment,{children:[s.jsx(tnt,{missedPromotionQuantities:S,offer:I,productId:i}),W()]})},snt=({paymentPromos:e})=>{const{product:t,config:n,displayLandscapeLayout:o}=ss(),[r]=Ee(["seo.rdbl"]),{formatMessage:a}=L();if(e.length===1)return s.jsx(tL,{passedOffer:e.at(0)});const{retailerProductId:i,name:l}=t,c=Uo(i,kc(l,{isSEOReadableURLEnabled:r})),d=XE("PAYMENT_PROMOTION"),u={paymentPromoGroup:a("fop.payment.promotion.group")},p=(S,C)=>{const T=uA(S);return s.jsx(W9,{to:c,presentationMode:"DEFAULT",children:s.jsxs(Y9,{"data-test":"fop-offer-text",presentationMode:"DEFAULT",isConfigurable:!!n,size:S,intent:"promotion",children:[C&&s.jsx(q9,{name:d,height:T,width:T,verticalAlign:"bottom","data-test":"fop-offer-icon",className:"salt-m-r--1"}),u.paymentPromoGroup]})})};if(!n)return p("m",!0);const{landscape:{promotion:g},portrait:{promotion:E}}=n,y=!o&&Es(E?.fontSize),I=o&&Es(g?.fontSize);return I?p(I,g?.icon):y?p(y,E?.icon):null},nnt=e=>e.reduce((t,n)=>(n.type==="PAYMENT_PROMOTION"?t.paymentPromos.push(n):t.promotions.push(n),t),{paymentPromos:[],promotions:[]}),ont=()=>{const{product:e,config:t,displayLandscapeLayout:n}=ss(),o=e.offers||[],{validatePromotion:r,shouldShowUnavailablePromotion:a}=cT(e);if(!t)return null;const i=n&&t.landscape.promotion?.numberOfPromotions,l=!n&&t.portrait.promotion?.numberOfPromotions,c=i||l||0,{paymentPromos:d,promotions:u}=nnt(o),p=d.length&&c>0?c-1:c;return s.jsxs(h.Fragment,{children:[d.length?s.jsx("div",{className:"promotion",children:s.jsx(snt,{paymentPromos:d})}):null,u.filter(g=>r(g).shouldShowPromotion&&a(g)).slice(0,p).map(g=>s.jsx("div",{className:"promotion",children:s.jsx(tL,{passedOffer:g},g.id)},g.id))]})},ZE=e=>Array(e).fill(1).map((t,n)=>t+n),Dp=5,rnt=60,ant=1500,int=40,K9="addReview",An={RATING:"rating",NICKNAME:"nickname",HEADLINE:"headline",COMMENTS:"comments",IMAGES:"images"},lnt=5,SS=.5,sL=({size:e,name:t,isError:n=!1})=>s.jsx(pe,{name:t,height:e,width:e,primary:!n,error:n}),cnt=({size:e,fillDecimal:t})=>s.jsxs(dnt,{"data-test":"partial-rating",children:[s.jsx(unt,{fillDecimal:t,children:s.jsx(pe,{name:"reviews",height:e,width:e,primary:!0})}),s.jsx(pe,{name:"reviews_outline",height:e,width:e,primary:!0})]}),dnt=v.span`
    position: relative;
    display: inline-flex;
`,unt=v.span`
    position: absolute;
    overflow: hidden;
    inline-size: ${e=>Math.round(e.fillDecimal*100)}%;
`,dT=({size:e=16,rating:t=0})=>{const o=ZE(5).map(r=>{const a=r-t;return r>t&&a>0&&a<1?s.jsx(cnt,{size:e,fillDecimal:t%1},r):s.jsx(sL,{name:`reviews${r<=t?"":"_outline"}`,size:e},r)});return s.jsx(Q,{"data-test":"display-only-rating",wrap:"nowrap",children:o})},pnt=v.div`
    align-items: center;
    border-radius: var(--salt-radius-default);
    display: inline-flex;
    justify-content: center;
    min-block-size: ${$(20)};
    padding-block: calc(var(--salt-spacing-05) - ${$(1)});
    padding-inline: calc(var(--salt-spacing-1) - ${$(1)});
    background-color: var(--intent-contrast);
    color: var(--salt-badge-secondary-light-color);
    font-size: var(--salt-text-s-font-size);
    line-height: var(--salt-text-s-line-height);
`,nL=({productId:e})=>{const t=f(r=>T9e(r,e)),{formatMessage:n}=L();if(!t)return null;const o=n("reviews.chip.rating.accessibility",{rating:t.overallRating,totalRating:Dp,count:t.count});return s.jsxs(h.Fragment,{children:[s.jsxs(pnt,{"data-test":"rating-badge","aria-hidden":"true",children:[s.jsx(dT,{rating:Number(t.overallRating)}),"(",t.count>999?"999+":t.count,")"]}),s.jsx(ie,{children:o})]})},yb=()=>{const{product:e}=ss(),t=e?.icons?.legal?.[0];return t?s.jsx("img",{src:t.src,alt:t.description,height:20,loading:"lazy"}):null},uc=v(_e)`
    animation: none;
`,tc=v(_e.Typography)`
    animation: none;
`,z9=v(_e.Button)`
    animation: none;
`,Sc=1.4285714286,Q9=Pe`
    overflow: hidden;
    min-block-size: calc(1em * ${Sc});
`,X9=Pe`
    ${Q9};
    &:empty {
        display: none;
        block-size: 0;
    }
`,Z9=Pe`
    ${Q9};
    &:empty {
        display: block;
        block-size: calc(1em * ${Sc});
    }
`,mnt=Pe`
    ${X9};

    ${re.smUp`
         ${Z9};
    `}
`,J9=Pe`
    --product-card-box-shadow: none;
    --product-card-background-color: var(--intent-contrast);

    background-color: var(--product-card-background-color);
    border-radius: var(--salt-radius-default);
    text-decoration: none;
    position: relative;
    min-inline-size: 0;
`,e7=Pe`
    ${J9};
    display: grid;
    grid-area: product-card;
    grid-template-areas: 'header footer';
    grid-template-columns:
        minmax(${({config:e})=>$(e.landscape.image?.resolution?.width)}, auto)
        1fr;

    ${({config:e})=>jc(e.landscape.productCardContainer?.paddings)}
    ${({config:e})=>IQ(e.landscape.productCardContainer?.border)}
    ${({config:e})=>e.landscape.productCardContainer?.boxShadow?`
        border: none;
        box-shadow: var(--product-card-box-shadow);
    `:"box-shadow: none;"};
`,oL=Pe`
    ${J9};
    display: flex;
    flex-direction: column;
    flex-grow: 1;

    ${({config:e})=>jc(e.portrait.productCardContainer?.paddings)}
    ${({config:e})=>IQ(e.portrait.productCardContainer?.border)}
    ${({config:e})=>e.portrait.productCardContainer?.boxShadow?`
        border: none;
        box-shadow: var(--product-card-box-shadow);
    `:"box-shadow: none;"};
`,hnt=Pe`
    ${e7};

    ${re.smUp`
         ${oL};
    `}
`,t7=Pe`
    position: relative;

    ${({config:e})=>jc(e.landscape.headerContainer?.paddings)};

    ${({config:e})=>`
         max-width: ${$(vXe(e.landscape.image?.resolution,e.landscape.image?.paddings,e.landscape.headerContainer?.paddings))};
   `}
`,s7=Pe`
    position: relative;
    ${({config:e})=>jc(e.portrait.headerContainer?.paddings)};
    max-inline-size: 100%;
`,gnt=Pe`
    ${t7};

    ${re.smUp`
         ${s7};
    `}
`,Ent=Pe`
    z-index: 1;
    position: absolute;
    display: flex;
    flex-direction: column;
    inline-size: 100%;
    gap: var(--salt-spacing-05);

    &:empty {
        display: none;
    }
`,n7=Pe`
    display: flex;
    justify-content: center;
    align-items: flex-start;
    position: relative;
`,rL=Pe`
    ${n7};
    ${({config:e})=>jc(e.landscape.image?.paddings)};

    > * {
        display: none;
        border-radius: var(--salt-radius-default);
        ${({config:e})=>SQ(e.landscape.image?.resolution,!0)};
    }
`,o7=Pe`
    ${n7};
    ${({config:e})=>jc(e.portrait.image?.paddings)};

    > * {
        border-radius: var(--salt-radius-default);
        ${({config:e})=>SQ(e.portrait.image?.resolution,!1)};
    }
`,fnt=Pe`
    ${rL};

    ${re.smUp`
         ${o7};
    `}
`,r7=Pe`
    inset-block-end: var(--salt-spacing-2);
    position: absolute;
    inline-size: calc(100% - var(--salt-spacing-2));
`,a7=Pe`
    ${r7};
`,i7=Pe`
    ${r7};

    inset-block-end: ${$(-10)};
`,ynt=Pe`
    ${a7};

    ${re.smUp`
         ${i7};
    `}
`,l7=Pe`
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    gap: var(--salt-spacing-1);
    justify-content: space-between;
    min-inline-size: 0;
    grid-area: footer;
    padding: var(--salt-spacing-2);
    position: relative;
`,c7=Pe`
    ${l7};

    border-inline-start: ${({config:e})=>e.landscape.divider&&"var(--salt-border-1) solid rgba(0, 0, 0, 0.1)"};
    border-end-start-radius: unset;
    border-end-end-radius: inherit;
    border-start-end-radius: inherit;
    background-color: ${({config:e,inCart:t})=>t&&e.landscape.footerContainer?.inBasketBackground?"var(--intent-action-50)":"unset"};

    ${({config:e})=>jc(e.landscape.footerContainer?.paddings)};
`,d7=Pe`
    ${l7};

    background-color: ${({config:e,inCart:t})=>t&&e.portrait.footerContainer?.inBasketBackground?"var(--intent-action-50)":"unset"};
    padding-block-start: ${$(12)};
    border-block-start: ${({config:e})=>e.portrait.divider&&"var(--salt-border-1) solid rgba(0, 0, 0, 0.1)"};
    border-inline-start: unset;
    border-start-end-radius: unset;
    border-end-start-radius: inherit;

    ${({config:e})=>jc(e.portrait.footerContainer?.paddings)};
`,Int=Pe`
    ${c7};

    ${re.smUp`
         ${d7};
    `}
`,u7=Pe`
    overflow: hidden;
    display: none;
    inline-size: 100%;

    &:focus-within {
        outline: auto -webkit-focus-ring-color;
    }

    a {
        outline: none;
    }
`,p7=Pe`
    ${u7};

    line-height: ${({config:e})=>e.landscape.title&&`var(--salt-text-${Es(e.landscape.title.fontSize)}-line-height)`};
    ${({config:e})=>vQ(e.landscape.title?.numberOfLines,Es(e.landscape.title?.fontSize))};

    > * {
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: block-axis;

        ${({config:e})=>` -webkit-line-clamp: ${e.landscape.title?.numberOfLines};`};
    }
`,aL=Pe`
    ${u7};

    line-height: ${({config:e})=>e.portrait.title&&`var(--salt-text-${Es(e.portrait.title.fontSize)}-line-height)`};
    ${({config:e})=>vQ(e.portrait.title?.numberOfLines,Es(e.portrait.title?.fontSize))};

    > * {
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: block-axis;

        ${({config:e})=>` -webkit-line-clamp: ${e.portrait.title?.numberOfLines};`};
    }
`,Snt=Pe`
    ${p7};

    ${re.smUp`
         ${aL};
    `}
`,m7=Pe`
    overflow: hidden;
    display: flex;
    inline-size: 100%;
    gap: var(--salt-spacing-1);
    flex-direction: column;
`,h7=Pe`
    ${m7};

    &:empty {
        ${({config:e})=>!e.landscape.promotion&&Pe`
                display: none;
                block-size: 0;
            `}
    }

    line-height: ${({config:e})=>e.landscape.promotion&&`var(--salt-text-${Es(e.landscape.promotion?.fontSize)}-line-height)`};
    ${({config:e})=>ES(e.landscape.promotion?.compress?1:fS(e.landscape.promotion?.numberOfLines,e.landscape.promotion?.numberOfPromotions),Es(e.landscape.promotion?.fontSize),e.landscape.promotion?.numberOfPromotions)};

    .promotion {
        ${({config:e})=>ES(e.landscape.promotion?.compress?1:e.landscape.promotion?.numberOfLines,Es(e.landscape.promotion?.fontSize))};
        > * {
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: block-axis;
            overflow: hidden;

            ${({config:e})=>` -webkit-line-clamp: ${e.landscape.promotion?.numberOfLines};`};
        }

        &:only-child > * {
            ${({config:e})=>e.landscape.promotion?.expand?` -webkit-line-clamp: ${fS(e.landscape.promotion?.numberOfLines,e.landscape.promotion?.numberOfPromotions)};`:` -webkit-line-clamp: ${e.landscape.promotion?.numberOfLines}`};
        }

        &:focus-within {
            outline: auto -webkit-focus-ring-color;
        }

        a {
            outline: none;
        }
    }
`,iL=Pe`
    ${m7};

    &:empty {
        ${({config:e})=>!e.portrait.promotion&&Pe`
                display: none;
                block-size: 0;
            `}
    }

    line-height: ${({config:e})=>e.portrait.promotion&&`var(--salt-text-${Es(e.landscape.promotion?.fontSize)}-line-height)`};
    ${({config:e})=>ES(e.portrait.promotion?.compress?1:fS(e.portrait.promotion?.numberOfLines,e.portrait.promotion?.numberOfPromotions),Es(e.portrait.promotion?.fontSize))};

    .promotion {
        ${({config:e})=>ES(e.portrait.promotion?.compress?0:e.portrait.promotion?.numberOfLines,Es(e.portrait.promotion?.fontSize))};
        > * {
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: block-axis;
            overflow: hidden;

            ${({config:e})=>` -webkit-line-clamp: ${e.portrait.promotion?.numberOfLines};`};
        }

        &:only-child > * {
            ${({config:e})=>e.portrait.promotion?.expand?`-webkit-line-clamp: ${fS(e.portrait.promotion?.numberOfLines,e.portrait.promotion?.numberOfPromotions)};`:`-webkit-line-clamp: ${e.portrait.promotion?.numberOfLines}`};
        }
    }
`,Cnt=Pe`
    ${h7};

    ${re.smUp`
         ${iL};
    `}
`,g7=Pe`
    overflow: hidden;
    display: flex;
    gap: var(--salt-spacing-1);
    inline-size: 100%;
    flex: 1 1 fit-content;
`,E7=Pe`
    ${g7};

    align-items: baseline;

    ${({isStacked:e})=>Pe`
        ${e&&re.smUp`
                    align-items: stretch;
                `}
    `}
`,f7=Pe`
    ${g7};
`,vnt=Pe`
    ${E7};

    ${re.smUp`
         ${f7};
    `}
`,Tnt=Pe`
    grid-area: controls;
    display: flex;
    gap: var(--salt-spacing-2);
    max-inline-size: 100%;
    flex: 0 1 0%;
    justify-content: flex-end;

    > * {
        flex: 1;
    }

    button {
        outline-offset: var(--salt-spacing-1);
    }
`,y7=v.div`
    block-size: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    gap: var(--salt-spacing-2);
    position: relative;

    .outer-header-container {
        ${({layoutType:e})=>e===Fs.Portrait?Z9:e===Fs.Landscape?X9:mnt}
    }

    .product-card-container {
        ${({layoutType:e})=>e===Fs.Portrait?oL:e===Fs.Landscape?e7:hnt}
    }

    .header-container {
        ${({layoutType:e})=>e===Fs.Portrait?s7:e===Fs.Landscape?t7:gnt}
    }

    .top-icons-container {
        ${Ent};
    }

    .image-container {
        ${({layoutType:e})=>e===Fs.Portrait?o7:e===Fs.Landscape?rL:fnt}
    }

    .image-link-concealed {
        position: absolute;
        inset: 0;

        ${({layoutType:e})=>e===Fs.Portrait?"margin: 0 auto;":e===Fs.Landscape?"margin: auto;":"margin: 0 auto;"}
    }

    .attributes-container {
        ${({layoutType:e})=>e===Fs.Portrait?i7:e===Fs.Landscape?a7:ynt}
    }

    .footer-container {
        ${({layoutType:e})=>e===Fs.Portrait?d7:e===Fs.Landscape?c7:Int}
    }

    .title-container {
        ${({layoutType:e})=>e===Fs.Portrait?aL:e===Fs.Landscape?p7:Snt}
    }

    .promotion-container {
        ${({layoutType:e})=>e===Fs.Portrait?iL:e===Fs.Landscape?h7:Cnt}
    }

    .price-pack-size-container {
        ${({layoutType:e})=>e===Fs.Portrait?f7:e===Fs.Landscape?E7:vnt}
    }

    .controls-container {
        ${Tnt};
    }

    .position-static {
        position: static;
    }

    .position-relative {
        position: relative;
    }

    .position-absolute {
        position: absolute;
    }

    ${({customStyling:e})=>e};
`,xU=v.div`
    block-size: ${({fontSize:e="m"})=>`calc(
        1 * var(--salt-text-${e}-line-height) *
        var(--salt-text-${e}-font-size)
    )`};
    inline-size: 100%;
    font-size: ${({fontSize:e})=>e&&` var(--salt-text-${e}-font-size)`};
`,Ib=v.div`
    block-size: ${({height:e})=>$(e)};
    inline-size: 100%;
`,_nt=v(tc)`
    block-size: ${({fontSize:e})=>e==="xl"?"var(--salt-display-font-size)":`var(--salt-text-${e}-font-size)`};
`,bnt=v(uc)`
    block-size: calc(var(--salt-text-${({fontSize:e})=>e}-font-size) * ${Sc});
`,AU=({deposit:e})=>{const{formatMessage:t}=L(),n=He(),o={accessibility:t("deposit.description"),text:t("deposit.badge",{price:n(e)})};return s.jsx(ln,{intent:"secondary",singleLine:!0,text:o.text,accessibilityText:o.accessibility,"data-test":"product-card-deposit-badge"})},RU=({shelfLife:e})=>{const{formatMessage:t}=L(),{quantity:n,unit:o}=e,r={accessibility:n===1?t(`guaranteed.product.life.description.${o.toLowerCase()}.one`):t(`guaranteed.product.life.description.${o.toLowerCase()}.other`,{quantity:n}),text:t(`guaranteed.product.life.badge.${o.toLowerCase()}`,{quantity:n})};return s.jsx(ln,{intent:"secondary",singleLine:!0,text:r.text,accessibilityText:r.accessibility,"data-test":"product-card-shelf-life-badge"})},DU=()=>{const{formatMessage:e}=L(),t=e("fop.out.of.stock.button");return s.jsx(ln,{intent:"tertiary-contrast",text:t,"data-test":"product-card-out-of-stock-badge"})},xnt=({date:e})=>{const{formatMessage:t}=L(),n=f(r=>cr(r)),o=t("fop.last.bought.date",{date:gt(e,n)});return s.jsx(ln,{intent:"tertiary-contrast",text:o,accessibilityText:o,"data-test":"product-card-last-bought-badge"})},OU=20,Ant=5,Rnt=4,Dnt=3,qc={MAX_ALLOWED_ATTRIBUTES:Ant,MAX_ATTRIBUTES_WITH_ONE_BADGE:Rnt,MAX_ATTRIBUTES_WITH_TWO_BADGES:Dnt},Ont=({attribute:e})=>s.jsxs(h.Fragment,{children:[s.jsx(pe,{name:e.icon,height:OU,width:OU,"data-test":`product-card-lifestyle-${e.icon}`,title:e.label,"aria-hidden":"true"}),s.jsx(ie,{children:e.label})]}),Pnt=v(Q)`
    z-index: 1;
    min-block-size: ${$(20)};
    overflow: hidden;
    ${({hideEmpty:e})=>e&&`&:empty {
            display: none;
        }`}
`,PU=v.div`
    display: grid;
    grid-template-rows: repeat(2, 1fr);
    overflow: hidden;

    /* row is made of height + line height and we need to subtract half the gap between two rows so only one overlaps */
    margin-block-start: calc(-1 * 1em * ${Sc} - (var(--salt-spacing-1) / 2));
    ${({displayLandscapeLayout:e})=>!e&&Pe`
            ${re.smUp`
                  margin-top: unset
    `}
        `}
    gap: var(--salt-spacing-1);
    z-index: 1;
    inline-size: fit-content;
    max-inline-size: 100%;
`,Kc=({children:e,hideEmpty:t})=>s.jsx(Pnt,{hideEmpty:t,gap:["xs"],wrap:"nowrap",align:"center",children:e}),Nnt=()=>{const{product:{productId:e,attributes:t,favorite:n,guaranteedProductLife:o,depositPrice:r,available:a,ratingSummary:i,icons:l},config:c,displayLandscapeLayout:d}=ss(),u=f(P=>D("rvws")(P));if(!a)return c?s.jsxs(PU,{displayLandscapeLayout:d,children:[s.jsx(Kc,{hideEmpty:!1}),s.jsx(Kc,{children:s.jsx(DU,{})})]}):s.jsx(Kc,{children:s.jsx(DU,{})});const p=()=>t?t.length<qc.MAX_ATTRIBUTES_WITH_ONE_BADGE?t:t.length>qc.MAX_ATTRIBUTES_WITH_TWO_BADGES&&o&&r?t.slice(0,qc.MAX_ATTRIBUTES_WITH_TWO_BADGES):t.length>qc.MAX_ATTRIBUTES_WITH_ONE_BADGE&&o||t.length>qc.MAX_ATTRIBUTES_WITH_ONE_BADGE&&r?t.slice(0,qc.MAX_ATTRIBUTES_WITH_ONE_BADGE):t.slice(0,qc.MAX_ALLOWED_ATTRIBUTES):[],E=(()=>{const P=d&&c?.landscape?.bottomAttributes?.ratingBadgeOrBoughtDate,N=!d&&c?.portrait?.bottomAttributes?.ratingBadgeOrBoughtDate;if(!c||N||P){if(n&&n.lastBought)return s.jsx(xnt,{date:n.lastBought});if(u&&i)return s.jsx(nL,{productId:e})}return null})(),y=d?c?.landscape?.bottomAttributes?.maxLifestyleIcons:c?.portrait?.bottomAttributes?.maxLifestyleIcons,I=typeof y<"u"&&t?t.slice(0,y):p(),S=!!I.length||!!r||!!o||!!l.legal.length,C=I.map((P,N)=>s.jsx(Ont,{attribute:P},`${P.label}-${N+1}`)),T=r?s.jsxs(h.Fragment,{children:[s.jsx(yb,{}),s.jsx(AU,{deposit:r})]}):s.jsxs(h.Fragment,{children:[s.jsx(yb,{}),o&&s.jsx(RU,{shelfLife:o}),C]}),_=s.jsxs(h.Fragment,{children:[s.jsx(yb,{}),r&&s.jsx(AU,{deposit:r}),o&&s.jsx(RU,{shelfLife:o}),C]}),A=d?T:_,R=c?.landscape.divider||c?.portrait.divider;return!c||R?s.jsxs(Q,{gap:["xs"],direction:"column",additionalCss:"overflow: hidden;",children:[s.jsx(Kc,{hideEmpty:!0,children:S&&E?A:null}),s.jsx(Kc,{hideEmpty:!0,children:E||A})]}):s.jsxs(PU,{displayLandscapeLayout:d,children:[s.jsx(Kc,{children:A}),s.jsx(Kc,{children:E})]})},lL=v(O)`
    color: ${({isOffer:e,strikethrough:t})=>e&&!t?"var(--typography-promotion, var(--intent-promotion))":"currentColor"};
    ${({strikethrough:e,isGross:t,fontSize:n})=>e||t?`
        font-size: var(--salt-text-${n||"s"}-font-size);
        font-weight: 400;
    `:`
        font-size: var(--salt-text-${n||"xl"}-font-size);
        font-weight: 700;
    `};
    ${({strikethrough:e})=>e&&"text-decoration: line-through;"};
    ${({whiteSpace:e})=>e&&`white-space: ${e};`};
    line-height: 1;
    white-space: nowrap;
`,Lnt=v(ee)`
    line-height: 1;
`,I7=({isOffer:e=!1,size:t="m",children:n})=>{const{formatMessage:o}=L(),r=es("catch-weight-subtext-position"),{product:{size:{catchWeight:a}={catchWeight:void 0}},config:i,displayLandscapeLayout:l}=ss(),c=d=>{if(a){const u=o("fop.catchweight.unit");return r==="pre"?s.jsxs(h.Fragment,{children:[s.jsx(_g,{"data-test":"fop-catchWeight",isOffer:e,size:d,isSingleLine:!0,children:u}),n]}):s.jsxs(h.Fragment,{children:[n,s.jsx(_g,{"data-test":"fop-catchWeight",isOffer:e,size:d,isSingleLine:!0,children:u})]})}return n};if(i){const{portrait:{catchWeightLabel:d},landscape:{catchWeightLabel:u}}=i,p=!l&&Es(d),g=l&&Es(u);return p?c(p):g?c(g):n}return c(t)},knt=({showCatchWeight:e})=>{const{formatMessage:t}=L(),n=He(),o=f(D("ngp")),{product:{price:r,offer:a},config:i,displayLandscapeLayout:l}=ss();if(!r)return null;const c={currentPrice:n(r.current),currentPriceAccessibility:t("fop.current.price.description")},d=a?.presentationMode!=="MUTE_STYLE"&&!!r.original,u=s.jsx(ie,{children:c.currentPriceAccessibility}),p=E=>E==="xl"?s.jsx(Lnt,{size:"s",intent:d?"promotion":void 0,"data-test":"fop-price",forwardedAs:"span",children:c.currentPrice}):s.jsx(lL,{isOffer:d,"data-test":"fop-price",...E&&{fontSize:E},children:c.currentPrice}),g=E=>!e||o?s.jsxs(h.Fragment,{children:[u,p(E)]}):s.jsxs(h.Fragment,{children:[u,s.jsx(I7,{isOffer:d,children:p(E)})]});if(i){const{portrait:{price:E},landscape:{price:y}}=i,I=!l&&E?.fontSize,S=l&&y?.fontSize;return I?g(I):S?g(S):null}return g()},jnt=()=>{const{formatMessage:e}=L(),t=He(),n=f(D("hop")),{product:{price:o},config:r,displayLandscapeLayout:a}=ss();if(n&&!!o?.reference||!o)return null;const l={originalPrice:o.original&&t(o.original),originalPriceAccessibility:e("fop.original.price.description")},c=!!o.original,d=u=>l.originalPrice?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:l.originalPriceAccessibility}),s.jsx(lL,{"data-test":"fop-original-price",isOffer:c,strikethrough:!0,...u&&{fontSize:u},children:l.originalPrice})]}):null;if(r){const{portrait:{price:u},landscape:{price:p}}=r,g=!a&&Es(u?.strikethrough),E=a&&Es(p?.strikethrough);return g?d(g):E?d(E):null}return d()},Mnt=()=>{const{formatMessage:e}=L(),t=He(),{product:{price:n},config:o,displayLandscapeLayout:r}=ss();if(!n||!n.gross)return null;const a={grossPrice:n.gross&&t(n.gross),taxInclusiveMessage:n.gross&&e("fop.tax.inclusive",{grossPrice:t(n.gross)})},i=!!n?.original,l=c=>s.jsx(lL,{"data-test":"fop-gross-price",isOffer:i,isGross:!0,...c&&{fontSize:c},whiteSpace:"nowrap",children:a.taxInclusiveMessage});if(o){const{portrait:{grossPrice:c},landscape:{grossPrice:d}}=o,u=!r&&Es(c?.fontSize),p=r&&Es(d?.fontSize);return u?l(u):p?l(p):null}return l()},cL=({showCatchWeight:e=!0,direction:t})=>{const n=f(D("ngp")),{product:{price:o}}=ss();return o?s.jsxs(Q,{gap:["xs"],align:"baseline",wrap:"nowrap","data-test":"fop-price-wrapper",direction:t,children:[s.jsx(knt,{showCatchWeight:e}),n?s.jsx(Mnt,{}):s.jsx(jnt,{})]}):null},wnt=e=>e==="NEW_ARRIVAL"?"fop.reference.price.new.arrivals":e==="FRESH"?"fop.reference.price.fresh":"fop.reference.price.default",Fnt=v(O)`
    overflow: hidden;
    font-size: var(--salt-text-${({fontSize:e})=>e}-font-size);
    block-size: ${({fontSize:e})=>`calc(
        1 * var(--salt-text-${e}-line-height) *
        var(--salt-text-${e}-font-size)
    )`};
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: block-axis;
`,dL=()=>{const{formatMessage:e}=L(),t=He(),{product:{price:n},config:o,displayLandscapeLayout:r}=ss(),a=()=>{if(!n||!n.reference)return null;const{currency:l,amount:c,type:d}=n.reference;return e(wnt(d),{price:t({currency:l,amount:c})})},i=(l="s")=>s.jsx(Fnt,{"data-test":"fop-reference-price",fontSize:l,children:a()});if(o){const{portrait:{referencePrice:l},landscape:{referencePrice:c}}=o,d=!r&&Es(l?.fontSize),u=r&&Es(c?.fontSize);return d?i(d):u?i(u):null}return i()},Bnt=v(_g)`
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
`,NU=()=>{const{formatMessage:e}=L(),t=He(),{product:{price:n,offer:{presentationMode:o}={presentationMode:void 0}},config:r,displayLandscapeLayout:a}=ss();if(!n)return null;const i=l=>{const c={pricePerUnit:""};if(n.unit){const d=t(n.unit.current);n.unit.pricePerSuffix?c.pricePerUnit=`${d} ${n.unit.pricePerSuffix}`:n.unit.label&&(c.pricePerUnit=e(`${n.unit.label}`,{price:d}))}return c.pricePerUnit?s.jsxs(Bnt,{isOffer:!!n.original,presentationMode:o,"data-test":"fop-price-per-unit",...l&&{size:l},children:["(",c.pricePerUnit,")"]}):null};if(r){const{portrait:{unitPrice:l},landscape:{unitPrice:c}}=r,d=!a&&Es(l?.fontSize),u=a&&Es(c?.fontSize);return d?i(d):u?i(u):null}return i()},Unt=v(O)`
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
`,LU=()=>{const{formatMessage:e}=L(),{product:{size:t},config:n,displayLandscapeLayout:o}=ss(),r=t&&`${t.value}${yg(e,t.uom)}`,a=(i="m")=>s.jsx(Unt,{size:i,children:r});if(n){const{portrait:{packSize:i},landscape:{packSize:l}}=n,c=!o&&Es(i?.fontSize),d=o&&Es(l?.fontSize);return c?a(c):d?a(d):null}return a()},Gnt=v.div`
    display: inline-grid;
    gap: var(--salt-spacing-1);
    grid-template-columns: ${({hasCatchWeight:e})=>e?"auto auto 1fr":"auto 1fr"};
    overflow: hidden;
    align-items: baseline;
`,pA=()=>{const{product:{size:e},displayLandscapeLayout:t}=ss();if(t)return s.jsxs(Q,{wrap:"nowrap",gap:["xs"],additionalCss:"max-inline-size: 100%;",justify:"flex-start","data-test":"fop-size",align:"baseline",children:[s.jsx(LU,{}),s.jsx(NU,{})]});const n=()=>s.jsx(I7,{size:"m",children:s.jsx(LU,{})});return s.jsxs(Gnt,{"data-test":"fop-size",hasCatchWeight:!!e?.catchWeight,children:[e&&n(),s.jsx(NU,{})]})},JE=({children:e,tabIndex:t=0,isHyperlink:n=!0,className:o,ariaLabel:r,ariaHidden:a=!1})=>{const i=F(),{sendFopProductLinkEvent:l}=eL(),[c]=Ee(["seo.rdbl"]),{product:d,page:u,subPage:p,fopPositionOnPage:g,group:{section:E,featuredProductCampaigns:y}}=ss(),{productId:I,name:S,retailerProductId:C,isInCurrentCatalog:T}=d,_=Vn(d,y),A=Uo(C,kc(S,{isSEOReadableURLEnabled:c})),R=ks(u,p,E),P=()=>{l(),i(Ti.setActiveBop(I))};return T&&n?s.jsx(Ye,{standalone:!0,to:A,state:{productListName:R,position:g,..._?{campaignName:_.campaignName,campaignId:_.campaignId}:{}},tabIndex:t,className:o,onClick:P,"data-synthetics":"bop-link","data-test":"fop-product-link","aria-hidden":a,"aria-label":r??void 0,children:e}):s.jsx(h.Fragment,{children:e})},S7=()=>{const{product:{name:e,isInCurrentCatalog:t},config:n,displayLandscapeLayout:o}=ss(),r=(d="m")=>s.jsx(JE,{children:s.jsx(O,{size:d,onClick:()=>!t&&Z.info("fop.not.in.current.catalog"),"data-test":"fop-title",asChild:!0,children:s.jsx("h3",{children:e})})});if(!n)return r();const{landscape:{title:a},portrait:{title:i}}=n,l=!o&&Es(i?.fontSize),c=o&&Es(a?.fontSize);return l?r(l):c?r(c):null},el=bce.LazyLoadImage,CS={BLURRED_FOP:"BLURRED_FOP",BLURRED_IMAGE:"BLURRED_IMAGE"},$nt=v.div`
    position: relative;
    overflow: hidden;
    block-size: 100%;
`,Hnt=v.div`
    display: flex;
    position: absolute;
    background-color: var(--intent-secondary);
    border-radius: var(--salt-radius-default);
    inline-size: 100%;
    block-size: 100%;
    align-items: center;
    justify-content: center;
`,pp=(e,t)=>{switch(t){case CS.BLURRED_IMAGE:return s.jsx(C7,{children:e});case CS.BLURRED_FOP:return s.jsx(Ji,{isActive:!0,children:e});default:return e}},C7=({children:e})=>s.jsxs($nt,{"data-test":"fop-image-overlay",children:[s.jsx(Hnt,{children:s.jsx(pe,{name:"age_restriction_19",height:40,width:40})}),e]}),Sb=v(el)`
    block-size: 100%;
    inline-size: 100%;
`,v7=()=>{const e=f(i=>D("di")(i)),{product:{image:t,restrictedVisibility:n},config:o}=ss();if(!t)return null;if(!e)return pp(s.jsx(Sb,{"data-test":"lazy-load-image",threshold:300,alt:t.description,src:t.src,placeholder:s.jsx(uc,{height:"100%"})}),n);if(!o)return pp(s.jsx(Sb,{"data-test":"lazy-load-image",threshold:300,alt:t.description,src:t.src,srcSet:t.fopSrcset,sizes:`(max-width: ${Ke.sm}em) 136px, 175px`,placeholder:s.jsx(uc,{height:"100%"})}),n);const{portrait:{image:r},landscape:{image:a}}=o;return r?.resolution?.width||a?.resolution?.width?pp(s.jsx(Sb,{"data-test":"lazy-load-image",threshold:300,alt:t.description,src:t.src,srcSet:t.fopSrcset,sizes:`(max-width: ${Ke.sm}em) ${a?.resolution?.width}px, ${r?.resolution?.width}px`,placeholder:s.jsx(uc,{height:"100%"})}),n):null},kU={text:"fop.featured.label",description:"fop.featured.label.description"},Vnt={text:"fop.featured.programmatic.label",description:"fop.featured.programmatic.label.description"},Wnt=(e,t)=>{if(!t)return kU;switch(e){case"CITRUS_AD":return Vnt;case"CONTENTFUL":case"OSP_CMS":default:return kU}},jU=({contentSource:e="CONTENTFUL"})=>{const{formatMessage:t}=L(),[n]=Ee(["fp.dl"]),{text:o,description:r}=Wnt(e,n);return s.jsx(ln,{intent:"primary",text:t(o),accessibilityText:t(r),"data-test":"fop-featured"})},MU=({size:e=24})=>{const{formatMessage:t}=L(),n={text:t("fop.favorite.icon.description")};return s.jsxs(h.Fragment,{children:[s.jsx(pe,{primary:!0,name:"favourites","data-test":"fop-fav-icon",width:e,height:e}),s.jsx(ie,{children:n.text})]})},wU=({size:e=24})=>{const{formatMessage:t}=L(),n={text:t("fop.shopping.lists.in.product.list")};return s.jsxs(h.Fragment,{children:[s.jsx(pe,{primary:!0,width:e,height:e,name:"list","data-test":"in-product-list"}),s.jsx(ie,{children:n.text})]})},FU=({size:e=24})=>{const{formatMessage:t}=L(),n={text:t("fop.regular.icon.description")};return s.jsxs(h.Fragment,{children:[s.jsx(pe,{primary:!0,name:"regulars","data-test":"fop-reg-icon",width:e,height:e}),s.jsx(ie,{children:n.text})]})},BU=v(Q)`
    gap: var(--salt-spacing-1);
    min-block-size: calc(1em * ${Sc});
    max-block-size: calc(1em * ${Sc});
    overflow: hidden;
    ${({hideEmpty:e})=>e&&`&:empty {
            display: none;
    }`}
`,Ynt=v.button`
    gap: var(--salt-spacing-1);
    padding-block: var(--salt-spacing-05);
    padding-inline: var(--salt-spacing-1);
    border-radius: var(--salt-radius-default);
    background-color: white;

    &:empty {
        display: none;
    }

    display: flex;
`,qnt=({hideEmpty:e=!0})=>{const{product:t,group:{type:n,section:o,featuredProductCampaigns:r},page:a,fopPositionOnPage:i,config:l,displayLandscapeLayout:c}=ss(),{name:d,regular:u,isInProductList:p,favorite:g,productId:E,retailerProductId:y}=t,I=F(),S=ft(),{formatMessage:C}=L(),T=n===Ut.FEATURED,_=n===Ut.FEATURED_CROSS_SELL,A=n===Ut.SHOPPABLE_BANNER,R=T||_||A,P=Vn(t,r),N=()=>{S({type:Jt.ELLIPSIS_CLICKED,productId:E,retailerProductId:y}),I(J.openModal("shoppingLists",{productId:E,section:o,productIndex:i,page:a}))};if(l){const{portrait:{topAttributes:k},landscape:{topAttributes:M}}=l,w=c?M?.featured:k?.featured,j=c?M?.favorite:k?.favorite,G=c?M?.list:k?.list,W=c?M?.regulars:k?.regulars,H=g&&j,K=p&&G,X=u&&W,q=H||K||X;return s.jsxs(BU,{hideEmpty:e,children:[R&&w&&s.jsx(jU,{contentSource:P?.source}),q&&s.jsxs(Ynt,{type:"button",onClick:N,children:[H&&s.jsx(MU,{size:16}),K&&s.jsx(wU,{size:16}),X&&s.jsx(FU,{size:16}),s.jsx(ie,{children:C("fop.attributes.button.accessibility.text",{productName:d})})]})]})}return s.jsxs(BU,{gap:["xs"],hideEmpty:e,children:[R&&s.jsx(jU,{contentSource:P?.source}),g&&s.jsx(MU,{}),p&&s.jsx(wU,{}),u&&s.jsx(FU,{})]})},Knt=v(ln)`
    > * {
        font-size: ${({size:e})=>e&&` var(--salt-text-${e}-font-size)`};
        line-height: ${({size:e})=>e&&` var(--salt-text-${e}-line-height)`};
    }

    inline-size: 100%;
    max-inline-size: fit-content;
`,znt=v(ee)`
    inline-size: 100%;
    max-inline-size: fit-content;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding-inline: var(--salt-spacing-1);
    padding-block: var(--salt-spacing-05);
    background-color: var(--intent-contrast);
    border-radius: var(--salt-radius-default);
`,Qnt=()=>{const{formatMessage:e}=L(),{product:{countryOfOrigin:t},config:n,displayLandscapeLayout:o}=ss(),r=f(l=>D("fr.law")(l)),a={countryOfOriginA11yPrefix:e("fop.country.of.origin.a11y.prefix")};if(!t)return null;const i=l=>l==="xl"?s.jsxs(znt,{size:"s",forwardedAs:"span","data-test":"fop-country-of-origin",children:[s.jsx(ie,{children:a.countryOfOriginA11yPrefix}),t]}):s.jsx(Knt,{size:l,intent:"tertiary-contrast",singleLine:!0,text:t,accessibilityText:`${a.countryOfOriginA11yPrefix} `,"data-test":"fop-country-of-origin"});if(n){const l=r?n.portrait?.price?.fontSize:n.portrait?.countryOfOrigin,c=r?n.landscape?.price?.fontSize:n.landscape?.countryOfOrigin,d=!o&&l,u=o&&c;return d?i(d):u?i(u):null}return i(r?"xl":"m")},Xnt=v(O)`
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`,Znt=v(Ye)`
    overflow: hidden;
    display: inline-grid;
`,UU=({breadcrumbsText:e,breadcrumbsClickAction:t})=>{const n=s.jsx(Xnt,{"data-test":"breadcrumb-text",className:"salt-d--block",children:e.name});return e.link?s.jsx(Znt,{to:e.link,onClick:t,standalone:!0,children:n}):n},T7=v.div`
    position: relative;

    ${re.smUp`
        position: static;
    `};
`,Jnt=v.div`
    padding-block: 0 var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);

    ${re.smUp`
        padding-block: 0 var(--salt-spacing-2);
        padding-inline: var(--salt-spacing-1);
    `};

    ${re.lgUp`
        padding-inline: var(--salt-spacing-2);
        padding-block: 0;
    `};
`;T7.displayName="DropdownGroup";const Mh=T7;Mh.Bar=Jnt;Mh.Bar.displayName="DropdownGroupBar";const eot=v.button`
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    justify-content: start;
    cursor: pointer;
    inline-size: ${({fill:e})=>e?"100%":"fit-content"};
    font-family: var(--font-family);
    background: var(--intent-contrast);
    border: none;
    border-radius: var(--salt-radius-0);
    padding: var(--salt-spacing-1);

    &:hover {
        background: none;

        > .dropdown-item-button {
            font-weight: 600;
        }
    }
`,tot=h.forwardRef(({children:e,fill:t=!0,...n},o)=>s.jsx(eot,{ref:o,type:"button",fill:t,...n,children:s.jsx(O,{className:"dropdown-item-button",children:e})})),sot=v.button`
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: start;
    gap: var(--salt-spacing-2);
    cursor: pointer;
    font-family: var(--font-family);
    font-weight: 600;
    padding-block: 0;
    padding-inline: var(--salt-spacing-2);
    min-block-size: ${({size:e})=>$(e==="s"?28:40)};
    min-inline-size: ${({size:e})=>$(e==="s"?28:40)};
    inline-size: ${({fill:e})=>e?"100%":"fit-content"};
    block-size: 100%;
    vertical-align: middle;
    background-color: var(--intent-contrast);
    color: var(--intent-content);
    border: ${({bordered:e})=>e?"var(--salt-border-1) solid":"none"};
    border-radius: var(--salt-radius-default);
    border-color: var(--intent-secondary-800);

    &:hover {
        background-color: var(--intent-secondary-900);
        border-color: var(--intent-secondary-900);
        color: var(--intent-secondary-900-contrast);
    }

    &:disabled {
        background-color: var(--intent-contrast);
        border-color: var(--intent-secondary-200);
        color: var(--intent-secondary-200);
        cursor: default;
        pointer-events: none;
    }
`,not=v.span`
    margin: 0;
    padding: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: start;
`,oot=v(pe)`
    margin-inline-start: auto;
`,GU="close_default",$U="arrow_down",rot=h.forwardRef(({isOpen:e,iconName:t,text:n,fill:o=!1,size:r="m",type:a="button",bordered:i=!1,...l},c)=>{const d=r==="s"?16:18;return s.jsxs(sot,{fill:o,size:r,type:a,bordered:i,...l,ref:c,children:[t&&s.jsx(pe,{name:t,height:d,width:d,"data-test":`icon__${t}`}),n&&s.jsx(not,{children:n}),s.jsx(oot,{name:e?GU:$U,height:d,width:d,"data-test":e?`icon__${GU}`:`icon__${$U}`})]})}),rt={Body:Kz,Container:qz,Content:zz,Footer:y1e,ItemButton:tot,TriggerDefaultButton:rot,TriggerSaltButton:Qz},aot=(e,t,n)=>{h.useEffect(()=>{const o=r=>{t&&e&&e.current&&!e.current.contains(r.target)&&n()};return document.addEventListener("mousedown",o),document.addEventListener("touchend",o),()=>{document.removeEventListener("mousedown",o),document.removeEventListener("touchend",o)}},[e])},iot=v.button.withConfig({shouldForwardProp:(e,t)=>!["width","height"].includes(e)&&t(e)})`
    margin: 0;
    padding: 0;
    border: 0;
    background: transparent;
    cursor: pointer;
    display: inline-block;
`,lot=({isBreadcrumbDropdownOpen:e,toggleBreadCrumbMenu:t,fopBreadcrumbsId:n,fopBreadcrumbsMenuId:o})=>{const{formatMessage:r}=L(),a=r("fop.group.menu.accessibility.label");return s.jsxs(iot,{"aria-controls":o,"aria-expanded":e,"aria-haspopup":"true",type:"button","data-toggle":"true",height:20,id:n,width:20,onClick:t,"data-test":"fop-breadcrumbs-button",children:[s.jsx(pe,{height:20,width:20,name:"more","aria-hidden":"true"}),s.jsx(ie,{children:a})]})},cot=v.div`
    block-size: 20px;
`,dot=v(rt.Body)`
    inset-block-start: calc(${$(20)} + var(--salt-spacing-2));
`,uot=({productId:e,breadcrumbsItems:t,breadcrumbsClickAction:n})=>{const o=F(),[r,a]=h.useState(!1),i=h.useRef(null),l=()=>{a(!1)},c=g=>{g.key==="Escape"&&l()},d=()=>a(!r);h.useEffect(()=>{r&&o(U.analyticsEvent({type:Jt.CLUSTER_EXPANDED,attributes:t.reduce((g,E,y)=>Object.assign(g,{[`categoryIdLevel${y+1}`]:E.id}),{})}))},[r]),aot(i,r,l);const u=`fop-breadcrumbs-${e}`,p=`fop-breadcrumbs-menu-${e}`;return s.jsxs(cot,{onKeyDown:c,ref:i,"aria-labelledby":u,"data-test":"dropdown",children:[s.jsx(lot,{isBreadcrumbDropdownOpen:r,toggleBreadCrumbMenu:d,fopBreadcrumbsId:u,fopBreadcrumbsMenuId:p}),s.jsx(dot,{isOpen:r,fill:!0,textWrap:!0,children:s.jsx(rt.Content,{children:s.jsx(Be,{id:p,"aria-labelledby":u,inline:!1,role:"menu",children:t.map((g,E)=>s.jsx(Be.Item,{role:"menuitem",children:s.jsx(O,{asChild:!0,children:s.jsx(Ye,{to:g.link,onClick:()=>{l(),n(E,g.id)},standalone:!0,children:g.name})})},g.id))})})})]})},pot=()=>{const{formatMessage:e}=L(),t=F(),{product:{productId:n},group:o,page:r}=ss(),[a,i]=Ee(["seo.rdbl","seo.ra"]);if(!o)return null;const l=o.clusterBreadcrumbs?.length>0||!!(o.products.length>0&&typeof o.type=="string"&&o.type.length),c=o.products[0]===n;if(!l||!c)return null;const d=(I,S,C)=>{const T={level:I};if(S){T.categoryId=S,t(U.analyticsEvent({type:rn.SELECT_CATEGORY_GA4_EVENT,location:"breadcrumb",categoryName:C,retailerCategoryId:S}));const _={event:"select_category",id:S,location:"dropdown",name:C||""};te.sendEvent({GA:_,WA:null})}t(U.analyticsEvent({type:Jt.BREADCRUMBS_LIST_CLICKED,description:"User clicked breadcrumbs list item",pageEventAttributes:T}))},u=({id:I,name:S,fullURLPath:C,retailerCategoryId:T})=>({id:I,name:S,link:p(i?T:I,C)}),p=(I,S)=>{const C=`source=breadcrumbs&sublocationId=${I}`;if(a){const T=S?.toLowerCase();return Sa(I,T,{queryString:"source=breadcrumbs"})}return ao({queryString:C})},g=(o.clusterBreadcrumbs??[]).map(u);if(g.length===0){const I={name:Hst(o,r,e),link:o.type===Ut.FAVORITE?_m({queryString:"source=breadcrumbs"}):null};return s.jsx(UU,{breadcrumbsText:I,breadcrumbsClickAction:()=>d(0)})}const E=g.length-1,y=g[E];return s.jsxs(Q,{"data-test":"breadcrumb-header",wrap:"nowrap",children:[s.jsx(uot,{productId:n,breadcrumbsItems:g,breadcrumbsClickAction:d}),s.jsx(pe,{height:18,width:18,name:"arrow_right"}),s.jsx(UU,{breadcrumbsText:y,breadcrumbsClickAction:()=>d(E,y.id,y.name)})]})},mot=h.forwardRef((e,t)=>{const{isSSRNavigation:n}=e;if(n){const{children:c,href:d,isSSRNavigation:u,...p}=e;return s.jsx(bx.Link,{ref:t,asChild:!0,children:d?s.jsx(tt,{href:d,...p,children:c}):s.jsx("a",{...p,children:c})})}const{children:o,to:r,href:a,isSSRNavigation:i,...l}=e;return s.jsx(bx.Link,{ref:t,asChild:!0,children:r?s.jsx(Ye,{to:r,...l,children:o}):s.jsx("a",{...l,children:o})})}),hot=({intent:e})=>{const{formatMessage:t}=L(),n=e||"error",o={warning:t("accessibility.warning.message"),info:t("accessibility.info.message"),error:t("accessibility.error.message"),action:t("accessibility.action.message"),success:t("accessibility.success.message")};return s.jsx(ie,{children:o[n]})},got=h.forwardRef((e,t)=>s.jsx(bx,{...e,text:s.jsxs(ae.Fragment,{children:[s.jsx(hot,{intent:e.intent}),e.text]}),ref:t})),Te={...got,Link:mot},Eot=()=>{const{formatMessage:e}=L(),{product:{missingAmount:t,timeRestriction:n,timeRestricted:o,addedAmount:r,requestedAmount:a,reason:i,deliveryTimeRestrictionMessage:l},type:c}=ss();if(!(c==="slotbooking"||c==="order")||!i)return null;const p={OUT_OF_STOCK:{message:e("product.availability.out.of.stock",{itemQty:t}),type:"error"},EXCEEDED_MAX_QUANTITY:{message:e("fop.order.missing.label",{quantity:t}),type:"error"},TIME_RESTRICTION:(n||o)&&{message:l??e("fop.time.restriction",{to:n?.deliverableTo,from:n?.deliverableFrom}),type:"error"},LIMITED_AVAILABILITY:{message:e("product.availability.limited",{addedAmount:r,requestedAmount:a}),type:"error"}}[i];return p?s.jsx(Te,{intent:p.type,text:p.message,size:"s","data-test":"fop-status"}):null},_7=()=>{const e=F();return()=>{oKe(),e(a9(rKe()))}},b7=()=>{const e=f(Xe),t=Ne();return{setAgeConfirmation:_7(),redirectPath:(()=>{if(e)return null;const r=t.search.startsWith("?"),a=`destination=${encodeURIComponent(`${t.pathname}${t.search}${r?"&":"?"}${an.AGE_CONFIRMATION_COOKIE}=true`)}`;return Yo({queryString:a})})()}},HU=v(x)`
    ${({minWidth:e})=>e?`min-width: ${$(e)}`:""};
`,Tu=({buttonWidth:e,className:t,alertClassName:n,shouldRenderButton:o=!0})=>{const{setAgeConfirmation:r,redirectPath:a}=b7(),{formatMessage:i}=L(),l={button:i("alcohol.age.confirmation.button.label"),alert:i("alcohol.age.confirmation.fop.description"),alertAccessibility:i("alcohol.age.confirmation.modal.accessibility.description"),buttonAccessibility:i("alcohol.age.confirmation.modal.accessibility.button.label")},c=()=>a?s.jsx(HU,{asChild:!0,intent:"secondary",fill:!e,minWidth:e,children:s.jsxs(tt,{href:a,intent:"ghost",children:[s.jsx(ie,{children:l.buttonAccessibility}),s.jsx(x.Text,{"aria-hidden":!0,children:l.button})]})}):s.jsxs(HU,{onClick:r,intent:"secondary",fill:!e,minWidth:e,children:[s.jsx(ie,{children:l.buttonAccessibility}),s.jsx(x.Text,{"aria-hidden":!0,children:l.button})]});return s.jsxs(Q,{direction:"column",justify:"space-between",gap:["sm"],gapSmUp:["md"],className:t,additionalCss:"flex: 1",children:[s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:l.alertAccessibility})}),s.jsx(Te,{size:"s",intent:"info",className:n,text:l.alert,"aria-hidden":!0}),o&&s.jsx(Q,{direction:"row",justify:e?"flex-end":"center",children:c()})]})},Op={OWN_LINE:"ownLine"},Cb=v.img`
    block-size: 100%;
    inline-size: 100%;
    background-color: ${({isLoading:e})=>e&&"var(--intent-secondary)"};
`,fot=()=>{const e=f(c=>D("di")(c)),[t,n]=h.useState(!0),o=()=>{n(!1)},{product:{image:r},config:a}=ss();if(!r)return null;if(!e)return s.jsx(Cb,{"data-test":"lazy-load-image",alt:r.description,src:r.src,onLoad:o,isLoading:t});if(!a)return s.jsx(Cb,{"data-test":"lazy-load-image",alt:r.description,src:r.src,srcSet:r.fopSrcset,sizes:`(max-width: ${Ke.sm}em) 136px, 175px`,onLoad:o,isLoading:t});const{portrait:{image:i},landscape:{image:l}}=a;return i?.resolution?.width||l?.resolution?.width?s.jsx(Cb,{"data-test":"lazy-load-image",alt:r.description,src:r.src,srcSet:r.fopSrcset,sizes:`(max-width: ${Ke.sm}em) ${l?.resolution?.width}px, ${i?.resolution?.width}px`,onLoad:o,isLoading:t}):null},x7=({data:e})=>e.draftBasket,yot=e=>x7(e)?.items||[],A7=(e,t)=>Y(yot,n=>n?.find(o=>o?.productId===t))(e),Iot=()=>Y(A7,e=>e?.quantity?.quantityInBasket??0),Sot=Iot(),_u="reg",uT="removeAllRegulars",mA=99,R7=[{value:"WEEKLY",translationId:"regular.addToRegularsForm.option.weekly"},{value:"FORTNIGHTLY",translationId:"regular.addToRegularsForm.option.fortnightly"},{value:"MONTHLY",translationId:"regular.addToRegularsForm.option.monthly"},{value:"TWO_MONTHLY",translationId:"regular.addToRegularsForm.option.bimonthly"}],Cot=D("pbpm"),vot=e=>async t=>{try{await t(ua.getDraftBasket(e))}catch{Z.error("request.error.title")}},Tot=e=>e.reduce((t,n)=>{const o=n?.product?.productId,r=t[o]??0,a=n?.product?.quantity??1;return{...t,[o]:r+a}},{}),D7=({updateDraftBasketAction:e,errorMessage:t})=>{let n=[];const o=l=>{n.push(l)},r=()=>{n=[]},i=Vr(async(l,c)=>{if(!n?.length||!n[0]?.draftBasketId)return;const d=n?.slice(),u=d[0]?.draftBasketId,p=Tot(d);r();const g=Object.keys(p).map(E=>({productId:E,quantity:p[E]}));try{const E=await l(e({items:g,draftBasketId:u})),y=c();if(Cot(y)){const{payload:{responseData:{pricingNotifications:I}}}=E;fu(I)}}catch{Z.error(t)}},250);return l=>(c,d)=>{const u=l?.draftBasketId,p=l?.product,g=p?.productId,E=p?.quantity;u&&g&&E&&(o(l),i(c,d))}},_ot=()=>D7({updateDraftBasketAction:ua.addItemsToDraftBasket,errorMessage:"basket.add.item.error"}),bot=()=>D7({updateDraftBasketAction:ua.removeItemsFromDraftBasket,errorMessage:"basket.remove.item.error"}),xot=(e,t,n)=>(o,r,a)=>i=>l=>{if(l===i)return;const c=l-i,d={position:r,section:a.section,product:{...o,quantity:Math.abs(c)},draftBasketId:n};c>0?e(d):t(d)},Pp={getDraftBasket:vot,createBatchAddToDraftBasket:_ot,createBatchRemoveFromDraftBasket:bot,updateDraftBasketQuantityFactory:xot},vS=(e,t)=>({...e,cmsProductAttributes:t&&t.type==="featured"?["featured"]:[]}),Aot=(e,t,n,o)=>(r,a,i)=>l=>c=>{if(c===l)return;const d=c-l,u=n!=="basket";d>0?e({page:n,position:a,section:i.section,addedByFunction:"FOP",...u&&{productListName:ks(n,o,i.section)},product:{...vS(r,i),quantity:d}}):t({page:n,position:a,section:i.section,addedByFunction:"FOP",product:{...vS(r,i),quantity:Math.abs(d)}})},pT=(e,{page:t,subPage:n,position:o,type:r,group:a})=>{const i=Ne(),l=f(T=>Da(T,e)),d=f(k5(i))?.productGroups[0]?.freeGifts?.promotions?.find(T=>T.products?.some(_=>_.productId===e))?.promotionId,u=f(Ov),p=F(),g=Pp.createBatchAddToDraftBasket(),E=ir.createBatchAddToBasket(),y=ir.createBatchRemoveFromBasket(),I=Pp.createBatchRemoveFromDraftBasket(),S=h.useCallback(T=>{const _=t!=="basket",A={page:t,position:o,section:a.section,isFreeGift:!!a.gifts,promotionId:d,addedByFunction:"FOP",..._&&{productListName:ks(t,n,a.section)},product:{...vS(l,a),quantity:T}};return p(r==="slotbooking"?g({...A,draftBasketId:u}):E(A))},[E,g,d,p,u,a,t,o,l,n,r]),C=h.useCallback(T=>{const _={page:t,position:o,section:a.section,isFreeGift:!!a.gifts,addedByFunction:"FOP",promotionId:d,product:{...vS(l,a),quantity:Math.abs(T)}};return p(r==="slotbooking"?I({..._,draftBasketId:u}):y(_))},[y,I,d,p,u,a,t,o,l,r]);return{addToBasket:S,removeFromBasket:C}},O7=()=>{const{product:{productId:e,maxQuantityReached:t,available:n,timeRestriction:o,timeRestricted:r,alternatives:a,retailerProductId:i},position:l,type:c}=ss(),d=ft(),u=f(A=>D("oosa")(A)),p=f(A=>D(_u)(A)),g=f(A=>c==="slotbooking"&&u?A7(A,e):bC(A,e),(A,R)=>A?.quantity.quantityInBasket===R?.quantity.quantityInBasket&&A?.quantity.maxQuantityReached===R?.quantity.maxQuantityReached);g&&g.quantity.maxQuantityReached===void 0&&mR(g,{quantity:{maxQuantityReached:t}});const E=g?.quantity.quantityInBasket,y=!g&&t,I=n,S=!I,C=!!r&&!!o,T=!!a?.length&&S;return{quantityInBasket:E,isMaxQuantityReachedButNotInBasket:y,isProductAvailable:I,isOutOfStock:S,isTimeRestrictedItem:C,productHasAlternatives:T,isRegularsOrderEnabled:p,productInBasket:g,showSubstitutesClickedEvent:(A=ct())=>{d({type:Jt.SHOW_SUBSTITUTES,productId:e,retailerProductId:i,totalCount:T?a.length:0,hideSubstitutes:!1,productSequence:l,pageEventId:A})}}},io=v(x)`
    min-block-size: ${({size:e})=>e==="s"&&$(30)};
    min-inline-size: ${({size:e})=>e==="s"&&$(30)};
`,VU=D("r.ppws"),WU=D("seo.rdbl"),YU=D("di"),P7=({category:e})=>(t,n)=>{const o=n(),r=VU(o)?Q6e:z6e,a={imageFormats:Hn(o)??[],isSEOReadableURLEnabled:WU(o),isDynamicImagesEnabled:YU(o)};return t(r({transformerConfig:a,category:e})).then(i=>{if(!i)return;let{payload:{responseData:l}}=i;VU(o)&&(l=yp(l,Hn(o)??[],WU(o),YU(o)));const{entities:c,result:{productGroups:d,missedPromotions:u}}=l;for(const p in c.product)c.product[p]===void 0&&delete c.product[p];return t(xt.setProducts(c)),u?.length&&t(fo.addMissedPromotions(u)),{products:Kp()(l),productGroups:d}})},Rot=({category:e})=>async t=>{const[n,o]=await Promise.allSettled([t(CN()),t(P7({category:e}))]);return n.status==="rejected"&&Ue.api.pushError(new Error(`Failed to fetch regulars ${n.reason}`)),o.status==="rejected"&&Ue.api.pushError(new Error(`Failed to fetch catalogue ${o.reason}`)),o.status==="fulfilled"?t(o8(o.value.productGroups)):null},mT={fetchRegularsCatalogueAndUpdateProducts:Rot,getRegularsCataloguePageCall:P7},N7=({size:e,productName:t,productId:n,productIndex:o,section:r,page:a})=>{const{formatMessage:i}=L(),l=F(),c=()=>{l(Xv({productId:n,productIndex:o,section:r,page:a}))};return s.jsx(io,{fill:!0,onClick:c,intent:"primary",size:e==="sm"?"s":"m",type:"button","data-test":"fop-regulars-button","aria-label":i("regular.addToRegulars.accessibility.button",{productName:t}),children:s.jsx(io.Text,{children:i("regular.addToRegularsForm.submit")})})},Dot=e=>{const t=F(),n=f(Ra),o=f(ho),r=a=>{const i=o.find(l=>l.productId===a.productId);return t(U.analyticsEvent({type:Is.REMOVE_ALL_REGULARS_FROM_BASKET,productId:a.productId,updateQuantity:-a.quantity,basketTotalAmount:n?.amount,basketTotalCurrency:n?.currency,retailerProductId:i?.retailerProductId,priceAmount:i?.price?.current.amount,priceCurrency:i?.price?.current.currency}))};return e.length?()=>e.forEach(a=>r(a)):void 0};function ef(){const e=F();return{addToRegularsModalDisplayed:({productId:c,retailerProductId:d})=>e(Sje({productId:c,retailerProductId:d})),removeAllRegularsModalDisplayed:()=>e(Cje()),removeAllRegularsFromBasketModalDisplayed:()=>e(vje()),productAddedToRegulars:({productId:c,retailerProductId:d,frequency:u,quantity:p})=>e(Tje({productId:c,retailerProductId:d,frequency:u,quantity:p})),productRemovedFromRegulars:({productId:c,retailerProductId:d,removeAll:u=!1})=>e(_je({productId:c,retailerProductId:d,removeAll:u})),toastNotificationDisplayed:c=>e(bje(c)),productUpdated:({productId:c,retailerProductId:d,parameter:u,previousValue:p,currentValue:g})=>e(ZF(u==="FREQUENCY"?{productId:c,retailerProductId:d,parameter:u,previousValue:p,currentValue:g}:{productId:c,retailerProductId:d,parameter:u,previousValue:p,currentValue:g}))}}const hT=()=>{const e=F();return{regularsGaEvent:o=>{const r={event:o.event,frequency:o.frequency,id:o.retailerProductId,index:o.productIndex,list:o.list,name:o.productName,quantity:o.quantity};te.sendEvent({GA:r,WA:null});const a=U.analyticsEvent({type:Is.REGULARS_GA_EVENT,...o});return e(a)},removeAllRegularsGaEvent:o=>{const r={event:"remove_all_regulars",count:o.count};te.sendEvent({GA:r,WA:null});const a=U.analyticsEvent({type:Is.REMOVE_ALL_REGULARS_GA_EVENT,...o});return e(a)}}},tf=()=>!!f(D(_u)),uL=()=>{const{search:e}=Ne(),t=F(),n=ef(),o=hT(),r=L(),a=Qe.parse(e)?.sublocationId;return async({productId:i,productName:l,onAfterRemoveSuccess:c,retailerProductId:d,frequency:u,quantity:p,productIndex:g,section:E,subPage:y,page:I})=>{const S=typeof a=="string"?a:void 0;try{await t(q6e(i)),I==="regulars"?await t(mT.getRegularsCataloguePageCall({category:S})):(t(yt.removeProductFromRegularsProductGroup(i)),t(xt.updateProducts({product:[{productId:i,regular:void 0}]}))),Z.success("regular.removeRegular.success",{ariaLabel:r.formatMessage("regular.removeRegular.success.accessibility.label",{productName:l})}),n.toastNotificationDisplayed("regularRemoved"),n.productRemovedFromRegulars({productId:i,retailerProductId:d}),o.regularsGaEvent({event:"remove_from_regulars",retailerProductId:d,productName:l,quantity:p,frequency:u,productIndex:g,list:ks(I,y,E)??""}),c?.()}catch(C){Z.error("regular.removeRegular.error"),Ue.api.pushError(C instanceof Error?C:new Error(`useRemoveRegular error: ${JSON.stringify(C)}`))}}},Oot=({onAfterRemoveSuccess:e}={})=>{const t=F(),n=uL();return async({regular:o,productId:r,retailerProductId:a,productName:i,page:l="",section:c="",productIndex:d,beforeOpeningAddToRegularsModal:u})=>{o?await n({productId:r,productName:i,retailerProductId:a,quantity:o.quantity,frequency:o.frequency,productIndex:d??0,page:l,section:c,onAfterRemoveSuccess:e}):(t(J.closeModal()),u?.(),t(Xv({productId:r,page:l,section:c,productIndex:d})))}},Pot=()=>{const e=F(),[t]=Ee([_u]),o=f(Xe)&&t;h.useEffect(()=>{o&&e(CN())},[])},Dm=(e,t)=>{const n=h.useRef(null),o=r=>{const{target:a}=r;n.current&&!n.current.contains(a)&&e()};return h.useEffect(()=>(document.addEventListener("click",o,{capture:!0}),()=>{document.removeEventListener("click",o,{capture:!0})}),t),n},Not=1500,Lot=D("sm.bnnr"),gT=()=>f(_de),L7=()=>{const e=navigator.userAgent;return/iPhone|iPad|iPod/.test(e)?"ios":/Android/.test(e)?"android":"other"},kot=()=>{const{hideTTL:e}=gT(),[t,n]=h.useState(!0);return h.useEffect(()=>{if(typeof window>"u")return;const r=Number(window?.localStorage?.getItem("sb:hiddenUntil"))||0;n(Vt.now()<r)},[]),{isDismissed:t,dismiss:()=>{const r=e?Number(e):1/0,a=Vt.now()+r;n(!0),window?.localStorage?.setItem("sb:hiddenUntil",String(a))}}},jot=(e,t)=>{const[n,o]=h.useState(!1);h.useEffect(()=>{typeof window>"u"||o(window?.localStorage?.getItem("sb:installed")==="true")},[]);const r=h.useCallback(()=>{if(!t||e==="other")return;const a=document.createElement("iframe");return a.hidden=!0,a.src=`${t}://`,document.body.appendChild(a),a},[t,e]);return h.useEffect(()=>{if(e==="other"||n||!t||typeof window>"u")return;let a=!1;const i=()=>{document.hidden&&(a=!0)};document.addEventListener("visibilitychange",i,{once:!0});const l=r(),c=setTimeout(()=>{document.removeEventListener("visibilitychange",i),l?.remove(),a&&(o(!0),window?.localStorage?.setItem("sb:installed","true"))},Not);return()=>{clearTimeout(c),document.removeEventListener("visibilitychange",i),l?.remove()}},[e,t,n,r]),n},Mot=()=>{const{androidAppFallbackUrl:e,androidCustomScheme:t,androidPackageName:n,iosAppStoreUrl:o}=gT();return{androidIntentUrl:t&&n&&e?`intent://open/#Intent;scheme=${t};package=${n};S.browser_fallback_url=${encodeURIComponent(e)};end`:void 0,iosAppStoreUrl:o}},wot=(e,t)=>!t||t.length===0?!0:new RegExp(t).test(e),Fot=()=>{const{appTitle:e,iosIconUrl:t,androidIconUrl:n,visiblePages:o}=gT(),{isDismissed:r,dismiss:a}=kot(),{pathname:i}=Ne(),l=f(Lot),c=wot(i,o),d=L7(),u=d==="ios",p=!/CriOS|FxiOS|EdgiOS|OPiOS|OPT\//i.test(navigator.userAgent)&&u,g=u?t:n,E=h.useMemo(()=>[e,g].every(Boolean),[e,g]);return{dismiss:a,isSmartBannerVisible:c&&l&&!p&&d!=="other"&&!r&&E}},Bot=v(rt.Container)`
    inline-size: 100%;
    min-inline-size: 0;
    position: relative;
`,pL=({initialFrequency:e,onSelect:t,isDisabled:n,ariaLabel:o,size:r,dropDownButtonId:a,options:i=R7})=>{const{formatMessage:l}=L(),[c,d]=h.useState(!1),[u,p]=h.useState(e),g=()=>d(!1),E=()=>d(!c),y=Dm(g,[c]),I=C=>l(i.find(T=>T.value===C)?.translationId||""),S=C=>{g(),C!==u&&(p(C),t(C))};return s.jsxs(Bot,{ref:y,children:[s.jsx(rt.TriggerDefaultButton,{size:r==="sm"?"s":"m",fill:!0,text:I(u),disabled:n,"data-synthetics":"header-frequency-select","data-test":"header-frequency-dropdown",onClick:E,isOpen:c,id:a,"aria-controls":"select-frequency-menu","aria-expanded":c,"aria-label":o,"aria-haspopup":"true",bordered:!0}),s.jsx(rt.Body,{isOpen:c,children:s.jsx(rt.Content,{children:s.jsx(Be,{"data-test":"select-frequency-menu",inline:!1,children:i.map(({translationId:C,value:T})=>s.jsx(Be.Item,{"data-test":"select-frequency-item",children:s.jsx(rt.ItemButton,{"data-test":`frequency-item-button-${T}`,onClick:()=>S(T),children:l(C)})},T))})})})]})};pL.dataTestId="fop-frequency-select";const Uot=v(Wo)`
    inline-size: ${({inlineSize:e})=>typeof e=="string"?e:$(e)};
    text-align: ${({textAlign:e})=>IE(e)};
`;function k7({name:e,textAlign:t="start",maxWidth:n="100%",allowZeroQuantity:o=!1,size:r,hasError:a,ariaLabel:i,isDisabled:l,initialQuantity:c,onQuantityChange:d,id:u,label:p}){const[g,E]=h.useState(c),y=h.useRef(null),I=R=>{switch(o){case!0:if(R<0)return 0;break;case!1:if(R<1)return 1;break;default:return R}return R},S=R=>R>mA?mA:R,C=R=>{let P=R;P=I(P),P=S(P),E(P)},T=R=>{const{key:P}=R;P==="Enter"&&y.current?.blur()},_=R=>{const{value:P}=R.target;if(P===""){E("");return}Number.isInteger(Number(P))?C(Number(P)):E(g)},A=()=>{g===""?E(c):d(Number(g))};return s.jsx(Uot,{label:p??"",hideLabel:!p,last:!p,ref:y,id:u,name:e,"data-test":"fop-quantity-input",type:"text",size:r,hasError:a,inlineSize:n,textAlign:t,disabled:l,"aria-label":i,value:g,input:{onBlur:A,onChange:_,onKeyDown:T},meta:{invalid:!1,touched:!1}})}const Got=({regularsUpdated:e,productName:t})=>{const{formatMessage:n}=L(),{parameter:o,newFrequency:r,newQuantity:a}=e,i=()=>{if(o==="FREQUENCY_CHANGED"){let l=R7.find(c=>c.value===r)?.translationId??"";return l=n(l),n("regular.frequency.update.success",{productName:t,frequency:l,quantity:a})}return n("regular.quantity.update.success",{productName:t,quantity:a})};return s.jsx(ie,{"aria-live":"polite",children:i()})},$ot=v.div`
    display: flex;
    gap: var(--salt-spacing-2);
    max-inline-size: 100%;
`;function j7({productId:e,retailerProductId:t,initialFrequency:n,initialQuantity:o,size:r="md",page:a,productIndex:i,section:l,subPage:c,productName:d}){const u=L(),p=F(),g=f(R=>e8e(R,e)),[E,y]=h.useState(null),I=ef(),S=hT(),C=uL();h.useEffect(()=>{y(null)},[]);const T=async(R,P)=>{g||(R.quantity===0?await C({productId:R.productId,productName:d,retailerProductId:t,quantity:o,frequency:R.frequency,page:a,section:l,subPage:c,productIndex:i}):p(K6e(R)).then(()=>{p(xt.updateProducts({product:[{productId:e,regular:R}]})),I.productUpdated(P),S.regularsGaEvent({event:"update_regulars",retailerProductId:t,productName:d,quantity:R.quantity,frequency:R.frequency,productIndex:i,list:ks(a,c,l)??""})}).catch(N=>{Ue.api.pushError(N instanceof Error?N:new Error(`handleUpdateRegular error: ${JSON.stringify(N)}`))}))},_=async R=>{await T({productId:e,quantity:R,frequency:n},{retailerProductId:t,productId:e,parameter:"QUANTITY",previousValue:o,currentValue:R}),y({parameter:"QUANTITY_CHANGED",newQuantity:R,newFrequency:n}),R>=mA&&(Z.info("regular.maxQuantity.success"),await I.toastNotificationDisplayed("regularQuantityError"))},A=async R=>{await T({productId:e,quantity:o,frequency:R},{retailerProductId:t,productId:e,parameter:"FREQUENCY",previousValue:n,currentValue:R}),y({parameter:"FREQUENCY_CHANGED",newFrequency:R,newQuantity:o})};return s.jsxs($ot,{"data-test":"fop-regulars-form",children:[E&&s.jsx(Got,{regularsUpdated:E,productName:d}),s.jsx(k7,{allowZeroQuantity:!0,maxWidth:40,textAlign:"center",onQuantityChange:_,ariaLabel:u.formatMessage("regular.quantity.ariaLabel",{productName:d}),initialQuantity:o,isDisabled:g,size:r}),s.jsx(pL,{onSelect:A,initialFrequency:n,isDisabled:g,ariaLabel:u.formatMessage("regular.frequency.ariaLabel",{productName:d}),size:r})]})}const Hot=Y(e=>e.data.products.productEntities,e=>{const t={};return Object.keys(e).forEach(n=>{const o=e[n];t[o.productId]=o.quantityRestrictionGroup}),t}),Vot=e=>e.data.basket.items.map(t=>({productId:t.productId,quantity:t.quantity.quantityInBasket})),Wot=Y([Vot,Hot],(e,t)=>{const n={};return e.forEach(o=>{const r=t[o.productId];if(!r)return;const i=(n[r.quantityRestrictionGroupId]??0)+r.contribution*o.quantity;n[r.quantityRestrictionGroupId]=i}),n}),Yot=(e,t)=>{if(!e.quantityRestrictionGroup)return!1;const n=t[e.quantityRestrictionGroup.quantityRestrictionGroupId];return n?n+e.quantityRestrictionGroup.contribution>100:e.quantityRestrictionGroup.contribution>100},M7=e=>Y([Wot,t=>Da(t,e)],(t,n)=>n?Yot(n,t):!1),ET=(e,t)=>e.data.products.productEntities[t].name,{Container:qot,Operator:Kot}=zi,zot=({size:e,icon:t,iconOnly:n})=>{const o=F(),{product:{productId:r},fopPositionOnPage:a,page:i,subPage:l,type:c,group:d}=ss(),{formatMessage:u}=L(),p={page:i,position:a,subPage:l,type:c,group:d},{addToBasket:g}=pT(r,p),E=f(I=>ET(I,r)),y=f(Ct);return s.jsx(qot,{size:e,"data-synthetics":`product-id:${r}`,"data-test":`add-free-gift-product-id:${r}`,children:s.jsxs(Kot,{type:"button",fullWidth:!n,appearance:"action",size:e,onClick:()=>(o(Hr.toggleFreeGiftSelected(r,d.promotionId,!0)),o(U.analyticsEvent({type:Zn.ADD_FREE_GIFT_CLICKED,description:"Select gift button clicked",pageEventAttributes:{orderId:y,productId:r}})),g(1)),"data-synthetics":"add-free-gift-button","data-test":"add-free-gift-button","aria-label":u("free.gift.select.button.label.alternative",{productName:E}),children:[t&&s.jsx(pe,{name:t.name,height:18}),!n&&u("free.gift.select.button.label")]})})},CI=v(x)`
    inline-size: 100%;
    min-block-size: auto;
`,{Container:Qot}=zi,Xot=({size:e})=>{const t=F(),{product:{productId:n},fopPositionOnPage:o,page:r,subPage:a,type:i,group:l}=ss(),{formatMessage:c}=L(),d={page:r,position:o,subPage:a,type:i,group:l},{removeFromBasket:u}=pT(n,d),p=f(y=>ET(y,n)),g=f(Ct),E={removeFromBasket:c("free.gift.unselect.button.label"),removeFromBasketAlternative:c("free.gift.unselect.button.label.alternative",{productName:p})};return s.jsx(Qot,{size:e,"data-synthetics":`product-id:${n}`,"data-test":`remove-free-gift-product-id:${n}`,children:s.jsx(CI,{intent:"secondary",onClick:()=>(t(Hr.toggleFreeGiftSelected(n,l.promotionId,!1)),t(U.analyticsEvent({type:Zn.REMOVE_FREE_GIFT_CLICKED,description:"Remove gift button clicked",pageEventAttributes:{orderId:g,productId:n}})),u(1)),"data-synthetics":"remove-free-gift-button","data-test":"remove-free-gift-button","aria-label":E.removeFromBasketAlternative,children:E.removeFromBasket})})},Zot=({productInBasket:e})=>{const{formatMessage:t}=L(),n=e?.quantity?.quantityInBasket||0,o=t("counter.quantity.description.alternative",{quantity:n});return s.jsx(bg,{message:o,productQuantity:n})},{Container:Jot}=zi,ert=({size:e,isSinglePromotionLimitReached:t,isAllPromotionsLimitReached:n})=>{const{formatMessage:o}=L(),r={limitReached:o("free.gift.limit.reached.button.label")};return s.jsx(Jot,{size:e,"data-test":"free-gift-limit-reached",children:s.jsxs(CI,{intent:"secondary","data-test":"fop-controls-limit-reached-button","aria-label":r.limitReached,onClick:()=>{t&&Z.info("free.gift.limit.reached.error.message"),n&&Z.info("free.gift.total.limit.reached.error.message")},children:[s.jsx(CI.Icon,{name:"info_default"}),s.jsx(CI.Text,{children:r.limitReached})]})})},{Container:trt}=zi,srt=({size:e,timeRestriction:t})=>{const{formatMessage:n}=L(),{product:{name:o,deliveryTimeRestrictionMessage:r}}=ss(),a={timeRestricted:n("fop.time.restricted"),timeRestrictedAccessibilityText:n("fop.time.restriction.accessibility.text",{productName:o,to:t?.deliverableTo||"",from:t?.deliverableFrom||""})},i=()=>{if(r){Z.warning({formattedMessage:r});return}t&&Z.warning({key:"fop.time.restriction.toast",substitutions:{to:t.deliverableTo,from:t.deliverableFrom}})};return s.jsx(trt,{size:e,children:s.jsxs(io,{intent:"secondary",size:e==="sm"?"s":"m",fill:!0,onClick:()=>i(),"data-test":"fop-controls-time-restricted-button","aria-label":a.timeRestrictedAccessibilityText,children:[s.jsx(io.Icon,{name:"slot"}),s.jsx(io.Text,{children:a.timeRestricted})]})})},{Container:nrt}=zi,ort=({size:e,sendAnalytics:t,icon:n})=>{const{formatMessage:o}=L(),r=f(d=>D("oosa")(d)),{product:{name:a}}=ss(),i={outOfStockMessage:o(r?"fop.no.alternatives.text":"fop.out.of.stock.button"),outOfStockAccessibilityMessage:o(r?"fop.no.alternatives.accessibility.text":"fop.out.of.stock.button.accessibility.text",{productName:a})},l=()=>{Z.warning("fop.no.alternatives.text.toast"),t()},c=()=>{Z.error("fop.oos.toast")};return s.jsx(nrt,{size:e,children:s.jsxs(io,{intent:r?"tertiary":"secondary",size:e==="sm"?"s":"m",fill:!0,onClick:()=>r?l():c(),"data-test":"fop-controls-no-alternatives-button","aria-label":i.outOfStockAccessibilityMessage,children:[n?.name&&s.jsx(io.Icon,{name:n.name}),s.jsx(io.Text,{children:i.outOfStockMessage})]})})},rrt=(e=":retailerProductId")=>`${ao()}/${e}/alternatives`,{Container:art}=zi,irt=({size:e,sendAnalytics:t,productId:n,type:o,icon:r,messageKey:a="fop.show.alternatives.text"})=>{const{formatMessage:i}=L(),l=f(C=>D("oosa")(C)),c=Ge(),d=F(),u=f(C=>Da(C,n));if(!u)return null;const{alternatives:p,retailerProductId:g,name:E}=u,y={showAlternativesMessage:i(a,{numberOfAlternatives:p?.length}),showAlternativesAccessibilityMessage:i("fop.show.alternatives.accessibility.text",{productName:E})},I=()=>{const C=ct();d(J.openModal(xp,{productId:n,retailerProductId:g,productName:E,type:o,pageEventId:C})),t(C)},S=()=>{const C=rrt(g);c(C)};return s.jsx(art,{size:e,"data-synthetics":`product-id:${n}`,children:s.jsxs(io,{intent:"secondary",size:e==="sm"?"s":"m",fill:!0,onClick:()=>l?I():S(),"data-test":"fop-controls-show-alternatives-button","aria-label":y.showAlternativesAccessibilityMessage,children:[r?.name&&s.jsx(io.Icon,{name:r.name}),s.jsx(io.Text,{children:y.showAlternativesMessage})]})})},{Container:lrt}=zi,crt=({size:e})=>{const{formatMessage:t}=L(),{product:{name:n}}=ss(),o={maxQuantityA11y:t("fop.max.quantity.accessibility.text",{productName:n}),maxQuantityLabel:t("fop.max.quantity.label")};return s.jsx(lrt,{size:e,children:s.jsxs(io,{intent:"secondary",size:e==="sm"?"s":"m",fill:!0,onClick:()=>Z.error("fop.max.quantity.toast.generic"),"data-test":"fop-controls-max-quantity-button","aria-label":o.maxQuantityA11y,children:[s.jsx(io.Icon,{name:"info_default"}),s.jsx(io.Text,{children:o.maxQuantityLabel})]})})};function hA(e){e==="FREE_GIFT"&&Z.info("free.gift.free.of.charge.notification")}const{Container:drt,CountInput:urt,CountInputContainer:prt,OperatorLeft:mrt,OperatorRight:vb}=zi,hrt=({size:e,productInBasket:t})=>{const{fopPositionOnPage:n,page:o,subPage:r,type:a,group:i,product:{restrictedVisibility:l,offer:c}}=ss(),d=h.useRef(null),{formatMessage:u}=L(),[p,g]=h.useState(!1),{productId:E,quantity:{quantityInBasket:y,maxQuantityReached:I}}=t,{addToBasket:S,removeFromBasket:C}=pT(E,{page:o,subPage:r,position:n,type:a,group:i}),{isOutOfStock:T}=O7(),_=f(oe=>ET(oe,E)),A=f(M7(E)),R=f(bR),P=0,N=1,k=y>=R||I,M={increaseQuantityTextAlternative:u("counter.increase.quantity.button.alternative.with.product",{productName:_}),decreaseQuantityTextAlternative:u("counter.decrease.quantity.button.alternative.with.product",{productName:_}),editQuantityTextAlternative:u("counter.edit.quantity.input.alternative.with.product",{productName:_}),maxQuantityA11y:u("fop.max.quantity"),ageRestricted:u("age.restricted.button")};h.useEffect(()=>{d.current&&(d.current.value=y.toString())},[y]);const w=oe=>{if(d.current&&(Number.isNaN(oe)||oe===y)){d.current.value=y.toString();return}const ye=oe-y;if(ye){if(oe<y){C(ye);return}hA(c?.type),S(ye)}},j=()=>{d.current&&d.current.select()},G=oe=>{oe.key==="Enter"&&d.current!==null&&d.current.blur(),oe.key==="Tab"&&W(oe)},W=oe=>{const ye=oe.target;if(d.current&&ye.valueAsNumber>R){d.current.value=R.toString(),w(R);return}if(d.current&&ye.valueAsNumber<P){d.current.value=P.toString(),w(P);return}w(ye.valueAsNumber)},H=()=>{document.activeElement===d.current&&g(!0)},K=oe=>{if(p){g(!1);return}hA(c?.type),S(oe)},X=oe=>{if(p){g(!1);return}C(oe)},q=()=>s.jsx(mrt,{type:"button",appearance:"action",size:e,onClick:()=>X(N),onMouseDown:H,"data-test":"counter:decrement","aria-label":M.decreaseQuantityTextAlternative,children:s.jsx(pe,{name:"minus",height:18})}),ne=()=>{if(l===CS.BLURRED_IMAGE)return s.jsx(JE,{ariaLabel:M.ageRestricted,children:s.jsx(vb,{type:"button",appearance:"action","data-test":"counter:max-quantity",size:e,"data-synthetics":"add-button","aria-hidden":!0,children:s.jsx(pe,{name:"info_default",height:18})})});if(A||k||T){const oe=T?"fop.oos.toast":"fop.max.quantity.toast.generic";return s.jsx(vb,{type:"button",appearance:"action",onClick:()=>Z.error(oe),"data-test":"counter:max-quantity",size:e,"data-synthetics":"add-button","aria-label":M.maxQuantityA11y,children:s.jsx(pe,{name:"info_default",height:18})})}return s.jsx(vb,{appearance:"action",onClick:()=>K(N),onMouseDown:H,size:e,"data-test":"counter:increment","data-synthetics":"add-button","aria-label":M.increaseQuantityTextAlternative,children:s.jsx(pe,{name:"plus",height:18})})},ue=()=>s.jsx(prt,{children:s.jsx(urt,{defaultValue:y,type:"number",min:P,max:R,onBlur:W,onKeyDown:G,onClick:j,ref:d,"aria-label":M.editQuantityTextAlternative,"data-test":"quantity-in-basket","data-synthetics":"quantity-in-basket"})});return s.jsxs(drt,{size:e,"data-synthetics":`product-id:${E}`,children:[q(),ue(),ne()]})},{Container:grt,Operator:Ert}=zi,frt=({size:e,icon:t})=>{const{product:{productId:n,offer:o},fopPositionOnPage:r,page:a,subPage:i,type:l,group:c}=ss(),{formatMessage:d}=L(),u={page:a,position:r,subPage:i,type:l,group:c},{addToBasket:p}=pT(n,u),g=f(E=>ET(E,n));return s.jsx(grt,{size:e,"data-synthetics":`product-id:${n}`,children:s.jsxs(Ert,{type:"button",fullWidth:!0,appearance:"action",size:e,onClick:()=>(hA(o?.type),p(1)),"data-synthetics":"add-button","data-test":"counter-button","aria-label":d("fop.add.button.alternative",{productName:g}),children:[t&&s.jsx(pe,{name:t.name,height:18}),d("fop.add.button")]})})},yrt=({size:e})=>{const{formatMessage:t}=L(),n={ageRestricted:t("age.restricted.button")};return s.jsx(JE,{ariaLabel:n.ageRestricted,children:s.jsxs(io,{intent:"secondary",size:e==="sm"?"s":"m",fill:!0,"data-test":"fop-controls-age-restricted-button","aria-hidden":!0,tabIndex:-1,children:[s.jsx(io.Icon,{name:"info_default"}),s.jsx(io.Text,{children:n.ageRestricted})]})})},w7=({size:e="md"})=>{const{product:{productId:t,retailerProductId:n,timeRestriction:o,restrictedVisibility:r,regular:a,name:i,deliveryTimeRestrictionMessage:l},fopPositionOnPage:c,page:d,type:u,group:p,subPage:g}=ss(),{quantityInBasket:E,isMaxQuantityReachedButNotInBasket:y,isProductAvailable:I,isOutOfStock:S,isTimeRestrictedItem:C,productHasAlternatives:T,isRegularsOrderEnabled:_,productInBasket:A,showSubstitutesClickedEvent:R}=O7(),P=f(M=>M.data.basket.items.some(w=>w.productId===t)),N=f(M7(t));if(r===CS.BLURRED_IMAGE&&!A)return s.jsx(yrt,{size:e});if(I&&(C||l))return s.jsx(srt,{timeRestriction:o,size:e});if(_&&d==="regulars"){if(u==="regular"&&a){const{frequency:M,quantity:w}=a;return s.jsx(j7,{productId:t,retailerProductId:n,productName:i,initialFrequency:M,initialQuantity:w,size:e,section:p.section,page:d,subPage:g,productIndex:c})}return s.jsx(N7,{size:e,productId:t,productName:i,page:d,section:p.section,productIndex:c})}if(S&&!A)return T?s.jsx(irt,{productId:t,type:u,size:e,sendAnalytics:R}):s.jsx(ort,{sendAnalytics:R,size:e});const k=()=>{if(I&&y&&!T||N&&!P)return s.jsx(crt,{size:e});if(p.gifts){const j=(p.gifts.isSinglePromotionLimitReached||p.gifts.isAllPromotionsLimitReached)&&!p.gifts.selectedGifts?.[t];return p.gifts.selectedGifts?.[t]?s.jsx(Xot,{size:e}):j?s.jsx(ert,{size:e,isSinglePromotionLimitReached:p.gifts?.isSinglePromotionLimitReached,isAllPromotionsLimitReached:p.gifts?.isAllPromotionsLimitReached}):s.jsx(zot,{size:e})}return I&&!E?s.jsx(frt,{size:e}):s.jsx(hrt,{productInBasket:A,size:e})};return s.jsxs(h.Fragment,{children:[s.jsx(Zot,{productInBasket:A}),k()]})},gA=()=>{const{sendFopImpressionEvent:e,onFopContainerClick:t}=eL(),[n]=Ee(["fop.n.img"]),{product:{productId:o,alcohol:r,name:a},customStyling:i,displayLandscapeLayout:l,withoutHeader:c,config:d,layoutType:u,ref:p,hasBeenViewed:g}=ss();h.useEffect(()=>{e()},[g]);const E=f(W=>xC(W,o))>0;if(!d)return null;const{portrait:{image:y,controlsContainer:I,packSize:S,price:C},landscape:{image:T,controlsContainer:_,packSize:A,price:R}}=d,P=l?T?.link:y?.link,N=S?.position===Op.OWN_LINE,k=A?.position===Op.OWN_LINE,M=l?k:N,w=l?_?.position==="priceLine":I?.position==="priceLine",j=l?R?.direction:C?.direction,G=l?d?.landscape?.controlsContainer?.size:d?.portrait?.controlsContainer?.size;return s.jsxs(y7,{ref:p,layoutType:u,displayLandscapeLayout:l,"data-test":`fop-wrapper:${o}`,"data-retailer-anchor":"fop","data-layout":u,customStyling:i,config:d,inCart:E,isStacked:M,onClick:t,children:[!c&&s.jsxs("div",{className:"outer-header-container",children:[s.jsx(Eot,{}),s.jsx(pot,{})]}),s.jsx(Ji,{isActive:r,overlay:s.jsx(Tu,{className:"salt-p--2"}),children:({blurClassName:W,aria:H})=>s.jsxs("div",{className:`product-card-container ${W||""}`,...H??{},children:[s.jsxs("div",{className:"header-container",children:[s.jsx("div",{className:"position-relative",children:s.jsxs("div",{className:"top-icons-container",children:[s.jsx(qnt,{}),s.jsx(Qnt,{})]})}),s.jsxs("div",{className:"image-container",children:[P&&s.jsx(JE,{tabIndex:-1,className:"image-link-concealed",ariaHidden:!0,children:s.jsx(ie,{children:a})}),n?s.jsx(fot,{}):s.jsx(v7,{})]}),s.jsx("div",{className:"attributes-container",children:s.jsx(Nnt,{})})]}),s.jsxs("div",{"data-test":"fop-body",className:"footer-container",children:[s.jsxs(Q,{direction:"column",gap:["xs"],children:[s.jsx("div",{className:"title-container",children:s.jsx(S7,{})}),s.jsx("div",{className:"promotion-container","data-retailer-anchor":"fop-promotions",children:s.jsx(ont,{})}),M&&s.jsx(pA,{}),s.jsx(dL,{})]}),s.jsxs(Q,{direction:w?"row":"column",align:w?"flex-end":"inherit",justify:"flex-end",gap:["xs",null],children:[s.jsxs("div",{className:"price-pack-size-container",children:[s.jsx(cL,{direction:j}),!M&&s.jsx(pA,{})]}),s.jsxs("div",{className:"controls-container",children:[s.jsx(w7,{size:G})," "]})]})]})]})})]})},Irt={s:"textS",m:"textM",l:"textL",xl:"displayS"},qU=()=>{const{displayLandscapeLayout:e,config:t,customStyling:n,withoutHeader:o,layoutType:r,ref:a}=ss();if(!t)return null;const{portrait:{controlsContainer:i,packSize:l,price:c,referencePrice:d},landscape:{controlsContainer:u,packSize:p,price:g,referencePrice:E}}=t,y=l?.position===Op.OWN_LINE,I=p?.position===Op.OWN_LINE,S=e?I:y,C=e?u?.size:i?.size,T=e?u?.position==="priceLine":i?.position==="priceLine",_=e?g?.fontSize:c?.fontSize,A=Es(e?p?.fontSize:l?.fontSize),R=Es(e?E?.fontSize:d?.fontSize),P=k=>k?Irt[k]:"textS",N=()=>C==="sm"?"s":"m";return s.jsxs(y7,{ref:a,customStyling:n,"data-test":"fop-skeleton",layoutType:r,config:t,inCart:!1,"data-retailer-anchor":"fop-skeleton",displayLandscapeLayout:e,children:[!o&&!e&&s.jsx(Ib,{height:20}),s.jsxs("div",{className:"product-card-container",children:[s.jsxs("div",{className:"header-container",children:[s.jsx("div",{className:"image-container",children:s.jsx(uc,{})}),s.jsx("div",{className:e?"position-absolute":"position-relative",children:s.jsxs("div",{className:"attributes-container",children:[s.jsx(Ib,{height:20,className:"salt-m-b--1"}),s.jsx(Ib,{height:20,className:"salt-m-t--1"})]})})]}),s.jsxs("div",{"data-test":"fop-body",className:"footer-container",children:[s.jsx("div",{className:"title-container",children:s.jsx(uc,{height:"100%"})}),s.jsx("div",{className:"promotion-container",children:s.jsx(uc,{height:"100%"})}),S&&s.jsx(xU,{fontSize:A,children:s.jsx(tc,{variant:P(A)})}),R&&s.jsx(xU,{fontSize:R,children:s.jsx(tc,{variant:P(R)})}),s.jsxs(Q,{direction:T?"row":"column",align:T?"flex-end":"inherit",gap:["xs",null],children:[s.jsxs("div",{className:"price-pack-size-container",children:[s.jsx(_nt,{fill:50,fontSize:_||"s"}),!S&&s.jsx(bnt,{fontSize:A||"s"})]}),s.jsx("div",{className:"controls-container",children:s.jsx(z9,{fill:!0,size:N()})})]})]})]})]})},ea=h.memo(({loading:e,buildFopContextIfEmpty:t=!0,...n})=>{const{page:o,productId:r,product:a}=n,i=f(D("new.prl")),l=f(Rt),c=XN({page:o,productId:r,product:a});return l&&!c&&!i&&!t?null:i?s.jsxs(lT,{...n,product:c,children:[e&&s.jsx(qU,{}),!e&&c&&s.jsx(gA,{})]}):s.jsxs(Ost,{...n,product:c,children:[e&&s.jsx(qU,{}),!e&&c&&s.jsx(gA,{})]})}),Srt=()=>{const{retailerProductId:e}=nn(),t=F(),n=f(Rt),{productList:o}=VE(),r=f(Q6);h.useEffect(()=>{!n&&!r.isFetching&&t(B9(e))},[n]);const a=()=>{const l=e===r.active,c=r?.data?.alternatives?.length>0;return l&&c};if(!r.error&&r.isFetching)return null;if(!a())return s.jsx(ot,{});const i=r.data.alternatives.map(l=>l&&l.productId)||[];return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"alternative.products.page.title"}),s.jsx(sn,{children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"alternative.products.heading",values:{product:r.data.name}})})}),s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx("div",{className:"salt-m--4",children:s.jsx(U9,{mobileGap:o?o.landscape.gap:"md",gap:o?o.portrait.gap:"md",children:i.map((l,c)=>s.jsx(ea,{productId:l,group:{type:"group",section:"group",products:i,clusterBreadcrumbs:[],name:"alternatives"},page:"alternatives",type:"catalogue",loading:r.isFetching,position:c,withoutHeader:!0,subPage:null,fopPositionOnPage:c,noOfferLink:!1},l))})})]})},F7=()=>s.jsx(Et,{type:"Alternatives::route",children:s.jsx(Srt,{})});F7.fetchData=async({store:e,params:t})=>{await e.dispatch(B9(t.retailerProductId))};const Crt=e=>[{path:"/products/:retailerProductId/alternatives",Component:e.Main,key:"main",children:[{index:!0,Component:F7}]}],vrt=()=>{const e=f(At)||"",t=Ne();return s.jsx(cA,{to:`${e}${t.pathname}${t.search??""}`})},KU=()=>s.jsx(Et,{type:"ExternalRedirectToCurrentPath::route",children:s.jsx(vrt,{})}),Trt=()=>[{path:"/login",Component:KU},{path:"/register",Component:KU}],_rt=()=>{const e=f(WV);return s.jsx(En,{to:cn(e)})},brt=D("fppco"),xrt=e=>{const t=e>1?"logged.in.home.page.payment.failed.multiple.text":"logged.in.home.page.payment.failed.text";return s.jsx(b,{id:t})},Art=(e,t)=>{const n={event:"event",eventCategory:"Payment",eventAction:"failedPaymentWarningAlertLinkClicked",eventLabel:t};te.sendEvent({GA:n,WA:null}),e.analyticsEvent({type:Ot.FAILED_PAYMENT_WARNING_ALERT_LINK_CLICKED,pathname:t})},Rrt=(e,t,n)=>{if(!n?.orderId)return null;const{orderId:o}=n,r=Dc({orderId:o}),a=s.jsx(b,{id:"payment.failed.page.link.text"});return s.jsx(Te.Link,{to:r,"data-test":"failed-payment-alert-link",onClick:()=>Art(e,t),children:a})};class Drt extends h.PureComponent{static defaultProps={isFailedPaymentPreventCheckoutFeatureEnabled:!1,oldestOrderWithFailedPayment:void 0};componentDidMount(){if(this.props.isFailedPaymentPreventCheckoutFeatureEnabled&&this.props.numFailedPaymentOrders>0){this.props.actions.analyticsEvent({type:Ot.FAILED_PAYMENT_WARNING_ALERT,pathname:this.props.pagePath});const t={event:"event",eventCategory:"Payment",eventAction:"failedPaymentWarningAlert",eventLabel:this.props.pagePath};te.sendEvent({GA:t,WA:null})}}render(){const{actions:t,isFailedPaymentPreventCheckoutFeatureEnabled:n,numFailedPaymentOrders:o,oldestOrderWithFailedPayment:r,pagePath:a}=this.props;if(!n||!o)return null;const i=Rrt(t,a,r),l=xrt(o);return s.jsx(Te,{text:l,link:i,"data-test":"failed-payment-alert",className:"salt-m-b--4"})}}const Ort=e=>({isFailedPaymentPreventCheckoutFeatureEnabled:brt(e),numFailedPaymentOrders:Vv(e),oldestOrderWithFailedPayment:Wv(e),pagePath:tm(e)}),Prt=st({analyticsEvent:U.analyticsEvent}),B7=we(Ort,Prt)(Drt),Nrt={hasRedirect:!1},zU="failed-paymnet-modal-header",fT=({hasRedirect:e})=>{const t=Ge(),n=f(D(KP)),o=f(e4e),r=f($e("failedPayment")),a=f(tm),i=F(),l=()=>i(J.closeModal()),c=()=>{i(U.analyticsEvent({type:Ot.FAILED_PAYMENT_WARNING_MODAL,payload:{pathname:a}}))},d=()=>{i(U.analyticsEvent({type:Ot.BACK_TO_SHOP,description:"User clicked back to shop button in failed payment modal",pageEventAttributes:{componentLocation:"Body",componentType:"Modal",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),t(fn()),l()},u=()=>{i(U.analyticsEvent({type:Ot.FAILED_PAYMENT_WARNING_MODAL_UPDATE_PAYMENT_DETAILS_BUTTON_CLICKED})),t(Dc({orderId:o})),l()};return s.jsxs(B,{isOpen:r,onAfterOpen:c,aria:{labelledby:zU},children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:zU,children:s.jsx(b,{id:"payment.failed.modal.title"})})}),s.jsx(B.Body,{children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Q,{justify:"center",children:s.jsx("div",{className:"salt-m-b--4",children:s.jsx(pe,{error:!0,name:"status_no",height:82,width:82})})})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Te,{showIcon:!1,className:"salt-m-b--4",text:s.jsxs(ae.Fragment,{children:[s.jsx(b,{id:"payment.failed.declined.text",values:{orderId:123}})," ",s.jsx(b,{id:"payment.failed.modal.update.text"})]})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx("div",{className:"salt-m-t--2",children:e?s.jsx(x,{"data-test":"back-to-shop-button",fill:!0,intent:"secondary",onClick:d,children:s.jsx(b,{id:"payment.failed.modal.back.button.text"})}):s.jsx(x,{"data-test":"close-button",fill:!0,intent:"secondary",onClick:l,children:s.jsx(b,{id:"payment.failed.modal.close.button.text"})})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{className:"salt-m-t--2","data-test":"update-payment-details-button",fill:!0,intent:"primary",onClick:u,children:s.jsx(b,{id:"payment.failed.modal.update.button.text"})})})]})})]})};fT.defaultProps=Nrt;const Lrt=D("m.la.h"),Om=()=>f(e=>Lrt(e)),Pm=e=>f($e(e)),Fl=()=>{const e=F();return h.useCallback(()=>e(J.closeModal()),[e])},yo=()=>{const e=F();return h.useCallback(t=>e(U.analyticsEvent(t)),[e])},Nm=e=>f(t=>e(t)),mL=()=>{const e=He(),t=F(),n=f(Wn(["sumsub","bt.spl"])),o=f(D("mins"));return h.useCallback(({basketSummary:r,type:a})=>{const i=r.totals?.display?.itemPriceAfterPromos,l=r?.checkout?.minimumCheckoutThreshold,c=r.totals?.remainingAmountToMinimumCheckoutThreshold,d=!r?.checkout?.basketAboveThreshold;if(!l||!d||!i)return;const u=e(l);let p="";if(t(U.analyticsEvent({type:Re.MINIMUM_BASKET_VALUE_NOT_REACHED_NOTIFICATION_DISPLAYED,minimumBasketValueAmount:l.amount,basketValueAmount:i.amount,basketValueCurrency:i.currency})),c&&(p=e(c)),o&&c){Z[a]({key:"basket.below.minimum.threshold.error.toast",substitutions:{minimumThreshold:u,missingAmount:p}});return}if(n&&c){Z[a]({key:"basket.below.threshold.with.remaining.value.error",substitutions:{threshold:u,remaining:p}});return}Z[a]({key:"basket.below.threshold.error",substitutions:{threshold:u}})},[t,e,o,n])},U7=()=>{const e=f(D("alc.blur")),t=f(Uye),n=f(HQ);return e&&t&&!n},krt=()=>f(Hi),jrt=()=>f(D("et.hcb")),Tb="deliveryPriceModificationLevelsNotification",Mrt=(e,t)=>{if(!e||!t)return!1;let n=null;try{const o=localStorage?.getItem(Tb);o&&(n=JSON.parse(o)?.[t]??null)}catch{localStorage?.removeItem(Tb)}return n===e?!0:(localStorage?.setItem(Tb,JSON.stringify({[t]:e})),!1)},wrt=e=>{if(typeof e!="object"||e===null)return!1;const t=e;return typeof t.type=="string"&&["success","error","warning","info"].includes(t.type)&&typeof t.message=="string"},os=({breakpoint:e})=>{const{currentBreakpoint:t}=h.useContext(kn);return mg({currentBreakpoint:t,breakpoint:e})},Frt=e=>{const t=F(),n=yo(),o=f(Xe);return h.useCallback(()=>{const r=e!==Hs.GRID?Hs.GRID:Hs.DETAIL;o&&t(za.updateCustomerPreferenceBasketView(r)),t(za.setCustomerPreferenceBasketView(r)),n({type:Re.TROLLEY_VIEW_CHANGE_VIEW_TYPE_BUTTON_CLICKED,description:"Trolley page view type change",pageEventAttributes:{componentLocation:"Body",componentType:"FOP",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})},[n,t,o,e])},EA=()=>{const{formatMessage:e}=L(),t=f(BC),n=Frt(t),[o]=Ee(["thcu"]),r=os({breakpoint:"lg-up"}),a=o&&r,{iconName:i,dataTest:l,messageId:c}=t!==Hs.GRID?{iconName:Gx[Hs.GRID],dataTest:"toggle-grid-button",messageId:$x[Hs.GRID]}:{iconName:Gx[Hs.DETAIL],dataTest:"toggle-details-button",messageId:$x[Hs.DETAIL]};return s.jsxs(x,{onClick:n,intent:o?"tertiary":"secondary","data-test":l,"aria-label":e(c),children:[s.jsx(x.Icon,{name:i}),!a&&s.jsx(x.Text,{children:s.jsx(b,{id:c})})]})};function yT(e){return(e.data.products.basket.data?.productGroups||[]).find(o=>o?.type==="regular")?.products||[]}const G7=(e,t)=>e.map(n=>({product:t[n.productId],quantity:n.quantity})).filter(n=>!!n.product).map(({product:n,quantity:o})=>{const r=n?.offers?.map(a=>a.description).join(",");return{...n,quantity:o,promotionNames:r,cmsProductAttributes:[]}}),Brt=(e,t)=>e.filter(n=>t.includes(n.productId)),$7=e=>{const t=f(ho),n=f(ts),o=f(yT),r=e?Brt(t,o):t;return h.useMemo(()=>G7(r,n),[r,n])},Urt=()=>{const e=F(),t=$7(),n=f(Qs);return h.useCallback(async()=>{const o=await e(ir.emptyBasket());if(!o)return;const r=Bv({products:t,basket:o,page:"BASKET",addedByFunction:"EMPTY_CART",productListName:"basket: other"});te.sendEvent({GA:r,WA:null}),Uv({products:t,basket:o,page:"BASKET",addedByFunction:"EMPTY_CART",productListName:"basket: other",featuredProductCampaigns:n}).forEach(l=>{te.sendEvent({GA:l,WA:null})}),e(U.analyticsEvent({type:Re.REMOVE_BASKET_ITEM,basket:o,page:"BASKET",addedByFunction:"EMPTY_CART",product:t,productListName:"basket: other"}));const{pricingNotifications:i}=o;i&&e(yu(i))},[e,t])},Grt=()=>{const e=Urt(),t=Fl(),n=F();return h.useCallback(()=>{e(),n(U.analyticsEvent({type:Re.EMPTY_BUTTON_CLICKED})),n(U.analyticsEvent({type:Re.EMPTY_BASKET}));const o={event:"event",eventCategory:"Basket",eventAction:"EMPTY_BASKET",eventLabel:"Not Set"};te.sendEvent({GA:o,WA:null}),t()},[t,n,e])},$rt=()=>{const e=L();return h.useMemo(()=>({heading:e.formatMessage("basket.header.empty.modal.heading"),empty:e.formatMessage("basket.header.empty.modal.empty"),cancel:e.formatMessage("basket.header.empty.modal.cancel")}),[e])},QU="empty-basket-modal-header",Hrt="emptyBasket",Vrt=()=>{const e=Fl(),t=Pm(Hrt),n=Om(),o=$rt(),r=Grt();return s.jsxs(B,{isOpen:t,onRequestClose:e,aria:{labelledby:QU},children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h1",id:QU,children:o.heading})}),s.jsx(B.Body,{children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{fill:!0,intent:"secondary",onClick:e,children:s.jsx(x.Text,{children:o.cancel})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{fill:!0,intent:"primary","data-synthetics":"basket-confirm-empty",onClick:r,children:s.jsx(x.Text,{children:o.empty})})})]})})]})};class Wrt{callbacks;channel;constructor(){this.channel=new MessageChannel,this.channel.port1.onmessage=this.flushCallbacks,this.callbacks=[]}flushCallbacks=()=>{const t=this.callbacks;this.callbacks=[];const n=typeof window>"u"?void 0:window?.performance?.now();for(let o=0;o<t.length;o+=1)t[o](n)};handlePostMessage=()=>this.channel.port2.postMessage(void 0);runAfterFramePaint=t=>{this.callbacks.push(t)===1&&requestAnimationFrame(this.handlePostMessage)}}let _b;const ds=({name:e,attributes:t,event:n,variant:o})=>{const r=n&&n.timeStamp;return(a,i)=>{if(typeof window>"u"||!window.performance)return!1;_b||(_b=new Wrt);const l=i(),c=Nn(l),d=_c(l),u=D("faro")(l),p=tV(l);return _b.runAfterFramePaint(g=>{if(eV(i()))return;const E=r||g||window.performance.now(),y={type:aO.PERFORMANCE,description:`Performance mark for ${e}`,pageViewId:c,sessionId:d,pageEventAttributes:{name:e,timestamp:E,...t}};if(u&&gAe(e)){const I=IC(l),S=xr(l)!==void 0;qY({name:e,timestamp:E,isFullPageLoad:I,isUserLoggedIn:S,reportingLevel:p,variant:o})}a(U.analyticsEvent(y))})}},IT=e=>{const t=F();return h.useCallback(()=>t(J.openModal(e)),[t,e])},Yrt=()=>{const e=F();return h.useCallback(t=>e(ir.instantShopRemoveFromBasket(t)),[e])},qrt=({location:e,setInstantShopProductsRemoved:t})=>{const n=Yrt(),o=e.state?.addedProducts||[];return h.useCallback(()=>{const r=o.reduce((a,i)=>({items:[...a.items,{productId:i.productId,quantity:i.quantity}],decoratedItems:[...a.decoratedItems,{product:i,page:"basket"}]}),{items:[],decoratedItems:[]});n(r).then(()=>t(!0)).catch(()=>{})},[n,o,t])},Krt=()=>{const e=F();return h.useCallback(()=>e(ds({name:eAe})),[e])},zrt=(e,t)=>!!t.find(n=>n===e),Qrt=({productIdsToSort:e,idsToCompare:t})=>{const[n,o]=e.reduce((r,a)=>(r[zrt(a,t)?0:1].push(a),r),[[],[]]);return n.concat(o)},Xrt=e=>e.map(({productId:t,quantity:{quantityInBasket:n}})=>({productId:t,quantity:n})),Zrt=(e,t)=>e.filter(n=>!!t.find(o=>o===n.productId)),Jrt=()=>{const e=f(yT),t=f(_l);return Zrt(Xrt(t),e)},eat=()=>{const e=F(),t=Jrt(),n=Dot(t),o=$7(!0),r=f(Qs);if(t?.length)return async()=>{const a=await e(ir.removeBasketItems(t));if(!a)return;n?.(),e(yu(a?.pricingNotifications,!0));const i=Bv({products:o,basket:a.basket,page:"BASKET",addedByFunction:"REMOVE_REGULARS",productListName:"basket: other"});te.sendEvent({GA:i,WA:null}),Uv({products:o,basket:a.basket,page:"BASKET",addedByFunction:"REMOVE_REGULARS",productListName:"basket: other",featuredProductCampaigns:r}).forEach(c=>{te.sendEvent({GA:c,WA:null})}),e(U.analyticsEvent({type:Re.REMOVE_BASKET_ITEM,basket:a.basket,page:"BASKET",addedByFunction:"REMOVE_REGULARS",product:o,productListName:"basket: other"}))}},tat=()=>{const e=f(Wn(["bt.view.dd","bt.spl"])),t=os({breakpoint:"lg-up"}),n=f(BC);return e&&!t?n:n===Hs.GRID?Hs.GRID:Hs.DETAIL},XU="basket.header.empty.trolley",H7=()=>{const{formatMessage:e}=L(),t=IT("emptyBasket"),[n]=Ee(["thcu"]),o=os({breakpoint:"lg-up"}),r=n&&o;return s.jsxs(h.Fragment,{children:[s.jsxs(x,{"data-synthetics":"empty-basket-form",onClick:t,intent:n?"tertiary":"secondary","aria-label":e(XU),children:[s.jsx(x.Icon,{name:"trolley_empty"}),!r&&s.jsx(x.Text,{children:s.jsx(b,{id:XU})})]}),s.jsx(Vrt,{})]})},ZU=()=>s.jsx(ee,{as:"h1","data-test":"basket-page-header",children:s.jsx(b,{id:"basket.header.heading"})}),sat=()=>{const[e]=Ee(["thcu"]),t=os({breakpoint:"lg-up"}),n=f(Hi);return e&&t&&n?s.jsxs(Q,{justify:"space-between",align:"center",wrap:"nowrap",children:[s.jsx(ZU,{}),s.jsxs(Q,{justify:"center",align:"center",wrap:"nowrap",className:"salt-gap--4",children:[s.jsx(H7,{}),s.jsx(EA,{})]})]}):s.jsx(ZU,{})},V7=()=>{const e=F(),t=f(Qs);return{viewCartGa4Event:o=>{const{payload:r,cartType:a,meta:i}=o,l=r.map(c=>(sYe({...c,currencyCode:c.currencyCode,cartType:a,meta:i,featuredProductCampaigns:t}).forEach(u=>{te.sendEvent({GA:u,WA:null})}),e(U.analyticsEvent({type:Re.VIEW_CART,...c,cartType:a,meta:i}))));return Promise.all(l)}}},nat=(e,t,n)=>{const o=e?.totals?.display?.itemPriceAfterPromos||null,r=e?.orderId||null,a=e?.activeCheckoutGroupId||null;return{currencyCode:o?.currency||null,total:o?.amount||null,orderId:r,groupId:a,products:G7(e.items,t),page:n}},oat=()=>{const t=f(Xe)?"logged-in-homepage":"logged-out-homepage",{pathname:n}=Ne(),[,o]=n.split("/");return h.useMemo(()=>o||t,[t,o])},W7=()=>{const e=h.useRef(!1),t=oat(),n=h.useCallback(()=>{e.current=!0},[]),o=f(u=>is(u)),r=f(ts),i=!!o?.checkoutGroups?.length?o?.checkoutGroups||[]:[o],l=i?.map(u=>nat(u,r,t))||[],c=i?.every(u=>u?.items?.every(p=>!!r?.[p?.productId])??!1)??!1,d=!!l?.length&&c&&!e.current;return{data:l,canSendEvent:d,setIsEventSent:n}},rat=({data:e})=>{const{placement:t,settings:n,isFetching:o}=e.adverts.cartPage;return[(t.belowGrid||[]).filter(({format:a})=>a==="HORIZONTAL"),n,o]},Y7=({data:e})=>e.adverts.orderConfirmationPage??{},q7=Y(Y7,e=>{const{isFetching:t,settings:n,placement:o}=e;return[(o?.belowGrid||[]).filter(({format:a})=>a==="HORIZONTAL"),n,t]}),aat=e=>{const{lastUpdated:t}=Y7(e);return!t},iat=e=>{const[t]=q7(e);return!!t.length},K7=e=>{const n=document.getElementById("main-header")?.getBoundingClientRect().bottom||0,o=e?.getBoundingClientRect().top||0;n>o&&window.scrollTo({top:n})},lat=["LARGE","MEDIUM","SMALL"],cat={LARGE:[480,960],MEDIUM:[480,960],SMALL:[960,480]},dat={XLARGE:[7680,900],LARGE:[2973,900],MEDIUM:[2301,900],SMALL:[1725,600]},uat={XLARGE:[7680,270],LARGE:[2973,270],MEDIUM:[2301,270],SMALL:[1725,270]},pat={LARGE:[2880,480],MEDIUM:[1920,480],SMALL:[960,480]},ST={LARGE:[2880,360],MEDIUM:[2880,480],SMALL:[1920,480]},mat={LARGE:[2880,360],MEDIUM:[2880,480],SMALL:[1920,480]},hat={LARGE:[960,480],MEDIUM:[960,480],SMALL:[1920,480]},JU="fm",gat="w",Eat="avif",fat="webp",yat={[Ke.xs]:"SMALL",[Ke.sm]:"MEDIUM",[Ke.md]:"MEDIUM",[Ke.lg]:"LARGE"},CT=()=>{const e=dr(),[t,n]=h.useState();return h.useEffect(()=>{if(e){const o=yat[Ke[e]];n(o)}else n(void 0)},[e]),[t,e]},Iat=e=>{try{return e==="undefined"?void 0:JSON.parse(e??"")}catch{return}},Sat=(e,t,n)=>{const o=()=>!(typeof window>"u"||n()===void 0),r=()=>{if(!o())return t;try{const u=n().getItem(e);return u?Iat(u):t}catch{return t}},[a,i]=h.useState(r()),[l,c]=h.useState(r()),d=u=>{o()&&(n().setItem(e,JSON.stringify(u)),i(u))};return h.useEffect(()=>{i(r()),c(r())},[]),[l,a,d]},Cat=(e,t)=>Sat(e,t,()=>window.sessionStorage),vat=(e,t,n,o)=>{const r=`hrz.${e}.${t||"~"}.${n}.last-viewed`,[a,i,l]=Cat(r,o);return{initialAdvertId:a,updateLastViewedAdvertId:l}},Tat=()=>{const e=h.useRef(0);return h.useEffect(()=>{const t=document.getElementById("main-header"),n=new ResizeObserver(([o])=>{const{height:r}=o.contentRect;e.current!==r&&(e.current=r)});return t&&n.observe(t),()=>{n.disconnect()}},[]),e},_at=e=>xce(Ace(e),"a-zA-Z0-9-"),bb=e=>e.replace(/[^\w. ]/gi,t=>`&#${t.charCodeAt(0)};`),bat=e=>{const[t]=e.split("://"),n=/^(http|https)/.test(t)?e:`https://${e}`,o=new URL(n);return`${o.origin}${o.pathname}${o.search}`},xat="/product-range",eG=2048,tG=(e,t)=>{const n=[],o=e.trim();return o&&n.push(Qe.stringify({advertId:o},{encode:!0})),t?.length&&n.push(Qe.stringify({ids:t},{arrayFormat:"comma"})),`${xat}${n.length?`?${n.join("&")}`:""}`},Aat=(e,t)=>{const n=tG(e,t),o=`${window.location.origin}${n}`;if(o.length>eG){const a=new URL(o.substring(0,eG)).searchParams.get("ids")?.split(",")||[],i=a.length-1,l=a[i],c=t?.[i];return l!==c&&a.pop(),[tG(e,a),!0,o.length]}return[n,!1,o.length]},xg=(e,[t,n])=>e.find(({width:o,height:r})=>o===t&&r===n),hL=({target:e})=>e.openInNewTab?"_blank":void 0,z7=(e=[])=>e.filter(t=>t?.format==="HORIZONTAL"),gL=()=>typeof navigator<"u"?(navigator.userAgent.match(/version\/([\d.]+).*safari/i)?.[1]??"-1").startsWith("16."):!1,Q7=e=>{if(!e)return"";if(gL())return`url("${e.url}")`;const[t]=X7(e,!0),n=t?.split(",")||[],o=r=>{const[a,i]=r.split(" ");return`url("${a}") type("image/avif") ${i}`};return`image-set(${n.map(o).join(",")}, url("${e.url}"))`},X7=(e,t=!1)=>{const{url:n,width:o}=e;return[Eat,fat].map(r=>[`${n}?${JU}=${r}&${gat}=${o/2} ${t?"1x":`${o/2}w`}`,`${n}?${JU}=${r} ${t?"2x":`${o}w`}`].join(","))},sf=e=>Y(({data:t})=>t.adverts[e].placement.withinGrid.find(n=>n.format==="DOUBLE_TILE"),({data:t})=>[t.adverts[e].lastUpdated,t.adverts[e].isFetching],(t,[n,o])=>[!!n&&!o&&!!t,t?.aligned==="RIGHT"]),Rat=e=>e.linkType==="ABSOLUTE_WEB_ADDRESS",Dat=e=>e.linkType==="BOP",Oat=e=>e.linkType==="LISTER_PAGE",sG=({id:e,target:t})=>{if(Rat(t))return[bat(t.values[0])];if(Dat(t))return[Uo(t.values[0])];if(Oat(t)){const[n,o,r]=Aat(e,t.values);return[n,{isCropped:o,fullUrlLength:r}]}return[""]},Pat=e=>{const t=h.useRef(0);return h.useEffect(()=>{const n=document.getElementById("summary-box");let o=null;return(()=>{e&&n?(o=new ResizeObserver(([a])=>{if(!a)return;const[i]=a.borderBoxSize;i&&t.current!==i.blockSize&&(t.current=i.blockSize)}),o.observe(n)):t.current=0})(),()=>{o&&n&&o.disconnect()}},[e]),t},vT=({image:e,contentSource:t,pixelDensity:n,children:o,sizes:r})=>{if(gL()||!(t==="CONTENTFUL"))return o;const[l,c]=X7(e,n);return s.jsxs("picture",{"data-test":"advert-picture",children:[s.jsx("source",{"data-test":"advert-picture-source",type:"image/avif",srcSet:l,sizes:r}),ae.cloneElement(o,{srcSet:c})]})},Nat=v.section`
    display: flex;
    flex-direction: column;
    gap: var(--salt-spacing-4);
`,mp=e=>{const[t,n]=e;return e&&t&&n?`aspect-ratio: ${t} / ${n};`:""},Lat=v.div`
    border-radius: var(--salt-radius-default);
    background-color: var(--intent-secondary-100);

    ${e=>mp(e.dimensionsMap.SMALL)}

    ${re.smUp`
        ${e=>mp(e.dimensionsMap.MEDIUM)}
    `}

    ${re.lgUp`
        ${e=>mp(e.dimensionsMap.LARGE)}
    `}
`,kat=(e,t,n)=>{const[o,r]=t[n];return e.filter(i=>i.images.some(l=>l.width===o&&l.height===r)).length},jat=v.div`
    inline-size: 100%;

    ${e=>`
        display: ${e.size==="SMALL"?"block":"none"};
    `}

    ${re.mdUp`${e=>`
        display: ${e.size==="MEDIUM"?"block":"none"};
    `}`}

    ${re.lgUp`${e=>`
        display: ${e.size==="LARGE"?"block":"none"};
    `}`}
`,Mat=({advertDimensionsMap:e,adverts:t,sizes:n})=>s.jsxs(Nat,{children:[s.jsx(Lat,{dimensionsMap:e,"data-test":"horizontal-advert-skeleton"}),n.map(o=>{const r=kat(t,e,o);return r>1?s.jsx(jat,{size:o,children:s.jsx(pz,{isPaused:!1,currentIndex:0,numberOfItems:r,handlePrevButtonPress:()=>{},handleNextButtonPress:()=>{},handlePauseButtonPress:()=>{}})},o):null})]}),wat=v.img`
    border-radius: var(--salt-radius-default);
    inline-size: 100%;
    block-size: auto;
    ${({advertDimensionsMap:e})=>mp(e.SMALL)}

    ${re.smUp`
        ${({advertDimensionsMap:e})=>mp(e.MEDIUM)}
    `}

    ${re.lgUp`
        ${({advertDimensionsMap:e})=>mp(e.LARGE)}
    `}
`,xb=(e,t,n,o)=>{const[r,a]=t;return o.includes(n)&&Fat(e,r,a)?"display: block;":"display: none;"},Fat=(e,t,n)=>e.some(o=>o.images.some(r=>r.width===t&&r.height===n)),Bat=v.div`
    inline-size: 100%;

    ${({adverts:e,advertDimensionsMap:t,advertSizes:n})=>xb(e,t.SMALL,"SMALL",n)}

    ${re.mdUp`
        ${({adverts:e,advertDimensionsMap:t,advertSizes:n})=>xb(e,t.MEDIUM,"MEDIUM",n)}
    `}

    ${re.lgUp`
        ${({adverts:e,advertDimensionsMap:t,advertSizes:n})=>xb(e,t.LARGE,"LARGE",n)}
    `}
`,Uat=["CATEGORY","PROMOTION","PROMOTIONS_LANDING"],TT=h.forwardRef(({isExternalLink:e,linkType:t,...n},o)=>{const r=e||Uat.includes(t)?tt:Ye;return s.jsx(r,{ref:o,...n})}),Gat=v(TT)`
    line-height: 0;
    outline-offset: -1px;
    flex-basis: 100%;
    flex-shrink: 0;
    display: block;
`,Z7=h.createContext(null),$at=({children:e})=>{const[t,n]=h.useState([]),o=h.useMemo(()=>({displayedAdverts:t,setDisplayedAdverts:n}),[t,n]);return s.jsx(Z7.Provider,{value:o,children:e})},J7=e=>(t,n)=>({type:"API",payload:{url:n?"/v1/events":"/v4/content/events",service:n?"cxhub":"webuniversalapi",...n?{pathPrefix:{client:"/api/cxhub",server:"/core-api"}}:{},skipLoginRedirect:!0,options:{method:"POST",body:{eventType:e,externalAdvertIds:[t]}},...se(e)}}),Hat=J7("ADVERT_CLICK"),Vat=J7("ADVERT_IMPRESSION"),Wat={STATIC_ADVERT:{click:"ADVERTISING_BANNER_CLICKED",impression:"ADVERTISING_BANNER_IMPRESSION"},RESPONSIVE_ADVERT:{click:"RESPONSIVE_ADVERTISING_BANNER_CLICKED",impression:"RESPONSIVE_ADVERTISING_BANNER_IMPRESSION"}},Yat=e=>({id:e.id,name:e.name,altText:e.altText,placement:e.placement,location:e.page,advertisingBannerType:e.placement,contentSource:e.contentSource,targetUrl:e.targetUrl,linkType:e.linkType,segments:e.segments,sequence:e.sequence,format:e.format,imageUrl:e.imageUrl,size:e.size}),py=(e,t,n,o)=>{const r=F(),a=Wat[t][e];return h.useCallback(({id:i,name:l,altText:c,contentSource:d,targetUrl:u,linkType:p,segments:g,sequence:E,format:y,imageUrl:I,size:S})=>{const C=Yat({id:i,name:l,altText:c,page:n,placement:o,contentSource:d,targetUrl:u,linkType:p,segments:g,sequence:E,format:y,imageUrl:I,size:S});if(r(U.analyticsEvent({type:a,...C})),a==="ADVERTISING_BANNER_CLICKED"||a==="RESPONSIVE_ADVERTISING_BANNER_CLICKED"){const T=$Ee(C);te.sendEvent({GA:T,WA:null});const _=VEe(C,a);te.sendEvent({GA:_,WA:null})}if(a==="ADVERTISING_BANNER_IMPRESSION"||a==="RESPONSIVE_ADVERTISING_BANNER_IMPRESSION"){const T=HEe(C);te.sendEvent({GA:T,WA:null});const _=WEe(C,a);te.sendEvent({GA:_,WA:null})}},[n,o])},nf=(e,t)=>{const n=F(),[o]=Ee(["cxe.by"]),r=py("impression","STATIC_ADVERT",e,t),a=py("click","STATIC_ADVERT",e,t),i=py("impression","RESPONSIVE_ADVERT",e,t),l=py("click","RESPONSIVE_ADVERT",e,t),c=h.useCallback(u=>{u&&n(Vat(u,o))},[n,o]),d=h.useCallback(u=>{u&&n(Hat(u,o))},[n,o]);return{reportStaticAdvertImpression:r,reportStaticAdvertClick:a,reportResponsiveAdvertImpression:i,reportResponsiveAdvertClick:l,reportContentExperienceAdvertImpression:c,reportContentExperienceAdvertClick:d}},qat=({externalAdvertId:e,targetUrlLength:t,productsNumber:n})=>U.analyticsEvent({type:uO.LISTER_PAGE_URL_LENGTH_LIMIT_BREAK,externalAdvertId:e,targetUrlLength:t,productsNumber:n}),Kat=(e,t)=>{const{reportStaticAdvertClick:n,reportStaticAdvertImpression:o,reportContentExperienceAdvertClick:r,reportContentExperienceAdvertImpression:a}=nf(e,t),i=F(),l=h.useCallback((u,p,g)=>{o({id:u.id,name:u.name,location:e,format:u.format,contentSource:u.contentSource,linkType:u.target.linkType,segments:u.segments,placement:t,targetUrl:p,imageUrl:g}),u.contentSource==="CITRUS_AD"&&a(u.id)},[e,t,o,a]),c=h.useCallback((u,p,g)=>{n({id:u.id,name:u.name,location:e,format:u.format,contentSource:u.contentSource,linkType:u.target.linkType,segments:u.segments,placement:t,targetUrl:p,imageUrl:g}),u.contentSource==="CITRUS_AD"&&r(u.id)},[e,t,n,r]),d=h.useCallback((u,p,g)=>{i(qat({externalAdvertId:u,targetUrlLength:p,productsNumber:g}))},[i]);return{reportImpression:l,reportClick:c,reportUrlCharLimitBreak:d}},zat=["basket","product-details","promotions","promotion-details","favorites","search","categories","logged-in-homepage","logged-out-homepage","slot-booking","edit-order","order-confirmation"],Qat=5e3,Xat=2500,Zat=h.createContext({loopIntervalMs:Qat,playDelayMs:Xat}),my=(e,t)=>`${e}:${t}`,Lm=({adverts:e,page:t,pageKey:n,placement:o,advertDimensionsMap:r,randomInitialIndex:a,"data-test":i="horizontal-advert",className:l,sizes:c,lazyLoad:d=!0,fetchPriority:u})=>{const p=h.useRef(null),g=h.useRef(null),E=Tat(),y=os({breakpoint:"lg-up"}),I=Pat(y),[S]=CT(),[C]=Ee(["seo.rdbl"]),[T,_]=h.useState(""),[A,R]=h.useState(),P=h.useContext(Zat),N=h.useContext(Z7),[k,M]=h.useState([]),{initialAdvertId:w,updateLastViewedAdvertId:j}=vat(t,n,o,""),{formatMessage:G}=L(),W=Ce=>S?xg(Ce,r[S]):null,{reportClick:H,reportImpression:K,reportUrlCharLimitBreak:X}=Kat(t,o),q=Ce=>e.find(We=>We.id===Ce),ne=Ce=>{if(Ce.contentSource==="CITRUS_AD"){const[We]=sG(Ce);return We}return Aa.calculateLegacyTargetUrl(Ce.target,{isSEOReadableURLEnabled:C})},ue=Ev(g,{freezeOnceVisible:!1,threshold:.5,rootMargin:`-${E.current}px 0px -${I.current}px 0px`}),oe=Ce=>(N?.displayedAdverts??k).includes(Ce),ye=Ce=>{(N?.setDisplayedAdverts??M)(et=>[...et,Ce])};h.useEffect(()=>{Ie!==void 0&&me()},[S]),h.useEffect(()=>{if(!T||oe(T)||!ue?.isIntersecting)return;const Ce=q(T),We=S&&c.includes(S);if(Ce&&We){if(K(Ce,ne(Ce),W(Ce.images)?.url),Ce.contentSource==="CITRUS_AD"&&Ce.target.values?.length){const[et,ve]=sG(Ce);ve?.isCropped&&X(Ce.id,ve.fullUrlLength,Ce.target.values.length)}ye(T)}},[T,ue?.isIntersecting]);const he=h.useMemo(()=>lat.reduce((Ce,We)=>{const[et,ve]=r[We]||[],lt=({width:St,height:wt})=>St===et&&wt===ve;return{...Ce,[my(et,ve)]:e.filter(({images:St})=>St.find(lt)).map(({id:St})=>St)}},{}),[e]),Ie=h.useMemo(()=>{if(!S)return;const[Ce,We]=r[S]||[],et=he[my(Ce,We)],ve=et.findIndex(lt=>lt===w);return ve>-1?ve:a?Math.floor(Math.random()*et.length):0},[w,S,he,a]),Fe=h.useCallback((Ce,We)=>()=>{H(Ce,We,W(Ce.images)?.url)},[S,t,H]),be=Ce=>K7(Ce.target),ce=h.useCallback(Ce=>{if(!S)return;const[We,et]=r[S],ve=he[my(We,et)][Ce];_(ve),j(ve)},[S,he]),me=()=>{if(!S)return;const[Ce,We]=r[S];_(et=>{const ve=he[my(Ce,We)].findIndex(lt=>lt===et);return R(Math.max(ve,0)),et})},De=()=>{if(d)return gL()?"eager":"lazy"},ge=(Ce,We,et)=>{const{images:ve,isExternalLink:lt,position:St=0,contentSource:wt}=Ce;if(!S)return null;const dn=xg(ve,r[S]),Mo=dn?.altText||ve[0]?.altText||"",Zs=ne(Ce),Mn=`horizontal-advert-item-${St}`,Kn=G("scroller.accessibility.banner",{i:We+1,total:et,altText:Mo});return dn&&s.jsx(Gat,{linkType:Ce?.target?.linkType,"aria-label":Kn,"data-test":Mn,isExternalLink:lt,href:Zs,title:Mo,target:hL(Ce),onClick:Fe(Ce,Zs),onFocus:be,children:s.jsx(vT,{image:dn,contentSource:wt,sizes:"calc(100vw - 1em)",children:s.jsx(wat,{src:dn.url,alt:dn?.altText??"",loading:De(),advertDimensionsMap:r,fetchPriority:u})})},St)},Se=h.useMemo(()=>{const Ce=e.filter(et=>W(et.images)),We=Ce.length;return Ce.map((et,ve)=>ge(et,ve,We))},[e,S]);if(!zat.includes(t)||e.length===0)return null;const Ae=Ie!==void 0&&Se.length>0;return s.jsx(Bat,{advertSizes:c,"data-test":i,className:l,adverts:e,advertDimensionsMap:r,children:Ae?s.jsx(FGe,{loopIntervalMs:P.loopIntervalMs,playDelayMs:P.playDelayMs,isVisible:!!ue?.isIntersecting,ref:p,fwBodyRef:g,startFromIndex:Ie,activeItemIndex:A,onCurrentIndexChange:ce,children:Se}):s.jsx(Mat,{advertDimensionsMap:r,adverts:e,sizes:c})})},eX=e=>{switch(e){case"edit-order":case"basket":return rat;case"order-confirmation":return q7;default:return()=>[[],{randomizeInitialHorizontalAdvert:!1},!1]}},tX=({page:e,pageKey:t,className:n})=>{const[o,r,a]=f(eX(e));return a||o.length===0?null:s.jsx(Lm,{adverts:o,advertDimensionsMap:mat,page:e,pageKey:t,placement:"BELOW_GRID",randomInitialIndex:r.randomizeInitialHorizontalAdvert,className:n,sizes:["LARGE","MEDIUM","SMALL"]})},Jat=D("fppco"),sX=(e,t,n,o)=>{if(Jat(n)){const r=xr(n);t(Id.getFailedOrderPayments(r))}return t(U.analyticsEvent({type:Ot.FAILED_PAYMENT_SUCCESS,orderId:e})),o(rO(e))},eit=({paymentSession:e,orderId:t,payerForRecurringOrder:n,paymentMethod:o,navigate:r})=>(a,i)=>{const l=i();return a(Id.updateFailedOrderPayment({paymentSession:e,orderId:t,payerForRecurringOrder:n,paymentMethod:o})).then(c=>{const{url:d}=c.payload.responseData;return d?e.initiatePaymentAuthentication({authenticationUrl:d}):sX(t,a,l,r)})},tit=(e,t,n)=>(o,r)=>{const a=r();return o(Id.validateUpdatePayment(e)).then(i=>{sessionStorage.setItem("paymentUpdate",JSON.stringify(i?.payload?.responseData)),sX(t,o,a,n)}).catch(()=>Promise.all([Promise.resolve(Z.error("payment.failed.error.general")),n(Dc({orderId:t}))]))},sit=()=>(e,t)=>{const n=xr(t());return e(Id.getFailedOrderPayments(n))},_T={fetchFailedOrderPayments:sit},nit=se("GET_CART_ADVERTS"),nX=()=>({type:"API",payload:{url:"/v1/content?page=CART",...nit}}),oit=e=>typeof e!="string"&&!!e.amount&&!!e.currency,Xl=(e,t)=>oit(e)?t(e):e,oX=(e,t)=>{if(!e)return;const{halfPrice:n,free:o}=e;if(n&&o){const r={freeDeliveryThreshold:Xl(o.minSpend,t),halfPriceDeliveryThreshold:Xl(n.minSpend,t)};return o.reached?{id:"delivery.price.modification.levels.half.and.free.free.reached",substitutions:r,type:"success"}:n.reached?o.leftToSpend?{id:"delivery.price.modification.levels.half.and.free.free.almost.reached",substitutions:{...r,freeDeliveryRemainingAmount:Xl(o.leftToSpend,t)},type:"warning"}:{id:"delivery.price.modification.levels.half.and.free.half.reached",substitutions:r,type:"success"}:n.leftToSpend?{id:"delivery.price.modification.levels.half.and.free.half.almost.reached",substitutions:{...r,halfPriceDeliveryRemainingAmount:Xl(n.leftToSpend,t)},type:"warning"}:{id:"delivery.price.modification.levels.half.and.free.none.reached",substitutions:r,type:"info"}}if(n){const r={halfPriceDeliveryThreshold:Xl(n.minSpend,t)};return n.reached?{id:"delivery.price.modification.levels.half.only.reached",substitutions:r,type:"success"}:n.leftToSpend?{id:"delivery.price.modification.levels.half.only.almost.reached",substitutions:{...r,halfPriceDeliveryRemainingAmount:Xl(n.leftToSpend,t)},type:"warning"}:{id:"delivery.price.modification.levels.half.only.not.reached",substitutions:r,type:"info"}}if(o){const r={freeDeliveryThreshold:Xl(o.minSpend,t)};return o.reached?{id:"delivery.price.modification.levels.free.only.reached",substitutions:r,type:"success"}:o.leftToSpend?{id:"delivery.price.modification.levels.free.only.almost.reached",substitutions:{...r,freeDeliveryRemainingAmount:Xl(o.leftToSpend,t)},type:"warning"}:{id:"delivery.price.modification.levels.free.only.not.reached",substitutions:r,type:"info"}}},rit=()=>{const e=Ne(),t=Qe.parse(e.search);return{shouldShowGenericErrorWhenCheckoutGroupRemoved:t.showError==="true",isBelowMinSpendErrorInUrl:t.error==="below-minimum-spend",errorShippingGroupType:t.errorShippingGroupType||""}},rX=()=>{const e=F();return()=>e(Oc())},ait=()=>{const e=F();return h.useCallback(()=>e(_T.fetchFailedOrderPayments),[e])},iit=()=>{const e=F();return h.useCallback(()=>e(nX()),[e])},lit=(e,t)=>{const o={...Qe.parse(e.search),error:void 0,errorShippingGroupType:void 0,showError:void 0},r=Qe.stringify(o),a=r?`${e.pathname}?${r}`:e.pathname;t(a)},cit=(e,t=!1,n=!1)=>{const o=Ne(),r=Ge(),a=mL(),i=f(d=>is(d)),l=f(d=>Aue(d,e)),c=l||i;return h.useCallback(()=>{t&&!l&&n?Z.error("toast.notification.generic.error"):a({basketSummary:c,type:t?"warning":"error"}),lit(o,r)},[t,l,n,o,r,a,c])},dit=()=>{const e=L(),t=f(Ct),n=yo();return h.useCallback((o,r)=>{if(!r)return;const a=r?.id,i=r?.substitutions;if(Mrt(a,t))return;const l=o?.id;l&&Z.close(l);const c=i?{key:a,substitutions:i}:a;Z[r?.type||"info"](c,{id:a}),n({type:Le.TOAST_NOTIFICATION_DISPLAYED,description:"User informed about delivery charge by spend thresholds",pageEventAttributes:{message:e.formatMessage(a,i),messageId:a}})},[e,t,n])},uit=()=>{const e=He(),[t,n]=h.useState(void 0),o=f(tu),[r]=o,a=!r?.checkout?.basketAboveThreshold,i=Nm(eu),l=oX(r?.deliveryPriceModificationLevels,e),c=dit();return h.useEffect(()=>{const d=!!l&&l?.id!==t?.id;!a&&!i&&d&&(c(t,l),n(l))},[t,l,a,i,c])},aX=v.span`
    margin-block: 0;
    margin-inline: var(--salt-spacing-1) 0;
    padding: var(--salt-spacing-1);
    border: 0;
    background: transparent;
    display: flex;
    font-family: var(--font-family);
`,iX=v.button`
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    inline-size: 100%;
    font-family: var(--font-family);
    background: var(--intent-contrast);
    border-radius: var(--salt-radius-default);
    padding: var(--salt-spacing-2);

    &:hover {
        background-color: var(--intent-secondary-900);
        border-color: var(--intent-secondary-900);
        color: var(--intent-secondary-900-contrast);
    }
`,pit=v.img`
    inline-size: 30px;
    block-size: 30px;
    margin-block: auto;
    margin-inline: 0;
`,mit=v.div`
    display: flex;
    flex-wrap: wrap;
    gap: var(--salt-spacing-2);
    overflow: hidden;
    block-size: ${$(50)};
`,nG=v.img`
    inline-size: ${$(50)};
    block-size: ${$(50)};
    visibility: ${({visible:e=!0})=>e?"visible":"hidden"};
`,EL="alc.blur",bT="age.vis",oG={CANCEL:"CANCEL",DELETE:"DELETE LIST"},rG={CANCEL:"CANCEL",SAVE:"SAVE"},wh={Edit:"Edit",Delete:"Delete",Close:"Close"},Cc={CREATE:"shoppingListCreate",UPDATE_NAME:"shoppingListUpdateName",DELETE:"shoppingListDelete"},hit={LIST_ADDED:"shopping.lists.modal.accessibility.notification.product.list.added",LIST_REMOVED:"shopping.lists.modal.accessibility.notification.product.list.removed",FAVORITE_ADDED:"shopping.lists.modal.accessibility.notification.product.fav.added",FAVORITE_REMOVED:"shopping.lists.modal.accessibility.notification.product.fav.removed"},git=v.div`
    inline-size: 30px;
    block-size: 30px;
    margin-block: auto;
    margin-inline: 0;
    flex-shrink: 0;
    background-color: var(--intent-secondary);
    border-radius: var(--salt-radius-default);
`,lX=({productName:e,imageUrl:t,restrictedVisibility:n})=>{const[o]=Ee([bT]),r=o&&n;return s.jsx(xe,{condensed:!0,"data-test":"shopping-list-modal-product-details",className:"salt-m-b--4",children:s.jsxs(Q,{wrap:"nowrap",children:[r?s.jsx(git,{}):s.jsx(pit,{src:t,alt:e}),s.jsx(O,{className:"salt-m-y--1 salt-m-l--2",size:"l",children:e})]})})},fL=({productId:e,onClick:t})=>s.jsx(x,{size:"m",intent:"tertiary",fill:!1,onClick:()=>t(e),"data-test":fL.dataTestId,"aria-label":L().formatMessage("regular.addToRegulars.back.arrow.ariaLabel"),children:s.jsx(x.Icon,{name:"arrow_left"})});fL.dataTestId="add-to-regulars-back-arrow-button";const Eit=({product:e,onBackArrowClick:t})=>s.jsx(B.Header,{align:"left",className:t?"salt-p-l--2 salt-p-r--4 salt-p-y--2":"salt-p-x--4 salt-p-y--2",children:s.jsxs(Q,{align:"center",children:[t?s.jsx(fL,{productId:e.productId,onClick:t}):null,s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"regular.addToRegulars.modal.header"})})]})}),fit={PROMISE_ON_ADDING_ITEM:"regular.addToRegulars.body.promise.on.adding.item",PROMISE_ON_CHECKOUT:"regular.addToRegulars.body.promise.on.checkout"},yit=()=>{const e=f(Ede);if(!e)return null;const t=fit[e];return t?s.jsx(Te,{intent:"info",text:s.jsx(b,{id:t}),showIcon:!1}):null},aG="md",Iit=1,Sit="WEEKLY",yL=({productName:e,onSubmitValues:t})=>{const{formatMessage:n}=L(),[o,r]=h.useState(Iit),[a,i]=h.useState(Sit),l=h.useMemo(()=>({frequency:{ariaLabel:n("regular.frequency.ariaLabel",{productName:e}),label:n("regular.addToRegularsForm.addToTrolley")},quantity:{label:n("regular.addToRegularsForm.quantity"),ariaLabel:n("regular.quantity.ariaLabel",{productName:e})},submitButton:{ariaLabel:n("regular.addToRegulars.accessibility.button",{productName:e})}}),[]),c=p=>r(p),d=p=>i(p),u=p=>{p.preventDefault(),t({quantity:o,frequency:a})};return s.jsxs("form",{"data-test":yL.dataTestId,onSubmit:u,children:[s.jsx(GN,{className:"salt-m-y--4",id:"select-frequency-menu-button",label:l.frequency.label,children:s.jsx(pL,{dropDownButtonId:"select-frequency-menu-button",initialFrequency:a,size:aG,ariaLabel:l.frequency.ariaLabel,onSelect:d,isDisabled:!1})}),s.jsx(k7,{label:l.quantity.label,name:"quantity",id:"add-to-regulars-form-quantity-input",size:aG,ariaLabel:l.quantity.ariaLabel,initialQuantity:o,onQuantityChange:c,isDisabled:!1}),s.jsx(yit,{}),s.jsx(x,{className:"salt-m-t--4",type:"submit",intent:"primary",fill:!0,"aria-label":l.submitButton.ariaLabel,children:s.jsx(x.Text,{children:s.jsx(b,{id:"regular.addToRegularsForm.submit"})})})]})};yL.dataTestId="add-to-regulars-form";const IL=({onBackArrowClick:e,onModalRequestClose:t,onSuccess:n})=>{const o=L(),r=F(),a=f(J6e),{productId:i,productIndex:l=0,page:c="",section:d=""}=a||{productId:""},u=f(_=>Da(_,i)),[p]=Ee([_u]),g=ef(),E=hT();h.useEffect(()=>{u&&g.addToRegularsModalDisplayed({productId:i,retailerProductId:u.retailerProductId})},[u]);const y=()=>{r(Xv({productId:""})),t?.()},I=async({quantity:_,frequency:A})=>{try{await r(W6e({productId:i,frequency:A,quantity:_})),r(xt.updateProducts({product:[{productId:i,regular:{frequency:A,quantity:_}}]})),Z.success({key:"regular.addToRegularsModal.success",substitutions:{productName:u.name}},{ariaLabel:o.formatMessage("regular.addToRegularsModal.success.ariaLabel",{productName:u.name})}),n&&n({productId:i,productIndex:l,page:c,section:d}),g.toastNotificationDisplayed("regularAdded"),g.productAddedToRegulars({productId:i,retailerProductId:u.retailerProductId,frequency:A,quantity:_}),c&&l>=0&&E.regularsGaEvent({retailerProductId:u.retailerProductId,productName:u.name,quantity:_,frequency:A,productIndex:l,list:ks(c,null,d)??"",event:"add_to_regulars"})}catch{Z.error("regular.addToRegularsModal.error")}},S=h.useCallback(I,[i]),C=_=>{y(),S(_)},T=()=>{e?.({productId:i,productIndex:l,page:c,section:d})};return p?s.jsx(B,{isOpen:!!u,onRequestClose:y,aria:{labelledby:"add-to-regulars-modal"},"data-test":IL.dataTestId,children:u?s.jsxs(h.Fragment,{children:[s.jsx(Eit,{product:u,onBackArrowClick:e?T:void 0}),s.jsxs(B.Body,{className:"salt-p-x--4 salt-p-b--4 salt-p-t--4",children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(lX,{productName:u.name,imageUrl:u.image.src,restrictedVisibility:u.restrictedVisibility})}),s.jsx(yL,{onSubmitValues:C,productName:u.name})]})]}):null}):null};IL.dataTestId="add-to-regulars-modal";const Cit=v(Q)`
    flex-grow: 1;
`,xT=({translations:e,isOpen:t,onConfirm:n,onCancel:o})=>s.jsxs(B,{isOpen:t,onRequestClose:o,aria:{labelledby:"remove-all-regulars-modal"},"data-test":xT.dataTestId,children:[s.jsx(B.Header,{align:"left",className:"salt-p-x--4",children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:e.header})})}),e.body&&s.jsx(B.Body,{className:"salt-p-x--4",children:s.jsx(b,{id:e.body})}),s.jsx(B.Footer,{align:"center",className:"salt-p-x--4",children:s.jsxs(Cit,{justify:"center",wrap:"nowrap",children:[s.jsx(x,{intent:"secondary",fill:!0,className:"salt-m-r--2",onClick:o,children:s.jsx(x.Text,{children:s.jsx(b,{id:e.cancel})})}),s.jsx(x,{intent:"primary",fill:!0,onClick:n,children:s.jsx(b,{id:e.confirm})})]})})]});xT.dataTestId="remove-all-regulars-modal";const vit=({onConfirm:e})=>{const t=F(),n=f($e(uT)),{removeAllRegularsFromBasketModalDisplayed:o,toastNotificationDisplayed:r}=ef();h.useEffect(()=>{n&&o()},[n]);const a=()=>{t(J.closeModal())},i=()=>{Z.success("regular.basketRemoveAllModal.success"),r("allRegularsRemovedFromTrolley"),a()},l=()=>{Z.error("regular.basketRemoveAllModal.error")},c=async()=>{try{await e(),i()}catch{l()}};return s.jsx(xT,{translations:{header:"regular.basketRemoveAllModal.header",cancel:"regular.basketRemoveAllModal.cancel",confirm:"regular.basketRemoveAllModal.okay"},isOpen:n,onConfirm:c,onCancel:a})};function Tit({onConfirm:e}){const t=F(),n=tf(),o=()=>{t(J.openModal(uT))};return n&&e?s.jsxs(h.Fragment,{children:[s.jsxs(x,{onClick:o,intent:"secondary","data-test":"basket-remove-regulars",children:[s.jsx(x.Icon,{name:"regulars"}),s.jsx(x.Text,{children:s.jsx(b,{id:"regular.basketButton.removeAll"})})]}),s.jsx(vit,{onConfirm:e})]}):null}const _it=()=>{const e=F(),t=yo(),n=Nm(Xe);return h.useCallback(o=>{n&&e(za.updateCustomerPreferenceBasketView(o)),e(za.setCustomerPreferenceBasketView(o)),t({type:Re.TROLLEY_VIEW_CHANGE_VIEW_TYPE_BUTTON_CLICKED,description:"Trolley page view type change",pageEventAttributes:{componentLocation:"Body",componentType:"FOP",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})},[t,e,n])},bit=e=>h.useMemo(()=>[Hs.DETAIL,Hs.GRID,Hs.LIST].map(t=>({id:t,messageKey:$x[t],selected:t===e})),[e]),xit="default"in F_?F_.default:F_,{RadioIconOff:Ait,RadioIconOn:Rit,RadioText:Dit}=Pa,cX=({checked:e,bold:t,label:n,dataTestId:o,itemProps:r})=>s.jsx(Be.Item,{...r,children:s.jsx(xe,{condensed:!0,children:s.jsxs(Rn,{children:[e?s.jsx(Rit,{name:"radio_on"}):s.jsx(Ait,{name:"radio_off"}),s.jsx(Dit,{asChild:!0,bold:t,"data-test":o,children:s.jsx("span",{children:n})})]})})});cX.displayName="BasketViewListItem";const Oit=({options:e,selectedId:t,basketViewHandler:n,onOpen:o=()=>{},isButtonFullWidth:r=!1})=>{const a=L(),[i]=Ee(["thcu"]),l=e.find(k=>k.id===t),c=a.formatMessage(l.messageKey),d=`${c}. ${a.formatMessage("basket.view.accessibility.button.closed")}`,u=`${c}. ${a.formatMessage("basket.view.accessibility.button.open")}`,p=k=>k?a.formatMessage(k.messageKey):"",{isOpen:g,getToggleButtonProps:E,getMenuProps:y,getLabelProps:I,getItemProps:S,toggleMenu:C,selectedItem:T,highlightedIndex:_}=Er({items:e,itemToString:p,selectedItem:l,onSelectedItemChange:k=>n(k.selectedItem),labelId:"basket-view-label",menuId:"basket-view-menu"}),A=E({"aria-pressed":g,"aria-label":g?u:d,role:void 0,"aria-labelledby":void 0,"aria-activedescendant":void 0}),R=I({htmlFor:void 0}),{ref:P,...N}=y();return s.jsxs(rt.Container,{children:[s.jsx(rt.TriggerSaltButton,{intent:i?"tertiary":"secondary",isOpen:g,text:c,iconName:Gx[t],fill:r,ref:A.ref,...A,...R,onClick:()=>{g||o(),C()},"data-test":"basket-view-button"}),s.jsx(rt.Body,{isOpen:g,"data-test":"basket-view-menu",children:s.jsx(rt.Content,{children:s.jsx(Be,{inline:!1,...N,innerRef:P,children:e.map((k,M)=>{const w=T?.id===k.id,j=S({index:M,item:k,"aria-selected":w});return s.jsx(cX,{label:p(k),checked:w,bold:_===M,dataTestId:`basket-view-option-${k.id}`,itemProps:j},k.id)})})})})]})},dX=()=>{const e=f(BC),t=bit(e),n=_it(),o=F(),r=i=>{n(i.id)},a=()=>{o(U.analyticsEvent({type:Re.OPEN_MENU_CLICKED,menuId:"BASKET-VIEW"}))};return s.jsx("div",{"data-test":"basket-view-dropdown",children:s.jsx(Oit,{options:t,basketViewHandler:r,selectedId:e,onOpen:a,isButtonFullWidth:!0})})};dX.displayName="BasketViewDropdown";const Pit=D("bt.view.dd"),Nit=D("bt.spl"),Lit=()=>{const e=f(Pit),t=f(Nit);return!e&&!t?s.jsx(EA,{}):s.jsxs(h.Fragment,{children:[s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(dX,{})}),!t&&s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(EA,{})})]})},iG="remove-instant-shop-items-modal-header",kit="removeInstantShopItems",jit=()=>{const e=L();return h.useMemo(()=>({heading:e.formatMessage("instant.shop.remove.modal.heading"),remove:e.formatMessage("instant.shop.remove.modal.remove"),cancel:e.formatMessage("instant.shop.remove.modal.cancel")}),[e])},uX=()=>{const e=Fl(),t=yo();return h.useCallback(()=>{t({type:Re.INSTANT_SHOP_REMOVE_FROM_BASKET_MODAL,description:"The remove instant shop from basket modal is displayed",pageEventAttributes:{userAction:"Close"}}),e()},[t,e])},Mit=e=>{const t=Fl(),n=yo();return h.useCallback(()=>{e(),n({type:Re.INSTANT_SHOP_REMOVE_FROM_BASKET_MODAL,description:"The remove instant shop from basket modal is displayed",pageEventAttributes:{userAction:"Products removed"}}),t()},[e,n,t])},wit=({removeInstantShopItemsAction:e})=>{const t=Pm(kit),n=Om(),o=jit(),r=uX(),a=Mit(e);return s.jsxs(B,{isOpen:t,onRequestClose:r,aria:{labelledby:iG},children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:iG,children:o.heading})}),s.jsx(B.Body,{children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{fill:!0,intent:"secondary",onClick:r,children:s.jsx(x.Text,{children:o.cancel})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{fill:!0,intent:"primary","data-test":"instant-shop-confirm-remove",onClick:a,children:s.jsx(x.Text,{children:o.remove})})})]})})]})},Fit=()=>{const e=Ne(),[t,n]=h.useState(!1),o=IT("removeInstantShopItems"),r=qrt({location:e,setInstantShopProductsRemoved:n});return e?.state?.addedProducts?.length>0&&!t?s.jsxs(h.Fragment,{children:[s.jsxs(x,{onClick:o,intent:"secondary","data-test":"instant-shop-remove-button",children:[s.jsx(x.Icon,{name:"smart_cart_remove"}),s.jsx(x.Text,{children:s.jsx(b,{id:"instant.shop.remove"})})]}),s.jsx(wit,{removeInstantShopItemsAction:r})]}):null},Bit=()=>{const e=F(),t=f(Ra);return({products:n})=>{n.forEach(o=>e(U.analyticsEvent({type:Re.REMOVE_ALL_OUT_OF_STOCK_ITEMS_FROM_BASKET,addedByFunction:"REMOVE_ALL_OUT_OF_STOCK_ITEMS_FROM_BASKET",basketTotalAmount:t?.amount,basketTotalCurrency:t?.currency,priceAmount:o?.price?.current.amount,priceCurrency:o?.price?.current.currency,productId:o.productId,retailerProductId:o?.retailerProductId,totalQuantity:0,updateQuantity:-o.quantity.quantityInBasket})))}},Uit=e=>{const t=F(),n=Bit(),o=Fl();return async()=>{if(o(),!e.length)return;const r=await t(ir.removeBasketItems(e.map(({productId:a,quantity:{quantityInBasket:i}})=>({productId:a,quantity:i}))));n({products:e}),t(yu(r?.pricingNotifications,!0))}},SL="basketRemoveUnassignedItemsModal",lG="basket-remove-unavailable-items-modal-header",pX=({products:e})=>{const t=Uit(e),n=Fl(),o=Pm(SL),r=Om(),a=L(),i=a.formatMessage("basket.remove.unavailable.items.modal.header"),l=a.formatMessage("basket.header.empty.modal.cancel");return s.jsxs(B,{isOpen:o,onRequestClose:n,aria:{labelledby:lG},children:[s.jsx(B.Header,{align:r?"left":"center",children:s.jsx(ee,{as:"h1",id:lG,children:i})}),s.jsx(B.Body,{children:s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{"data-test":"basket-remove-unavailable-items-cancel-button","data-synthetics":"basket-remove-unavailable-items-cancel-button",fill:!0,intent:"secondary",onClick:n,children:s.jsx(x.Text,{children:l})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{"data-test":"basket-remove-unavailable-items-button","data-synthetics":"basket-remove-unavailable-items-button",onClick:t,intent:"primary",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"basket.remove.unavailable.items.button.text"})})})})]})})]})},Git=()=>{const e=IT(SL),t=f(wye);return t.length?s.jsxs(h.Fragment,{children:[s.jsx(x,{"data-test":"basket-remove-unavailable-items-open-modal-button","data-synthetics":"basket-remove-unavailable-items-open-modal-button",onClick:e,intent:"secondary",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"basket.remove.unavailable.items.button.text"})})}),s.jsx(pX,{products:t})]}):null},$it=v(Q)`
    gap: var(--salt-spacing-4) var(--salt-spacing-4);
    flex-wrap: wrap;

    button {
        inline-size: 100%;
        flex: 1 0 34%;
        ${re.lgUp`
            width: auto;
            flex: 0 1 auto;
        `};
    }
`,fA=({className:e,dataTestId:t,isOrder:n=!1})=>{const[o,r]=Ee(["bt.spl","thcu"]),a=eat();return s.jsxs($it,{className:e,"data-test":t,children:[s.jsx(Lit,{}),s.jsx(H7,{}),!n&&!r&&s.jsxs(h.Fragment,{children:[s.jsx(Fit,{}),s.jsx(Tit,{onConfirm:a}),!o&&s.jsx(Git,{})]})]})},Hit=()=>{const[e,t]=Ee(["bt.spl","thcu"]),n=os({breakpoint:"lg-up"});return!e||t&&n?null:s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(fA,{className:"salt-m-t--4",dataTestId:"bottom-basket-fop-buttons"})})},TS=({className:e})=>{const n=L().formatMessage("basket.summary.footer");return n.trim().length===0?null:s.jsx(Te,{intent:"info",className:e,"data-test":"summary-footer-alert",size:"s",text:n})},Vit=()=>{const[e,t]=Ee(["bt.spl","thcu"]),n=f(Ar),o=os({breakpoint:"lg-up"});return t&&o?null:s.jsxs(h.Fragment,{children:[!t&&!n&&s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(TS,{className:"salt-m-b--4"})}),e?s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(fA,{className:"salt-m-b--4",dataTestId:"top-basket-fop-buttons"})}):s.jsx(fA,{className:"salt-m-b--4",dataTestId:"top-basket-fop-buttons"})]})},Wit=(e,t)=>async n=>{if(!e?.length)return;let o=null;try{o=await n(Yt.getBasket())}catch{o=null}if(!o)return;n(U.analyticsEvent({type:Re.ADD_TO_CART_GA4,basket:o,page:"SMART_SHOP",addedByFunction:"SMART_SHOP_ADD",product:e,productListName:"smart-shop: other"})),Fv({products:e,basket:o,page:"SMART_SHOP",addedByFunction:"SMART_SHOP_ADD",productListName:"smart-shop: other",featuredProductCampaigns:t}).forEach(a=>{te.sendEvent({GA:a,WA:null})}),Object.values(e).forEach(a=>{const i=wv({products:[a],basket:o,page:"INSTANT_SHOP",addedByFunction:"INSTANT_SHOP_ADD",productListName:"smart-shop: other"});return te.sendEvent({GA:i,WA:null}),n(U.analyticsEvent({type:Re.ADD_BASKET_ITEM,basket:o,page:"INSTANT_SHOP",addedByFunction:"INSTANT_SHOP_ADD",product:[a],productListName:"smart-shop: other"}))})},Yit=()=>e=>e(uS.getInstantShopAvailability()),qit=e=>async t=>{try{const o=(await t(uS.addInstantShopProductsToBasket()))?.payload?.responseData;if(!o?.addedProducts?.length)return Ue.api.pushError(new Error("Instant Shop: No products added to basket"),{context:{responseData:JSON.stringify(o)}}),null;const a=(await t(ai({products:o?.addedProducts?.map(l=>({id:l?.productId})),ignoreProductCache:!0})))?.payload?.product;if(!a)return null;const i=o?.addedProducts?.map(l=>({...a?.[l?.productId],quantity:l?.quantity}));return await t(Wit(i,e)),i}catch{return null}},CL={fetchInstantShopAvailability:Yit,addInstantShopProductsToBasket:qit},yA={[dc.INSTANT_SHOP_MODAL_DISPLAYED]:"The instant shop modal is displayed to the user",[dc.INSTANT_SHOP_ADD_TO_CART_CLICKED]:"User clicked on add to cart button for instant shop"},hy={iconSize:40,size:100,strokeWidth:4},Kit=v.div`
    inline-size: 100%;
    block-size: 100%;
    background-color: ${({success:e})=>e?"var(--intent-action-50)":"var(--intent-contrast)"};
    transition: background-color 300ms linear;
`,zit=v.div`
    position: relative;
    inline-size: ${({width:e})=>$(e)};
    block-size: ${({height:e})=>$(e)};
    margin-block: var(--salt-spacing-16);
    margin-inline: auto;
    opacity: ${({ringVisible:e})=>e?1:0};
    transition: opacity 300ms linear;
`,Qit=v.svg`
    position: absolute;
    inset-block-start: 0;
    inset-inline-end: 0;
    inline-size: ${({width:e})=>$(e)};
    block-size: ${({height:e})=>$(e)};
    fill: transparent;
    transform: rotate(-90deg);

    & circle {
        stroke-width: ${({strokeWidth:e})=>$(e)};
        stroke-dashoffset: 0;
        transition: stroke-dashoffset 2.3s linear;
        stroke-dasharray: ${({radius:e})=>Math.PI*(e??0)*2};
    }

    & .path {
        stroke: var(--intent-secondary);
    }

    & .progress {
        stroke: var(--intent-action);
        stroke-dashoffset: ${({progressVisible:e,radius:t})=>e?0:Math.PI*(t??0)*2};
    }
`,Xit=v.svg`
    position: absolute;
    inset-block-start: ${({width:e})=>$(-(e??0)/4)};
    inset-inline-start: ${({width:e})=>$(-(e??0)/4)};
    inline-size: ${({width:e})=>$(e)};
    block-size: ${({width:e})=>$(e)};
    fill: transparent;
    opacity: ${({pulseVisible:e})=>e?0:.5};
    transition: opacity 300ms linear;

    circle {
        stroke: var(--intent-action);
        stroke-width: ${({pulseVisible:e,strokeWidth:t})=>$(e?(t??0)*12:1)};
        transition: stroke-width 300ms linear;
    }
`,cG=v.div`
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    inset: 0;
`,Zit=v(pe)`
    vertical-align: top;
    opacity: ${({iconVisible:e})=>e?1:0};
    transition: opacity 300ms linear;
`,Jit=v(O)`
    inline-size: ${({width:e})=>$((e??0)*.8)};
    opacity: ${({textVisible:e})=>e?1:0};
    transition: opacity 300ms linear;
`,dG={progressVisible:300,iconHidden:600,textVisible:900,pulseVisible:2500,success:2600};class elt extends h.Component{static defaultProps=hy;constructor(t){super(t),this.state={visible:!1,progressVisible:!1,iconHidden:!1,textVisible:!1,pulseVisible:!1,success:!1},this.updateTimingState=this.updateTimingState.bind(this)}componentDidMount(){this.updateTimingState(0)}updateTimingState(t){Object.keys(dG).forEach(n=>{t*100===dG[n]&&!this.state[n]&&this.setState(o=>({...o,[n]:!0}))}),t*100<3e3&&setTimeout(()=>{this.updateTimingState(t+1)},100),t===0&&this.setState(n=>({...n,visible:!0}))}render(){const{icon:t,iconSize:n=hy.iconSize,message:o,size:r=hy.size,strokeWidth:a=hy.strokeWidth,ariaLiveMessage:i}=this.props,l=100,c=l/2,d=a*(l/r),u=c-d/2;return s.jsx(Kit,{success:this.state.success,children:s.jsxs(zit,{ringVisible:this.state.visible,width:r,height:r,children:[s.jsx(Xit,{width:r*2,height:r*2,viewBox:`0 0 ${l} ${l}`,radius:u,strokeWidth:d,pulseVisible:this.state.pulseVisible,"data-test":"progress-animation-pulse",children:s.jsx("circle",{r:u/2,cx:c,cy:c,"data-test":"progress-animation-pulse-circle"})}),s.jsxs(Qit,{width:r,height:r,viewBox:`0 0 ${l} ${l}`,radius:u,strokeWidth:d,progressVisible:this.state.progressVisible,"data-test":"progress-animation-ring",children:[s.jsx("circle",{className:"path",r:u,cx:c,cy:c,"data-test":"progress-animation-ring-circle"}),s.jsx("circle",{className:"progress",r:u,cx:c,cy:c,"data-test":"progress-animation-ring-circle"})]}),s.jsx(cG,{children:s.jsx(Zit,{iconVisible:!this.state.iconHidden,name:t,width:n,height:n,"data-test":"progress-animation-icon"})}),s.jsx(cG,{children:s.jsx(Jit,{textVisible:this.state.textVisible,size:"l",bold:!0,"data-test":"progress-animation-text",role:"alert","aria-live":"polite","aria-label":i?`${o} ${i}`:void 0,children:o})})]})})}}const tlt=()=>{const{formatMessage:e}=L();return s.jsx(elt,{icon:"smart_cart",iconSize:80,message:e("instant.shop.modal.progress.message"),size:216,strokeWidth:8,ariaLiveMessage:e("instant.shop.modal.progress.accessibility.message")})},slt=D("m.la.h"),mX="instant-shop-action-modal-header",nlt=({onClick:e})=>{const{formatMessage:t}=L(),n=f(slt),o={title:t("instant.shop.modal.title"),addToCart:t("instant.shop.modal.add.to.cart"),description:t("instant.shop.modal.description"),boxMessage:t("instant.shop.modal.box.message")},r=v(O)`
        text-align: ${({textAlign:a})=>IE(a)};
    `;return s.jsxs(B.Body,{children:[s.jsx(r,{textAlign:n?"left":"center",className:"salt-m-y--4",children:s.jsx(ee,{as:"h2",id:mX,"data-test":"instant-shop-title",className:"salt-m-b--8",children:o.title})}),s.jsx(r,{size:"l",textAlign:n?"left":"center","data-test":"instant-shop-description",className:"salt-m-r--2",children:o.description}),s.jsx(xe,{condensed:!0,className:"salt-m-t--4 salt-p-x--0",children:s.jsxs(Q,{align:"center",wrap:"nowrap",className:"salt-p-y--2 salt-p-x--4",children:[s.jsx(kl,{className:"salt-m-r--4",children:s.jsx(pe,{name:"orders_placed",width:24,height:24})}),s.jsx(O,{size:"l","data-test":"instant-shop-box-message",children:o.boxMessage})]})}),s.jsx(x,{intent:"action",fill:!0,onClick:e,"data-test":"instant-shop-add-to-basket",className:"salt-m-t--8",children:o.addToCart})]},"body")},hX=({showOnlyProgressIndicator:e=!1})=>{const t=F(),n=Ge(),o=f(wE),r=f($e("instantShop")),[a,i]=h.useState(!1),l=f(Qs);if(!o||!r)return null;const c=u=>(u&&t(U.analyticsEvent({type:dc.INSTANT_SHOP_MODAL_DISPLAYED,description:yA.INSTANT_SHOP_MODAL_DISPLAYED,pageEventAttributes:{userAction:"Close"}})),i(!1),t(J.closeModal())),d=async()=>{i(!0),e||t(U.analyticsEvent({type:dc.INSTANT_SHOP_MODAL_DISPLAYED,description:yA.INSTANT_SHOP_MODAL_DISPLAYED,pageEventAttributes:{userAction:"Add to cart"}}));const[u]=await Promise.all([t(CL.addInstantShopProductsToBasket(l)),new Promise(p=>{setTimeout(p,3e3)})]);u?.length||Z.warning("instant.shop.no.products.added"),c(),n(jt(),{...u?.length&&{state:{addedProducts:u}}})};return s.jsx(B,{isOpen:r,onRequestClose:a?void 0:c,alternativeBackground:!a,onAfterOpen:e?d:void 0,aria:a?void 0:{labelledby:mX},children:a?s.jsx(tlt,{}):s.jsx(nlt,{onClick:d})})},AT=()=>f(e=>wE(e)),olt=()=>{const e=F();return h.useCallback(()=>e(J.openModal("instantShop")),[e])},rlt=()=>{const e=Ge();return h.useCallback(()=>e(bo()),[e])},alt=()=>{const e=yo(),t=olt();return h.useCallback(()=>{e({type:Re.INSTANT_SHOP_TROLLEY_CARD_CLICKED}),t()},[e,t])},ilt=()=>{const e=yo(),t=rlt();return h.useCallback(()=>{e({type:Re.START_SHOPPING});const n={event:"event",eventCategory:"Basket",eventAction:"START_SHOPPING",eventLabel:"Not Set"};te.sendEvent({GA:n,WA:null}),t()},[e,t])},llt=()=>{const e=AT(),t=yo();h.useEffect(()=>{e&&t({type:Re.EMPTY_TROLLEY_CARD_IMPRESSION,emptyTrolleyCardImpressions:[{CARD_POSITION:0,CARD_TYPE:"instantShopCard"}]})},[t,e])},uG=({flush:e=!1})=>{llt();const t=AT(),n=alt(),o=ilt(),r=os({breakpoint:"md-up"});return s.jsx("div",{className:"salt-m-t--8 lg:salt-m-t--16",children:s.jsx(V,{flush:e,fixed:!r,children:s.jsxs(V.Item,{colStart:{xs:1,sm:1,md:4,lg:5},colSpan:{xs:12,sm:12,md:6,lg:4},children:[s.jsx(Os,{titleIcon:"trolley",title:"basket.empty.message",titleAs:"h2",primaryButton:t?void 0:{text:"basket.empty.button",onClick:o}}),t&&s.jsxs(xe,{condensed:!0,className:"salt-m-t--16",children:[s.jsx(Os,{titleIcon:"smart_cart",title:"instant.shop.empty.trolley.header",titleAs:"h3",description:"instant.shop.empty.trolley.body",primaryButton:{text:"instant.shop.empty.trolley.button",onClick:n}}),s.jsx(hX,{})]})]})})})},gX="multipleDeliveries",pG="multiple-deliveries-modal-header",mG="smallOrderChargeModal",hG="small-order-charge-modal-header",EX=()=>{const{formatMessage:e}=L(),t=F(),n=He(),o=f(D("m.la.h")),r=f(p=>Ze(p,"small-order-charge-learn-more-faq-url")),a=f($e(mG)),i=f(Yn(mG)),[l,...c]=i?.smallOrderChargeThresholds||[];h.useEffect(()=>{a&&t(U.analyticsEvent({type:Re.SMALL_ORDER_CHARGE_MODAL_DISPLAYED,orderId:i?.orderId}))},[a]);const d=()=>{t(U.analyticsEvent({type:Re.SMALL_ORDER_CHARGE_MODAL_CLOSE_BUTTON_CLICKED,orderId:i?.orderId})),t(J.closeModal())},u=()=>{t(U.analyticsEvent({type:Re.SMALL_ORDER_CHARGE_MODAL_LEARN_MORE_BUTTON_CLICKED,orderId:i?.orderId})),t(J.closeModal())};return s.jsx(B,{isOpen:a,onRequestClose:d,aria:{labelledby:hG},children:s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:o?"left":"center",children:s.jsx(ee,{as:"h1",id:hG,children:e("basket.page.small.order.charge.dialog.header")})}),s.jsxs(B.Body,{children:[l&&s.jsx(O,{className:"salt-m-b--4 salt-d--inline-block","data-test":"small-order-charge",children:e("basket.page.small.order.charge.dialog.info",{threshold:n(l.maximumThresholdExclusive),amount:n(l.smallOrderCharge)})}),c.map(p=>s.jsx(O,{className:"salt-m-b--4 salt-d--inline-block",children:e("basket.page.small.order.charge.dialog.info.threshold",{minimumThreshold:n(p.minimumThreshold),maximumThreshold:n(p.maximumThresholdExclusive),amount:n(p.smallOrderCharge)})},p.smallOrderCharge.amount)),s.jsx(O,{className:"salt-d--inline-block",children:e("basket.page.small.order.charge.dialog.description")})]}),!!r&&s.jsx(B.Footer,{align:o?"left":"center",children:s.jsx(x,{asChild:!0,intent:"secondary",fill:!0,onClick:u,"data-test":"learn-more",children:s.jsx(tt,{intent:"ghost",href:r,target:"_blank",children:s.jsx(x.Text,{children:e("basket.page.small.order.charge.dialog.learn.more")})})})})]})})},vL=e=>{const{formatMessage:t}=L(),n=He();if(!e?.length)return null;const o=e[e.length-1];if(!o)return null;const r=n(o.smallOrderCharge),a=n(o.maximumThresholdExclusive),i=t("basket.page.checkout.group.small.order.charge",{threshold:a,amount:r}),l=t("basket.page.checkout.group.small.order.charge.multiple.thresholds",{threshold:a});return e.length===1?i:l},fX=({orderId:e,thresholds:t,page:n})=>{const o=F(),r=vL(t);return h.useCallback(()=>{o(J.openModal("smallOrderChargeModal",{smallOrderChargeThresholds:t,orderId:e})),o(U.analyticsEvent({type:Re.SMALL_ORDER_CHARGE_COMPONENT_CLICKED,orderId:e,chargeInfo:r,pageType:n}))},[o,e,t,r,n])},clt=({orderId:e})=>{const t=F();return h.useCallback(()=>{t(U.analyticsEvent({type:Re.SMALL_ORDER_CHARGE_SLOT_BOOKED_LEARN_MORE_BUTTON_CLICKED,orderId:e}))},[t,e])},dlt=v.button`
    vertical-align: middle;
`,yX=({thresholds:e=[],orderId:t,page:n})=>{const{formatMessage:o}=L(),r=fX({orderId:t,thresholds:e,page:n});return s.jsxs(h.Fragment,{children:[s.jsx(dlt,{"data-test":"small-order-charge-info-button","aria-label":o("basket.page.checkout.group.small.order.charge.button.accessibility.label"),type:"button",onClick:r,children:s.jsx(pe,{verticalAlign:"middle",width:18,height:18,name:"info_default"})}),s.jsx(EX,{})]})},ult=v.div`
    -webkit-line-clamp: 2;
    -webkit-box-orient: block-axis;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
`,$d=({isWithIcon:e=!0,isWithButton:t=!1,isWithLink:n=!1,thresholds:o,orderId:r,page:a,className:i})=>{const{formatMessage:l}=L(),c=vL(o),d=f(Wn(["socca","socsb"])),u=f(E=>Ze(E,"small-order-charge-learn-more-faq-url")),p=fX({orderId:r,thresholds:o,page:a}),g=clt({orderId:r});return!d||!c?null:e?s.jsxs(Q,{justify:"space-between",gap:["sm"],className:i,wrap:"nowrap","data-test":"small-order-charge-info",children:[s.jsx(ult,{children:s.jsx(O,{"data-test":"small-order-charge-summary-info-label",children:c})}),s.jsx(yX,{orderId:r,thresholds:o,page:a})]}):s.jsxs(Q,{justify:n?"space-between":"flex-start",gap:["sm"],className:i,children:[s.jsx(Q,{align:"center",children:s.jsx(O,{size:"m","data-test":"small-order-charge-banner",children:c})}),t&&s.jsx(x,{"aria-label":l("basket.page.checkout.group.small.order.charge.button.accessibility.label"),"data-test":"small-order-charge-learn-more-button",intent:"tertiary",onClick:p,fill:!1,size:"s",children:s.jsx(x.Text,{children:l("slots.grid.green-van.footer.button")})}),n&&!!u&&s.jsx(Q,{align:"flex-start",children:s.jsx(x,{asChild:!0,intent:"tertiary",onClick:g,"data-test":"small-order-charge-learn-more-link",children:s.jsx(tt,{intent:"ghost",href:u,target:"_blank",children:s.jsx(x.Text,{children:l("basket.page.small.order.charge.dialog.learn.more")})})})}),s.jsx(EX,{})]})},IX=(e,t)=>{const n=yo();return h.useCallback(o=>{const r=e?Fo.SUMMARY_COMPONENT_COLLAPSED:Fo.SUMMARY_COMPONENT_EXPANDED;n({type:r,description:e?"User collapsed the summary component":"User expanded the summary component"}),o.preventDefault(),t(!e)},[e,t,n])},RT=e=>{const t=f(D("socca")),n=f(Wn(["sumsub","bt.spl"]));if(!e)return{shouldDisplaySmallOrderCharge:!1,smallOrderChargeThresholds:[]};const o=e.smallOrderChargeThresholds||[],r=Number(e.smallOrder?.amount),a=t&&n&&o.length>0&&!!r;return{smallOrderChargeThresholds:o,shouldDisplaySmallOrderCharge:a}},of=({value:e,withTaxNote:t,withSeparator:n=!0,className:o,label:r})=>{const a=He();return e?s.jsxs(ae.Fragment,{children:[n&&s.jsx(Ts,{}),s.jsxs(fe.Group,{className:o||"salt-p-t--2 salt-m-b--2","data-test":"summary-subtotal",children:[s.jsx(fe.Title,{"data-test":"summary-subtotal-title",children:s.jsxs(O,{bold:!0,className:"salt-d--inline-block",children:[s.jsx(b,{id:r||"summary.subtotal"}),t&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-subtotal-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]})}),s.jsx(fe.Description,{"data-test":"summary-subtotal-description",nowrap:!0,children:a(e)})]})]}):null},km=({unitsName:e="loyalty.units.name",discount:t,allowZero:n,getQuantity:o,loyalty:r})=>{const a=L(),i=He(),l=f(o??(()=>null)),c=r??l,d=f(Wn(["loyalty","loy.waon"])),u=f(hN),p=d?u:null;if(!c||c.units===void 0)return n?"0":null;if(p==="CURRENCY"||t){const y=t?Wi(c.money.amount):c.money.amount,I=i({amount:y,currency:c.money.currency}),S=p==="UNITS"&&e?` ${a.formatMessage(e)}`:"";return`${I}${S}`}const g=e?` ${a.formatMessage(e)}`:"";return`${a.formatNumber(c.units)}${g}`},bd=({unitsName:e,discount:t,allowZero:n,getQuantity:o})=>{const r=km({unitsName:e,discount:t,allowZero:n,getQuantity:o});return r?s.jsx(h.Fragment,{children:r}):null},plt=({getQuantity:e})=>{const t=L(),n=f(e),o=f(D("loyalty")),r=f(hN),a=o?r:null;if(!n?.units)return null;const i={loyaltyName:t.formatMessage("summary.loyalty.units.name")};return s.jsxs(fe.Group,{"data-test":"summary-loyalty-spent-item",children:[s.jsx(fe.Title,{children:`${i.loyaltyName}${a==="CURRENCY"?"":` (${n.units})`} `}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,children:s.jsx(bd,{getQuantity:e,discount:!0})})})]})},mlt={showLoyalty:m.bool,isLoyaltyRedeemEnabled:m.bool.isRequired,getLoyaltySpent:m.func.isRequired},hlt={showLoyalty:!0},DT=e=>{const{isLoyaltyRedeemEnabled:t,showLoyalty:n,getLoyaltySpent:o}=e;return t&&n?s.jsx(plt,{"data-test":"summary-loyalty-spent-item",getQuantity:o}):null};DT.propTypes=mlt;DT.defaultProps=hlt;const glt=e=>{const{withTaxNote:t,getLoyaltySpent:n,finalPrice:o}=e;return s.jsxs(fe,{"data-test":"summary-waon-points",children:[s.jsx(of,{value:o,withTaxNote:t}),s.jsx(DT,{isLoyaltyRedeemEnabled:!0,getLoyaltySpent:n})]})},Elt=({savings:e})=>{const t=He();return!e||!Number(e?.amount)?null:s.jsxs(fe.Group,{"data-test":"summary-savings-with-payment-method",children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"payment.promotion.savings.summary.line"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-savings-with-payment-method-amount",children:t({...e,amount:Wi(e.amount)})})})]})},flt={loading:m.bool,children:m.node},ylt={loading:!1,children:null},TL=({loading:e,children:t})=>s.jsx("div",{children:e?s.jsx(x,{className:"salt-m-y--4",intent:"action",fill:!0,loading:e}):t});TL.propTypes=flt;TL.defaultProps=ylt;const Ilt=({isDeliveryPromotion:e})=>{const t=F(),n=h.useCallback(()=>{t(U.analyticsEvent({type:Fo.DELIVERY_PASS_COMPONENT_CLICKED}))},[t]);return h.useEffect(()=>{t(U.analyticsEvent({type:Fo.DELIVERY_PASS_LINK_SHOW_IN_COMPONENT,value:!e}))},[]),{onClickDeliveryPassLink:n}};function gG({isDeliveryPromotion:e}){const{onClickDeliveryPassLink:t}=Ilt({isDeliveryPromotion:e});return s.jsx(Te,{intent:"warning",className:"salt-m-b--2","data-test":"delivery-pass-link",showIcon:!1,text:s.jsx(b,{id:"summary.delivery.pass.link.text"}),link:s.jsx(Te.Link,{to:ar(),onClick:t,children:s.jsx(b,{id:"summary.delivery.pass.link.text.href"})})})}function Slt({wrapper:e,isDeliveryPromotion:t}){return f(D("dp.link"))?e?s.jsx(e,{children:s.jsx(gG,{isDeliveryPromotion:t})}):s.jsx(gG,{isDeliveryPromotion:t}):null}const Clt={PAYMENT_PROMOTION:"PAYMENT_PROMOTION"},vlt=v(fe.Title)`
    display: none;
`,Tlt=v(fe.Description)`
    padding: 0;
    inline-size: 100%;
    font-weight: normal;
    text-align: start;
`,_lt=({delivery:e=null,withTaxNote:t=!1,signDisplay:n="auto"})=>{const o=He();return!e||!Number(e?.amount)?null:s.jsxs(fe.Group,{"data-test":"summary-delivery",children:[s.jsxs(fe.Title,{"data-test":"summary-delivery-title",children:[s.jsx(b,{id:"summary.delivery"}),t&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-delivery-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-cost-delivery-charge",children:o(e,{signDisplay:n})})]})},blt=({deliveryPromotions:e=[],hideDeliveryPassInfo:t=!1,isDeliveryPromotion:n=!1,signDisplay:o="auto"})=>{const r=He(),a=e?.filter(i=>i&&!!Number(i.promoSaving?.amount)&&i.promoType!==Clt.PAYMENT_PROMOTION);return!a?.length&&!t?s.jsx(Slt,{isDeliveryPromotion:n,wrapper:({children:i})=>s.jsxs(fe.Group,{children:[s.jsx(vlt,{}),s.jsx(Tlt,{children:i})]})}):a?.map(i=>s.jsxs(fe.Group,{"data-test":"summary-delivery-pass-item",children:[s.jsx(fe.Title,{"data-test":"summary-delivery-pass-description",children:i.promoDescription}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-delivery-pass-amount",children:r({...i.promoSaving,amount:Wi(i.promoSaving.amount)},{signDisplay:o})})})]},i.promoId))},xlt=D("m.la.h"),Alt={isOpen:m.bool.isRequired,actions:m.shape({closeModal:m.func.isRequired}).isRequired,modalLeftAlignEnabled:m.bool},Rlt={modalLeftAlignEnabled:!1},_L=({isOpen:e,actions:{closeModal:t},modalLeftAlignEnabled:n})=>{const o="bag-charge-modal-header";return s.jsx(B,{isOpen:e,onRequestClose:t,aria:{labelledby:o},children:s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:o,children:s.jsx(b,{id:"summary.bag.charge.alt"})})}),s.jsx(B.Body,{children:s.jsx("div",{className:"salt-m-t--2 salt-m-b--4",children:s.jsx(b,{id:"summary.bag.charge.alt.info"})})})]})})};_L.propTypes=Alt;_L.defaultProps=Rlt;const Dlt=e=>({isOpen:$e("bagChargeInfo")(e),modalLeftAlignEnabled:xlt(e)}),Olt=st({closeModal:J.closeModal}),Plt=Tt(we(Dlt,Olt))(_L),Nlt=v.button`
    vertical-align: middle;
`,Llt=({withTaxNote:e=!1,signDisplay:t="auto",carrierBag:n=null})=>{const o=F(),r=L(),[a,i]=Ee(["ebc","ebcm"]),l=He(),c=h.useMemo(()=>a?"summary.bag.charge.alt":"summary.bag.charge",[a]),d=()=>{o(J.openModal("bagChargeInfo"))};return!Number(n?.amount)||!n?null:s.jsxs(fe.Group,{"data-test":"summary-bag-charge-item",children:[s.jsx(Plt,{}),s.jsx(fe.Title,{"data-test":"summary-bag-title",children:s.jsxs("div",{children:[s.jsx(b,{id:c,"data-test":"summary-bag-label"}),e&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-bag-charge-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]}),i&&s.jsxs(h.Fragment,{children:["",s.jsx(Nlt,{"aria-label":r.formatMessage("summary.bag.charge.alt.info"),type:"button","data-test":"summary-bag-icon",onClick:d,children:s.jsx(pe,{verticalAlign:"middle",width:18,height:18,name:"info_default"})})]})]})}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-bag-charge-amount",children:l(n,{signDisplay:t})})]})},ze=m.shape({currency:m.string.isRequired,amount:m.string.isRequired}),klt=m.shape({quantity:m.number,price:ze}),jlt={bags:klt,signDisplay:m.string},Mlt={bags:null,signDisplay:"auto"},bL=e=>{const t=He(),{bags:n,signDisplay:o}=e;if(!n)return null;const r=Wi(n.price.amount),a=n.price?n.price.currency:"";return s.jsxs(fe.Group,{"data-test":"summary-bags-buybacks-item",children:[s.jsx(fe.Title,{"data-test":"summary-bags-buybacks-title",children:s.jsx(b,{id:"checkout.summary.place.order.summary.buybacks.bags.label"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-bags-buybacks-amount",children:t({amount:r,currency:a},{signDisplay:o})})})]})};bL.propTypes=jlt;bL.defaultProps=Mlt;const wlt={itemsRetailPrice:ze,quantity:m.number.isRequired,withTaxNote:m.bool},Flt={itemsRetailPrice:null,withTaxNote:!1},xL=e=>{const t=He(),{itemsRetailPrice:n,quantity:o,withTaxNote:r}=e;return s.jsxs(fe.Group,{"data-test":"summary-items",children:[s.jsxs(fe.Title,{"data-test":"summary-items-title",children:[s.jsx("span",{translate:"no",children:o}),"",s.jsx(b,{id:"summary.items"}),r&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-items-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-items-description",children:n?.amount&&n?.currency?t(n):"?"})]})};xL.propTypes=wlt;xL.defaultProps=Flt;const Blt={savings:ze},Ult={savings:null},AL=({savings:e})=>{const t=He();return Number(e?.amount)?s.jsxs(fe.Group,{"data-test":"summary-savings",children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"summary.savings"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-savings-amount",children:t({...e,amount:Wi(e.amount)})})})]}):null};AL.propTypes=Blt;AL.defaultProps=Ult;const gy="summary-total",Glt={loading:m.bool,totalPrice:ze,withTaxNote:m.bool,title:m.string,note:m.string},$lt={loading:!1,totalPrice:null,withTaxNote:!1,title:null,note:null},RL=e=>{const t=He(),{loading:n,totalPrice:o,withTaxNote:r,title:a}=e;if(n)return s.jsx(_e.Typography,{variant:"textS"});const i=r?s.jsx(b,{id:"order.details.tax.inclusive.price"}):e.note;return s.jsxs(ee,{as:"span",className:"salt-d--inline-block","data-test":`${gy}`,children:[s.jsx("span",{"data-test":`${gy}-label`,children:a||s.jsx(b,{id:"summary.total"})}),"",s.jsx("span",{"data-test":`${gy}-amount`,children:o?.amount?t(o):"?"}),i&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":`${gy}-note`,children:i})]})]})};RL.propTypes=Glt;RL.defaultProps=$lt;const Ey="summary-total",Hlt={loading:m.bool,totalPrice:ze,withTaxNote:m.bool,title:m.string,note:m.string},Vlt={loading:!1,totalPrice:null,withTaxNote:!1,title:null,note:null},Wlt=v(fe)`
    overflow: hidden;
`,Ylt=v(fe.Title)`
    padding-block-end: 0;
`,qlt=v(fe.Description)`
    padding-block-end: 0;
`,DL=e=>{const t=He(),{loading:n,totalPrice:o,withTaxNote:r,title:a}=e;if(n)return s.jsx(_e.Typography,{variant:"textS"});const i=r?s.jsx(b,{id:"order.details.tax.inclusive.price"}):e.note;return s.jsx(Wlt,{"data-test":Ey,children:s.jsxs(fe.Group,{children:[s.jsx(Ylt,{children:s.jsx(ee,{as:"span",className:"salt-d--inline-block",children:s.jsxs("strong",{children:[s.jsx("span",{"data-test":`${Ey}-label`,children:a||s.jsx(b,{id:"summary.total"})}),i&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":`${Ey}-note`,children:i})]})]})})}),s.jsx(qlt,{nowrap:!0,children:s.jsx(ee,{as:"span",size:"s",className:"salt-d--inline-block","data-test":`${Ey}-amount`,children:o?.amount?t(o):"?"})})]})})};DL.propTypes=Hlt;DL.defaultProps=Vlt;const Klt=({amount:e,currency:t})=>{const n=He();return Number(e)?s.jsxs(fe.Group,{"data-test":"summary-total-charged",children:[s.jsx(fe.Title,{className:"salt-p-t--2 salt-p-b--0",children:s.jsx(b,{id:"summary.difference.already.charged"})}),s.jsx(fe.Description,{className:"salt-p-t--2 salt-p-b--0",nowrap:!0,"data-test":"summary-total-charged-amount",children:n({amount:e,currency:t})})]}):null},zlt=({amount:e,currency:t,inline:n})=>{const o=He();return Number(e)>=0?n?s.jsxs("span",{className:"salt-p-t--2 salt-d--block",children:[s.jsx(b,{id:"summary.difference.to.charge"}),"",s.jsx(O,{bold:!0,"data-test":"summary-total-difference-to-charge-amount",children:o({amount:e,currency:t})})]}):s.jsxs(fe.Group,{"data-test":"summary-total-difference-to-charge",children:[s.jsx(fe.Title,{className:"salt-p-t--2 salt-p-b--0",children:s.jsx(b,{id:"summary.difference.to.charge"})}),s.jsx(fe.Description,{className:"salt-p-t--2 salt-p-b--0",nowrap:!0,"data-test":"summary-total-difference-to-charge-amount",children:o({amount:e,currency:t})})]}):null},Qlt=({amount:e,currency:t,inline:n})=>{const o=He();return Number(e)?n?s.jsxs("span",{className:"salt-p-t--2 salt-d--block",children:[s.jsx(b,{id:"summary.difference.to.refund"}),"",s.jsx(O,{bold:!0,"data-test":"summary-total-difference-to-refund-amount",children:o({amount:e,currency:t})})]}):s.jsxs(fe.Group,{"data-test":"summary-total-difference-to-refund",children:[s.jsx(fe.Title,{className:"salt-p-t--2 salt-p-b--0",children:s.jsx(b,{id:"summary.difference.to.refund"})}),s.jsx(fe.Description,{className:"salt-p-t--2 salt-p-b--0",nowrap:!0,"data-test":"summary-total-difference-to-refund-amount",children:o({amount:e,currency:t})})]}):null},OL=({amount:e,currency:t})=>{const n=He();return Number(e)?s.jsxs(fe.Group,{"data-test":"summary-total-charged",children:[s.jsx(fe.Title,{className:"salt-p-t--2 salt-p-b--0",children:s.jsx(b,{id:"summary.difference.loyalty.already.charged"})}),s.jsx(fe.Description,{className:"salt-p-t--2 salt-p-b--0",nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-total-loyalty-charged-amount",children:n({amount:Wi(e),currency:t})})})]}):null},Xlt=({amount:e,currency:t,inline:n})=>{const o=He();return Number(e)?n?s.jsxs("span",{className:"salt-p-t--2 salt-d--block",children:[s.jsx(b,{id:"summary.difference.loyalty.to.refund"}),"",s.jsx(O,{bold:!0,"data-test":"summary-total-loyalty-difference-to-refund-amount",children:o({amount:e,currency:t})})]}):s.jsxs(fe.Group,{"data-test":"summary-total-loyalty-difference-to-refund",children:[s.jsx(fe.Title,{className:"salt-p-t--2 salt-p-b--0",children:s.jsx(b,{id:"summary.difference.loyalty.to.refund"})}),s.jsx(fe.Description,{className:"salt-p-t--2 salt-p-b--0",nowrap:!0,"data-test":"summary-total-loyalty-difference-to-refund-amount",children:o({amount:e,currency:t})})]}):null},Zlt=e=>{const t=L(),{paymentMethodV2:n,emailAddress:o,expiryMonth:r,expiryYear:a,cardType:i,lastFourDigits:l}=e;if(n){if(n===at.PAYPAL&&o)return t.formatMessage("order.online.receipt.payment.accessibility.paypal",{emailAddress:o});if(i&&l&&r&&a)return t.formatMessage("order.online.receipt.payment.accessibility.card",{cardType:i,last4Digits:l,cardExpiryDate:`${r}/${a}`})}},Jlt=v.span`
    display: block;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
`,ect=({paymentMethod:e,shouldShowOnlinePayment:t})=>{switch(e){case at.CARDS:case at.BLIK:case at.BANK_TRANSFER:case at.GOOGLE_PAY:case at.VISA_MOBILE:case at.CARD_INSTALMENTS:return s.jsx(b,{id:"checkout.complete.payment.method.onlinePayment.title","data-test":"payment-details-online-payment"});case at.APPLE_PAY:return t?s.jsx(b,{id:"checkout.complete.payment.method.onlinePayment.title","data-test":"payment-details-online-payment"}):s.jsx(b,{id:"checkout.complete.payment.method.applepay.title","data-test":"payment-details-applepay"});case at.PAYPAL:return s.jsx(b,{id:"checkout.complete.basket.summary.payment.method.pay.pal","data-test":"payment-details-paypal"});case at.INVOICE:return s.jsx(b,{id:"checkout.complete.basket.summary.payment.method.invoice","data-test":"payment-details-invoice"});case at.CASH_ON_DELIVERY:return s.jsx(b,{id:"checkout.complete.payment.method.payAtDelivery.title","data-test":"payment-details-cash-on-delivery"});case at.L_PAY:return s.jsx(b,{id:"checkout.complete.payment.method.lPay.title","data-test":"payment-details-l-pay"});case at.NAVERPAY:return s.jsx(b,{id:"checkout.complete.payment.method.naverpay.title","data-test":"payment-details-naverpay"});case at.KAKAOPAY:return s.jsx(b,{id:"checkout.complete.payment.method.kakaopay.title","data-test":"payment-details-kakaopay"});default:return null}},tct=({paymentInfo:{paymentMethodV2:e,nonSavedFundingInstrument:t,lastFourDigits:n,expiryMonth:o,expiryYear:r,emailAddress:a},shouldShowOnlinePayment:i})=>t?s.jsx(b,{id:"checkout.complete.basket.summary.payment.method.unsaved"}):n||o&&r?Dqe({lastFourDigits:n,expiryMonth:o,expiryYear:r}):a||(ect({paymentMethod:e,shouldShowOnlinePayment:i})??e),Ag=({paymentInfo:e})=>{const t=es("psps-show-online-payment")==="true",n=tct({paymentInfo:e,shouldShowOnlinePayment:t}),o=Zlt(e),r=!!o;return s.jsxs(h.Fragment,{children:[o&&s.jsx(ie,{"data-test":"payment-method-text-aria",children:o}),s.jsx(Jlt,{"data-test":"payment-method-text",...r&&{"aria-hidden":r},children:n})]})},sct=e=>{const{paymentInfo:t}=e;return t?s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"checkout.complete.basket.summary.payment.method"})}),s.jsx(fe.Description,{"data-pii":"true","data-test":"payment-details-value",style:{minWidth:"0px"},children:s.jsx(Ag,{paymentInfo:t})})]}):null},nct={paidByCheck:ze,remainingBalance:ze,paidByCard:ze,paidByInvoice:ze,signDisplay:m.string},oct={paidByCheck:null,remainingBalance:null,paidByCard:null,paidByInvoice:null,signDisplay:"auto"},PL=e=>{const t=He(),{paidByCard:n,paidByCheck:o,paidByInvoice:r,remainingBalance:a,signDisplay:i}=e,l=d=>d&&d.currency&&d.amount;if(!l(o))return null;const c=(d,u,p)=>l(p)&&s.jsxs(fe.Group,{"data-test":`summary-payment-checks-group-${u}`,children:[s.jsx(fe.Title,{children:s.jsx(b,{id:d})}),s.jsx(fe.Description,{nowrap:!0,"data-test":`payment-checks-split-${u}`,children:t(p,{signDisplay:i})})]},u)||null;return s.jsxs(h.Fragment,{children:[c("summary.payment.split.bonus.check","paid-by-check",o),c("summary.payment.split.rest","remaining-balance",a),c("summary.payment.split.card","card",n),c("summary.payment.split.invoice","invoice",r)]})};PL.propTypes=nct;PL.defaultProps=oct;const rct=e=>{const t=He(),{title:n,description:o,price:r,isOffer:a}=e;return r?s.jsxs(fe.Group,{"data-test":`summary-payment-split-group-${o}`,children:[s.jsx(fe.Title,{children:s.jsx(b,{id:n})}),s.jsx(fe.Description,{nowrap:!0,"data-test":`payment-split-${o}`,children:a?s.jsx(O,{intent:"promotion",bold:!0,children:t({...r,amount:Wi(r.amount)})}):t(r)})]},o):null},act=e=>{const{subtotalPrice:t,paidByLoyalty:n}=e;return!n||!Number(n.amount)?null:s.jsxs(fe,{"data-test":"summary-payment-split",children:[s.jsx(of,{value:t}),s.jsx(rct,{title:"summary.loyalty.units.name",description:"paid-by-loyalty",price:n,isOffer:!0})]})},ict=({displayName:e,taxRate:t,price:n})=>s.jsxs(fe.Group,{children:[s.jsxs(fe.Title,{children:[e,"",s.jsx(hH,{maximumFractionDigits:3,value:Number(t),style:"percent"})]}),s.jsx(fe.Description,{nowrap:!0,children:n})]},e),lct=({finalPrice:e,components:t,withTaxNote:n}={finalPrice:null,components:[],withTaxNote:!1})=>{const o=He();return t?.length?s.jsxs(h.Fragment,{children:[s.jsx(Ts,{className:"salt-m-b--2"}),s.jsxs(fe,{"data-test":"summary-taxes",children:[s.jsxs(fe.Group,{className:"salt-m-b--2",children:[s.jsx(fe.Title,{children:s.jsxs(O,{bold:!0,className:"salt-d--inline-block","data-test":"summary-subtotal",children:[s.jsx(b,{id:"summary.subtotal"}),n&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-subtotal-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]})}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-subtotal-amount",children:e&&o(e)})]}),t.map(r=>ict({...r,price:o(r.taxAmount)}))]})]}):null};m.bool;const cct={rebookable:m.bool};m.string;const dct={rebookable:!1},NL=({rebookable:e})=>e?s.jsx(O,{size:"s",className:"salt-m-t--2",children:s.jsx(b,{id:"order.details.rebook.info"})}):null;NL.propTypes=cct;NL.defaultProps=dct;const uct=({promotion:e})=>{const t=He(),{saving:n,description:o,promoId:r}=e;return s.jsxs(fe.Group,{"data-test":"summary-order-level-promotion-item",children:[s.jsx(fe.Title,{"data-test":"summary-order-level-promo-title",children:o}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-order-level-promo-amount",children:t({...n,amount:Wi(n?.amount)})})})]},r)},pct=({orderLevelPromotions:e})=>{const t=e?.filter(n=>n?.type==="PROMOTION")||[];return t?.length?s.jsx(h.Fragment,{children:t.map(n=>s.jsx(uct,{promotion:n},n?.promoId))}):null},mct={preparationCost:ze,withTaxNote:m.bool,signDisplay:m.string},hct={preparationCost:null,withTaxNote:!1,signDisplay:"auto"},LL=e=>{const t=He(),{preparationCost:n,withTaxNote:o,signDisplay:r}=e;return Number(n?.amount)?s.jsxs(fe.Group,{"data-test":"summary-preparation-cost",children:[s.jsxs(fe.Title,{"data-test":"summary-preparation-cost-title",children:[s.jsx(b,{id:"summary.preparation"}),o&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-preparation-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-preparation-cost-amount",children:t(n,{signDisplay:r})})]}):null};LL.propTypes=mct;LL.defaultProps=hct;const gct={invoice:ze,withTaxNote:m.bool,signDisplay:m.string},Ect={invoice:null,withTaxNote:!1,signDisplay:"auto"},kL=e=>{const t=He(),{invoice:n,withTaxNote:o,signDisplay:r}=e;return Number(n?.amount)?s.jsxs(fe.Group,{"data-test":"summary-invoice",children:[s.jsxs(fe.Title,{"data-test":"summary-invoice-title",children:[s.jsx(b,{id:"summary.invoice"}),o&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-invoice-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-invoice-amount",children:t(n,{signDisplay:r})})]}):null};kL.propTypes=gct;kL.defaultProps=Ect;const fct={depositsPrice:ze,withTaxNote:m.bool,signDisplay:m.string},yct={depositsPrice:null,withTaxNote:!1,signDisplay:"auto"},jL=e=>{const t=He(),{depositsPrice:n,withTaxNote:o,signDisplay:r}=e;return Number(n?.amount)?s.jsxs(fe.Group,{"data-test":"summary-deposit-charge-item",children:[s.jsxs(fe.Title,{"data-test":"summary-deposit-title",children:[s.jsx(b,{id:"summary.deposit.charge"}),o&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-deposit-charge-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-deposit-charge-amount",children:t(n,{signDisplay:r})})]}):null};jL.propTypes=fct;jL.defaultProps=yct;const Ict=({appliedVouchers:e=[],vouchersSavingsPrice:t})=>{const n=He(),o=e.length;return!o||!t||!Number(t.amount)?null:s.jsxs(fe.Group,{"data-test":"summary-applied-voucher",children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"summary.voucher.updated.format",values:{count:o}})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,"data-test":"summary-voucher-amount",children:n({amount:Wi(t.amount),currency:t.currency})})})]},"total-vouchers")},Sct={environmentalHandlingPrice:ze,withTaxNote:m.bool,signDisplay:m.string},Cct={environmentalHandlingPrice:null,withTaxNote:!1,signDisplay:"auto"},ML=e=>{const t=He(),{environmentalHandlingPrice:n,withTaxNote:o,signDisplay:r}=e;return Number(n?.amount)?s.jsxs(fe.Group,{"data-test":"summary-environmental-handling-charge",children:[s.jsxs(fe.Title,{"data-test":"summary-environmental-handling-charge-title",children:[s.jsx(b,{id:"summary.environmental-handling-charge"}),o&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-environmental-handling-charge-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-environmental-handling-charge-amount",children:t(n,{signDisplay:r})})]}):null};ML.propTypes=Sct;ML.defaultProps=Cct;const vct=({className:e})=>s.jsx(Ts,{className:`salt-m-b--2 ${e??""}`}),Tct=e=>{const{smallOrderPrice:t,withTaxNote:n=!1,signDisplay:o="auto",thresholds:r=[],withIcon:a,orderId:i,page:l}=e,{formatMessage:c}=L(),d=He();if(!t||!Number(t.amount))return null;const u=c("summary.charges.small.order.charge"),p=d(t,{signDisplay:o});return s.jsxs(fe.Group,{"data-test":"summary-small-order-charge",children:[s.jsxs(fe.Title,{"data-test":"summary-small-order-charge-title",children:[u,n&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-small-order-charge-note",children:c("order.details.tax.exclusive.price")})]}),"",a&&s.jsx(yX,{orderId:i,thresholds:r,page:l})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-small-order-charge-amount",children:p})]})},le={BagCharge:Llt,Buttons:TL,BuyBacks:bL,Delivery:_lt,DeliveryPromotions:blt,Deposit:jL,EnvironmentalHandlingCharge:ML,Items:xL,Loyalty:DT,PaymentChecks:PL,PaymentMethod:sct,PaymentLoyalty:act,PreparationCost:LL,Invoice:kL,Promotions:pct,RebookableDisclaimer:NL,Savings:AL,Taxes:lct,TotalInline:RL,TotalSpaceBetween:DL,TotalCharged:Klt,TotalDifferenceToCharge:zlt,TotalDifferenceToRefund:Qlt,TotalLoyaltyCharged:OL,TotalLoyaltyDifferenceToRefund:Xlt,Vouchers:Ict,Subtotal:of,Separator:vct,SmallOrderCharge:Tct,WaonPoints:glt,SavingsWithPaymentMethod:Elt},_ct=({isExpanded:e,loading:t,taxNoteEnabled:n,totalPrice:o,priceNote:r,totalPriceTitle:a,summaryTitle:i,renderEditOrderDifference:l})=>{const c=h.useMemo(()=>e?s.jsx(ee,{as:"span",children:i}):s.jsx(le.TotalInline,{loading:t,totalPrice:o,withTaxNote:n,title:a,note:r}),[i,e,t]);return s.jsxs(cs.ControlSection,{children:[s.jsxs("span",{className:"flex flex-column inline-block",children:[c,l&&!e&&l(e)]}),s.jsx(cs.ToggleSwitch,{})]})},bct=({loading:e,taxNoteEnabled:t,totalPrice:n,priceNote:o,totalPriceTitle:r,isExpanded:a,renderEditOrderDifference:i,children:l})=>s.jsxs(cs.Content,{children:[s.jsx(ae.Fragment,{children:l}),s.jsx(le.TotalSpaceBetween,{loading:e,totalPrice:n,withTaxNote:t,title:r,note:o}),i&&a&&i(a)]}),xct=({breakpoint:e})=>s.jsxs(Kt,{breakpoint:e,children:[s.jsx(js,{children:s.jsx(js.Skeleton,{})}),s.jsx(le.Buttons,{loading:!0})]}),Act=({renderButtonsSection:e,loading:t})=>s.jsx(le.Buttons,{loading:t,children:e()}),Rct=D("tx.nts"),wL=({loading:e,summaryTitle:t,priceNote:n,totalPriceTitle:o,totalPrice:r,basketSummary:a,breakpoint:i,loadedViewPortSize:l,reverseToggleBreakpoint:c,name:d,ariaCollapsedLabel:u,ariaExpandedLabel:p,ariaHeader:g,sticky:E=!0,renderButtonsSection:y,renderItemsSection:I,renderItemsBySellerSection:S,renderEditOrderDifference:C,children:T})=>{const[_]=Ee(["ord.def.col"]),[A,R]=h.useState(!0),P=f(Rct),N=He(),k=os({breakpoint:i});h.useEffect(()=>{k&&_&&R(!1)},[_,k]);const M=IX(A,R),w=f(j=>Ze(j,"seller-sales-enabled")==="true");return!a||!l?s.jsx(xct,{breakpoint:i,loadedViewPortSize:l,basketSummary:a}):s.jsxs(cs,{name:d,expanded:A,onToggle:M,breakpoint:i,sticky:E,aria:{expandedLabel:g?`${g}${p}`:p,collapsedLabel:g?`${g}${u}`:u,totalPrice:r&&N(r)},reverseToggleBreakpoint:c,children:[s.jsx(_ct,{isExpanded:A,loading:e,taxNoteEnabled:P,totalPrice:r,summaryTitle:t,priceNote:n,totalPriceTitle:o,renderEditOrderDifference:C}),s.jsx(bct,{loading:e,taxNoteEnabled:P,totalPrice:r,basketSummary:a,priceNote:n,totalPriceTitle:o,isExpanded:A,renderEditOrderDifference:C,children:w?S():I()}),T,s.jsx(Act,{renderButtonsSection:y,loading:e})]})},Dct=({onAfterConfirm:e})=>{const{formatMessage:t}=L(),n=F(),o=()=>n(J.closeModal()),r=_7(),a=f(D("m.la.h")),i=f($e("ageConfirmation")),l=()=>{r(),o(),e()},c={header:t("alcohol.age.confirmation.trolley.modal.header"),body:t("alcohol.age.confirmation.trolley.modal.body"),cancel:t("alcohol.age.confirmation.trolley.modal.cancel"),confirm:t("alcohol.age.confirmation.button.label")};return s.jsx(B,{isOpen:i,onRequestClose:o,children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:a?"left":"center",children:s.jsx(ee,{as:"h1",children:c.header})}),s.jsx(B.Body,{children:c.body}),s.jsxs(B.Footer,{align:a?"left":"center",className:"salt-gap-x--2",children:[s.jsx(x,{intent:"secondary",onClick:o,fill:!0,children:s.jsx(x.Text,{children:c.cancel})}),s.jsx(x,{intent:"primary",onClick:l,fill:!0,children:s.jsx(x.Text,{children:c.confirm})})]})]})})},SX=({state:e,searchParams:t=new URLSearchParams,shippingGroupType:n="",inCheckoutWalk:o=!1,isContinue:r=!1})=>{const a=pE(e),i=RC(e),l=zV(e);return Tr({inCheckoutWalk:o||a,directDeliveryMethod:i?l:void 0,shippingGroupType:n,searchParams:t,isContinue:r})},rf=({searchParams:e=new URLSearchParams,shippingGroupType:t="",inCheckoutWalk:n=!1,isContinue:o=!1}={})=>{const r=Yd();return SX({state:r.getState(),shippingGroupType:t,searchParams:e,inCheckoutWalk:n,isContinue:o})},Oct=v(Ye)`
    text-decoration: none;
`,Pct=({className:e})=>{const{formatMessage:t}=L(),n=F(),o=rf({isContinue:!0}),r=f(Ct);h.useEffect(()=>{n(U.analyticsEvent({type:Re.BOOK_SLOT_BUTTON_VIEWED}));const i={event:"view_cart_book_slot"};te.sendEvent({GA:i,WA:null})},[]);const a=()=>{n(U.analyticsEvent({type:Re.BOOK_SLOT_BUTTON_CLICKED,orderId:r}));const i={event:"cart_book_slot",order_id:r||""};te.sendEvent({GA:i,WA:null})};return s.jsx(x,{asChild:!0,className:e,onClick:a,intent:"primary","data-test":"basket-summary-book-slot",fill:!0,children:s.jsx(Oct,{to:o,children:s.jsx(x.Text,{children:t("basket.summary.book-slot")})})})},FL=()=>e=>e(Hr.getCheckoutWalk()).then(t=>{const{responseData:{entities:n,result:o}={}}=t.payload,{missedPromotions:r}=o||{},a={product:{}},i=o?.pages?.find(l=>l.productGroups[0]?.engine==="FREE_GIFTS");return i&&i.productGroups[0]?.freeGifts?.promotions.forEach(l=>{l.products?.forEach(c=>{a.product={...a.product,[c.productId]:c}})}),n&&e(xt.setProducts(n)),r?.length&&e(fo.addMissedPromotions(r)),Object.keys(a.product).length&&e(xt.setProducts(a)),o||null}),CX=se("T_AND_C_ACKNOWLEDGE"),Nct="RECURRING_SHOPPING_DEFINITION_FORM_RESET",vX="EDIT_RECURRING_ORDER_OPTION",Lct=()=>({type:"API",payload:{url:"/v4/checkout/terms-and-conditions/acknowledge",service:"web_order_ws",pathPrefix:{client:"/api/order",server:"/core-api"},options:{method:"POST"},...CX}}),kct=e=>({type:vX,payload:{editOption:e}}),IA={acknowledgeTermsAndConditions:Lct,setEditRecurringOrderOption:kct,types:{T_AND_C_ACKNOWLEDGE:CX,RECURRING_SHOPPING_DEFINITION_FORM_RESET:Nct,EDIT_RECURRING_ORDER_OPTION:vX}},jct=(e,t)=>e.map(n=>({...t.find(r=>n.retailerProductId===r.retailerProductId),variant:n.variant,quantity:`${n.quantity}`})),Mct=(e,t)=>async(n,o)=>{try{const r=await n(Ia.getDecoratedOrder(e)),a=Oo(o());let i;t&&(i=await ko.fetchAnalyticsMetadataByCheckoutId(t,a));const{payload:{responseData:l}}=r,{order:c,product:d}=l.entities,{orderTotals:u,deliveryType:p,deliveryMethod:g,paymentInfo:E,appliedVouchers:y,charges:I,dates:{deliveryStartDate:S},recurringShoppingDefinition:C,loyalty:T}=c[e];return{analyticsPayload:{orderId:e,product:[...Object.values(d)],orderTotals:u,deliveryType:p,deliveryMethod:g,paymentInfo:E,appliedVouchers:y,charges:I,deliveryStartDate:S,page:"checkout",recurringShoppingDefinition:C,loyalty:T,groupId:null,meta:i},isOrderFetched:!0}}catch{return{isOrderFetched:!1}}},TX=(e,t)=>async n=>{if(!e)return{isOrderFetched:!1};const{orderId:o,checkoutId:r}=t,a=await n(Mct(o,r));if(a.isOrderFetched){const{checkout:{price:i,products:l,loyalty:c,type:d,tax:u}}=t;return{analyticsPayload:{...a.analyticsPayload,currencyCode:i.currency,product:jct(l,a.analyticsPayload.product),loyaltyDelta:c,editedOrder:d==="ORDER_EDIT",tax:u.amount,revenue:i.amount},isOrderFetched:!0}}return{isOrderFetched:!1}},Sn={BOOK_SLOT:"BOOK_SLOT",CHECKOUT_WALK:"CHECKOUT_WALK",EDIT_ORDER:"EDIT_ORDER",BASKET_SPLIT_TRIGGERED:"BASKET_SPLIT_TRIGGERED"},wct=m.oneOf(Object.values(Sn)),_X=Y(zs,e=>e.fetchError?!1:!!e.data),bX=Y(Ys,zs,(e,t)=>t.data?.deliveryMethod===e),xX=(e,t,n)=>{const{query:o}=e.router.location;return o?o[t]===n:!1},BL=e=>xX(e,"in-checkout-walk","true"),AX=e=>xX(e,"continue","true"),OT=e=>nu(e)?Sn.EDIT_ORDER:BL(e)?Sn.CHECKOUT_WALK:Sn.BOOK_SLOT,UL=e=>e.router.location?.query?.[GHe],RX=Y(UL,e=>e?.match(/\d{4}-\d{2}-\d{2}/)?HHe:$He),Fct=e=>{const t=RX(e),n=pm(e),o=D("oosa")(e),r=D("sl.cut")(e),a=D("bt.spl")(e),i=t===Sn.CHECKOUT_WALK,l=t===Sn.EDIT_ORDER;return a&&!(o&&r)&&!i&&!l&&n},af=Y(_X,bX,D("bt.spl"),pm,nu,zs,(e,t,n,o,r,a)=>e&&!t&&n&&!o&&!(a.isFetching&&r)),jm=Y(Ys,ru,Rl,(e,t,n)=>e===pt.clickAndCollect.method?t:n),bu=Y(jm,e=>Object.values(e.data).filter(Dl)),Bct=Y(qi,Ys,um,(e,t,n)=>`${e}:${t}:${n}`),DX=Y(qi,zs,(e,t)=>e&&e===t.data?.deliveryDestinationId&&!t.data?.addressId),OX=Y(jm,DX,(e,t)=>!e.isFetching&&t),PX=Y(bu,e=>e.length>0),NX=Y(jm,PX,(e,t)=>!!e.lastUpdated&&!t),LX=Y(jm,NX,(e,t)=>!e.isFetching&&t),GL=Y(zs,$i,Ys,(e,t,n)=>Dl(e.data)&&t&&e.data?.deliveryDestinationId===t&&e.data?.deliveryMethod===n),Uct=({wasEdited:e,order:t})=>({event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventLabel:e?"edited-confirmed-order":"new-confirmed-order",eventAction:"OrderConfirmed",ecommerce:{currencyCode:t.orderTotals?.totalPrice?.currency,purchase:{actionField:{id:t.orderId,editedOrder:e,coupon:t.appliedVouchers.map(n=>n.id).join(", "),shipping:Number(t.charges.delivery.amount)},products:t.products?.length?[t.products[0]]:[]}}}),Gct=({order:e,productEntities:t,groupId:n,featuredProductCampaigns:o,hasDeliveryPass:r,meta:a})=>{const{items:i}=e,l=15,c=Math.ceil(i.length/l),d=[];for(let p=0;p<c;p+=1)d.push(i.slice(p*l,(p+1)*l).map(g=>({...g,productEntity:t[g.product]})));const u=p=>p===0;return d.map((p,g)=>LW({data:e,productChunk:p,isFirstChunk:u(g),mapEventItem:NW,index:g,groupId:n,hasDeliveryPass:r,meta:a,featuredProductCampaigns:o}))},$ct=({featuredProductCampaigns:e,payload:t})=>{const{product:n,meta:o}=t,r=15,a=Math.ceil(n.length/r),i=[];for(let c=0;c<a;c+=1)i.push(n.slice(c*r,(c+1)*r));const l=c=>c===0;return i.map((c,d)=>dW(t,c,l(d),cW,d,o,e))},Hct=({featuredProductCampaigns:e,payload:t})=>{const{product:n}=t;if(!n.length)return[UI({payload:t,productChunk:[],isFirstChunk:!0,mapProductToItem:BI,index:0,featuredProductCampaigns:e})];const o=15,r=Math.ceil(n.length/o),a=[];for(let l=0;l<r;l+=1)a.push(n.slice(l*o,(l+1)*o));const i=l=>l===0;return a.map((l,c)=>UI({payload:t,productChunk:l,isFirstChunk:i(c),mapProductToItem:BI,index:c,featuredProductCampaigns:e}))},EG=({payload:e,productChunk:t,index:n,markLast:o})=>{const{orderId:r,editedOrder:a,revenue:i,tax:l,orderTotals:c,deliveryType:d,paymentInfo:u,appliedVouchers:p,charges:g,loyalty:E,deliveryStartDate:y}=e;let I,S,C;const T=g.delivery.amount,_=p.map(R=>R.id).join(", "),A=c.totalPrice.currency;return n===0?(I=i,S=l,C=E&&E.spent.money.amount):(I="0",S="0",C=E&&"0"),{ecommType:"enhanced",event:"event",eventCategory:"E-commerce",eventLabel:"edited-order",eventAction:"OrderPurchased",ecommerce:{currencyCode:A,purchase:{actionField:{id:r,revenue:Number(I),tax:S,coupon:_,shipping:Number(T)},products:t.map(R=>tn({...R,quantity:`${R.quantity}`},void 0,void 0))}},...sW(d,C,y,u)}},Vct=({payload:e,shouldMarkLastEvent:t})=>{const{product:n}=e,o=25;if(!n.length)return[EG({payload:e,productChunk:[],index:0,markLast:!0})];const r=Math.ceil(n.length/o),a=[];for(let i=0;i<r;i+=1)a.push(n.slice(i*o,(i+1)*o));return a.map((i,l)=>EG({payload:e,productChunk:i,index:l,markLast:l+1===r&&t}))},Wct=se("CHECKOUT_COMPLETE"),Yct=e=>({type:"API",payload:{url:"/v1/checkout/complete",pathPrefix:{server:"/core-api"},options:{method:"POST",body:{parameterToken:e.parameterToken,payload:{pspName:e.pspName,applePayTokenData:e.applePayTokenData}}},...Wct}}),qct={makeCheckoutCompleteRequest:Yct},Kct=14,zct=({parameterToken:e,pspSession:{amount:{value:t,currency:n},countryCode:o,supportedNetworks:r,applePayData:{paymentSession:a,capabilities:i},pspName:l},handleSuccess:c,intl:d})=>async u=>{if(!window.ApplePaySession)throw new Error("Apple Pay is not loaded");const p={countryCode:o,currencyCode:n,supportedNetworks:r,merchantCapabilities:i,total:{label:d.formatMessage("payment.applepay.retailer.display.name"),amount:t}},g=new window.ApplePaySession(Kct,p);g.onvalidatemerchant=()=>g.completeMerchantValidation({merchantSession:JSON.parse(a)});const E=window.ApplePaySession.STATUS_SUCCESS,y=window.ApplePaySession.STATUS_FAILURE;g.onpaymentauthorized=async I=>{try{const{payment:S}=I,C=JSON.stringify(S.token),T=await u(qct.makeCheckoutCompleteRequest({applePayTokenData:C,pspName:l,parameterToken:e}));g.completePayment({status:E}),await c({resultToken:T?.responseData?.resultToken})}catch(S){throw Ue.api.pushError(new Error(`Apple Pay payment checkout complete failed: ${S instanceof Error?S.message:"Unknown error"}`)),g.completePayment({status:y}),S}},g.begin()},kX=D("cow"),Qct=D("cs.tca"),Xct=D("cs.tcd"),Zct=D("gtm.opfc"),Jct=D("cs.gosd"),edt=D("mins"),fG=e=>e&&e.slot,yG=e=>e?.checkout?.basketAboveThreshold??!1,IG=e=>e?.checkout?.canCheckout??!1,tdt="order.cow.time.restriction.on.demand.slots.validation.error",jX="order.cow.checkout.restriction.validation.error",MX="order.cow.slot.not.deliverable.validation.error",wX=[tdt,jX],sdt=e=>({redirectTo:e}),SG=({basket:e=null,state:t})=>{if(!fG(e)&&!yG(e)&&!IG(e))return{canCheckout:!1,redirect:fn({queryString:void 0})};if(!fG(e))return{canCheckout:!1,redirect:SX({state:t,inCheckoutWalk:!0,shippingGroupType:e?.checkout?.shippingGroupType})};const n=AX(t);return!yG(e)&&!n?{canCheckout:!1,redirect:nV({shippingGroupType:e?.checkout?.shippingGroupType})}:IG(e)?{canCheckout:!0}:{canCheckout:!1,redirect:jt()}},FX=e=>e(FL()),$L=e=>(t,n)=>e?Promise.resolve(SG({basket:e,state:n()})):t(Yt.getBasket()).then(o=>SG({basket:o,state:n()})),lf=e=>(t,n)=>t($L(e)).then(o=>kX(n())&&o.canCheckout?FX(t).then(()=>o,()=>o):o),ndt=e=>(t,n)=>{const o=e&&e.url&&!e.url.indexOf(Qg()),r=e&&e.url&&!e.url.indexOf(OR()),a=i=>!i.canCheckout&&!o&&!r?sdt(i.redirect):null;return t($L()).then(i=>kX(n())&&i.canCheckout&&!o?FX(t).then(()=>i,()=>i):i).then(a)},odt=(e,t)=>{e(U.analyticsEvent({type:Le.RECURRING_ORDER_CREATED,recurringShoppingDefinition:t.recurringShoppingDefinition}))},rdt=(e,t,n,o)=>{Vct({payload:t,shouldMarkLastEvent:n}).forEach(i=>{te.sendEvent({GA:i,WA:null})}),Hct({payload:t,featuredProductCampaigns:o}).forEach(i=>{te.sendEvent({GA:i,WA:null})}),e(U.analyticsEvent({type:Le.ORDER_PURCHASED,...t}))},adt=(e,t,n)=>{$ct({payload:t,featuredProductCampaigns:n}).forEach(r=>{te.sendEvent({GA:r,WA:null})}),e(U.analyticsEvent({type:Le.SELECT_PLACE_ORDER,...t}))},idt=(e,t)=>e(Qg({orderId:`${t.payload.responseData.orderId}`})),CG=(e,t,n,o,r={})=>(a,i)=>a(qr.orderPaymentCheckout(t)).then(async l=>{const{payload:{responseData:c}}=l,d=!Zct(i()),u=Jct(i()),p=c.type==="checkout-result-response",{analyticsPayload:g,isOrderFetched:E}=await a(TX(p,c));try{const S=i().data.basket||{},C=i().data.products||{},T=Qs(i());let _;if(!p&&"checkoutId"in c){const A=Oo(i());_=await ko.fetchAnalyticsMetadataByCheckoutId(c.checkoutId,A)}adt(a,E?{...g}:{orderId:S.orderId,editedOrder:S.basketStatus==="ORDER_EDIT",revenue:S.totals?.totalPrice?.amount||"",tax:S.totals?.taxesTotals?.taxes?.totalAmount?.amount||"",orderTotals:S.totals,deliveryType:S.checkout?.delivery?.deliveryType,paymentInfo:{},appliedVouchers:S.vouchers.map(A=>({id:A.voucherId,saving:A.savings})),charges:{delivery:S.delivery},loyalty:{...S.loyalty,spent:{money:{amount:S.loyalty?.unitsSpent}}},deliveryStartDate:S.checkout?.delivery?.startTime,product:S.items.map(A=>{const R=C.productEntities[A.productId];return{...R,quantity:A.quantity.quantityInBasket,sellerId:R?.seller?.id}}),page:"checkout",currencyCode:S.totals?.totalPrice?.currency,meta:_},T)}catch{Ue.api.pushError(new Error("Failed to send SELECT_PLACE_ORDER event"))}if(E){if(d){const S=Qs(i()),C=D("co.last")(i());rdt(a,g,C,S)}else if(!d)try{const S=JSON.stringify(g);localStorage.setItem(rg,S),u&&Ue.api.pushLog([`ORDER_PURCHASE event sent saved to localstorage. OrderId: ${g?.orderId}.`],{level:Si.DEBUG})}catch{Ue.api.pushError(new Error("Could not stringify data for ORDER_PURCHASE event and set it to localstorage: "),{context:{analyticsPayload:JSON.stringify(g)}})}return g?.recurringShoppingDefinition&&odt(a,g),a(Yt.getBasket()).catch(()=>{}).then(()=>idt(e,l))}if(u&&Ue.api.pushLog(["started payment authentication process (ORDER_PURCHASE event debug)"],{level:Si.DEBUG}),c.type==="payment-session-response")return a(zct({...c,handleSuccess:n,intl:o}));const{paymentSession:y}=t,{url:I}=l.payload.responseData;return y.initiatePaymentAuthentication({authenticationUrl:I})}).catch(l=>{let c={error:!0};const d=[U.analyticsEvent({type:Le.PLACE_ORDER,status:"FAILURE",error:`FAILED_AFTER_CLICK - ${l.message}`})],u=["order.cow.payment.failure.invoice.not.registered","order.cow.payment.failure.invoice.insufficient.funds"];if(!!l?.statusCode&&l.statusCode>=400&&l.statusCode<=499){const E=l.message&&AC(l.message)?l.message:"exception.checkout.notAllowed";if(u.includes(E))c={...c,errorMessageKey:E,showErrorAsAlert:!0};else if(wX.includes(E)||E===MX)c={...c,errorMessageKey:E,showErrorAsAlert:!1};else{if(edt(i())&&E==="basket.below.threshold.error"){const{paymentSession:y}=t;y.cancelPayment(),e(nV({shippingGroupType:i().data.basket.checkout.shippingGroupType,showErrorIfShippingGroupDoesntExist:!0}))}Z.error({key:E,substitutions:{...r}})}}else Z.error("toast.notification.generic.error");const{paymentSession:g}=t;return g.cancelPayment(),d.forEach(E=>a(E)),c}),ldt=(e,t,n,o,r={})=>(a,i)=>Qct(i())||Xct(i())?a(IA.acknowledgeTermsAndConditions()).then(()=>a(CG(e,t,n,o,r))).catch(()=>{Ue.api.pushError(new Error("Terms and Conditions: T_AND_C_ACKNOWLEDGE call failed")),Z.error("toast.notification.generic.error")}):a(CG(e,t,n,o,r)),BX=se("EXTEND_SLOT"),cdt=e=>({type:"API",payload:{pathPrefix:{client:"/api/ecomslots",server:"/core-api"},service:"ecomslots",url:"/v1/slots/extend",options:{method:"POST",body:{regionId:e}},...BX}}),ddt={extendSlot:cdt,types:{EXTEND_SLOT:BX}},udt=()=>async(e,t)=>{const n=t(),o=vn(n);await e(ddt.extendSlot(o))},UX={extendSlot:udt},pdt=e=>{let t=5;const n=o=>{e()||t===0?o():(t-=1,setTimeout(()=>n(o),300))};return new Promise(n)},GX=e=>{const t=Ge(),n=ci(),o=f(D("csf")),[r,a]=h.useState(!1),i=f(Ct),l=F(),c=mdt(),d=hdt(),u=gdt(),p=Edt(),g=mL(),E=f(LR),y=f(Oo);return{onConfirmCheckout:h.useCallback(async S=>{let C=e;l(U.analyticsEvent({type:Re.CHECKOUT_ORDER_BUTTON_CLICKED,orderId:i,minSpendReached:C?.checkout?.basketAboveThreshold||!1}));const T={event:"cart_checkout",order_id:i};if(te.sendEvent({GA:T,WA:null}),!C){const _=await p();if(_===null){a(!1);return}if(_?.length>1){a(!1),t(jt());return}const[A]=_;C=A}if(!C){a(!1);return}if(C?.checkout?.minimumCheckoutThreshold&&!C?.checkout?.basketAboveThreshold){g({basketSummary:C,type:"warning"});return}if(!c()){l(ds({name:tAe,event:S})),a(!0),o&&await pdt(()=>!P5(E));try{if(!await u({shippingGroupType:C?.checkout?.shippingGroupType})){a(!1);return}const{canCheckout:A,redirect:R}=await d(C);if(A){C?.slot&&l(UX.extendSlot()),l(U.analyticsEvent({type:Zn.CHECKOUT_WALK})),t(na());return}if(R?.includes(Ui())){const P=await ko.fetchAnalyticsMetadataByActiveCart(y);l(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:P})),n(P)}a(!1),t(R)}catch{a(!1)}}},[e,l,i,c,o,p,t,g,E,u,d]),isCheckoutLoading:r}},mdt=()=>{const e=F(),t=f(Wv);return h.useCallback(()=>t?.orderId?(e(J.openModal("failedPayment")),!0):!1,[e,t])},hdt=()=>{const e=F();return h.useCallback(async t=>{const{canCheckout:n,redirect:o}=await e(lf(t));return{canCheckout:n,redirect:o}},[e])},gdt=()=>{const e=F(),t=f(Xe);return h.useCallback(async({shippingGroupType:o})=>{if(o&&t)try{await e($y.basketCheckoutStart(o))}catch{return Z.error("toast.notification.generic.error"),Promise.resolve(!1)}return Promise.resolve(!0)},[e,t])},Edt=()=>{const e=F(),{pathname:t}=Ne();return h.useCallback(async()=>{if(t===jt())return[];try{return(await e(Yt.getBasket({cartType:ma.CART_VIEW,productGroupingType:kx.NULL})))?.checkoutGroups?.filter(hV)||[]}catch{return Z.error("toast.notification.generic.error"),null}},[e,t])},fdt=()=>{const e=F(),t=f(is);h.useEffect(()=>{!t.lastUpdated&&!t.isFetching&&e(Yt.getBasket())},[t.lastUpdated,t.isFetching,e])},ydt=e=>{const t=f(D("bsbm")),n=f(D("bt.spl")),o=f(jR),r=f(xn);return t&&!n&&(e?!e?.slot&&!e?.checkout?.basketAboveThreshold:!r&&!o)},Np=({name:e,basketSummary:t,className:n})=>{const o=t?.checkout?.shippingGroupType,{isCheckoutLoading:r,onConfirmCheckout:a}=GX(t),i=U7(),l=ydt(t),c=F(),d=()=>c(J.openModal("ageConfirmation")),u=f(jR),p=Bn(u);return fdt(),h.useEffect(()=>{p!==void 0&&p!==u&&c(U.analyticsEvent({type:Re.CHECKOUT_ORDER_BUTTON_VIEWED,minSpendReached:u}))},[c,u,p]),h.useEffect(()=>{if(!l){c(U.analyticsEvent({type:Re.CHECKOUT_ORDER_BUTTON_VIEWED,minSpendReached:t?.checkout?.basketAboveThreshold??!1}));const g={event:"view_cart_checkout"};te.sendEvent({GA:g,WA:null})}},[l]),l?s.jsx(Pct,{className:n}):s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"action",fill:!0,onClick:i?d:a,"data-synthetics":"start-checkout-button","data-test":`basket-checkout-button${o?`-${Pi(o)}`:""}`,loading:r,className:n,children:s.jsx(x.Text,{children:e||s.jsx(b,{id:"basket.summary.checkout"})})}),i&&s.jsx(Dct,{onAfterConfirm:a})]})},$X=e=>{const t=f(D("loy.waon")),n=f(Wn(["sumsub","bt.spl"])),{formatMessage:o}=L(),r=o("summary.title"),a=o(n?"summary.subtotal":"summary.total"),i=o(n?"summary.subtotal.price.note":"summary.total.note"),l=o("summary.component.accessibility.toggle.switch.on.label"),c=o("summary.component.accessibility.toggle.switch.off.label"),d=t?e?.totals?.paymentSplit?.remainingPayment:e?.totals?.display?.finalPrice;return{totalPrice:n?e?.totals?.display?.itemPriceAfterPromos:d,totalPriceTitle:a,summaryTitle:r,priceNote:i,ariaExpandedLabel:l,ariaCollapsedLabel:c}},HX=Wn(["sumsub","bt.spl"]),PT=D("tx.nts"),HL=D("loy.waon"),NT=D("prp"),LT=D("sib"),VX=D("pay.check.use"),Idt=D("cs.ps"),WX=Ro(["loyalty","loyred"]),Sdt=D("loyear.csm"),YX=D("oed"),VL=({basketSummary:e,taxNoteEnabled:t,getLoyaltySpent:n,page:o})=>{const r=f(Idt)?"always":"auto",a=f(WX),l=!f(c=>Ze(c,"seller-sales-enabled")==="true")||!!e?.delivery||!!e?.deliveryPromotions?.length;return s.jsxs(ae.Fragment,{children:[s.jsx(le.Promotions,{orderLevelPromotions:e.orderLevelPromotions}),s.jsx(le.Vouchers,{appliedVouchers:e.vouchers,vouchersSavingsPrice:e.totals?.vouchersSavingsPrice}),s.jsx(le.Delivery,{delivery:e.delivery,withTaxNote:t,signDisplay:r}),l&&s.jsx(le.DeliveryPromotions,{deliveryPromotions:e?.deliveryPromotions,hideDeliveryPassInfo:!0}),s.jsx(le.BagCharge,{carrierBag:e.carrierBag,withTaxNote:t,signDisplay:r}),s.jsx(le.PreparationCost,{preparationCost:e.preparation,withTaxNote:t,signDisplay:r}),s.jsx(le.Loyalty,{isLoyaltyRedeemEnabled:a,getLoyaltySpent:n}),s.jsx(le.Deposit,{depositsPrice:e.totals?.depositsPrice,withTaxNote:t,signDisplay:r}),s.jsx(le.EnvironmentalHandlingCharge,{environmentalHandlingPrice:e.totals?.environmentalHandlingPrice,withTaxNote:t,signDisplay:r}),s.jsx(le.Invoice,{invoice:e.invoice,withTaxNote:t,signDisplay:r}),s.jsx(le.SmallOrderCharge,{smallOrderPrice:e.smallOrder,orderId:e.orderId,thresholds:e.smallOrderChargeThresholds,withTaxNote:t,signDisplay:r,page:o,withIcon:!0})]})},WL=({basketSummary:e,taxNoteEnabled:t})=>e.totals?.taxesTotals?s.jsx(le.Taxes,{"data-test":"summary-taxes",finalPrice:e.totals?.finalPrice,components:e.totals?.taxesTotals?.taxes?.components,withTaxNote:t}):null,Cdt=v(Te)`
    text-align: start;
`,vG=({className:e})=>{const{formatMessage:t}=L(),n=f(r=>Ze(r,"reference-price-savings-info-banner-url")),o=n!=="";return s.jsx(Cdt,{intent:"info","data-test":"savings-info",className:e,showIcon:!1,text:t("summary.savings.pricing.info"),link:o?s.jsx(Te.Link,{isSSRNavigation:!0,target:"_blank",href:n,children:t("summary.savings.learn.more")}):void 0})},ui=({className:e,isSummarySection:t})=>t?s.jsx(fe.Group,{children:s.jsx(fe.Title,{className:"salt-p-r--0 salt-p-b--0",children:s.jsx(vG,{className:e})})}):s.jsx(vG,{className:e}),qX=({basketSummary:e,page:t})=>{const n=f(HX),o=f(PT),r=f(HL),a=f(NT),i=f(LT),l=n?e?.totals?.display?.itemPriceAfterPromos:e?.totals?.display?.finalPrice,c=e?.totals?.paymentSplit?.paidByLoyalty,d=tE(e?.items),u=!!Number(e?.totals?.savingsPrice?.amount);return e?s.jsxs(ae.Fragment,{children:[s.jsxs(fe,{children:[s.jsx(le.Items,{itemsRetailPrice:e?.totals?.itemsRetailPrice,quantity:d,withTaxNote:o}),s.jsx(le.Savings,{savings:e?.totals?.savingsPrice}),i&&a&&u&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:e?.totals?.paymentMethodSavingsPrice}),!n&&s.jsx(VL,{basketSummary:e,taxNoteEnabled:o,getLoyaltySpent:bl,page:t})]}),s.jsx(WL,{basketSummary:e,taxNoteEnabled:o}),r&&s.jsx(le.PaymentLoyalty,{subtotalPrice:l,paidByLoyalty:c}),s.jsx(le.Separator,{})]}):null},vdt=(e,t)=>e?.find(n=>n.groupName===t),kT=(e,t,n)=>{const o=vdt(e,t)?.items||[],r=n.filter(a=>o.includes(a.productId));return tE(r)},tl=({className:e,groupName:t})=>{const{formatMessage:n}=L();return s.jsx(O,{"data-test":`seller-name-${Pi(t)}`,className:e,bold:!0,children:n("order.seller.group.label",{sellerName:t})})},KX=({basketSummary:e})=>{const t=f(NT),n=f(LT),o=f(PT);if(!e)return null;const{itemGroups:r=[],totalsGroups:a=[],items:i}=e;return s.jsx("div",{"data-test":"summary-items-by-seller-list",children:a.map(({groupName:l,totals:c})=>{const d=kT(r,l,i),u=!!Number(c?.savingsPrice?.amount);return d?s.jsxs(h.Fragment,{children:[s.jsx(tl,{groupName:l,className:"salt-d--block salt-m-y--2"}),s.jsxs(fe,{"data-test":`summary-items-${Pi(l)}`,children:[s.jsx(le.Items,{itemsRetailPrice:c.itemsRetailPrice,quantity:d,withTaxNote:o}),s.jsx(le.Savings,{savings:c.savingsPrice}),n&&t&&u&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:c.paymentMethodSavingsPrice}),a.length>1&&s.jsx(of,{value:c.display?.itemPriceAfterPromos,withSeparator:!1,className:"salt-m-t--1 salt-m-b--1"})]}),s.jsx(le.Separator,{})]},l):null})})},Lp=({basketSummary:e,dataTest:t="minimum-order",className:n=""})=>{const{formatMessage:o}=L(),r=He(),{minimumCheckoutThreshold:a,basketAboveThreshold:i}=e.checkout,l=f(D("mins")),c=f(D("bt.spl"));if(i||!l||!c)return null;const d=r(a);return s.jsx(O,{className:`salt-d--inline-block salt-m-t--2 ${n}`,"data-test":t,children:o("basket.page.checkout.group.minimum.order.text",{amount:d})})},xu=({getQuantity:e,loyalty:t,allowZero:n=!1})=>{const o=km({getQuantity:e,loyalty:t,allowZero:n,unitsName:null});return s.jsxs(ae.Fragment,{children:[s.jsx(pe,{name:"loyalty",height:16,width:16,lineHeight:"normal",verticalAlign:"middle","data-test":"loyalty-earnings-card-content-icon",className:"salt-m-r--2"}),s.jsx(b,{id:"checkout.complete.loyalty.earned",values:{loyaltyEarned:o}})]})},Rg=({loyalty:e,className:t=""})=>{const n=f(D("loyalty")),o=f(D("loyear"));return n&&o&&e&&e.units>0?s.jsx("div",{className:`salt-m-t--2 ${t}`,"data-test":"loyalty-earnings-summary",children:s.jsx(xu,{loyalty:e})}):null},zX=e=>{const{basketSummary:t,withTaxNote:n=!1,summarySubtotalEnabled:o=!1}=e,r=f(D("oed")),a=f(Ro(["loyalty","loyred"])),i=f(D("loy.waon")),l=f(D("prp")),c=f(D("sib")),d=tE(t.items),u=o?t?.totals?.display?.itemPriceAfterPromos:t?.totals?.display?.finalPrice,p=t?.totals?.paymentSplit?.paidByLoyalty,g=!!Number(t?.totals?.savingsPrice?.amount);return s.jsxs(h.Fragment,{children:[s.jsxs(fe,{children:[s.jsx(le.Items,{itemsRetailPrice:t?.totals?.itemsRetailPrice,quantity:d,withTaxNote:n}),s.jsx(le.Savings,{savings:t?.totals?.savingsPrice}),c&&l&&g&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),!o&&s.jsxs(h.Fragment,{children:[s.jsx(le.SavingsWithPaymentMethod,{savings:t?.totals?.paymentMethodSavingsPrice}),s.jsx(le.Promotions,{orderLevelPromotions:t.orderLevelPromotions}),s.jsx(le.Vouchers,{appliedVouchers:t.vouchers,vouchersSavingsPrice:t?.totals?.vouchersSavingsPrice}),s.jsx(le.Delivery,{delivery:t.delivery,withTaxNote:n}),s.jsx(le.DeliveryPromotions,{deliveryPromotions:t.deliveryPromotions,hideDeliveryPassInfo:!0}),s.jsx(le.BagCharge,{carrierBag:t.carrierBag,withTaxNote:n}),s.jsx(le.PreparationCost,{preparationCost:t.preparation,withTaxNote:n}),s.jsx(le.Loyalty,{isLoyaltyRedeemEnabled:a,getLoyaltySpent:bl}),s.jsx(le.Deposit,{depositsPrice:t?.totals?.depositsPrice,withTaxNote:n}),s.jsx(le.EnvironmentalHandlingCharge,{environmentalHandlingPrice:t?.totals?.environmentalHandlingPrice,withTaxNote:n}),s.jsx(le.Invoice,{invoice:t.invoice,withTaxNote:n}),s.jsx(le.SmallOrderCharge,{smallOrderPrice:t.smallOrder,orderId:t.orderId,thresholds:t.smallOrderChargeThresholds,withTaxNote:n,page:"basket",withIcon:!0})]})]}),t?.totals?.taxesTotals&&s.jsx(le.Taxes,{"data-test":"summary-taxes",finalPrice:t?.totals?.finalPrice,components:t?.totals?.taxesTotals?.taxes?.components,withTaxNote:n}),i&&!r&&s.jsx(le.PaymentLoyalty,{subtotalPrice:u,paidByLoyalty:p})]})},QX={fopTilesInRow:{xs:4,sm:6,md:8,lg:8}},Ab=h.createContext(QX),XX={defaultValue:QX,Context:Ab,Provider:Ab.Provider,Consumer:Ab.Consumer},{TileQuantityBadge:Tdt,TileMedia:_dt,ImageTopBar:bdt,Tile:xdt,Fop:Adt}=XK,Rdt=v(Adt)`
    padding: 0;
    min-inline-size: 140px;
`,Ddt=({missedPromotion:e})=>{const{formatMessage:t}=L(),{product:n,group:{featuredProductCampaigns:o}}=ss(),{productId:r,offer:a,alcohol:i,image:l,name:c,restrictedVisibility:d}=n,u=f(E=>bC(E,r)),p=Vn(n,o),g=()=>{if(!a||!a.description)return null;const E=a.type&&XE(a.type);return s.jsx(nt.OfferText,{"data-test":"fop-offer-icon",children:s.jsx(pe,{className:"salt-m--1",name:E})})};return s.jsxs(h.Fragment,{children:[a?.requiredProductQuantity&&s.jsx(bg,{productQuantity:u?.quantity?.quantityInBasket??0,message:e?.missedPromotionTextAlternative}),s.jsx(xdt,{children:s.jsxs(Ji,{isActive:i,children:[u.quantity.quantityInBasket>1&&s.jsx(Tdt,{intent:"action",count:u?.quantity.quantityInBasket??0}),s.jsxs(_dt,{children:[s.jsxs(bdt,{children:[g(),!!p&&!1]}),pp(s.jsx(nt.Image,{title:l.description||c,alt:l.description||c,src:l.src}),d)]}),c&&s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:c})})]})})]})},Odt=e=>{const{page:t,position:n,fopPositionOnPage:o,group:r,noOfferLink:a,type:i,subPage:l,productId:c,missedPromotion:d}=e,u=XN({page:t,productId:c}),{fop:p}=VE();return u?s.jsxs(lT,{product:u,position:n,page:t,noOfferLink:a,type:i,group:r,subPage:l,fopPositionOnPage:o,displayLandscapeLayout:!1,withoutHeader:!0,overrideConfig:{portrait:{divider:!1,bottomAttributes:{ratingBadgeOrBoughtDate:!1,maxLifestyleIcons:0},topAttributes:{favorite:!1,featured:!1,list:!1,regulars:!1},image:p?.landscape.image,footerContainer:{...p?.portrait.footerContainer,inBasketBackground:!1},...!u.offer&&{promotion:null},...!u.price?.reference&&{referencePrice:null}}},children:[s.jsx(Ddt,{missedPromotion:d}),s.jsx(Rdt,{"data-test":`styled-fop-wrapper:${c}`,children:s.jsx(gA,{})})]}):null},{TileSkeleton:Pdt,Fop:Ndt,Wrapper:TG}=XK,ZX=h.forwardRef((e,t)=>{const n=h.useRef(),{loading:o,productId:r,missedPromotion:a,page:i,position:l,fopPositionOnPage:c,group:d,noOfferLink:u,type:p,subPage:g}=e;h.useImperativeHandle(t,()=>n.current,[]);const E=()=>{const T=n.current,_=T&&T.parentElement;if(_&&T&&T.getRootNode&&!_.hasAttribute("style")){const R=T.getRootNode().querySelector(`${tv}`)?.getAttribute("height");_.setAttribute("style",`--bar-bottom-height: ${R||0}px`)}},y=T=>{const _=n.current,A=_&&_.querySelector(`${Ndt}`);A&&(T.type==="focus"&&requestAnimationFrame(()=>{const R=_.offsetHeight,P=A.offsetHeight;E(),_.style.bottom=`calc(
                    var(--bar-bottom-height, 0px) + ${P-R}px
                )`,requestAnimationFrame(()=>A.scrollIntoView({behavior:"smooth",block:"center"}))}),T.type==="blur"&&_.removeAttribute("style"),I(T))},I=T=>{const _=n.current;if(_)try{_.querySelector(":focus-within")}catch{T.type==="focus"&&_.classList.add("focusWithin"),T.type==="blur"&&requestAnimationFrame(()=>{_.querySelectorAll(":focus").length===0&&_.classList.remove("focusWithin")})}};if(o)return s.jsx(TG,{ref:n,"data-test":"tile-skeleton",children:s.jsx(Pdt,{})});const{fopTilesInRow:S}=XX.defaultValue,C={page:i,position:l,fopPositionOnPage:c,group:d,noOfferLink:u,type:p,subPage:g,productId:r,missedPromotion:a};return s.jsx(TG,{"data-test":`tile-fop-wrapper:${r}`,"data-retailer-anchor":"tile-fop",ref:n,onFocus:y,onBlur:y,fopTilesInRow:S,role:"group",children:!o&&s.jsx(Odt,{...C})})});class Ldt{constructor(t,n=null){this.onVisibilityChange=t,this.scrollableContainerElementRef=n,this.registerRef=this.registerRef.bind(this),this.callback=this.callback.bind(this),this.idleCallbackId=null,this.visibleRefs=new Set,this.observer=null,this.pendingRefs=[]}registerRef(t,n){this.observer?this.observeRef(t,n):this.pendingRefs.push({id:t,ref:n})}observeRef(t,n){return n.dataset.visibilityId=t,this.observer.observe(n),()=>{this.observer.unobserve(n)}}callback(t){t.forEach(o=>{const r=o.target;o.isIntersecting&&o.intersectionRatio>=.15?this.visibleRefs.add(r):!o.isIntersecting&&o.intersectionRatio===0&&this.visibleRefs.delete(r)});const n=[];this.visibleRefs.forEach(o=>{n.push({id:o.dataset.visibilityId})}),this.idleCallbackId&&(window.cancelIdleCallback(this.idleCallbackId),this.idleCallbackId=null),window.requestIdleCallback?this.idleCallbackId=window.requestIdleCallback(()=>{this.onVisibilityChange(n),this.idleCallbackId=null},{timeout:200}):this.onVisibilityChange(n)}start(){this.observer=new window.IntersectionObserver(this.callback,{root:this.scrollableContainerElementRef?this.scrollableContainerElementRef.current:null,rootMargin:"100%",threshold:[0,.15]}),this.pendingRefs.forEach(({id:t,ref:n})=>this.observeRef(t,n))}stop(){this.observer.disconnect()}check(){}}const kdt=({onFopVisibilityChange:e=()=>{},onInitialFopLoad:t=()=>{},scrollableContainerElementRef:n,children:o})=>{const[r,a]=h.useState(null),i=h.useRef(new Ldt(l=>{a(l);try{e(l)}catch{}},n));return h.useEffect(()=>{const l=i.current;return l.start(),()=>{l.stop()}},[]),h.useEffect(()=>{i.current.check(),r===null&&t()},[r,t]),o({registerRef:i.current.registerRef,visibleFops:r})},jdt={attributes:m.arrayOf(m.shape()),image:m.shape({description:m.string,src:m.string}),images:m.arrayOf(m.shape({description:m.string,src:m.string})),timeRestriction:m.shape({deliverableFrom:m.string,deliverableTo:m.string}),offer:m.shape({id:m.string,description:m.string,version:m.string}),productId:m.string,retailerProductId:m.string,name:m.string,brand:m.string,available:m.bool,isInCurrentCatalog:m.bool,quantityInBasket:m.number,maxQuantityReached:m.bool,expectedLife:m.number,minimumLife:m.number,ageRestriction:m.number,restrictedVisibility:m.string,timeRestricted:m.bool,promotions:m.array,favorite:m.shape({lastBought:m.string}),size:m.shape({value:m.oneOfType([m.string,m.number]),catchWeight:m.bool}),price:m.shape({unit:m.shape({current:ze,label:m.string}),original:ze,current:ze,gross:ze}),hideOnViewports:m.arrayOf(m.string),cmsProductAttributes:m.arrayOf(m.string),additionalProductCharge:m.shape({amount:m.string,currency:m.string}),hfssDisplayRestrictionGroup:m.string,quantityRestrictionGroup:m.shape({quantityRestrictionGroupId:m.string,contribution:m.number})},sl=m.shape(jdt),JX=()=>typeof window<"u"&&parseInt(window.getComputedStyle(document.body).fontSize)||14,_G=e=>{const t=JX();return`${(typeof e=="number"?e:parseFloat(e.replace("rem","")))*t}`},jT=e=>{const t=JX(),n=typeof e=="number"?e:parseInt(e.replace("px",""));return 1/t*n+"rem"},Mdt=parseFloat(jT(52)),wdt=parseFloat(jT(KI)),SA=e=>{if(typeof document>"u")return;const t=document.documentElement.querySelector("header"),n=t?t.offsetHeight:0,o=e?0:parseFloat(_G(Mdt)),r=parseFloat(_G(wdt)),a=window.scrollY;let i;const l=o+r;a<l?i=n+(l-a):i=n,i=Math.max(i,n),document.documentElement.style.setProperty("--salt-popover-y-offset",jT(i))},eZ=e=>{typeof document>"u"||document.documentElement.style.setProperty("--salt-popover-z-index",e?"var(--z-index-nav-menu)":"var(--z-index-dropdown))")},tZ=e=>{e.style.overflow="hidden"},sZ=e=>{e.style.overflow="auto"},nZ=({data:e})=>e.content.contentBlocks,YL=Y(nZ,({blocks:e})=>e),qL=Y(nZ,({blocks:e,...t})=>t),KL=e=>Y(YL,t=>t.find(n=>n.type===e)||{}),cf=e=>Y(YL,t=>{const{id:n,name:o,content:r}=t.find(a=>a.type===e)||{};return!n||!o||!r}),Fdt=e=>Y(YL,t=>{const{content:n}=t.find(o=>o.type===e)||{};return!(n?.images.length&&n?.images.find(o=>o.imageAlignment==="CENTER"))}),oZ=e=>{document.documentElement?.style.setProperty("--_popover-scroll-offset",jT(e?0:window.scrollY))},bG=e=>e instanceof HTMLElement,Bdt=({onOpen:e,onClose:t,...n})=>{const o=f(c=>c.control.modal),r=f(cf("HEADER")),a=Object.values(o).some(c=>c.isOpen),i=()=>{const c=document.querySelector("#modal-body");a&&bG(c)&&tZ(c),a||SA(r),eZ(a),oZ(a),e?.()},l=()=>{const c=document.querySelector("#modal-body");bG(c)&&sZ(c),t?.()};return s.jsx(Qu.DropdownSelect,{portalContainerSelector:"#modal",onOpen:i,onClose:l,...n})},Udt=e=>{const{formatMessage:t}=L(),{a11y:n,...o}=e,a={labels:{...{labels:{"progressive-disclosure-unselected":t("salt.radio-group.progressive-disclosure.unselected.a11y.label"),"progressive-disclosure-selected":t("salt.radio-group.progressive-disclosure.selected.a11y.label")}}.labels,...n?.labels}};return s.jsx(Qu.RadioGroup,{...o,a11y:a})},fs={...Qu,Checkbox:Qu.Checkbox,CheckboxList:Qu.CheckboxList,DropdownSelect:Bdt,RadioGroup:Udt,TextField:Qu.TextField},MT=()=>{const e=F();return{sendAddToWishListEvent:a=>{const i=U.analyticsEvent({type:Ci.GA_ADD_TO_WISHLIST,...a});e(i);const l={event:"add_to_wishlist",type:a.eventType,ecommerce:a.ecommerce};te.sendEvent({GA:l,WA:null})},sendRemoveFromWishListEvent:a=>{const i=U.analyticsEvent({type:Ci.GA_REMOVE_FROM_WISHLIST,...a});e(i);const l={event:"remove_from_wishlist",type:a.eventType,id:a.id,index:a.index,list:a.list,name:a.name,quantity:a.quantity};te.sendEvent({GA:l,WA:null})},sendCreateListEvent:()=>{const a=U.analyticsEvent({type:Ci.GA_CREATE_LIST,event:"create_list"});e(a);const i={event:"create_list"};te.sendEvent({GA:i,WA:null})},sendDeleteListEvent:()=>{const a=U.analyticsEvent({type:Ci.GA_DELETE_LIST,event:"delete_list"});e(a);const i={event:"delete_list"};te.sendEvent({GA:i,WA:null})}}},rZ=({className:e,defaultValue:t})=>{const n=L(),[o,r]=h.useState(""),a=es("productlist-chars-allowed-v2")||".*",i=({target:c})=>{if(c.value==="")return;const d=aT(n.formatMessage("shopping.list.create.invalid.name"))(c.value);d?c.setCustomValidity(d):c.setCustomValidity("")},l=c=>{c.preventDefault();const d=c.target;if(d instanceof HTMLInputElement)if(d.validity.valueMissing){const u=n.formatMessage("validation.msg.required");r(u)}else if(d.validity.patternMismatch){const u=n.formatMessage("shopping.list.create.invalid.name");r(u)}else d.validity.customError&&r(d.validationMessage)};return s.jsx(fs.TextField,{required:!0,"data-pii":"true",maxLength:200,errorMessage:o,className:e,name:"shopping-list",onChange:i,pattern:a,onInvalid:l,"data-test":"list-name-input",defaultValue:t,onReset:()=>r(""),additionalText:n.formatMessage("shopping.list.char.validation.message"),placeholder:n.formatMessage("shopping.lists.form.create.list.name.placeholder"),clearButton:{ariaLabel:n.formatMessage("salt.form.text-field.clear-button.a11y.label")},label:{text:n.formatMessage("shopping.lists.form.create.list.name.placeholder"),isVisuallyConcealed:!1}})},Gdt=ia(`
    mutation ShoppingListCreate($shoppingListCreateInput: ShoppingListCreateInput!) {
        shoppingListCreate(shoppingListCreateInput: $shoppingListCreateInput) {
            shoppingList {
                __typename
                shoppingListId
            }
            success
            failureReason
        }
    }
`),zL=({condensed:e,onSubmit:t})=>{const{formatMessage:n}=L(),o=h.useRef(null),[{fetching:r},a]=Ep(Gdt),i=ft(),l=MT(),c=async d=>{d.preventDefault();const p=new FormData(d.currentTarget).get("shopping-list"),{data:g,error:E}=await a({shoppingListCreateInput:{name:String(p),productIds:[]}});if(g?.shoppingListCreate?.success&&g?.shoppingListCreate?.shoppingList){const{shoppingListId:y}=g.shoppingListCreate.shoppingList;i({type:ls.LIST_CREATED,listId:y}),l.sendCreateListEvent()}if(!g?.shoppingListCreate?.success&&g?.shoppingListCreate?.failureReason){const{failureReason:y}=g.shoppingListCreate;let I="request.error.title";if(y===gU.ListNameInvalid){const S=o.current?.elements.namedItem("shopping-list");if(S instanceof HTMLInputElement){S.setCustomValidity(n("shopping.list.create.invalid.name")),S.reportValidity();return}}y===gU.MaxListsReached&&(I="shopping.list.max.lists.reached"),Z.error(I)}E&&!g?.shoppingListCreate&&Z.error("request.error.title"),t?.(),o.current?.reset()};return s.jsxs(fs,{ref:o,id:"list-form",onSubmit:c,children:[s.jsx(rZ,{className:"salt-m-b--2"}),s.jsx(x,{className:e?"":"salt-m-t--8",fill:!0,type:"submit",intent:"primary",loading:r,"data-test":"create-shopping-list-button",children:s.jsx(x.Text,{children:n("shopping.lists.form.create.submit.button")})})]})},$dt=()=>{const[e,t]=h.useState(!1),n=()=>{t(o=>!o)};return e?s.jsxs("div",{className:"salt-m-y--4",children:[s.jsx(O,{className:"salt-d--block salt-m-b--2",bold:!0,children:s.jsx(b,{id:"shopping.lists.action.modal.create.title"})}),s.jsx(zL,{condensed:!0,onSubmit:n})]}):s.jsxs(iX,{className:"salt-m-b--2",onClick:n,"data-test":"shopping-list-modal-create-list",children:[s.jsx(O,{size:"l",children:s.jsx(b,{id:"shopping.lists.modal.create.list.toggle.button"})}),s.jsx(aX,{children:s.jsx(pe,{height:20,width:20,name:"plus"})})]})},Hdt=({messageType:e,productName:t})=>{const{formatMessage:n}=L(),o=hit[e];return s.jsx(ie,{"data-test":"shopping.lists.modal.sr.alert",children:n(o,{productName:t})})},aZ=se("ADD_FAVORITE"),iZ=se("REMOVE_FAVORITE"),Vdt=e=>t=>t({type:"API",payload:{service:"customerfavorites",pathPrefix:{client:"/api/customer-favorites",server:"/core-api"},url:`/v1/customers/favorites/${e}`,options:{method:"PUT"},...aZ}}),Wdt=e=>t=>t({type:"API",payload:{service:"customerfavorites",pathPrefix:{client:"/api/customer-favorites",server:"/core-api"},url:`/v1/customers/favorites/${e}`,options:{method:"DELETE"},...iZ}}),_S={addFavorite:Vdt,removeFavorite:Wdt,types:{ADD_FAVORITE:aZ,REMOVE_FAVORITE:iZ}},Ydt=({productId:e,retailerProductId:t})=>async n=>{try{await n(_S.addFavorite(e)),n(xt.updateProducts({product:[{productId:e,favorite:{}}]}));const o={event:"event",eventAction:"ManualAddToFavorites",eventCategory:"FAVORITES",eventLabel:t};te.sendEvent({GA:o,WA:null})}catch{Z.error("favorite.add.item.error")}},qdt=({productId:e,retailerProductId:t})=>async n=>{try{await n(_S.removeFavorite(e)),n(xt.updateProducts({product:[{productId:e,favorite:void 0}]}));const o={event:"event",eventAction:"ManualRemoveFromFavorites",eventCategory:"FAVORITES",eventLabel:t};te.sendEvent({GA:o,WA:null})}catch{Z.error("favorite.remove.item.error")}},xG={addToFavorites:Ydt,removeFromFavorites:qdt},Kdt=v(O)`
    color: var(--intent-primary);
`,QL=({onClick:e,itemName:t,highlight:n,newlyAdded:o,type:r,productName:a})=>{const{formatMessage:i}=L(),l=()=>{switch(r){case"list":return n?i("shopping.lists.modal.product.list.remove",{productName:a}):i("shopping.lists.modal.product.list.add",{productName:a});case"reg":return n?i("shopping.lists.modal.product.reg.remove",{productName:a}):i("shopping.lists.modal.product.reg.add",{productName:a});default:return n?i("shopping.lists.modal.product.fav.remove",{productName:a}):i("shopping.lists.modal.product.fav.add",{productName:a})}},c=()=>{switch(r){case"list":return n?"list":"list_outline";case"reg":return n?"regulars":"regulars_outline";default:return n?"favourites":"favourites_add"}};return s.jsxs(iX,{onClick:e,"data-test":"fop-modal-add-remove-item-to-list",children:[s.jsx(O,{size:"l","data-pii":"true","data-test":"list-modal-list-item-title",children:t}),s.jsxs(Q,{as:"span",wrap:"nowrap",children:[n&&o&&s.jsx(Kdt,{className:"salt-p-t--1 salt-p-l--1","data-test":"list-modal-newly-added",children:i("shopping.lists.modal.added")}),s.jsx(aX,{children:s.jsx(pe,{primary:n,name:c(),"aria-label":l()})})]})]})},zdt=({isFavorite:e,productName:t,productId:n,retailerProductId:o,page:r,section:a,productIndex:i,onAddSuccess:l,onRemoveSuccess:c,seller:d})=>{const{formatMessage:u}=L(),p=F(),[g,E]=h.useState(!1),{sendAddToWishListEvent:y,sendRemoveFromWishListEvent:I}=MT(),S=async()=>{await p(xG.addToFavorites({productId:n,retailerProductId:o})),E(!0),l?.(),y({eventType:"favorites",ecommerce:{items:[{item_id:o,item_name:t,index:i,quantity:1,item_list_name:ks(r,null,a)??"",seller_id:d?.id||null}]}})},C=async()=>{await p(xG.removeFromFavorites({productId:n,retailerProductId:o})),E(!1),c?.(),I({eventType:"favorites",id:o,name:t,index:i,quantity:1,list:ks(r,null,a)??""})},T=async()=>{e?C():S()};return s.jsx(Be.Item,{children:s.jsx(QL,{itemName:u("shopping.lists.modal.fav.name"),type:"fav",onClick:T,newlyAdded:g,highlight:e,productName:t})})},Qdt=({productName:e,productId:t,regular:n,retailerProductId:o,page:r,productIndex:a,section:i,beforeOpeningAddToRegularsModal:l})=>{const{formatMessage:c}=L(),[d]=Ee([_u]),u=Oot(),p=()=>{u({productId:t,retailerProductId:o,productName:e,regular:n,page:r,section:i,productIndex:a,beforeOpeningAddToRegularsModal:l})};return d?s.jsx(Be.Item,{children:s.jsx(QL,{itemName:c("shopping.lists.modal.reg.name"),type:"reg",onClick:p,newlyAdded:!1,highlight:!!n,productName:e})}):null},Xdt=ia(`
    mutation ShoppingListAddProduct($shoppingListAddProductInput: ShoppingListAddProductInput!) {
        shoppingListAddProduct(shoppingListAddProductInput: $shoppingListAddProductInput) {
            shoppingList {
                __typename
            }
            success
            failureReason
        }
    }
`),Zdt=ia(`
    mutation ShoppingListRemoveProduct(
        $shoppingListRemoveProductInput: ShoppingListRemoveProductInput!
    ) {
        shoppingListRemoveProduct(shoppingListRemoveProductInput: $shoppingListRemoveProductInput) {
            shoppingList {
                __typename
            }
            success
        }
    }
`),Jdt=({modalProductId:e,productName:t,shoppingList:n,retailerProductId:o,seller:r,page:a,productIndex:i,section:l,onAddSuccess:c,onRemoveSuccess:d})=>{const u=F(),[{fetching:p},g]=Ep(Xdt),[{fetching:E},y]=Ep(Zdt),I=!!n.products.find(G=>G.productId===e),S=es("productlist-max-list-item-count"),[C,T]=h.useState({newlyAdded:!1,highlight:I}),_=ft(),{sendAddToWishListEvent:A,sendRemoveFromWishListEvent:R}=MT(),{shoppingListId:P,name:N}=n,k=async()=>{await u(ai({products:[{id:e}],ignoreProductCache:!0,updateProducts:!0}))},M=async()=>{T({newlyAdded:!0,highlight:!0});const{data:G,error:W}=await g({shoppingListAddProductInput:{shoppingListId:P,productId:e}});if(G?.shoppingListAddProduct?.success&&(c?.(),await k(),_({type:ls.PRODUCT_ADDED_TO_LIST,listId:P,productId:e,retailerProductId:o}),A({eventType:"shopping_list",ecommerce:{items:[{item_id:o,item_name:t,index:i,quantity:1,item_list_name:ks(a,null,l)??"",seller_id:r?.id||null}]}})),!G?.shoppingListAddProduct?.success&&G?.shoppingListAddProduct?.failureReason){T({newlyAdded:!1,highlight:!1});const{failureReason:H}=G.shoppingListAddProduct,K=H===Iet.MaxProductsReached?{key:"shopping.list.max.products.in.list",substitutions:{maxProducts:S}}:"request.error.title";Z.error(K)}W&&!G?.shoppingListAddProduct&&(T({newlyAdded:!1,highlight:!1}),Z.error("request.error.title"))},w=async()=>{T({newlyAdded:!1,highlight:!1});const{data:G}=await y({shoppingListRemoveProductInput:{shoppingListId:P,productId:e}});G?.shoppingListRemoveProduct?.success?(d?.(),await k(),_({type:ls.PRODUCT_REMOVED_FROM_LIST,listId:P,productId:e,retailerProductId:o}),R({eventType:"shopping_list",id:o,name:t,index:i,quantity:1,list:ks(a,null,l)??""})):(T({newlyAdded:!1,highlight:!0}),Z.error("request.error.title"))},j=async()=>{p||E||(I?await w():await M())};return s.jsx(Be.Item,{children:s.jsx(QL,{type:"list",itemName:N,newlyAdded:C.newlyAdded,highlight:C.highlight,productName:t,onClick:j})})},eut=ia(`
    query GetShoppingListsForListsModal {
        shoppingLists {
            shoppingListId
            name
            products {
                productId
            }
        }
    }
`),tut={additionalTypenames:["ShoppingList"]},sut=({modalProductId:e,productName:t,retailerProductId:n,seller:o,page:r,section:a,productIndex:i,onAddSuccess:l,onRemoveSuccess:c})=>{const[{data:d,fetching:u,error:p}]=Kd({query:eut,context:tut});return u?s.jsxs(h.Fragment,{children:[s.jsx(_e,{className:"salt-m-b--2",height:"50px"}),s.jsx(_e,{className:"salt-m-b--2",height:"50px"}),s.jsx(_e,{className:"salt-m-b--2",height:"50px"})]}):!d?.shoppingLists.length||p?null:s.jsx(h.Fragment,{children:d.shoppingLists.map(g=>s.jsx(Jdt,{shoppingList:g,productName:t,modalProductId:e,retailerProductId:n,seller:o,page:r,productIndex:i,section:a,onAddSuccess:l,onRemoveSuccess:c},g.shoppingListId))})},nut=({product:e,page:t,section:n,productIndex:o,handleShowBackArrow:r})=>{const[a,i]=h.useState(null),{productId:l,name:c,retailerProductId:d,regular:u,favorite:p,image:g,seller:E,restrictedVisibility:y}=e;return s.jsxs(h.Fragment,{children:[s.jsx("div",{"data-test":"screen-reader-alert","aria-live":"polite",children:a&&s.jsx(Hdt,{messageType:a,productName:c})}),s.jsx(lX,{productName:c,imageUrl:g.src,restrictedVisibility:y}),s.jsx($dt,{}),s.jsxs(Be,{inline:!1,children:[s.jsx(zdt,{isFavorite:!!p,productId:l,productName:c,retailerProductId:d,page:t,productIndex:o,section:n,seller:E,onAddSuccess:()=>i("FAVORITE_ADDED"),onRemoveSuccess:()=>i("FAVORITE_REMOVED")}),s.jsx(Qdt,{regular:u,productId:l,productName:c,retailerProductId:d,page:t,productIndex:o,section:n,beforeOpeningAddToRegularsModal:r}),s.jsx(sut,{modalProductId:l,productName:c,retailerProductId:d,page:t,productIndex:o,section:n,seller:E,onAddSuccess:()=>i("LIST_ADDED"),onRemoveSuccess:()=>i("LIST_REMOVED")})]})]})},AG="shopping-lists-modal-header",out=({isOpen:e,productId:t,page:n,section:o,productIndex:r,handleShowBackArrow:a})=>{const i=F(),l=f(y=>Da(y,t)),c=f(y=>t8e(y,l?.productId||"")),[d]=Ee(["m.la.h"]),u=ft(),p=!!l,g=()=>{i(J.closeModal())};h.useEffect(()=>{e&&p&&u({type:ls.ADD_TO_FEATURE_MODAL_DISPLAYED,productId:l.productId,retailerProductId:l.retailerProductId})},[e,p]);const E=()=>p?s.jsx(nut,{product:{...l,...c&&{regular:c}},page:n,section:o,productIndex:r,handleShowBackArrow:a}):null;return s.jsxs(B,{isOpen:e,onRequestClose:g,aria:{labelledby:AG},children:[s.jsx(B.Header,{align:d?"left":"center",className:"salt-p-x--4",children:s.jsx(ee,{as:"h2",id:AG,children:s.jsx(b,{id:"shopping.lists.modal.heading"})})}),s.jsx(B.Body,{className:"salt-p-x--4 salt-p-t--0",children:E()})]})},RG="shoppingLists",wT=()=>{const e=F(),t=f($e(RG)),n=f(Yn(RG)),[o,r]=h.useState(!1),a=()=>r(!0),i=l=>{r(!1),e(Xv({productId:""})),e(J.openModal("shoppingLists",l))};return s.jsxs(h.Fragment,{children:[s.jsx(out,{isOpen:t,productId:n?.productId,page:n?.page,section:n?.section,productIndex:n?.productIndex,handleShowBackArrow:a}),s.jsx(IL,{onModalRequestClose:()=>r(!1),onBackArrowClick:o?i:void 0,onSuccess:o?i:void 0})]})},lZ=()=>Pe`
    font-family: var(--alt-product-price-font-family, var(--font-family));
    font-weight: var(--alt-product-price-font-weight, 600);
`,rut=v(nt.Price)`
    ${lZ}
`,aut=v(nt.StrikethroughPrice)`
    ${lZ}
`,cZ=v.div`
    padding: var(--salt-spacing-2);
    ${oL};
    position: relative;
    overflow: hidden;
    inline-size: 100%;

    .inner-container {
        display: flex;
        gap: var(--salt-spacing-1);
    }

    .image-container {
        ${rL}
    }

    .body-container {
        inline-size: 100%;
        display: grid;
        gap: var(--salt-spacing-1);
        grid-area: footer;
        grid-template-areas: 'header-container footer-container';
        grid-template-columns: 1fr ${pH(170)};
        position: relative;
    }

    .header-container {
        flex: 1;
        border-radius: var(--salt-radius-0);
        display: flex;
        flex-direction: column;
        gap: var(--salt-spacing-1);
        grid-area: header-container;
        justify-content: space-between;
    }

    .footer-container {
        border-radius: var(--salt-radius-0);
        display: flex;
        flex-direction: column;
        -webkit-box-pack: end;
        justify-content: end;
        gap: var(--salt-spacing-1);
        grid-area: footer-container;
        position: relative;
    }

    .price-container {
        overflow: hidden;
        align-self: start;

        > * {
            flex-direction: column-reverse;
            gap: 0;
        }
    }

    .title-container {
        ${aL};
    }

    .promotion-container {
        ${iL};
    }
`,iut=()=>{const{sendFopImpressionEvent:e,onFopContainerClick:t}=eL(),{config:n,product:{productId:o,alcohol:r},hasBeenViewed:a,displayLandscapeLayout:i}=ss(),l=n?.landscape.image?.link;if(h.useEffect(()=>{e()},[a]),!n)return null;const c=i?n?.landscape?.controlsContainer?.size:n?.portrait?.controlsContainer?.size;return s.jsx(cZ,{config:n,layoutType:Fs.Portrait,"data-test":"configurable-list-item-layout",onClick:t,displayLandscapeLayout:!1,children:s.jsx(Ji,{isActive:r,overlay:s.jsx(Tu,{buttonWidth:170}),children:s.jsxs("div",{className:"inner-container","data-test":`fop-wrapper:${o}`,"data-retailer-anchor":"fop-item",children:[s.jsx(JE,{isHyperlink:l,children:s.jsx("div",{className:"image-container",children:s.jsx(v7,{})})}),s.jsxs("div",{className:"body-container",children:[s.jsxs("div",{className:"header-container",children:[s.jsx("div",{className:"title-container",children:s.jsx(S7,{})}),s.jsx("div",{className:"promotion-container","data-retailer-anchor":"fop-promotions",children:s.jsx(tL,{fullWidth:!1})}),s.jsx(pA,{}),s.jsx(dL,{})]}),s.jsxs("div",{className:"footer-container",children:[s.jsx("div",{className:"price-container",children:s.jsx(cL,{showCatchWeight:!1})}),s.jsx(w7,{size:c})]})]})]})})})},lut=()=>{const{config:e}=ss();return e?s.jsx(cZ,{config:e,layoutType:Fs.Portrait,"data-test":"configurable-list-item-skeleton",displayLandscapeLayout:!1,children:s.jsxs("div",{className:"inner-container",children:[s.jsx("div",{className:"image-container",children:s.jsx(tc,{})}),s.jsxs("div",{className:"body-container",children:[s.jsxs("div",{className:"header-container",children:[s.jsx("div",{className:"title-container",children:s.jsx(tc,{variant:"textS",fill:50})}),s.jsx("div",{className:"promotion-container",children:s.jsx(tc,{variant:"textS",fill:25})}),s.jsx(tc,{variant:"textS",fill:25}),s.jsx(tc,{variant:"textS",fill:25})]}),s.jsxs("div",{className:"footer-container",children:[s.jsx("div",{className:"price-container",children:s.jsx(uc,{height:"15px",width:"100px"})}),s.jsx(z9,{fill:!0})]})]})]})}):null},cut={portrait:{title:{numberOfLines:1}},landscape:{image:{resolution:{height:94,width:94}}}},dZ=e=>{const{productId:t,loading:n,page:o,product:r}=e,a=XN({page:o,productId:t,product:r});return f(Rt)&&!a||!n&&!a?null:s.jsx(lT,{product:a,...e,overrideConfig:cut,children:n?s.jsx(lut,{}):s.jsx(iut,{})})},DG={position:"ownLine",style:"default"},uZ={landscape:{promotion:null,referencePrice:null,footerContainer:{inBasketBackground:!1},controlsContainer:DG},portrait:{promotion:null,referencePrice:null,footerContainer:{inBasketBackground:!1},controlsContainer:DG}},bS={SINGLE_LINE:"SINGLE_LINE",MULTI_LINE:"MULTI_LINE"},ic={IMAGE:"IMAGE",TEXT:"TEXT",RATING:"RATING"},pZ=m.arrayOf(m.shape({type:m.oneOf(Object.values(bS)),attributes:m.arrayOf(m.oneOfType([m.shape({type:m.oneOf([ic.TEXT]),text:m.string.isRequired,accessibility:m.string.isRequired,chipType:m.oneOf(["primary","utility","offer","action"]).isRequired}),m.shape({type:m.oneOf([ic.IMAGE]),icon:m.string.isRequired,label:m.string.isRequired}),m.shape({type:m.oneOf([ic.RATING])})]))})),dut={attributeGroups:pZ,productId:m.string},uut={attributeGroups:[],productId:""},CA=e=>e==="primary"||e==="promotion"?"secondary":e==="secondary"?"tertiary-contrast":"action",XL=({attributeGroups:e,productId:t})=>{if(!e||e.length===0||!t)return null;const n=a=>{switch(a.type){case ic.IMAGE:return a.icon?s.jsx(nt.ProductAttribute,{title:a.label,name:a.icon},a.label):null;case ic.TEXT:return a.text?s.jsx(ln,{intent:CA(a.chipType),title:a.accessibility,text:a.text,singleLine:!0},`${a.text}-${t}`):null;default:return null}},o=a=>{switch(a.type){case ic.TEXT:return a.text?s.jsx(ln,{intent:CA(a.chipType),title:a.accessibility,text:a.text},`${a.text}-${t}`):null;case ic.RATING:return s.jsx(nL,{productId:t},`${a.text}-${t}`);default:return null}},r=(a,i)=>{switch(a.type){case bS.MULTI_LINE:return s.jsx(nt.ProductAttributes,{multiLine:!0,children:a.attributes.map(o)},`attribute-group-${i}`);case bS.SINGLE_LINE:default:return s.jsx(nt.ProductAttributes,{children:a.attributes.map(n)},`attribute-group-${i}`)}};return e.map(r)};XL.propTypes=dut;XL.defaultProps=uut;const put=v(Te)`
    block-size: 100%;
`,ZL=m.shape({alert:m.bool,type:m.string,message:m.string}),mZ=({status:e})=>s.jsx(nt.Status,{children:s.jsx(put,{intent:e.type,size:"s","data-test":"fop-status","aria-live":"polite",text:e.message})}),hZ=({status:e})=>s.jsx(nt.Status,{children:s.jsxs(O,{size:"lg",className:"salt-d--block salt-m-t--1","data-test":"fop-status",children:[e.message,"123 321 123"]})}),gZ={status:ZL.isRequired};mZ.propTypes=gZ;hZ.propTypes=gZ;const JL=({status:e})=>e?e.alert?s.jsx(mZ,{status:e}):s.jsx(hZ,{status:e}):s.jsx(nt.Status,{});JL.propTypes={status:ZL};JL.defaultProps={status:void 0};const EZ=m.shape({requiredProductQuantity:m.number.isRequired,addedProductQuantity:m.number.isRequired,toAddProductQuantity:m.number.isRequired,missedPromotionTextAlternative:m.string.isRequired,onMissedPromotionTextChange:m.func}),{getPercentageFromFractionString:mut}=ra,vI=30,hut=44,gut=v.div`
    display: flex;
    block-size: ${$(hut)};
`,Eut=v.div`
    color: var(--intent-content);
    align-self: center;
    block-size: ${$(vI)};
`,fZ=({fopMissedPromotion:e,children:t})=>{const{requiredProductQuantity:n,addedProductQuantity:o,toAddProductQuantity:r,onMissedPromotionTextChange:a}=e;h.useEffect(()=>a(),[o]);const i=r===0,l=i?"":`${o}/${n}`;return s.jsxs(gut,{"data-test":"missed-promotion",children:[s.jsx(Eut,{children:i?s.jsx(pe,{name:"status_yes",height:vI,width:vI,success:!0}):s.jsx(kl,{colorName:"action",progressValue:mut(l),autoProgress:!1,size:vI,children:s.jsx(O,{size:"s",bold:!0,children:l})})}),s.jsx("div",{className:"salt-m-l--1",children:t})]})};fZ.propTypes={fopMissedPromotion:EZ.isRequired,children:m.node.isRequired};const fut={actions:m.shape({breadcrumbsDropdownOnOpen:m.func,breadcrumbsClickAction:m.func}),breadcrumbsVisible:m.bool.isRequired,breadcrumbsItems:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired,link:m.string.isRequired})),breadcrumbsChild:m.shape({id:m.string.isRequired,name:m.string.isRequired,link:m.string.isRequired}),breadcrumbsText:m.shape({message:m.string.isRequired,link:m.string}),breadcrumbsMenuAccessibilityLabel:m.string,firstInGroup:m.bool,linkElement:m.oneOfType([m.string,m.func,m.elementType]),productId:m.string},yut={actions:{},breadcrumbsItems:[],breadcrumbsChild:null,breadcrumbsText:null,breadcrumbsMenuAccessibilityLabel:null,firstInGroup:!1,productId:void 0,linkElement:void 0};let FT=class extends h.Component{constructor(t){super(t),this.state={isBreadcrumbDropdownOpen:!1},this.breadcrumbsDropdownElement=ae.createRef(),this.closeBreadCrumbMenu=this.closeBreadCrumbMenu.bind(this),this.handleClickOutsideBreadCrumbMenu=this.handleClickOutsideBreadCrumbMenu.bind(this),this.toggleBreadCrumbMenu=this.toggleBreadCrumbMenu.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutsideBreadCrumbMenu)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutsideBreadCrumbMenu)}handleClickOutsideBreadCrumbMenu(t){const n=this.breadcrumbsDropdownElement;this.state.isBreadcrumbDropdownOpen&&n&&n.current&&!n.current.contains(t.target)&&this.closeBreadCrumbMenu()}handleKeyDown(t){t.key==="Escape"&&this.closeBreadCrumbMenu()}closeBreadCrumbMenu(){this.setState({isBreadcrumbDropdownOpen:!1})}toggleBreadCrumbMenu(){this.setState(t=>({isBreadcrumbDropdownOpen:!t.isBreadcrumbDropdownOpen}),()=>{this.state.isBreadcrumbDropdownOpen&&this.props.actions.breadcrumbsDropdownOnOpen&&this.props.actions.breadcrumbsDropdownOnOpen()})}render(){const{breadcrumbsVisible:t,breadcrumbsItems:n,breadcrumbsChild:o,breadcrumbsText:r,breadcrumbsMenuAccessibilityLabel:a,firstInGroup:i,linkElement:l,actions:c,productId:d}=this.props;if(!t)return null;if(!i)return s.jsx(nt.BreadcrumbHeader,{});const u=l?Ye:tt;if(r)return s.jsx(nt.BreadcrumbHeader,{children:s.jsx(nt.BreadcrumbText,{display:"inline-block",children:r.link?s.jsx(u,{standalone:!0,onClick:()=>{c.breadcrumbsClickAction(0)},to:l&&r.link,href:!l&&r.link,title:r.message,children:r.message}):r.message})});if(!o||!o.name||!n||n.length===0)return s.jsx(nt.BreadcrumbHeader,{});const p=`fop-breadcrumbs-${d}`,g=`fop-breadcrumbs-menu-${d}`;return s.jsxs(nt.BreadcrumbHeader,{onKeyDown:this.handleKeyDown,children:[s.jsxs(nt.BreadcrumbDropdown,{className:"salt-d--inline-block",ref:this.breadcrumbsDropdownElement,children:[s.jsxs(nt.BreadcrumbDropdownButton,{"aria-controls":g,"aria-expanded":this.state.isBreadcrumbDropdownOpen?!0:null,"aria-haspopup":"true",type:"button","data-toggle":"true",height:20,id:p,open:this.state.isBreadcrumbDropdownOpen,width:20,onClick:this.toggleBreadCrumbMenu,"data-test":"fop-breadcrumbs-button",children:[s.jsx(pe,{height:20,width:20,name:"more","aria-hidden":"true"}),s.jsx(ie,{children:a})]}),s.jsx(rt.Body,{isOpen:this.state.isBreadcrumbDropdownOpen,fullWidth:!0,textWrap:!0,children:s.jsx(rt.Content,{children:s.jsx(Be,{id:g,"aria-labelledby":p,children:n.map((E,y)=>s.jsx(Be.Item,{children:s.jsx(O,{children:s.jsx(u,{title:E.name,to:l&&E.link,href:!l&&E.link,onClick:()=>{this.closeBreadCrumbMenu(),c.breadcrumbsClickAction(y,E.id)},children:E.name})})},E.id))})})})]}),s.jsx(pe,{height:18,width:18,name:"arrow_right"}),s.jsx(nt.BreadcrumbText,{size:"md",display:"inline-block",breadcrumbChild:!0,children:s.jsx(u,{to:l&&o.link,href:!l&&o.link,onClick:()=>{const E=n.length-1;c.breadcrumbsClickAction(E,n[E].id)},title:o.name,children:o.name})})]})}};FT.propTypes=fut;FT.defaultProps=yut;const{PlaceholderImage:Iut}=CBe,Sut={src:m.string,alt:m.string.isRequired,title:m.string.isRequired},Cut={src:void 0},BT=e=>{const{src:t,alt:n,title:o,...r}=e;return s.jsx(el,{threshold:300,alt:n,src:t,title:o,placeholder:s.jsxs("div",{children:[s.jsx(ie,{children:n}),s.jsx(Iut,{className:"salt-d--inline-block",width:"100%",height:"100%"})]}),...r})};BT.propTypes=Sut;BT.defaultProps=Cut;BT.displayName="BaseImage";el.displayName="LazyLoadImage";const yZ={attributes:pZ,countryOfOrigin:m.shape({a11yPrefix:m.string.isRequired,country:m.string.isRequired,title:m.string.isRequired}),topAttributes:m.arrayOf(m.shape({type:m.string,value:m.oneOf([m.string,m.shape({text:m.string,accessibility:m.string})])})),name:m.string,bopLink:m.string,image:m.shape({src:m.string,description:m.string,alt:m.string,fopSrcset:m.string}),offer:m.shape({icon:m.string,message:m.string,url:m.string,presentationMode:m.string,requiredProductQuantity:m.number}),price:m.shape({original:m.string,current:m.string,type:m.string,gross:m.string}),size:m.shape({value:m.oneOfType([m.string,m.number]),pricePer:m.string,subtext:m.string}),status:ZL,quantityInOrder:m.shape({quantity:m.number,message:m.string}),loading:m.bool,controls:m.shape({type:m.string,counter:m.shape({updateBasketQuantity:m.func,plusDisabled:m.bool,minusDisabled:m.bool,value:m.number,addText:m.string,addTextAlternative:m.string,increaseQuantityTextAlternative:m.string,decreaseQuantityTextAlternative:m.string,editQuantityTextAlternative:m.string,quantityDescriptionTextAlternative:m.string,getQuantityDescriptionTextAlternative:m.func,action:m.func,max:m.oneOfType([m.number,m.string]),addInfo:m.bool,addIcon:m.string}),navigation:m.shape({action:m.func,text:m.string,url:m.string}),custom:m.element,action:m.shape({onClick:m.func,text:m.string,appearance:m.oneOf(["primary","secondary","action"])})}),active:m.bool,overlay:m.bool,productId:m.string,linkElement:m.oneOfType([m.string,m.func,m.elementType]),className:m.string,linkAction:m.func,inCurrentCatalog:m.bool,noOfferLink:m.bool,isInProductList:m.bool,isFavorite:m.bool,breadcrumbsVisible:m.bool,breadcrumbsItems:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired,link:m.string.isRequired})),breadcrumbsChild:m.shape({id:m.string.isRequired,name:m.string.isRequired,link:m.string.isRequired}),breadcrumbsText:m.shape({message:m.string.isRequired,link:m.string}),shoppingListsMessages:m.shape({moreOptionsTitle:m.string.isRequired,moreOptionsAccessibilityLabel:m.string.isRequired,inProductListTitle:m.string.isRequired}),breadcrumbsMenuAccessibilityLabel:m.string,firstInGroup:m.bool,actions:m.shape({promotionClickedEvent:m.func,navigateToPromotionClickedEvent:m.func,breadcrumbsDropdownOnOpen:m.func,breadcrumbsClickAction:m.func,moreOptionsClick:m.func}),catchWeightSubtextPosition:m.string,missedPromotion:EZ,hideMoreOptions:m.bool,frenchLawEnabled:m.bool,configurableFopEnabled:m.bool,isFixedHeightTitleWithEllipsisFFEnabled:m.bool,onClick:m.func,onContextMenu:m.func,displayLandscapeLayout:m.bool,position:m.number,fopPositionOnPage:m.number,type:m.string,page:m.string,subPage:m.string,group:m.shape({}),grossPriceEnabled:m.bool,fopView:m.string,withoutHeader:m.bool},IZ={active:!1,countryOfOrigin:void 0,name:void 0,bopLink:void 0,image:void 0,inCurrentCatalog:!1,noOfferLink:!1,attributes:void 0,offer:void 0,price:void 0,size:void 0,status:void 0,quantityInOrder:void 0,overlay:void 0,productId:void 0,loading:!1,linkAction:void 0,className:void 0,breadcrumbsVisible:!1,breadcrumbsItems:[],breadcrumbsChild:null,breadcrumbsText:null,breadcrumbsMenuAccessibilityLabel:null,firstInGroup:!1,actions:{moreOptionsClick:void 0},topAttributes:void 0,isInProductList:!1,isFavorite:!1,shoppingListsMessages:void 0,catchWeightSubtextPosition:"post",linkElement:void 0,missedPromotion:void 0,hideMoreOptions:!1,isFixedHeightTitleWithEllipsisFFEnabled:!1,frenchLawEnabled:!1,onClick:void 0,onContextMenu:void 0,position:null,fopPositionOnPage:null,subPage:null,controls:null,configurableFopEnabled:!1,type:null,page:null,group:{},grossPriceEnabled:!1,fopView:"detail",withoutHeader:!1},vut="custom",xS=44,pd=v(nt.FixedHeightWrapper)`
    ${({withoutHeader:e})=>e&&Pe`
            block-size: ${$(191)};
            ${re.smUp`
                height: ${({fitContent:t})=>t?"auto":$(404)};
            `};
        `}
    block-size: ${({fitContent:e})=>e&&"auto"}
`;pd.displayName="FixedHeightWrapper";const SZ=v(nt.FixedHeightSkeleton)`
    ${({withoutHeader:e})=>e&&Pe`
            && {
                inset-block-start: 0;
            }
        `}
`;SZ.displayName="FixedHeightSkeleton";nt.Image=v(BT)`
    block-size: 100%;
    inline-size: 100%;
    border-radius: var(--salt-radius-default);
`;const CZ=v(nt.Size)`
    display: flex;
`;CZ.displayName="Size";const Tut=v(nt.SizeText)`
    line-height: ${$(18)};
`,_ut=v(_g)`
    line-height: ${$(18)};
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
`,but=v(nt.FixedHeightTitle)`
    min-block-size: calc(2em * ${Sc});
    block-size: calc(2em * ${Sc});
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: initial;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: block-axis;
`,td=v(io)`
    ${nt.NavigationButton}
`;td.displayName="NavigationButton";const xut=v.div`
    margin-block-start: -${$(1)};
`,Aut=v(nt.OfferContainer)`
    block-size: ${$(xS)};
    margin-block-end: 0;
`,Rut=v.div`
    position: relative;
    overflow: hidden;
    block-size: ${$(xS)};
`,Dut=v.div`
    position: absolute;
    border-radius: var(--salt-radius-default);
    background: var(--intent-contrast);
    inset-block-end: ${({concealed:e})=>e?$(-xS):0};
    display: flex;
    block-size: ${$(xS)};
    inline-size: 100%;
    padding-block: 0;
    padding-inline: ${$(4)};
    overflow: hidden;
    transition-duration: 0.3s;
    transition-property: inset-block-end;
    transition-timing-function: ease-in-out;
`;let Au=class extends h.Component{constructor(t){super(t),this.fopWrapperRef=ae.createRef(),this.onOfferClick=this.onOfferClick.bind(this)}shouldComponentUpdate(t){const n=this.props.controls.type!==t.controls.type,o=(this.props.controls.counter||{}).value!==(t.controls.counter||{}).value||(this.props.controls.counter||{}).plusDisabled!==(t.controls.counter||{}).plusDisabled,r=(this.props.controls.navigation||{}).text!==(t.controls.navigation||{}).text,a=(this.props.status||{}).type!==(t.status||{}).type||(this.props.status||{}).message!==(t.status||{}).message,i=this.props.isInProductList!==t.isInProductList,l=this.props.isFavorite!==t.isFavorite,c=JSON.stringify(this.props.topAttributes)!==JSON.stringify(t.topAttributes),d=!Oi(this.props.missedPromotion,t.missedPromotion),u=!Oi(this.props.fopView,t.fopView);return n||o||r||a||i||l||c||d||u}buildOfferMessage(){const{offer:t}=this.props;return s.jsx(nt.OfferText,{display:"inline","data-test":"fop-offer-text",presentationMode:t.presentationMode,children:s.jsx(O,{children:t.message})})}getOverrideConfig(){const{page:t}=this.props;return t==="regulars"?uZ:{}}onOfferClick(){this.props.actions?.navigateToPromotionClickedEvent(),this.props.actions?.promotionClickedEvent()}buildOfferLink({ariaHidden:t}={}){const{offer:n,linkElement:o,inCurrentCatalog:r,noOfferLink:a}=this.props,i=this.buildOfferMessage(),l=s.jsx(nt.OfferText,{className:"salt-m-r--1 salt-d--inline-block","data-test":"fop-offer-icon",presentationMode:n.presentationMode,children:s.jsx(pe,{name:n.icon,verticalAlign:"middle"})});return r&&!a?s.jsxs(nt.OfferLink,{"data-test":"fop-offer-link",href:n.url,as:o,to:n.url,onClick:this.onOfferClick,"aria-hidden":!!t,tabIndex:t&&-1,"aria-label":n.message,children:[l,i]}):s.jsxs(h.Fragment,{children:[l,i]})}buildMissedPromotionLink(){const{offer:t,linkElement:n,missedPromotion:o}=this.props,r=this.buildOfferMessage();return s.jsx(xut,{children:s.jsx(nt.OfferLink,{"data-test":"fop-offer-link","aria-label":o?.missedPromotionTextAlternative,href:t.url,as:n,to:t.url,onClick:this.onOfferClick,children:s.jsx(fZ,{fopMissedPromotion:o,children:r})})})}buildControls(){const{controls:t,productId:n,name:o}=this.props;if(t.type==="counter")return s.jsxs(h.Fragment,{children:[s.jsx(ie,{"aria-live":"polite","aria-relevant":"text",children:t.counter.quantityDescriptionTextAlternative}),s.jsx(HO,{min:0,max:t.counter.max?Number(t.counter.max):t.counter.max,count:t.counter.value||0,onQuantityUpdate:t.counter.updateBasketQuantity,plusDisabled:t.counter.plusDisabled,addText:t.counter.addText,addTextAlternative:t.counter.addTextAlternative,increaseQuantityTextAlternative:t.counter.increaseQuantityTextAlternative,decreaseQuantityTextAlternative:t.counter.decreaseQuantityTextAlternative,editQuantityTextAlternative:t.counter.editQuantityTextAlternative,quantityDescriptionTextAlternative:t.counter.quantityDescriptionTextAlternative,action:t.counter.action,addInfo:t.counter.addInfo,addIcon:t.counter.addIcon,"data-synthetics":`product-id:${n}`,"data-test":"fop-counter"})]});if(t.type==="action"){const r={intent:"action",fill:!0,onClick:t.action.onClick,"data-test":"fop-action",name:o};return t.action.appearance&&(r.intent=t.action.appearance),s.jsxs(td,{...r,children:[s.jsx(td.Text,{children:t.action.text}),s.jsx(ie,{children:r.name})]})}if(t.type==="navigation"){const r={intent:"action",fill:!0,action:!0,"data-test":"fop-navigation",onClick:t?.navigation?.action};return t?.navigation?.url?s.jsx(td,{...r,asChild:!0,children:s.jsx(Ye,{intent:"ghost",to:t.navigation.url,children:s.jsx(td.Text,{children:t.navigation.text})})}):s.jsx(td,{...r,children:s.jsx(td.Text,{children:t.navigation.text})})}return t.type===vut?t.custom:null}renderControls(){const{quantityInOrder:t}=this.props;return t&&t.quantity>0?s.jsxs(Q,{wrap:"nowrap",className:"salt-m-b--1",children:[s.jsxs(nt.OrderQuantity,{title:t.message,children:[s.jsx(ie,{children:t.message}),s.jsx("span",{"aria-hidden":"true","data-test":"quantity-in-order","data-synthetics":"quantity-in-order",children:t.quantity})]}),s.jsx(rr,{children:this.buildControls()})]}):this.buildControls()}renderBreadcrumbs(){const{breadcrumbsVisible:t,breadcrumbsItems:n,breadcrumbsChild:o,breadcrumbsText:r,breadcrumbsMenuAccessibilityLabel:a,firstInGroup:i,linkElement:l,actions:c,productId:d}=this.props;return s.jsx(FT,{breadcrumbsChild:o,breadcrumbsItems:n,breadcrumbsText:r,breadcrumbsMenuAccessibilityLabel:a,breadcrumbsVisible:t,firstInGroup:i,linkElement:l,actions:c,productId:d})}renderMoreOptionsIcon(){const{actions:t,hideMoreOptions:n,shoppingListsMessages:o}=this.props;return n?null:s.jsx(nt.ActionsWrapper,{children:s.jsxs(x,{size:"s",intent:"tertiary",onClick:t.moreOptionsClick,"data-test":"fop-more-options","aria-label":o.moreOptionsAccessibilityLabel,children:[s.jsx(x.Icon,{name:"more"}),s.jsx(ie,{children:o.moreOptionsTitle})]})})}renderHeader(){const{attributes:t,countryOfOrigin:n,name:o,bopLink:r,image:a,linkElement:i,linkAction:l,topAttributes:c,isInProductList:d,productId:u,shoppingListsMessages:p,frenchLawEnabled:g,displayLandscapeLayout:E}=this.props,I=((C=[])=>{const T=["outOfStock","featured","favorite","list","regular"];return[...C,{type:"list",value:null}].sort((_,A)=>T.indexOf(_.type)>T.indexOf(A.type)?1:-1).map(_=>_.type==="outOfStock"&&s.jsx(nt.OutOfStockBadge,{intent:CA(_.chipType),"data-test":"out-of-stock",title:_.text,text:_.text,singleLine:!0},`out-of-stock-${_.text}`)||_.type==="featured"&&s.jsx(ln,{intent:"primary","date-test":"fop-featured",title:_.accessibility,text:_.text,singleLine:!0},`fop-featured-${_.text}`)||_.type==="favorite"&&s.jsx(nt.FopTopBarIcon,{name:"favourites","data-test":"fop-fav-icon",title:_.text,width:24},`fop-fav-icon-${_.text}`)||_.type==="list"&&d&&s.jsx(pe,{primary:!0,width:24,name:"list","data-test":"in-product-list",title:p.inProductListTitle},"in-product-list")||_.type==="regular"&&s.jsx(nt.FopTopBarIcon,{name:"regulars","data-test":"fop-reg-icon",title:_.text,width:24},`fop-reg-icon-${_.text}`)).filter(_=>!!_)})(c),S=!!I.length;return s.jsx(nt.Header,{children:s.jsxs(nt.Media,{displayLandscapeLayout:E,children:[s.jsx(nt.ImageTopBar,{children:s.jsxs(Q,{direction:"column",basis:"100%",children:[s.jsx(nt.ImageTopBarTopRow,{displayLandscapeLayout:E,children:S&&I}),n?.country&&s.jsx(nt.ImageTopBarBottomRow,{children:s.jsx(nt.ImageTopBarBottomRowInner,{hasTopBarAttributes:S,children:s.jsx(nt.CountryOfOrigin,{"data-test":"fop-country-of-origin",title:n.title,intent:"tertiary-contrast",size:g?"xl":"m",text:s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:n.a11yPrefix}),n.country]}),singleLine:!0},"fop-country-of-origin")})})]})}),!!t&&s.jsx(nt.ImageBottomBar,{displayLandscapeLayout:E,hasMultipleAttributeGroups:t.length>1,children:s.jsx(XL,{attributeGroups:t,productId:u})}),s.jsx(nt.ImageWrapper,{as:i,to:r,displayLandscapeLayout:E,"data-synthetics":"bop-link",onClick:l,children:s.jsx(nt.Image,{title:a.description||o,alt:a.alt,src:a.src})})]})})}renderBody(){const{name:t,bopLink:n,offer:o,price:r,size:a,linkElement:i,linkAction:l,catchWeightSubtextPosition:c,displayLandscapeLayout:d,missedPromotion:u,grossPriceEnabled:p,isFixedHeightTitleWithEllipsisFFEnabled:g}=this.props,E=!p&&a&&a.subtext,y=s.jsx(b,{id:"fop.tax.inclusive",values:{grossPrice:r.gross}}),I=g?but:nt.FixedHeightTitle;return s.jsxs(nt.BodyContainer,{displayLandscapeLayout:d,children:[s.jsxs(nt.Body,{"data-test":"fop-body",displayLandscapeLayout:d,children:[t&&s.jsx(O,{asChild:!0,children:s.jsx("h3",{children:s.jsx(I,{as:i,"data-test":"fop-product-link",to:n,tabIndex:"-1",onClick:l,children:t})})}),s.jsx("div",{"data-test":"fop-offer",children:s.jsx(Aut,{children:o&&o.message&&s.jsxs(Rut,{children:[this.buildOfferLink({ariaHidden:u}),s.jsx(Dut,{concealed:!u,children:u&&this.buildMissedPromotionLink()})]})})}),s.jsx("div",{"data-test":"fop-size",children:s.jsx(CZ,{children:a&&s.jsxs(h.Fragment,{children:[a.value&&s.jsxs(Tut,{size:"md",display:"inline-block",children:[E&&c==="pre"&&s.jsx(nt.CatchWeightText,{pre:!0,children:a.subtext}),a.value,E&&c!=="pre"&&s.jsx(nt.CatchWeightText,{post:!0,children:a.subtext})]}),a.pricePer&&s.jsxs(_ut,{size:"m",presentationMode:o&&o.presentationMode,display:"inline",isOffer:r.type==="offer",children:["(",a.pricePer,")"]})]})})}),s.jsxs(nt.PriceWrapper,{"data-test":"fop-price-wrapper",children:[s.jsxs(rut,{type:r.type,"data-test":"fop-price",children:[E&&c==="pre"&&s.jsx(O,{asChild:!0,children:s.jsx(nt.CatchWeightText,{pre:!0,children:a.subtext})}),r.current,E&&c!=="pre"&&s.jsx(O,{asChild:!0,children:s.jsx(nt.CatchWeightText,{post:!0,children:a.subtext})})]}),p&&r.type==="offer"&&r.gross&&s.jsx(_g,{presentationMode:o.presentationMode,isOffer:!0,display:"inline",children:y}),p&&r.type!=="offer"&&r.gross&&s.jsx(O,{children:y}),!p&&r.original&&s.jsx(aut,{children:r.original})]})]}),s.jsx(nt.Footer,{children:s.jsx("div",{className:"salt-m-b--1",children:this.renderControls()})})]})}render(){const{loading:t,active:n,overlay:o,productId:r,className:a,breadcrumbsVisible:i,firstInGroup:l,status:c,controls:d,onClick:u,onContextMenu:p,offer:g,noOfferLink:E,configurableFopEnabled:y,missedPromotion:I,subPage:S,page:C,type:T,group:_,alcohol:A,position:R,displayLandscapeLayout:P,fopView:N,withoutHeader:k,fopPositionOnPage:M}=this.props;return N==="list"?s.jsx(pd,{fitContent:!0,onContextMenu:p,breadcrumbsHeader:i,firstInGroup:l,ref:this.fopWrapperRef,className:a,status:c,displayLandscapeLayout:!0,withoutHeader:k,children:s.jsx(dZ,{loading:t,productId:r,group:_,position:R,page:C,type:T,subPage:S,noOfferLink:E,displayLandscapeLayout:P,withoutHeader:k,overrideConfig:this.getOverrideConfig(),fopPositionOnPage:M,buildFopContextIfEmpty:!1})}):t&&!(y&&C!=="order-details")?s.jsx(pd,{active:n,ref:this.fopWrapperRef,className:a,breadcrumbsHeader:!0,firstInGroup:l,displayLandscapeLayout:P,withoutHeader:k,"data-test":"fetching-skeleton",children:s.jsx(SZ,{displayLandscapeLayout:P,firstInGroup:l,withoutHeader:k})}):y&&C!=="order-details"?s.jsx(pd,{fitContent:!0,onContextMenu:p,breadcrumbsHeader:i,firstInGroup:l,ref:this.fopWrapperRef,className:a,status:!!c,displayLandscapeLayout:P,withoutHeader:k,"data-retailer-anchor":"deprecated-fop-wrapper",children:s.jsx(ea,{loading:t,productId:r,group:_,position:R,page:C,type:T,subPage:S,noOfferLink:E,displayLandscapeLayout:P,withoutHeader:k,overrideConfig:this.getOverrideConfig(),fopPositionOnPage:M,buildFopContextIfEmpty:!1})}):s.jsxs(h.Fragment,{children:[s.jsxs(pd,{onClick:u,onContextMenu:p,breadcrumbsHeader:i,firstInGroup:l,ref:this.fopWrapperRef,"data-test":`fop-wrapper:${r}`,"data-retailer-anchor":"fop-deprecated",className:a,status:!!c,displayLandscapeLayout:P,withoutHeader:k,children:[this.renderBreadcrumbs(),c&&s.jsx("div",{className:"salt-m-b--1",children:s.jsx(JL,{status:c})}),s.jsx(xe,{className:"salt-p--0",children:s.jsx(Ji,{isActive:A,overlay:s.jsx(Tu,{className:"salt-p--2"}),children:s.jsxs(nt.BoxCard,{active:n,displayLandscapeLayout:P,children:[o&&C!=="regulars"&&s.jsx(nt.Overlay,{}),this.renderMoreOptionsIcon(),this.renderHeader(),this.renderBody()]})})})]}),g?.requiredProductQuantity&&s.jsx(bg,{productQuantity:d.counter.value,message:I?.missedPromotionTextAlternative})]})}};Au.propTypes=yZ;Au.defaultProps=IZ;Au.ATTRIBUTE_TYPE=ic;Au.ATTRIBUTE_GROUP_TYPE=bS;vo.displayName="FopLayout";class Mm extends h.Component{constructor(t){super(t),this.fopWrapperRef=ae.createRef()}shouldComponentUpdate(t){return(this.props.controls.counter||{}).value!==(t.controls.counter||{}).value||(this.props.controls.counter||{}).plusDisabled!==(t.controls.counter||{}).plusDisabled}render(){return s.jsx(ZX,{...this.props,ref:this.fopWrapperRef})}}Mm.propTypes=yZ;Mm.defaultProps=IZ;Mm.contextType=XX.Context;Mm.displayName="Tile";const Out=(e={},t)=>{const{hideOnViewports:n}=e;return!t||!n||!n.length||!n.includes(t)},fy=(e,t)=>`
        display: ${Out(e,t)?"flex":"none"};
    `,Put=Pe`
    ${e=>fy(e,"xs")};

    ${re.smUp`
        ${e=>fy(e,"sm")};
    `}
    ${re.mdUp`
        ${e=>fy(e,"md")};
    `}
    ${re.lgUp`
        ${e=>fy(e,"lg")};
    `};
`,vZ=(e,t=Number.MAX_VALUE)=>e<=t,Nut=(e,t,n)=>e.type!=="featured"||vZ(t,e.viewportConfig[n]),yy=(e,t)=>vZ(e,t)?"flex":"none",Lut=Pe`
    display: ${e=>yy(e.position,e.viewportConfig.xs)};
    ${re.smUp`
        display: ${e=>yy(e.position,e.viewportConfig.sm)};
    `}
    ${re.mdUp`
        display: ${e=>yy(e.position,e.viewportConfig.md)};
    `}
    ${re.lgUp`
        display: ${e=>yy(e.position,e.viewportConfig.lg)};
    `}
`,zo=v(Au)`
    ${e=>e.viewportConfig?e.isFeatured?Lut:"display: flex":e.hideOnViewports?Put:""}
`;zo.ATTRIBUTE_TYPE=Au.ATTRIBUTE_TYPE;zo.ATTRIBUTE_GROUP_TYPE=Au.ATTRIBUTE_GROUP_TYPE;zo.displayName="ViewportsEnabledFop";const ch=e=>(t,n)=>t.product&&t[n]===void 0?new Error(`Prop ${n} required when a product is present`):m.checkPropTypes({propName:e},t,"prop","Fop"),TZ={product:sl,quantityInBasket:ch(m.number),maxQuantityReached:ch(m.bool),featured:ch(m.bool),updateBasketQuantity:ch(m.func),messages:ch(m.shape({catchWeight:m.string,countryOfOriginTitle:m.func,countryOfOriginA11yPrefix:m.string,pricePerUnit:m.string,outOfStock:m.string,notInCatalog:m.string,addToTrolley:m.string,addToTrolleyAlternative:m.func,increaseQuantityInTrolleyAlternative:m.string.isRequired,decreaseQuantityInTrolleyAlternative:m.string.isRequired,editQuantityTextAlternative:m.string.isRequired,getQuantityDescriptionTextAlternative:m.func.isRequired,maxQuantity:m.string,addedToBasket:m.string,lastBought:m.string,favoriteIconDescription:m.string,featuredLabel:m.string,featuredLabelDescription:m.string,timeRestriction:m.func,guaranteedProductLifeBadge:m.func,guaranteedProductLifeDescription:m.func,deposit:m.func,depositDescription:m.string,quantity:m.string,quantityLabel:m.func,missing:m.string,missingLabel:m.func,unavailableLabel:m.func,substitute:m.string,substituteLabel:m.func,accepted:m.string,acceptedLabel:m.func,rejected:m.string,rejectedLabel:m.func,returned:m.string,returnedLabel:m.func,seeAlternatives:m.func,noAlternatives:m.string,taxInclusive:m.func})),linkElement:m.oneOfType([m.string,m.func,m.elementType]),innerRef:m.func,hideOnViewports:m.arrayOf(m.string),isOrder:m.bool,showStatus:m.bool,noOfferLink:m.bool,linkAction:m.func,clusterBreadcrumbs:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired,link:m.string.isRequired})),isSEOReadableURLEnabled:m.bool,isRegionAgnosticEnabled:m.bool,fopPositionOnPage:m.number,catchWeightSubtextPosition:m.string,actions:m.shape({moreOptionsClick:m.func,promotionClickedEvent:m.func,breadcrumbsDropdownOnOpen:m.func,breadcrumbsClickAction:m.func,timeRestrictionNotification:m.func,maxQuantityReachedNotification:m.func,openOutOfStockAlternativesModal:m.func,noAlternativesHandler:m.func,showSubstitutesClickedEvent:m.func,navigateToPromotionClickedEvent:m.func}),missedPromotion:m.shape({requiredProductQuantity:m.number.isRequired,addedProductQuantity:m.number.isRequired,toAddProductQuantity:m.number.isRequired,missedPromotionText:m.string.isRequired,missedPromotionTextAlternative:m.string.isRequired,onMissedPromotionTextChange:m.func}),outOfStockAlternativesEnabled:m.bool,hideMoreOptions:m.bool,displayLandscapeLayout:m.bool,onClick:m.func,onContextMenu:m.func,fopControls:m.element,reviewsEnabled:m.bool,configurableFopEnabled:m.bool,isFixedHeightTitleWithEllipsisFFEnabled:m.bool,page:m.string,subPage:m.string,grossPriceEnabled:m.bool,alcoholBlurEnabled:m.bool,hideOriginalPriceEnabled:m.bool,referencePriceEnabled:m.bool},_Z={product:null,featured:!1,innerRef:null,hideOnViewports:[],isOrder:!1,showStatus:!1,noOfferLink:!1,linkAction:void 0,clusterBreadcrumbs:[],box:!1,catchWeightSubtextPosition:"post",linkElement:void 0,actions:{},isSEOReadableURLEnabled:!1,alcoholBlurEnabled:!1,isFixedHeightTitleWithEllipsisFFEnabled:!1,outOfStockAlternativesEnabled:!1,hideMoreOptions:!1,onClick:()=>{},onContextMenu:()=>{},fopControls:void 0,subPage:null,fopPositionOnPage:0};class bZ{constructor({product:t,fopView:n,updateBasketQuantity:o,featured:r,group:a={},firstInGroup:i,position:l=0,maxQuantityReached:c,maxQuantityPerProduct:d,quantityInBasket:u,linkElement:p,messages:g,hideOnViewports:E,isOrder:y,showStatus:I,linkAction:S,clusterBreadcrumbs:C,activeFopNoBackgroundEnabled:T,dynamicImagesEnabled:_,productImages:A,box:R,actions:P,catchWeightSubtextPosition:N,noOfferLink:k,isSEOReadableURLEnabled:M,isRegionAgnosticEnabled:w,missedPromotion:j,svgDefsEnabled:G,outOfStockAlternativesEnabled:W,frenchLawEnabled:H,hideMoreOptions:K,displayLandscapeLayout:X,fopControls:q,onClick:ne,onContextMenu:ue,type:oe,reviewsEnabled:ye,configurableFopEnabled:he,page:Ie,subPage:Fe,grossPriceEnabled:be,hideOriginalPriceEnabled:ce,referencePriceEnabled:me,withoutHeader:De,isFixedHeightTitleWithEllipsisFFEnabled:ge,fopPositionOnPage:Se,alcoholBlurEnabled:Ae}){if(this.product=t,this.featured=r,this.quantityInBasket=u,this.messages=g,this.isOrder=y,this.showStatus=I,this.linkAction=S,this.fopControls=q,this.props={product:t,controls:{counter:{updateBasketQuantity:t?o(u||0):null,max:d}},active:!!u&&!T,viewportConfig:a.viewportConfig,position:l,hideOnViewports:E,isFeatured:r,dynamicImagesEnabled:_,productImages:A,box:R,catchWeightSubtextPosition:N,noOfferLink:k,missedPromotion:j,svgDefsEnabled:G,frenchLawEnabled:H,alcohol:t?.alcohol,alcoholBlurEnabled:Ae,configurableFopEnabled:he,isFixedHeightTitleWithEllipsisFFEnabled:ge,hideMoreOptions:K,displayLandscapeLayout:X,onClick:ne,onContextMenu:ue,type:oe,page:Ie,subPage:Fe,group:a,grossPriceEnabled:be,hideOriginalPriceEnabled:ce,referencePriceEnabled:me,fopView:n,withoutHeader:De,fopPositionOnPage:Se},this.props.firstInGroup=i,this.isSEOReadableURLEnabled=M,this.isRegionAgnosticEnabled=w,this.outOfStockAlternativesEnabled=W,!t){this.props.loading=!0;return}this.product.isInCurrentCatalog=t.isInCurrentCatalog!==!1,this.props.inCurrentCatalog=this.product.isInCurrentCatalog,this.unavailableButInBasket=!this.isProductAvailable()&&u>0,this.cannotAddMore=c,this.maxQuantityPerProduct=d,this.props.linkElement=this.product.isInCurrentCatalog?p:null,this.actions=P,this.reviewsEnabled=ye,this.setProductProps(),this.setMessageProps(),this.setActionProps(P),this.props.breadcrumbsVisible=C.length>0||!!(a.products.length>0&&typeof a.type=="string"&&a.type.length),this.props.breadcrumbsVisible&&i&&(C.length>0?(this.props.breadcrumbsItems=C,this.props.breadcrumbsChild=C.length>0?C[C.length-1]:null,this.props.breadcrumbsMenuAccessibilityLabel=g.productGroupMenuAccessibilityLabel,this.props.actions.breadcrumbsDropdownOnOpen=P.breadcrumbsDropdownOnOpen(C),this.props.actions.breadcrumbsClickAction=(Ce,We)=>P.breadcrumbsClickAction(Ce,We)):(this.props.breadcrumbsText={message:g.productGroupTitle(a.type),link:a.type===Ut.FAVORITE?"/favorites?source=breadcrumbs":null},this.props.actions.breadcrumbsClickAction=Ce=>P.breadcrumbsClickAction(Ce)))}isFavorite(){return!!this.product.favorite}isRegular(){return!!this.product.regular}isProductAvailable(){const{product:t}=this;return t.available&&t.isInCurrentCatalog}setMessageProps(){const{messages:t,product:n,quantityInBasket:o,showStatus:r,unavailableButInBasket:a}=this;if(t&&((this.featured||n.cmsProductAttributes&&n.cmsProductAttributes.indexOf("featured")!==-1)&&t.featuredLabelDescription&&(this.props.topAttributes=this.props.topAttributes||[],this.props.topAttributes.unshift({type:"featured",chipType:"primary",text:t.featuredLabel,accessibility:t.featuredLabelDescription})),!a&&!this.isProductAvailable()&&t.outOfStock&&(this.props.topAttributes=this.props.topAttributes||[],this.props.topAttributes.unshift({type:"outOfStock",chipType:"secondary",text:t.outOfStock})),this.isFavorite()&&t.favoriteIconDescription&&(this.props.topAttributes=this.props.topAttributes||[],this.props.topAttributes.unshift({type:"favorite",text:t.favoriteIconDescription})),this.isRegular()&&t.regularIconDescription&&(this.props.topAttributes=this.props.topAttributes||[],this.props.topAttributes.unshift({type:"regular",text:t.regularIconDescription})),this.props.shoppingListsMessages={moreOptionsTitle:t.moreOptionsTitle,moreOptionsAccessibilityLabel:t.moreOptionsAccessibilityLabel,inProductListTitle:t.inProductListTitle},r)){if(n.reason){if(n.reason===HZe&&(this.props.status={message:t.unavailableLabel(n.missingAmount),type:"error",alert:!0}),n.reason===GZe&&(this.props.status={message:t.missingLabel(n.missingAmount),type:"error",alert:!0}),n.reason===VZe){let i="";if(n.deliveryTimeRestrictionMessage&&(i=n.deliveryTimeRestrictionMessage),n.timeRestriction){const{deliverableTo:l,deliverableFrom:c}=n.timeRestriction;i=t.timeRestriction(l,c)}this.props.status={message:i,type:"error",alert:!0}}if(n.reason===$Ze){const{addedAmount:i,requestedAmount:l}=n;this.props.status={message:t.limitedAvailability(i,l),type:"error",alert:!0}}}n.quantityInOrder&&!o&&(this.props.quantityInOrder={quantity:n.quantityInOrder,message:t.quantityLabel(n.quantityInOrder)}),n.missing?this.props.status=t.missing&&{message:t.missingLabel(n.quantityInOrder),type:"error",alert:!0}:n.accepted?this.props.status=t.accepted&&{message:t.acceptedLabel(n.quantityInOrder),type:"success",alert:!0}:n.rejected?this.props.status=t.rejected&&{message:t.rejectedLabel(n.quantityInOrder),type:"error",alert:!0}:n.substitute?this.props.status=t.substitute&&{message:t.substituteLabel(n.quantityInOrder),type:"success",alert:!0}:n.returned&&(this.props.status=t.returned&&{message:t.returnedLabel(n.quantityInOrder),type:"success",alert:!0})}}setProductProps(){const{product:t,messages:n,linkAction:o,isOrder:r,unavailableButInBasket:a,isSEOReadableURLEnabled:i,isRegionAgnosticEnabled:l}=this;if(this.props.productId=t.productId,this.props.isInCurrentCatalog=this.product.isInCurrentCatalog,this.props.name=t.name,this.props.bopLink=Uo(t.retailerProductId,kc(t.name,{isSEOReadableURLEnabled:i})),this.props.linkAction=o,this.props.overlay=a?!1:!this.isProductAvailable(),this.props.image={description:t.image?.description??t.name,src:t.image.src,fopSrcset:t.image.fopSrcset},t.countryOfOrigin&&(this.props.countryOfOrigin={a11yPrefix:n.countryOfOriginA11yPrefix,title:n.countryOfOriginTitle(t.countryOfOrigin),country:t.countryOfOrigin}),t.offer){const d=l?t.offer.retailerPromotionId:t.offer.id,u=Cn(t.offer.description);this.props.offer={message:t.offer.description,url:t.offer.type==="COUPON"?QE(d,u):qa(d,i?u.toLowerCase():void 0),icon:t.offer.type&&XE(t.offer.type),...t.offer.presentationMode&&{presentationMode:t.offer.presentationMode},requiredProductQuantity:t.offer.requiredProductQuantity}}this.props.price={original:t.price?.original?.amount,current:t.price?.current?.amount,type:t.offer&&t.price?.original?"offer":"standard",gross:t.price?.gross?.amount,reference:t.price?.reference?.amount},this.props.size={value:t.size&&`${t.size.value}${t.size.uom||""}`,pricePer:t.price?.unit?.current?.amount&&n?.pricePerUnit,subtext:t.size?.catchWeight&&n?.catchWeight},this.props.controls={...this.props.controls,...this.getControlProps(this.props.controls.counter)};const c=(d,u)=>(this.props.attributes=this.props.attributes||[],this.props.attributes[d]=this.props.attributes[d]||{type:u,attributes:[]},this.props.attributes[d].attributes);if(t.depositPrice&&n.deposit&&n.depositDescription&&c(0,zo.ATTRIBUTE_GROUP_TYPE.SINGLE_LINE).push({type:zo.ATTRIBUTE_TYPE.TEXT,chipType:"promotion",text:n.deposit(t.depositPrice.amount,t.depositPrice.currency),accessibility:n.depositDescription}),t.guaranteedProductLife&&t.guaranteedProductLife.quantity>0&&t.guaranteedProductLife.unit&&n.guaranteedProductLifeBadge&&n.guaranteedProductLifeDescription&&c(0,zo.ATTRIBUTE_GROUP_TYPE.SINGLE_LINE).push({type:zo.ATTRIBUTE_TYPE.TEXT,chipType:"primary",text:n.guaranteedProductLifeBadge(t.guaranteedProductLife.quantity,t.guaranteedProductLife.unit),accessibility:n.guaranteedProductLifeDescription(t.guaranteedProductLife.quantity,t.guaranteedProductLife.unit)}),t.attributes){const d=c(0,zo.ATTRIBUTE_GROUP_TYPE.SINGLE_LINE);t.attributes.forEach(u=>d.push({type:zo.ATTRIBUTE_TYPE.IMAGE,...u}))}this.props.isInProductList=t.isInProductList,this.props.isFavorite=this.isFavorite(),this.props.reviewsEnabled=this.reviewsEnabled,this.isFavorite()&&!r&&n.lastBought&&t.favorite.lastBought?c(1,zo.ATTRIBUTE_GROUP_TYPE.MULTI_LINE).push({type:zo.ATTRIBUTE_TYPE.TEXT,position:"bottom",chipType:"secondary",text:`${n.lastBought(t.favorite.lastBought)}`,accessibility:`${n.lastBought(t.favorite.lastBought)}`}):this.reviewsEnabled&&c(1,zo.ATTRIBUTE_GROUP_TYPE.MULTI_LINE).push({type:zo.ATTRIBUTE_TYPE.RATING}),this.props.image.alt=String(this.props.image.description||this.props.name).concat(" ",(Array.isArray(this.props.attributes)&&this.props.attributes[0]&&this.props.attributes[0].attributes||[]).map(d=>d.accessibility||d.label).filter(Boolean).join(", ")||"").trim()}getControlProps(t){const{product:n,messages:o,cannotAddMore:r,maxQuantityPerProduct:a,actions:i,unavailableButInBasket:l,outOfStockAlternativesEnabled:c,fopControls:d,quantityInBasket:u,props:{type:p}}=this,g={...t,minusDisabled:!1,value:u,addText:n.isInCurrentCatalog?o.addToTrolley:o.notInCatalog,plusDisabled:r||!this.isProductAvailable(),addTextAlternative:o.addToTrolleyAlternative(n.name),increaseQuantityTextAlternative:o.increaseQuantityInTrolleyAlternative(n.name),decreaseQuantityTextAlternative:o.decreaseQuantityInTrolleyAlternative(n.name),editQuantityTextAlternative:o.editQuantityTextAlternative(n.name),quantityDescriptionTextAlternative:o.getQuantityDescriptionTextAlternative(u)};l&&(g.max=u);const E=A=>this.actions.showSubstitutesClickedEvent({productId:this.props.productId,retailerProductId:this.product.retailerProductId,totalCount:this.product.alternatives?.length||0,productSequence:this.props.position,hideSubstitutes:!1,pageEventId:A}),y={maxQuantity:"maxQuantity",timeRestriction:"timeRestriction",outOfStock:"outOfStock"},I=function(){if(!r)return null;if(p!=="slotbooking"){if(u>=a)return y.maxQuantity;if(n.timeRestriction)return y.timeRestriction}return!n.available||p==="slotbooking"&&n.timeRestriction?y.outOfStock:y.maxQuantity}(),S=n.alternatives&&n.alternatives.length>0,C=!u||p==="slotbooking";if(d)return{type:"custom",custom:d};const T=n.timeRestriction?.deliverableTo,_=n.timeRestriction?.deliverableFrom;switch(I){case y.maxQuantity:return{type:"counter",counter:{...g,action:()=>{i.maxQuantityReachedNotification()},addInfo:!0,addIcon:"info_default",addText:o.maxQuantityLabel,addTextAlternative:o.maxQuantity,increaseQuantityTextAlternative:o.maxQuantity}};case y.timeRestriction:return{type:"counter",counter:{...g,action:()=>{i.timeRestrictionNotification(T,_)},addInfo:!0,addIcon:"slot",addText:o.timeRestricted,addTextAlternative:o.timeRestriction(T,_),increaseQuantityTextAlternative:o.timeRestriction(T,_)}};case y.outOfStock:return S&&C?c?{type:"action",action:{text:o.seeAlternatives(n.alternatives),onClick:()=>{const A=ct();this.actions.openOutOfStockAlternativesModal({productId:this.props.productId,retailerProductId:n.retailerProductId,productName:this.props.name,type:this.props.type,pageEventId:A}),E(A)}}}:{type:"navigation",navigation:{text:o.seeAlternatives(n.alternatives),url:`/products/${n.retailerProductId}/alternatives`}}:c&&C?{type:"action",action:{appearance:"secondary",text:o.noAlternatives,onClick:()=>{this.actions.noAlternativesHandler(),E()}}}:{type:"counter",counter:{...g,action:()=>i.cannotAddBecauseOutOfStockNotification(),addInfo:!0,addIcon:u?"info_default":null,addText:o.outOfStock}};default:return{type:"counter",counter:{...g}}}}setActionProps(t={}){if(this.props.actions={},this.props.offer){const{promotionClickedEvent:n,navigateToPromotionClickedEvent:o}=t,r=this.props.fopPositionOnPage;this.props.actions={promotionClickedEvent:n({productId:this.props.productId,promotionId:this.isRegionAgnosticEnabled?this.product.offer.retailerPromotionId:this.product.offer.id}),navigateToPromotionClickedEvent:o({itemId:this.product.retailerProductId,itemName:this.props.name,index:r,promotionId:this.isRegionAgnosticEnabled?this.product.offer.retailerPromotionId:this.product.offer.id,promotionName:this.product.offer.description,list:ks(this.props.page,this.props.subPage,this.props.section)})}}this.props.actions.moreOptionsClick=t.moreOptionsClick}}const wm=e=>{const t=new bZ(e);return s.jsx(zo,{...t.props,ref:e.innerRef})},Fm=e=>{const t=new bZ(e);return s.jsx(Mm,{...t.props,ref:e.innerRef})};wm.propTypes=TZ;wm.defaultProps=_Z;Fm.propTypes=TZ;Fm.defaultProps=_Z;const ek=(e,t)=>{const[n=!1]=Ee(["seo.rdbl"]);return Aa.calculateLegacyTargetUrl(e,{isSEOReadableURLEnabled:n},t)},UT=(e=()=>{})=>{const t=h.useRef(!1),n=h.useRef(null);return h.useCallback(r=>{if(!window.IntersectionObserver||!r||n.current)return;const a=([l])=>{l.isIntersecting&&!t.current&&(e(),t.current=!0,n.current.unobserve(l.target))},i={threshold:.2,root:null,rootMargin:"0%"};n.current=new IntersectionObserver(a,i),n.current.observe(r)},[e])},tk=e=>!["isFirstInProductsListing"].includes(String(e)),kut=v.img`
    block-size: auto;
    max-block-size: 100%;
    max-inline-size: 100%;
    inline-size: auto;
    object-fit: contain;
`,jut="calc(var(--salt-spacing-1) * 7)",xZ=v.div.withConfig({shouldForwardProp:tk})`
    border-radius: var(--salt-radius-default);
    inline-size: 100%;
    padding: 0;
    position: relative;
    background: transparent;
    border: none;
    overflow: hidden;
    z-index: 1;
    block-size: auto;
    ${re.smUp`height: ${({height:e})=>e};`}

    ${({isFirstInProductsListing:e})=>e&&Pe`
            ${re.smUp`
                margin-top: ${jut};
            `}
        `}
`,Mut=v(xZ).withConfig({shouldForwardProp:tk})`
    place-self: end center;
    margin-block-end: 0;
    overflow: hidden;
    block-size: auto;
    ${re.smUp`height: ${({height:e})=>e};`}
`,wut=v(nt.BoxCard).withConfig({shouldForwardProp:tk})`
    background: transparent;
    overflow: hidden;
    z-index: 1;

    ${re.xs`
        height: auto !important;
    `}
`,OG=v(nt.FixedHeightWrapper)`
    margin-block-start: auto;
    block-size: fit-content;
    ${re.smUp`height: ${({containerCustomHeight:e})=>e};`}
`,Fut=e=>e.find(t=>!!t?.offsetParent),But=e=>e.find(t=>!!t?.offsetParent&&t.querySelector("img")),AZ=e=>{const n=Array.from(document.querySelectorAll(".product-card-container")).filter(a=>{const i=a.closest('[data-test^="fop-wrapper:"]');return!!i&&i.getAttribute("data-layout")!=="landscape"});if(!n.length)return"";const o=e(n);if(!o)return"";const r=o.getBoundingClientRect();return r?.height?`${$(r.height)}`:""},Uut=()=>AZ(But),Gut=()=>AZ(Fut),$ut=({onCheckedProductHeight:e,setHasProductRendered:t})=>{const n=Uut(),o=Gut();e(n||o||"auto"),n&&t()},Hut=({isConfigurableFopEnabled:e,isNewProductsListingEnabled:t})=>e&&t&&"CONFIGURABLE_IN_NEW_LISTING"||e&&"CONFIGURABLE"||"REGULAR",Vut=e=>["CONFIGURABLE"].includes(e)?"fit-content":void 0,Wut=e=>["CONFIGURABLE","CONFIGURABLE_IN_NEW_LISTING"].includes(e),Yut=e=>{switch(e){case"CONFIGURABLE":return"product-card-advert-configurable";case"CONFIGURABLE_IN_NEW_LISTING":return"product-card-advert-new-listing";default:return""}},qut=({variant:e,position:t,children:n,productHeight:o})=>{const a={breadcrumbsHeader:!0,firstInGroup:!1,displayLandscapeLayout:!1,containerCustomHeight:Vut(e)},i=`product-card-advert-${t}`,l=t===1;switch(e){case"CONFIGURABLE_IN_NEW_LISTING":return s.jsx(Mut,{"data-test":i,height:o,isFirstInProductsListing:l,children:n});case"CONFIGURABLE":return s.jsx(OG,{...a,children:s.jsx(xZ,{"data-test":i,height:o,isFirstInProductsListing:l,children:n})});default:return s.jsxs(OG,{...a,children:[s.jsx(FT,{breadcrumbsVisible:!0}),s.jsx(wut,{"data-test":i,children:n})]})}},RZ=({disableBlurring:e=!1,...t})=>{const n=e?DZ:Kut;return s.jsx(n,{imageHasBorderRadius:e,...t})},DZ=v(TT)`
    display: flex;
    align-items: center;
    flex-direction: column;
    justify-content: center;
    block-size: 100%;
    inline-size: 100%;

    picture {
        max-block-size: 100%;
        max-inline-size: 100%;
        inline-size: auto;
        ${re.xs`
            max-height: fit-content;
            width: 100%;
        `}
        ${re.xsUp`
            display: flex;
            height: 100%;
            width: 100%;
        `}
    }

    img {
        display: block;
        block-size: auto;
        max-block-size: 100%;
        max-inline-size: 100%;
        inline-size: auto;
        object-fit: contain;
        margin: auto;
        ${({imageHasBorderRadius:e})=>`border-radius: ${e?"var(--salt-radius-default)":"unset"};`};
        ${re.xs`
            max-height: fit-content;
            width: 100%;
        `}
    }
`,Kut=v(DZ)`
    ${re.smUp`
        position: relative;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
        overflow: hidden;
        z-index: 1;

        ${({$imageSet:e})=>`background-image: ${e};`};

        &:before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: -1;
            backdrop-filter: blur(50px);
        }
    `}
`,OZ=({advert:e,page:t,sequence:n})=>{const[o,r,a]=Ee(["cfop","new.prl","bl.d"]),[i]=CT(),l=Hut({isConfigurableFopEnabled:o,isNewProductsListingEnabled:r}),[c,d]=h.useState(""),u=!Wut(l),p=h.useRef(u),g=()=>{p.current=!0},E=i==="SMALL";h.useEffect(()=>{p.current=!1},[i]),h.useEffect(()=>{p.current||E||$ut({onCheckedProductHeight:d,setHasProductRendered:g})});let y;i&&(y=xg(e.images,cat[i]));const I=ek(e.target),S=hL(e),{reportStaticAdvertImpression:C,reportStaticAdvertClick:T}=nf(t,e.placement),A=UT(()=>{e&&y?.url&&C({id:e.id,name:e.name,altText:y.altText,contentSource:e.contentSource,targetUrl:I,linkType:e.target.linkType,segments:e.segments,sequence:n,format:e.format,imageUrl:y.url,size:1})}),R=()=>{e&&y?.url&&T({id:e.id,name:e.name,altText:y.altText,contentSource:e.contentSource,targetUrl:I,linkType:e.target.linkType,segments:e.segments,sequence:n,format:e.format,imageUrl:y.url,size:1})},P=y?Q7(y):"none",N=Yut(l);return y?s.jsx(qut,{variant:l,position:e.position,productHeight:c,children:s.jsx(RZ,{linkType:e?.target?.linkType,href:I,target:S,isExternalLink:e.isExternalLink,title:y.altText,onClick:R,"data-test":N,$imageSet:P,disableBlurring:a,children:s.jsx(vT,{image:y,contentSource:e.contentSource,pixelDensity:!0,children:s.jsx(kut,{ref:A,src:y.url,alt:y.altText??"",loading:"lazy"})})})}):null};function PG({showMissedPromotions:e,missedPromotionsEnabled:t,missedPromotionQuantities:n,quantity:o,product:r,orderId:a,messages:{missedPromotionCompleteTextAlternative:i,missedPromotionNotCompleteTextAlternative:l},actions:{analyticsEvent:c}}){if(!r)return null;const d=n?.basketQuantity,u=n?.requiredQuantity;if(!(e||t)||!d||!u)return null;const g=d%u||u,E=u-g,y=r.offer.description,I=E===0?i(o,y):l(o,y,g,u),S={id:r.offer.id,requiredProductQuantity:u,addedProductQuantity:g,toAddProductQuantity:E,missedPromotionText:y,missedPromotionTextAlternative:I,missedPromotionTextType:E===0?"PromotionComplete":"PromotionIncomplete"};return{...S,onMissedPromotionTextChange:()=>{c({type:Jt.MESSAGE_ALERT_DISPLAYED,missedPromotion:S,orderId:a,productId:r.productId,missedPromotionType:r.offer.type})}}}const NG=.5,zut=1e3,Qut=D("di"),Xut=D("afnbg"),Zut=D("seo.rdbl"),Jut=D("seo.ra"),ept=D("fop.mp"),tpt=D("oosa"),spt=D("fr.law"),npt=D("rvws"),opt=D("cfop"),rpt=D("ngp"),apt=D("hop"),ipt=D("prp"),lpt=D("fop.ellip"),cpt=D("alc.blur"),$u=e=>(t,n)=>t.product&&t[n]===void 0?new Error(`Prop ${n} required when a product is present`):m.checkPropTypes({propName:e},t,"props","ParentFop"),dpt={orderId:m.string,draftBasketId:m.string,actions:m.shape({setActiveBop:m.func.isRequired,analyticsEvent:m.func.isRequired,openShoppingListsModal:m.func.isRequired,openOutOfStockAlternativesModal:m.func.isRequired}).isRequired,productId:m.string,product:sl,fopView:m.string,position:m.number,fopPositionOnPage:m.number,group:m.shape({type:m.string,clusterBreadcrumbs:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired,retailerCategoryId:m.string}))}),firstInGroup:m.bool,sendFopProductLinkEvent:m.func.isRequired,currentBreakpoint:m.string,registerRef:m.func,hideOnViewports:m.arrayOf(m.string),pageViewId:m.string,activeFopNoBackgroundEnabled:m.bool.isRequired,dynamicImagesEnabled:m.bool.isRequired,isSEOReadableURLEnabled:m.bool,missedPromotionsEnabled:m.bool,isFixedHeightTitleWithEllipsisFFEnabled:m.bool,missedPromotionQuantities:m.shape({basketQuantity:m.number,requiredQuantity:m.number}),outOfStockAlternativesEnabled:m.bool.isRequired,frenchLawEnabled:m.bool.isRequired,alcoholBlurEnabled:m.bool.isRequired,maxQuantityPerProduct:m.number,noOfferLink:m.bool,userLoggedIn:m.bool.isRequired,catchWeightSubtextPosition:m.string,quantity:$u(m.number),updateBasketQuantity:$u(m.func),messages:$u(m.shape({catchWeight:m.string,countryOfOriginTitle:m.func,countryOfOriginA11yPrefix:m.string,pricePerUnit:m.string,outOfStock:m.string,addToTrolley:m.string,maxQuantity:m.string,addedToBasket:m.string,lastBought:m.string,timeRestricted:m.string,timeRestriction:m.func,increaseQuantityInTrolleyAlternative:m.string.isRequired,decreaseQuantityInTrolleyAlternative:m.string.isRequired,editQuantityTextAlternative:m.string.isRequired,getQuantityDescriptionTextAlternative:m.func.isRequired,addToTrolleyAlternative:m.func.isRequired,quantity:m.string,quantityLabel:m.func,missing:m.string,missingLabel:m.func,unavailableLabel:m.func,substitute:m.string,substituteLabel:m.func,accepted:m.string,acceptedLabel:m.func,rejected:m.string,rejectedLabel:m.func,returned:m.string,returnedLabel:m.func,taxInclusive:m.func})),linkElement:$u(m.func),onImpression:$u(m.func),onClick:m.func,onContextMenu:m.func,type:$u(m.string),svgDefsEnabled:m.bool,hideMoreOptions:m.bool,displayLandscapeLayout:m.bool.isRequired,fopControls:m.element,showMissedPromotions:m.bool,reviewsEnabled:m.bool,configurableFopEnabled:m.bool,page:m.string.isRequired,subPage:m.string,grossPriceEnabled:m.bool,withoutHeader:m.bool,isRegionAgnosticEnabled:m.bool,hideOriginalPriceEnabled:m.bool,referencePriceEnabled:m.bool},upt={orderId:void 0,draftBasketId:void 0,productId:null,product:void 0,position:0,fopPositionOnPage:0,group:void 0,firstInGroup:!1,registerRef:()=>{},onClick:()=>{},onContextMenu:()=>{},currentBreakpoint:null,hideOnViewports:[],fopView:"detail",missedPromotionsEnabled:!1,missedPromotionQuantities:void 0,maxQuantityPerProduct:void 0,noOfferLink:!1,catchWeightSubtextPosition:"post",isSEOReadableURLEnabled:!1,isFixedHeightTitleWithEllipsisFFEnabled:!1,svgDefsEnabled:!1,hideMoreOptions:!1,fopControls:void 0,showMissedPromotions:!1,reviewsEnabled:!1,configurableFopEnabled:!1,subPage:null,pageViewId:null,withoutHeader:!1};class sk extends h.Component{constructor(t){super(t),this.impressionSent=!1,this.updateRef=this.updateRef.bind(this),this.sendImpression=this.sendImpression.bind(this),this.attemptImpression=this.attemptImpression.bind(this),this.generateClusterBreadcrumb=this.generateClusterBreadcrumb.bind(this),this.generateClusterBreadcrumbLink=this.generateClusterBreadcrumbLink.bind(this),this.isInView=0,this.fopRef=null}componentDidMount(){this.updateIntersectionObserver()}componentDidUpdate(t){this.props.currentBreakpoint!==t.currentBreakpoint&&this.updateIntersectionObserver(),this.props.product!==t.product&&!this.impressionSent&&this.attemptImpression()}componentWillUnmount(){this.updateRef(null),this.deleteIntersectionObserver()}deleteIntersectionObserver(){if(this.intersectionObserver){try{this.intersectionObserver.unobserve(this.fopRef.current)}catch{}delete this.intersectionObserver}}updateIntersectionObserver(){const{currentBreakpoint:t}=this.props;if(this.impressionSent)return;const n=["xs","sm","md"].includes(t)?co.v2.sm:co.v2.lgUp;if(this.deleteIntersectionObserver(),typeof window<"u"&&"IntersectionObserver"in window&&(this.intersectionObserver=new window.IntersectionObserver(o=>{this.isInView=o[0].intersectionRatio,this.attemptImpression()},{rootMargin:`-${n}px 0px 0px 0px`,threshold:NG}),this.fopRef))try{this.intersectionObserver.observe(this.fopRef.current)}catch{}}updateRef(t){if(this.unregisterRef&&(this.unregisterRef(),this.unregisterRef=null),t&&t.fopWrapperRef){if(this.fopRef&&this.intersectionObserver)try{this.intersectionObserver.unobserve(this.fopRef.current)}catch{}if(this.fopRef=t.fopWrapperRef,this.intersectionObserver)try{this.intersectionObserver.observe(this.fopRef.current)}catch{}const{productId:n,registerRef:o}=this.props;this.fopRef&&o&&(this.unregisterRef=o(n,this.fopRef.current))}}shouldSendImpression(){const{onImpression:t,product:n}=this.props;return!this.impressionSent&&this.isInView>=NG&&n&&t}attemptImpression(){this.shouldSendImpression()&&setTimeout(this.sendImpression,zut)}sendImpression(){const{onImpression:t}=this.props;this.shouldSendImpression()&&(this.impressionSent=!0,this.deleteIntersectionObserver(),setTimeout(t,10,PG(this.props)))}generateClusterBreadcrumbLink({id:t,fullURLPath:n,retailerCategoryId:o}){const{isSEOReadableURLEnabled:r,isRegionAgnosticEnabled:a}=this.props,i=`source=breadcrumbs&sublocationId=${t}`;if(r){const l=n?.toLowerCase();return Sa(a?o:t,l,{queryString:"source=breadcrumbs"})}return ao({queryString:i})}generateClusterBreadcrumb({id:t,name:n,fullURLPath:o="",retailerCategoryId:r}){return{id:t,name:n,link:this.generateClusterBreadcrumbLink({id:t,fullURLPath:o,retailerCategoryId:r})}}render(){const{type:t,fopView:n,product:o,quantity:r,updateBasketQuantity:a,onClick:i,onContextMenu:l,messages:c,linkElement:d,hideOnViewports:u,position:p,group:g,sendFopProductLinkEvent:E,firstInGroup:y,activeFopNoBackgroundEnabled:I,actions:{setActiveBop:S,analyticsEvent:C,openShoppingListsModal:T,openOutOfStockAlternativesModal:_},dynamicImagesEnabled:A,noOfferLink:R,catchWeightSubtextPosition:P,maxQuantityPerProduct:N,isSEOReadableURLEnabled:k,isRegionAgnosticEnabled:M,svgDefsEnabled:w,outOfStockAlternativesEnabled:j,isFixedHeightTitleWithEllipsisFFEnabled:G,frenchLawEnabled:W,alcoholBlurEnabled:H,configurableFopEnabled:K,hideMoreOptions:X,fopControls:q,displayLandscapeLayout:ne,reviewsEnabled:ue,page:oe,subPage:ye,grossPriceEnabled:he,withoutHeader:Ie,fopPositionOnPage:Fe,hideOriginalPriceEnabled:be,referencePriceEnabled:ce}=this.props,me=()=>{o&&(o.isInCurrentCatalog===!1?Z.info("fop.not.in.current.catalog"):o.productId&&(E(),S(o.productId)))},De={type:t,product:o,quantityInBasket:r,maxQuantityReached:o?o.maxQuantityReached:void 0,maxQuantityPerProduct:N,updateBasketQuantity:a,onClick:i,onContextMenu:l,messages:c,linkElement:d,position:p,group:g,firstInGroup:y,clusterBreadcrumbs:g&&Array.isArray(g.clusterBreadcrumbs)?g.clusterBreadcrumbs.map(this.generateClusterBreadcrumb):[],featured:g&&g.type===Ut.FEATURED,hideOnViewports:o?o.hideOnViewports:u,isOrder:t==="order",showStatus:t==="order"||t==="slotbooking",activeFopNoBackgroundEnabled:I,dynamicImagesEnabled:A,isSEOReadableURLEnabled:k,isRegionAgnosticEnabled:M,displayLandscapeLayout:ne,actions:{moreOptionsClick:()=>{const{productId:Se,retailerProductId:Ae}=this.props.product;C({type:Jt.ELLIPSIS_CLICKED,productId:Se,retailerProductId:Ae}),T({productId:Se,page:oe,productIndex:Fe,section:g.type})},promotionClickedEvent:({promotionId:Se,productId:Ae})=>()=>C({type:Jt.PROMO_LINK_CLICKED,promotionId:Se,productId:Ae}),navigateToPromotionClickedEvent:({itemId:Se,itemName:Ae,index:Ce,promotionId:We,promotionName:et,list:ve})=>()=>{const lt={event:"select_item_promotion",id:Se,name:Ae,index:Ce,promotion_id:We,promotion_name:et,list:ve};return te.sendEvent({GA:lt,WA:null}),C({type:Jt.GA_FOP_PROMO_LINK_CLICKED,itemId:Se,itemName:Ae,index:Ce,promotionId:We,promotionName:et,list:ve})},showSubstitutesClickedEvent:({productId:Se,retailerProductId:Ae,productSequence:Ce,totalCount:We,hideSubstitutes:et,pageEventId:ve})=>{C({type:Jt.SHOW_SUBSTITUTES,pageEventId:ve,productId:Se,retailerProductId:Ae,productSequence:Ce,totalCount:We,hideSubstitutes:et})},breadcrumbsDropdownOnOpen:Se=>()=>C({type:Jt.CLUSTER_EXPANDED,attributes:Se.reduce((Ae,Ce,We)=>(Ae[`categoryIdLevel${We+1}`]=Ce.id,Ae),{})}),breadcrumbsClickAction:(Se,Ae)=>{let Ce={level:Se};Ae&&(Ce={...Ce,categoryId:Ae}),C({type:Jt.BREADCRUMBS_LIST_CLICKED,description:"User clicked breadcrumbs list item",pageEventAttributes:Ce})},timeRestrictionNotification:(Se,Ae)=>{const Ce=o.deliveryTimeRestrictionMessage?{formattedMessage:o.deliveryTimeRestrictionMessage}:{key:"fop.time.restriction.toast",substitutions:{to:Se,from:Ae}};Z.warning(Ce)},maxQuantityReachedNotification:()=>{Z.error("fop.max.quantity.toast.generic")},noAlternativesHandler:()=>{Z.warning("fop.no.alternatives.text.toast")},cannotAddBecauseOutOfStockNotification:()=>{Z.error("fop.oos.toast")}},catchWeightSubtextPosition:P,missedPromotion:PG(this.props),svgDefsEnabled:w,outOfStockAlternativesEnabled:j,frenchLawEnabled:W,hideMoreOptions:X,fopControls:q,reviewsEnabled:ue,configurableFopEnabled:K,isFixedHeightTitleWithEllipsisFFEnabled:G,page:oe,subPage:ye,grossPriceEnabled:he,fopView:n,withoutHeader:Ie,fopPositionOnPage:Fe,alcoholBlurEnabled:H,hideOriginalPriceEnabled:be,referencePriceEnabled:ce};j&&(De.actions={...De.actions,openOutOfStockAlternativesModal:_});const ge={linkAction:me,linkElement:o&&o.isInCurrentCatalog===!1?void 0:d,innerRef:this.updateRef,noOfferLink:R};return n==="grid"?s.jsx(Fm,{...De,...ge}):s.jsx(wm,{...De,...ge})}}sk.propTypes=dpt;sk.defaultProps=upt;const ppt=()=>(e,{product:t,draftBasketId:n})=>{let o,r;return t&&(n?o=Sot(e,t.productId,n):o=xC(e,t.productId),t.offer?.requiredProductQuantity&&(r=JN(e,t.offer.id,t.productId))),{quantity:o,pageViewId:Nn(e),activeFopNoBackgroundEnabled:Xut(e),dynamicImagesEnabled:Qut(e),isSEOReadableURLEnabled:Zut(e),isRegionAgnosticEnabled:Jut(e),isFixedHeightTitleWithEllipsisFFEnabled:lpt(e),missedPromotionsEnabled:ept(e),userLoggedIn:Xe(e),catchWeightSubtextPosition:Ze(e,"catch-weight-subtext-position"),maxQuantityPerProduct:bR(e),outOfStockAlternativesEnabled:tpt(e),frenchLawEnabled:spt(e),reviewsEnabled:npt(e),configurableFopEnabled:opt(e),grossPriceEnabled:rpt(e),alcoholBlurEnabled:cpt(e),hideOriginalPriceEnabled:apt(e),referencePriceEnabled:ipt(e),...r&&{missedPromotionQuantities:r}}},mpt=st({setActiveBop:Ti.setActiveBop,analyticsEvent:U.analyticsEvent,openShoppingListsModal:({productId:e,page:t,section:n,productIndex:o})=>J.openModal("shoppingLists",{productId:e,page:t,section:n,productIndex:o}),openOutOfStockAlternativesModal:({productId:e,productName:t,retailerProductId:n,type:o,pageEventId:r})=>J.openModal(xp,{productId:e,productName:t,retailerProductId:n,type:o,pageEventId:r})}),hpt=we(ppt,mpt)(sk),gpt=e=>{const t=new URLSearchParams(e.search),n=t.get("boolean");t.set("boolean",`${n?`${n},`:""}favoritesOnly`);const o=t?.get("q");return{url:`${e.pathname}?${t?.toString()}`,searchTerm:o}},PZ=({favouritesAmount:e,isNewProductList:t})=>{const{currentBreakpoint:n}=h.useContext(kn),o=Ne(),{formatMessage:r}=L(),{url:a,searchTerm:i}=gpt(o),{correctedSearchTerm:l}=f(Qp),c=ft();h.useEffect(()=>{n&&c({type:ht.SHOW_ALL_FAVORITES_FILTER_BUTTON_IMPRESSION})},[n]);const d=p=>s.jsx(x,{asChild:!0,intent:"secondary",fill:!0,onClick:()=>c({type:ht.SHOW_ALL_FAVORITES_FILTER_BUTTON_CLICKED}),children:s.jsxs(Ye,{intent:"ghost",href:a,children:[s.jsx(x.Icon,{name:"favourites"}),s.jsx(x.Text,{children:r(p)})]})});if(!n)return null;const u=()=>n==="xs"?d("fop.favorite.only.button.text"):s.jsx(Q,{additionalCss:"flex: 1; margin-top: 28px",children:s.jsx(xe,{asChild:!0,children:s.jsx(Ye,{intent:"ghost",href:a,className:"salt-d--flex",onClick:()=>c({type:ht.SHOW_ALL_FAVORITES_FILTER_BUTTON_CLICKED}),children:s.jsxs(Q,{gap:["sm"],direction:"column",justify:"center",children:[s.jsx(pe,{name:"favourites",primary:!0}),s.jsx(O,{bold:!0,size:"l",children:r("favorite.tile.title",{favouritesAmount:e})}),s.jsx(O,{children:r("favorite.tile.description",{searchTerm:l||i})})]})})})});return t?u():s.jsx(pd,{fitContent:!0,children:u()})},Ept=(e,t)=>{const n=[];for(let o=0;o<t.length;o+=1){const r=t.find(a=>a.position===e+o);if(r)n.push(r);else break}return n},fpt=(e,t)=>!!e.length&&e.at(-1).position===t-1,ypt=(e,t)=>{const n=[],o=[];return[...e].sort((r,a)=>r.position-a.position).forEach(r=>{const{position:a}=r;if(a===t||fpt(n,a)){n.push(r);return}a>t&&o.push(r)}),[n,o]},Ipt=({position:e,productCardAdverts:t,isInLastPosition:n})=>n?ypt(t,e):[Ept(e,t),[]],Spt=({data:e})=>e.adverts.categoryPage.fetchError,Cpt=({data:e})=>e.adverts.categoryPage.isFetching,vpt=e=>({data:t})=>t.adverts.categoryPage.placement[e]??[],Tpt=e=>Y(vpt(e),Rpt,Cpt,(t,n,o)=>[t,n,o]),_pt=({data:e})=>e.adverts.categoryPage.placement.withinGrid.find(t=>t.format==="DOUBLE_TILE"||t.format==="MEDIUM_RECTANGLE"||!t.format),bpt=()=>sf("categoryPage"),xpt=({data:e})=>e.adverts.categoryPage.placement.withinGrid.filter(n=>n.format==="PRODUCT_CARD")||[],Apt=({data:e})=>e.adverts.categoryPage.placement.withinGrid.filter(n=>n.format==="SHOPPABLE")||[],Rpt=({data:e})=>e.adverts.categoryPage.settings,Dpt=({data:e})=>e.adverts.searchPage.isFetching,Opt=e=>({data:t})=>t.adverts.searchPage.placement[e]??[],Ppt=e=>Y(Opt(e),Mpt,Dpt,(t,n,o)=>[t,n,o]),Npt=({data:e})=>e.adverts.searchPage.placement.withinGrid.find(t=>t.format==="DOUBLE_TILE"||t.format==="MEDIUM_RECTANGLE"||!t.format),Lpt=()=>sf("searchPage"),kpt=({data:e})=>e.adverts.searchPage.placement.withinGrid.filter(n=>n.format==="PRODUCT_CARD"),jpt=({data:e})=>e.adverts.searchPage.placement.withinGrid.filter(n=>n.format==="SHOPPABLE")||[],Mpt=({data:e})=>e.adverts.searchPage.settings,wpt=({data:e})=>e.adverts.favoritesPage.isFetching,Fpt=({data:e})=>e.adverts.favoritesPage.placement.withinGrid.find(t=>t.format==="DOUBLE_TILE"||t.format==="MEDIUM_RECTANGLE"||!t.format),Bpt=()=>sf("favoritesPage"),Upt=e=>({data:t})=>t.adverts.favoritesPage.placement[e]??[],Gpt=e=>Y(Upt(e),$pt,wpt,(t,n,o)=>[t,n,o]),$pt=({data:e})=>e.adverts.favoritesPage.settings,Hpt=({data:e})=>e.adverts.promotionsPage.isFetching,Vpt=({data:e})=>e.adverts.promotionsPage.placement.withinGrid.find(({format:t})=>t==="DOUBLE_TILE"||t==="MEDIUM_RECTANGLE"||!t),Wpt=()=>sf("promotionsPage"),Ypt=e=>({data:t})=>t.adverts.promotionsPage.placement[e]??[],qpt=e=>Y(Ypt(e),Kpt,Hpt,(t,n,o)=>[t,n,o]),Kpt=({data:e})=>e.adverts.promotionsPage.settings,NZ=({data:e})=>e.adverts.homepage,zpt=({data:e})=>e.adverts.homepage.isFetching,Qpt=e=>({data:t})=>{const[n]=t.adverts.homepage.placement[e];return n||null},Xpt=e=>({data:t})=>t.adverts.homepage.placement[e]||[],Zpt=({data:e})=>e.adverts.homepage.settings,Jpt=Y(Xpt("aboveGrid"),Zpt,(e,t)=>[e.filter(({format:n})=>n==="HORIZONTAL"),t]),emt=({data:e})=>e.adverts.homepage.placement.withinGrid.find(t=>t.format==="DOUBLE_TILE"||t.format==="MEDIUM_RECTANGLE"||!t.format),LG=()=>sf("homepage"),tmt=({data:e})=>e.adverts.homepage.placement.withinGrid.filter(n=>n.format==="PRODUCT_CARD")||[],LZ={categories:bpt,search:Lpt,favorites:Bpt,promotions:Wpt,"logged-in-homepage":LG,"logged-out-homepage":LG},kZ=()=>()=>[!1,!1],smt=(e=0,t=!1)=>{const o=e<3?e:3;return{entry:{type:"DOUBLE_TILE_ADVERT",aligned:t?"RIGHT":"LEFT",indexOnSmallScreen:o,rowIndex:1},columnsOccupancy:2}},nmt=(e=[],t=0,n=!1)=>{const o=t===1,r=smt(e.length,n);let a=n?t-r.columnsOccupancy:0;n&&o&&(a=r.entry.indexOnSmallScreen);const i=e.slice();return i.splice(a,0,r.entry),i},as=(e,t,n)=>{function o(r){const i=f(e)?t:n;return i?s.jsx(i,{...r}):null}return o.fetchData=r=>{let a=e(r.store.getState())?t:n;return a?.WrappedComponent&&(a=a.WrappedComponent),a?.fetchData?a.fetchData(r):Promise.resolve()},o},omt=v.picture`
    display: flex;
    block-size: 100%;
    min-block-size: 0;
`,Ru=({image:e,...t})=>s.jsxs(omt,{children:[s.jsx("source",{srcSet:e.url,type:"image/avif"}),s.jsx("img",{src:e.fallbackUrl||e.url,alt:e.altText,...t})]}),rmt={image:m.shape({url:m.string,altText:m.string})},amt={image:null},imt=v(Ru)`
    display: block;
    object-fit: cover;
    inline-size: 100%;
    block-size: ${$(200)};
    border-radius: var(--salt-radius-default);
`,nk=({image:e})=>e?s.jsx(imt,{"data-test":"recipes-home-banner-image",image:e}):null;nk.propTypes=rmt;nk.defaultProps=amt;const lmt=e=>{const{bold:t,size:n,standalone:o,intent:r,...a}=e;return s.jsx(tt,{intent:"ghost",...a})},cmt=e=>{const{bold:t,size:n,standalone:o,intent:r,...a}=e;return s.jsx(Ye,{intent:"ghost",...a})},dmt=h.forwardRef,umt=dmt((e,t)=>{const{as:n,isSSRNavigation:o,...r}=e;if(n)return s.jsx(Py,{as:n,...r,ref:t});if(o){const{to:a,...i}=r;return s.jsx(Py,{as:lmt,...i,ref:t})}return s.jsx(Py,{as:cmt,...e,ref:t})}),pmt=h.forwardRef((e,t)=>{const{formatMessage:n}=L(),o=n("loading.spinner.label");return s.jsx(Py.Skeleton,{a11yLabel:o,...e,ref:t})}),vs={...umt,Skeleton:pmt},ok="mp",jZ=()=>e=>e(Qy.getRecipesHome()).catch(()=>{}),mmt=(e,t=[])=>n=>n(IQe({searchTerm:e,recipes:t})),Fh=({searchTerm:e,limit:t,offset:n})=>o=>o(P8e({searchTerm:e,limit:t,offset:n})).then(r=>{const{responseData:a}=r.payload;return a?.recipes?.length>0&&o(mmt(e,r.payload.responseData.recipes)),a}).catch(()=>{}),Bm=()=>{const e=F(),t=Me(Nn);return[o=>{const{RECIPE_ID:r,RECIPE_NAME:a,SEQUENCE:i,LIST:l,TOTAL_TIME:c,RECIPE_COLLECTION_ID:d,SERVES:u,GROUP_TYPE:p,GROUP_SEQUENCE:g,isAdvert:E}=o;if(E){const I={event:"view_recipe_card",id:r,name:a,index:i,list:l,total_time:c,...u&&{servings:u}};te.sendEvent({GA:I,WA:null})}else{const I={event:"view_recipe_list",id:r,name:a,index:i,list:l,total_time:c,...d&&{collection_id:d},...u&&{servings:u},...p&&{group_type:p},...(g||g===0)&&{group_sequence:g}};te.sendEvent({GA:I,WA:null})}const y=U.analyticsEvent({type:E?OD:dE,recipeImpression:o,pageViewId:t});e(y)}]},rk=()=>{const e=F(),t=Me(Nn);return[o=>{const r=U.analyticsEvent({type:o.isAdvert?ND:uE,collectionImpression:o,pageViewId:t});e(r);const{RECIPE_COLLECTION_ID:a,RECIPE_COLLECTION_NAME:i,RECIPE_COUNT:l,SEQUENCE:c,LIST:d,GROUP_TYPE:u,GROUP_SEQUENCE:p}=o;if(o.isAdvert){const g={event:"view_recipe_collection_card",id:a,name:i,list:d,index:c};te.sendEvent({GA:g,WA:null})}else{const g={event:"view_recipe_collection_list",id:a,name:i,recipe_count:l,list:d,index:c,...u&&{group_type:u},...(p||p===0)&&{group_sequence:p}};te.sendEvent({GA:g,WA:null})}}]},hmt=v(Wo)`
    border-width: 0;
    min-inline-size: 0;
`,gmt=v(x)`
    border-inline-start: none;
    border-start-start-radius: 0;
    border-end-start-radius: 0;
    inline-size: auto;
`,ak=({id:e,dataTest:t,name:n,searchbuttonText:o,placeholder:r,searchInputRef:a})=>s.jsxs(im,{children:[s.jsx(hmt,{id:e,type:"text",label:r??"",hideLabel:!0,last:!0,ref:a,"data-test":t,name:n,placeholder:r,input:{},meta:{invalid:!1,touched:!1}}),s.jsxs(gmt,{type:"submit","data-test":`${n}-search-button`,intent:"secondary",children:[s.jsx(x.Icon,{name:"search"}),s.jsx(ie,{children:o})]})]}),Li=(e,t,{basePath:n="",queryString:o=""}={})=>L8e(e.toLowerCase(),t,{basePath:n,queryString:o}),ki=(e,t,{basePath:n="",queryString:o=""}={})=>p8(e.toLowerCase(),t,{basePath:n,queryString:o}),AS=(e,t,{basePath:n="",queryString:o=""}={})=>k8e(e.toLowerCase(),t,{basePath:n,queryString:o}),ik=v.div`
    max-inline-size: 24em;
`,df=v.div`
    border-radius: var(--salt-radius-default);
    transition: box-shadow 0.2s;
    background-color: var(--intent-contrast);

    &:hover {
        box-shadow: var(--salt-elevation-shadow-1);
    }

    overflow: hidden;
    border: none;
    padding: 0;
`,Emt=v.div`
    position: relative;
`,fmt=v(Ye)`
    inline-size: 100%;
    text-decoration: none;

    &:hover {
        text-decoration: none;
    }

    &:active {
        text-decoration: none;
    }
`,ymt=v.div`
    inline-size: 100%;
    block-size: 100%;
    background-color: var(--intent-secondary-200);
`,Imt=v.div`
    inline-size: 100%;
    block-size: ${$(160)};

    ${({$responsiveHeight:e})=>e?Pe`
                  ${re.smUp`
                    height: ${$(200)};
                  `};
              `:""}
`,Smt=v(Ru)`
    display: block;
    object-fit: cover;
    object-position: 50% 50%;
    inline-size: 100%;
    block-size: 100%;
`,Cmt=v.div`
    block-size: ${$(40)};
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    word-break: break-word;
    @supports (-webkit-line-clamp: 2) {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: initial;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: block-axis;
    }
`,vmt={servings:{number:void 0},collectionId:void 0,collectionTitle:void 0,collectionSlug:void 0,searchTerm:void 0,fromCollectionsPage:!1,fromSavedRecipes:!1,groupName:void 0,groupType:void 0,groupSequence:void 0,onQueueRecipeImpression:()=>null,responsiveImageHeight:!0},Bl=({recipeId:e,title:t,slug:n,image:o,totalTimeMinutes:r,servings:a,collectionId:i,collectionTitle:l,collectionSlug:c,searchTerm:d,fromCollectionsPage:u,fromSavedRecipes:p,groupName:g,groupType:E,groupSequence:y,sequence:I,list:S,onQueueRecipeImpression:C,responsiveImageHeight:T,skipLinkId:_})=>{const A=L(),R=mf(),P=ft(),N=ct(),k=()=>{P({type:DD,pageEventId:N,RECIPE_ID:e,RECIPE_NAME:t,TOTAL_TIME:r,INDEX:I,LIST:`${S}: ${g||"other"}`,...i&&{RECIPE_COLLECTION_ID:i},...a?.number&&{SERVINGS:a?.number},...g&&{GROUP_NAME:g},...E&&{GROUP_TYPE:E},...(y||y===0)&&{GROUP_SEQUENCE:y}});const H={event:"select_recipe",id:e,name:t,collection_id:i,servings:a?.number,total_time:r,index:I,list:`${S}: ${g||"other"}`};te.sendEvent({GA:H,WA:null})},w=Um(([H],K)=>{H?.isIntersecting&&(C({RECIPE_ID:e,...i&&{RECIPE_COLLECTION_ID:i},RECIPE_NAME:t,...l&&{RECIPE_COLLECTION_NAME:l},SEQUENCE:I,TOTAL_TIME:r,LIST:`${S}: ${g||"other"}`,...a?.number&&{SERVES:a.number},...g&&{GROUP_NAME:g},...E&&{GROUP_TYPE:E},...(y||y===0)&&{GROUP_SEQUENCE:y}}),K.unobserve(H.target))},{root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5}),j={...d?{searchTerm:d}:{},...i?{collectionId:i}:{},...u?{fromCollectionsPage:u.toString()}:{},...p?{fromSavedRecipes:p.toString()}:{}},G=new URLSearchParams(j),W=os({breakpoint:"sm-up"});return s.jsx(Emt,{ref:w,children:s.jsx(fmt,{state:{recipeCardClickedInMobile:W,title:t,image:o,totalTimeMinutes:r,servings:a,collectionTitle:l,collectionSlug:c,sourceEventId:N},to:{pathname:ki(n,e),search:G.toString()},onClick:k,"data-test":"recipe-card",id:_,children:s.jsxs(df,{children:[s.jsx(Imt,{$responsiveHeight:T,children:o?s.jsx(Smt,{image:o,"aria-hidden":"true"}):s.jsx(ymt,{})}),s.jsxs("div",{className:"salt-p--2",children:[s.jsx(Cmt,{children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{role:E===ig.RECIPE_ASSISTANT?"presentation":void 0,children:t})})}),s.jsxs(Q,{justify:"space-between",align:"center",className:"salt-m-t--2",children:[s.jsxs(Q,{align:"center","data-test":"recipe-card-total-time-minutes",children:[s.jsx(pe,{name:"total_time",height:18,width:18,"aria-hidden":"true"}),s.jsxs(ie,{children:[A.formatMessage("recipe.details.totalTime"),": "]}),s.jsx(O,{className:"salt-m-l--1",children:R(r)})]}),a?.number&&s.jsxs(Q,{align:"center","data-test":"recipe-card-servings",children:[s.jsx(pe,{name:"servings",height:18,width:18,"aria-hidden":"true"}),s.jsxs(ie,{children:[A.formatMessage("recipe.details.servings"),": "]}),s.jsx(O,{className:"salt-m-l--1",children:a.number})]})]})]})]})})})};Bl.displayName="RecipeCard";Bl.defaultProps=vmt;const Tmt=e=>"to"in e&&!!e.to,_mt=e=>!!e.onClick&&!("to"in e)&&!("href"in e),bmt=e=>_mt(e)?s.jsx(xx.HeaderButton,{...e}):s.jsx(xx.HeaderButton,{asChild:!0,children:Tmt(e)?s.jsx(Ye,{intent:"ghost",...e}):s.jsx(tt,{intent:"ghost",...e})}),to={...xx,HeaderButton:bmt},xmt=v.div`
    inline-size: 160px;
`,Amt=({entityId:e,onQueueRecipeImpression:t,groupSequence:n})=>{const o=L(),a=Me(GE).find(({id:l})=>l===e)?.recipes;if(!a?.length)return null;const i=o.formatMessage("recipe.savedRecipes.title");return s.jsx(to,{title:s.jsx(to.Title,{children:i}),headerButton:s.jsx(to.HeaderButton,{to:m8(),"aria-label":o.formatMessage("recipe.seeAllSavedRecipes"),children:o.formatMessage("scroller.seeAll.button")}),"data-test":"saved-recipes",a11y:{labels:{"next-button":o.formatMessage("scroller.accessibility.viewNextIn",{title:i}),"previous-button":o.formatMessage("scroller.accessibility.viewPreviousIn",{title:i})}},children:a.map((l,c)=>s.jsx(xmt,{children:s.jsx(Bl,{sequence:c,responsiveImageHeight:!1,list:Xo.RecipeHome,groupName:"Saved",groupSequence:n,groupType:ig.SAVED_RECIPES,onQueueRecipeImpression:t,...l},l.recipeId)}))})},Rmt=v.div`
    display: grid;
`,GT=()=>s.jsx(Rmt,{children:s.jsx(RO,{isLoading:!0,showContentPlaceholder:!0,formatting:"small",variant:"fullImage"})});GT.displayName="CollectionLoadingCard";const Dmt=3,MZ=()=>s.jsxs("div",{"data-test":"recipes-collection-group-skeleton",children:[s.jsx(_e,{height:"34px",width:"40%",className:"salt-m-b--4"}),s.jsx(_e,{height:"23px",width:"100%",className:"salt-m-b--4"}),s.jsx(Oe.MediaCardCollection,{"data-test":"media-card-collection-skeleton",formatting:"small",gridVariant:"auto-fill",children:[...Array(Dmt).keys()].map(e=>s.jsx(GT,{},`recipe-collection-skeleton-${e}`))})]}),Omt=({isFetching:e,entityId:t,onQueueRecipeImpression:n,groupSequence:o})=>e?s.jsx(MZ,{}):s.jsx(Amt,{entityId:t,groupSequence:o,onQueueRecipeImpression:n},t),Pmt={image:void 0,collectionPath:void 0,groupName:void 0,groupType:void 0,groupSequence:void 0,list:void 0,isLoading:!1},Nmt=v.div`
    display: grid;
`,Lmt=v(RO)`
    ${({fullWidth:e})=>e?"max-width: none;":""};
`,uf=({collectionId:e,image:t,title:n,collectionPath:o,numberOfRecipes:r,groupName:a,groupType:i,groupSequence:l,sequence:c,list:d,onQueueCollectionImpression:u,fullWidth:p=!1,navigationCardRef:g})=>{const E=F(),{formatMessage:y}=L(),I=()=>{const T=U.analyticsEvent({type:MC,RECIPE_COLLECTION_ID:e,RECIPE_COLLECTION_NAME:n,RECIPE_COUNT:r,INDEX:c,LIST:`${d}: ${a||"other"}`,...a&&{GROUP_NAME:a},...i&&{GROUP_TYPE:i},...(l||l===0)&&{GROUP_SEQUENCE:l}});E(T);const _={event:"select_recipe_collection",id:e,name:n,recipe_count:r,list:`${d}: ${a||"other"}`,index:c};te.sendEvent({GA:_,WA:null})},C=Um(([T],_)=>{T?.isIntersecting&&(u({RECIPE_COLLECTION_ID:e,RECIPE_COLLECTION_NAME:n,RECIPE_COUNT:r,SEQUENCE:c,LIST:`${d}: ${a||"other"}`,...a&&{GROUP_NAME:a},...i&&{GROUP_TYPE:i},...(l||l===0)&&{GROUP_SEQUENCE:l}}),_.unobserve(T.target))},{root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5});return s.jsx(Nmt,{ref:C,"data-test":`collection-card-${e}`,children:s.jsx(Lmt,{ref:g,formatting:"small",variant:"fullImage",title:n,fallbackSrc:t?.fallbackUrl??t?.url,typeSrcSet:t&&{"image/avif":t.url},alt:t?.altText,to:o,content:y("recipe.count",{numberOfRecipes:r}),onClick:I,truncateTitle:!0,fullWidth:p})})};uf.displayName="CollectionCard";uf.defaultProps=Pmt;const lk=v(ee).attrs(()=>({forwardedAs:"h2",as:""}))`
    word-break: break-word;
`,kmt={entityId:m.string.isRequired,groupSequence:m.number,onQueueCollectionImpression:m.func,onQueueRecipeImpression:m.func},jmt={groupSequence:0,onQueueCollectionImpression:()=>null,onQueueRecipeImpression:()=>null},Mmt={xs:6,md:4,lg:6},ck=({entityId:e,groupSequence:t,onQueueCollectionImpression:n,onQueueRecipeImpression:o})=>{const r=f(E=>E.router.location.search),i=f(E=>GE(E))?.find(E=>E.id===e);if(!i)return null;const{title:l,description:c,collections:d,recipes:u}=i;if(!d||d.length===0||!u||u.length===0)return null;const p=d[0],g=`${Li(p.slug,p.collectionId)}${r}`;return s.jsxs("div",{"data-test":"recipes-expanded-collection",children:[s.jsx(lk,{size:"s","data-test":"recipes-expanded-collection-title",className:"salt-m-b--2",children:l}),s.jsx(O,{asChild:!0,size:"l","data-test":"recipes-expanded-collection-description",className:"salt-m-b--4",children:s.jsx("div",{children:c})}),s.jsxs(V,{flush:!0,children:[s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeList.ariaLabel"})}),s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{children:u.map((E,y)=>s.jsx(V.Item,{asChild:!0,colSpan:Mmt,children:s.jsx("li",{children:s.jsx(Bl,{groupName:l,groupType:"EXPANDED_COLLECTION",groupSequence:t,sequence:y,list:Xo.RecipeHome,onQueueRecipeImpression:o,collectionId:p.collectionId,collectionTitle:p.title,collectionSlug:p.slug,...E})})},E.recipeId))})})}),s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(uf,{collectionId:p.collectionId,image:p.image,title:p.title,collectionPath:g,numberOfRecipes:p.numberOfRecipes,groupName:l,groupType:"EXPANDED_COLLECTION",groupSequence:t,list:Xo.RecipeHome,sequence:0,onQueueCollectionImpression:n,fullWidth:!0},p.collectionId)})]})]})};ck.propTypes=kmt;ck.defaultProps=jmt;const wmt={entityId:m.string.isRequired,groupSequence:m.number,onQueueCollectionImpression:m.func},Fmt={groupSequence:0,onQueueCollectionImpression:()=>null},dk=({entityId:e,groupSequence:t,onQueueCollectionImpression:n})=>{const o=f(d=>d.router.location.search),a=f(d=>GE(d))?.find(d=>d.id===e);if(!a)return null;const{title:i,description:l,collections:c}=a;return!c||c.length===0?null:s.jsxs("div",{"data-test":"recipe-collection-group",children:[s.jsx(lk,{size:"s","data-test":"recipe-collection-group-title",className:"salt-m-b--2",children:i}),s.jsx(O,{asChild:!0,size:"l","data-test":"recipe-collection-group-description",className:"salt-m-b--4",children:s.jsx("div",{children:l})}),c&&c.length>0&&s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeCollectionList.ariaLabel"})}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{"data-test":"media-card-collection",children:c.map((d,u)=>{const p=`${Li(d.slug,d.collectionId)}${o}`;return s.jsx(V.Item,{asChild:!0,colSpan:{xs:12,md:6,lg:4},children:s.jsx("li",{children:s.jsx(uf,{collectionId:d.collectionId,"data-test":"collection-media-navigation-card",image:d.image,title:d.title,collectionPath:p,numberOfRecipes:d.numberOfRecipes,groupName:i,groupType:"COLLECTION_GROUP",groupSequence:t,sequence:u,list:Xo.RecipeHome,onQueueCollectionImpression:n},d.collectionId)})})})})})]})]})};dk.propTypes=wmt;dk.defaultProps=Fmt;const Bmt={entityId:m.string.isRequired,groupSequence:m.number,onQueueRecipeImpression:m.func},Umt={groupSequence:0,onQueueRecipeImpression:()=>null},Gmt={xs:6,md:4,lg:3},uk=({entityId:e,groupSequence:t,onQueueRecipeImpression:n})=>{const r=f(c=>GE(c))?.find(c=>c.id===e),{title:a,description:i,recipes:l}=r;return s.jsxs("div",{"data-test":"recipes-home-page-recipe-group",children:[s.jsx(lk,{size:"s",className:"salt-m-b--2",children:a}),i&&s.jsx(O,{asChild:!0,size:"l",className:"salt-m-b--4",children:s.jsx("div",{children:i})}),s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeList.ariaLabel"})}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{children:l?.map((c,d)=>s.jsx(V.Item,{asChild:!0,colSpan:Gmt,children:s.jsx("li",{children:s.jsx(Bl,{groupName:a,groupType:"RECIPE_GROUP",groupSequence:t,sequence:d,list:Xo.RecipeHome,onQueueRecipeImpression:n,...c})})},c.recipeId))})})]})};uk.propTypes=Bmt;uk.defaultProps=Umt;const $mt={recipesHomeDetailsData:m.shape({seo:m.shape({metaTitle:m.string,metaDescription:m.string})}).isRequired},wZ=({recipesHomeDetailsData:e})=>{const{seo:t}=e;return s.jsxs(Gn,{children:[t?.metaTitle&&s.jsx("title",{children:t.metaTitle}),t?.metaDescription&&s.jsx("meta",{name:"description",content:t.metaDescription})]})};wZ.propTypes=$mt;const Hmt=v.div`
    inline-size: 100%;
`,Vmt=v.div`
    inline-size: 100%;
    block-size: ${$(160)};
    ${re.smUp`
        height: ${$(200)};
    `};
`,Hd=()=>s.jsx(Hmt,{"data-test":"recipe-card-skeleton",children:s.jsxs(df,{children:[s.jsx(Vmt,{children:s.jsx(_e,{"data-test":"recipe-card-skeleton-image",height:"100%",width:"100%"})}),s.jsxs("div",{className:"salt-p--2",children:[s.jsx(_e,{"data-test":"recipe-card-skeleton-title-1",height:"23px"}),s.jsx(_e,{"data-test":"recipe-card-skeleton-title-2",height:"23px",width:"140px",className:"salt-m-t--1"}),s.jsxs(Q,{className:"salt-m-t--1",children:[s.jsx(_e,{height:"20px",width:"20px",className:"salt-m-r--1"}),s.jsx(_e,{"data-test":"recipe-card-skeleton-content",height:"20px",width:"80px"})]})]})]})});Hd.displayName="RecipeLoadingCard";const Wmt={xs:6,md:4,lg:3},Ymt=()=>s.jsxs("div",{"data-test":"recipes-home-recipe-group-skeleton",children:[s.jsx(_e,{"data-test":"recipes-home-recipe-group-title-placeholder",height:"34px",width:"40%",className:"salt-m-b--4"}),s.jsx(_e,{"data-test":"recipes-home-recipe-group-description-placeholder",height:"23px",width:"100%",className:"salt-m-b--4"}),s.jsx(V,{children:[...Array(4).keys()].map(e=>s.jsx(V.Item,{colSpan:Wmt,children:s.jsx(Hd,{})},e))})]}),qmt=4,Kmt={xs:6,md:4,lg:6},zmt=()=>s.jsxs("div",{"data-test":"recipes-expanded-collection-skeleton",children:[s.jsx(_e,{height:"34px",width:"40%",className:"salt-m-b--4"}),s.jsx(_e,{height:"23px",width:"100%",className:"salt-m-b--4"}),s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(V,{fluid:!0,children:[...Array(qmt).keys()].map(e=>s.jsx(V.Item,{role:"listitem",...Kmt,children:s.jsx(Hd,{})},e))})}),s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(GT,{})})]})]}),Qmt=({searchText:e})=>s.jsxs(ae.Fragment,{children:[s.jsx(_e,{height:"50px",width:"40%",className:"salt-m-t--4"}),s.jsx(_e,{height:"144px"}),s.jsx(ak,{id:"recipeHomePageSearch",name:"recipeSearch",placeholder:e,dataTest:"recipes-home-recipe-search-skeleton",searchbuttonText:e}),s.jsx(Ymt,{}),s.jsx(MZ,{}),s.jsx(zmt,{})]}),$T=()=>"/meal-plan",FZ=()=>"/meals",Xmt=v(xe)`
    align-items: center;
`,Zmt=({onClick:e})=>{const{formatMessage:t}=L();return s.jsxs(Xmt,{className:"salt-d--flex",children:[s.jsx(O,{children:t("mealplanning.entry-point.recipes.title")}),s.jsx(x,{onClick:e,intent:"secondary",size:"s",className:"salt-m-l--auto",asChild:!0,children:s.jsx(Ye,{to:$T(),intent:"ghost",children:t("mealplanning.entry-point.recipes.button")})})]})},Jmt=()=>{const{formatMessage:e}=L(),t=ws(),n=h.useRef(null),o=Ge(),r=iJ();aJ(n);const a=Me(Rt),i=Me(D8e),l=Me(O8e),c=Me(D(ok)),d=Me(GE),[u]=Bm(),[p]=rk(),g=e("recipe.search"),E=e("recipe.browseCollection.label"),y=e("recipe.browseCollection.description"),I=T=>{T.preventDefault();const{currentTarget:_}=T,A=_.elements.namedItem("recipeHomePageSearch").value;A?.trim()&&(o(gS({queryString:ps.stringify({searchTerm:A})})),t(Fh({searchTerm:A})).then(R=>{r(A,R?.totalRecipes)}))},S=()=>{const T=U.analyticsEvent({type:YW});t(T)},C=()=>{const T=U.analyticsEvent({type:eY});t(T)};return h.useEffect(()=>{!a&&!i.isFetching&&t(jZ())},[]),i.fetchError&&i?.error?.statusCode===404?s.jsx(ot,{}):i.fetchError?s.jsx(jn,{showRefreshLink:!0}):i.isFetching&&!i.data.homePageEntities.length?s.jsx("div",{className:"salt-m-x--4 salt-p-t--4",children:s.jsx(V,{fixed:!0,flush:!0,children:s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Q,{direction:"column",wrap:"nowrap",gap:["lg"],children:s.jsx(Qmt,{searchText:g})})})})}):s.jsxs("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"recipes-home-page",children:[i.data&&s.jsx(wZ,{recipesHomeDetailsData:i.data}),s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"recipes.breadcrumb.recipesHomePage"})})}),l?.url&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(nk,{image:l})}),c&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Zmt,{onClick:C})}),s.jsx(V.Item,{id:"recipeSearch",colSpan:{xs:12},children:s.jsx("form",{onSubmit:I,children:s.jsx(ak,{id:"recipeHomePageSearch",name:"recipeSearch",searchbuttonText:g,placeholder:g,searchInputRef:n})})}),d?.length>0&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Q,{direction:"column",wrap:"nowrap",gap:["lg"],children:d.map(({id:T,type:_},A)=>{switch(_){case"RECIPE_GROUP":return s.jsx(uk,{entityId:T,groupSequence:A,onQueueRecipeImpression:u},T);case"COLLECTION_GROUP":return s.jsx(dk,{entityId:T,groupSequence:A,onQueueCollectionImpression:p},T);case"EXPANDED_COLLECTION":return s.jsx(ck,{entityId:T,groupSequence:A,onQueueRecipeImpression:u,onQueueCollectionImpression:p},T);case"SAVED_RECIPES":return s.jsx(Omt,{isFetching:i.isFetching,entityId:T,groupSequence:A,onQueueRecipeImpression:u},T);default:return null}})})}),s.jsx(V.Item,{colSpan:{xs:12,lg:6},className:"salt-p-t--8",children:s.jsx(vs,{"data-test":"browse-collections-card",title:{text:E,as:"h3"},description:y,icon:"view_list",onClick:S,to:Td()})})]})]})},BZ=()=>s.jsx(Et,{type:"Recipes-RecipesHome::route",children:s.jsx(Jmt,{})});BZ.fetchData=async({store:e})=>(await e.dispatch(jZ()),Promise.resolve());const UZ=({recipeCollectionId:e,recipeId:t})=>async(n,o)=>{try{const r=o(),a=Rt(r),i=await n(_N.getRecipeDetails({recipeCollectionId:e,recipeId:t}));return a&&n(M8e(t)),i}catch{}},eht=({recipeId:e})=>async t=>{try{await t(_N.saveRecipe(e)),Z.success("recipe.details.saveRecipe.toast.saved"),t(ld.clear())}catch{Z.error("toast.notification.generic.error")}},tht=({recipeId:e})=>async t=>{try{await t(_N.unsaveRecipe(e)),Z.info("recipe.details.saveRecipe.toast.unsaved"),t(ld.clear())}catch{Z.error("toast.notification.generic.error")}},sht=v.div`
    overflow: hidden;
    display: ${({$expanded:e})=>e?"block":"-webkit-box"};
    -webkit-line-clamp: ${({$visibleLines:e})=>e};
    -webkit-box-orient: block-axis;

    ${re.mdUp`
        -webkit-line-clamp: ${({$visibleLinesMdUp:e})=>e};
    `}
`,GZ=({heading:e,visibleLines:t=2,visibleLinesMdUp:n=7,children:o})=>{const{formatMessage:r}=L(),a=h.useRef(null),[i,l]=h.useState(!1),[c,d]=h.useState(!1);return h.useLayoutEffect(()=>{if(!a.current)return;const{clientHeight:u,scrollHeight:p}=a.current;d(u<p)},[]),s.jsxs(Je,{expanded:i,onToggle:()=>l(u=>!u),aria:{expandedLabel:r("recipe.description.expand"),collapsedLabel:r("recipe.description.hide")},children:[s.jsxs(Je.ControlSection,{children:[e,c&&s.jsx(Je.ToggleSwitch,{})]}),s.jsx(sht,{className:"salt-m-t--2",ref:a,$expanded:i,$visibleLines:t,$visibleLinesMdUp:n,"data-test":"expandable-text-wrapper",children:o})]})},nht=e=>s.jsx("span",{...e}),$Z=({title:e,className:t})=>s.jsx(ee,{as:nht,"data-test":"recipe-intro-title",className:t,children:e}),oht=()=>{const e=L(),t=Me($8e),n=Me(H8e),o=Me(V8e),r=Me(W8e);return s.jsxs(ae.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:t})}),s.jsxs(GZ,{heading:t?s.jsx($Z,{title:t}):null,visibleLines:4,visibleLinesMdUp:6,children:[o&&s.jsx(O,{asChild:!0,"data-test":"recipe-intro-author",className:"salt-m-b--1",children:s.jsx("div",{children:e.formatMessage("recipe.details.author.prefix",{authorName:o.name})})}),r&&s.jsx(O,{asChild:!0,className:"salt-m-b--2",children:s.jsx("div",{children:e.formatMessage("recipe.details.published.prefix",{publishedDate:e.formatDate(r,{year:"numeric",month:"long",day:"2-digit"})})})}),s.jsx(O,{"data-test":"recipe-intro-desc",children:n})]})]})},rht=v(Ru)`
    display: block;
    object-fit: cover;
    border-radius: var(--salt-radius-default);
    block-size: 100%;
    inline-size: 100%;
`,aht=v.div`
    block-size: 100%;
    background-color: var(--intent-secondary-200);
`,kG=({image:e})=>e?s.jsx(rht,{"data-test":"recipe-image",image:e}):s.jsx(aht,{}),HZ=v.div`
    flex-basis: calc(50% - var(--salt-spacing-1));
`,HT=({iconName:e,metric:t,description:n,"data-test":o})=>s.jsx(HZ,{children:s.jsx(xe,{asChild:!0,"data-test":o,"aria-labelledby":o,children:s.jsx("section",{children:s.jsxs(Q,{align:"baseline",children:[s.jsx("div",{className:"salt-m-r--2","aria-hidden":"true",children:s.jsx(pe,{verticalAlign:"sub",name:e})}),s.jsxs(Q,{direction:"column",children:[s.jsx(ee,{as:"span",children:t}),s.jsx(O,{id:o,children:n})]})]})})})}),iht=()=>{const e=L(),t=mf(),n=Me(eQe);return typeof n!="number"?null:s.jsx(HT,{"data-test":"recipe-metrics-cookingtime",iconName:"optional_time",metric:t(n),description:e.formatMessage("recipe.details.cookingTime")})},lht=()=>{const e=L(),t=mf(),n=Me(J8e);return typeof n!="number"?null:s.jsx(HT,{"data-test":"recipe-metrics-preptime",iconName:"optional_time",metric:t(n),description:e.formatMessage("recipe.details.prepTime")})},VZ=({servings:e})=>{const t=L(),n=typeof e?.number!="number",o=typeof e?.caloriesPer!="number";return n?null:s.jsx(HT,{"data-test":"recipe-metrics-servings",iconName:"servings",metric:o?t.formatNumber(e?.number):t.formatMessage("recipe.details.serves",{servings:e.number}),description:o?t.formatMessage("recipe.details.servings"):t.formatMessage("recipe.details.caloriesPerServing",{calories:e.caloriesPer})})},WZ=({totalTimeMinutes:e})=>{const t=L(),n=mf();return s.jsx(HT,{"data-test":"recipe-metrics-totaltime",iconName:"total_time",metric:n(e),description:t.formatMessage("recipe.details.totalTime")})},cht=()=>{const e=L(),t=Me(Z8e),n=Me(X8e);return s.jsxs("div",{className:"salt-m-t--2 sm:salt-m-t--4",children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:e.formatMessage("recipe.details.metrics.header")})}),s.jsxs(Q,{gap:["sm","sm"],gapSmUp:["md","sm"],children:[typeof t<"u"&&s.jsx(WZ,{totalTimeMinutes:t}),typeof n<"u"&&s.jsx(VZ,{servings:n}),s.jsx(lht,{}),s.jsx(iht,{})]})]})},dht=({searchTerm:e,fromCollectionsPage:t,fromSavedRecipes:n,recipeName:o})=>{const r=L(),a=F(),{recipeSlug:i,recipeId:l}=nn(),c=Me(Y8e),d=()=>{const p=U.analyticsEvent({type:RD,RECIPE_ID:l,RECIPE_NAME:o});a(p);const g={event:"recipe_shop_for_ingredients_click",id:l,name:o||""};te.sendEvent({GA:g,WA:null})},u=new URLSearchParams({...e?{searchTerm:e}:{},...c?{collectionId:c}:{},...t?{fromCollectionsPage:t.toString()}:{},...n?{fromSavedRecipes:n.toString()}:{}});return s.jsx(x,{intent:"primary",fill:!0,asChild:!0,"data-test":"recipe-ingredients-button",onClick:d,children:s.jsx(Ye,{intent:"ghost",to:AS(i,l,{queryString:u.toString()}),rel:"nofollow",children:s.jsx(x.Text,{children:r.formatMessage("recipe.details.shopForIngredients.link")})})})},uht=v(ee).attrs(()=>({forwardedAs:"h2",as:""}))`
    display: inline-block;
`,pht=({method:e})=>e?.length?s.jsx(ae.Fragment,{children:e.map(({methodGroupName:t,methodGroupSteps:n},o)=>s.jsxs("div",{className:e.length-1===o?void 0:"salt-m-b--8",children:[s.jsx(ee,{as:"h3",className:"salt-m-b--4",children:t}),s.jsx(YZ,{steps:n,isWithinMethodGroup:!0})]},t))}):null,YZ=({steps:e,isWithinMethodGroup:t})=>e?.length?s.jsx(Be,{as:"ol",inline:!1,children:e?.map(({text:n},o)=>{const r=s.jsx(b,{id:"recipe.details.methodStep",values:{stepNumber:o+1}});return s.jsx(Be.Item,{children:s.jsxs("div",{className:e.length-1===o?void 0:"salt-m-b--4",children:[s.jsx(O,{asChild:!0,bold:!0,size:"m",className:"salt-m-b--1",children:t?s.jsx("h4",{children:r}):s.jsx("h3",{children:r})}),s.jsx(O,{"data-test":"recipe-method-step",children:n})]},n)},`method-step-${n}`)})}):null,mht=()=>{const e=Me(z8e),t=h.useMemo(()=>e?.flatMap(({methodGroupSteps:o})=>o)?.length||0,[e]),n=h.useMemo(()=>e?.length?e.length>1?s.jsx(pht,{method:e}):s.jsx(YZ,{steps:e[0].methodGroupSteps}):null,[e]);return s.jsxs(xe,{children:[s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx(uht,{size:"m",className:"salt-m-r--2",children:s.jsx(b,{id:"recipe.details.method.heading"})}),t>0&&s.jsx(O,{"aria-hidden":e?.length===1,size:"l",children:s.jsx(b,{id:"recipe.details.method.totalSteps",values:{numberOfSteps:t}})})]}),n]})},hht=v(ee).attrs(()=>({forwardedAs:"h2",as:""}))`
    display: inline-block;
`,ght=()=>{const e=Me(Q8e),t=h.useMemo(()=>{if(!e)return null;const n=e.map(({displayString:o})=>s.jsx(Be.Item,{children:o},o));return s.jsx(Be,{inline:!1,children:n})},[e]);return e?s.jsxs(xe,{"data-test":"recipe-ingredients",children:[s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx(hht,{size:"s",className:"salt-m-r--2",children:s.jsx(b,{id:"recipe.details.ingredients.heading"})}),e?.length>0&&s.jsx(O,{"aria-hidden":"true",size:"l",children:s.jsx(b,{id:"recipe.details.ingredients.totalIngredients",values:{numberOfIngredients:e.length}})})]}),t]}):null},qZ=e=>e.map(t=>({"@type":"HowToStep",text:t.text})),Eht=e=>e.map(t=>({"@type":"HowToSection",name:t.methodGroupName,itemListElement:qZ(t.methodGroupSteps)})),jG=({recipeData:e})=>{const{recipeId:t,slug:n,method:o,seo:r,canonicalUrl:a,localisedSeo:i}=e,l=Me(Ms),c=Me(S=>Ze(S,"default-locale")),d=Me(At)||"",p=`https://${Me(SC)}${d}`,g=h.useMemo(()=>{const S=o?.length||0;return S?S>1?Eht(o):qZ(o[0].methodGroupSteps):null},[o]),E=h.useMemo(()=>{const{author:S,cookingTimeMinutes:C,description:T,image:_,ingredients:A,prepTimeMinutes:R,publishedDate:P,servings:N,structuredDataCategory:k,structuredDataKeywords:M,title:w,totalTimeMinutes:j}=e,G={"@context":"https://schema.org/","@type":"Recipe",name:w,description:T,image:[_.fallbackUrl||_.url],author:{"@type":S.type,name:S.name},datePublished:P,totalTime:`PT${j}M`,recipeIngredient:A?.map(({displayString:W})=>W),recipeInstructions:g};return R&&(G.prepTime=`PT${R}M`),C&&(G.cookTime=`PT${C}M`),M&&(G.keywords=M.join(", ")),k&&(G.recipeCategory=k),N?.number&&(G.recipeYield=N.number),N?.caloriesPer&&N?.number&&(G.nutrition={"@type":"NutritionInformation",calories:N.caloriesPer}),JSON.stringify(G)},[e]),y=h.useMemo(()=>{const S=i?.slug;return!S||typeof S!="object"?null:Object.keys(S).filter(C=>C!==l).map(C=>{const T=S[C],A=(i?.canonicalUrl||{})[C];return s.jsx("link",{rel:"alternate",hrefLang:C,href:Sh(ki(T,t,{basePath:p,queryString:""}),C,A)},C)})},[t,i]),I=Sh(ki(n,t,{basePath:p,queryString:""}),l!==c?l:null,a);return s.jsxs(Gn,{children:[s.jsx("meta",{property:"og:title",content:e.title}),s.jsx("meta",{property:"og:image",content:e.image.url}),s.jsx("meta",{property:"og:description",content:e.description}),s.jsx("meta",{property:"og:url",content:I}),r?.noIndex&&s.jsx("meta",{name:"robots",content:"noindex"}),r?.metaTitle&&s.jsx("title",{children:r.metaTitle}),r?.metaDescription&&s.jsx("meta",{name:"description",content:r.metaDescription}),r?.metaKeywords?.length>0&&s.jsx("meta",{name:"keywords",content:r.metaKeywords.join(",")}),s.jsx("link",{rel:"canonical",href:I}),y,s.jsx("script",{"data-test":"recipe-structured-data",type:"application/ld+json",children:E})]})},MG=()=>{const e=L().formatMessage("recipe.details.footer"),t=!!e&&e.trim();return t?s.jsx(xe,{"data-test":"recipe-footer-box",className:"salt-m-t--2 sm:salt-m-t--4",children:t}):null},fht=()=>s.jsx(_e,{"data-test":"recipe-details-image-skeleton",height:"100%"}),yht=({title:e})=>s.jsxs(xe,{"data-test":"recipe-details-intro-skeleton",children:[e?s.jsx($Z,{className:"salt-m-b--2 salt-d--inline-block",title:e}):s.jsx(_e,{height:"24px",className:"salt-m-b--2"}),s.jsx(fe.Skeleton,{})]}),Iht=()=>s.jsxs(xe,{"data-test":"recipe-details-ingredients-skeleton",children:[s.jsx(js.Skeleton,{}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(fe.Skeleton,{})})]}),Sht=()=>s.jsxs(xe,{"data-test":"recipe-details-method-skeleton",children:[s.jsx(js.Skeleton,{}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(fe.Skeleton,{})}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(fe.Skeleton,{})}),s.jsxs("div",{className:"salt-m-t--4",children:[s.jsx(js.Skeleton,{}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(fe.Skeleton,{})})]})]}),Iy=()=>s.jsx(HZ,{children:s.jsxs(xe,{children:[s.jsx(_e,{height:"20px",width:"60%"}),s.jsx(_e,{width:"40%",className:"salt-m-t--2"})]})}),Cht=({totalTimeMinutes:e,servings:t})=>s.jsx("div",{className:"salt-m-t--2 sm:salt-m-t--4","data-test":"recipe-details-metrics-skeleton",children:s.jsxs(Q,{gap:["sm","sm"],gapSmUp:["md","sm"],children:[e?s.jsx(WZ,{totalTimeMinutes:e}):s.jsx(Iy,{}),t?s.jsx(VZ,{servings:t}):s.jsx(Iy,{}),s.jsx(Iy,{}),s.jsx(Iy,{})]})}),vht=101,vc=({isRecipeSearch:e,searchTerm:t,fromCollectionsPage:n,collectionInfo:{collectionId:o,collectionTitle:r,collectionSlug:a}={},recipeInfo:{recipeId:i,recipeTitle:l,recipeSlug:c}={},isShopForIngredients:d,isSavedRecipes:u,fromSavedRecipes:p,advertPage:g,categoryPagePath:E,searchPagePath:y})=>{const I=L(),S=Dgt(),C=new URLSearchParams({...t?{searchTerm:t}:{},...o?{collectionId:o}:{},...n?{fromCollectionsPage:n.toString()}:{}}),T=()=>{const _=[];return(!t||e)&&!g&&_.push({name:I.formatMessage("recipes.breadcrumb.recipesHomePage"),url:La()}),g===fc.CATEGORY&&_.push({name:I.formatMessage("recipes.breadcrumb.backToCategoryPage"),url:E}),g===fc.SEARCH&&_.push({name:I.formatMessage("recipes.breadcrumb.backToProductSearchResultsPage"),url:y}),e&&_.push({name:I.formatMessage("recipes.breadcrumb.searchPage"),url:gS({queryString:t?`searchTerm=${t}`:""})}),!t&&n&&_.push({name:I.formatMessage("recipes.breadcrumb.recipesCollectionsPage"),url:Td()}),t&&!n&&!e&&_.push({name:I.formatMessage("recipes.breadcrumb.backToSearchResultsPage"),url:gS({queryString:t?`searchTerm=${t}`:""})}),o&&a&&r&&_.push({name:r,url:Li(a,o,{queryString:n?wV:void 0})}),(u||p)&&_.push({name:I.formatMessage("recipes.breadcrumb.savedRecipesPage"),url:m8()}),i&&c&&l&&_.push({name:l,to:{pathname:ki(c,i),search:C.toString()},navigationState:{title:l,collectionTitle:r,collectionSlug:a}}),d&&i&&c&&_.push({name:I.formatMessage("recipe.ingredients.breadcrumb"),url:AS(c,i,{queryString:C.toString()})}),_.map((A,R)=>{const P=typeof A.name=="string"&&A.name.length>=vht&&S;return _.length-1===R&&P?{...A,name:I.formatMessage("recipe.ingredients.recipeDetails")}:A})};return s.jsx("div",{className:"salt-p-b--2 sm:salt-p-b--0",children:s.jsx(rm,{"data-test":"recipe-breadcrumb",trail:T(),linkElement:Ye})})},Tht=()=>{const e=ws(),t=Ge(),n=Ne(),{formatMessage:o}=L(),{recipeId:r}=nn(),a=Me(Un),i=Me(Xe);if(!a)return null;const l=()=>{if(i){const c=U.analyticsEvent({type:a.isSaved?$D:GD,RECIPE_ID:r,RECIPE_NAME:a.title});if(a.isSaved){const d={event:"remove_saved_recipe",id:r,name:a.title};te.sendEvent({GA:d,WA:null})}else{const d={event:"save_recipe",id:r,name:a.title};te.sendEvent({GA:d,WA:null})}e(a.isSaved?tht({recipeId:r}):eht({recipeId:r})),e(c)}else{const c=`destination=${encodeURIComponent(`${n.pathname}${n.search}`)}`;t(Yo({queryString:c}))}};return s.jsxs(x,{intent:"secondary",fill:!0,onClick:l,"aria-label":a.isSaved?o("recipe.details.saveRecipe.accessibility.saved"):void 0,children:[s.jsx(x.Icon,{name:a.isSaved?"save_on":"save_off"}),s.jsx(x.Text,{children:o(`recipe.details.saveRecipe.${a.isSaved?"saved":"unsaved"}`)})]})},wG=v(V.Item)`
    aspect-ratio: 1/1;
`,_ht=()=>{const e=Ne(),t=ps.parse(e.search),n=fp(t.collectionId),o=fp(t.searchTerm),r=!!t.fromCollectionsPage,a=!!t.fromSavedRecipes,{recipeId:i,recipeSlug:l}=nn(),c=ws(),d=Me(Rt),u=Me(g8),p=Me(Un),g=Me(K8e),E=Me(q8e),y=Rgt();return h.useEffect(()=>{!d&&(!p||p.collectionId!==n)&&!u.isFetching?c(UZ({recipeCollectionId:n,recipeId:i})).then(I=>{I?.payload?.responseData&&y(I.payload.responseData,n)}):d&&p&&y(p,n)},[p?.recipeId]),u.fetchError&&u.error?.statusCode===404?s.jsx(ot,{}):u.fetchError?s.jsx(jn,{showRefreshLink:!0}):u.isFetching?s.jsxs("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"recipe-details-page-skeleton",children:[p&&s.jsx(jG,{recipeData:p}),s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vc,{searchTerm:o,fromCollectionsPage:!!r,collectionInfo:{collectionId:n,collectionTitle:e.state?.collectionTitle,collectionSlug:e.state?.collectionSlug},recipeInfo:{recipeId:i,recipeSlug:l,recipeTitle:e.state?.title},fromSavedRecipes:!!a,advertPage:e.state?.advertPage,categoryPagePath:e.state?.categoryPagePath,searchPagePath:e.state?.searchPagePath})}),s.jsx(wG,{colSpan:{xs:12,md:6},children:e.state?.image?s.jsx(kG,{image:e.state?.image}):s.jsx(fht,{})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsxs(h.Fragment,{children:[s.jsxs(Q,{gap:["sm"],children:[s.jsx(yht,{title:e.state?.title}),s.jsx(_e,{height:"35px","data-test":"recipe-details-ingredients-button-skeleton"}),s.jsx(_e,{height:"35px","data-test":"recipe-details-save-button-skeleton"})]}),s.jsx(Cht,{totalTimeMinutes:e.state?.totalTimeMinutes,servings:e.state?.servings})]})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(Iht,{})}),s.jsxs(V.Item,{colSpan:{xs:12,md:6},children:[s.jsx(Sht,{}),s.jsx(MG,{})]})]})]}):s.jsxs("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"recipe-details-page",children:[p&&s.jsx(jG,{recipeData:p}),s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vc,{searchTerm:o,fromCollectionsPage:!!r,collectionInfo:E,recipeInfo:g,fromSavedRecipes:!!a,advertPage:e.state?.advertPage,categoryPagePath:e.state?.categoryPagePath,searchPagePath:e.state?.searchPagePath})}),s.jsx(wG,{colSpan:{xs:12,md:6},children:s.jsx(kG,{image:p?.image})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsxs(h.Fragment,{children:[s.jsxs(Q,{gap:["sm"],children:[s.jsx(oht,{}),s.jsx(dht,{searchTerm:o,fromCollectionsPage:r,fromSavedRecipes:a,recipeName:g.recipeTitle}),s.jsx(Q,{gap:["sm"],basis:"100%",wrapMdUp:"nowrap",children:s.jsx(Tht,{})})]}),s.jsx(cht,{})]})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(ght,{})}),s.jsxs(V.Item,{colSpan:{xs:12,md:6},children:[s.jsx(mht,{}),s.jsx(MG,{})]})]})]})},KZ=()=>s.jsx(Et,{type:"Recipes-RecipeDetails::route",children:s.jsx(_ht,{})});KZ.fetchData=async({store:e,params:t,req:n})=>{const{recipeId:o}=t,{collectionId:r}=n.query,[a,i]=n.url.split("?"),l=$R(a,i);await e.dispatch(UZ({recipeCollectionId:fp(r),recipeId:o}));const c=e.getState(),d=U8e(c),u=G8e(c);if(!d&&u){const p=At(c),g=ki(u,o,{queryString:i});if(l.toLowerCase()!==g.toLowerCase()){const E=ki(u,o,{basePath:p,queryString:i});return Promise.resolve({redirectTo:E,statusCode:Go.MOVED_PERMANENTLY})}}return Promise.resolve()};const bht=()=>{const e=L(),t=F(),{recipeId:n}=nn(),o=f(Nn),r=()=>{const l=U.analyticsEvent({type:HD,RECIPE_ID:n});t(l);const c={event:"select_navigation",name:"View all recipes",location:"shop-for-ingredients"};te.sendEvent({GA:c,WA:null})},i=Um(([l],c)=>{if(l?.isIntersecting){const d=U.analyticsEvent({type:VD,buttonImpression:{RECIPE_ID:n},pageViewId:o});t(d),c.unobserve(l.target)}});return s.jsx(x,{className:"salt-m-t--2","data-test":"browse-all-recipes-button",intent:"secondary",asChild:!0,onClick:r,fill:!0,ref:l=>{i.current=l},children:s.jsx(Ye,{intent:"ghost",to:u8(),children:e.formatMessage("recipe.shopForIngredients.homePage.link")})})},zZ=({recipeCollectionId:e,recipeId:t})=>(n,o)=>n(tQe({recipeCollectionId:e,recipeId:t})).then(()=>{const a=bN(o())?.flatMap(i=>i.products);a?.length&&n(xt.setProducts({product:a.reduce((i,l)=>({...i,[l.productId]:l}),{})}))}).then(()=>{n(sQe())}).catch(()=>{}),xht=v.div`
    /* Cap height of box to height of viewport to support overflow-y on list */
    display: grid;
    grid-template-rows: auto 1fr auto;
    max-block-size: ${`calc(100vb - ${$(co.v2.sm)} + var(--salt-spacing-4) * 5)`};
    ${re.lgUp`
        max-height: ${`calc(100vh - ${$(co.v2.lgUp)} + var(--salt-spacing-4) * 5
        )`};
    `};
`,Aht=v(Be)`
    overflow-y: auto;
`,Rht=()=>{const e=Me(bN);if(!e)return null;const t=e.map(({ingredient:n})=>{const{displayString:o}=n,r=`#${Cn(`accordion-heading-${o}`)}`;return s.jsx(Be.Item,{className:"salt-m--0",children:s.jsx(tt,{tabIndex:-1,href:r,standalone:!0,className:"salt-p-y--4",children:s.jsx(O,{size:"l",children:o})})},o)});return s.jsx(xe,{"aria-hidden":"true","data-test":"ingredients-index",children:s.jsxs(xht,{children:[s.jsx(ee,{as:"h2",className:"salt-p-b--4",children:s.jsx(b,{id:"recipe.ingredients.sidebar.title"})}),s.jsx(Aht,{className:"salt-p-l--2",children:t})]})})},Dht=()=>s.jsxs(xe,{"data-test":"shop-for-ingredients-ingredient-index-skeleton",children:[s.jsx(js.Skeleton,{}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(fe.Skeleton,{})})]}),Oht=Pe`
    inline-size: ${({displayLandscapeLayout:e})=>$(e?wN:GQ)};
`,pf=({products:e,titleElement:t,a11yTitleText:n,loading:o,overrideConfig:r,featuredProducts:a,page:i="product-details",type:l="cluster",displayLandscapeLayout:c=!0})=>{const d=F(),{formatMessage:u}=L(),p=f(ts);h.useEffect(()=>{o||d(ai({products:e.map(({productId:I})=>({id:I})),featuredProductsData:a}))},[o]);const g=e.every(I=>Object.prototype.hasOwnProperty.call(p,I.productId)),E=typeof t=="string"?s.jsx(to.Title,{children:t}):t,y={labels:{"next-button":u("scroller.accessibility.viewNextIn",{a11yTitleText:n}),"previous-button":u("scroller.accessibility.viewPreviousIn",{a11yTitleText:n})}};return s.jsx(to,{flush:!0,title:E,"data-test":"fop-carousel",navigationButtonPosition:"side",a11y:y,children:e.map(({productId:I,group:S,customAnalyticsData:C},T)=>s.jsx("div",{"data-test":"carousel-fop-wrapper",children:s.jsx(ea,{productId:I,group:S,position:T,page:i,subPage:null,noOfferLink:!1,type:l,withoutHeader:!0,customStyling:Oht,displayLandscapeLayout:c,fopPositionOnPage:T,sendFopImpression:!0,loading:o||!g,overrideConfig:r,customAnalyticsData:C})},I))})},Pht=v(ee).attrs({size:"s",forwardedAs:"span"})`
    text-align: start;
    margin-block: var(--salt-spacing-4);
    margin-inline: 0;

    /* scroll position is behind page header by default */
    ${re.lgUp`
        scroll-margin-block-start: calc(${co.v2.lgUp}px + var(--salt-spacing-4));
    `}
    scroll-margin-block-start: calc(${co.v2.sm}px + var(--salt-spacing-4));
`,Nht=v(rs.Title)`
    block-size: auto;
`,Lht=v(rs.Content)`
    padding-block-start: 0;
`,kht=v.div`
    max-inline-size: 24em;
`,jht=({displayString:e})=>s.jsxs(Q,{justify:"center",children:[s.jsx(ee,{as:"h2",className:"salt-vc",children:s.jsx(b,{id:"recipe.shopForIngredients.ingredientHeader",values:{searchTerm:e}})}),s.jsx(kht,{className:"salt-m-y--16",children:s.jsx(Os,{title:"recipe.ingredients.not.found.title",description:"recipe.ingredients.not.found.text",titleAs:"h3",titleIcon:"search"})})]}),Mht=({ingredient:e,products:t})=>{const{formatMessage:n}=L(),[o,r]=h.useState(!0),{displayString:a}=e,i={products:t.map(d=>d.productId),clusterBreadcrumbs:[],groupTitle:e.searchTerm,section:Ut.OTHER,name:e.searchTerm,type:Ut.SHOP_FOR_INGREDIENTS},l=Cn(a),c=t.map(d=>({productId:d.productId,group:i}));return s.jsxs(h.Fragment,{children:[s.jsx(Nht,{id:`accordion-title-${l}`,"aria-controls":`accordion-content-${l}`,active:o,onClick:()=>r(!o),children:s.jsx(Pht,{className:"salt-m-y--4",id:`accordion-heading-${l}`,children:s.jsx(b,{id:"recipe.shopForIngredients.ingredientHeader",values:{searchTerm:a}})})}),s.jsx(Lht,{id:`accordion-content-${l}`,"aria-labelledby":`accordion-title-${l}`,active:o,children:c.length>0?s.jsx(pf,{type:"catalogue",page:"recipe-shop-for-ingredients",titleElement:s.jsx(to.Title,{className:"salt-vc",children:s.jsx(b,{id:"recipe.shopForIngredients.ingredientHeader",values:{searchTerm:a}})}),a11yTitleText:n("recipe.shopForIngredients.ingredientHeader",{searchTerm:a}),products:c,loading:!1}):s.jsx(jht,{displayString:a})})]})},wht=()=>{const e=Me(bN);if(!e)return null;const t=e.map(n=>h.createElement(Mht,{...n,key:n.ingredient.displayString}));return s.jsx(rs,{"data-test":"ingredients-accordion",children:t})},Rb=()=>s.jsx(_e,{height:"50px"}),Fht=Array.from({length:8}).map((e,t)=>({productId:`product${t}`,group:{type:Ut.SHOP_FOR_INGREDIENTS,section:Ut.OTHER,products:[],name:"soi",clusterBreadcrumbs:[]}})),Db=()=>s.jsx("div",{className:"salt-m-b--4",children:s.jsx(pf,{loading:!0,titleElement:"",a11yTitleText:"",products:Fht})}),Bht=()=>s.jsxs("div",{"data-test":"shop-for-ingredients-ingredient-accordion-skeleton",children:[s.jsx(Rb,{}),s.jsx(Db,{}),s.jsx(Rb,{}),s.jsx(Db,{}),s.jsx(Rb,{}),s.jsx(Db,{})]}),Uht=({shopForIngredientsData:e})=>{const{seo:t}=e;return s.jsxs(Gn,{children:[s.jsx("meta",{name:"robots",content:"noindex"}),t?.metaTitle&&s.jsx("title",{children:t.metaTitle}),t?.metaDescription&&s.jsx("meta",{name:"description",content:t.metaDescription})]})},Ght=v.div`
    position: sticky;
    inset-block-start: calc(${co.v2.sm}px + var(--salt-spacing-4));
    ${re.lgUp`
        top: calc(${co.v2.lgUp}px + var(--salt-spacing-4));
    `}
`,$ht=()=>{const e=Ne(),{collectionId:t,searchTerm:n,fromCollectionsPage:o,fromSavedRecipes:r}=ps.parse(e.search),{recipeId:a}=nn(),i=F(),l=Me(Rt),c=Me(oQe),d=Me(cQe),u=Me(iQe),p=Me(lQe);return h.useEffect(()=>{if(!c.data)return;const g=c.data.ingredientSearch.map(C=>C.ingredient.searchTerm),{title:E,collectionTitle:y}=c.data,I=U.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{RECIPE_ID:a,RECIPE_NAME:E,RECIPE_CLUSTER_LIST:g,...t?{RECIPE_COLLECTION_ID:t}:{},...y?{RECIPE_COLLECTION_NAME:y}:{}}});i(I),c.data.ingredientSearch.reduce((C,T)=>(T.products.length||C.push(T.ingredient),C),[]).forEach(C=>{const T=U.analyticsEvent({type:LD,RECIPE_ID:a,RECIPE_NAME:E,SEARCH_TERM:C.searchTerm,INGREDIENT_NAME:C.displayString});if(i(T),a){const _={event:"recipe_ingredients_no_result",id:a,name:E,search_term:C.searchTerm,ingredient_name:C.displayString};te.sendEvent({GA:_,WA:null})}})},[c.data]),h.useEffect(()=>{!l&&!c.isFetching&&a&&i(zZ({recipeCollectionId:fp(t),recipeId:a}))},[]),c.fetchError&&c.error?.statusCode===404?s.jsx(ot,{}):c.fetchError?s.jsx(jn,{showRefreshLink:!0}):c.isFetching?s.jsxs("div",{"data-test":"shop-for-ingredients-page",children:[s.jsx(_e,{height:"15px","data-test":"shop-for-ingredients-breadcrumbs-skeleton"}),s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,md:8},children:s.jsx(Bht,{})}),s.jsxs(V.Item,{colSpan:{xs:12,md:4},children:[s.jsx(Dht,{}),s.jsx(_e,{height:"35px","data-test":"shop-for-ingredients-browse-all-recipes-skeleton"})]})]})]}):s.jsxs("div",{"data-test":"shop-for-ingredients-page",children:[c.data&&s.jsx(Uht,{shopForIngredientsData:c.data}),s.jsxs(V,{children:[s.jsxs(V.Item,{colSpan:{xs:12,md:8},children:[s.jsx("div",{className:"salt-p-t--4 salt-p-b--2",children:s.jsx(vc,{searchTerm:Array.isArray(n)?n[0]:n,fromCollectionsPage:!!o,collectionInfo:p,recipeInfo:u,isShopForIngredients:!0,fromSavedRecipes:!!r})}),d&&s.jsx(wht,{})]}),s.jsx(V.Item,{colSpan:{xs:12,md:4},children:s.jsxs(Ght,{className:"salt-m-y--4 md:salt-m-r--2",children:[s.jsx(Kt,{breakpoint:"md-up",children:s.jsx(Rht,{})}),s.jsx(bht,{})]})})]})]})},QZ=()=>s.jsx(Et,{type:"Recipes-ShopForIngredients::route",children:s.jsx($ht,{})});QZ.fetchData=async({store:e,params:t,req:n})=>{const{recipeId:o}=t,{collectionId:r}=n.query,[a,i]=n.url.split("?"),l=$R(a,i);await e.dispatch(zZ({recipeCollectionId:fp(r),recipeId:o}));const c=e.getState(),d=rQe(c),u=aQe(c);if(!d&&u){const p=At(c),g=AS(u,o,{queryString:i});if(l.toLowerCase()!==g.toLowerCase()){const E=AS(u,o,{basePath:p,queryString:i});return Promise.resolve({redirectTo:E,statusCode:Go.MOVED_PERMANENTLY})}}return Promise.resolve()};const XZ=({collectionId:e})=>t=>t(Jy.getRecipeCollectionDetails(e)).catch(()=>{}),Hht=v(Ru)`
    display: block;
    object-fit: cover;
    inline-size: 100%;
    block-size: ${$(143)};
    ${re.smUp`
        height: ${$(200)};
    `};
    ${re.lgUp`
        height: ${$(298)};
    `};
    border-radius: var(--salt-radius-default);
`,Vht=v.div`
    block-size: ${$(143)};
    ${re.smUp`
        height: ${$(200)};
    `};
    ${re.lgUp`
        height: ${$(298)};
    `};
    background-color: var(--intent-secondary-200);
`,Wht=()=>{const e=f(t=>fQe(t));return e?s.jsx(Hht,{"data-test":"recipe-collection-details-image",image:e}):s.jsx(Vht,{})},Yht=()=>{const e=Me(y8),t=Me(EQe);return s.jsxs(ae.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:e})}),s.jsx(GZ,{heading:s.jsx(ee,{"data-test":"recipe-collection-details-intro-title",as:"span",children:e}),children:s.jsx(O,{size:"m","data-test":"recipe-collection-details-intro-desc",children:t})})]})},qht={xs:6,md:4,lg:3},Kht=()=>s.jsx(Q,{justify:"center",children:s.jsx(ik,{className:"salt-m-y--8",children:s.jsx(Os,{title:"recipe.collectionDetails.recipes.not.found.title",description:"recipe.collectionDetails.recipes.not.found.text",titleAs:"h3",titleIcon:"search",primaryButton:{text:"recipe.collectionDetails.recipes.not.found.button.label",to:La()}})})}),zht=({fromCollectionsPage:e})=>{const{collectionId:t,collectionSlug:n}=nn(),o=f(i=>y8(i)),r=f(i=>yQe(i)),[a]=Bm();return!r||r.length===0?s.jsx(Kht,{}):r.length>0?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeList.ariaLabel"})}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{children:r.map((i,l)=>s.jsx(V.Item,{asChild:!0,colSpan:qht,children:s.jsx("li",{children:s.jsx(Bl,{collectionId:t,collectionTitle:o,collectionSlug:n,fromCollectionsPage:e,sequence:l,list:Xo.RecipeCollectionDetails,onQueueRecipeImpression:a,...i})})},i.recipeId))})})]}):null},Qht=({recipeCollectionDetailsData:e})=>{const{collectionId:t,slug:n,canonicalUrl:o,seo:r,localisedSeo:a}=e,i=f(E=>Ms(E)),l=f(E=>Ze(E,"default-locale")),c=f(At)||"",u=`https://${f(SC)}${c}`,p=h.useMemo(()=>{const{recipes:E}=e,y={"@context":"https://schema.org/","@type":"ItemList",itemListElement:[]};return E&&(y.itemListElement=E.map((I,S)=>({"@type":"ListItem",position:S+1,url:Sh(ki(I.slug,I.recipeId,{basePath:u,queryString:""}),i!==l?i:null,I.canonicalUrl)}))),JSON.stringify(y)},[e]),g=h.useMemo(()=>{const E=a?.slug;return!E||typeof E!="object"?null:Object.keys(E).filter(y=>y!==i).map(y=>{const I=E[y],C=(a?.canonicalUrl||{})[y];return s.jsx("link",{rel:"alternate",hrefLang:y,href:Sh(Li(I,t,{basePath:u,queryString:""}),y,C)},y)})},[t,a]);return s.jsxs(Gn,{children:[r?.noIndex&&s.jsx("meta",{name:"robots",content:"noindex"}),r?.metaTitle&&s.jsx("title",{children:r.metaTitle}),r?.metaDescription&&s.jsx("meta",{name:"description",content:r.metaDescription}),r?.metaKeywords&&r.metaKeywords.length>0&&s.jsx("meta",{name:"keywords",content:r.metaKeywords.join(",")}),s.jsx("link",{rel:"canonical",href:Sh(Li(n,t,{basePath:u,queryString:""}),i!==l?i:null,o)}),g,s.jsx("script",{"data-test":"recipe-collection-details-structured-data",type:"application/ld+json",children:p})]})},Xht=v.div`
    inline-size: 100%;
    block-size: ${$(143)};
    ${re.smUp`
        height: ${$(200)};
    `};
    ${re.lgUp`
        height: ${$(298)};
    `};
`,Zht=()=>s.jsx(Xht,{children:s.jsx(_e,{"data-test":"recipe-collection-details-image-skeleton",height:"100%"})}),Jht=()=>s.jsx(xe,{"data-test":"recipe-collection-details-intro-skeleton",children:s.jsx(js.Skeleton,{})}),egt={xs:6,md:4,lg:3},tgt=v(V)`
    grid-auto-flow: dense;
`,sgt=()=>s.jsx("div",{className:"salt-m-x--4","data-test":"recipe-collection-details-page",children:s.jsxs(tgt,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},className:"salt-p-t--4",children:s.jsx(_e,{height:"15px","data-test":"recipe-collection-details-breadcrumbs-skeleton"})}),s.jsx(V.Item,{colSpan:{xs:12,lg:7},colStart:{lg:6},children:s.jsx(Zht,{})}),s.jsx(V.Item,{colSpan:{xs:12,lg:5},colStart:{lg:1},children:s.jsx(Jht,{})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(V,{flush:!0,children:[...Array(12).keys()].map(e=>s.jsx(V.Item,{colSpan:egt,children:s.jsx(Hd,{})},`recipe-card-skeleton-${e}`))})})]})}),ngt=v(V)`
    grid-auto-flow: dense;
`,ogt=()=>{const e=Ne(),t=ps.parse(e.search),{fromCollectionsPage:n}=t,{collectionId:o}=nn(),r=F(),a=f(c=>Rt(c)),i=f(c=>pQe(c)),l=f(c=>mQe(c));return h.useEffect(()=>{!a&&!i.isFetching&&o&&r(XZ({collectionId:o}))},[]),h.useEffect(()=>{if(!i.data)return;const c=U.analyticsEvent({type:MD,RECIPE_COLLECTION_ID:o,RECIPE_COLLECTION_NAME:i.data.title,RECIPE_COUNT:i.data.recipes.length});if(r(c),o){const d={event:"view_recipe_collection",id:o,name:i.data.title,recipe_count:i.data.recipes.length};te.sendEvent({GA:d,WA:null})}},[i.data]),i.fetchError&&i.error?.statusCode===404?s.jsx(ot,{}):i.fetchError?s.jsx(jn,{showRefreshLink:!0}):i.isFetching?s.jsx(sgt,{}):s.jsxs("div",{className:"salt-m-x--4","data-test":"recipe-collection-details-page",children:[i.data&&s.jsx(Qht,{recipeCollectionDetailsData:i.data}),s.jsxs(ngt,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:12},className:"salt-p-t--4",children:s.jsx(vc,{fromCollectionsPage:!!n,collectionInfo:l,advertPage:e.state?.advertPage,categoryPagePath:e.state?.categoryPagePath,searchPagePath:e.state?.searchPagePath})}),s.jsx(V.Item,{colSpan:{xs:12,lg:7},colStart:{lg:6},children:s.jsx(Wht,{})}),s.jsx(V.Item,{colSpan:{xs:12,lg:5},colStart:{lg:1},children:s.jsx(Yht,{})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(zht,{fromCollectionsPage:!!n})})]})]})},ZZ=()=>s.jsx(Et,{type:"Recipes-RecipeCollectionDetails::route",children:s.jsx(ogt,{})});ZZ.fetchData=async({store:e,params:t,req:n})=>{const{collectionId:o}=t,[r,a]=n.url.split("?"),i=$R(r,a);await e.dispatch(XZ({collectionId:o}));const l=e.getState();if(!hQe(l)){const d=At(l),u=gQe(l);if(u){const p=Li(u,o,{queryString:a});if(i.toLowerCase()!==p.toLowerCase()){const g=Li(u,o,{basePath:d,queryString:a});return Promise.resolve({redirectTo:g,statusCode:Go.MOVED_PERMANENTLY})}}}return Promise.resolve()};const rgt=()=>s.jsx(Gn,{children:s.jsx("meta",{name:"robots",content:"noindex"})}),Ob={xs:6,md:4,lg:3},agt=({searchTerm:e})=>{const t=ft(),n=Ge(),o=()=>{t({type:WW}),n(Td())};return s.jsx(Q,{justify:"center",children:s.jsx(ik,{className:"salt-m-y--8",children:s.jsx(Os,{title:"recipe.searchPage.notFound",titleValues:{searchTerm:e},description:"recipe.searchPage.retryText",titleAs:"h3",titleIcon:"search",primaryButton:{text:"recipe.linkToBrowse",onClick:o}})})})},igt=({searchTerm:e})=>{const t=Me(d8),[n]=Bm(),r=Me(S8)?.[e]||[];return t.isFetching&&r?.length===0?s.jsx(V,{flush:!0,children:[...Array(12).keys()].map(a=>s.jsx(V.Item,{colSpan:Ob,children:s.jsx(Hd,{})},`recipe-card-skeleton-${a}`))}):!r||r.length===0?s.jsx(agt,{searchTerm:e}):r.length>0?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeList.ariaLabel"})}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsxs("ul",{children:[r.map((a,i)=>s.jsx(V.Item,{asChild:!0,colSpan:Ob,children:s.jsx("li",{children:s.jsx(Bl,{searchTerm:e,sequence:i,list:Xo.RecipeSearch,onQueueRecipeImpression:n,...a})})},a.recipeId)),t.isFetching&&[...Array(5).keys()].map(a=>s.jsx(V.Item,{colSpan:Ob,children:s.jsx(Hd,{})},`recipe-card-skeleton-${a}`))]})})]}):null},TI=50,JZ=0,lgt=()=>{const e=Ne(),{formatMessage:t}=L(),n=h.useRef(null),o=Ge(),r=iJ(),a=ps.parse(e.search),i=fp(a.searchTerm);aJ(n,i);const l=ws(),c=Me(d8),d=Me(iU),u=Me(iU),p=Me(S8),g=Me(Rt),E=i&&p?.[i]?.length||0,y=t("recipe.search");h.useEffect(()=>{i&&!g&&!c.isFetching&&l(Fh({searchTerm:i,limit:TI,offset:0})).then(T=>{r(i,T?.totalRecipes??0)})},[i]);const I=h.useCallback(()=>{!i||c.isFetching||!E||!u||E>=u||l(Fh({searchTerm:i,limit:TI,offset:E}))},[p,i]),S=Agt(I,{root:null,rootMargin:"131px",threshold:0}),C=T=>{T.preventDefault();const{currentTarget:_}=T,A=_.elements.namedItem("recipeSearch").value;A?.trim()&&i!==A&&(o(gS({queryString:ps.stringify({...a,searchTerm:A})})),l(Fh({searchTerm:A,limit:TI,offset:JZ})).then(R=>{r(A,R?.totalRecipes??0)}))};return s.jsxs("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"recipe-search-page",children:[s.jsx(rgt,{}),s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vc,{isRecipeSearch:!0,searchTerm:i})}),i&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(ee,{as:"h2",children:c.isFetching?s.jsx(b,{id:"recipe.search.loading",values:{searchTerm:i}}):s.jsx(b,{id:"recipe.searchPage.resultsText",values:{resultCount:d,searchTerm:i}})})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx("form",{onSubmit:C,children:s.jsx(ak,{id:"recipeSearch",name:"recipeSearch",searchbuttonText:y,placeholder:y,searchInputRef:n})})}),s.jsx(V.Item,{colSpan:{xs:12},children:i&&s.jsx(igt,{searchTerm:i})})]}),s.jsx("div",{ref:S})]})},eJ=()=>s.jsx(Et,{type:"Recipes-RecipeSearch::route",children:s.jsx(lgt,{})});eJ.fetchData=async({store:e,req:t})=>{const{searchTerm:n}=t.query;return typeof n=="string"&&await e.dispatch(Fh({searchTerm:n,limit:TI,offset:JZ})),Promise.resolve()};const cgt=(e=[],t)=>n=>n(xN({collections:e,clear:t})),tJ=({limit:e,offset:t})=>n=>n(TQe({limit:e,offset:t})).then(o=>{o.payload.responseData&&o.payload.responseData.collections.length>0&&n(cgt(o.payload.responseData.collections,t===0))}).catch(()=>{}),dgt=({onQueueCollectionImpression:e,indexOfFirstNewResult:t})=>{const n=Me(v8),o=r=>{r?.focus()};return n&&n.length>0?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeCollectionList.ariaLabel"})}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{"data-test":"media-card-collection",children:n.map((r,a)=>{const i=`${Li(r.slug,r.collectionId,{queryString:wV})}`;return s.jsx(V.Item,{asChild:!0,colSpan:{xs:12,md:6,lg:4},children:s.jsx("li",{children:s.jsx(uf,{navigationCardRef:a===t?o:void 0,collectionId:r.collectionId,"data-test":"collection-media-navigation-card",image:r.image,title:r.title,collectionPath:i,numberOfRecipes:r.numberOfRecipes,list:Xo.RecipeCollections,sequence:a,onQueueCollectionImpression:e},r.collectionId)})})})})})]}):null},ugt=({recipeCollectionsData:e,totalCollections:t,page:n,limit:o})=>{const r=Me(SC),a=()=>n<=Math.ceil(t/o)&&n>1,i=()=>n<t/o&&n>0;return s.jsxs(Gn,{children:[e?.seo?.metaTitle&&s.jsx("title",{children:e.seo.metaTitle}),e?.seo?.metaDescription&&s.jsx("meta",{name:"description",content:e.seo.metaDescription}),s.jsx("link",{rel:"canonical",href:Td({basePath:r,...n>1&&{queryString:ps.stringify({page:n})}})}),a()&&s.jsx("link",{rel:"prev",href:Td({queryString:ps.stringify({page:n-1})})}),i()&&s.jsx("link",{rel:"next",href:Td({queryString:ps.stringify({page:n+1})})})]})},FG=()=>s.jsx("div",{"data-test":"recipe-collections-list-skeleton",children:s.jsx(Oe.MediaCardCollection,{"data-test":"media-card-collection-skeleton",formatting:"small",gridVariant:"auto-fill",children:[...Array(12).keys()].map(e=>s.jsx(GT,{},`recipe-collection-skeleton-${e}`))})}),sd=50,pgt=0,mgt=()=>{const e=Ne(),t=F(),n=ft(),o=ps.parse(e.search),r=h.useRef(o.page&&!Array.isArray(o.page)?parseInt(o.page,10):1),a=Me(Rt),i=Me(xQe),l=Me(AQe),c=Me(v8),[d,u]=h.useState(r.current),p=(c||[]).length,[g]=rk();h.useEffect(()=>{if(!a&&!i.isFetching){const I=p?(d-1)*sd:pgt;t(tJ({limit:sd,offset:I}))}},[d]);const E=()=>{u(d+1),n({type:qW})};if(i.fetchError&&i?.error?.statusCode===404)return s.jsx(ot,{});if(i.fetchError)return s.jsx(jn,{showRefreshLink:!0});if(i.isFetching)return s.jsx("div",{className:"salt-m-x--4 salt-p-t--4",children:s.jsxs(V,{fixed:!0,flush:!0,"data-test":"recipe-collections-page",children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vc,{fromCollectionsPage:!0})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(FG,{})})]})});const y=l&&l>p&&d<=l/sd;return s.jsxs("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"recipe-collections-page",children:[i.data&&l&&s.jsx(ugt,{totalCollections:l,recipeCollectionsData:i.data,limit:sd,page:d}),s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vc,{fromCollectionsPage:!0})}),s.jsx(V.Item,{colSpan:{xs:12},children:i.isFetching?s.jsx(FG,{}):s.jsx(dgt,{onQueueCollectionImpression:g,indexOfFirstNewResult:d!==r.current?(d-r.current)*sd:void 0})}),y&&s.jsx(V.Item,{colSpan:{xs:12,lg:4},className:"salt-p-t--4",children:s.jsx(x,{intent:"secondary",asChild:!0,onClick:E,children:s.jsx(Ye,{intent:"ghost",to:{search:`?${ps.stringify({...o,page:d+1})}`},state:{persistScroll:!0},children:s.jsx(x.Text,{children:s.jsx(b,{id:"recipe.recipesCollectionsPage.loadMoreButton"})})})})})]})]})},sJ=()=>s.jsx(Et,{type:"Recipes-RecipeCollections::route",children:s.jsx(mgt,{})});sJ.fetchData=async({store:e,req:t})=>{const{page:n}=t.query,r=((n&&typeof n=="string"?parseInt(n,10):1)-1)*sd;return await e.dispatch(tJ({limit:sd,offset:r})),Promise.resolve()};const hgt=e=>t=>t(ld.getSavedRecipes(e)).catch(()=>{}),nJ={getSavedRecipes:hgt},ggt={xs:6,md:4,lg:3},Egt=()=>{const e=Ge(),t=()=>{e(La())};return s.jsx(Q,{justify:"center",children:s.jsx(ik,{className:"salt-m-y--8",children:s.jsx(Os,{title:"recipe.savedRecipesPage.noRecipes",description:"recipe.savedRecipesPage.noRecipesDescription",titleAs:"h3",titleIcon:"save_on",primaryButton:{text:"recipe.linkToBrowseRecipes",onClick:t}})})})},fgt=({recipes:e})=>{const[t]=Bm();return!e||e.length===0?s.jsx(Egt,{}):s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(b,{id:"recipes.recipeList.ariaLabel"})}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{children:e.map((n,o)=>s.jsx(V.Item,{asChild:!0,colSpan:ggt,children:s.jsx("li",{children:s.jsx(Bl,{fromSavedRecipes:!0,sequence:o,list:`${ig.SAVED_RECIPES}`,onQueueRecipeImpression:t,...n})})},n.recipeId))})})]})},ygt=50,Igt=()=>{const[e,t]=h.useState(1),n=ft(),o=f(u=>Rt(u)),r=f(u=>NQe(u)),a=f(u=>kQe(u,e)),i=f(u=>LQe(u)),l=F();if(h.useEffect(()=>{!o&&!r.isFetching&&l(nJ.getSavedRecipes(e))},[e]),r.fetchError&&r?.error?.statusCode===404)return s.jsx(ot,{});if(r.fetchError)return s.jsx(jn,{showRefreshLink:!0});if(r.isFetching){const u={xs:6,md:4,lg:3};return s.jsx("div",{className:"salt-m-x--4 salt-p-t--4",children:s.jsx(V,{fixed:!0,flush:!0,children:[...Array(24).keys()].map(p=>s.jsx(V.Item,{colSpan:u,children:s.jsx(Hd,{})},p))})})}const c=()=>{t(e+1),n({type:KW})},d=i>a.length&&e<=i/ygt;return s.jsx("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"saved-recipes-page",children:s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vc,{isSavedRecipes:!0})}),s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"recipes.recipeList.ariaLabel"})})}),s.jsx(V.Item,{colSpan:{xs:12},children:a&&s.jsx(fgt,{recipes:a})}),d&&s.jsx(V.Item,{colSpan:{xs:12,md:4},children:s.jsx(x,{intent:"secondary",type:"button",onClick:c,children:s.jsx(x.Text,{children:s.jsx(b,{id:"recipe.loadMoreButton"})})})})]})})},oJ=()=>s.jsx(Et,{type:"Recipes-SavedRecipes::route",children:s.jsx(Igt,{})});oJ.fetchData=async({store:e})=>(await e.dispatch(nJ.getSavedRecipes(1)),Promise.resolve());const zc=D("rec"),Sgt="/recipes",Cgt="/recipes/search-results",rJ="/recipes/:recipeSlug/:recipeId",vgt="/recipes/:recipeSlug/:recipeId/ingredients",Tgt="/recipes/collections",_gt="/recipes/collections/:collectionSlug/:collectionId",bgt="/recipes/saved-recipes",xgt=e=>[{path:_gt,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,ZZ,ot)}]},{path:vgt,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,QZ,ot)}]},{path:Tgt,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,sJ,ot)}]},{path:rJ,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,KZ,ot)}]},{path:Cgt,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,eJ,ot)}]},{path:bgt,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,oJ,ot)}]},{path:Sgt,Component:e.Main,key:"main",children:[{index:!0,Component:as(zc,BZ,ot)}]}],Um=(e,t={})=>{const n=h.useRef(null);return h.useEffect(()=>{const o=new IntersectionObserver(e,t);return n.current&&o.observe(n.current),()=>{n.current&&o.unobserve(n.current)}},[n]),n},Agt=(e,t={},n=[])=>{const o=h.useRef(null),r=a=>{a[0].isIntersecting&&e()};return h.useEffect(()=>{const a=new IntersectionObserver(r,t);return o.current&&a.observe(o.current),()=>{o.current&&a.unobserve(o.current)}},[o,e,...n]),o},aJ=(e,t="")=>{const n=ft(),o=()=>{n({type:VW})};h.useEffect(()=>{const r=e?.current;return r&&(r.value=t,r.addEventListener("focus",o,!1)),()=>{r&&r.removeEventListener("focus",o,!1)}},[o])},iJ=()=>{const e=ft();return(n,o=0)=>{if(e({type:kD,RECIPE_SEARCH_SOURCE:"RECIPE_TEXT_SEARCH",RECIPE_SEARCH_TERM:n,RECIPE_SEARCH_RESULTS_COUNT:o}),o){const r={event:"recipe_search",search_term:n};te.sendEvent({GA:r,WA:null})}else{const r={event:"recipe_search_no_results",search_term:n};te.sendEvent({GA:r,WA:null})}}},Rgt=()=>{const e=ft();return(n,o)=>{const{recipeId:r,title:a,collectionTitle:i,totalTimeMinutes:l,prepTimeMinutes:c,cookingTimeMinutes:d,servings:u,ingredients:p,method:g}=n;e({type:jD,RECIPE_ID:r,RECIPE_NAME:a,...o&&{RECIPE_COLLECTION_ID:o},...i&&{RECIPE_COLLECTION_NAME:i},...u?.number&&{SERVINGS:u?.number},...c&&{PREP_TIME:c},...d&&{COOK_TIME:d},TOTAL_TIME:l,...u?.caloriesPer&&{METRICS:u?.caloriesPer},INGREDIENT_COUNT:p?.length,STEP_COUNT:g.reduce((y,I)=>y+I.methodGroupSteps.length,0)});const E={event:"view_recipe",id:r,name:a,total_time:l,ingredient_count:p?.length,step_count:g.reduce((y,I)=>y+I.methodGroupSteps.length,0),...o&&{collection_id:o},...u?.number&&{servings:u?.number},...c&&{prep_time:c},...d&&{cooking_time:d},...u?.caloriesPer&&{metrics:u?.caloriesPer}};te.sendEvent({GA:E,WA:null})}},mf=()=>{const e=L();return t=>{const n=Math.floor(t/60),o=t%60,r=e.formatNumber(o,{style:"unit",unit:"minute"});if(n===0)return r;const a=e.formatNumber(n,{style:"unit",unit:"hour"});return o===0?a:`${a} ${r}`}},lJ=()=>{const{pathname:e}=Ne();return e.includes(La())},Dgt=()=>{const{pathname:e}=Ne();return!!zr({path:rJ},e)},Ogt=v(nt.FixedHeightWrapper)`
    display: flex;

    ${re.smUp`
        height: auto;
    `}

    ${({isNewProductList:e})=>e&&`
        min-width: initial;
        padding: 0;
        margin: 0;
    `}
`,Pgt=v(Ye)`
    max-block-size: 100%;
    flex: 1;

    ${re.smUp`
        margin-top: 2rem;
    `}

    &, &:hover, &:active {
        text-decoration: none;
    }
`,Ngt=v(df)`
    display: flex;
    flex-direction: column;
    block-size: 100%;
`,Lgt=v.div`
    flex: 1;
    inline-size: 100%;
    block-size: 100%;
    background-color: var(--intent-secondary-200);
`,kgt=v(Ru)`
    object-fit: cover;
    object-position: 50% 50%;
    inline-size: 100%;
`,jgt=v.div`
    word-break: break-word;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: initial;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: block-axis;

    ${re.smUp`
        -webkit-line-clamp: 2;
    `}
`,cJ=({recipeId:e,title:t,slug:n,image:o,totalTimeMinutes:r,servings:a,sequence:i,productListName:l,advertPage:c,categoryPagePath:d,searchPagePath:u,isNewProductList:p})=>{const{formatMessage:g}=L(),[E]=Bm(),y=mf(),I=ft(),S=ct(),T=Um(([A],R)=>{A?.isIntersecting&&(E({RECIPE_ID:e,RECIPE_NAME:t,SEQUENCE:i,TOTAL_TIME:r,LIST:l,...a?.number&&{SERVES:a.number},isAdvert:!0}),R.unobserve(A.target))},{root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5}),_=()=>{I({type:"RECIPE_ADVERT_CLICKED",pageEventId:S,RECIPE_ID:e,RECIPE_NAME:t,SEQUENCE:i,TOTAL_TIME:r,LIST:l,...a?.number&&{SERVES:a.number}});const A={event:"select_recipe_card",id:e,name:t,total_time:r,index:i,list:l,...a&&{servings:a.number}};te.sendEvent({GA:A,WA:null})};return s.jsx(Ogt,{ref:T,isNewProductList:p,children:s.jsxs(Pgt,{state:{image:o,totalTimeMinutes:r,servings:a,advertPage:c,categoryPagePath:d,searchPagePath:u},to:ki(n,e),onClick:_,children:[s.jsx(ie,{children:g("recipes.recipeAdvert.accessibilityText")}),s.jsxs(Ngt,{children:[o?s.jsx(kgt,{image:o}):s.jsx(Lgt,{}),s.jsxs("div",{className:"salt-p--2",children:[s.jsx(jgt,{children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{children:t})})}),s.jsxs(Q,{justify:"space-between",align:"center",className:"salt-m-t--2",children:[s.jsxs(Q,{align:"center",children:[s.jsx(pe,{name:"total_time",height:18,width:18,"aria-hidden":"true"}),s.jsxs(ie,{children:[g("recipe.details.totalTime"),": "]}),s.jsx(O,{className:"salt-m-l--1",children:y(r)})]}),a?.number&&s.jsxs(Q,{align:"center","data-test":"recipe-card-servings",children:[s.jsx(pe,{name:"servings",height:18,width:18,"aria-hidden":"true"}),s.jsxs(ie,{children:[g("recipe.details.servings"),": "]}),s.jsx(O,{className:"salt-m-l--1",children:a.number})]})]})]})]})]})})},{Body:Mgt,ImageWrapper:wgt,StyledImage:Fgt,TitleWrapper:Bgt,Chevron:Ugt,Title:Ggt}=fE.MediaNavigation,$gt=v(Ye)`
    flex: 1;
    flex-direction: column;
    max-block-size: 100%;

    ${re.smUp`
        margin-top: 2rem;
    `}

    &, &:hover, &:active {
        text-decoration: none;
    }
`,Hgt=v(Mgt)`
    ${re.smUp`
        height: auto;
    `}
`,Vgt=v(nt.FixedHeightWrapper)`
    display: flex;

    ${re.smUp`
        height: auto;
    `}

    ${({isNewProductList:e})=>e&&`
        min-width: 0;
        padding: 0;
        margin: 0;
    `}
`,Wgt=v(V)`
    flex: 1;
`,vA=v(Ru)`
    block-size: 100%;
    inline-size: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    object-position: 50% 50%;
    background-color: var(--intent-secondary);
    border-radius: var(--salt-radius-default);
`,Ygt=v(vA)`
    block-size: 0;
    min-block-size: 100%;
`,qgt=v(Bgt)`
    align-items: center;
`,Kgt=v(Ggt)`
    text-overflow: ellipsis;
    display: block;
    overflow: hidden;
    white-space: nowrap;
`,zgt=({image:e,recipeImages:t})=>s.jsxs(Wgt,{flush:!0,className:"salt-gap--2",children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Ygt,{alt:"",image:e})}),Array.from({length:4}).map((n,o)=>s.jsx(V.Item,{colSpan:{xs:6},className:"salt-d--flex",children:t?.[o]?s.jsx(vA,{image:t[o],alt:""}):s.jsx(vA,{as:"div"})}))]}),dJ=({title:e,slug:t,collectionId:n,image:o,recipeImages:r,advertPage:a,sequence:i,productListName:l,categoryPagePath:c,searchPagePath:d,numberOfRecipes:u,isNewProductList:p})=>{const[g]=rk(),E=ft(),{formatMessage:y}=L(),S=Um(([T],_)=>{T?.isIntersecting&&(g({RECIPE_COLLECTION_ID:n,RECIPE_COLLECTION_NAME:e,RECIPE_COUNT:u,SEQUENCE:i,LIST:l,isAdvert:!0}),_.unobserve(T.target))},{root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5}),C=()=>{const T=ct();E({type:PD,pageEventId:T,RECIPE_COLLECTION_ID:n,RECIPE_COLLECTION_NAME:e,SEQUENCE:i,LIST:l});const _={event:"select_recipe_collection_card",id:n,name:e,index:i,list:l};te.sendEvent({GA:_,WA:null})};return s.jsx(Vgt,{ref:S,isNewProductList:p,children:s.jsxs($gt,{className:"salt-d--flex salt-gap--2",state:{advertPage:a,categoryPagePath:c,searchPagePath:d},to:Li(t,n),onClick:C,children:[s.jsx(ie,{children:y("recipes.recipeCollectionAdvert.accessibilityText")}),s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(zgt,{image:o,recipeImages:r})}),s.jsxs(Hgt,{children:[s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(wgt,{children:s.jsx(Fgt,{alt:"",image:o,as:Ru})})}),s.jsxs(qgt,{className:"salt-d--flex",children:[s.jsx(Kgt,{children:e}),s.jsx(Ugt,{height:"24",name:"arrow_right"})]})]})]})})},Qgt=D("sa.fav"),Xgt=D("fbf"),Zgt={actions:m.shape({analyticsEvent:m.func.isRequired,productClickEvent:m.func.isRequired,productClickGa4Event:m.func.isRequired,contentExperienceFeatureProductClickEvent:m.func.isRequired}).isRequired,type:m.oneOf(["catalogue","basket","order","slotbooking"]).isRequired,fopView:m.string,intl:m.any.isRequired,calendarDateFormat:m.string.isRequired,updateBasketQuantity:m.func.isRequired,productGroups:m.arrayOf(m.shape({products:m.arrayOf(m.string.isRequired)})),visibleProductsByProductId:m.objectOf(sl).isRequired,registerFopRef:m.func,page:m.string.isRequired,subPage:m.string,currentBreakpoint:m.string,rankingScoreByProductId:m.objectOf(m.string),breadcrumbValue:m.string,noOfferLink:m.bool,orderId:m.string,draftBasketId:m.string,hideMoreOptions:m.bool,fopControlsFactory:m.func,showMissedPromotions:m.bool,isNextPageFetching:m.bool,displayLandscapeLayout:m.bool.isRequired,pageEventId:m.string,defaultMaxNumFavoritesProductsDisplayed:m.string.isRequired,pageViewId:m.string.isRequired,withoutHeader:m.bool,isShowFavouritesTile:m.bool.isRequired,isFilterByFavourites:m.bool.isRequired,location:m.shape({query:{favoritesOnly:m.string}}).isRequired,withinGridProductCards:m.arrayOf(m.shape({position:m.number})),lastFetchedCatalogueLocation:m.string.isRequired},Jgt={productGroups:void 0,rankingScoreByProductId:{},fopView:"detail",breadcrumbValue:null,subPage:null,noOfferLink:!1,orderId:void 0,draftBasketId:void 0,registerFopRef:()=>{},hideMoreOptions:!1,fopControlsFactory:void 0,showMissedPromotions:!1,isNextPageFetching:!1,pageEventId:void 0,currentBreakpoint:void 0,withoutHeader:!1,withinGridProductCards:[]},eEt=(e,t,n,o,r)=>{if(!e)return;const a=JSON.parse(JSON.stringify(e));return a.favorite&&a.favorite.lastBought&&(a.favorite.lastBought=gt(e.favorite.lastBought,o)),a.price?.current&&(a.price.current.amount=r(a.price.current)),a.price?.original&&(a.price.original.amount=r(a.price.original)),a?.price?.unit?.current&&(a.price.unit.current.amount=r(a.price.unit.current)),e?.price?.unit?.original&&(a.price.unit.original.amount=r(a.price.unit.original)),a.price?.gross&&(a.price.gross.amount=r(a.price.gross)),a.size?.uom&&(a.size.uom=yg(n.formatMessage,a.size.uom)),Object.assign(a,t)},tEt=(e,t,n)=>{if(!e)return{};const o={catchWeight:t.formatMessage("fop.catchweight.unit"),taxInclusive:r=>t.formatMessage("fop.tax.inclusive",{grossPrice:r}),countryOfOriginTitle:r=>t.formatMessage("fop.country.of.origin.description",{country:r}),countryOfOriginA11yPrefix:t.formatMessage("fop.country.of.origin.a11y.prefix"),outOfStock:t.formatMessage("fop.out.of.stock.button"),notInCatalog:t.formatMessage("fop.not.in.current.catalog.button"),seeAlternatives:r=>t.formatMessage("fop.show.alternatives.text",{numberOfAlternatives:r&&r.length}),noAlternatives:t.formatMessage("fop.no.alternatives.text"),addToTrolley:t.formatMessage("fop.add.button"),addToTrolleyAlternative:r=>t.formatMessage("fop.add.button.alternative",{productName:r}),increaseQuantityInTrolleyAlternative:r=>t.formatMessage("counter.increase.quantity.button.alternative.with.product",{productName:r}),decreaseQuantityInTrolleyAlternative:r=>t.formatMessage("counter.decrease.quantity.button.alternative.with.product",{productName:r}),editQuantityTextAlternative:r=>t.formatMessage("counter.edit.quantity.input.alternative.with.product",{productName:r}),getQuantityDescriptionTextAlternative:r=>t.formatMessage("counter.quantity.description.alternative",{quantity:r}),maxQuantity:t.formatMessage("fop.max.quantity"),maxQuantityLabel:t.formatMessage("fop.max.quantity.label"),addedToBasket:t.formatMessage("fop.added"),lastBought:r=>t.formatMessage("fop.last.bought.date",{date:r}),favoriteIconDescription:t.formatMessage("fop.favorite.icon.description"),regularIconDescription:t.formatMessage("fop.regular.icon.description"),featuredLabel:t.formatMessage("fop.featured.label"),featuredLabelDescription:t.formatMessage("fop.featured.label.description"),timeRestricted:t.formatMessage("fop.time.restricted"),timeRestriction:(r,a)=>t.formatMessage("fop.time.restriction",{to:r,from:a}),limitedAvailability:(r,a)=>t.formatMessage("product.availability.limited",{addedAmount:r,requestedAmount:a}),quantity:t.formatMessage("fop.ordered.quantity"),quantityLabel:r=>t.formatMessage("fop.order.quantity.label",{quantity:r}),missing:t.formatMessage("fop.order.missing"),missingLabel:r=>t.formatMessage("fop.order.missing.label",{quantity:r}),unavailableLabel:r=>t.formatMessage("product.availability.out.of.stock",{itemQty:r}),substitute:t.formatMessage("fop.order.substitute"),substituteLabel:r=>t.formatMessage("fop.order.substitute.label",{quantity:r}),accepted:t.formatMessage("fop.order.accepted"),acceptedLabel:r=>t.formatMessage("fop.order.accepted.label",{quantity:r}),rejected:t.formatMessage("fop.order.rejected"),rejectedLabel:r=>t.formatMessage("fop.order.rejected.label",{quantity:r}),returned:t.formatMessage("fop.order.returned"),returnedLabel:r=>t.formatMessage("fop.order.returned.label",{quantity:r}),deposit:(r,a)=>t.formatMessage("deposit.badge",{price:n({amount:r,currency:a})}),depositDescription:t.formatMessage("deposit.description"),guaranteedProductLifeBadge:(r,a)=>t.formatMessage(`guaranteed.product.life.badge.${a.toLowerCase()}`,{quantity:r}),guaranteedProductLifeDescription:(r,a)=>r===1?t.formatMessage(`guaranteed.product.life.description.${a.toLowerCase()}.one`):t.formatMessage(`guaranteed.product.life.description.${a.toLowerCase()}.other`,{quantity:r}),productGroupTitle:r=>{if(r===Ut.CLUSTER)return"";const a=DC.includes(r)?"other":r;return t.formatMessage(`fop.group.title.${a}`)},productGroupMenuAccessibilityLabel:t.formatMessage("fop.group.menu.accessibility.label"),moreOptionsTitle:t.formatMessage("fop.shopping.lists.more.options"),moreOptionsAccessibilityLabel:t.formatMessage("fop.shopping.lists.more.options.accessibility.label"),inProductListTitle:t.formatMessage("fop.shopping.lists.in.product.list"),missedPromotionCompleteTextAlternative:(r,a)=>r>0?t.formatMessage("fop.added.missed.promotion.complete.text.alternative",{quantity:r,offerMessage:a}):t.formatMessage("fop.not.added.missed.promotion.complete.text.alternative",{offerMessage:a}),missedPromotionNotCompleteTextAlternative:(r,a,i,l)=>r>0?t.formatMessage("fop.added.missed.promotion.not.complete.text.alternative",{quantity:r,offerMessage:a,basketQuantity:i,requiredQuantity:l}):t.formatMessage("fop.not.added.missed.promotion.not.complete.text.alternative",{offerMessage:a,basketQuantity:i,requiredQuantity:l})};return e.price&&e.price.unit&&(e.price.unit.pricePerSuffix?o.pricePerUnit=`${e.price.unit.current.amount} ${e.price.unit.pricePerSuffix}`:e.price.unit.label&&(o.pricePerUnit=t.formatMessage(`${e.price.unit.label}`,{price:e.price.unit.current.amount}))),o};function sEt(e){let t=0,n=0;return{next(o,r){t+=1;const a=Nut(o,t,r);return a&&(n+=1),[e?n+1:n,a]},nextAdvert(o){n+=o},getCurrentPosition(){return n},getPositionIncludingInitialAdvert(){return e?n+1:n}}}const BG=(e,t,n,o)=>{if(!t.type)return null;let r=t.type;const a=V9(t,n,o);if(t.clusterBreadcrumbs&&t.clusterBreadcrumbs.length>0){const i=t.clusterBreadcrumbs[t.clusterBreadcrumbs.length-1];i&&(r=i.id)}else DC.includes(t.type)&&(r="other");return{categoryId:r,clusterName:a,level:t.clusterBreadcrumbs?t.clusterBreadcrumbs.length:0,clusterSequence:t.groupIndex,productClusterSequence:t.products&&t.products.indexOf(e.productId)}},pk=({actions:{analyticsEvent:e,contentExperienceFeatureProductClickEvent:t,productClickEvent:n,productClickGa4Event:o},breadcrumbValue:r,calendarDateFormat:a,currentBreakpoint:i,intl:l,page:c,subPage:d,productGroups:u=[],draftBasketId:p,rankingScoreByProductId:g,registerFopRef:E,fopView:y,type:I,updateBasketQuantity:S,visibleProductsByProductId:C,noOfferLink:T,orderId:_,hideMoreOptions:A,fopControlsFactory:R,showMissedPromotions:P,isNextPageFetching:N,displayLandscapeLayout:k,pageEventId:M,pageViewId:w,withoutHeader:j,withinGridProductCards:G,location:W,defaultMaxNumFavoritesProductsDisplayed:H,isShowFavouritesTile:K,isFilterByFavourites:X,lastFetchedCatalogueLocation:q})=>{const ne=f(Qs),ue=He(),oe=LZ[c],[ye]=f((oe??kZ)()),[he]=Ee(["cxe.by"]),Ie=new sEt(ye),Fe=y==="grid"?Fm:wm,be=c==="search"&&!W.query?.favoritesOnly&&K&&X,ce=()=>[...Array(10).keys()].map(me=>s.jsx(Fe,{"data-test":"fetch-next-page-skeleton",withoutHeader:j,fopView:y},`sk-${me}`));return s.jsxs(h.Fragment,{children:[u.map((me,De)=>{const ge=me.type==="favorite"&&me.products.length===Number(H),Se=me.products.map((Ae,Ce)=>{const We=Ie.getCurrentPosition(),et=Ie.getPositionIncludingInitialAdvert(),ve=De+1,lt=Ce+1,St=ve===u.length,wt=lt===me.products.length,dn=St&&wt,[Mo,Zs]=Ipt({position:We+1,productCardAdverts:G,isInLastPosition:dn});Mo?.length&&Ie.nextAdvert(Mo.length);const[Mn,Kn]=Ie.next(me,i),gs=C[Ae],Vc=me.products[0]===Ae,wa=Mn-1,ca=ks(c,d,me.section),ju=ol=>{const Kl=Vn(gs,ne);Kn&&(e({type:Jt.QUEUE_PRODUCT_IMPRESSION,category:r,group:me,page:c,productListName:ca,pageEventId:M,sequence:wa,position:wa,product:gs,rankingScore:c==="search"?g[Ae]:null,cluster:BG(gs,me,c,l.formatMessage),groupType:me.type,orderId:_,missedPromotion:ol,pageViewId:w}),te.queueProductImpressionEvent({GA:{category:r,group:me,page:c,productListName:ca,pageEventId:M,sequence:wa,position:wa,product:gs,rankingScore:c==="search"?g[Ae]:null,cluster:BG(gs,me,c,l.formatMessage),groupType:me.type,orderId:_,missedPromotion:ol,pageViewId:w,isPersonalised:me&&me.type===Ut.PERSONALIZED,featuredProductCampaign:Kl},WA:null}))},Yl=eEt(gs,{},l,a,ue),Jm=tEt(Yl,l,ue),Wc=()=>t([gs],he),Io=()=>{MI(c,gs,me.type)&&Wc()},qo=()=>{const ol=Vn(gs,ne);n({productName:gs.name,productId:gs.retailerProductId,productPrice:pc(gs,!0),productListName:ca,productPosition:Mn,currencyCode:gs.price&&gs.price.current.currency});const Kl={eventLabel:gs.retailerProductId,ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"product_click",event:"productClick",ecommerce:{currencyCode:gs.price&&gs.price.current.currency,click:{actionField:{list:ca},products:[{name:gs.name,id:gs.retailerProductId,price:pc(gs,!0),position:Mn}]}}};te.sendEvent({GA:Kl,WA:null}),o({product:gs,position:Mn,productListName:ca,page:c});const Yc={event:"select_item",ecommerce:{currency:gs.price&&gs.price.current.currency,items:[Zp({product:gs,position:Mn,productListName:ca,page:c,featuredProductCampaign:ol})]}};te.sendEvent({GA:Yc,WA:null})},hi=()=>{MI(c,gs)&&Wc()},So=(ol,Kl)=>{const Yc={...c==="search"&&{advertPage:fc.SEARCH,searchPagePath:q},...c==="categories"&&{advertPage:fc.CATEGORY,categoryPagePath:q}};return ol?.map((Nr,Gf)=>{const eh=Kl+Gf;switch(Nr.format){case mS.RECIPE_CARD:return s.jsx(cJ,{...Yc,...Nr.fields,sequence:eh,productListName:ca?.split(":")[0]},`${Nr.fields.recipeId}${Nr.position}`);case mS.COLLECTION_CARD:return s.jsx(dJ,{...Yc,...Nr.fields,sequence:eh,productListName:ca?.split(":")[0]},`${Nr.fields.collectionId}${Nr.position}`);default:return s.jsx(OZ,{advert:Nr,page:c,sequence:eh},`${Nr.id}${Nr.position}`)}})},mr=So(Mo,et),ql=So(Zs,et+1);return s.jsxs(h.Fragment,{children:[mr,s.jsx(hpt,{productId:Ae,draftBasketId:p,type:I,fopView:y,currentBreakpoint:i,onClick:Io,sendFopProductLinkEvent:qo,onContextMenu:hi,onImpression:ju,updateBasketQuantity:S(gs,Mn,me),product:Yl,position:Ce+1,group:me,firstInGroup:Vc,fopIsVisible:Kn,messages:Jm,linkElement:Ye,registerRef:E,noOfferLink:T,orderId:_,hideMoreOptions:A,displayLandscapeLayout:k,fopControls:R?R({...gs,productIndex:wa,page:c,subPage:d,section:me.section,productId:Ae,isDisabled:!Yl?.available}):void 0,showMissedPromotions:P,page:c,subPage:d,withoutHeader:j,fopPositionOnPage:wa},`${Ae}${me.name}`),ql]})});return be&&ge&&Se.push(s.jsx(PZ,{favouritesAmount:me.products.length},"favorite-tiles")),Se}),N&&ce()]})};pk.propTypes=Zgt;pk.defaultProps=Jgt;const nEt=e=>({calendarDateFormat:cr(e),location:e.router.location,defaultMaxNumFavoritesProductsDisplayed:Ze(e,"default-max-num-products-displayed-in-favorites-cluster"),isShowFavouritesTile:Qgt(e),isFilterByFavourites:Xgt(e),lastFetchedCatalogueLocation:lD(e)}),oEt=st({analyticsEvent:U.analyticsEvent,productClickEvent:Rp.productClickGAEvent,productClickGa4Event:Rp.productClickGa4Event,contentExperienceFeatureProductClickEvent:L2});function rEt(e){return ae.forwardRef((t,n)=>s.jsx(kn.Consumer,{children:({currentBreakpoint:o})=>s.jsx(e,{...t,ref:n,currentBreakpoint:o})}))}const aEt=Tt(rEt,Ht,we(nEt,oEt))(pk),iEt=D("cfop"),lEt={type:m.oneOf(["catalogue","basket","order","slotbooking"]).isRequired,fopView:m.string,page:m.string.isRequired,productGroups:m.arrayOf(m.shape({name:m.string,type:m.string,section:m.string,groupTitle:m.string,products:m.arrayOf(m.string.isRequired),clusterBreadcrumbs:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired})),campaignId:m.string,campaignName:m.string,additionalProductAttributes:m.arrayOf(m.shape({campaignId:m.string.isRequired,campaignName:m.string.isRequired}))})),productsByProductId:m.objectOf(sl).isRequired,actions:m.shape({batchAddToBasket:m.func,batchAddItemsToDraftBasket:m.func,batchRemoveFromBasket:m.func,batchRemoveItemsFromDraftBasket:m.func,fetchFopData:m.func}).isRequired,hideTopBorder:m.bool,noOfferLink:m.bool,renderInitial:m.func,onInitialFopLoad:m.func,isFetching:m.bool.isRequired,isNextPageFetching:m.bool,rankingScoreByProductId:m.objectOf(m.string),breadcrumbValue:m.string,breadCrumbs:m.arrayOf(m.shape({id:m.string,name:m.string})).isRequired,"data-test":m.string,orderId:m.string,infiniteScrollScrollableContainerElementRef:m.oneOfType([m.object,m.shape({current:m.elementType})]),infiniteScrollScrollableElementRef:m.oneOfType([m.object,m.shape({current:m.elementType})]),hideMoreOptions:m.bool,displayLandscapeLayout:m.bool,draftBasketId:m.string,onFopVisibilityChange:m.func,fopControlsFactory:m.func,withoutShoppingListsModal:m.bool,showMissedPromotions:m.bool,pageEventId:m.string,pageViewId:m.string.isRequired,skeletonSize:m.number,withoutHeader:m.bool,withinGridProductCards:m.arrayOf(m.shape({position:m.number})),configurableFopEnabled:m.bool},cEt={renderInitial:()=>null,onInitialFopLoad:()=>null,productGroups:void 0,hideTopBorder:!1,noOfferLink:!1,rankingScoreByProductId:{},fopView:"detail",breadcrumbValue:null,"data-test":void 0,orderId:void 0,infiniteScrollScrollableContainerElementRef:void 0,infiniteScrollScrollableElementRef:void 0,hideMoreOptions:!1,draftBasketId:void 0,onFopVisibilityChange:void 0,fopControlsFactory:void 0,showMissedPromotions:!1,isNextPageFetching:!1,withoutShoppingListsModal:!1,pageEventId:void 0,skeletonSize:25,withoutHeader:!1,configurableFopEnabled:!1,withinGridProductCards:[]};function dEt(e,t){if(!e)return t;const n={};return e.forEach(({id:o})=>{t[o]&&(n[o]=t[o])}),n}function uEt(e,t){const n=[];for(let o=0;o<e.length;o+=t){const r=e.slice(o,o+t);n.push(r)}return n}const mk=({productGroups:e,productsByProductId:t,actions:n,page:o,type:r,fopView:a,hideTopBorder:i,noOfferLink:l,renderInitial:c,isFetching:d,isNextPageFetching:u,onInitialFopLoad:p,rankingScoreByProductId:g,breadcrumbValue:E,breadCrumbs:y,"data-test":I,orderId:S,infiniteScrollScrollableContainerElementRef:C,infiniteScrollScrollableElementRef:T,hideMoreOptions:_,displayLandscapeLayout:A,draftBasketId:R,onFopVisibilityChange:P,fopControlsFactory:N,showMissedPromotions:k,withoutShoppingListsModal:M,pageEventId:w,configurableFopEnabled:j,pageViewId:G,skeletonSize:W,withoutHeader:H,withinGridProductCards:K})=>{const X=h.useRef(new Set),q=()=>{if(r==="catalogue"&&o==="categories"){const he=y&&y.length>0?[...y].pop().name:"";return he?Pi(he.trim()):null}return null},ne=r==="slotbooking"?Pp.updateDraftBasketQuantityFactory(n.batchAddItemsToDraftBasket,n.batchRemoveItemsFromDraftBasket,R):Aot(n.batchAddToBasket,n.batchRemoveFromBasket,o,q()),ue=he=>{if(j)return s.jsx(pd,{fitContent:!0,displayLandscapeLayout:A,withoutHeader:H,"data-test":"fetching-configurable-skeleton",children:s.jsx(ea,{loading:!0,page:o,type:r,noOfferLink:l,displayLandscapeLayout:A,withoutHeader:H,fopPositionOnPage:he})},`sk-${he}`);const Ie=a==="grid"?Fm:wm;return s.jsx(Ie,{"data-test":"fetching-skeleton",withoutHeader:H,fopView:a},`sk-${he}`)},oe=()=>[...Array(W).keys()].map(ue),ye=async he=>{const Ie=he.filter(ce=>X.current.has(ce.id)?!1:(X.current.add(ce.id),!0));if(Ie.length===0)return;const Fe=uEt(Ie,30),be=Fe.map(ce=>n.fetchFopData({products:ce}));try{(await Promise.allSettled(be)).forEach((me,De)=>{me.status==="rejected"&&Fe[De].forEach(ge=>X.current.delete(ge.id))})}catch{}};return s.jsxs(vo.Container,{ref:T,hideTopBorder:i,"data-synthetics":"product-list","data-test":I,alignItems:j,children:[d?oe():s.jsxs(h.Fragment,{children:[c(),s.jsx(kdt,{scrollableContainerElementRef:C,scrollableElementRef:T,onInitialFopLoad:p,onFopVisibilityChange:he=>P?P(he):ye(he),children:({registerRef:he,visibleFops:Ie})=>s.jsx(aEt,{updateBasketQuantity:ne,draftBasketId:R,type:r,fopView:a,page:o,subPage:q(),pageEventId:w,registerFopRef:he,productGroups:e,visibleProductsByProductId:dEt(Ie,t),rankingScoreByProductId:g,breadcrumbValue:E,noOfferLink:l,orderId:S,hideMoreOptions:_,displayLandscapeLayout:A,fopControlsFactory:N,showMissedPromotions:k,isNextPageFetching:u,pageViewId:G,withoutHeader:H,withinGridProductCards:K})})]}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),M?null:s.jsx(wT,{})]})};mk.propTypes=lEt;mk.defaultProps=cEt;const pEt=e=>({orderId:Ct(e),configurableFopEnabled:iEt(e),pageViewId:Nn(e),breadCrumbs:au(e)}),mEt=st({batchAddToBasket:ir.createBatchAddToBasket(),batchRemoveFromBasket:ir.createBatchRemoveFromBasket(),batchAddItemsToDraftBasket:Pp.createBatchAddToDraftBasket(),batchRemoveItemsFromDraftBasket:Pp.createBatchRemoveFromDraftBasket(),fetchFopData:ai}),uo=we(pEt,mEt)(mk),Pb=(e,t,n)=>t?Qrt({productIdsToSort:e,idsToCompare:n}):e,hEt=v.div`
    border: 0;
    display: flex;
    flex-wrap: wrap;
    margin-inline: calc(-1 * var(--salt-spacing-2));
`,gEt=v.div`
    display: grid;
    position: relative;
    gap: var(--salt-spacing-2);

    ${re.smUp`
        grid-template-columns: 1fr 1fr;
        column-gap: var(--salt-spacing-4);
    `}

    ${re.lgUp`
        grid-template-columns: repeat(auto-fill, minmax(${$(184)}, 1fr));
        column-gap: var(--salt-spacing-4);
    `}
`,EEt=v.div`
    inline-size: 100%;
    margin-block-end: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
`,hk=({basketProducts:e,itemGroups:t})=>{const n="basket",o=f(yT),r=f(TD),a=f(Mye),i=tat(),[l,c,d]=Ee(["bt.spl","ofc","thcu"]),u=os({breakpoint:"lg-up"}),p=tf(),g=f(mo),E=Pb(e,p,o),y=Krt(),I=f(Cu),S=rX(),C=CE(),T=f(ts),{currentBreakpoint:_}=h.useContext(kn),A=_!=="lg",R=f(X=>Ze(X,"seller-sales-enabled")==="true");h.useEffect(()=>{if(c){const X=[];!r&&a&&(C.forEach(q=>{T[q.productId]||X.push(q.productId)}),X.length&&S())}},[]),h.useEffect(()=>{p&&!c&&S()},[I?.length]),h.useEffect(()=>{y()},[]);const P=R?t:[{items:E}],N=X=>R?Pb(X,p,o):E,k=l&&u&&!d?Hs.DETAIL:i,M=X=>({type:Ut.UNKNOWN,section:Ut.UNKNOWN,name:"",products:X,clusterBreadcrumbs:[]}),w=(X,q,ne)=>s.jsx(ZX,{position:q+1,fopPositionOnPage:q,noOfferLink:!1,loading:r,page:n,type:"basket",productId:X,group:M(N(ne)),subPage:null,missedPromotion:{missedPromotionTextAlternative:""}},X),j=(X,q,ne)=>s.jsx(EEt,{children:s.jsx(dZ,{position:q+1,fopPositionOnPage:q,noOfferLink:!1,loading:r,page:n,type:"basket",productId:X,group:M(N(ne)),subPage:null},X)}),G=(X,q,ne)=>s.jsx(ea,{withoutHeader:!0,position:q+1,fopPositionOnPage:q,noOfferLink:!1,loading:r,page:n,type:"basket",productId:X,group:M(N(ne)),subPage:null,displayLandscapeLayout:A},X),W={[Hs.GRID]:w,[Hs.LIST]:j,[Hs.DETAIL]:G},H=X=>W[X],K=i===Hs.DETAIL||l&&A&&!d?gEt:hEt;return s.jsx(h.Fragment,{children:P?.map(({groupName:X,items:q},ne)=>s.jsxs(h.Fragment,{children:[R&&X&&s.jsx(tl,{className:"salt-d--block salt-m-t--4 salt-m-b--2",groupName:X}),c&&s.jsx(K,{"data-synthetics":"product-list",children:q.map((ue,oe)=>H(k)(ue,oe,q))}),!c&&s.jsx(uo,{onInitialFopLoad:y,productGroups:[{products:R?Pb(q,p,o):E}],productsByProductId:g,page:n,type:"basket",isFetching:r,fopView:k,withoutHeader:!0})]},`${X}${ne}`))})},UG=42,GG=42,gk=60,fEt=8,yEt=25,IEt=(e=[])=>e.reduce((t,{quantity:{quantityInBasket:n}})=>t+n,0),uJ=e=>{const t=L(),n=IEt(e);return n===1?t.formatMessage("checkout.summary.basket.overview.header.items.singular",{productsQuantity:n}):t.formatMessage("checkout.summary.basket.overview.header.items",{productsQuantity:n})},pJ=({name:e,basketItems:t})=>{const n=uJ(t);return`${e} ${n}`},SEt=(e,t)=>{const[n,o]=h.useState(0),r=a=>o(()=>a?.offsetWidth??0);return h.useEffect(()=>{const a=e.current;return r(a),window.addEventListener("resize",()=>r(a)),()=>window.removeEventListener("resize",()=>r(a))},[e,t]),n},mJ=({items:e})=>{const t=F(),n=f(ts),[o,r]=h.useState([]),a=kO(o,250),[i,l]=h.useState(!1);h.useEffect(()=>{const c=e.map(({productId:d})=>d).filter(d=>!n[d]).filter(d=>!o.includes(d));c.length&&r([...o,...c])},[e]),h.useEffect(()=>{(async()=>{if(i||!a.length)return;l(!0);const d=a.slice(0,yEt);await t(ai({products:d.map(p=>({id:p}))})),l(!1);const u=o.filter(p=>!d.includes(p));r(u)})()},[a])},CEt=(e,t)=>e?t.slice(t.length-e).reduce((n,{quantity:{quantityInBasket:o}})=>n+o,0):0,vEt=(e,t)=>t?e.slice(0,e.length-t):e,TEt=(e,t)=>{const n=t-Math.floor(e/(gk+fEt))+1;return e?n<0?0:n:t-1},_Et=v.div`
    position: absolute;
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
    inset-block-start: calc(var(--salt-spacing-2) * -1);
`,bEt=({quantityInBasket:e})=>e<2?null:s.jsx(_Et,{"aria-hidden":"true",children:s.jsx(Ll,{intent:"action",count:e})}),$G=v.div.withConfig({shouldForwardProp:e=>!["fullWidth"].includes(e)})`
    position: relative;
    inline-size: ${({fullWidth:e})=>e?"100%":`${gk}px`};
`,hJ=Pe`
    inline-size: ${`${gk}px`};
    display: flex;
    justify-content: center;
    align-items: center;
`,xEt=v.div`
    ${hJ}
`,AEt=v.button`
    border-radius: var(--salt-radius-default);
    ${hJ}
`,gJ=({fullWidth:e,children:t,showBadge:n=!1,blurOverlay:o,basketItem:r})=>{const a=L(),l=f(ts)[r?.productId];if(!l)return s.jsx($G,{fullWidth:e,children:s.jsx(xe,{asChild:!0,condensed:!0,children:s.jsx(Q,{align:"center",wrap:"nowrap",children:s.jsx(_e,{width:`${UG}px`,height:`${GG}px`})})})});const{alcohol:c,image:d,name:u}=l,{quantity:{quantityInBasket:p}}=r,g=a.formatMessage("basket.overview.header.list.accessibility.item.title",{productName:u,productQuantity:p});return s.jsx($G,{fullWidth:e,children:s.jsxs(xe,{condensed:!0,children:[s.jsx(Ji,{isActive:c,overlay:o,children:s.jsxs(Q,{align:"center",wrap:"nowrap",children:[s.jsx(el,{alt:t?"":g,src:d?.src,width:UG,height:GG}),t]})}),n&&s.jsx(bEt,{quantityInBasket:p})]})})},REt=({quantityOfHiddenItems:e,setExpanded:t})=>{const n=L();return e?t?s.jsxs(AEt,{onClick:()=>t(o=>!o),children:[s.jsxs(O,{"aria-hidden":!0,children:["+",e]}),s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:n.formatMessage("basket.overview.header.list.accessibility.hidden.products.counter.expandable",{quantityOfHiddenItems:e})})})]}):s.jsx(xe,{asChild:!0,condensed:!0,children:s.jsxs(xEt,{children:[s.jsxs(O,{size:"l",bold:!0,"aria-hidden":!0,children:["+",e]}),s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:n.formatMessage("basket.overview.header.list.accessibility.hidden.products.counter",{quantityOfHiddenItems:e})})})]})}):null},VT=({visible:e,setExpanded:t,basketItems:n=[]})=>{const o=h.useRef(null),r=SEt(o,e),a=TEt(r,n.length),i=vEt(n,a),l=CEt(a,n);return mJ({items:i}),s.jsxs(Q,{ref:o,className:"salt-m-t--4",gap:["sm"],children:[i.map(c=>s.jsx(gJ,{basketItem:c,showBadge:!0},c.productId)),s.jsx(REt,{quantityOfHiddenItems:l,setExpanded:t})]})},hf=({name:e,as:t,basketItems:n})=>{const o=pJ({basketItems:n,name:e}),r=t||"h2";return s.jsx(ie,{asChild:!0,children:s.jsx(r,{children:o})})},Gm=({name:e,basketItems:t,as:n,showQuantity:o=!0})=>{const r=uJ(t);return s.jsxs(h.Fragment,{children:[s.jsxs(Q,{as:"span",align:"baseline","data-test":"basket-overview-header",className:"salt-gap-x--2",children:[s.jsx(ee,{as:"span",children:e}),o&&s.jsx(O,{children:r})]}),!!n&&s.jsx(hf,{basketItems:t,name:e,as:n})]})},EJ=se("GET_CARRIER_DETAILS"),DEt=e=>({type:"API",payload:{url:`/v1/carriers/${e}`,service:"ecomslots",pathPrefix:{client:"/api/ecomslots",server:"/core-api"},options:{method:"GET"},...EJ}}),OEt={getCarrierDetails:DEt,types:{GET_CARRIER_DETAILS:EJ}},HG={carrierDetails:null,isReady:!0},$m=({carrierId:e,shippingGroupType:t})=>{const n=F(),o=f(Sv),r=f(RE(t)),a=e&&r,i=o.find(d=>d.carrierId===e),[l,c]=h.useState({carrierDetails:null,isReady:!1});return h.useEffect(()=>{a&&!i&&n(OEt.getCarrierDetails(e)).then(d=>{c({carrierDetails:d?.payload.responseData||null,isReady:!0})}).catch(()=>{c(HG)})},[e,t]),a?i?{carrierDetails:i,isReady:!0}:l:HG},fJ=e=>{const[t]=Ee(["sl.fd"]);return!!t&&!!e&&e.slotType==="ON_DEMAND"&&e.deliveryMethod==="HOME_DELIVERY"},PEt=({startDate:e,endDate:t})=>{const n=L(),o=os({breakpoint:"md-up"});if(Nd(t))return n.formatMessage("delivery.relative.date.today");if(ng(t))return n.formatMessage("delivery.relative.date.tomorrow");if(kI(e,t)===0)return gt(t,Sr);const a=gt(e,Ax),i=gt(t,Ax),l=a===i?gt(e,aC):gt(e,Sr),c=gt(t,Sr);return n.formatMessage(o?"order.card.courier.title.short":"order.card.courier.title",{startDay:l,endDay:c})},NEt=({startDate:e,endDate:t})=>{const n=PEt({startDate:e,endDate:t});return s.jsx(ae.Fragment,{children:n})},Hm=({dates:e,carrierType:t,slotTimesDisplayMode:n=d4,showAsCardTitle:o=!1,ignorePrefix:r=!1})=>{const a=L(),i=f(Zt),l=f(Mt),c=t===tP,d=s.jsx(qn,{dateIsoFrom:e.deliveryStartDate,dateIsoTo:e.deliveryEndDate,timeZoneId:e.timeZoneId,dateFormat:i,timeFormat:l});if(c)return s.jsx(h.Fragment,{children:!o&&!r?s.jsx(b,{id:"delivery.view.delivery.details.title",values:{content:d}}):d});const u=RHe(n,e,a);return s.jsx(h.Fragment,{children:o?s.jsx(NEt,{startDate:e.deliveryStartDate||"",endDate:e.deliveryEndDate||""}):s.jsx(h.Fragment,{children:r?u:s.jsx(b,{id:"delivery.view.delivery.details.title",values:{content:u}})})})},LEt=({slot:e})=>{const t=f(Zt),n=f(Mt);return s.jsx(O,{children:s.jsx(qn,{dateIsoFrom:e.start,dateIsoTo:e.end,timeZoneId:e.timeZoneId,dateFormat:t,timeFormat:n})})},kEt=({slot:e})=>{const{deliveryTimeInMinutes:t,collectionTimeInMinutes:n}=e,o=Zi(),r=o(t),a=o(n);return s.jsx(O,{children:s.jsx(b,{id:"basket.checkout.group.delivery.slot.express.collection.info",values:{readyTimeSpan:r,maxTimeSpan:a}})})},jEt=({slot:e})=>{const{formatNumber:t}=L(),{deliveryTimeInMinutes:n}=e,o=r=>t(r||0,{style:"unit",unit:"minute",unitDisplay:"short"});return s.jsx(O,{children:s.jsx(b,{id:"trolley.screen.group.checkout.slot.fast.delivery.info",values:{duration:o(n||0)}})})},MEt=({slot:e,carrierDetails:t})=>{const n=s.jsx(Hm,{dates:{deliveryStartDate:e?.start,deliveryEndDate:e?.end,deliveryTimeInMinutes:e?.deliveryTimeInMinutes,collectionTimeInMinutes:e?.collectionTimeInMinutes,timeZoneId:e?.timeZoneId},carrierType:t?.slotBookingComponent,slotTimesDisplayMode:t?.slotTimesDisplayMode,ignorePrefix:!0});return s.jsxs(O,{children:[" ",n," "]})},wEt=({slot:e,isCourierSlot:t,carrierDetails:n})=>{const o=fJ(e);return t?s.jsx(MEt,{slot:e,carrierDetails:n}):e.slotType==="ON_DEMAND"&&e.deliveryMethod==="CUSTOMER_COLLECTION"?s.jsx(kEt,{slot:e}):o?s.jsx(jEt,{slot:e}):s.jsx(LEt,{slot:e})},yJ=({slot:e,slotBooked:t,className:n,shippingGroupType:o})=>{const{isReady:r,carrierDetails:a}=$m({carrierId:e?.carrierId,shippingGroupType:o}),i=!r||!!a,l=fJ(e);if(!e)return null;const c=t?s.jsx(b,{id:"basket.checkout.group.delivery.slot.booked"}):s.jsx(b,{id:"basket.checkout.group.delivery.slot.first.available"});return s.jsxs("div",{"data-test":"basket-delivery-info",className:n,children:[!(i||l)&&s.jsxs(h.Fragment,{children:[s.jsx(O,{"data-test":`basket-delivery-info-slot-${t?"booked":"available"}`,children:c})," "]}),s.jsx(wEt,{slot:e,isCourierSlot:i,carrierDetails:a})]})},Ek=e=>{const t=f(tu),n=t.length;return{order:t.findIndex(r=>r?.checkout?.shippingGroupType===e)+1,count:n}},FEt=e=>{const t=L(),{order:n,count:o}=Ek(e);return o>1?t.formatMessage("basket.checkout.group.checkout.button",{order:n,count:o}):t.formatMessage("basket.summary.checkout")},BEt=(e,t)=>{const n=L(),{order:o,count:r}=Ek(e);return n.formatMessage("basket.checkout.group.overview.header.main",{name:t,order:o,count:r})},IJ=({basketSummary:e,withTaxNote:t=!0})=>{const{itemGroups:n=[],totalsGroups:o=[],items:r}=e,a=f(D("prp")),i=f(D("sib"));return s.jsx("div",{"data-test":"summary-items-by-seller-list",children:o.map(({groupName:l,totals:c},d)=>{const u=kT(n,l,r),p=!!Number(c?.savingsPrice?.amount);return u?s.jsxs(h.Fragment,{children:[d>0&&s.jsx(le.Separator,{className:"salt-m-b--2"}),s.jsx(tl,{groupName:l,className:"salt-d--block salt-m-b--2"}),s.jsxs(fe,{"data-test":`summary-items-${Pi(l)}`,children:[s.jsx(le.Items,{itemsRetailPrice:c.itemsRetailPrice,quantity:u,withTaxNote:t}),s.jsx(le.Savings,{savings:c.savingsPrice}),i&&a&&p&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:c.paymentMethodSavingsPrice}),o.length>1&&s.jsx(of,{value:c.display?.itemPriceAfterPromos,withSeparator:!1,className:"salt-m-t--1 salt-m-b--1"})]})]},l):null})})},UEt=D("tx.nts"),GEt=Wn(["sumsub","bt.spl"]),$Et=({basketSummary:e,checkoutButtonName:t})=>{const{itemGroups:n}=e,o=e?.checkout?.shippingGroupType,r=e?.checkout?.shippingGroupTypeDisplayName,a=L(),[i]=Ee(["thcu"]),[l,c]=h.useState(!1),d=ft(),u=f(M=>Ze(M,"seller-sales-enabled")==="true"),{smallOrderChargeThresholds:p,shouldDisplaySmallOrderCharge:g}=RT(e),y=f(Fye(o)).map(M=>M.productId),I=f(UEt),S=f(GEt),C=a.formatMessage(S?"summary.subtotal":"summary.total"),T=a.formatMessage("summary.total.note"),_=a.formatMessage("summary.subtotal.price.note"),A=S?e?.totals?.display?.itemPriceAfterPromos:e?.totals?.display?.finalPrice,R=BEt(o,r),P=f(vD(o)),N=pJ({name:R,basketItems:P}),k=h.useMemo(()=>({expanded:l,onToggle:()=>{d({type:l?Ve.ITEM_WINDOW_REDUCED:Ve.ITEM_WINDOW_EXPANDED}),c(!l)},aria:{expandedLabel:N,collapsedLabel:N}}),[l,N,d]);return s.jsxs(ov.Provider,{value:k,children:[s.jsx(hf,{basketItems:P,name:R}),s.jsxs(xe,{children:[s.jsxs(Je.ControlSection,{children:[s.jsx(Gm,{basketItems:P,name:R,showQuantity:!i}),s.jsx(Je.ToggleSwitch,{"data-test":"collapsible-box-toggle-switch"})]}),s.jsxs(Je.ContentCollapsed,{maxHeight:"100px",children:[s.jsx(VT,{basketItems:P,visible:!l,setExpanded:c}),s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(le.Separator,{className:"salt-m-t--4"})})]}),!i&&s.jsx(Je.ContentExpanded,{children:s.jsx(yJ,{slotBooked:!!e.slot,slot:e.slot||e.nextAvailableSlot,shippingGroupType:o,className:"salt-m-t--4"})}),s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsxs(Je.ContentCollapsed,{children:[s.jsx(le.TotalSpaceBetween,{loading:!e,totalPrice:A,withTaxNote:I,title:C,note:S?_:T}),s.jsx(Rg,{loyalty:e?.loyalty?.earnings}),s.jsx(Lp,{basketSummary:e,dataTest:"minimum-order-summary"}),g&&s.jsx($d,{thresholds:p,orderId:e?.orderId,page:"basket",className:"salt-m-t--2"}),s.jsx(le.Buttons,{loading:!e,children:s.jsx(Np,{name:t,basketSummary:e,className:"salt-m-t--4"})})]})})]}),s.jsxs(Je.ContentExpanded,{maxHeight:"100%",overflow:"visible",children:[s.jsx("div",{className:"salt-m-t--2 lg:salt-m-t--4",children:s.jsx(hk,{basketProducts:y,itemGroups:n})}),s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsxs(xe,{className:"salt-m-t--2",children:[u?s.jsx(IJ,{basketSummary:e,withTaxNote:I}):s.jsx(zX,{basketSummary:e,withTaxNote:I,summarySubtotalEnabled:S}),s.jsx(le.Separator,{}),s.jsx(le.TotalSpaceBetween,{loading:!e,totalPrice:A,withTaxNote:I,title:C,note:S?_:T}),s.jsx(Rg,{loyalty:e?.loyalty?.earnings}),s.jsx(Lp,{basketSummary:e,dataTest:"minimum-order-summary"}),g&&s.jsx($d,{thresholds:p,orderId:e?.orderId,page:"basket",className:"salt-m-t--2"}),s.jsx(le.Buttons,{loading:!e,children:s.jsx(Np,{name:t,basketSummary:e,className:"salt-m-t--4"})})]})})]})]})},HEt=D("tx.nts"),VEt=Wn(["sumsub","bt.spl"]),WEt=D("loy.waon"),SJ=e=>{const{basketSummary:t,loading:n,loadedViewPortSize:o,sticky:r=!0,checkoutButtonName:a,name:i,ariaHeader:l,showMinimumSpend:c=!1}=e,[d,u]=h.useState(!0),p=os({breakpoint:"lg-up"});h.useEffect(()=>{u(!p)},[]);const g=IX(d,u),{formatMessage:E}=L(),y=He(),I=f(HEt),S=f(VEt),C=f(WEt),T=f(D("oed")),{smallOrderChargeThresholds:_,shouldDisplaySmallOrderCharge:A}=RT(t),R=f(G=>Ze(G,"seller-sales-enabled")==="true"),P=E("summary.title"),N=E(S?"summary.subtotal":"summary.total"),k=E("summary.total.note"),M=E("summary.subtotal.price.note");if(!t||!o)return s.jsxs(Kt,{breakpoint:"lg-up",children:[s.jsx(js,{children:s.jsx(js.Skeleton,{})}),s.jsx(le.Buttons,{loading:!0})]});const w=C&&!T?t?.totals?.paymentSplit?.remainingPayment:t?.totals?.display?.finalPrice,j=S?t?.totals?.display?.itemPriceAfterPromos:w;return s.jsxs(cs,{name:i,expanded:d,onToggle:g,breakpoint:"lg-up",sticky:r,aria:{contentLabel:l?`${l}${P}`:P,totalPrice:j&&y(j)},children:[s.jsxs(cs.ControlSection,{children:[d?s.jsx(ee,{as:"span",children:P}):s.jsx(le.TotalInline,{loading:!t,totalPrice:j,withTaxNote:I,title:N,note:S?M:k}),s.jsx(cs.ToggleSwitch,{})]}),s.jsxs(cs.Content,{children:[R?s.jsx("div",{className:"salt-m-t--2",children:s.jsx(IJ,{basketSummary:t,withTaxNote:I})}):s.jsx(zX,{basketSummary:t,withTaxNote:I,summarySubtotalEnabled:S}),s.jsx(le.Separator,{}),s.jsx(le.TotalSpaceBetween,{loading:!t,totalPrice:j,withTaxNote:I,title:N,note:S?M:k})]}),s.jsx(Rg,{loyalty:t?.loyalty?.earnings}),c&&s.jsx(Lp,{basketSummary:t,dataTest:"minimum-order-summary"}),A&&s.jsx($d,{orderId:t.orderId,thresholds:_,page:"basket",className:"salt-m-t--2"}),s.jsx(le.Buttons,{loading:n,children:s.jsx(Np,{name:a,basketSummary:t,className:"salt-m-t--4"})})]})},YEt=({basketSummary:e})=>{const t=e?.checkout?.shippingGroupType,{formatMessage:n}=L(),[o,r]=h.useState(!1),a=FEt(t),{order:i,count:l}=Ek(t),c=n("basket.checkout.group.overview.header.main",{name:"",order:i,count:l}),d=f(D("csc.b")),{smallOrderChargeThresholds:u,shouldDisplaySmallOrderCharge:p}=RT(e),{totalPrice:g,priceNote:E,summaryTitle:y,totalPriceTitle:I,ariaExpandedLabel:S,ariaCollapsedLabel:C}=$X(e),T=`${n("summary.title")} ${c}`;return h.useEffect(()=>{r(!0)},[]),s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,lg:9},children:s.jsx("div",{"data-test":"basket-products-overview",children:s.jsx($Et,{basketSummary:e,checkoutButtonName:a})})}),s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(V.Item,{colSpan:{lg:3},children:s.jsx("div",{"data-test":"basket-collapsible-summary",children:d?s.jsxs(wL,{summaryTitle:y,totalPrice:g,totalPriceTitle:I,priceNote:E,loading:!e,basketSummary:e,breakpoint:"lg-up",loadedViewPortSize:o,ariaExpandedLabel:S,ariaCollapsedLabel:C,ariaHeader:T,name:Pi(t),renderButtonsSection:()=>s.jsx(Np,{name:a,basketSummary:e,className:"salt-m-t--4"}),renderItemsSection:()=>s.jsx(qX,{basketSummary:e,page:"basket"}),renderItemsBySellerSection:()=>s.jsx(KX,{basketSummary:e}),children:[s.jsx(Rg,{loyalty:e?.loyalty?.earnings}),e&&s.jsx(Lp,{basketSummary:e,dataTest:"minimum-order-summary"}),p&&s.jsx($d,{orderId:e.orderId,thresholds:u,page:"basket",className:"salt-m-t--2"})]}):s.jsx(SJ,{basketSummary:e,loadedViewPortSize:o,loading:!e,checkoutButtonName:a,name:Pi(t),ariaHeader:T,showMinimumSpend:!0})})})})]})},CJ=()=>{const e=IT(SL),t=f(Bye);return s.jsxs(h.Fragment,{children:[s.jsx(x,{"data-test":"basket-remove-unavailable-items-open-modal-button","data-synthetics":"basket-remove-unavailable-items-open-modal-button",onClick:e,intent:"secondary",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"basket.remove.unavailable.items.button.text"})})}),s.jsx(pX,{products:t})]})},qEt=()=>{const e=L(),[t]=Ee(["thcu"]),[n,o]=h.useState(!1),r=f(jC),a=r.map(l=>l.productId),i=e.formatMessage("basket.unavailable.items.section.title");return s.jsxs(Je,{expanded:n,onToggle:()=>o(l=>!l),name:"basket-unavailable-items",aria:{expandedLabel:e.formatMessage("basket.unavailable.items.section.title"),collapsedLabel:e.formatMessage("basket.unavailable.items.section.title")},children:[s.jsx(hf,{basketItems:r,name:i}),s.jsxs(Je.ControlSection,{children:[s.jsx(Gm,{basketItems:r,name:i,showQuantity:!t}),s.jsx(Je.ToggleSwitch,{"data-test":"collapsible-box-toggle-switch"})]}),s.jsxs(Je.ContentCollapsed,{maxHeight:"100px",children:[s.jsx(VT,{basketItems:r,visible:!n,setExpanded:o}),s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx("div",{className:"salt-m-t--4",children:s.jsx(le.Separator,{})})})]}),s.jsx(Je.ContentExpanded,{maxHeight:"100%",overflow:"visible",children:s.jsx("div",{className:"salt-m-t--4 salt-m-r--1 salt-m-l--1",children:s.jsx(hk,{basketProducts:a})})}),s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx("div",{className:"salt-m-t--2",children:s.jsx(CJ,{})})})]})},KEt=()=>s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,lg:9},children:s.jsx("div",{"data-test":"basket-unavailable-items-overview-section",children:s.jsx(qEt,{})})}),s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(V.Item,{colSpan:{lg:3},children:s.jsx("div",{"data-test":"basket-remove-unavailable-items-section",children:s.jsx(CJ,{})})})})]}),zEt=({order:e,count:t,shippingGroupType:n,shippingGroupTypeDisplayName:o})=>{const r=L(),a=f(vD(n)),i=r.formatMessage("basket.checkout.group.overview.header.main",{name:o,order:e,count:t});return s.jsxs(h.Fragment,{children:[s.jsx(Gm,{name:i,basketItems:a,as:"h2"}),s.jsx(VT,{visible:!0,basketItems:a}),e<t&&s.jsx("div",{className:"salt-m-b--4"})]})},QEt=()=>{const e=Pm(gX),n=Om()?"left":"center",o=Fl(),r=f(tu);return s.jsxs(B,{isOpen:e,onRequestClose:o,aria:{labelledby:pG},children:[s.jsx(B.Header,{align:n,children:s.jsx(ee,{as:"h1",id:pG,children:s.jsx(b,{id:"basket.multiple.deliveries.modal.heading"})})}),s.jsxs(B.Body,{children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(O,{size:"l",children:s.jsx(b,{id:"basket.multiple.deliveries.modal.info"})})}),r.map((a,i)=>s.jsx(zEt,{order:i+1,count:r.length,shippingGroupType:a?.checkout?.shippingGroupType,shippingGroupTypeDisplayName:a?.checkout?.shippingGroupTypeDisplayName},a?.checkout?.shippingGroupType))]}),s.jsx(B.Footer,{align:n,flow:"column",children:s.jsx(x,{fill:!0,intent:"primary","data-test":"multipl-deliveries-confirm",onClick:o,children:s.jsx(x.Text,{children:s.jsx(b,{id:"basket.multiple.deliveries.modal.confirm"})})})})]})},XEt=e=>{const[t]=Ee(["thcu"]),{basketCheckoutGroups:n}=e,o=f(jC),r=f(Hi),a=F();return h.useEffect(()=>{!localStorage.getItem(cg)&&r&&n.length>1&&(localStorage.setItem(cg,"true"),a(J.openModal(gX)))},[n.length,r,a]),s.jsx(V,{flush:!0,children:s.jsxs(V.Item,{colSpan:{xs:12},children:[n.map((i,l)=>s.jsxs(h.Fragment,{children:[s.jsx(YEt,{basketSummary:i}),l+1<n.length&&s.jsx(Ts,{className:"salt-m-y--4"})]},i?.checkout?.shippingGroupType)),!!o.length&&s.jsxs(h.Fragment,{children:[!!n.length&&s.jsx(Ts,{className:"salt-m-y--4"}),s.jsx(KEt,{})]}),t&&s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(TS,{className:"salt-m-y--4"})}),s.jsx(QEt,{})]})})},Ul=e=>e.data.toggleablePromotions?.data,vJ=Y(Ul,e=>e&&(R3(e)||D3(e))),ZEt=Y(Ul,e=>e&&!R3(e)&&D3(e)),TJ=Y(Ul,e=>e&&OWe(e)),_J=Y(Ul,e=>e&&PWe(e)),bJ=Y(Ul,e=>e&&jWe(e)),xJ=Y(Ul,e=>e&&FWe(e)),AJ=Y(Ul,e=>e&&GWe(e)),RJ=Y(Ul,e=>e&&$We(e)),fk=Y(Ul,e=>e&&HWe(e)),JEt=Y(RJ,fk,(e,t)=>e&&t&&VWe(e,t)),yk=Y(RJ,e=>e&&WWe(e)),DJ=Y(fk,e=>e&&YWe(e)),eft=Y(_J,e=>e&&qWe(e)),tft=Y(bJ,e=>e&&KWe(e)),sft=e=>e===_n.SAVING?"orders":e===_n.LOYALTY?"loyalty":e===_n.DELIVERY?"home_delivery":"",OJ=({dataToDisplayList:e,as:t,handleClick:n})=>{const o=Object.keys(e);return s.jsx(gn,{direction:"column","data-test":"promotions-summary-list",gap:["md"],children:o.map(r=>e[r]?.length?s.jsxs(gn,{direction:"row","data-test":`list-item-${r}`,type:t==="button"?"button":void 0,as:t??"div",onClick:n,gap:["sm"],align:"flex-start",wrap:"nowrap",children:[s.jsx(pe,{name:sft(r),height:18,width:18}),s.jsx(gn,{direction:"column",gap:["xs"],children:e[r]?.map((a,i)=>s.jsx(O,{"data-test":`description-${r}`,children:a},`${a}-${i}`))})]},r):null)})},nft=e=>{const t=L(),n=f(yk),o=f(DJ),r=f(JEt),[a,i]=Ee(["tp","tp.new"]),l=i&&!a,c=t.formatMessage("toggleablepromotions.list.no.discounts.selected"),d=t.formatMessage("toggleablepromotions.list.empty")||"No discount applied";return s.jsx("div",{className:"salt-p-b--4",children:n||o?s.jsx(OJ,{dataToDisplayList:r,...e}):s.jsx(O,{"data-test":"promotions-summary-list-no-discounts",children:l?d:c})})},PJ=()=>{const e=F(),t=L(),n=MO(),o=t.formatMessage("toggleablepromotions.list.button.edit"),r=t.formatMessage("toggleablepromotions.list.button.select"),a=t.formatMessage("toggleablepromotions.list.alert.preapplied"),[i,l]=Ee(["tp","tp.new"]),c=l&&!i,d=f(yk),u=f(ZEt),p=()=>{n(ed),e(cp({type:Bo.ORDER_DISCOUNT_FORM_MODAL_DISPLAYED,description:"A modal for order promotions is displayed",source:"orderPromotionsButtonClicked"})),e(J.openModal("discountOnOrder"))};return s.jsxs(h.Fragment,{children:[s.jsx(nft,{}),u&&!c?s.jsx(O,{"data-test":"promotions-summary-alert-pre-applied-only",children:a}):s.jsx(x,{fill:!0,intent:"secondary",onClick:()=>p(),"data-test":"edit-select-promotions-button",children:s.jsx(x.Text,{"data-test":"edit-select-promotions-button-text",children:c||!d?r:o})})]})},oft=({isPromotionsAvailable:e,intl:t,actions:{getToggleablePromotions:n,sendPromotionsDropdownClickedPageEvent:o}})=>{const[r,a]=h.useState(!1),i=()=>a(p=>!p);if(h.useEffect(()=>{n()},[]),!e)return null;const l=t.formatMessage("toggleablepromotions.accessibility.toggle.switch.on.label"),c=t.formatMessage("toggleablepromotions.accessibility.toggle.switch.off.label"),d=t.formatMessage("toggleablepromotions.list.title"),u=()=>{i(),o()};return s.jsxs(Je,{expanded:r,onToggle:u,aria:{expandedLabel:l,collapsedLabel:c},name:"collapsible-promotions",children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{as:"span",children:d}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentExpanded,{children:s.jsx("div",{className:"salt-p-t--4",children:s.jsx(PJ,{})})})]})},rft=e=>({isPromotionsAvailable:vJ(e)}),aft=st({sendPromotionsDropdownClickedPageEvent:JWe,getToggleablePromotions:Bd}),TA=Tt(Ht,we(rft,aft))(oft),ift=e=>async t=>{if(!e)return null;try{const n=await t(aI.fetchNextAvailableSlot(e));return U8(n?.payload?.responseData)}catch{return null}},lft={fetchNextAvailableSlot:ift},cft=D("bt.spl"),NJ=()=>{const e=ci(),[t,n]=h.useState(ct()),o=Zi(),r=F(),a=new URLSearchParams([["source","homepage card"],["sourceEventId",t]]),i=rf({searchParams:a}),l=f(Zt),c=f(Mt),d=f(Ct),u=f(Z9e),p=f(cft),g=f($i),E=f(Oo),y=h.useRef(u.lastUpdated),I=u.data?"next available slot":"book a slot",S=p?"logged.in.home.page.book.slot.card.title.grocery":"logged.in.home.page.book.slot.card.title";h.useEffect(()=>{p?C():r(lft.fetchNextAvailableSlot(g))},[g]),h.useEffect(()=>{!u.isFetching&&u.lastUpdated&&y.current!==u.lastUpdated&&C(),y.current=u.lastUpdated});const C=()=>{r(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"slot booking",STATUS:I}}))},T=()=>{const N=u.data?.startTime,k=u.data?.endTime,M=u.data?.timeZoneId,w=u.data?.address,j=u.data?.type,G=u.data?.deliveryTimeInMinutes,W=u.data?.deliveryMethod,H=j==="ON_DEMAND"&&W==="CUSTOMER_COLLECTION",K=H?"logged.in.home.page.book.slot.card.subtitle.next.available.express.collection.slot":"logged.in.home.page.book.slot.card.subtitle.slot.and.address.format",X=H?null:s.jsx(qn,{dateIsoFrom:N,dateIsoTo:k,timeZoneId:M,dateFormat:l,timeFormat:c}),q=o(G);return w?s.jsx(b,{"data-test":"next-available-slot-card-formatted-interval",id:K,values:{interval:X,address:w.nickname,readyTimeSpan:q}}):X},_=async()=>{r(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Body",componentType:"Card",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),r(U.analyticsEvent({type:Xt.HOMEPAGE_SLOT_BOOKING_CARD_CLICKED,status:I,orderId:d,pageEventId:t}));const N=await ko.fetchAnalyticsMetadataByActiveCart(E);r(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:N})),e(N),n(ct())},A=N=>r(ds({name:sm,event:N})),R=N=>{A(N),_()},P=()=>{const N=u.data?.type,k=u.data?.deliveryMethod,M=N==="ON_DEMAND"&&k==="HOME_DELIVERY";return u.data&&!M?s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"logged.in.home.page.book.slot.card.subtitle.next.available.slot"})," ",T()]}):s.jsx(b,{id:"logged.in.home.page.book.slot.card.subtitle.no.next.available.slot"})};return g&&(u.isFetching||!u.lastUpdated&&!u.fetchError&&!p)?s.jsx(vs.Skeleton,{description:!0,"data-test":"slot-card-skeleton"}):s.jsx(vs,{"data-test":"next-available-slot-card",title:{text:s.jsx(b,{id:S}),as:"h2"},description:P(),icon:"slot",onClick:R,to:i})},LJ=()=>{const e=F(),{formatMessage:t}=L();return h.useEffect(()=>{e(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"slot booking",STATUS:"slots not available"}}))},[]),s.jsx(hR,{"data-test":"slot-service-down-card",title:{text:t("logged.in.home.page.book.slot.card.title.na"),as:"h2"},description:t("logged.in.home.page.book.slot.card.subtitle.na"),icon:"info_default"})},dft=D("mtz"),Cl=({dateIso:e,timeZoneId:t,timeFormat:n,local:o})=>{const r=f(Xd)||"",a=f(dft),i=f(Rt);if(!e)return null;if(!a)return s.jsx(ae.Fragment,{children:PH(n,e)});if(i)return null;const{displayTimeZoneId:l,showTimeZoneAbbreviation:c}=kv(t,r,o);return s.jsx(ae.Fragment,{children:IR(e,l,n,c)})},uft=e=>{const t=Ki(e,Ct(e));return t?{start:t.dates.deliveryStartDate,end:t.dates.deliveryEndDate,timeZoneId:t.dates.timeZoneId,nickname:t.addressNickName,slotId:t.slotId}:null},pft=({componentContext:e})=>{const t=ci(),n=F(),{formatMessage:o,formatNumber:r}=L(),a=He(),i=f(xn),l=f(Jg),c=f(Ct),d=f(Zt),u=f(Mt),p=f(uft),g=i&&i.deliveryType===pt.clickAndCollect.type,[E,y]=h.useState(ct()),I=Zi(),S=f(D("mins")),C=f(Oo),T=S?a(l):null,_=S?o("slot.card.minimum.order.text",{amount:T}):null,A=()=>s.jsx(b,{id:"slotbooking.navigation.card.change.slot.title"}),R=X=>s.jsx(qn,{dateIsoFrom:X.start,dateIsoTo:X.end,timeZoneId:X.timeZoneId,local:!0,dateFormat:d,timeFormat:u}),P=()=>i?s.jsx(b,{id:"slotbooking.navigation.card.subtitle.slot.and.address.format",values:{interval:R(i),address:i.nickname}}):null,N=()=>i?s.jsx(Cl,{dateIso:i.expiryTime,timeZoneId:i.timeZoneId,local:!0,timeFormat:u}):null,k=()=>s.jsx(b,{id:"slotbooking.navigation.card.change.slot.expiration.alert.text.hint",values:{expiryTime:N()}}),M=()=>{if(!i)return null;const{slotType:X,deliveryMethod:q,deliveryTimeInMinutes:ne,collectionTimeInMinutes:ue,nickname:oe}=i,ye=he=>r(he||0,{style:"unit",unit:"minute",unitDisplay:"short"});switch(!0){case(X===Qa&&q===pt.clickAndCollect.method):return s.jsx(b,{id:"slotbooking.navigation.card.express.collection.slot.new",values:{address:oe,readyTimeSpan:I(ne),maxTimeSpan:I(ue)}});case(X===Qa&&q===pt.vanDelivery.method):return s.jsx(b,{id:"slotbooking.navigation.card.fast.delivery.slot.new",values:{address:oe,duration:ye(ne||0)}});default:return s.jsx(b,{id:"slotbooking.navigation.card.slot.new",values:{newSlotDeliveryInterval:R(i),address:oe}})}},w=()=>p?s.jsx(b,{id:"slotbooking.navigation.card.slot.old",values:{oldSlotDeliveryInterval:R(p),address:p.nickname}}):null,j=()=>p&&i&&p.slotId!==i.slotId,G=X=>{n(ds({name:sm,event:X}))},W=async()=>{n(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Body",componentType:"Card",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),n(U.analyticsEvent({type:Gs.EDIT_PAGE_SLOT_BOOKING_CARD_CLICKED,status:"slot reserved",orderId:c,pageEventId:E}));const X=await ko.fetchAnalyticsMetadataByActiveCart(C);n(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:X})),t(X),y(ct())},H=X=>{G(X),W()},K=Js(Tr({inCheckoutWalk:!1}));return s.jsx(vs,{"data-test":"slot-edit-card",title:{text:A(),as:"h2"},description:j()?M():P(),additionalInfo:j()?w():_,icon:`${g?"click_collect":"home_delivery"}`,alertBanner:i&&i.expiryTime?{intent:"warning",text:k()}:void 0,onClick:H,to:{...K,search:`${K.search}&source=${encodeURIComponent(e)}&sourceEventId=${E}`}})},mft=({componentContext:e})=>{const t=f(a=>is(a)),n=f(sE),o=f(BR);return!n&&t.isFetching?s.jsx(vs.Skeleton,{"data-test":"slot-card-skeleton"}):n?s.jsx(pft,{componentContext:e}):o||t&&t.fetchError?s.jsx(LJ,{}):s.jsx(NJ,{})},Nb={EXCEEDED_MAX_QUANTITY_MULTIPLE:"EXCEEDED_MAX_QUANTITY_MULTIPLE",EXCEEDED_MAX_QUANTITY_SINGLE:"EXCEEDED_MAX_QUANTITY_SINGLE",TIME_RESTRICTION_MERGE_EDIT:"TIME_RESTRICTION_MERGE_EDIT"},hft={LIMITED_AVAILABILITY:"basket.merge.limited.availability",NO_AVAILABILITY:"basket.merge.no.availability",EXCEEDED_MAX_QUANTITY:"basket.merge.reorder.exceeded.quantity",EXCEEDED_BASKET_MAX_QUANTITY:"basket.merge.reorder.exceeded.quantity",UNKNOWN_PRODUCT:"basket.merge.unknown.product",UNKNOWN:"basket.merge.unknown.reason",UNDEFINED_SELLER_ID:"basket.merge.unknown.reason",OUT_OF_STOCK:"basket.merge.out.of.stock",TIME_RESTRICTION:"basket.merge.time.restriction",UNAVAILABLE:"merge-cart-with-edit-order.unavailable-reason.item-cannot-be-added",EXCEEDED_MAX_QUANTITY_MULTIPLE:"merge-cart-with-edit-order.unavailable-reason.max-quantity-reached.multiple",EXCEEDED_MAX_QUANTITY_SINGLE:"merge-cart-with-edit-order.unavailable-reason.max-quantity-reached.single",TIME_RESTRICTION_MERGE_EDIT:"merge-cart-with-edit-order.unavailable-reason.outside-of-deliverable-time-zone"},VG="basket-merge-conflict-modal-header-label",kJ="An unavailable items modal was displayed",gf="basketMergeConflict",{Wrapper:gft,Body:Eft,Media:fft,Image:yft,Title:Ift}=eUe,Sft={product:m.shape({productId:m.string,image:m.shape({description:m.string,src:m.string}),name:m.string,price:m.shape({current:ze,original:ze}),reason:m.string,favorite:m.shape({message:m.string}),offer:m.shape({label:m.string,message:m.string,url:m.string}),alcohol:m.bool,restrictedVisibility:m.string}).isRequired,messages:m.shape({OUT_OF_STOCK:m.string,TIME_RESTRICTION:m.string,LIMITED_AVAILABILITY:m.string,EXCEEDED_MAX_QUANTITY:m.string,CHECKOUT_TIME_RESTRICTED:m.string}).isRequired},Ef=({product:e,messages:t})=>{const n=f(D("prp"));return s.jsx(Ji,{isActive:e.alcohol,overlay:s.jsx(Tu,{shouldRenderButton:!1}),children:s.jsx(gft,{"data-test":"simple-fop",children:s.jsxs(lT,{product:e,children:[s.jsxs(fft,{children:[e.favorite?s.jsx(nt.ImageTopBar,{children:s.jsx(nt.FopTopBarIcon,{name:"favourites",width:24})}):null,pp(s.jsx(yft,{"data-test":"simple-image",alt:e.image.description,src:e.image.src}),e.restrictedVisibility)]}),s.jsxs(Eft,{children:[s.jsx(Ift,{children:e.name}),n&&s.jsx("div",{className:"salt-m-b--1",children:s.jsx(dL,{})}),s.jsx("div",{className:"salt-m-b--1",children:s.jsx(cL,{})}),s.jsx(Te,{intent:"error",size:"s","data-test":"alert-reason",text:t[e.reason]||e.reason})]})]})})})};Ef.propTypes=Sft;Ef.displayName="SimpleFop";const jJ=({data:e})=>e.basketMerge?.mergeResults?.limitedItems||[],Cft=({data:e})=>e.basketMerge?.mergeResults?.destination||jt(),vft=({data:e})=>e.basketMerge?.mergeResults?.sourceEventId,Tft=(e,t=!1)=>{const{reason:n,addedAmount:o,requestedAmount:r,timeRestriction:a,deliveryTimeRestrictionMessage:i}=e,l=r-o;let c=n;t&&(n===Jl.TIME_RESTRICTION?c=Nb.TIME_RESTRICTION_MERGE_EDIT:n===Jl.EXCEEDED_MAX_QUANTITY&&(l>1?c=Nb.EXCEEDED_MAX_QUANTITY_MULTIPLE:c=Nb.EXCEEDED_MAX_QUANTITY_SINGLE));const d=hft[c];if(!d)return n;if(i)return{[n]:i};const u=a&&{to:a.deliverableTo,from:a.deliverableFrom};return{[n]:s.jsx(b,{id:d,values:{addedAmount:o,count:l,requestedAmount:r,...u}})}},_ft=({limitedItem:e,product:t,isBasketMergeEditOrder:n})=>{if(!e||!t)return null;const o={...t,...e};return s.jsx(Be.Item,{children:s.jsx(xe,{condensed:!0,children:s.jsx(Ef,{product:o,messages:Tft(o,n)})})},e.productId)},MJ=({isBasketMergeEditOrder:e})=>{const t=f(jJ),n=f(mo);return!t?.length||t?.every(o=>!n?.[o?.productId])?null:s.jsx(Be,{inline:!1,children:t?.map(o=>s.jsx(_ft,{isBasketMergeEditOrder:e,limitedItem:o,product:n?.[o?.productId]},o.productId))})},_A="editOrderMergeUnavailableItems",bft=()=>{const{formatMessage:e}=L(),t=F(),n=f(Yn(_A)),o=f(D("m.la.h")),r=f($e(_A)),a="edit-order-modal-header",i=()=>{t(J.closeModal()),n?.afterClose()},l=n?.withProductsFetchError?"merge-cart-with-edit-order.unavailable-items-modal.alert.error":"merge-cart-with-edit-order.unavailable-items-modal.text";return s.jsxs(B,{isOpen:r,onRequestClose:i,aria:{labelledby:a},children:[s.jsx(B.Header,{align:o?"left":"center",children:s.jsx(ee,{as:"h1",id:a,children:e("merge-cart-with-edit-order.unavailable-items-modal.title")})}),s.jsxs(B.Body,{children:[s.jsx(Te,{className:"salt-m-b--4",intent:"error",text:e(l),showIcon:!1}),!n?.withProductsFetchError&&s.jsx(MJ,{isBasketMergeEditOrder:!0})]}),s.jsx(B.Footer,{align:o?"left":"center",children:s.jsx(x,{intent:"primary",onClick:i,fill:!0,children:s.jsx(x.Text,{children:e("merge-cart-with-edit-order.unavailable-items-modal.confirm-button")})})})]})},wJ=(e=!1)=>t=>{t(e?ro.LEGACY_addServerSideNotifications([_o.LEGACY_showBasketMergeSucceedPriceChanged.key]):ro.LEGACY_addServerSideNotifications([_o.LEGACY_showBasketMergeSucceed.key]))},WG=(e=!1)=>{const t=e?"basket.merge.prices.promos.changed.notification":"merge-cart-with-edit-order.toast.successful";Z.success(t)},YG=()=>{Z.error("merge-cart-with-edit-order.toast.all-with-conflicts")},FJ=({viaCartToken:e}={viaCartToken:!1})=>t=>{t(e?ro.LEGACY_addServerSideNotifications([_o.LEGACY_showBasketMergeFailedViaToken.key]):ro.LEGACY_addServerSideNotifications([_o.LEGACY_showBasketMergeFailed.key]))},xft=e=>async t=>{try{const n=await t(yr.mergeBasket(e)),{status:o,pricesPromosChanged:r}=n.payload.responseData;switch(o){case Br.SUCCESSFUL:{t(wJ(r));break}case Br.ALL_WITH_CONFLICTS:case Br.WITH_CONFLICTS:t(J.openModal(gf));break;default:break}}catch{t(FJ({viaCartToken:!1}))}},Aft=()=>async(e,t)=>{const n=t(),r=is(n)?.checkoutCorrelationId,l=As(n)?.order?.orderId;let c=null;try{c=await e(yr.mergeBasket()),e(U.analyticsEvent({type:Re.MERGE_CART,prevOrderId:r,nextOrderId:l}));const E={event:"merge_cart",type:"edit-merge",previous_transaction_id:r,osp_transaction_id:l};te.sendEvent({GA:E,WA:null})}catch{YG();return}const{status:d,limitedItems:u,pricesPromosChanged:p}=c.payload.responseData;let g=!1;if(u?.length&&d!==Br.ALL_WITH_CONFLICTS)try{await e(ai({products:u.map(({productId:E})=>({id:E})),ignoreProductCache:!0}))}catch{g=!0}switch(d===Br.WITH_CONFLICTS&&!u?.length&&(g=!0),d){case Br.SUCCESSFUL:{WG(p);break}case Br.ALL_WITH_CONFLICTS:case Br.WITH_CONFLICTS:{if(e(J.openModal(_A,{withProductsFetchError:g,afterClose:()=>{d===Br.ALL_WITH_CONFLICTS?YG():WG(p)}})),u?.length){const y=u?.map(I=>I.productId);e(U.analyticsEvent({type:Re.SOME_ITEMS_UNABLE_TO_ADD_MODAL_DISPLAYED,orderId:l,productId:y}))}const E=Nn(n);u?.forEach(y=>{e(U.analyticsEvent({type:Re.SOME_ITEMS_UNABLE_TO_ADD_IMPRESSION,pageViewId:E,pageComponents:{productId:y?.productId,reason:y?.reason}}))});break}case Br.NO_ACTION:{e(U.analyticsEvent({type:Re.ADD_PRODUCT_TO_ORDER_WITH_NO_ITEMS_REQUESTED,checkoutCorrelationId:r}));break}}},Rft=({cartToken:e})=>async t=>{try{const n=await t(yr.mergeBasketViaCartToken(e)),{status:o,pricesPromosChanged:r}=n.payload.responseData;switch(o){case Br.SUCCESSFUL:{t(wJ(r));break}case Br.ALL_WITH_CONFLICTS:case Br.WITH_CONFLICTS:t(J.openModal(gf));break;default:break}}catch{t(FJ({viaCartToken:!0}))}},Ik={mergeCartWithVisitorCart:xft,mergeBasketViaCartToken:Rft,mergeCartWithEditOrder:Aft},Dft=e=>!D("ord.ot.hide")(e),Oft=(e,t,n)=>{Dft(n)&&Nft(e)&&Object.keys(e.payload.order).filter(o=>Pft(e.payload.order[o])).forEach(o=>{t(Kye(o)).then(r=>{Object.keys(r.payload.responseData).length!==0&&t(zye(r.payload.responseData))}).catch(()=>{})})},Pft=e=>e.status!=="CANCELLED"&&e.status!=="DELIVERED"&&qe().isSameOrBefore(e.dates.deliveryStartDate,"day"),Nft=e=>e&&e.payload&&e.payload.order,Sk={getDeliveryStatuses:Oft},BJ=D("rec.o"),UJ=({id:e,response:t,dispatch:n})=>{if(Vo(t,`payload.responseData.entities.order[${e}].recurringShoppingDefinition.isNew`,!1)){const r=Vo(t,`payload.responseData.entities.order[${e}].recurringShoppingDefinition.name`,"");n(dS.showRecurringOrderCreatedNotification(r))}},Lft=e=>(t,n)=>t(Ia.getOrder(e)).then(o=>{if(o)return BJ(n())&&UJ({id:e,response:o,dispatch:t}),t(lE(o.payload.responseData.entities))}).catch(()=>!1),kft=e=>(t,n)=>t(Ia.getDecoratedOrder(e)).then(o=>{if(o){const{entities:r,missedPromotions:a}=o.payload.responseData;BJ(n())&&UJ({id:e,response:o,dispatch:t}),a?.length&&t(fo.addMissedPromotions(a)),t(lE(r)),t(xt.setProducts(r))}}).catch(()=>!1),jft=e=>(t,n)=>t(Ia.getDecoratedOrder(e)).then(o=>{if(o){const{entities:r,missedPromotions:a}=o.payload.responseData;a?.length&&t(fo.addMissedPromotions(a)),t(lE(r)),t(xt.setProducts(r)),Sk.getDeliveryStatuses({payload:r},t,n())}}).catch(()=>!1),Mft=e=>t=>t(Ia.getOrder(e)).then(n=>n&&t(lE(n.payload.responseData.entities))).catch(()=>!1),jo={getOrderWithRecurringNotification:Lft,getDecoratedOrderWithRecurringNotification:kft,getDecoratedOrderCall:jft,getOrder:Mft},wft="SHOW_ORDER_DETAILS",WT=()=>{Z.error("toast.notification.generic.error")},Fft=(e,t,n=!0)=>(o,r)=>o(Ia.cancelOrder(e)).then(()=>{const a={event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventLabel:"cancelled-order",eventAction:"OrderCancelled",ecommerce:{refund:{actionField:{id:e}}}};return te.sendEvent({GA:a,WA:null}),o(U.analyticsEvent({type:Gs.ORDER_CANCELLED,orderId:e}))}).then(async()=>n?t(cn(e)):Promise.all([o(Yt.getBasket()),o(jo.getDecoratedOrderCall(e))])).then(async()=>{const a=r(),i=Ki(a,e);let l;if(i?.checkoutId){const d=Oo(a);l=await ko.fetchAnalyticsMetadataByCheckoutId(i.checkoutId,d)}o(U.analyticsEvent({type:Gs.ORDER_CANCELLED_GA4,orderId:e,state:a,meta:l})),Z.success("order.details.order_cancelled_notification");const c=rbe({orderId:e,state:a,meta:l});te.sendEvent({GA:c,WA:null})}).catch(WT),Bft=(e,t,n=!0)=>(o,r)=>o(Ia.cancelOrderChanges(e,vn(r()))).then(async()=>n?t(cn(e)):Promise.all([o(Yt.getBasket()),o(jo.getDecoratedOrderCall(e))])).catch(WT),Uft=(e,t,{redirectToDetails:n=!0,mergeBasket:o=!1}={})=>(r,a)=>r(Ia.editOrder(e,vn(a()))).then(async()=>(o&&await r(Ik.mergeCartWithEditOrder()),n?t(cn(e)):Promise.all([r(Yt.getBasket()),r(jo.getDecoratedOrderCall(e))]))).catch(WT),Gft=(e,t,n)=>(o,r)=>$ft(t)(o,r).then(()=>{o(J.closeModal()),e===wft?n(cn(t)):window.location.reload()}).catch(WT),$ft=e=>(t,n)=>t(Ia.cancelOrderChanges(e,vn(n()))).then(()=>t(yr.mergeBasket(Gp(n())))),ji={cancelOrder:Fft,cancelOrderEditExpired:Gft,cancelChanges:Bft,editOrder:Uft},Ck=()=>{const e=f(D("al")),{sendPageViewEvent:t}=NO(),n=Ne(),o=F();return()=>e?t({page:n.pathname}):o(U.analyticsEvent({type:Gs.EDIT_ORDER_PAGE_VIEW_EVENT,page:"order-details",location:n}))},YT="cancel-generic-modal-header",Hft="order-details",GJ=({orderId:e,page:t,isCancelChanges:n=!1})=>{const o=F(),r=Ge(),a=Ck(),i=f(D("m.la.h")),l=t===Hft,c=g=>{o(U.analyticsEvent({type:Gs.CANCEL_ORDER_MODAL_DISPLAYED,orderId:e,userAction:g}))},d=g=>{o(U.analyticsEvent({type:Gs.DISCARD_CHANGES_MODAL_DISPLAYED,orderId:e,userAction:g}))},u=()=>{n?d("Cancel"):c("Dismiss"),o(J.closeModal())},p=async()=>{n?(d("Discard"),await o(ji.cancelChanges(e,r,!l))):(c("Cancel order"),await o(ji.cancelOrder(e,r,!l))),l&&a(),o(J.closeModal())};return s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:i?"left":"center","data-test":"cancel-generic-modal-content-header",children:s.jsx(ee,{as:"h2",id:YT,children:n?s.jsx(b,{id:"orders.list.cancel.changes.modal.heading"}):s.jsx(b,{id:"orders.list.cancel.order.modal.heading"})})}),s.jsx(B.Body,{"data-test":"cancel-generic-modal-content-body",children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{className:"salt-m-t--4",fill:!0,intent:"secondary",onClick:u,"data-test":"cancel-order-dismiss-button",children:s.jsx(x.Text,{children:n?s.jsx(b,{id:"orders.list.cancel.changes.modal.dismiss"}):s.jsx(b,{id:"orders.list.cancel.order.modal.dismiss"})})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{fill:!0,intent:"primary",className:"salt-m-t--4","data-synthetics":n?null:"cancel-order-confirm-button","data-test":"cancel-order-confirm-button",onClick:p,children:s.jsx(x.Text,{children:n?s.jsx(b,{id:"orders.list.cancel.changes.modal.cancel.changes"}):s.jsx(b,{id:"orders.list.cancel.order.modal.cancel.order"})})})})]})})]})},vk=({orderId:e,page:t})=>{const n=F(),o=ft(),r=f($e(`cancelChanges${e}`)),a=()=>{o({type:Gs.DISCARD_CHANGES_MODAL_DISPLAYED,orderId:e,userAction:"Close"}),n(J.closeModal())};return s.jsx(B,{isOpen:r,onRequestClose:a,aria:{labelledby:YT},children:s.jsx(GJ,{orderId:e,isCancelChanges:!0,page:t})})},$J=e=>{const{orderId:t}=e,n=L(),o=F(),r=()=>o(J.openModal(`cancelChanges${t}`));return s.jsxs(h.Fragment,{children:[s.jsx(x,{size:"m",intent:"secondary",fill:!0,onClick:r,"data-test":"cancel-changes-button",children:s.jsx(x.Text,{children:n.formatMessage("order.undo.changes")})}),s.jsx(vk,{orderId:t,page:"order-details"})]})},Tk=({orderId:e,page:t})=>{const n=F(),o=ft(),r=f($e(`cancelOrder${e}`)),a=()=>{o({type:Gs.CANCEL_ORDER_MODAL_DISPLAYED,orderId:e,userAction:"Close"}),n(J.closeModal())};return s.jsx(B,{isOpen:r,onRequestClose:a,aria:{labelledby:YT},children:s.jsx(GJ,{orderId:e,page:t})})},HJ=({orderId:e})=>{const t=L(),n=F(),o=()=>{n(J.openModal(`cancelOrder${e}`))};return s.jsxs(h.Fragment,{children:[s.jsx(x,{size:"m",intent:"secondary",fill:!0,onClick:o,"data-test":"cancel-order-button",children:s.jsx(x.Text,{children:t.formatMessage("order.cancel")})}),s.jsx(Tk,{orderId:e,page:"order-details"})]})},Vft=({basket:e})=>s.jsxs(xe,{children:[s.jsx($J,{orderId:e.orderId||""}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(HJ,{orderId:e.orderId||""})})]}),Wft=({basketSummary:e})=>{const t=os({breakpoint:"lg-up"}),n=f(eu),[o]=Ee(["thcu"]),{shippingGroupType:r,shippingGroupTypeDisplayName:a}=e.checkout,i=e.items;if(!a||!i.length||n)return null;const l=!!e.slot,c=e.slot||e.nextAvailableSlot;return s.jsxs(xe,{"data-test":"basket-delivery-info-box",children:[s.jsx(Gm,{name:a,basketItems:i,as:"h2",showQuantity:!o}),!o&&s.jsxs(h.Fragment,{children:[s.jsx(yJ,{slot:c,slotBooked:l,shippingGroupType:r}),t&&s.jsx(Lp,{basketSummary:e,dataTest:"basket-delivery-minimum-order"})]})]})},Yft=D("mtz"),qft=e=>{if(!e.dateIso)return null;if(!e.multiTimeZoneEnabled)return s.jsx(h.Fragment,{children:NH(e.dateIso,e.dateFormat,e.timeFormat)});if(e.isServerRendered)return null;const{displayTimeZoneId:t,showTimeZoneAbbreviation:n}=kv(e.timeZoneId,e.defaultTimeZoneId,e.local);return s.jsx(h.Fragment,{children:SR(e.dateIso,t,e.dateFormat,e.timeFormat,n)})},Kft=e=>({defaultTimeZoneId:Xd(e),multiTimeZoneEnabled:Yft(e),isServerRendered:Rt(e)}),Gl=we(Kft)(qft),zft={UNDER_EDIT:"UNDER_EDIT"},VJ=({id:e})=>{const t=f(Ac),n=f(Zt),o=f(Mt),r=t?.orders?.find(i=>i?.editStatus===zft.UNDER_EDIT);if(!r)return null;const a=s.jsx(Gl,{dateIso:r.dates.confirmOrderChangesBy,timeZoneId:r.dates.timeZoneId,local:!0,dateFormat:n,timeFormat:o});return s.jsx("div",{className:"salt-m-t--4",children:s.jsx(O,{size:"m","data-test":"order-edit-cut-off-time",children:s.jsx(b,{id:e,values:{cutoff_time:a}})})})},Qft=()=>{const e=f(Ct);return e?s.jsxs(V,{className:"salt-m-x--0 salt-m-b--0 salt-m-t--4",children:[s.jsx(V.Item,{colSpan:{xs:6},children:s.jsx(HJ,{orderId:e})}),s.jsx(V.Item,{colSpan:{xs:6},children:s.jsx($J,{orderId:e})})]}):null},Xft=()=>{const{formatMessage:e}=L(),t=f(xn),n=f(Zt),o=f(Mt);return t?s.jsx("div",{className:"salt-m-t--4",children:s.jsxs(O,{size:"m","data-test":"order-edit-reserved-slot",children:[e("edit.order.slot.time"),s.jsx("span",{className:"salt-m-l--1",children:s.jsx(qn,{dateIsoFrom:t.start,dateIsoTo:t.end,timeZoneId:t.timeZoneId,local:!0,dateFormat:n,timeFormat:o})})]})}):null},Zft=()=>{const e=F(),[t,n]=h.useState(ct()),o=f(Ct),r=f(Oo),a=ci(),i=Js(Tr({inCheckoutWalk:!1})),l={...i,search:`${i.search}&source=${encodeURIComponent("basket")}&sourceEventId=${t}`},c=p=>{e(ds({name:sm,event:p}))},d=async()=>{e(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Body",componentType:"Card",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),e(U.analyticsEvent({type:Gs.EDIT_PAGE_SLOT_BOOKING_CARD_CLICKED,status:"slot reserved",orderId:o,pageEventId:t}));const p=await ko.fetchAnalyticsMetadataByActiveCart(r);e(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:p})),a(p),n(ct())},u=p=>{c(p),d()};return s.jsx(x,{asChild:!0,"data-test":"order-edit-change-slot",className:"salt-m-t--2",intent:"secondary",fill:!0,onClick:u,children:s.jsx(Ye,{to:l,intent:"ghost",children:s.jsx(x.Text,{children:s.jsx(b,{id:"edit.order.change.slot"})})})})},Jft=()=>{const e=f(xn),t=f(Mt);if(!e?.expiryTime)return null;const n=s.jsx(Cl,{dateIso:e.expiryTime,timeZoneId:e.timeZoneId,local:!0,timeFormat:t}),o=s.jsx(b,{id:"slotbooking.navigation.card.change.slot.expiration.alert.text.hint",values:{expiryTime:n}});return s.jsx(Te,{className:"salt-m-t--2","data-test":"slot-expiry-time-alert",size:"s",intent:"warning",text:o})},eyt=()=>Ee(["csoei"])?s.jsxs(h.Fragment,{children:[s.jsx(Xft,{}),s.jsx(Zft,{}),s.jsx(Jft,{})]}):null,WJ=()=>s.jsxs(h.Fragment,{children:[s.jsx(Qft,{}),s.jsx(eyt,{})]}),YJ=()=>s.jsxs(xe,{"data-test":"edit-order",children:[s.jsxs(ee,{as:"h2",children:[s.jsx(pe,{name:"orders_edit",width:20,height:20,verticalAlign:"middle",className:"salt-m-r--2"}),s.jsx(O,{size:"l",bold:!0,children:s.jsx(Nt,{id:"edit.order.header"})})]}),s.jsx(VJ,{id:"edit.order.checkout.info"}),s.jsx(WJ,{})]}),qJ=()=>{const[e,t]=h.useState(!1);return s.jsxs(Je,{expanded:e,onToggle:()=>t(!e),name:"edit-order",children:[s.jsxs(Je.ControlSection,{children:[s.jsxs(ee,{as:"h2",children:[s.jsx(pe,{name:"orders_edit",width:20,height:20,verticalAlign:"middle",className:"salt-m-r--2"}),s.jsx(O,{size:"l",bold:!0,children:s.jsx(b,{id:"edit.order.options.header"})})]}),s.jsx(Je.ToggleSwitch,{"data-test":"collapsible-box-toggle-switch"})]}),s.jsx(VJ,{id:"edit.order.checkout.more.options.info"}),s.jsx(Je.ContentExpanded,{maxHeight:"100%",overflow:"visible",children:s.jsx(WJ,{})})]})},tyt=({loading:e=!1})=>{const[t,n,o,r,a,i]=Ee(["tp","csoei","bt.spl","pbpm","csc.b","thcu"]),l=L(),c=os({breakpoint:"lg-up"}),d=f(eu),u=!c||i,[p,g]=h.useState(!1),E=f(Xe),y=f(tu),I=f(_C),[S]=y,C=S?.orderId,{smallOrderChargeThresholds:T,shouldDisplaySmallOrderCharge:_}=RT(S);h.useEffect(()=>{g(!0)},[]);const A=f(mV),R=f(zue);r&&R.length&&fu(R);const{totalPrice:P,priceNote:N,summaryTitle:k,totalPriceTitle:M,ariaExpandedLabel:w,ariaCollapsedLabel:j}=$X(S),G=()=>s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(TS,{})}),W=()=>s.jsxs(h.Fragment,{children:[!i&&G(),E&&t&&s.jsx(TA,{}),i&&s.jsx(TS,{})]}),H=()=>s.jsxs(h.Fragment,{children:[E&&t&&s.jsx(TA,{}),i?s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(YJ,{})}):s.jsxs(h.Fragment,{children:[n&&s.jsx(mft,{componentContext:"basket"}),s.jsx(Vft,{basket:S})]})]});return s.jsxs(V,{flush:!0,className:"salt-gap-y--4 lg:salt-gap-y--0",children:[s.jsx(V.Item,{colSpan:{xs:12,lg:9},children:s.jsxs(Q,{wrap:"nowrap",direction:"column",gap:["md"],children:[!o&&s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),d&&i&&s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(qJ,{})}),o&&S&&s.jsx(Wft,{basketSummary:S}),s.jsx("div",{children:s.jsx(hk,{basketProducts:A,itemGroups:I})})]})}),s.jsx(V.Item,{colSpan:{xs:12,lg:3},children:s.jsxs(Q,{direction:"column",gap:["md"],children:[a?s.jsxs(wL,{summaryTitle:k,totalPrice:P,totalPriceTitle:M,priceNote:N,loading:e,basketSummary:S,breakpoint:"lg-up",loadedViewPortSize:p,ariaExpandedLabel:w,ariaCollapsedLabel:j,renderButtonsSection:()=>s.jsx(Np,{name:d?l.formatMessage("order.continue.checkout.to.save.changes"):void 0,basketSummary:S,className:"salt-m-t--4"}),renderItemsSection:()=>s.jsx(qX,{basketSummary:S,page:"basket"}),renderItemsBySellerSection:()=>s.jsx(KX,{basketSummary:S}),children:[s.jsx(Rg,{loyalty:S?.loyalty?.earnings}),S&&u&&s.jsx(Lp,{basketSummary:S,dataTest:"minimum-order-summary"}),_&&s.jsx($d,{orderId:C,thresholds:T,page:"basket",className:"salt-m-t--2"})]}):s.jsx(SJ,{basketSummary:S,checkoutButtonName:d?l.formatMessage("order.continue.checkout.to.save.changes"):void 0,loadedViewPortSize:p,loading:e,showMinimumSpend:u}),d?H():W()]})})]})},syt=({loading:e=!1})=>{const[t,n]=Ee(["mins","thcu"]),o=tf(),[r,a]=h.useState(!0),i=f(Hi),l=f(Rt),c=f(TD),d=f(tu),u=f(jC),g=f(yT).length,E=rX(),y=F(),{isBelowMinSpendErrorInUrl:I,errorShippingGroupType:S,shouldShowGenericErrorWhenCheckoutGroupRemoved:C}=rit(),T=d.length>1||!!u.length,_=f(eu),A=_?"edit-order":"basket",R=cit(S,t,C),[P,N,k]=f(eX(A)),M=i&&P.length>0&&!k;Pot();const w=f(Oo);h.useEffect(()=>{i&&!l&&!c&&r&&(E(),a(!1))},[i,E,c,l,r]),h.useEffect(()=>{o&&!c&&!r&&y(U.analyticsEvent({type:Is.REGULARS_IN_TROLLEY_TOTAL_COUNT,count:g}))},[g,o,c,r,y]),h.useEffect(()=>{I&&R()},[R,I]),h.useEffect(()=>{(i&&d.length===1||!i&&!d.length)&&localStorage.removeItem(cg)},[d.length,i]);const{viewCartGa4Event:j}=V7(),{data:G,canSendEvent:W,setIsEventSent:H}=W7(),K=i&&!d.length&&!u.length;return h.useEffect(()=>{W&&!K&&w&&((async()=>{const q=await ko.fetchAnalyticsMetadataByActiveCart(w);await j({payload:G,cartType:"page",meta:q})})(),H())},[W,H,j,G,K,w]),K?s.jsx(_s,{size:"l",className:"salt-m-t--16","data-test":"basket-spinner"}):!i&&!d.length&&!u.length?_&&n?s.jsxs(V,{children:[s.jsxs(V.Item,{colSpan:{xs:12,lg:9},children:[s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(qJ,{})}),s.jsx(uG,{flush:!0})]}),s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(V.Item,{colSpan:{lg:3},children:s.jsx(YJ,{})})})]}):s.jsx(uG,{}):s.jsxs("div",{className:"salt-m-x--2",children:[s.jsx(Vit,{}),T?s.jsx(XEt,{basketCheckoutGroups:d}):s.jsx(tyt,{loading:e}),s.jsx(Hit,{}),M&&s.jsx(V,{flush:!0,children:s.jsx(V.Item,{colSpan:{xs:12,lg:9},children:s.jsx(tX,{page:A,pageKey:A,className:T?"salt-m-t--2 sm:salt-m-t--0":""})})})]})},nyt=({loading:e=!1})=>{const t=L(),n=f(D("thcu")),o=f(E=>lN(E)),r=ait(),a=iit(),i=mL(),l=f(E=>is(E)),c=Ne(),d=f(eu),u=h.useRef(!1),p=!!c.state?.isBasketBelowThreshold;h.useEffect(()=>{const E=c.state?.notification;if(wrt(E)){const{type:y,message:I}=E;Z[y](I)}window.history.replaceState({},document.title)},[c.state]),h.useEffect(()=>{p&&(i({basketSummary:l,type:"info"}),window.history.replaceState({},""),c.state.isBasketBelowThreshold=void 0),o&&r()},[l,r,c.state,o,i,p]),uit(),h.useEffect(()=>{l.items.length>0&&!u.current&&(a(),u.current=!0)},[a,l.items]);const g=()=>s.jsxs(O,{"data-test":"order-details-order-reference",children:[t.formatMessage("order.details.subheading.orderId"),": ",l.orderId]});return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"basket.page.title"}),s.jsx(Gn,{children:s.jsx("meta",{name:"robots",content:"noindex"})}),s.jsxs("div",{className:"salt-m-b--8",children:[s.jsxs(sn,{children:[s.jsx(sat,{}),d&&!n?g():null]}),s.jsx(fT,{}),s.jsx("div",{className:"salt-m-l--2 salt-m-r--2",children:s.jsx(B7,{})}),s.jsx(syt,{loading:e}),s.jsx(bft,{})]})]})},KJ=({loading:e=!1})=>s.jsx(Et,{type:"Basket::route",children:s.jsx(nyt,{loading:e})}),oyt=e=>[{path:"/basket",Component:e.Main,key:"main",children:[{index:!0,Component:Ic([{condition:t=>!nu(t),failComponent:_rt}],KJ)}]}],zJ=e=>e.data.adverts?.productDetailsPage,_k=e=>Y(zJ,t=>t?.[e]??{}),ryt=e=>Y(_k(e),({isFetching:t})=>!!t),ayt=e=>t=>Y(zJ,n=>!!n[t]?.lastUpdated)(e),iyt=(e,t)=>Y(_k(t),n=>n?.placement?.[e]||[]),qG=(e,t)=>Y(iyt(e,t),lyt(t),ryt(t),(n,o,r)=>[n,o,r]),lyt=e=>Y(_k(e),t=>t?.settings||{}),qT=e=>{const t=Array.from(new Array(10),(o,r)=>r.toString()),n=kp({productIds:t,title:"",productType:e});return{products:t,group:n}},QJ={landscape:{promotion:{compress:!1}}},gl=(e,t,n)=>e.map(o=>({productId:o,group:t,customAnalyticsData:n})),kp=({productIds:e,title:t,productType:n,campaignName:o,campaignId:r,groupTitle:a})=>({name:t,section:n,type:n,products:e,viewportConfig:{lg:1,md:2,sm:3,xs:4},clusterBreadcrumbs:[],campaignName:o||"",campaignId:r||"",groupTitle:a||""}),cyt=async(e,t,n)=>{const o=go({basePath:n,target:`/webproductpagews/v5/products/related?retailerProductId=${e}`});return fetch(o,Jr({clientRouteId:t,method:"GET"})).then(r=>{if(!r.ok)throw new Error(`Cannot fetch related products for ${e}`);return r.json()})},dyt=async(e,t,n)=>{const o=go({basePath:n,target:`/webproductpagews/v5/products/similar?retailerProductId=${e}`});return fetch(o,Jr({clientRouteId:t,method:"GET"})).then(r=>{if(!r.ok)throw new Error(`Cannot fetch similar products for ${e}`);return r.json()})},uyt=e=>{const t={};return e.forEach(n=>{t[n.internalProductId]={campaignId:n.provider.metadata.campaignId,campaignName:n.provider.metadata.campaignName,externalAdvertId:n.provider.metadata.adTrackId,internalProductId:n.internalProductId,retailerProductId:n.retailerProductId,pricingModel:n.provider.metadata.pricingModel,source:n.provider.name}}),t},pyt=async(e,t,n)=>{const o=go({basePath:n,target:`/cxhub/v2/featured-products/bop?platform=WEB&key=${e}`});return fetch(o,Jr({clientRouteId:t,method:"GET"})).then(async r=>{if(!r.ok)throw new Error(`Cannot fetch featured products for ${e}`);const a=await r.json().catch(()=>({featuredProducts:[]}));return uyt(a.featuredProducts)})},myt=e=>{const[t]=Ee(["recom.rel"]),n=f(Do),o=f(At),[r,a]=h.useState({loading:!1,featuredProducts:{},relatedProducts:[]});return h.useEffect(()=>{if(!e)return;a(l=>({...l,loading:!0})),(async()=>{try{const l={};if(t){const c=await cyt(e,n,o);l.relatedProducts=c}l.featuredProducts=await pyt(e,n,o),a(c=>({...c,...l,loading:!1}))}catch(l){Ue.api.pushError(l),a(c=>({...c,loading:!1}))}})()},[e,t]),r},hyt=e=>{const t=f(Do),n=f(At),[o,r]=h.useState({loading:!1,similarProducts:[]});return h.useEffect(()=>{if(!e)return;(async()=>{r({...o,loading:!0});try{const i=await dyt(e,t,n);r({similarProducts:i,loading:!1})}catch(i){Ue.api.pushError(i),r({...o,loading:!1})}})()},[e]),o},gyt=(e,t)=>t.length?e.length?t.length===1?[...t,...e]:t.length>1?[t[0],e[0],t[1],...e.slice(1)]:[]:t:e,Eyt=({className:e,retailerProductId:t})=>{const{relatedProducts:n,featuredProducts:o,loading:r}=myt(t),{formatMessage:a}=L();if(!r&&!n.length&&!Object.keys(o?.products??{}).length)return null;const i=a("bop.page.related.products.carousel.title"),l=s.jsx(O,{size:"l",bold:!0,asChild:!0,children:s.jsx("h2",{children:i})}),c=()=>{if(r){const{products:y,group:I}=qT("featured");return gl(y,I)}const E=Object.keys(o??{});if(E.length){const y=kp({productIds:E,title:i,productType:"featured"});return gl(E,y)}return[]},u=(()=>{if(n){const E=kp({productIds:n,title:i,productType:"related",groupTitle:"RELATED"});return gl(n,E)}return[]})(),p=c(),g=gyt(u,p);return!r&&!g.length?null:s.jsx("div",{className:e,"data-test":"related-products-carousel",children:s.jsx(pf,{products:g,titleElement:l,a11yTitleText:i,loading:r,overrideConfig:QJ,featuredProducts:o})})},fyt=({className:e,retailerProductId:t})=>{const{similarProducts:n,loading:o}=hyt(t),{formatMessage:r}=L(),a=r("bop.page.similar.products.carousel.title"),i=s.jsx(O,{size:"l",bold:!0,asChild:!0,children:s.jsx("h2",{children:a})}),c=(()=>{if(o){const{products:d,group:u}=qT("similar");return gl(d,u)}if(n.length){const d=kp({productIds:n,title:a,productType:"similar",groupTitle:"SIMILAR"});return gl(n,d)}return[]})();return!o&&!c.length?null:s.jsx("div",{className:e,"data-test":"similar-products-carousel",children:s.jsx(pf,{products:c,titleElement:i,a11yTitleText:a,loading:o,overrideConfig:QJ})})},yyt=()=>{const{setAgeConfirmation:e,redirectPath:t}=b7(),{formatMessage:n}=L(),r=f(D("m.la.h"))?"left":"center",a={button:n("alcohol.age.confirmation.button.label"),body:n("alcohol.age.confirmation.modal.body"),cancel:n("alcohol.age.confirmation.modal.cancel"),header:n("alcohol.age.confirmation.modal.header"),headerAccessibility:n("alcohol.age.confirmation.modal.accessibility.description"),buttonAccessibility:n("alcohol.age.confirmation.modal.accessibility.button.label")},i=()=>t?s.jsx(x,{asChild:!0,intent:"primary",fill:!0,children:s.jsxs(tt,{href:t,intent:"ghost",children:[s.jsx(ie,{children:a.buttonAccessibility}),s.jsx(x.Text,{"aria-hidden":!0,children:a.button})]})}):s.jsxs(x,{onClick:e,intent:"primary",fill:!0,children:[s.jsx(ie,{children:a.buttonAccessibility}),s.jsx(x.Text,{"aria-hidden":!0,children:a.button})]});return s.jsx(B,{isOpen:!0,children:s.jsxs(B.ModalForm,{children:[s.jsxs(B.Header,{align:r,children:[s.jsx(ie,{children:a.headerAccessibility}),s.jsx(ee,{as:"h1","aria-hidden":!0,children:a.header})]}),s.jsx(B.Body,{children:a.body}),s.jsxs(B.Footer,{align:r,className:"salt-gap-x--2",children:[s.jsx(x,{fill:!0,intent:"secondary",asChild:!0,children:s.jsx(Ye,{href:fn(),intent:"ghost",children:s.jsx(x.Text,{children:a.cancel})})}),i()]})]})})},Iyt=(e,t)=>{switch(t){case"ABOVE_GRID":return qG("aboveGrid",e);case"BELOW_GRID":return qG("belowGrid",e);default:return()=>[[],{randomizeInitialHorizontalAdvert:!1},!1]}},KG=({placement:e,retailerProductId:t})=>{const[n,o,r]=f(Iyt(t,e)),a=z7(n);if(!a.length||r)return null;const i=`horizontal-advert-${e==="ABOVE_GRID"?"above":"below"}-bop`;return s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Lm,{"data-test":i,adverts:a,advertDimensionsMap:ST,page:"product-details",pageKey:t,placement:e,randomInitialIndex:o.randomizeInitialHorizontalAdvert,sizes:["SMALL","MEDIUM","LARGE"]})})},XJ=({age:e,redirectOnCancel:t,messages:n,isOpen:o=!0})=>{const{formatMessage:r}=L(),a=f(D("m.la.h")),i=Ne(),l=Ge(),c=f(JH),d=a?"left":"center",u={button:r("bop.age.restricted.url.verify.age.button"),body:r("bop.age.restricted.url.body",{age:e}),cancel:r("bop.age.restricted.url.go.back.button"),header:r("bop.age.restricted.url.title"),...n},p=()=>{const E=new URLSearchParams;return E.append("destination",`${i.pathname}${i.search}`),E.append("ageVerified","false"),Yo({queryString:E.toString()})},g=()=>{if(t)l(t());else{if(c>1){l(-1);return}l(fn())}};return s.jsx(B,{isOpen:o,aria:{labelledby:u.header},children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:d,children:s.jsx(ee,{as:"h1",children:u.header})}),s.jsx(B.Body,{children:u.body}),s.jsxs(B.Footer,{align:d,className:"salt-gap-x--2",children:[s.jsx(x,{fill:!0,intent:"secondary",onClick:g,children:s.jsx(x.Text,{children:u.cancel})}),s.jsx(x,{asChild:!0,intent:"primary",fill:!0,children:s.jsx(tt,{href:p(),intent:"ghost",children:s.jsx(x.Text,{children:u.button})})})]})]})})},ff=()=>{const[e,t]=h.useState(!1),n=h.useCallback(()=>{const o=window.innerHeight*3,r=window.innerHeight,a=window.scrollY;a>o&&!e?t(!0):a<r&&e&&t(!1)},[e]);return h.useEffect(()=>(n(),document.addEventListener("scroll",n),()=>{document.removeEventListener("scroll",n)}),[n]),e},Syt=v(x)`
    ${e=>e.isFixedAboveFooter?Pe`
                  position: absolute;
                  inset-block-start: calc(${e.buttonOffsetTop}px + var(--salt-spacing-2));
                  inset-inline-end: var(--salt-spacing-4);
                  box-shadow: var(--salt-elevation-shadow-3);
                  z-index: 0;
              `:Pe`
                  position: fixed;
                  inset-inline-end: var(--salt-spacing-4);
                  inset-block-end: calc(var(--salt-spacing-4) + ${e.popUpBannerHeight}px);
                  box-shadow: var(--salt-elevation-shadow-3);
                  z-index: 10;
              `}

    ${e=>!e.visible&&Pe`
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
        `}
`,Du=()=>{const{formatMessage:e}=L(),t=os({breakpoint:"sm-up"}),n=os({breakpoint:"md-up"}),[o,r]=h.useState(!1),[a,i]=h.useState(0),[l,c]=h.useState(0),d=ff(),u=ft();h.useEffect(()=>{if(!(t||n))return c(0),()=>{};const E=document.querySelector('[data-test="pop-up-banner"], #StickyBopButton');if(!E)return c(0),()=>{};const y=new ResizeObserver(I=>{for(const S of I)c(S.contentRect.height)});return y.observe(E),()=>{y.disconnect()}},[t,n]),h.useEffect(()=>{const E=document.querySelector("main");if(!E)return()=>{};const y=()=>{const I=E.offsetTop+E.offsetHeight;window.scrollY+window.innerHeight>=I?(r(!0),i(I)):(r(!1),i(0))};return window.addEventListener("scroll",y),window.addEventListener("resize",y),()=>{window.removeEventListener("scroll",y),window.removeEventListener("resize",y)}},[]);const p=()=>{u({type:ht.BACK_TO_TOP_BUTTON_CLICKED})},g=()=>{typeof window<"u"&&(window.scrollTo({top:0,behavior:"smooth"}),p())};return s.jsx(Syt,{"data-test":"scroll-to-top-button",onClick:g,className:"scroll-to-top",isFixedAboveFooter:o,buttonOffsetTop:a,isMobile:t,isTablet:n,popUpBannerHeight:l||0,visible:d,intent:"tertiary-contrast",fill:!1,"aria-hidden":d,"aria-label":e("accessibility.backToTop.button"),children:s.jsx(x.Icon,{name:"arrow_up"})})},Cyt=()=>{const e=f(oDe),t=dr(),n=f(JRe),{formatMessage:o}=L(),r=o("bop.attributes.header"),a=e&&e.length,i=n&&n.length,l=t&&(t==="sm"||t==="xs");return!a&&!i?null:s.jsx(xe,{condensed:!0,children:s.jsxs(Q,{gap:["xs"],direction:l?"column":"row",children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:r})}),e&&e.map(({label:c,icon:d})=>s.jsxs(Q,{className:"salt-p--1",gap:["sm"],align:"center",wrap:"nowrap",additionalCss:"flex: 1 0 49%;",children:[s.jsx(pe,{"aria-hidden":"true",name:d,verticalAlign:"middle"}),s.jsx(O,{children:c})]})),n&&n.length>0&&n.map(({description:c,src:d})=>s.jsxs(Q,{className:"salt-p--1",gap:["sm"],align:"center",wrap:"nowrap",additionalCss:"flex: 1 0 49%;",children:[s.jsx(N$e,{src:d,ariaHidden:"true"}),s.jsx(O,{children:c})]}))]})})},ZJ=({breadcrumbs:e})=>{const t=f(r=>Ze(r,"structured-data-home-url"));if(!t||e.length===0)return null;const o={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:e.map((r,a)=>({"@type":"ListItem",position:a,item:{"@id":Ope(t)+r.url,name:r.name}}))};return s.jsx(Gn,{children:s.jsx("script",{"data-test":"breadcrumbs-structured-data",type:"application/ld+json",children:JSON.stringify(o)})})},JJ=()=>{const e=F();return{sendAnalyticsEvent:({categoryName:n,retailerCategoryId:o})=>{e(U.analyticsEvent({type:rn.SELECT_CATEGORY_GA4_EVENT,location:"breadcrumb",categoryName:n,retailerCategoryId:o}));const r={event:"select_category",id:o,location:"breadcrumb",name:n};te.sendEvent({GA:r,WA:null})}}},vyt=v.li`
    min-inline-size: 0;
    display: contents;

    > a {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    &:nth-child(3) > a,
    &:last-child > a {
        overflow: visible;
        text-overflow: unset;
    }
`,Tyt=({breadcrumb:e})=>{const{sendAnalyticsEvent:t}=JJ(),n=()=>{t({categoryName:e.name,retailerCategoryId:e.retailerId})};return s.jsxs(h.Fragment,{children:[s.jsx("li",{"aria-hidden":"true",children:s.jsx(pe,{name:"arrow_right",height:18,width:18})}),s.jsx(vyt,{children:s.jsx(Ye,{to:e.url,onClick:n,bold:!0,standalone:!0,children:e.name})})]})},_yt=v.ol`
    display: flex;
    flex-wrap: nowrap;
    gap: var(--salt-spacing-1);
    list-style: none;
    margin: 0;
    padding: 0;
`,byt=v.li`
    min-inline-size: 0;
    display: contents;
`,xyt=v(tt)`
    white-space: nowrap;
`,Ayt=({breadcrumbs:e})=>{const{formatMessage:t}=L(),n=f(EE),o=t("bop.breadcrumbs.home"),r=t("bop.breadcrumbs.accessibility.label",{productName:n});return s.jsx("nav",{"aria-label":r,children:s.jsxs(_yt,{children:[s.jsx(byt,{children:s.jsx(xyt,{href:"/",bold:!0,standalone:!0,children:o})}),e.map(a=>s.jsx(Tyt,{breadcrumb:a},`${a.id}-${a.name}`))]})})},Ryt=({lastBreadcrumb:e})=>{const{formatMessage:t}=L(),n=f(EE),{sendAnalyticsEvent:o}=JJ();if(!e||!e.url)return null;const r=t("bop.breadcrumbs.back.to.category",{category:e.name}),a=t("bop.breadcrumbs.accessibility.label",{productName:n}),i=()=>{o({categoryName:e.name,retailerCategoryId:e.retailerId})};return s.jsx("nav",{"aria-label":a,children:s.jsx(Ye,{to:e.url,onClick:i,bold:!0,standalone:!0,children:r})})},Dyt=()=>{const t=f(lq)?.breadcrumbs||[],n=f(p=>aq(p)),o=f(p=>_q(p)),r=dr(),a=f(pO),i=r==="xs"||r==="sm",[l,c]=Ee(["seo.rdbl","seo.ra"]),d=p=>{const g=a[p.categoryId];if(!g)return null;const E=c?g.retailerId:g.id;return{...g,url:l?bo(`${g?.fullURLPath.toLowerCase()}/${E}`):ao({queryString:`sublocationId=${E}`})}};if(!r||o||n)return s.jsx(_e,{height:"22px"});if(t.length===0)return null;const u=t.flatMap(p=>{const g=d(p);return g?[g]:[]});return u.length===0?null:s.jsxs(h.Fragment,{children:[s.jsx(ZJ,{breadcrumbs:u}),i?s.jsx(Ryt,{lastBreadcrumb:u[u.length-1]}):s.jsx(Ayt,{breadcrumbs:u})]})},Oyt=()=>{const e=f(rDe),{formatMessage:t}=L();if(!e)return null;const n={badge:t(`guaranteed.product.life.badge.${e.unit.toLowerCase()}`,{quantity:e.quantity}),description:e.quantity===1?t(`guaranteed.product.life.description.${e.unit.toLowerCase()}.one`):t(`guaranteed.product.life.description.${e.unit.toLowerCase()}.other`,{quantity:e.quantity})};return s.jsxs(Q,{gap:["xs"],"data-test":"guaranteed-product-life-container",children:[s.jsx(ln,{text:n.badge,intent:"secondary",singleLine:!0}),s.jsx(O,{bold:!0,children:n.description})]})},Pyt=()=>{const e=f(aDe),{formatMessage:t}=L(),n=He();return e?s.jsxs(Q,{gap:["xs"],children:[s.jsx(ln,{intent:"secondary","data-test":"deposit-chip",text:t("deposit.badge",{price:n(e)}),singleLine:!0}),s.jsx(O,{bold:!0,children:t("deposit.description")})]}):null},Nyt=v(xe)`
    &:hover {
        box-shadow: var(--salt-elevation-shadow-1);
    }
`,Lyt=v.div`
    display: flex;
    flex-direction: column;
    gap: var(--salt-spacing-1);
`,kyt=v(Ye)`
    .icon-promotion {
        fill: ${({isCoupon:e})=>e?"var(--coupon-style, var(--typography-promotion))":"var(--typography-promotion)"};
    }

    .icon-success {
        fill: var(--intent-success-900);
    }

    &:hover .icon-arrow {
        transition: transform 0.4s cubic-bezier(0, 0, 0, 2);
        transform: translateX(calc(4px * var(--text-x-direction))) scaleX(var(--text-x-direction));
    }
`,jyt=v(pe)`
    ${({isCoupon:e,isCouponApplied:t})=>e&&!t&&`
        fill: var(--coupon-style, var(--typography-promotion));
    `}
`,Myt=v(pe)`
    transition: transform 0.4s cubic-bezier(0, 0, 0, 2);
`,zG=v(O)`
    ${({isCoupon:e})=>e&&`
        color: var(--coupon-style, var(--typography-promotion));
    `}
`,wyt=(e,t)=>{let n,o;return e.presentationMode!=="MUTE_STYLE"&&(n="promotion",o="promotion"),t&&(n="promotion",o="success"),{textIntent:n,iconIntent:o}},Fyt=({offer:e,onClick:t,product:n})=>{const[o,r]=Ee(["seo.rdbl","seo.ra"]),{validatePromotion:a}=cT(n),{isCoupon:i,isCouponApplied:l,isFopCouponsEnabled:c}=a(e),{textIntent:d,iconIntent:u}=wyt(e,l),p=r?e.retailerPromotionId:e.id,g=Cn(e.description),E=i?QE(p,g):qa(p,o?g.toLowerCase():void 0);return s.jsx(Nyt,{asChild:!0,children:s.jsx(kyt,{href:E,onClick:t,intent:"ghost",isCoupon:c&&i,children:s.jsxs(Q,{wrap:"nowrap",justify:"space-between",align:"center",children:[s.jsxs(Q,{gap:["xs"],wrap:"nowrap",children:[s.jsx(jyt,{className:u&&`icon-${u}`,name:XE(l?"APPLIED_PROMO":e.type),"data-test":`offer-icon-${u}`,isCoupon:c&&i,isCouponApplied:l}),s.jsxs(Lyt,{children:[s.jsx(zG,{isCoupon:c&&i,intent:d,size:"l",bold:!0,children:e.description}),s.jsx(zG,{isCoupon:c&&i,intent:d,size:"l",children:e.longDescription})]})]}),s.jsx(Myt,{className:`icon-${d} icon-arrow`,name:"arrow_right"})]})})})},Byt=({product:e})=>{const{formatMessage:t}=L(),n=f(nDe),{productId:o,retailerProductId:r,name:a}=e,{validatePromotion:i,shouldShowUnavailablePromotion:l}=cT(e),{analyticsEvent:c}=U,d=F();if(!n||n.length===0)return null;const u=(p,g)=>{d(c({type:Jt.PROMO_LINK_CLICKED,sequence:g,promotionId:p.id,productId:o})),d(c({type:ns.GA_BOP_PROMO_LINK_CLICKED,itemId:r,itemName:a,index:0,promotionId:p.retailerPromotionId,promotionName:p.description,list:"product-details: other"}));const E={event:"select_item_promotion",id:r,name:a,index:0,promotion_id:p.retailerPromotionId,promotion_name:p.description,list:"product-details: other"};te.sendEvent({GA:E,WA:null})};return s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:t("bop.promotions.header")})}),n.filter(p=>i(p).shouldShowPromotion&&l(p)).map((p,g)=>s.jsx(Fyt,{offer:p,onClick:()=>u(p,g),product:e},p.id))]})},Uyt=e=>{if(!e)return;const t=e.scrollWidth>e.clientWidth,n=e.scrollHeight>e.clientHeight;(t||n)&&(e.tabIndex=0)},QG=({title:e,content:t})=>{const{formatMessage:n}=L(),o=f(D("sanitiser"));return t?s.jsxs(xe,{children:[s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h2",{children:n(e)})}),s.jsx(fUe,{ref:Uyt,dangerouslySetInnerHTML:{__html:o?Ri(t):t}})]}):null},Gyt=()=>{const e=f(lq);return e?s.jsxs(h.Fragment,{children:[s.jsx(QG,{title:"bop.product.info",content:e.detailedDescription}),e.fields?.map(t=>s.jsx(QG,{title:`bop.field.title.${t.title}`,content:t.content},t.title))]}):null},$yt=()=>{const e=He(),t=f(pu),n=f(gE);if(!t||!t.current)return null;const o=n?.presentationMode==="MUTE_STYLE"||!t.original?void 0:"promotion";return s.jsx(ee,{as:"span",intent:o,children:e(t.current)})},Hyt=()=>Pe`
    font-family: var(--alt-product-price-font-family, var(--font-family));
    font-weight: var(--alt-product-price-font-weight, 600);
`,bk=v(O)`
    ${Hyt}
`,Vyt=()=>{const{formatMessage:e}=L(),t=He(),n=f(pu),o=f(gE);if(!n||!n.gross)return null;const r=e("fop.tax.inclusive",{grossPrice:t(n.gross)}),a=o?.presentationMode==="MUTE_STYLE"||!n.original?void 0:"promotion";return s.jsx(bk,{intent:a,bold:!0,children:r})},Wyt=()=>{const e=He(),t=f(pu);return!t||!t.original?null:s.jsx(bk,{strikethrough:!0,size:"m",bold:!0,"data-test":"bop-price-original",children:e(t.original)})},Yyt=D("ngp"),qyt=D("hop"),Kyt=()=>{const e=f(dq),t=f(pu),n=f(Yyt),o=f(qyt),r=es("catch-weight-subtext-position"),a=f(gE),{formatMessage:i}=L();if(!t)return null;const l=!n&&e&&e.catchWeight,c=o&&!!t.reference,d=n&&t.gross,u=!n&&!c&&t.original,p=a?.presentationMode==="MUTE_STYLE"||!t.original?void 0:"promotion",g=s.jsx(bk,{bold:!0,intent:p,children:i("bop.catch.weight.unit")});return s.jsxs(Q,{gap:["xs"],"data-test":"price-container",align:"baseline",children:[l&&r==="pre"&&g,s.jsx($yt,{}),l&&r!=="pre"&&g,d&&s.jsx(Vyt,{}),u&&s.jsx(Wyt,{})]})},zyt=()=>{const e=L(),t=Me(lDe);return t?s.jsxs(Q,{direction:"column",children:[s.jsx(O,{children:e.formatMessage("bop.countryOfOrigin.label")}),s.jsx(ee,{as:"span",children:t})]}):null},Qyt=D("ag.ea"),Xyt=()=>{const e=f(HC),t=f(Qyt),{formatMessage:n}=L();if(!e)return null;const o=()=>{if(!e.catchweight)return{min:null,max:null};const a=e.catchweight.minQuantity.value,i=e.catchweight.minQuantity.uom,l=e.catchweight.maxQuantity.value,c=e.catchweight.maxQuantity.uom;return{min:`${a}${yg(n,i)}`,max:`${l}${yg(n,c)}`}},r={catchWeightTitle:n("bop.catch.weight.title"),catchWeightMessage:n("bop.catch.weight.message"),catchWeightRange:()=>n("bop.catch.weight.range",o()),ageRestriction:a=>n(t?"bop.age.restricted.enhanced":"bop.age.restricted",{age:a}),timeRestricted:n("bop.time.restricted")};return s.jsxs(h.Fragment,{children:[e.ageRestriction&&s.jsx(Te,{showIcon:!1,intent:"warning",text:t?s.jsx(ee,{as:"span",children:r.ageRestriction(e.ageRestriction)}):s.jsx(O,{size:"m",children:r.ageRestriction(e.ageRestriction)})}),e.size&&e.size.catchWeight&&s.jsx(Te,{showIcon:!1,intent:"info",text:s.jsxs(O,{children:[s.jsx(O,{bold:!0,children:`${r.catchWeightTitle}: `}),r.catchWeightMessage,s.jsx(O,{className:"salt-m-t--4 salt-d--block",children:r.catchWeightRange()})]})})]})},xk=()=>({parentElementRef:e,elementIndex:t,behavior:n="smooth"})=>{if(!e.current)return;const o=e.current.scrollLeft,r=e.current.getBoundingClientRect(),a=e.current.children[t];if(a){const i=a.getBoundingClientRect(),c=i.left-r.left-(r.width-i.width)/2+o;requestAnimationFrame(()=>{e.current&&e.current.scrollTo({left:c,behavior:n})})}},eee=({sliderRef:e,thumbnailRef:t,activeSlide:n,changeActiveSlide:o})=>{const r=h.useRef(!1),a=xk(),i=(p,g)=>{r.current||(o(p),a({parentElementRef:t,elementIndex:p,behavior:g}))},l=()=>{setTimeout(()=>{r.current=!1},200)};return{onSlideChange:i,onThumbnailClick:(p,g)=>{r.current||(r.current=!0,o(p),a({parentElementRef:e,elementIndex:p,behavior:g}),l())},onPrevButtonClick:()=>{if(r.current)return;r.current=!0;const p=n-1;o(p),a({parentElementRef:e,elementIndex:p}),l()},onNextButtonClick:()=>{if(r.current)return;r.current=!0;const p=n+1;o(p),a({parentElementRef:e,elementIndex:p}),l()}}},tee=e=>{const[t,n]=h.useState({}),o=r=>{const a=r.reduce((i,l)=>{const{target:c,isIntersecting:d}=l;if(c instanceof HTMLElement){const u=Number(c.dataset.id);return{...i,[u]:{target:c,visible:d}}}return i},{});n(i=>({...i,...a}))};return h.useEffect(()=>{const r=e.current,a=new IntersectionObserver(o,{root:e.current,rootMargin:"100% 0% 100% 0%",threshold:.99});return r&&Array.from(r.children).forEach(i=>a.observe(i)),()=>{r&&Array.from(r.children).forEach(i=>a.unobserve(i))}},[]),{listChildren:t}},Zyt=v.div`
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--salt-spacing-4);
    margin-block: var(--salt-spacing-2);
    margin-inline: 0;
    block-size: ${$(50)};
`,XG=v(x)`
    visibility: ${({hidden:e})=>e?"hidden":"visible"};
`,Jyt=v.div`
    display: flex;
    align-items: center;
    justify-content: flex-start;
    block-size: 100%;
    max-inline-size: ${$(400)};
    gap: var(--salt-spacing-2);
    overflow-x: scroll;
    scroll-behavior: smooth;
    scrollbar-width: none;
    scroll-snap-type: x mandatory;
    -ms-overflow-style: none;
    padding: 0;
    margin: 0;
    list-style: none;

    &::-webkit-scrollbar {
        display: none;
    }
`,eIt=v(x)`
    display: block;
    padding: 0;
    block-size: ${$(28)};
    inline-size: ${$(28)};
    overflow: hidden;
    cursor: pointer;
    border-radius: var(--salt-radius-default);
    border-style: solid;
    border-width: var(--salt-border-1);
    border-color: ${({selected:e})=>e?"var(--intent-primary)":"transparent"};

    &:hover {
        background: transparent;
        border-color: ${({selected:e})=>e?"var(--intent-primary)":"transparent"};
    }
`,tIt=v.img`
    inline-size: 100%;
    block-size: 100%;
    object-fit: cover;
`,see=({images:e,activeIndex:t,onThumbnailClick:n,onPrevButtonClick:o,onNextButtonClick:r,listRef:a})=>{const{formatMessage:i}=L(),l=h.useRef(!1),{listChildren:c}=tee(a),d=xk(),u=t===0,p=t===e.length-1,g=()=>{o();const S=c[t-1];S&&!S.visible&&d({parentElementRef:a,elementIndex:t-1})},E=()=>{r();const S=c[t+1];S&&!S.visible&&d({parentElementRef:a,elementIndex:t+1})},y=S=>{l.current||(["ArrowRight","ArrowLeft"].includes(S.key)&&(l.current=!0),S.key==="ArrowRight"&&!p&&(c[t+1]?.target.focus(),r()),S.key==="ArrowLeft"&&!u&&(c[t-1]?.target.focus(),o()),setTimeout(()=>{l.current=!1},400))},I=()=>e.map((S,C)=>s.jsx(eIt,{intent:"tertiary",fill:!1,selected:t===C,tabIndex:t===C?0:-1,"data-id":C,onClick:()=>n(C),role:"tab","aria-label":i("bop.carousel.navigation.selected.image",{positionOfSelectedImage:C+1,numberOfTotalImages:e.length}),"aria-selected":t===C,children:s.jsx(tIt,{src:S.src,alt:S.description,srcSet:S.fopSrcset,sizes:"100vw, 150vw, 300vw"})},S.src+S.description));return s.jsxs(Zyt,{children:[s.jsx(XG,{intent:"tertiary",size:"s",fill:!1,hidden:u,"aria-hidden":u,tabIndex:-1,onClick:g,"aria-label":i("bop.carousel.navigation.previous.arrow.button"),children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsx(Jyt,{ref:a,tabIndex:-1,role:"tablist",onKeyUp:y,children:I()}),s.jsx(XG,{intent:"tertiary",size:"s",fill:!1,hidden:p,"aria-hidden":p,tabIndex:-1,"aria-label":i("bop.carousel.navigation.next.arrow.button"),onClick:E,children:s.jsx(x.Icon,{name:"arrow_right"})})]})},sIt=v.ul`
    display: flex;
    padding: 0;
    margin: 0;
    block-size: 100%;
    inline-size: 100%;
    overflow-x: ${({zoomedIn:e})=>e?"hidden":"scroll"};
    cursor: ${({zoomedIn:e})=>e?"zoom-out":"zoom-in"};
    border-radius: var(--salt-radius-default);
    list-style: none;
    scroll-snap-type: x mandatory;
    scroll-snap-stop: always;
    scrollbar-width: none;
    -ms-overflow-style: none;

    &::-webkit-scrollbar {
        display: none;
    }
`,nIt=v.li.withConfig({shouldForwardProp:(e,t)=>!["display"].includes(e)&&t(e)})`
    display: ${({display:e})=>e};
    scroll-snap-align: start;
    flex-basis: 100%;
    flex-shrink: 0;
    overflow: hidden;
`,oIt=v(x)`
    display: flex;
    align-items: center;
    justify-content: center;
    block-size: 100%;
    inline-size: 100%;
    padding: 0;
    border: none;
    cursor: ${({zoomedIn:e})=>e?"zoom-out":"zoom-in"};

    &:hover {
        background: transparent;
        border: none;
    }
`,rIt=v.img.withConfig({shouldForwardProp:(e,t)=>["fetchPriority"].includes(e)||t(e)})`
    inline-size: 100%;
    block-size: ${({carouselImageHeight:e})=>e?$(e):"auto"};
    object-fit: contain;
`,nee=({images:e,activeSlide:t,onSlideChange:n,sliderRef:o,onSlideClick:r,scrollToActiveSlide:a,zoomedIn:i=!1,hideBorder:l=!1,carouselImageHeight:c,...d})=>{const[u,p]=h.useState(!1),g=h.useRef(!1),{listChildren:E}=tee(o),y=xk();h.useEffect(()=>{g.current=!0,a&&o.current&&g.current&&y({parentElementRef:o,elementIndex:t,behavior:"instant"});const A=setTimeout(()=>{g.current=!1},0);return()=>clearTimeout(A)},[a]),h.useEffect(()=>{if(u&&E[t]){const A=E[t]?.target?.firstElementChild;A instanceof HTMLElement&&A.focus()}},[u,t]);const I=()=>{const A=Object.values(E).findIndex(R=>R.visible);A===-1||t===A||g.current||n(A)},S=A=>{["ArrowLeft","ArrowRight"].includes(A.key)&&!i&&p(!0)},C=A=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(A.key)&&i&&A.preventDefault()},T=()=>{u&&p(!1)},_=()=>e.map((A,R)=>{const P=t===R,N=!P&&i?"none":"flex";return s.jsx(nIt,{display:N,"data-id":R,"data-active":P,"data-test":"product-image-slide",children:s.jsx(oIt,{intent:"tertiary",fill:!1,zoomedIn:i,tabIndex:P?0:-1,onClick:r,...d,children:s.jsx(rIt,{src:A.src,alt:A.description,srcSet:A.bopSrcset,sizes:`(max-width: ${Ke.sm}em) 300vw, 500vw`,fetchPriority:P?"high":"low",carouselImageHeight:c})})},A.src+A.description)});return s.jsx(sIt,{ref:o,tabIndex:-1,onScroll:I,zoomedIn:i,onKeyDown:C,onKeyUp:S,onBlur:T,hideBorder:l,children:_()})},oee=200,aIt="Bop__Modal__Overlay",ree="Bop__Modal__Content",iIt=v(gp)`
    &.${ree} {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        block-size: 100%;
        inline-size: 100%;
        overflow: hidden;
        z-index: ${$t.overlay};
        padding-block: 0 var(--salt-spacing-4);
        padding-inline: var(--salt-spacing-2);
        background-color: var(--intent-contrast);
        transform: translateY(100%);
        transition: transform ${oee}ms;

        &[class*='--after-open'] {
            transform: translateY(0);
        }

        &[class*='--before-close'] {
            transform: translateY(100%);
        }
    }
`,ZG=v(x)`
    align-self: flex-end;
    margin-block-start: var(--salt-spacing-1);
    z-index: ${$t.icon};
`,lIt=({isOpen:e,onClose:t,children:n,closeButtonLabel:o})=>s.jsxs(iIt,{overlayClassName:aIt,className:ree,bodyOpenClassName:null,closeTimeoutMS:oee,isOpen:e,onRequestClose:t,shouldCloseOnEsc:!0,id:"product-image-modal",children:[s.jsx(ZG,{intent:"tertiary",fill:!1,onClick:t,"aria-label":o,size:"m",children:s.jsx(ZG.Icon,{name:"close_default"})}),n]}),RS=40,cIt=v.div`
    align-items: center;
    position: relative;
    inline-size: 100%;
    block-size: 100%;
    display: flex;
    flex-direction: column;
    margin: 0;
    padding: 0;
    overflow: scroll;
    scrollbar-width: none;
    scroll-snap-type: x mandatory;
    -ms-overflow-style: none;
    scroll-snap-stop: always;

    &::-webkit-scrollbar {
        display: none;
    }
`,dIt=v.div.withConfig({shouldForwardProp:(e,t)=>!["height","width"].includes(e)&&t(e)})`
    inline-size: ${({width:e})=>e?`${$(e)}`:"100%"};
    block-size: ${({height:e})=>e?`${$(e)}`:"100%"};
    max-block-size: ${({height:e})=>e?"none":`${$(600)}`};
    max-inline-size: ${({width:e})=>e?"none":`${$(600)}`};
    margin: auto;
    padding: 0;
    user-select: none;
    will-change: inline-size, block-size, max-inline-size, max-block-size;
`,uIt=v.div`
    position: fixed;
    inset-block-start: ${$(50)};
    inset-inline-end: ${$(14)};
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--salt-spacing-1);
    z-index: ${$t.icon};
`,pIt=v.div`
    position: fixed;
    inset-block-end: ${$(20)};
    inset-inline-end: ${$(14)};
    display: flex;
    gap: var(--salt-spacing-1);
    align-items: center;
    z-index: ${$t.icon};
`,mIt=(e,t)=>{const n=t==="right",o=e==="ltr";return o&&n||!o&&!n?RS:-RS},hIt=(e,t)=>{const n=e.scrollLeft;return t==="rtl"?e.scrollWidth-e.clientWidth+n:n},JG=(e,t,n)=>{const o=hIt(e,n),r=e.scrollWidth-e.clientWidth;return t==="left"?o<=0:o>=r},gIt=({children:e,position:t,zoomedIn:n,arrowClickEvent:o,zoomIn:r,zoomOut:a,reset:i})=>{const{formatMessage:l}=L(),c=h.useRef(null),[d,u]=h.useState(!1),[p,g]=h.useState(!1),[E,y]=h.useState(!1),[I,S]=h.useState(!1),{direction:C}=f(WC);h.useEffect(()=>{c.current&&t?c.current.scrollTo({left:t.x,top:t.y,behavior:"instant"}):i()},[t]);const T=w=>{if(!c.current||(w==="left"?d:I))return;const G=mIt(C,w);c.current.scrollLeft+=G,o()},_=()=>{T("left")},A=()=>{c.current&&!p&&(c.current.scrollTop-=RS,o())},R=()=>{c.current&&!E&&(c.current.scrollTop+=RS,o())},P=()=>{T("right")},N={zoomIn:l("bop.carousel.product.image.increase.zoom.icon"),zoomOut:l("bop.carousel.product.image.decrease.zoom.icon"),left:l("bop.carousel.product.image.arrow.left.icon"),up:l("bop.carousel.product.image.arrow.up.icon"),down:l("bop.carousel.product.image.arrow.down.icon"),right:l("bop.carousel.product.image.arrow.right.icon")},k=()=>{if(!c.current)return;const{scrollTop:w,scrollHeight:j,offsetHeight:G}=c.current,W=JG(c.current,"left",C),H=JG(c.current,"right",C),K=C==="ltr"?W:H,X=C==="ltr"?H:W;u(K),S(X),w===0?g(!0):p&&g(!1),w===j-G?y(!0):E&&y(!1)},M=w=>{if(!n)return;const{key:j}=w;j==="ArrowLeft"&&T(C==="rtl"?"right":"left"),j==="ArrowRight"&&T(C==="rtl"?"left":"right"),j==="ArrowUp"&&!p&&A(),j==="ArrowDown"&&!E&&R()};return s.jsxs(cIt,{ref:c,onScroll:k,onKeyDown:M,"data-test":"product-image-zoom",children:[s.jsxs(uIt,{"data-test":"product-image-top-controls",children:[s.jsxs(x,{intent:"secondary",size:"s",disabled:n,onClick:r,"data-test":"product-image-increase-zoom-btn",children:[s.jsx(ie,{children:N.zoomIn}),s.jsx(x.Icon,{name:"plus"})]}),s.jsxs(x,{intent:"secondary",size:"s",disabled:!n,onClick:a,children:[s.jsx(ie,{children:N.zoomOut}),s.jsx(x.Icon,{name:"minus"})]})]}),s.jsx(dIt,{height:t?.contentHeight,width:t?.contentWidth,children:e}),n&&s.jsxs(pIt,{"data-test":"product-image-bottom-controls",children:[s.jsxs(x,{intent:"secondary",size:"s",disabled:d,onClick:_,children:[s.jsx(ie,{children:C==="ltr"?N.left:N.right}),s.jsx(x.Icon,{name:"arrow_left"})]}),s.jsxs(Q,{direction:"column",gap:["xs"],children:[s.jsxs(x,{intent:"secondary",size:"s",disabled:p,onClick:A,children:[s.jsx(ie,{children:N.up}),s.jsx(x.Icon,{name:"arrow_up"})]}),s.jsxs(x,{intent:"secondary",size:"s",disabled:E,onClick:R,children:[s.jsx(ie,{children:N.down}),s.jsx(x.Icon,{name:"arrow_down"})]})]}),s.jsxs(x,{intent:"secondary",size:"s",disabled:I,onClick:P,children:[s.jsx(ie,{children:C==="ltr"?N.right:N.left}),s.jsx(x.Icon,{name:"arrow_right"})]})]})]})},EIt=v.div`
    align-self: center;
    margin-block-start: auto;
    inline-size: 100%;
    max-inline-size: ${$(600)};
`,fIt=({isOpen:e,onClose:t,images:n,activeSlide:o,analyticsEvents:r,changeActiveSlide:a})=>{const{formatMessage:i}=L(),l=ft(),c=h.useRef(null),d=h.useRef(null),[u,p]=h.useState(null),{zoomInIconClick:g,zoomInImageClick:E,zoomOutIconClick:y,zoomOutImageClick:I,arrowClick:S}=r,{onSlideChange:C,onThumbnailClick:T,onPrevButtonClick:_,onNextButtonClick:A}=eee({sliderRef:c,thumbnailRef:d,activeSlide:o,changeActiveSlide:a}),R=!!u,P=n.length>1&&!R,N=()=>{if(!c.current)return;const{width:K,height:X,right:q,bottom:ne}=c.current.getBoundingClientRect(),ue=X*2,oe=K*2,ye=(oe-q)/2,he=(ue-ne)/2;p({contentHeight:ue,contentWidth:oe,x:ye,y:he})},k=()=>{S&&l(S)},M=()=>{N(),g&&l(g)},w=()=>{p(null),y&&l(y)},j=()=>{R?I&&l(I):E&&l(E)},G=K=>{if(!c.current)return;const{width:X,height:q,top:ne,left:ue}=c.current.getBoundingClientRect();R?p(null):"clientX"in K?p({contentHeight:q*2,contentWidth:X*2,x:K.clientX-ue,y:K.clientY-ne}):N(),j()},W=()=>{T(o,"instant")},H=()=>{p(null),t()};return s.jsxs(lIt,{isOpen:e,onClose:H,closeButtonLabel:i("bop.product.image.enlargement.overlay.close.button"),children:[s.jsx(gIt,{position:u,zoomedIn:R,zoomIn:M,zoomOut:w,reset:W,arrowClickEvent:k,children:s.jsx(nee,{"aria-label":i(R?"bop.product.image.enlargement.overlay.zooming.out":"bop.product.image.enlargement.overlay.zooming.in"),"aria-expanded":R,zoomedIn:R,activeSlide:o,sliderRef:c,images:n,onSlideChange:C,onSlideClick:G,scrollToActiveSlide:!0,hideBorder:!0})}),P&&s.jsx(EIt,{children:s.jsx(see,{listRef:d,images:n,activeIndex:o,onThumbnailClick:T,onPrevButtonClick:_,onNextButtonClick:A})})]})},yIt=v.div`
    position: relative;
    overflow: hidden;
`,IIt=v(x)`
    position: absolute;
    inset-block-end: var(--salt-spacing-1);
    inset-inline-end: var(--salt-spacing-1);
`,aee=({images:e,initialActiveIndex:t,analyticsEvents:n={},carouselImageHeight:o,onActiveSlideChange:r})=>{const{formatMessage:a}=L(),i=ft(),l=f(aq),[c,d]=h.useState(!1),[u,p]=h.useState(t??0),[g,E]=h.useState(!!t),y=h.useRef(null),I=h.useRef(null),{closeModal:S,modalIconClick:C,imageClick:T,..._}=n,A=W=>{p(W),r&&r(W)},{onSlideChange:R,onThumbnailClick:P,onPrevButtonClick:N,onNextButtonClick:k}=eee({sliderRef:y,thumbnailRef:I,activeSlide:u,changeActiveSlide:A}),M=()=>{E(!1),d(!0)},w=()=>{E(!0),d(!1),S&&i(S)},j=()=>{M(),T&&i(T)},G=()=>{M(),C&&i(C)};return l||e?.length===0?s.jsx(_e,{width:"100%",height:"470px"}):s.jsxs(h.Fragment,{children:[s.jsxs(yIt,{children:[s.jsx(nee,{sliderRef:y,"aria-label":a("bop.carousel.product.image",{positionOfSelectedImage:u+1,numberOfTotalImages:e.length,imageAltText:e[u]?.description}),images:e,activeSlide:u,onSlideChange:R,onSlideClick:j,scrollToActiveSlide:g,"aria-expanded":c,"aria-controls":"product-image-modal",carouselImageHeight:o}),s.jsx(IIt,{intent:"secondary",fill:!1,"aria-label":a("bop.carousel.product.image.open.overlay.icon"),onClick:G,children:s.jsx(x.Icon,{name:"search"})})]}),e.length>1&&s.jsx(see,{listRef:I,images:e,activeIndex:u,onThumbnailClick:P,onNextButtonClick:k,onPrevButtonClick:N}),s.jsx(fIt,{isOpen:c,images:e,onClose:w,activeSlide:u,changeActiveSlide:A,analyticsEvents:_})]})},SIt=({location:e="DEFAULT"})=>{const{formatMessage:t}=L();return s.jsxs(h.Fragment,{children:[s.jsxs(Q,{className:"md:salt-d--none salt-m-b--2",justify:"center",align:"center",children:[s.jsx(pe,{"data-test":"out-of-stock-icon",name:"info_default",width:24,height:24,className:"salt-m-r--1"}),s.jsx(ee,{as:"span",children:t("bop.out.of.stock.button")})]}),e!=="DESKTOP_STICKY"&&s.jsxs(Q,{className:"salt-d--none md:salt-d--flex salt-m-b--1 lg:salt-m--0",align:"center",children:[s.jsx(pe,{"data-test":"out-of-stock-icon",name:"info_default",width:32,height:32,className:"salt-m-r--2"}),s.jsx(ee,{as:"h2",children:t("bop.out.of.stock.button")})]})]})};function CIt(e){e==="FREE_GIFT"&&Z.info("free.gift.free.of.charge.notification")}const Ak=({location:e="DEFAULT"})=>{const{formatMessage:t}=L(),n=F(),o=f(HC),r=f(N=>xC(N,o?.productId)),a=f(bR),i=ir.createBatchAddToBasket(),l=ir.createBatchRemoveFromBasket(),c=h.useCallback(N=>k=>{if(k===N||!o)return;const M=k-N,w={page:"product-details",addedByFunction:"BOP",product:{...o,quantity:Math.abs(M)}};M>0?(n(i(w)),CIt(o.offer?.type)):n(l(w))},[o]);if(!o)return null;const{alternatives:d,available:u,maxQuantityReached:p,name:g,retailerProductId:E,timeRestriction:y,deliveryTimeRestrictionMessage:I}=o,S={addButton:t("bop.add.button"),addButtonTextAlternative:N=>t("bop.add.button.alternative",{productName:N}),outOfStockButton:t("bop.out.of.stock.button"),maxQuantity:t("bop.max.quantity"),maxQuantityLabel:t("bop.max.quantity.label"),timeRestricted:t("bop.time.restricted.button"),timeRestriction:({deliverableTo:N,deliverableFrom:k})=>t("bop.time.restriction",{to:N,from:k}),increaseQuantityTextAlternative:N=>t("counter.increase.quantity.button.alternative.with.product",{productName:N}),decreaseQuantityTextAlternative:N=>t("counter.decrease.quantity.button.alternative.with.product",{productName:N}),editQuantityTextAlternative:N=>t("counter.edit.quantity.input.alternative.with.product",{productName:N}),getQuantityDescriptionTextAlternative:N=>t("counter.quantity.description.alternative",{quantityInBasket:N}),seeAlternatives:N=>t("bop.alternatives.text",{numberOfAlternatives:N&&N.length})},C=!u&&r>0,T=!u&&d&&d.length>0,_={min:0,max:C?Number(r):a,count:r,onQuantityUpdate:c(r),plusDisabled:p||!u||C,addText:u?S.addButton:S.outOfStockButton,addTextAlternative:S.addButtonTextAlternative(g),increaseQuantityTextAlternative:S.increaseQuantityTextAlternative(g),decreaseQuantityTextAlternative:S.decreaseQuantityTextAlternative(g),editQuantityTextAlternative:S.editQuantityTextAlternative(g),getQuantityDescriptionTextAlternative:S.getQuantityDescriptionTextAlternative},A=y||I,P={..._,...(()=>{if(p&&A&&u){const N=y?S.timeRestriction(y):"";return{action:()=>{if(I&&Z.warning({formattedMessage:I}),y){const{deliverableTo:k,deliverableFrom:M}=y;Z.warning({key:"bop.time.restriction.toast",substitutions:{to:k,from:M}})}},addInfo:!0,addIcon:"slot",addText:S.timeRestricted,addTextAlternative:N,increaseQuantityTextAlternative:N}}else if(p&&u||C)return{action:()=>{Z.error("bop.max.quantity.toast.generic")},addInfo:!0,addIcon:"info_default",addText:S.maxQuantityLabel,addTextAlternative:S.maxQuantity,increaseQuantityTextAlternative:S.maxQuantity};return{}})()};return s.jsxs(V,{className:`salt-m--0 salt-gap--0 ${e==="MOBILE_STICKY"?"salt-p--2":""}`,children:[!u&&!C&&s.jsx(V.Item,{colSpan:{xs:12,lg:e!=="DESKTOP_STICKY"?6:void 0},children:s.jsx(SIt,{location:e})}),s.jsx(V.Item,{className:e==="DEFAULT"?"salt-p-r--2":void 0,colSpan:{xs:12,md:e!=="DESKTOP_STICKY"?6:void 0},children:T&&!C?s.jsx(x,{asChild:!0,intent:"secondary",fill:!0,children:s.jsx(Ye,{intent:"ghost",href:`/products/${E}/alternatives`,children:s.jsx(x.Text,{children:S.seeAlternatives(d)})})}):s.jsx(HO,{...P})})]})},vIt=()=>s.jsx(vE,{renderTo:"#StickyBopButton",children:s.jsx(Lt,{breakpoint:"md-up",remainInDom:!1,children:s.jsx(SE,{light:!0,children:s.jsx(Ak,{location:"MOBILE_STICKY"})})})}),TIt=D("ngp"),_It=()=>{const{formatMessage:e}=L(),t=He(),n=f(dq),o=f(pu),r=es("catch-weight-subtext-position"),a=f(TIt),i=f(gE);if(!o)return null;const l=!a&&n&&n.catchWeight,c=()=>n?.catchWeight?`${n.value}${yg(e,n.uom)}`:n?.value,d=()=>o.unit.pricePerSuffix?`${t(o.unit.current)} ${o.unit.pricePerSuffix}`:o.unit.label?e(o.unit.label,{price:t(o.unit.current)}):"",u=()=>{if(l){if(r==="pre")return`${e("bop.catch.weight.unit")} ${c()}`;if(r!=="pre")return`${c()} ${e("bop.catch.weight.unit")}`}return`${c()}`},p={pricePerUnit:d(),packSizeAccessibilityText:u(),size:c()},g=()=>s.jsx(ie,{children:n&&`${p.packSizeAccessibilityText} ${p.pricePerUnit}`});return s.jsxs(Q,{gap:["xs"],"data-test":"size-container",children:[g(),l&&r==="pre"&&s.jsx(O,{"aria-hidden":"true",children:e("bop.catch.weight.unit")}),n&&s.jsx(O,{"aria-hidden":"true",children:p.size}),l&&r!=="pre"&&s.jsx(O,{"aria-hidden":"true",children:e("bop.catch.weight.unit")}),o.original&&o.unit&&s.jsxs(O,{intent:i?.presentationMode==="MUTE_STYLE"?void 0:"promotion","aria-hidden":"true",children:["(",p.pricePerUnit,")"]}),!o.original&&o.unit&&s.jsxs(O,{"aria-hidden":"true",children:["(",p.pricePerUnit,")"]})]})},Rk=v.button`
    display: flex;
    inline-size: 100%;
    align-items: center;
`,bIt=({isRegularProduct:e})=>s.jsxs(h.Fragment,{children:[s.jsx(pe,{name:e?"regulars":"regulars_outline",width:24,verticalAlign:"middle",primary:e}),s.jsx("span",{className:"salt-m-y--2 salt-m-x--1",children:s.jsx(b,{id:e?"bop.regulars.remove":"bop.regulars.add"})})]}),xIt=({productId:e,retailerProductId:t,page:n,section:o,productIndex:r,productName:a})=>{const i=F(),l=f(p=>Da(p,e)),c=tf(),d=uL(),u=async()=>{l?.regular?await d({productId:e,page:n,section:o,productIndex:r,productName:a,retailerProductId:t,quantity:l.regular.quantity,frequency:l.regular.frequency}):i(Su.setSelectedProduct({productId:e,page:n,section:o,productIndex:r}))};return c?s.jsx(Rk,{"data-test":"regular-bob-button",onClick:u,children:s.jsx(bIt,{isRegularProduct:!!l?.regular})}):null},AIt=({productIndex:e,page:t,section:n,retailerProductId:o})=>{const r=f(Xe),a=f(tDe),i=f(EE),l=f(HC),c=F(),{formatMessage:d}=L();if(!r||!l)return null;const u=a?"bop.favorites.remove":"bop.favorites.add",p=a?"bop-favorites-remove-text":"bop-favorites-add-text",g=async()=>{if(a){try{await c(_S.removeFavorite(l.productId)),c(xt.updateProducts({product:[{productId:l.productId,favorite:void 0}]}));const y={event:"event",eventAction:"ManualRemoveFromFavorites",eventCategory:"FAVORITES",eventLabel:l.retailerProductId};te.sendEvent({GA:y,WA:null})}catch{Z.error("favorite.remove.item.error")}c(U.analyticsEvent({type:Ci.GA_REMOVE_FROM_WISHLIST,eventType:"favorites",list:ks(t,null,n)??"",index:e,id:o,name:i,quantity:1}));const E={event:"remove_from_wishlist",id:o,index:e,list:ks(t,null,n)??"",name:i||"",quantity:1,type:"favorites"};te.sendEvent({GA:E,WA:null})}else{try{await c(_S.addFavorite(l.productId)),c(xt.updateProducts({product:[{productId:l.productId,favorite:{}}]}));const y={event:"event",eventAction:"ManualAddToFavorites",eventCategory:"FAVORITES",eventLabel:l.retailerProductId};te.sendEvent({GA:y,WA:null})}catch{Z.error("favorite.add.item.error")}c(U.analyticsEvent({type:Ci.GA_ADD_TO_WISHLIST,eventType:"favorites",ecommerce:{items:[{index:e,item_id:o,item_name:i,item_list_name:ks(t,null,n)??"",quantity:1,seller_id:l.seller?.id||null}]}}));const E={event:"add_to_wishlist",type:"favorites",ecommerce:{items:[{index:e,item_id:o,item_name:i||"",item_list_name:ks(t,null,n)??"",quantity:1,seller_id:l.seller?.id||null}]}};te.sendEvent({GA:E,WA:null})}};return s.jsxs(Rk,{onClick:g,type:"button",children:[s.jsx(pe,{"data-test":"favorite-icon",name:a?"favourites":"favourites_add",width:24,verticalAlign:"middle",primary:!!a}),s.jsx(O,{"data-test":p,className:"salt-d--inline salt-m-y--2 salt-m-x--1",children:d(u)})]})},RIt=({productId:e,retailerProductId:t,productName:n})=>{const o=f(iDe),r=f(Xe),a=F(),{formatMessage:i}=L();if(!r)return null;const l=o?"bop.list.controls.list":"bop.list.controls.no.list",c=()=>J.openModal("shoppingLists",{productId:e,page:"product-details",section:"other",productIndex:0});return s.jsxs(ae.Fragment,{children:[s.jsxs(xe,{condensed:!0,children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:i("bop.lists.header")})}),s.jsx(AIt,{retailerProductId:t,page:"product-details",section:"other",productIndex:0}),s.jsxs(Rk,{onClick:()=>a(c()),type:"button",children:[s.jsx(pe,{name:o?"list":"list_outline",width:24,verticalAlign:"middle",primary:o}),s.jsx(O,{className:"salt-m-y--2 salt-m-x--1",children:i(l)})]}),s.jsx(xIt,{productId:e,retailerProductId:t,page:"product-details",section:"other",productIndex:0,productName:n})]}),s.jsx(wT,{})]})},DIt=({additionalProductCharge:e})=>{const{formatMessage:t}=L(),n=He(),{amount:o,currency:r}=e;if(!(o&&r))return null;const a={badge:t("additional.product.charge.badge",{charge:n(e)}),description:t("additional.product.charge.description",{charge:n(e)})};return s.jsxs(Q,{gap:["xs"],children:[s.jsx(ln,{intent:"secondary",text:a.badge,singleLine:!0}),s.jsx(O,{bold:!0,children:a.description})]})},OIt=v.div`
    display: flex;
    flex-direction: column;

    ${re.mdUp`
        flex-direction: row;
    `};

    &::before {
        content: '';
        margin-block: var(--salt-spacing-4);
        border-block-start: var(--salt-border-1) solid var(--intent-secondary);
        align-self: stretch;
        ${re.mdUp`
            margin-block: 0;
            margin-inline: var(--salt-spacing-4);
            border-inline-start: var(--salt-border-1) solid var(--intent-secondary);
 `};
    }
`,iee=v.div`
    flex: 1;
    min-inline-size: 0%;
`,PIt=v(iee)`
    order: -1;
`,$l=()=>{const e=F();return{sendAnalyticsEvent:n=>{e(U.analyticsEvent(n))}}},lee=(e,t={})=>{const n=h.useRef(null);return h.useEffect(()=>{const o=new IntersectionObserver(e,t);return n.current&&o.observe(n.current),()=>{n.current&&o.unobserve(n.current)}},[n,e]),n},Fc=({action:e,buttonText:t="request.error.action.button",title:n="request.error.title",titleAs:o="h3",titleIcon:r="info_default",description:a="request.error.message"})=>s.jsx(V,{flush:!0,className:"salt-m-y--4",children:s.jsx(V.Item,{colStart:{sm:2,md:4,lg:5},colSpan:{xs:12,sm:8,md:6,lg:4},children:s.jsx(Os,{title:n,description:a,titleAs:o,titleIcon:r,primaryButton:{text:t,onClick:e}})})}),NIt=(e,t={})=>n=>n(cd.getReviewsData(e,t)).catch(()=>{}),LIt=async(e,t,n={},o)=>{const r=Object.keys(n).length>0?`?${Qe.stringify(n)}`:"",a=go({basePath:o,target:`/ecomreviews/v1/products/${e}/reviews${r}`});return(await fetch(a,Jr({method:"GET",contentType:"application/json; charset=utf-8",clientRouteId:t}))).json()},kIt=async(e,t,n,o)=>{const r=go({basePath:o,target:`/ecomreviews/v1/products/${e}/reviews`}),a=await fetch(r,Jr({method:"POST",body:JSON.stringify(t),contentType:"application/json; charset=utf-8",...n}));return a.ok?a:Promise.reject(a)},jIt=async(e,t,n,o)=>{const r=go({basePath:o,target:`/ecomreviews/v2/products/${e}/reviews`}),a=new FormData;if("images"in t){const{images:l,...c}=t,d=new Blob([JSON.stringify(c)],{type:"application/json"});if(a.append("submitReviewDto",d),l?.length){l.forEach(({file:g})=>{a.append("media",g,g.name)});const u=JSON.stringify(l.map(({file:g,altText:E})=>({mediaFileName:g.name,mediaType:"IMAGE",altText:E}))),p=new Blob([u],{type:"application/json"});a.append("submitMediaDataDto",p)}}else{const l=new Blob([JSON.stringify(t)],{type:"application/json"});a.append("submitReviewDto",l)}const i=await fetch(r,Jr({method:"POST",body:a,...n}));return i.ok?i:Promise.reject(i)},MIt=e=>t=>t(cd.postReviewHelpfulness(e)).then(n=>n.type==="UPDATE_REVIEW_HELPFULNESS_SUCCESS"?n.payload.responseData:Promise.reject(n)),wIt=e=>t=>t(cd.deleteReviewHelpfulness(e)).then(n=>n.type==="UPDATE_REVIEW_HELPFULNESS_SUCCESS"?n.payload.responseData:Promise.reject(n)),FIt=async(e,t={},n,o)=>{const r=Object.keys(t).length>0?`?${Qe.stringify(t)}`:"",a=go({basePath:o,target:`/ecomreviews/v1/reviews/translate/${e}${r}`});return fetch(a,Jr({method:"GET",clientRouteId:n,contentType:"application/json; charset=utf-8"})).then(i=>i.json())},ta={fetchReviewsData:NIt,postProductReview:kIt,fetchReviewTranslation:FIt,postReviewHelpfulness:MIt,deleteReviewHelpfulness:wIt,getReviewsWithImages:LIt,postReviewWithMedia:jIt},BIt=({customerFoundReviewHelpful:e,isLoading:t,handleHelpfulness:n,helpfulText:o,reviewId:r})=>{const a=Ge(),i=Ne(),l=f(Xe),c=()=>{const d=`destination=${encodeURIComponent(`${i.pathname}${i.search}`)}`;return a(Yo({queryString:d}))};return s.jsxs(x,{intent:"secondary",loading:t,size:"s",type:"button",onClick:l?n:c,"data-test":`helpfulness-button-${r}`,fill:!1,"aria-live":"polite","aria-label":o,"aria-pressed":e,children:[s.jsx(x.Icon,{name:e?"helpfulness":"helpfulness_outline"}),s.jsx(x.Text,{"aria-hidden":"true",children:o})]})},UIt=({review:e,updateMediaReviewHelpfulness:t})=>{const n=f(D("rvws.help")),{customerFoundReviewHelpful:o}=e,[r,a]=h.useState(!1),{formatMessage:i}=L(),l=F(),{sendAnalyticsEvent:c}=$l(),d=f(lO),u={helpfulnessCount:i("reviews.bop.helpfulness.count",{count:e.helpfulVotes}),customerFoundHelpful:i("reviews.bop.helpfulness.customerFoundHelpful"),helpfulText:i("reviews.bop.helpfulness.button")},p=async()=>{try{if(c({type:zt.REVIEW_HELPFUL_BUTTON_CLICK,reviewId:e.id,location:"review_section",action:o?"unmarked_helpful":"marked_helpful"}),d)if(c({type:o?zt.GA_UNSELECT_REVIEW_HELPFUL:zt.GA_SELECT_REVIEW_HELPFUL,id:d,reviewId:e.id}),o){const g={event:"unselect_review_helpful",id:d,review_id:e.id};te.sendEvent({GA:g,WA:null})}else{const g={event:"select_review_helpful",id:d,review_id:e.id};te.sendEvent({GA:g,WA:null})}a(!0),o?await ta.deleteReviewHelpfulness(e.id)(l).then(g=>{t&&t(g)}):await ta.postReviewHelpfulness(e.id)(l).then(g=>{t&&t(g)})}catch{Z.error("reviews.toast.notification.helpfulness.error")}finally{a(!1)}};return n?s.jsxs(Q,{direction:"column",align:"flex-start",gap:["xs"],children:[(e.helpfulVotes>0||o)&&s.jsx(O,{size:"m",children:o?u.customerFoundHelpful:u.helpfulnessCount}),s.jsx(BIt,{customerFoundReviewHelpful:o,isLoading:r,handleHelpfulness:p,helpfulText:u.helpfulText,reviewId:e.id})]}):null},GIt=({response:e,headline:t})=>{const[n,o]=h.useState(!1),{formatMessage:r}=L(),a=f(cr),{sendAnalyticsEvent:i}=$l(),l={header:r("reviews.bop.retailerResponse.header"),submitted:r("reviews.bop.retailerResponse.submitted.info",{responseDate:gt(e.createdDate,a)}),expandedLabel:r("reviews.bop.retailerResponse.toggleOn.label",{headline:t}),collapsedLabel:r("reviews.bop.retailerResponse.toggleOff.label",{headline:t})};function c(){i(n?{type:zt.HIDE_RESPONSE_BUTTON_CLICKED}:{type:zt.VIEW_RESPONSE_BUTTON_CLICKED})}return s.jsxs(Je,{expanded:n,onToggle:()=>{o(!n),c()},aria:{expandedLabel:l.expandedLabel,collapsedLabel:l.collapsedLabel},children:[s.jsx(ie,{asChild:!0,children:s.jsx("h5",{children:l.header})}),s.jsxs(Je.ControlSection,{children:[s.jsx(O,{bold:!0,size:"m",children:l.header}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentExpanded,{children:s.jsxs(Q,{direction:"column",gap:["sm"],className:"salt-p-t--md",children:[s.jsx(O,{children:e.response}),s.jsx(O,{size:"m",children:l.submitted})]})})]})},$It=({isTranslated:e,handleTranslation:t,reviewHeadline:n})=>{const{formatMessage:o}=L(),r={translateReview:o("reviews.bop.showTranslation.button"),showOriginal:o("reviews.bop.showOriginal.button")};return s.jsxs(x,{intent:"secondary",type:"button",onClick:t,children:[s.jsx(x.Text,{children:e?r.showOriginal:r.translateReview}),s.jsx(ie,{children:n})]})},HIt=()=>{const{formatMessage:e}=L(),t=e("reviews.bop.customerReview.verification");return s.jsx(ln,{text:t,intent:"secondary","data-test":"verified-badge",className:"salt-p-y--0.5 salt-p-x--1",singleLine:!0})},e0=68,VIt=4,WIt=v(el)`
    border-radius: var(--salt-radius-default);
    object-fit: cover;
    display: block;
`,YIt=({media:e,openGallery:t})=>{const{formatMessage:n}=L(),o=e.slice(0,VIt).map((r,a)=>{const i=r.caption?n("reviews.bop.image.reviews.thumbnail.with.altText.accessibility",{altText:r.caption}):n("reviews.bop.image.reviews.thumbnail.no.altText.accessibility",{current:a+1,total:e.length});return s.jsx("button",{type:"button",onClick:()=>{t&&t(r.reviewId,a)},"aria-label":i,children:s.jsx(WIt,{alt:r.caption||"",src:r.uri,width:e0,height:e0})},r.uri)});return s.jsx("div",{className:"salt-d--flex salt-gap--2",children:o})},qIt=v(O)`
    overflow-wrap: anywhere;
`,cee=({review:e,setQueuedReviewImpressions:t,openGallery:n,hideMedia:o,updateMediaReviewHelpfulness:r})=>{const{formatMessage:a}=L(),i=f(cr),l=f(At),[c,d]=Ee(["rvws.ver","rvwsmd"]),[u,p]=h.useState(null),[g,E]=h.useState(!1),y=f(Ms),I=f(Do),S=g&&!!u,C=()=>{if(u){E(!g);return}ta.fetchReviewTranslation(e.id,{locale:y},I,l).then(P=>{P&&(p(P),E(!0))}).catch(()=>Z.error("reviews.toast.notification.translation.error"))},T={rating:a("reviews.bop.customerReview.rating",{rating:e.rating,totalRating:Dp}),a11yRating:a("reviews.bop.customerReview.rating.accessibility",{rating:e.rating,totalRating:Dp}),submittedDate:a("reviews.bop.customerReview.submitted.info",{reviewDate:gt(e.createdDate,i),nickname:e.nickname}),verifiedBadge:a("reviews.bop.customerReview.verification",{verification:e.isVerifiedBuyer})},_={root:null,rootMargin:"-80px 0px 0px 0px",threshold:SS},A=h.useCallback((P,N)=>{const k=P[0];k.intersectionRatio>SS&&(t({ID:e.id,STAR_RATING:e.rating,SEQUENCE:e.sequence,SUBMITTED_DATE:e.createdDate,RESPONSE_FROM_RETAILER:!!e.retailerResponse,HAS_IMAGE:!!e.media?.length,IMAGE_COUNT:e.media?.length||0,REVIEW_HELPFUL_COUNT:e.helpfulVotes}),N.unobserve(k.target))},[]),R=lee(A,_);return s.jsxs(Q,{direction:"column",gap:["md"],ref:R,children:[s.jsxs(Q,{align:"center",gap:["sm"],"aria-hidden":"true",children:[s.jsx(dT,{rating:e.rating}),s.jsx(O,{children:T.rating}),c&&e.isVerifiedBuyer&&s.jsx(HIt,{})]}),s.jsx(O,{asChild:!0,bold:!0,size:"m",children:s.jsxs("h4",{children:[S?u.headline:e.headline,s.jsxs(ie,{children:[T.a11yRating,c&&e.isVerifiedBuyer&&T.verifiedBadge]})]})}),s.jsx(qIt,{children:S?u.comments:e.comments}),!o&&d&&e.media?.length?s.jsx(YIt,{openGallery:n,media:e.media}):null,s.jsx(O,{size:"s",children:T.submittedDate}),s.jsx(UIt,{review:e,updateMediaReviewHelpfulness:r}),e.retailerResponse&&s.jsx(GIt,{response:e.retailerResponse,headline:e.headline}),e.locale!==y&&s.jsx($It,{isTranslated:g,handleTranslation:C,reviewHeadline:g&&u?.headline?u.headline:e.headline})]})},KIt=({openGallery:e,updateMediaReviewHelpfulness:t})=>{const{formatMessage:n}=L(),{sendAnalyticsEvent:o}=$l(),r=h.useRef([]),[a,i]=h.useState(r.current.length),l=f(L8),c=()=>{r.current.length>0&&(o({type:zt.PRODUCT_REVIEW_IMPRESSION,reviewImpressions:r.current}),r.current=[])},d=u=>{r.current=[...r.current,u],i(r.current.length)};return h.useEffect(()=>{r.current.length===5&&c()},[a]),h.useEffect(()=>()=>{r.current.length>0&&c()},[]),!l||l.length===0?s.jsx(O,{size:"l",className:"salt-m-x--md",children:n("reviews.bop.customerReview.noReviews")}):s.jsx(Be,{inline:!1,"data-test":"review-list",children:l.map((u,p)=>s.jsxs(Be.Item,{"data-test":`review-item-${u.id}`,children:[s.jsx(cee,{review:{...u,sequence:p+1},setQueuedReviewImpressions:d,openGallery:e,updateMediaReviewHelpfulness:t}),s.jsx(Ts,{className:"salt-m-y--4"})]},u.id))})},zIt=v(el)`
    --carousel-review-media-size: 100px;

    object-fit: cover;
    display: block;
    min-block-size: var(--carousel-review-media-size);
    block-size: var(--carousel-review-media-size);
    min-inline-size: var(--carousel-review-media-size);
    inline-size: var(--carousel-review-media-size);
    border-radius: var(--salt-radius-default);
    margin-block: var(--salt-spacing-1);
    margin-inline: 0;
`,QIt=({data:e,onClickViewGallery:t,ariaLabel:n,...o})=>s.jsx("button",{...o,onClick:t,type:"button",tabIndex:0,"aria-label":n,children:s.jsx(zIt,{src:e.uri,alt:e.caption||""})}),XIt=({openGallery:e,reviews:t,totalMediaReviews:n})=>{const{formatMessage:o}=L(),r=(d,u)=>{e(d,u)},a=t.reduce((d,u)=>d+(u.media?.length||0),0);let i=0;const l=t.flatMap(d=>d.media?.length?d.media.map((u,p)=>{i++;const g=u.caption?o("reviews.bop.image.reviews.thumbnail.with.altText.accessibility",{altText:u.caption}):o("reviews.bop.image.reviews.thumbnail.no.altText.accessibility",{current:i,total:a});return s.jsx(QIt,{onClickViewGallery:()=>r(u.reviewId,p),data:u,ariaLabel:g},u.uri)}):null).filter(Boolean);if(!l.length)return null;const c={accessibility:{imageReviews:o("reviews.bop.reviews.with.images.accessibility",{total:n})},viewGallery:o("reviews.bop.view.all.gallery.button"),imageReviews:o("reviews.bop.reviews.with.image",{total:n})};return s.jsx(to,{contrastBackground:!0,navigationButtonPosition:"side","data-test":"media-reviews-carousel",title:s.jsxs(ae.Fragment,{children:[s.jsx(O,{"aria-hidden":!0,asChild:!0,size:"l",bold:!0,children:s.jsx("h3",{children:c.imageReviews})}),s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:c.accessibility.imageReviews})})]}),headerButton:s.jsx(to.HeaderButton,{onClick:()=>r(t.at(0)?.id||null,0),children:c.viewGallery}),a11y:{labels:{"next-button":o("scroller.accessibility.viewNextIn",{title:o("messages.accessibility.imageReviews")}),"previous-button":o("scroller.accessibility.viewPreviousIn",{title:o("messages.accessibility.imageReviews")})}},children:l})},ZIt=()=>{const{formatMessage:e}=L(),t=f(eT)||{overallRating:"0",count:0},n=Number(t.overallRating),r=n>0&&t.count>0?e("reviews.bop.ratingSummary.outOf",{overallRating:s.jsx(O,{className:"salt-d--inline-block",size:"l",children:t.overallRating}),totalRating:Dp,ratingCount:t.count}):e("reviews.bop.ratingSummary.noRating"),a=e("reviews.bop.overallRating.accessibility",{rating:t.overallRating,totalRating:Dp,count:t.count});return s.jsxs("div",{"data-test":"overall-rating",children:[s.jsx(JIt,{asChild:!0,bold:!0,size:"l",id:"reviews-title",children:s.jsx("h3",{children:e("reviews.bop.ratingSummary.header")})}),s.jsxs(Q,{className:"salt-m-y--4",justify:"space-between",align:"center","aria-hidden":"true",children:[s.jsx(O,{className:"salt-d--inline-block",children:r}),s.jsx(dT,{rating:n,size:32})]}),s.jsx(ie,{children:a})]})},JIt=v(O)`
    /* scroll position is behind page header by default */
    ${re.lgUp`
    scroll-margin-top: calc(${co.v2.lgUp}px + var(--salt-spacing-8));
`}
    scroll-margin-block-start: calc(${co.v2.sm}px + var(--salt-spacing-8));
`,eSt=()=>{const{formatMessage:e}=L(),t=F(),n=Ge(),o=Ne(),{sendAnalyticsEvent:r}=$l(),a=f(Xe),i=f(cDe),c=f(D("rvws.block"))&&!i,d=()=>{t(J.openModal(K9)),r({type:zt.ADD_A_REVIEW_BUTTON_CLICKED})},u=()=>{r({type:zt.ADD_A_REVIEW_BUTTON_CLICKED});const E=`destination=${encodeURIComponent(`${o.pathname}${o.search}`)}`;return n(Yo({queryString:E}))},p=()=>{r({type:zt.WRITE_NON_VERIFIED_REVIEW_BLOCK_TOAST_DISPLAYED}),Z.warning("reviews.toast.notification.error.unverified")},g=()=>{a?c?p():d():u()};return s.jsxs(x,{"data-test":"add-review-button",size:"m",onClick:g,intent:"primary",className:"salt-m-b--4",fill:!0,children:[s.jsx(x.Icon,{name:"reviews_add"}),s.jsx(x.Text,{children:e("reviews.bop.addReview.button")})]})},tSt=({count:e})=>{const n=ZE(e).map(o=>s.jsx(sL,{name:"reviews",size:16},o));return s.jsx(sSt,{"data-test":"display-only-rating-icons",wrap:"nowrap",justify:"flex-end",children:n})},sSt=v(Q)`
    min-inline-size: 80px;
`,nSt=({count:e,rating:t,totalRating:n,highestRating:o})=>s.jsxs(Q,{wrap:"nowrap",align:"center","data-test":"ratings-breakdown-row","aria-hidden":"true",children:[s.jsx(tSt,{count:e}),s.jsx(oSt,{children:s.jsx(rSt,{"data-test":"fill-bar",fillWidth:t/n||0})}),s.jsx(aSt,{ratingTextLength:o.toString().length,size:"s",children:`(${t})`})]}),oSt=v.div`
    position: relative;
    inline-size: 100%;
    margin-inline: var(--salt-spacing-1) var(--salt-spacing-1);
    background-color: var(--intent-secondary);
    border-radius: 2px;
    block-size: 4px;
    overflow: hidden;
`,rSt=v.div`
    position: absolute;
    inline-size: ${e=>e.fillWidth*100}%;
    background-color: var(--intent-primary);
    border-start-end-radius: 2px;
    border-end-end-radius: 2px;
    block-size: 100%;
`,aSt=v(O)`
    min-inline-size: ${e=>`calc(${e.ratingTextLength>2?e.ratingTextLength:e.ratingTextLength+1} * var(--salt-spacing-2))`};
`,iSt=()=>{const{formatMessage:e}=L(),t=f(N8)||Array(5).fill(0),n=t.reduce((a,i)=>a+i,0),o=Math.max(...t),r=t.map((a,i)=>s.jsxs(h.Fragment,{children:[s.jsx(nSt,{highestRating:o,count:i+1,rating:a,totalRating:n}),s.jsx(ie,{children:e("reviews.bop.ratingBreakdown.accessibility",{rating:i+1,totalRating:Dp,count:a})})]},`${a}-${i+1}`)).reverse();return s.jsxs("div",{className:"salt-m-b--8","data-test":"ratings-breakdown",children:[s.jsx(O,{asChild:!0,size:"l",bold:!0,className:"salt-m-y--4",children:s.jsx("h3",{children:e("reviews.bop.ratingBreakdown.header")})}),s.jsx(Q,{gap:["sm"],direction:"column",children:r})]})},lSt=v(Rn)`
    :focus-within {
        border: none;
        border-radius: var(--salt-radius-default);
        outline: 2px auto Highlight;
        outline: 2px solid -webkit-focus-ring-color;
    }
`,cSt=({value:e,isActive:t,restoreHover:n,selectHover:o,isError:r=!1})=>{const{formatMessage:a}=L(),{register:i}=po(),{onChange:l,...c}=i(An.RATING,{required:!0});return s.jsxs(lSt,{onMouseEnter:o,onMouseLeave:n,htmlFor:`rating${e}`,children:[s.jsx("input",{...c,onChange:d=>{l(d),o()},value:e,type:"radio","aria-live":"polite","aria-invalid":r?"true":"false",id:`rating${e}`,"data-test":`${An.RATING}-input-radio`}),s.jsx(ie,{children:a("reviews.addModal.rating.label",{value:e})}),s.jsx(sL,{size:48,name:t?"reviews":"reviews_outline",isError:r})]})},dSt=v.fieldset`
    border: none;
    justify-content: center;
    display: flex;
`,uSt=()=>{const{watch:e,formState:{errors:t}}=po(),n=e(An.RATING),[o,r]=h.useState(0),{formatMessage:a}=L(),i={info:a("reviews.addModal.rating.info"),error:a("reviews.addModal.rating.error"),title:a("reviews.addModal.rating")},l=t?.rating,d=ZE(5).map(u=>s.jsx(cSt,{value:u,isActive:u<=o,selectHover:()=>r(u),restoreHover:()=>r(Number(n)),isError:!!l},u));return s.jsxs(_a,{"data-test":`${An.RATING}-input-field`,children:[s.jsx(O,{intent:l&&"error",className:"salt-m-b--4",children:i.title}),s.jsx(dSt,{children:d}),!!l&&s.jsx(O,{intent:"error",role:"alert",className:"salt-d--block",children:i.error}),s.jsx(O,{className:"salt-m-t--4",size:"s",children:i.info})]})},pSt=v(Mz)`
    resize: none;
`,mSt=()=>{const{formatMessage:e}=L(),{errors:t}=oC(),n=!!t?.comments,o={title:e("reviews.addModal.input.review"),placeholder:e("reviews.addModal.input.review.placeholder"),error:e("reviews.addModal.input.review.error")};return s.jsx(zd,{name:An.COMMENTS,rules:{required:n},render:({field:r,fieldState:{invalid:a,isTouched:i}})=>s.jsx(pSt,{input:{...r},maxLength:ant,"data-test":`${An.COMMENTS}-input-field`,label:o.title,"aria-live":"polite","aria-invalid":a?"true":"false",placeholder:o.placeholder,required:n,meta:{invalid:a,touched:i||a,error:o.error}})})},hSt=()=>{const{formatMessage:e}=L(),{errors:t}=oC(),n=!!t?.headline,o={title:e("reviews.addModal.input.title"),placeholder:e("reviews.addModal.input.title.placeholder"),error:e("reviews.addModal.title.error")};return s.jsx(zd,{name:An.HEADLINE,rules:{required:n},render:({field:r,fieldState:{invalid:a,isTouched:i}})=>s.jsx(Wo,{input:{...r},"data-test":`${An.HEADLINE}-input-field`,maxLength:rnt,label:o.title,"aria-live":"polite","aria-invalid":a?"true":"false",placeholder:o.placeholder,required:n,meta:{invalid:a,touched:i||a,error:o.error}})})},gSt=()=>{const{formatMessage:e}=L(),{errors:t}=oC(),n=!!t?.nickname,o={title:e("reviews.addModal.input.nickname"),placeholder:e("reviews.addModal.input.nickname.placeholder"),error:e("reviews.addModal.nickname.error")};return s.jsx(zd,{name:An.NICKNAME,rules:{required:n},render:({field:r,fieldState:{invalid:a,isTouched:i}})=>s.jsx(Wo,{input:{...r},maxLength:int,"data-test":`${An.NICKNAME}-input-field`,label:o.title,"aria-live":"polite","aria-invalid":a?"true":"false",placeholder:o.placeholder,required:n,meta:{invalid:a,touched:i||a,error:o.error}})})},ESt=e=>{const t={};return e.rating&&Number(e.rating)>=1&&Number(e.rating)<=5||(t[An.RATING]={type:"required"}),(e.nickname||e.headline||e.comments||e.images?.length)&&(e.nickname||(t[An.NICKNAME]={type:"required"}),e.headline||(t[An.HEADLINE]={type:"required"}),e.comments||(t[An.COMMENTS]={type:"required"})),{values:e,errors:t}},fSt=e=>({rating:Number(e.rating),...e.comments?{comments:e.comments}:{},...e.nickname?{nickname:e.nickname}:{},...e.headline?{headline:e.headline}:{},...e.images?.length?{images:e.images}:{}}),ySt=()=>{const e=F(),[t,n]=h.useState(!1),{sendAnalyticsEvent:o}=$l(),r=f(nm),[a]=Ee(["rvws.up"]),i=f(At),l=f(lO),c=f(Do),d=f(Na);return{postReview:async p=>{if(r){n(!0);try{a?await ta.postReviewWithMedia(r,p,{csrfToken:d,clientRouteId:c},i):await ta.postProductReview(r,p,{csrfToken:d,clientRouteId:c},i),Z.success("reviews.toast.notification.success"),l&&o({type:zt.REVIEW_SUBMITTED_TOAST_DISPLAYED,productId:r,retailerProductId:l,reviewRating:p.rating})}catch(g){if(g instanceof Response&&g.status===Go.BAD_REQUEST){const{code:E}=await g.json();if(E==="RVW-0001"){Z.error("reviews.toast.notification.error.submitted");return}}Z.error("reviews.toast.notification.error")}finally{e(J.closeModal()),n(!1)}}},isLoading:t}},t0={s:40,m:60},ISt=v("img")`
    inline-size: ${({size:e})=>$(t0[e])};
    block-size: ${({size:e})=>$(t0[e])};
    ${({border:e})=>e&&`
    border-radius: var(--salt-radius-default);
    `}
`,dee=({image:e,size:t="s",border:n=!0,altText:o})=>{const r=new FileReader;r.readAsDataURL(e);const a=h.useCallback(i=>{const l=i;l&&r.addEventListener("load",()=>{l.src=r.result?.toString()||""})},[]);return s.jsx(ISt,{alt:o,size:t,border:n,ref:a})},SSt=v(O)`
    inline-size: ${$(100)};
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: block-axis;
`,CSt=({image:e,altText:t,removeImage:n,index:o,totalImages:r})=>{const{formatMessage:a}=L(),i={remove:a("reviews.addModal.uploadImages.image.remove.button.label",{index:o,total:r}),imageOrder:a("reviews.addModal.uploadImages.image.description.accessibility",{index:o,total:r,alt:t})};return s.jsx(xe,{asChild:!0,condensed:!0,children:s.jsxs(Q,{align:"center",justify:"space-between",wrap:"nowrap",children:[s.jsxs(Q,{gap:["sm"],align:"center",wrap:"nowrap",children:[s.jsx(dee,{altText:t,image:e}),s.jsx(ie,{children:i.imageOrder}),s.jsx(SSt,{children:e.name}),s.jsx(pe,{success:!0,name:"status_yes"})]}),s.jsxs(x,{onClick:()=>n(e),fill:!1,intent:"tertiary",children:[s.jsx(ie,{children:i.remove}),s.jsx(x.Icon,{name:"delete"})]})]})})},vSt=v("label")`
    border-start-start-radius: var(--salt-radius-default);
    border-end-start-radius: var(--salt-radius-default);
    display: flex;
    overflow: hidden;

    &:focus-within {
        outline: solid -webkit-focus-ring-color;
        border-radius: var(--salt-radius-default);
    }
`,TSt=v("textarea")`
    flex: 1;
    border-start-end-radius: var(--salt-radius-default);
    border-end-end-radius: var(--salt-radius-default);
    appearance: none;
    resize: none;
    outline: none;
`,uee="alt-text",_St=({media:e,index:t,total:n})=>{const{formatMessage:o}=L();return s.jsxs(vSt,{children:[s.jsx(dee,{altText:e.altText,image:e.file,size:"m",border:!1}),s.jsx(ie,{children:o("reviews.addModal.uploadImages.writeAltTextModal.inputLabel",{index:t,total:n})}),s.jsx(TSt,{defaultValue:e.altText,className:"salt-p-y--2 salt-p-x--4",maxLength:200,placeholder:o("reviews.addModal.uploadImages.writeAltTextModal.inputPlaceholder"),name:uee})]})},bSt=({isOpen:e,closeModal:t,media:n,setMedia:o})=>{const{formatMessage:r}=L(),a=f(EE),i={header:r("reviews.addModal.uploadImages.writeAltTextModal.title"),close:r("reviews.addModal.uploadImages.writeAltTextModal.close"),headerA11y:r("reviews.addModal.uploadImages.writeAltTextModal.title.accessibility",{productName:a}),description:r("reviews.addModal.uploadImages.writeAltTextModal.description"),cancelButton:r("reviews.addModal.uploadImages.writeAltTextModal.cancelButton"),cancelButtonA11y:r("reviews.addModal.uploadImages.writeAltTextModal.cancelButton.accessibility"),confirmButton:r("reviews.addModal.uploadImages.writeAltTextModal.confirmButton"),confirmButtonA11y:r("reviews.addModal.uploadImages.writeAltTextModal.confirmButton.accessibility")},l=c=>{c.preventDefault(),c.stopPropagation();const u=new FormData(c.currentTarget).getAll(uee);o(n.map((p,g)=>({...p,altText:u.at(g)?.toString()||""}))),t()};return s.jsx(B,{isOpen:e,onRequestClose:t,closeMessage:i.close,children:s.jsxs("form",{onSubmit:l,onReset:t,children:[s.jsxs(B.Header,{align:"left",children:[s.jsx(ee,{"aria-hidden":!0,as:"h2",children:i.header}),s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:i.headerA11y})})]}),s.jsxs(B.Body,{children:[s.jsx(O,{children:i.description}),s.jsx(Q,{className:"salt-m-t--4",direction:"column",gap:["sm"],children:n.map((c,d)=>s.jsx(_St,{index:d+1,total:n.length,media:c},c.file.lastModified))})]}),s.jsx(B.Footer,{children:s.jsxs(Q,{wrap:"nowrap",direction:"row",gap:["md"],additionalCss:"flex: 1;",children:[s.jsxs(x,{type:"reset",onClick:t,fill:!0,intent:"secondary",children:[s.jsx(x.Text,{"aria-hidden":!0,children:i.cancelButton}),s.jsx(ie,{children:i.cancelButtonA11y})]}),s.jsxs(x,{type:"submit",fill:!0,intent:"primary",children:[s.jsx(x.Text,{"aria-hidden":!0,children:i.confirmButton}),s.jsx(ie,{children:i.confirmButtonA11y})]})]})})]})})},pee=["image/jpeg","image/jpg","image/png","image/webp","image/avif"],xSt=v("input")`
    position: absolute;
    opacity: 0;
    inset: 0;
    cursor: pointer;

    &::-webkit-file-upload-button {
        display: none;
    }
`,ASt=v("label")`
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    background-color: var(--intent-secondary-50);
    flex: 1;
    justify-content: center;
    align-items: center;
    border-radius: var(--salt-radius-default);
    padding-block: var(--salt-spacing-4);
    gap: var(--salt-spacing-2);

    &.drag-over {
        background-color: var(--intent-secondary);
    }

    &:focus-within,
    :hover {
        outline: auto -webkit-focus-ring-color;
    }
`,RSt=({label:e,handleUpload:t})=>{const[n,o]=h.useState(!1);return s.jsxs(ASt,{className:n?"drag-over":"",onDragOver:()=>{o(!0)},onDragLeave:()=>{o(!1)},onDrop:()=>{o(!1)},children:[s.jsx(pe,{name:"upload_image"}),s.jsx(O,{children:e}),s.jsx(xSt,{onChange:t,type:"file",accept:pee.join(","),name:An.IMAGES,title:"",multiple:!0})]})},DSt=()=>{const[e,t]=h.useState(!1),n=Number(es("reviews-maximum-images-per-review")),{formatMessage:o}=L(),r=dr(),{setValue:a,watch:i}=po(),l=i(An.IMAGES,[]),c=E=>{a(An.IMAGES,E)},d=()=>o(r==="lg"?"reviews.addModal.uploadImages.inputLabel.desktop":"reviews.addModal.uploadImages.inputLabel"),u={title:o("reviews.addModal.uploadImages.label"),subtitle:o("reviews.addModal.uploadImages.subtitle",{count:n}),addAltTextBtn:o("reviews.addModal.uploadImages.provideAltTextButton"),addAltTextLabel:o("reviews.addModal.uploadImages.provideAltTextLabel")},p=E=>{const y=l.filter(I=>I.file!==E);c(y)},g=E=>{const y=E.target.files;if(!y)return;const I=Array.from(y).filter(_=>pee.includes(_.type));I.length||c([]);const S=I.map(_=>({altText:"",file:_})),C=[...l,...S];C.length>n&&Z.error({key:"reviews.addModal.uploadImages.error.toast",substitutions:{count:n}});const T=Array.from(new Map(C.map(_=>[_.file.name,_])).values()).slice(0,n);c(T),E.target.value=""};return s.jsxs(Q,{direction:"column",gap:["sm"],className:"salt-m-b--4",children:[s.jsx(O,{children:u.title}),s.jsx(O,{children:u.subtitle}),l.length<n?s.jsx(RSt,{label:d(),handleUpload:g}):null,s.jsx(Q,{direction:"column",gap:["xs"],children:l.map(({file:E,altText:y},I)=>s.jsx(CSt,{index:I+1,totalImages:l.length,removeImage:p,image:E,altText:y},`${E.lastModified}-${E.name}`))}),l.length?s.jsxs(Q,{direction:"row",wrap:"nowrap",justify:"space-between",children:[s.jsx(O,{size:"s",children:u.addAltTextLabel}),s.jsx(x,{onClick:()=>t(!0),fill:!1,intent:"secondary",size:"s",children:u.addAltTextBtn}),e&&s.jsx(bSt,{closeModal:()=>t(!1),isOpen:e,media:l,setMedia:c})]}):null]})},OSt=()=>{const{formatMessage:e}=L(),{sendAnalyticsEvent:t}=$l(),[n]=Ee(["rvws.up"]),o=Dn({defaultValues:{[An.NICKNAME]:"",[An.HEADLINE]:"",[An.COMMENTS]:"",[An.RATING]:null},shouldFocusError:!0,shouldUnregister:!0,mode:"onSubmit",criteriaMode:"all",resolver:ESt}),{isLoading:r,postReview:a}=ySt(),{handleSubmit:i}=o,l=u=>{const p=Object.keys(u).reduce((g,E)=>({...g,[E]:!0}),{});t({type:zt.WRITE_REVIEW_ERROR_ALERT_DISPLAYED,...p})},c=u=>{const p=fSt(u);a(p)},d={header:e("reviews.addModal.header"),terms:e("reviews.addModal.termsAndConditions",{link:s.jsx(tt,{href:e("reviews.addModal.termsAndConditions.link"),target:"_blank",children:s.jsx(O,{size:"s",children:e("reviews.addModal.termsAndConditions.link.label")})})}),button:e("reviews.addModal.submit.button")};return s.jsx(On,{...o,children:s.jsxs(B.ModalForm,{onSubmit:i(c,l),"data-test":"add-review-form",closeMessage:e("modal.close"),children:[s.jsx(B.Header,{align:"left",children:s.jsxs(Q,{align:"center",gap:["xs"],children:[s.jsx(pe,{name:"reviews_add"}),s.jsx(ee,{as:"h2",children:d.header})]})}),s.jsxs(B.Body,{children:[s.jsx(uSt,{}),s.jsx(hSt,{}),s.jsx(mSt,{}),n&&s.jsx(DSt,{}),s.jsx(gSt,{}),s.jsx(O,{"data-test":"terms-and-conditions",size:"s",children:d.terms})]}),s.jsx(B.Footer,{children:s.jsx(x,{intent:"primary",loading:r,type:"submit",fill:!0,"data-test":"submit-review-button",children:s.jsx(x.Text,{children:d.button})})})]})})},PSt=()=>{const e=F(),t=()=>e(J.closeModal()),n=f($e(K9));return s.jsx(B,{isOpen:n,onRequestClose:t,children:s.jsx(OSt,{})})},NSt=({previousPages:e,currentPage:t,setCurrentPage:n,setPreviousPages:o,appliedFilters:r})=>{const a=F(),{formatMessage:i}=L(),l=f(v9e)||"",c=f(PN),d=f(nm),{sendAnalyticsEvent:u}=$l(),p=f(ON)?.find(I=>I.enabled);if(c&&c<=lnt||!d)return null;const g=()=>{ta.fetchReviewsData(d,{nextPage:l,sortOptionId:p.reviewSortOptionId,filter:r.at(0)?.attributeId})(a),o(I=>[...I,t]),n(l),u({type:zt.SEE_NEXT_REVIEW_PAGE_BUTTON_CLICKED,description:"User clicked next review page button"})},E=()=>{const I=[...e].pop()||"";ta.fetchReviewsData(d,{sortOptionId:p.reviewSortOptionId,...I!=="1"&&{nextPage:I},filter:r.at(0)?.attributeId})(a),o(S=>S.filter((C,T,_)=>T!==_.length-1)),n(I),u({type:zt.SEE_PREVIOUS_REVIEW_PAGE_BUTTON_CLICKED,description:"User clicked previous review page button"})},y={nextPage:i("reviews.bop.nextPage.accessibility"),previousPage:i("reviews.bop.previousPage.accessibility")};return s.jsxs(Q,{justify:"flex-end",gap:["xs"],"data-test":"reviews-pagination",children:[!!e.length&&s.jsx(x,{intent:"secondary",fill:!1,"data-test":"previous-page",onClick:E,"aria-label":y.previousPage,children:s.jsx(x.Icon,{name:"arrow_left"})}),!!l&&s.jsx(x,{intent:"secondary",fill:!1,"data-test":"next-page",onClick:g,"aria-label":y.nextPage,children:s.jsx(x.Icon,{name:"arrow_right"})})]})},LSt=["NEWEST","OLDEST","HIGHEST_RATED","LOWEST_RATED","HIGHEST_HELPFUL"],kSt=e=>LSt.includes(e),jSt=v(rt.Container)`
    position: relative;
    margin-inline: 0;
`,s0=({appliedFilters:e,setCurrentPage:t,setPreviousPages:n})=>{const{formatMessage:o}=L(),r=F(),[a]=Ee(["nform"]),i=f(ON)||[],l=f(nm),{sendAnalyticsEvent:c}=$l(),d=i.find(y=>y.enabled),u=d?.translation,p=`${u}. ${o("sort.accessibility.button.closed")}`,g=`${u}. ${o("sort.accessibility.button.open")}`,E=({reviewSortOptionId:y,translation:I})=>{l&&(ta.fetchReviewsData(l,{sortOptionId:y,filter:e.at(0)?.attributeId})(r),t("1"),n([]),c({type:zt.REVIEW_SORT_PREFERENCE_CHANGED,translation:I}))};return a?s.jsx(fs.DropdownSelect,{contrastBackground:!0,name:"sort","data-test":"sort-button",id:"sort-dropdown-select",value:{value:d?.reviewSortOptionId||"",name:u??""},options:i.map(y=>({value:y.reviewSortOptionId,name:y.translation})),placeholder:o("sort.button.default"),label:{text:o("sort.accessibility.button.closed"),isVisuallyConcealed:!0},onOptionChange:y=>{kSt(y.value)&&E({reviewSortOptionId:y.value,translation:y.name})}}):s.jsx(xit,{selectedItem:d,itemToString:y=>y?y.translation:"",onChange:y=>E(y),labelId:"sort-label",inputId:"sort-input",menuId:"sort-menu",children:({highlightedIndex:y,itemToString:I,getItemProps:S,getLabelProps:C,getMenuProps:T,getRootProps:_,getToggleButtonProps:A,isOpen:R,toggleMenu:P})=>s.jsxs(jSt,{..._({}),children:[s.jsx(rt.TriggerDefaultButton,{open:R,size:"m",fill:!0,text:u,...A({"aria-haspopup":!0,"aria-pressed":R,"aria-label":R?g:p}),...C(),onClick:()=>{P()},"data-test":"sort-button",role:void 0,disabled:!i.length}),s.jsx(rt.Body,{isOpen:R,...T({role:"radiogroup"}),children:s.jsx(rt.Content,{children:i.map((N,k,M)=>s.jsx(Ao,{"data-test":"radio-option",bold:y===k,checked:N.enabled,last:k===M.length-1,label:I(N),value:N.reviewSortOptionId,...S({index:k,item:N,role:void 0,onChange:()=>{}})},N.reviewSortOptionId))})})]})})},MSt=()=>{const e=ZE(5).map(t=>s.jsx(_e,{height:"15px",width:"16px"},t));return s.jsxs(Q,{"data-test":"review-list-item-skeleton",direction:"column",gap:["md"],className:"salt-m-t-md",children:[s.jsxs(Q,{gap:["sm"],children:[s.jsx(Q,{gap:["xs"],children:e}),s.jsx(_e.Typography,{variant:"textS",fill:25})]}),s.jsx(_e.Typography,{variant:"textS",fill:25}),s.jsxs(Q,{direction:"column",gap:["sm"],children:[s.jsx(_e.Typography,{variant:"textS"}),s.jsx(_e.Typography,{variant:"textS",fill:50})]}),s.jsx(_e.Typography,{variant:"textS",fill:25}),s.jsx(Ts,{className:"salt-m-b--2"})]})},wSt=()=>{const e=ZE(5).map(t=>s.jsx(MSt,{},`skeleton-${t}`));return s.jsx(h.Fragment,{children:e})},FSt=v.div`
    display: grid;
    gap: var(--salt-spacing-4);
    grid-template-columns: 1fr;
    ${re.mdUp`
        grid-template-columns: repeat(2, 1fr);
        `}
`,BSt=v.div`
    min-inline-size: 0;
`,USt=328;function GSt({review:e,isOpen:t,initialImageIndex:n,showNextReview:o,showPreviousReview:r,totalMediaReviews:a,closeModal:i,updateMediaReviewHelpfulness:l}){const{formatMessage:c}=L(),d={title:c("reviews.bop.image.reviews.details.title",{total:a,current:e.sequence}),next:c("reviews.bop.image.gallery.next.button"),previous:c("reviews.bop.image.gallery.previous.button"),accessibility:{title:c("reviews.bop.gallery.title.accessibility",{total:a,current:e.sequence}),next:c("reviews.bop.image.gallery.next.button.accessibility"),previous:c("reviews.bop.image.gallery.previous.button.accessibility")}},u=()=>{o()},p=()=>{r()};return s.jsxs(B,{maxWidth:"md",isOpen:t,onRequestClose:i,children:[s.jsxs(B.Header,{align:"left",children:[s.jsx(ee,{as:"h1","aria-hidden":!0,children:d.title}),s.jsx(ie,{asChild:!0,children:s.jsx("h1",{children:d.accessibility.title})})]}),s.jsx(B.Body,{children:s.jsxs(FSt,{children:[e.media?.length?s.jsx(BSt,{children:s.jsx(aee,{images:e.media.map(g=>({src:g.uri,description:g.caption||""})),analyticsEvents:{},initialActiveIndex:n,carouselImageHeight:USt},e.id)}):null,s.jsx(cee,{setQueuedReviewImpressions:()=>{},hideMedia:!0,review:e,updateMediaReviewHelpfulness:l})]})}),s.jsx(B.Footer,{children:s.jsxs(Q,{wrap:"nowrap",gap:["md"],additionalCss:"flex: 1;",children:[s.jsxs(x,{onClick:p,fill:!0,intent:"secondary",children:[s.jsx(x.Text,{"aria-hidden":!0,children:d.previous}),s.jsx(ie,{children:d.accessibility.previous})]}),s.jsxs(x,{onClick:u,fill:!0,intent:"secondary",children:[s.jsx(x.Text,{"aria-hidden":!0,children:d.next}),s.jsx(ie,{children:d.accessibility.next})]})]})})]})}const Lb={[zt.REVIEW_IMAGE_NAVIGATED]:"User clicked on the image navigation buttons.",[zt.REVIEW_IMAGE_GALLERY_OPENED]:"User opened the review image gallery.",[zt.REVIEW_IMAGE_GALLERY_CLOSED]:"User closed the review image gallery."},Sy={closeModal:{type:zt.REVIEW_IMAGE_GALLERY_CLOSED,description:Lb.REVIEW_IMAGE_GALLERY_CLOSED},openModal:{type:zt.REVIEW_IMAGE_GALLERY_OPENED,description:Lb.REVIEW_IMAGE_GALLERY_OPENED},arrowClick:{type:zt.REVIEW_IMAGE_NAVIGATED,description:Lb.REVIEW_IMAGE_NAVIGATED}},$St=e=>{const t=ft(),n=f(Do),[o,r]=h.useState([]),[a]=Ee(["rvwsmd"]),i=f(P8),l=f(At),[c,d]=h.useState(0),[u,p]=h.useState(null),[g,E]=h.useState(0),[y,I]=h.useState(null),[S,C]=h.useState(!1),T=y!==null?o.at(y):null,_=async w=>{C(!0),e&&ta.getReviewsWithImages(e,n,{sortOptionId:"NEWEST",filter:"IMAGES_ONLY",nextPage:w,pageSize:10},l).then(j=>{if(j){const G=[...o,...j.reviews],H=[...new Map(G.map(K=>[K.id,K])).values()];r(H),p(j.metadata.nextPage??null),c||d(j.reviewCount)}}).finally(()=>C(!1))},A=w=>{r(o.map(j=>j.id===w.id?{...j,...w}:j))},R=w=>{if(S||!a)return;w>=o.length-3&&u&&_(u)};return{fetchMediaReviews:_,mediaReviews:o,isReviewsMediaEnabled:a,activeMediaReviewModal:T,nextPageMediaReviews:u,initialActiveMediaIndex:g,setActiveMediaReviewIndex:I,totalMediaReviews:c,isLoadingImages:S,activeMediaReviewIndex:y,openMediaReviewGallery:(w,j)=>{t({...Sy.openModal,pageEventAttributes:{reviewId:w}});const G=o.findIndex(H=>H.id===w);if(G!==-1){E(j),I(G);return}const W=i.data?.reviews.find(H=>H.id===w);W&&(cH.flushSync(()=>{r([W,...o])}),E(j)),R(G)},showPreviousReview:()=>{if(t({...Sy.arrowClick,pageEventAttributes:{direction:"previous"}}),y===null)return;const w=y-1,j=w<0?o.length-1:w;I(j),E(0),R(j)},showNextReview:()=>{if(t({...Sy.arrowClick,pageEventAttributes:{direction:"next"}}),y===null)return;const j=(y+1)%o.length;I(j),E(0),R(j)},closeMediaReviewGallery:()=>{t({...Sy.closeModal,pageEventAttributes:{reviewId:T?.id}}),I(null)},handleReviewHelpfulness:A}},n0=e=>e instanceof HTMLElement,mee=({onOpen:e,onClose:t,...n})=>{const o=f(c=>c.control.modal),r=f(cf("HEADER")),a=Object.values(o).some(c=>c.isOpen),i=()=>{const c=document.querySelector("#modal-body");a&&n0(c)&&tZ(c),a||SA(r),eZ(a),SA(r),oZ(a),e?.()},l=()=>{const c=document.querySelector("#modal-body");n0(c)&&sZ(c),t?.()};return s.jsx(Rce,{portalContainerSelector:"#modal",onOpen:i,onClose:l,...n})},KT=({checked:e,label:t,condensed:n=!0,itemProps:o,onChange:r,...a})=>s.jsx(Be.Item,{...o,...a,children:s.jsx(xe,{condensed:n,children:s.jsx(Lo,{bold:!1,label:t,input:{checked:e,onChange:r},whiteSpace:"nowrap"})})});KT.displayName="FilterListItem";const hee=(e,t)=>{const n=h.useRef(null),o=h.useRef(null),[r,a]=h.useState(e);return h.useEffect(()=>{if(!o.current||!n.current)return;const i=n.current.getBoundingClientRect(),l=o.current.getBoundingClientRect();if(i.left+l.width>window.innerWidth){const c=i.left+l.width-window.innerWidth;a((c+16)*-1)}else a(0)},t),[r,o,n]},Dg=(e,t)=>e.type==="BRANDS"?t.formatMessage("filter.label.brands"):e.type==="ON_OFFER"?t.formatMessage("promotions.button"):e.type==="FAVORITES"?t.formatMessage("filter.label.favorites"):e.type==="NEW"?t.formatMessage("filter.label.new"):e.type==="CUSTOMER_RATING"?t.formatMessage("filter.label.customer.rating"):e.label,Dk=v(rt.Body)`
    min-inline-size: ${$(240)};
    max-inline-size: ${$(340)};
    ${({left:e})=>e&&`inset-inline-start: ${e}px;`}

    /* Override salt-web Dropdown smUp value */
    ${re.smUp`
        inline-size: ${$(240)};
    `}

    ${re.lgUp`
        inline-size: 100%;
        inset-inline-start: 0;
        min-inline-size: ${$(240)};
        ${({autoWidthLg:e})=>e&&"inline-size: auto;"};
       ;
    `}
`,HSt=v(rt.Content)`
    max-block-size: ${$(300)};
    padding-block-end: 0;
`,VSt=({isOpen:e,menuProps:t,onClearSelectedButtonClick:n,onApplyButtonClick:o,onDropdownBlur:r,onEscKeyDown:a,clearButtonDisabled:i,children:l,positionLeft:c,className:d})=>{const u=L(),p=h.useRef(null),g=C=>{p.current&&!p.current.contains(C.relatedTarget)&&r()},E=C=>{C.key==="Escape"&&a()},y=C=>{p.current=C,t.ref(C)},{ref:I,...S}=t;return e?s.jsxs(Dk,{"data-test":"filter-facet-dropdown",isOpen:!0,ref:y,...S,left:c,className:d,onBlur:g,onKeyDown:E,children:[s.jsx(HSt,{role:"group","aria-labelledby":"id-filter-facet-dropdown-options-group",children:l}),s.jsxs(rt.Footer,{children:[s.jsx("div",{className:"salt-m-b--2",children:s.jsx(x,{fill:!0,intent:"secondary",onClick:n,disabled:i,"aria-label":u.formatMessage("filter.accessibility.clear.selected.button"),children:s.jsx(x.Text,{children:s.jsx(b,{id:"filter.button.clear.selected"})})})}),s.jsx(x,{intent:"primary",fill:!0,"aria-label":u.formatMessage("filter.accessibility.apply.button"),onClick:o,children:s.jsx(x.Text,{children:s.jsx(b,{id:"search.filter.button.apply"})})})]})]}):null},md=(e,t)=>({filterId:e.id,attributeId:t.id}),WSt=(e,t)=>{if(e===null)return;Dce(e,{boundary:t}).forEach(({el:o,top:r,left:a})=>{o.scrollTop=r,o.scrollLeft=a})},gee=v(Ll)`
    position: absolute;
    inset-block-start: calc(var(--salt-spacing-2) * -1);
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
`,YSt=v.div`
    position: relative;
`,qSt=({filter:e,filterHandler:t,onOpen:n,clearedFilterAttributesHandler:o})=>{const r=L(),a=h.useRef(!1),[i,l]=h.useState(null),c=h.useMemo(()=>e.attributes.filter(oe=>oe.selected).map(oe=>md(e,oe)),[e]),[d,u]=h.useState(c);h.useEffect(()=>{u(c)},[c]);const p=()=>({filterId:e.id,selectedAttributes:d.map(oe=>oe.attributeId)}),g=()=>{d.length===0&&i&&o&&(o({...i,applyButtonClicked:a.current}),l(null))},E=(oe,ye)=>{const{changes:he,type:Ie}=ye;switch(Ie){case Er.stateChangeTypes.FunctionToggleMenu:return a.current=!1,he;case Er.stateChangeTypes.FunctionCloseMenu:return g(),he;case Er.stateChangeTypes.ToggleButtonKeyDownArrowUp:case Er.stateChangeTypes.ToggleButtonKeyDownArrowDown:return{...he,highlightedIndex:-1};case Er.stateChangeTypes.ToggleButtonKeyDownSpaceButton:case Er.stateChangeTypes.ItemClick:return he.selectedItem?{...he,isOpen:!0}:he;case Er.stateChangeTypes.ToggleButtonBlur:return he.selectedItem?{...he,isOpen:!0,selectedItem:null}:{...he,isOpen:oe.isOpen};default:return he}},y=()=>{S||(u(c),n?.(e.id)),C()},I=({selectedItem:oe})=>{if(l(null),!oe)return;const ye=d.findIndex(he=>he.filterId===oe.filterId&&he.attributeId===oe.attributeId);ye>0?u([...d.slice(0,ye),...d.slice(ye+1)]):u(ye===0?[...d.slice(1)]:[...d,oe])},{isOpen:S,toggleMenu:C,closeMenu:T,getToggleButtonProps:_,getMenuProps:A,getItemProps:R}=Er({items:e.attributes.map(oe=>md(e,oe)),itemToString:oe=>oe?oe.attributeId:"",stateReducer:E,selectedItem:null,onSelectedItemChange:I,scrollIntoView:WSt,labelId:`filter-label-${e.label}`,menuId:`filter-menu-1-${e.label}`}),[P,N,k]=hee(0,[S]),M=d.length>0,w=oe=>oe.id==="onOffer"?r.formatMessage("promotions.category.root.name"):oe.id==="favoritesOnly"?r.formatMessage("filter.options.label.all.favorites"):oe.id==="new"?r.formatMessage("filter.label.new"):oe.label,j=()=>s.jsxs(ae.Fragment,{children:[s.jsx(ie,{id:"id-filter-facet-dropdown-options-group",children:r.formatMessage("filter.accessibility.facet.list")}),s.jsx(Be,{inline:!1,children:e.attributes.map((oe,ye)=>{const he=!!d.filter(Fe=>Oi(Fe,md(e,oe))).length,Ie=w(oe);return s.jsx(KT,{label:Ie,checked:he,itemProps:R({index:ye,item:md(e,oe),role:void 0,"aria-selected":void 0})},`${oe.id}${e.id}`)})})]}),G=oe=>{const ye=oe.relatedTarget;if(ye instanceof HTMLElement){const he=N.current&&N.current.contains(ye),Ie=N.current&&ye.id===N.current.id;!he&&!Ie&&T()}},W=()=>{k.current&&k.current.focus()},H=c.length,K=Dg(e,r),X=H>0?r.formatMessage("filter.accessibility.facet.with.applied",{filterLabel:K,numberOfAppliedFilters:H}):r.formatMessage("filter.accessibility.facet",{filterLabel:K}),q=_({"aria-expanded":S,"aria-label":X,"aria-labelledby":void 0,"aria-controls":`filter-facet-${e.id}`,"aria-haspopup":"dialog","aria-activedescendant":void 0,ref:k}),ne=A({ref:N,"aria-label":`${r.formatMessage("filter.accessibility.facet.list")} ${r.formatMessage("filter.accessibility.facet",{filterLabel:K})}`,"aria-labelledby":void 0,role:"dialog","aria-modal":!0,id:`filter-facet-${e.id}`},{suppressRefError:!0}),ue=Dm(T,[]);return s.jsxs(rt.Container,{"data-test":`filter-facet-${e.id}`,ref:ue,children:[s.jsx(rt.TriggerDefaultButton,{fill:!0,isOpen:S,text:K,...q,ref:q.ref,onClick:y,onBlur:G,"data-test":`filter-open-menu-${e.id.toLowerCase()}`}),H>0&&s.jsx(gee,{intent:"secondary",count:H}),s.jsx(VSt,{isOpen:S,clearButtonDisabled:!M,menuProps:ne,onApplyButtonClick:()=>{a.current=!0,W(),t(d,e.id)},onDropdownBlur:T,onEscKeyDown:W,onClearSelectedButtonClick:()=>{l(p()),u([])},positionLeft:P,children:j()})]})},KSt=v.div`
    display: flex;
    flex-direction: column;
    max-block-size: ${$(384)};
    block-size: 100%;
`,zSt=v.div`
    flex-shrink: 0;
`,QSt=v.div`
    flex-grow: 1;
    overflow: auto;
`,XSt=({onOpen:e,filter:t,filterHandler:n,contrastBackground:o,clearedFilterAttributesHandler:r})=>{const a=L(),i=h.useRef(!1),[l,c]=h.useState(null),d=h.useMemo(()=>t.attributes.filter(A=>A.selected).map(A=>md(t,A)),[t]),[u,p]=h.useState([]),g=()=>({filterId:t.id,selectedAttributes:u.map(A=>A.attributeId)}),E=()=>{u.length===0&&l&&r&&(r({...l,applyButtonClicked:i.current}),c(null))},y=({selectedItem:A})=>{if(c(null),!A)return;const R=u.findIndex(P=>P.filterId===A.filterId&&P.attributeId===A.attributeId);R>0?p([...u.slice(0,R),...u.slice(R+1)]):p(R===0?[...u.slice(1)]:[...u,A])},I=u.length>0,S=A=>A.id==="onOffer"?a.formatMessage("promotions.category.root.name"):A.id==="favoritesOnly"?a.formatMessage("filter.options.label.all.favorites"):A.id==="new"?a.formatMessage("filter.label.new"):A.label,C=d.length,T=Dg(t,a),_=C>0?a.formatMessage("filter.accessibility.facet.with.applied",{filterLabel:T,numberOfAppliedFilters:C}):a.formatMessage("filter.accessibility.facet",{filterLabel:T});return s.jsxs(YSt,{children:[s.jsx(mee,{contrastBackground:o,"data-test":`filter-open-menu-${t.id.toLowerCase()}`,onOpen:()=>{i.current=!1,p(d),e?.(t.id)},onClose:()=>{i.current=!1,p(d),E()},a11y:{label:_},triggerTitle:T,renderContent:({closeDropdown:A})=>s.jsxs(KSt,{children:[s.jsx(ie,{id:"id-filter-facet-dropdown-options-group",children:a.formatMessage("filter.accessibility.facet.list")}),s.jsx(QSt,{children:t.attributes.map(R=>{const P=!!u.filter(k=>Oi(k,md(t,R))).length,N=S(R);return s.jsx(KT,{label:N,checked:P,onChange:()=>y({selectedItem:md(t,R)})},`${R.id}${t.id}`)})}),s.jsxs(zSt,{children:[s.jsx(x,{fill:!0,intent:"secondary",className:"salt-m-b--2",onClick:()=>{c(g()),p([])},disabled:!I,"aria-label":a.formatMessage("filter.accessibility.clear.selected.button"),children:s.jsx(x.Text,{children:s.jsx(b,{id:"filter.button.clear.selected"})})}),s.jsx(x,{intent:"primary",fill:!0,"aria-label":a.formatMessage("filter.accessibility.apply.button"),onClick:()=>{i.current=!0,A(),n(u,t.id)},children:s.jsx(x.Text,{children:s.jsx(b,{id:"search.filter.button.apply"})})})]})]})}),C>0&&s.jsx(gee,{intent:"secondary",count:C})]})},Eee=({filter:e,onOpen:t,filterHandler:n,contrastBackground:o,clearedFilterAttributesHandler:r})=>{const[a]=Ee(["nform"]);return a?s.jsx(XSt,{filter:e,onOpen:t,filterHandler:n,contrastBackground:o,clearedFilterAttributesHandler:r}):s.jsx(qSt,{filter:e,onOpen:t,filterHandler:n,clearedFilterAttributesHandler:r})},ZSt=v.div`
    display: flex;
    margin-block: var(--salt-spacing-4);
    flex-direction: column;
    gap: var(--salt-spacing-2);

    ${re.mdUp`
        flex-direction: row;
    `};

    & > * {
        flex: 1;
        ${({isNewFormsEnabled:e})=>!e&&`
            border: 1px solid var(--intent-secondary-900);
            border-radius: var(--salt-radius-default);
        `}
    }
`,JSt=({appliedFilters:e,setAppliedFilters:t})=>{const{formatMessage:n}=L(),o={attributes:[{id:"IMAGES_ONLY",label:n("reviews.bop.filter.reviews.with.images.button"),selected:!!e.find(c=>c.attributeId==="IMAGES_ONLY")}],id:"reviews-filter",label:n("filter.title"),type:"FILTER"},r=f(nm),a=f(ON)?.find(c=>c.enabled),i=F(),l=c=>{if(r){if(c.at(0)?.attributeId==="IMAGES_ONLY"){ta.fetchReviewsData(r,{sortOptionId:a?.reviewSortOptionId,filter:"IMAGES_ONLY"})(i).then(()=>t(d=>[...d,...c]));return}ta.fetchReviewsData(r,{sortOptionId:a?.reviewSortOptionId})(i).then(()=>t(c))}};return s.jsx(Eee,{contrastBackground:!0,filterHandler:l,filter:o})},eCt=()=>{const[e,t]=h.useState([]),[n,o]=h.useState("1"),[r,a]=h.useState([]),{formatMessage:i}=L(),l=F(),{sendAnalyticsEvent:c}=$l(),[d]=Ee(["nform"]),u=f(nm),p=f(P8),g=f(PN)||0,E=f(eT)??{overallRating:void 0},y=f(N8)||[],{openMediaReviewGallery:I,showNextReview:S,showPreviousReview:C,activeMediaReviewModal:T,fetchMediaReviews:_,activeMediaReviewIndex:A,initialActiveMediaIndex:R,totalMediaReviews:P,isReviewsMediaEnabled:N,handleReviewHelpfulness:k,mediaReviews:M,closeMediaReviewGallery:w}=$St(u),{overallRating:j}=E,G={root:null,rootMargin:"-80px 0px 0px 0px",threshold:SS},W=()=>{w()},H=()=>y.reduce((q,ne,ue)=>({...q,[`${ue+1}starRatingCount`]:ne}),{}),K=h.useCallback((q,ne)=>{const[ue]=q;ue.intersectionRatio>SS&&y&&j&&(c({type:zt.PRODUCT_OVERALL_RATINGS_DASHBOARD_IMPRESSION,overallRatingImpressions:[{OVERALL_RATING:Number(j),...H()}]}),ne.unobserve(ue.target))},[g]),X=lee(K,G);return h.useEffect(()=>{!p.isFetching&&u&&(ta.fetchReviewsData(u,{sortOptionId:"NEWEST"})(l),N&&_())},[]),!p.data&&!p?.error&&!p.isFetching&&!u?null:p.error?s.jsx(xe,{"data-test":"bop-reviews-container",children:s.jsx(Fc,{title:"reviews.fetchError.header",description:"reviews.fetchError.body",action:()=>u&&ta.fetchReviewsData(u,{sortOptionId:"NEWEST"})(l)})}):s.jsx(xe,{asChild:!0,children:s.jsxs(OIt,{"data-test":"bop-reviews-container",children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:i("reviews.bop.container.header")})}),s.jsxs(PIt,{children:[s.jsxs("div",{ref:X,children:[s.jsx(ZIt,{}),s.jsx(eSt,{}),s.jsx(Ts,{}),s.jsx(iSt,{})]}),N?s.jsx(XIt,{openGallery:I,reviews:M,totalMediaReviews:P}):null]}),s.jsxs(iee,{children:[s.jsx(O,{asChild:!0,bold:!0,size:"l","aria-hidden":"true",children:s.jsx("h3",{children:i("reviews.bop.customerReviews.header",{reviewCount:g})})}),s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:i("reviews.bop.customerReviews.header.accessibility",{reviewCount:g})})}),s.jsx(ZSt,{isNewFormsEnabled:d,children:N&&P?s.jsxs(h.Fragment,{children:[s.jsx(s0,{appliedFilters:r,setPreviousPages:t,setCurrentPage:o}),s.jsx(JSt,{appliedFilters:r,setAppliedFilters:a})]}):s.jsx(s0,{appliedFilters:r,setPreviousPages:t,setCurrentPage:o})}),s.jsx(Ts,{className:"salt-m-b--4"}),p.isFetching&&s.jsx(wSt,{}),p.data?.reviews&&!p.isFetching&&s.jsx(KIt,{openGallery:I,updateMediaReviewHelpfulness:q=>{N&&k(q)}}),s.jsx(NSt,{previousPages:e,appliedFilters:r,setPreviousPages:t,currentPage:n,setCurrentPage:o})]}),s.jsx(PSt,{}),N&&T&&s.jsx(GSt,{isOpen:!!T,closeModal:W,initialImageIndex:R,review:{...T,sequence:(A||0)+1},showNextReview:S,showPreviousReview:C,totalMediaReviews:P,updateMediaReviewHelpfulness:k})]})})},tCt=()=>{const e=f(D("rvws")),t=f(L8)||[],n=f(PN),o=f(eT);return e&&o?o.count?{aggregateRating:{"@type":"AggregateRating",ratingValue:o.overallRating,reviewCount:n,ratingCount:o.count},review:t.map(a=>({"@type":"Review",reviewRating:{"@type":"Rating",ratingValue:a.rating},author:{"@type":"Person",name:bb(a.nickname)},dateCreated:a.createdDate,reviewBody:bb(a.comments),name:bb(a.headline)}))}:{}:{}},sCt=D("sanitiser"),nCt=({productId:e})=>{const t=f(l=>Da(l,e)),n=f(uq)||"",o=f(pq),r=tCt(),a=f(sCt),i=h.useMemo(()=>{if(!t)return null;const{name:l,images:c,retailerProductId:d,size:u,available:p,price:g,countryOfOrigin:E}=t;return{"@context":"https://schema.org/","@type":"Product",sku:d,name:l,description:a?Ri(n):n,image:c.map(y=>y.src),brand:a&&o?Ri(o):o,countryOfOrigin:E,...u?{size:String(u.value)}:{},offers:{"@type":"Offer",price:g?.current.amount,priceCurrency:g?.current.currency,itemCondition:"https://schema.org/NewCondition",availability:p?"https://schema.org/InStock":"https://schema.org/OutOfStock"},...r}},[e,n]);return i?s.jsx(Gn,{children:s.jsx("script",{"data-test":"product-details-structured-data",type:"application/ld+json",children:JSON.stringify(i)})}):null},oCt=({option:e})=>{const{formatMessage:t,formatNumber:n}=L(),o=He(),r=f(Zt),{monthlyAmount:a,totalAmount:i,commissionFee:l,displayName:c,interestRates:d,offerAvailabilityEnd:u}=e,p={pricePerMonth:t("bop.instalment.price.perMonth",{price:o(a)}),total:t("bop.instalment.drawer.option.total",{price:s.jsx(O,{bold:!0,size:"l",children:o(i)})}),commission:t("bop.instalment.drawer.option.commissionFee",{price:s.jsx(O,{bold:!0,size:"s",children:o(l)})}),validDate:t("bop.instalment.drawer.option.validDate",{date:gt(u,r)})},g=()=>{const y=t("bop.instalment.drawer.option.total",{price:o(i)});return s.jsxs("div",{children:[s.jsx(ie,{children:y}),s.jsx(O,{size:"l","aria-hidden":!0,children:p.total})]})},E=({value:y,name:I,accessibilityLabel:S})=>{const C=`${I}: `,T=n(y,{style:"percent",minimumFractionDigits:2}),A=`${S}: `+T;return s.jsxs("div",{children:[s.jsx(ie,{children:A}),s.jsxs(O,{size:"s","aria-hidden":!0,children:[C,s.jsx(O,{bold:!0,size:"s",children:T})]},I)]})};return s.jsx(xe,{asChild:!0,children:s.jsxs(Q,{gap:["sm"],direction:"column",children:[s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{children:c})}),s.jsxs(Q,{direction:"column",gap:["sm"],children:[s.jsxs(Q,{direction:"column",children:[s.jsx(ee,{as:"span",children:p.pricePerMonth}),g(),s.jsxs(Q,{gap:["xs"],children:[d.map(E),s.jsx(O,{size:"s",children:p.commission})]})]}),s.jsx(Te,{intent:"info",size:"s",text:p.validDate})]})]})})},rCt=({info:e})=>{const t=es("financing-options-instalment-plans-description-url"),n=s.jsx(tt,{target:"_blank",href:t,children:e.linkDescription});return s.jsx(xe,{asChild:!0,children:s.jsxs(Q,{gap:["sm"],direction:"column",children:[s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{children:e.displayName})}),s.jsxs(O,{children:[e.description," ",n]})]})})},aCt=1.4285714286,iCt=({isOpen:e,onClose:t,instalmentsData:n})=>{const{formatMessage:o}=L(),r=es("financing-options-option-name"),a=es("financing-options-credit-card-url"),i={title:o("bop.instalment.drawer.title"),subheader:o("bop.instalment.drawer.subheader",{optionIcon:s.jsx(pe,{name:"financing_option_1",lineHeight:aCt,verticalAlign:"middle",width:90,height:16,"aria-hidden":!0})}),notification:o("bop.instalment.drawer.notification"),creditCard:o("bop.instalment.drawer.creditCard.apply",{linkDescription:s.jsxs(tt,{href:a,target:"_blank",children:[o("bop.instalment.drawer.creditCard.apply.link"),s.jsx(ie,{children:` ${o("bop.instalment.drawer.creditCard.apply.link.detail",{cardProvider:r})}`})]})})};return s.jsxs(B,{isOpen:e,onRequestClose:t,aria:{labelledby:"drawer-title"},data:{test:"instalments-drawer"},condensed:!0,context:"drawer",children:[s.jsx(B.Header,{align:"left",children:s.jsx(O,{asChild:!0,bold:!0,size:"l","aria-label":o("bop.instalment.drawer.close.button",{drawerTitle:i.title}),children:s.jsx("h1",{children:i.title})})}),s.jsx(B.Body,{children:s.jsxs(Q,{direction:"column",gap:["sm"],wrap:"nowrap",children:[s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsxs("h2",{children:[i.subheader," ",s.jsx(ie,{children:r})]})}),s.jsx(Te,{intent:"warning",text:i.notification}),n.calculatedFinancingPlans.map(l=>s.jsx(oCt,{option:l},l.retailerFinancingPlanId)),n.fixedFinancingPlans.map(l=>s.jsx(rCt,{info:l},l.retailerFinancingPlanId)),s.jsx(O,{children:i.creditCard})]})})]})},lCt=({productId:e})=>{const[t,n]=h.useState(!1),{formatMessage:o}=L(),r=He(),a=F(),i=f(g=>Da(g,e)),l=f(_Je),c=f(bJe),d=es("financing-options-option-name");if(h.useEffect(()=>{if(i){const{price:g,retailerFinancingPlanIds:E}=i;if(!c&&g?.current&&E?.length){const{current:y}=g;a(EI.fetchFinancingPlans({path:"plans",body:{retailerFinancingPlanIds:E,amount:y.amount}}))}}},[e]),c)return s.jsxs(Q,{gap:["xs"],direction:"column",children:[s.jsx(_e,{height:"14px",width:"50%"}),s.jsx(_e,{height:"14px",width:"50%"}),s.jsx(_e,{height:"30px",width:"75%"})]});if(!l)return null;const u=s.jsxs(Q,{gap:["xs"],align:"center",wrap:"nowrap",additionalCss:"inline-size: fit-content;",children:[s.jsxs(x,{intent:"secondary",size:"s",disabled:c,onClick:()=>n(!0),children:[`${o("bop.instalment.button")} `,s.jsx(ie,{children:o("bop.instalment.button.accessibility",{providerName:d})})]}),s.jsx(pe,{"aria-hidden":!0,name:"financing_option_1",width:90,height:13})]}),p=()=>{if(l.calculatedFinancingPlans.length){const g=l.calculatedFinancingPlans.sort((S,C)=>C.period-S.period)[0],E=o("bop.instalment.price.perMonth",{price:r(g.monthlyAmount)}),y=o("bop.instalment.option.perMonth",{price:E}),I=o("bop.instalment.option.perMonth",{price:s.jsx(O,{bold:!0,children:E})});return s.jsxs("div",{children:[s.jsx(ie,{children:`${y} ${g.displayName}`}),s.jsxs(O,{className:"salt-d--block","aria-hidden":"true",children:[I,"*"]}),s.jsxs(O,{className:"salt-d--block","aria-hidden":"true",children:["*",g.displayName]})]})}return null};return s.jsxs(h.Fragment,{children:[p(),u,s.jsx(iCt,{instalmentsData:l,isOpen:t,onClose:()=>n(!1)})]})},cCt=D("sanitiser"),dCt=({productId:e})=>{const t=f(c=>Da(c,e)),n=f(uq)||"",o=f(cCt);if(!t)return null;const{name:r,image:a}=t,i=a?.src,l=o?Ri(n):n;return s.jsxs(Gn,{children:[s.jsx("meta",{property:"og:title",content:r}),s.jsx("meta",{property:"og:description",content:l}),s.jsx("meta",{property:"og:image",content:i}),s.jsx("meta",{property:"twitter:title",content:r}),s.jsx("meta",{property:"twitter:description",content:l}),s.jsx("meta",{property:"twitter:image",content:i}),s.jsx("meta",{property:"twitter:card",content:"summary"})]})},uCt=()=>Pe`
    font-family: var(--alt-bop-heading-font-family, var(--font-family));
    font-weight: var(--alt-bop-heading-font-weight, 600);
`,pCt=v(ee).attrs({forwardedAs:"h1",as:"",size:"s"})`
    ${uCt}
`,mCt=e=>e==="NEW_ARRIVAL"?"bop.reference.price.new.arrivals":e==="FRESH"?"bop.reference.price.fresh":"bop.reference.price.default",fee=()=>{const e=f(pu),{formatMessage:t}=L(),n=He();if(!e||!e.reference)return null;const{currency:o,amount:r,type:a}=e.reference,i=t(mCt(a),{price:n({currency:o,amount:r})});return s.jsx(O,{size:"s",children:i})},hCt=()=>{const{formatMessage:e}=L(),t=f(dDe);if(!t)return null;const n=e("bop.product.seller",{sellerName:t.name});return s.jsx(O,{bold:!0,children:n})},gCt=v.div`
    display: flex;
    min-block-size: ${$(30)};
    align-items: center;
    gap: var(--salt-spacing-1);
`,ECt=()=>{const e=f(eDe);if(!e||!e[0])return null;const t=e[0];return s.jsxs(gCt,{children:[s.jsx("img",{src:t.src,alt:t.description,width:60,height:30}),s.jsx(O,{bold:!0,children:t.description})]})},fCt=v(el)`
    border-radius: var(--salt-radius-default);
    max-inline-size: 100%;
`,yCt=({imageUrl:e,altText:t})=>s.jsx(fCt,{src:e,alt:t,loading:"lazy"}),ICt=v(x)`
    scroll-margin-block-start: var(--_detail-image-header-height, 0);
    ${re.xs`
        margin-bottom: ${$(8)};
    `}
`,SCt=({isExpanded:e,setIsExpanded:t})=>{const{formatMessage:n}=L(),o={accessibility:{seeMore:n("bop.large.image.see.more.accessibility.text"),seeLess:n("bop.large.image.see.less.accessibility.text")},labels:{seeMore:n("bop.large.image.see.more"),seeLess:n("bop.large.image.see.less")}},r=h.useRef(null),a=()=>{cH.flushSync(()=>{t(!1)});const l=document.getElementById("main-header");l&&r.current?.style.setProperty("--_detail-image-header-height",$(l.clientHeight*1.5)),r.current?.scrollIntoView({behavior:"smooth"})},i=()=>t(!0);return s.jsx(Q,{align:"center",justify:"center",children:s.jsxs(ICt,{intent:"secondary",size:"s",fill:!1,onClick:e?a:i,ref:r,children:[s.jsx(ie,{children:e?o.accessibility.seeLess:o.accessibility.seeMore}),s.jsx(x.Text,{"aria-hidden":!0,children:e?o.labels.seeLess:o.labels.seeMore})]})})},CCt=v(xe)`
    border-block-end-style: ${({isExpanded:e,isCollapsible:t})=>e||!t?"solid":"none"};
`,vCt=v.div`
    display: flex;
    max-block-size: ${({isExpanded:e})=>e?"none":$(2e3)};
    overflow: hidden;
    flex-direction: column;
    align-items: center;
    gap: ${({imageGap:e})=>$(e)};
`,TCt=v.div`
    position: relative;
    block-size: ${$(80)};
    inline-size: 100%;
    inset-block-start: -${$(80)};
    margin-block-end: -${$(80)};
    background: linear-gradient(0deg, rgb(249 248 247 / 100%) 0%, rgb(249 248 247 / 0%) 100%);
`,_Ct=v.div`
    position: relative;
`,bCt=()=>{const[e,t]=h.useState(!1),n=f(XRe),o=os({breakpoint:"lg-up"});if(!n||n.length===0)return null;const r=o?8:16,i=n.reduce((l,c)=>l+c.height+r,0)>2e3;return s.jsxs("div",{children:[s.jsx(CCt,{isExpanded:e,isCollapsible:i,className:i&&!e?"salt-p-b--0":void 0,children:s.jsx(_Ct,{children:s.jsx(vCt,{isExpanded:e,imageGap:r,"data-test":"detailed-images-container",children:n.map((l,c)=>s.jsx(yCt,{imageUrl:l.imageUrl,altText:l.altText},`${l.imageUrl}-${c+1}`))})})}),i&&!e&&s.jsx(TCt,{"data-test":"gradient"}),i&&s.jsxs(h.Fragment,{children:[s.jsx(Ts,{className:e?"salt-m-t--2 salt-m-b--4":"salt-m-b--4"}),s.jsx(SCt,{isExpanded:e,setIsExpanded:t})]})]})},rl={[ns.PRODUCT_IMAGE_CLICKED]:"A product image was clicked by the user on the BOP.",[ns.PRODUCT_IMAGE_ZOOMED_IN]:"The product image was zoomed in by the user on the BOP.",[ns.PRODUCT_IMAGE_ZOOMED_OUT]:"The user zoomed out of the product image on the BOP.",[ns.PRODUCT_IMAGE_CLOSED]:"The product image was closed by the user on the BOP.",[ns.ACCESSIBILITY_SCREEN_NAVIGATION_CLICKED]:"The magnifying glass icon, an accessibility feature, was clicked to navigate to zoom overlay.",[ns.ACCESSIBILITY_IMAGE_ZOOMED_IN]:"An accessibility feature: + button was used to zoom in on the image.",[ns.ACCESSIBILITY_IMAGE_ZOOMED_OUT]:"An accessibility feature: - button was used to zoom out of the image.",[ns.ACCESSIBILITY_IMAGE_NAVIGATION_USED]:"An accessibility feature: the user navigated through the zoomed image using arrow keys.",[ns.BRAND_BUTTON_CLICKED]:"User clicked the 'Shop all [Brand Name]' button on the BOP."},xCt={closeModal:{type:ns.PRODUCT_IMAGE_CLOSED,description:rl.PRODUCT_IMAGE_CLOSED},imageClick:{type:ns.PRODUCT_IMAGE_CLICKED,description:rl.PRODUCT_IMAGE_CLICKED},modalIconClick:{type:ns.ACCESSIBILITY_SCREEN_NAVIGATION_CLICKED,description:rl.ACCESSIBILITY_SCREEN_NAVIGATION_CLICKED},zoomInIconClick:{type:ns.ACCESSIBILITY_IMAGE_ZOOMED_IN,description:rl.ACCESSIBILITY_IMAGE_ZOOMED_IN},zoomOutIconClick:{type:ns.ACCESSIBILITY_IMAGE_ZOOMED_OUT,description:rl.ACCESSIBILITY_IMAGE_ZOOMED_OUT},zoomOutImageClick:{type:ns.PRODUCT_IMAGE_ZOOMED_OUT,description:rl.PRODUCT_IMAGE_ZOOMED_OUT},zoomInImageClick:{type:ns.PRODUCT_IMAGE_ZOOMED_IN,description:rl.PRODUCT_IMAGE_ZOOMED_IN},arrowClick:{type:ns.ACCESSIBILITY_IMAGE_NAVIGATION_USED,description:rl.ACCESSIBILITY_IMAGE_NAVIGATION_USED}},ACt=Fi`
  from {transform: translateY(-100%); opacity: 1;}
  to {transform: translateY(0%); opacity: 1}`,RCt=Fi`
  from {transform: translateY(0%); opacity: 1}
  to {transform: translateY(-100%); opacity: 1;}`,DCt=v.div`
    background-color: var(--intent-contrast);
    inline-size: 100%;
    position: fixed;
    inset-block-start: ${({headerHeight:e=0})=>`${e}px`};
    inset-inline-start: 0;
    z-index: ${$t["sticky-add-button"]};
    animation-name: ${({shouldDisplay:e})=>e?ACt:RCt};
    animation-duration: 0.15s;
    opacity: ${({shouldDisplay:e})=>e?1:0};
`,OCt=v.div`
    display: flex;
    justify-content: center;
    align-items: center;
`,PCt=v.div`
    display: flex;
    inline-size: ${({breakpoint:e})=>e==="lg"?"960px":"720px"};
    justify-content: space-between;
    align-items: center;
    gap: var(--salt-spacing-4);
    padding-block: var(--salt-spacing-2);
    padding-inline: 0;
`,NCt=v.div`
    display: flex;
    align-items: center;
    gap: var(--salt-spacing-4);
`,LCt=v.div`
    min-inline-size: ${({breakpoint:e})=>e==="lg"?"210px":"151px"};
    max-inline-size: ${({breakpoint:e})=>e==="lg"?"210px":"151px"};
`,o0=v.div`
    display: flex;
    block-size: 20px;
`,kCt=v.div`
    display: flex;
    align-items: flex-end;
    gap: var(--salt-spacing-1);
`,jCt=v.img`
    border: var(--border-default);
`,MCt=v(Ts)`
    block-size: var(--salt-border-1);
    background-color: var(--intent-secondary-900);
`,wCt=({addToBasketInView:e,headerHeight:t})=>{const n=f(EE),o=f(pu),r=f(sDe),a=f(gE),i=dr(),l=f(D("prp")),[c,d]=h.useState(!1),u=!e&&(i==="md"||i==="lg")&&!c,[p,g]=h.useState(u),E=He();if(h.useEffect(()=>{const S=document.getElementById("footer");if(S){const C=new IntersectionObserver(([T])=>{T&&d(T.isIntersecting)});return C.observe(S),()=>{C.disconnect()}}},[]),h.useEffect(()=>{u&&g(!0)},[u]),!n||!o||!r||!r.src)return null;const y=a?.presentationMode==="MUTE_STYLE"||!o.original?void 0:"promotion",I=()=>{u||g(!1)};return p?s.jsxs(DCt,{headerHeight:t,shouldDisplay:u,"data-test":"sticky-add-button",onAnimationEnd:I,children:[s.jsx(OCt,{children:s.jsxs(PCt,{breakpoint:i,"data-test":"content-container",children:[s.jsxs(NCt,{children:[s.jsx(jCt,{src:r.src,alt:r.description,height:40,width:40}),s.jsx(O,{size:"l",bold:!0,children:n}),s.jsx(o0,{children:s.jsx(Ts,{orientation:"vertical"})}),s.jsxs(kCt,{children:[s.jsx(O,{size:"m",bold:!0,intent:y,children:E(o.current)}),o.original&&s.jsx(O,{size:"s",strikethrough:!0,children:E(o.original)})]}),l&&o.reference&&s.jsxs(h.Fragment,{children:[s.jsx(o0,{"data-test":"reference-price-divider",children:s.jsx(Ts,{orientation:"vertical"})}),s.jsx(fee,{})]})]}),s.jsx(LCt,{breakpoint:i,children:s.jsx(Ak,{location:"DESKTOP_STICKY"})})]})}),s.jsx(MCt,{})]}):null},FCt=v(Ye)`
    display: flex;
    gap: var(--salt-spacing-1);
    justify-content: space-between;
`,BCt=()=>{const e=f(mq),t=f(pq),{formatMessage:n}=L(),{analyticsEvent:o}=U,r=F();if(!t)return null;const a=()=>{r(o({type:ns.BRAND_BUTTON_CLICKED,description:rl[ns.BRAND_BUTTON_CLICKED],pageEventAttributes:{brandName:t,productId:e}})),r(o({type:ht.APPLY_FILTER_EVENT,pageType:"product-details",filters:`brand=${t}`}))},i=n("show.all.products.from.brand",{brand:t}),l=bo(void 0,{queryString:`brands=${encodeURIComponent(t)}`});return s.jsx(xe,{asChild:!0,children:s.jsxs(FCt,{href:l,onClick:a,intent:"ghost",children:[s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("h2",{children:i})}),s.jsx(pe,{name:"arrow_right"})]})})},UCt=D("seo.rdbl"),GCt=()=>{const e=gH("*"),t=nn(),n=f(Qs),o=Ne(),r=F(),{retailerProductId:a,retailerProductName:i}=t,l=e?.pathname;if(!a)throw new Error("retailerProductId is required");const c=f(me=>rq(me)),d=f(me=>lO(me)),u=f(me=>Lye(me,a)),p=f(me=>eT(me)),g=f(me=>Rt(me)),E=f(me=>ayt(me)),y=f(me=>bq(me)),[I,S]=h.useState(0),{ref:C,inView:T}=nC({rootMargin:`-${I}px 0px 0px 0px`,initialInView:!0});h.useEffect(()=>{const me=document.getElementById("main-header"),De=new ResizeObserver(([ge])=>{if(ge&&ge.contentBoxSize&&ge.contentBoxSize[0]?.blockSize){const[{blockSize:Se}]=ge.contentBoxSize;if(I===Se)return;S(Se)}});return me&&De.observe(me),()=>{De.disconnect()}},[]);const[_,A,R,P,N,k,M,w,j,G,W,H]=Ee(["apc","seo.rdbl","rvws","recom.sim","pay.i","kr.law","prp","bop.lpi","stab","bop.bft","bop.bcr","bt.top"]);h.useEffect(()=>{K()},[o]),h.useEffect(()=>{y!==4&&r(fr.getCategories({depth:4,isSEOReadableURLEnabled:A}))},[]);const K=()=>{const{isFetching:me,error:De,data:ge}=c,Se=!me&&!g&&!De||a!==ge?.product.retailerProductId;new Promise((Ce,We)=>{Se?r(FP(a)).then(et=>{q(et),ue(),Ce(!0)}).catch(et=>We(et)):(q(),ue(),Ce(!0))}).then(()=>{X()}).catch(()=>!1),De||r(ds({name:nAe}))},X=()=>{E(a)||r(PKe(a))},q=me=>{const De=me||u,ge=Vn(me,n);if(De){const Se=De.price?.current.currency||null,Ae=o.state?.productListName;r(Ige({page:"product-details",product:[De]}));const Ce={ecommType:"enhanced",event:"event",eventAction:"GA_PRODUCT_DETAILS",eventCategory:"E-commerce",eventLabel:De.retailerProductId,ecommerce:{detail:{actionField:{...Ae?{list:Ae}:{}},products:[U2({product:De,category:"E-commerce",featuredProductCampaign:ge})]},...pD(me)}};te.sendEvent({GA:Ce,WA:null}),r(Sge({payload:{product:De,position:o.state?.position,productListName:Ae}}));const We={event:"view_item",ecommerce:{currency:Se,items:[Zp({product:De,position:o.state?.position,page:"BOP",featuredProductCampaign:ge,productListName:Ae})]}};te.sendEvent({GA:We,WA:null}),r(U.analyticsEvent({type:ns.PRODUCT_ID})),r(U.analyticsEvent({type:ns.BREADCRUMBS}))}},ne=()=>{const{active:me}=c,De=a===d,ge=u&&u.productId===me;return De&&ge},ue=()=>{if(!ne()||!u)return;const{productId:me,offers:De}=u;if(De&&De.length>0){const ge=De.map((Se,Ae)=>({promotionId:Se.id,promotionText:Se.description,promotionType:Se.type,promotionSequence:Ae,promotionPresentation:Se.presentationMode,productId:me,productSequence:0}));r(U.analyticsEvent({type:ns.PROMO_LINK_IMPRESSION,promoLinkImpressions:ge}))}},oe=()=>{let me=l?.toLowerCase().replaceAll(a.toLowerCase(),":retailerProductId");return i&&(me=l?.toLowerCase().replaceAll(a.toLowerCase(),":retailerProductId").replaceAll(i.toLowerCase(),":retailerProductName")),me},ye=()=>u&&i&&Cn(u.name).toLowerCase()===i.toLowerCase(),he=me=>{if(!u)return null;const{additionalProductCharge:De,retailerFinancingPlanIds:ge}=u,{active:Se}=c;return s.jsxs(h.Fragment,{children:[Se&&s.jsx(nCt,{productId:Se}),Se&&s.jsx(dCt,{productId:Se}),H&&s.jsx(Du,{}),W&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Dyt,{},a)}),s.jsx(KG,{retailerProductId:a,placement:"ABOVE_GRID"}),s.jsx(V.Item,{"data-test":u.productId,colSpan:{xs:12,md:6},children:s.jsx(aee,{images:u.images,analyticsEvents:xCt})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsxs(Q,{gap:["sm"],gapSmUp:["md"],direction:"column",wrap:"nowrap",children:[s.jsx(xe,{asChild:!0,ref:C,children:s.jsxs(Q,{gap:["sm"],direction:"column",children:[s.jsx(pCt,{children:me}),s.jsx(hCt,{}),_&&De&&s.jsx(DIt,{additionalProductCharge:De}),R&&p&&Se&&s.jsx(tt,{href:"#reviews-title",onClick:()=>{r(U.analyticsEvent({type:zt.PRODUCT_RATINGS_CLICKED}))},children:s.jsx(nL,{productId:Se})}),s.jsx(Pyt,{}),s.jsx(Oyt,{}),s.jsx(ECt,{}),s.jsx(_It,{}),k&&s.jsx(zyt,{}),M&&s.jsx(fee,{}),s.jsx(Kyt,{}),N&&ge?.length?s.jsx(lCt,{productId:u.productId}):null,s.jsx(Kt,{breakpoint:"md-up",children:s.jsx(Ak,{})}),s.jsx(Xyt,{})]})}),s.jsx(RIt,{productId:u.productId,retailerProductId:u.retailerProductId,productName:me}),s.jsx(Byt,{product:u}),s.jsx(Cyt,{}),G&&s.jsx(BCt,{})]})})]})},Ie=()=>a!==c.data.product.retailerProductId?null:s.jsx(V.Item,{colSpan:{xs:12},className:H?"salt-m-b--2":"",children:s.jsxs(Q,{gap:["sm"],gapSmUp:["md"],direction:"column",wrap:"nowrap",children:[s.jsx(Eyt,{retailerProductId:a}),w&&s.jsx(bCt,{}),s.jsx(Gyt,{}),P&&s.jsx(fyt,{retailerProductId:a}),s.jsx(KG,{retailerProductId:a,placement:"BELOW_GRID"}),R&&p&&s.jsx(eCt,{})]})}),be=oe()===Uo(":retailerProductId",":retailerProductName"),ce=l!==Uo(a);if(c.error&&c.error.statusCode===404)return s.jsx(ot,{});if(!u)return null;if(ne()){const{name:me}=u;return A&&(!ye()||!be)?s.jsx(En,{to:Uo(u.retailerProductId,kc(me,{isSEOReadableURLEnabled:A}))}):!A&&ce?s.jsx(En,{to:Uo(u.retailerProductId)}):s.jsxs(Ji,{isActive:u.alcohol,verificationRequired:!!u.verifyMode,overlay:u.verifyMode?s.jsx(XJ,{age:u.ageRestriction}):s.jsx(yyt,{}),children:[j&&s.jsx(wCt,{addToBasketInView:T,headerHeight:I}),s.jsxs(V,{fixed:!0,"data-synthetics":"bop-view","data-test":"bop-view",className:"salt-m-y--4",children:[s.jsx(bt,{title:"bop.page.title",tagline:"products.title.tagline",values:{productName:me},seoFriendlyMeta:{metaDescriptionTagline:"products.meta.descriptionTagline",pageDescription:me}}),he(me),Ie(),s.jsx(vIt,{})]})]})}return null},bA=()=>s.jsx(Et,{type:"Bop::route",children:s.jsx(GCt,{})});bA.fetchData=async({params:e,context:t})=>{await t.store.dispatch(FP(e.retailerProductId));const n=t.store.getState(),r=`${decodeURIComponent(t.url.pathname)}${t.url.search}`;if(iq(n))return Promise.resolve();const i=At(n),l=UCt(n),{data:{product:{name:c,retailerProductId:d}}}=rq(n),u=kc(c,{isSEOReadableURLEnabled:l}),p=`${Uo(d,u,{basePath:i})}${t.url.search}`;return r.toLowerCase()!==p.toLowerCase()?Promise.resolve({redirectTo:p,statusCode:Go.MOVED_PERMANENTLY}):Promise.resolve()};const $Ct=e=>[{path:"/products/:retailerProductId/details",Component:e.Main,key:"main",children:[{index:!0,Component:bA}]},{path:"/products/:retailerProductName?/:retailerProductId",Component:e.Main,key:"main",children:[{index:!0,Component:bA}]}],Cy=e=>{const{retailerId:t,id:n,sublocationId:o,skuId:r,...a}=e;return ps.stringify(a)},hh={PRODUCT:"product",CATEGORY:"category",OFFER:"offer",PROMOTIONS:"promotions"};function yee(e,t,n,o,r,a){switch(e){case hh.CATEGORY:{const i=a?n.retailerId:n.id,l=n.encodedName?.toLowerCase();return t?Sa(i,l,{basePath:o,queryString:Cy(r)}):bo(n.encodedName,{queryString:`sublocationId=${n.id}`,basePath:o})}case hh.PROMOTIONS:{const i=a?n.retailerId:n.id;return t?Nh(i,n?.encodedName?.toLowerCase(),{basePath:o,queryString:Cy(r)}):di(n.encodedName,{queryString:`sublocationId=${n.id}`,basePath:o})}case hh.OFFER:return qa(a?n.retailerId:n.id,n?.encodedName?.toLowerCase(),{basePath:o,queryString:Cy(r)});case hh.PRODUCT:return Uo(n.retailerId,n.encodedName.toLowerCase(),{basePath:o,queryString:Cy(r)});default:return null}}const HCt=async(e,t)=>{const{id:n,retailerId:o,pageName:r}=e,a=n?`id=${n}`:`retailerId=${o}`,i=go({target:`/v1/seo/${r}?${a}`});return fetch(i,{credentials:"same-origin",headers:{"client-route-id":t}}).then(l=>l.json())},VCt=D("seo.rdbl"),WCt=D("seo.ra"),YCt=()=>{const e=f(Rt),[t,n]=Ee(["seo.rdbl","seo.ra"]),o=f(S=>S.router.location.search),r=f(Do),a=f(At),{pageName:i}=nn(),l=ps.parse(o),[c,d]=h.useState(void 0),[u,p]=h.useState(!1),[g,E]=h.useState(!1),y=async()=>{try{const{id:S,retailerId:C}=l,T=typeof S=="string"?S:"",_=typeof C=="string"?C:"";if(!i||i&&!T&&!_)throw new Error("Wrong params");const A=await HCt({id:T,retailerId:_,pageName:i},r),R=yee(i,t,A,a,l,n);d(R||""),p(!R)}catch{p(!0)}finally{E(!0)}};return h.useEffect(()=>{e?p(!0):y()},[]),c?s.jsx(En,{to:c}):e||u?s.jsx(ot,{}):!g&&!e?s.jsx(_s,{size:"l",className:"salt-m-t--16","data-test":"campaign-spinner"}):s.jsx(jn,{})},xA=()=>s.jsx(Et,{type:"Campaign::route",children:s.jsx(YCt,{})});xA.fetchData=async({context:e,params:t})=>{const{url:n,store:o,gotRequest:r,logger:a}=e,i=(t?.pageName||"").toLowerCase(),l=n.searchParams.get("id"),c=n.searchParams.get("retailerId"),d=n.searchParams.get("skuId"),u=Object.values(hh).find(I=>I===i),p=VCt(o.getState()),g=WCt(o.getState());if(!u||!l&&!c&&!d)return Promise.resolve();let E;l&&(E={id:l}),d&&(E={skuId:d}),c&&(E={retailerId:c});const y=At(o.getState())??"";try{const I=await r.get(r.buildOptions({path:`/api/v1/seo/${i}`,requestKey:"Campaign.FetchData",searchParams:E?new URLSearchParams(E):void 0})),S=yee(i,p,I,y,ps.parse(n.search),g);if(S)return Promise.resolve({redirectTo:S,statusCode:Go.MOVED_PERMANENTLY})}catch(I){return I&&typeof I=="object"&&"response"in I&&I.response&&typeof I.response=="object"&&"statusCode"in I.response&&I.response.statusCode===Go.NOT_FOUND?(a.warn("Could not find SEO data for the requested page so redirecting to the homepage"),Promise.resolve({redirectTo:fn({basePath:y}),statusCode:Go.MOVED_PERMANENTLY})):(a.error("Unexpected error on redirect content handler",I),Promise.resolve())}return Promise.resolve()};const qCt=e=>[{path:"/campaign/:pageName",Component:e.Main,key:"main",children:[{index:!0,Component:xA}]},{path:"/redirect/:pageName",Component:e.Main,key:"main",children:[{index:!0,Component:xA}]}],Og=()=>"/smart-shop",jp=(e="")=>`${e}/lists`,r0=(e,{basePath:t=""}={})=>`${jp(t)}/${e}`,Ok=()=>"/regulars",KCt=h.forwardRef((e,t)=>{const{formatMessage:n}=L(),{a11y:o,...r}=e,a=o||{labels:{"arrow-left":n("salt.tabs.left.arrow.a11y.label"),"arrow-right":n("salt.tabs.right.arrow.a11y.label")}};return s.jsx(PI,{a11y:a,...r,ref:t})}),zCt=h.forwardRef((e,t)=>{const{isSSRNavigation:n}=e;if(n){const{children:d,id:u,href:p,isSSRNavigation:g,...E}=e;return s.jsx(PI.Link,{ref:t,id:u,asChild:!0,children:p?s.jsx(tt,{href:p,...E,children:d}):s.jsx("a",{...E,children:d})})}const{children:o,id:r,to:a,href:i,isSSRNavigation:l,...c}=e;return s.jsx(PI.Link,{ref:t,id:r,asChild:!0,children:a?s.jsx(Ye,{to:a,...c,children:o}):s.jsx("a",{...c,children:o})})}),Kr={...KCt,Link:zCt,LinkText:PI.LinkText},pa={FAVORITES:"FAVORITES",SHOPPING_LISTS:"SHOPPING_LISTS",INSTANT_SHOP:"INSTANT_SHOP",REGULARS:"REGULARS"},QCt=(e,t,n)=>t?void 0:`${e.path()}?source=tabs&sourceEventId=${n}`,zT=({activeTab:e,children:t})=>{const n=L(),o=F(),r=tf(),a=AT(),[i,l]=h.useState(ct()),c=p=>{let g,E;switch(p){case pa.FAVORITES:g=ht.FAVORITES_TAB_CLICKED,E="User clicked on the favorites tab";break;case pa.INSTANT_SHOP:g=ht.SMART_CART_TAB_CLICKED,E="User clicked on the smart cart tab";break;case pa.SHOPPING_LISTS:g=ht.LISTS_TAB_CLICKED,E="User clicked on the shopping lists tab";break;case pa.REGULARS:g=ht.REGULARS_TAB_CLICKED,E="User clicked on the regulars tab";break;default:g=ht.FAVORITES_TAB_CLICKED,E="User clicked on the favorites tab";break}o(U.analyticsEvent({type:g,description:E,pageEventId:i})),l(ct())},u=[{titleKey:"shopping.lists.tab.favs",path:_m,name:pa.FAVORITES,hidden:!1},{titleKey:"instant.shop.tab",path:Og,name:pa.INSTANT_SHOP,hidden:!a},{titleKey:"regular.orders.tab",path:Ok,name:pa.REGULARS,hidden:!r},{titleKey:"shopping.lists.tab.lists",path:jp,name:pa.SHOPPING_LISTS,hidden:!1}].filter(p=>!p.hidden);return s.jsxs("div",{className:"salt-m-t--8 salt-m-b--8 lg:salt-m-b--16",children:[s.jsx(Kr,{className:"salt-m-b--2",highlightedId:e,children:u.map(p=>{const g=e===p.name;return s.jsx(Kr.Link,{id:p.name,to:QCt(p,g,i),onClick:()=>c(p.name),children:s.jsx(Kr.LinkText,{children:n.formatMessage(p.titleKey)})},p.name)})}),t]})},XCt=se("GET_FAVORITES_PAGE_ADVERTS"),QT=()=>({type:"API",payload:{url:"/v1/content?page=FAVORITES",...XCt}}),a0=D("seo.rdbl"),i0=D("di"),AA=({category:e,filters:t,sortOption:n,pageToken:o,isRetailerCategoryId:r=!1})=>async(a,i)=>{const l=i(),c={imageFormats:Hn(l)??[],isSEOReadableURLEnabled:a0(l),isDynamicImagesEnabled:i0(l)},d={category:e,filters:t,sortOption:n,pageToken:o,isRetailerCategoryId:r,transformerConfig:c},u=id.getPPWSFavoritesPage;return a(u(d)).then(async p=>{if(!p)return;let{payload:{responseData:g}}=p;g=OC(g,Hn(l)??[],a0(l),i0(l));const{entities:E,nextPageToken:y,result:{productGroups:I,missedPromotions:S,breadcrumbs:C,retailerCategoryId:T}}=g;for(const _ in E.product)E.product[_]===void 0&&delete E.product[_];return a(xt.setProducts(E)),S?.length&&a(fo.addMissedPromotions(S)),{products:Kp()(g),productGroups:I,...o&&{nextPageToken:y,productCount:qp(I).length},breadcrumbs:C,retailerCategoryId:T}})},{AdvertisingBannerContent:ZCt}=Wq,l0=v(ZCt)`
    overflow: ${({isOverflowVisible:e})=>e?"visible":"hidden"};
`,{AdvertisingBanner:JCt}=Wq,Iee=v(JCt)`
    align-self: normal;
`,evt=v(Iee)`
    ${({newProductList:e})=>e?`
        margin-bottom: 0;
        padding-left: 0;
        padding-right: 0;
        min-width: 0;
    `:""}
    > div {
        z-index: 1;
        border: none;
    }

    a {
        &:focus {
            border-radius: var(--salt-radius-default);
        }

        position: static;
        ${re.smUp`
            position: absolute;
        `}
    }
`,tvt=({advert:e,advertProps:{imageUrl:t,imageWidth:n,...o},contentProps:r,children:a,image:i})=>{const[l]=Ee(["bl.d"]),[c]=Ee(["new.prl"]),d=Q7(i);return e?.format==="DOUBLE_TILE"?s.jsx(evt,{"data-test":"standardized-advert",newProductList:c,children:s.jsx(l0,{...r,children:s.jsx(RZ,{disableBlurring:l,$imageSet:d,...o,children:a})})}):s.jsx(Iee,{children:s.jsx(l0,{...r,children:s.jsx(TT,{...o,children:a})})})},c0=(e,t)=>{switch(e){case"DOUBLE_TILE":return{sequence:t,size:2};default:return{}}},svt=({advert:e,index:t,page:n})=>{const{reportStaticAdvertImpression:o,reportStaticAdvertClick:r}=nf(n,e?.placement||"WITHIN_GRID"),[a,i]=h.useState(!1),l=e?.images?.[0],d=UT(()=>{e&&l?.url&&o({id:e.id,name:e.name,altText:l.altText,contentSource:e.contentSource,targetUrl:u,linkType:e.target.linkType,segments:e.segments,format:e.format,imageUrl:l.url,...c0(e.format,t)})}),u=ek(e?.target);if(!e||!l?.url)return null;const p=()=>i(!a),g=()=>p(),E=()=>p(),y=()=>{r({id:e.id,name:e.name,altText:l.altText,contentSource:e.contentSource,targetUrl:u,linkType:e.target.linkType,segments:e.segments,format:e.format,imageUrl:l.url,...c0(e.format,t)})},I={linkType:e?.target?.linkType,"data-test":"advertising-banner",href:u,target:e.target?.openInNewTab?"_blank":void 0,isExternalLink:e.isExternalLink,title:l.altText,imageUrl:l.url,imageWidth:l.width,onClick:y,onBlur:E,onFocus:g},S={isOverflowVisible:a};return s.jsx(tvt,{advertProps:I,contentProps:S,advert:e,image:l,children:s.jsx(vT,{image:l,contentSource:e.contentSource,pixelDensity:!0,children:s.jsx("img",{ref:d,src:l.url,alt:l?.altText??"",loading:"lazy"})})})},nvt=e=>{switch(e){case"search":return Npt;case"categories":return _pt;case"logged-in-homepage":case"logged-out-homepage":return emt;case"promotions":return Vpt;case"favorites":return Fpt;default:return()=>null}},Pk=({index:e=0,page:t})=>{const n=f(nvt(t));return n?s.jsx(svt,{page:t,advert:n,index:e}):null},ovt=e=>{switch(e){case"search":return Ppt("aboveGrid");case"categories":return Tpt("aboveGrid");case"promotions":return qpt("aboveGrid");case"favorites":return Gpt("aboveGrid");default:return()=>[[],{randomizeInitialHorizontalAdvert:!1},!1]}},DS=({page:e,pageKey:t,sizes:n,isNoProductsPage:o})=>{const[r,a,i]=f(ovt(e)),l=z7(r);return o||!r.length||i?null:s.jsx(Lm,{className:"salt-p-x--2 lg:salt-p-x--0 salt-p-y--2",adverts:l,advertDimensionsMap:ST,page:e,pageKey:t,placement:"ABOVE_GRID",randomInitialIndex:a.randomizeInitialHorizontalAdvert,sizes:n})},rvt=({productId:e,retailerProductId:t,regular:n,productIndex:o,subPage:r,section:a,name:i,page:l})=>s.jsx(j7,{productId:e,retailerProductId:t,productName:i,initialFrequency:n?.frequency,initialQuantity:n?.quantity,section:a,page:l,subPage:r,productIndex:o}),avt=({page:e,onInitialFopLoad:t,rankingScoreByProductId:n})=>{const o=f(a8e),r=f(a8);return o?s.jsxs(h.Fragment,{children:[s.jsx(uo,{type:"regular","data-test":"regulars-fop-container",productGroups:[o.group],productsByProductId:o.products,page:e,isFetching:r,onInitialFopLoad:t,rankingScoreByProductId:n,withoutShoppingListsModal:!0,fopControlsFactory:({productId:a,retailerProductId:i,regular:l,productIndex:c,subPage:d,section:u,name:p})=>rvt({productId:a,retailerProductId:i,regular:l,productIndex:c,subPage:d,section:u,name:p,page:e})}),s.jsx(Ts,{className:"salt-m-y--4 md:salt-m-y--8"})]}):null};function ivt(e){const t=document.querySelector(e);t&&(t.setAttribute("tabindex","-1"),t.focus({preventScroll:!0})),window.scrollTo({top:0,behavior:"smooth"})}const See=e=>{const{className:t,focusElement:n}=e;return s.jsx("div",{className:`scroll-to-top ${t||""}`,children:s.jsxs(x,{intent:"secondary",fill:!1,onClick:()=>ivt(n),children:[s.jsx(x.Icon,{name:"arrow_up"}),s.jsx(x.Text,{children:s.jsx(b,{id:"button.scroll.to.top"})})]})})};function d0(e){return e.type==="PRODUCT"}const lvt=()=>[],cvt={categories:Apt,search:jpt},dvt=e=>({type:"SHOPPABLE_BANNER",contentSource:e.contentSource,rowIndex:e.position??0,backgroundColor:e.backgroundColor??"#00000",images:e.images??[],productIds:e.productIds??[],placement:e.placement,id:e.id,name:e.name,segments:e.segments,format:e.format}),uvt=(e=[],t=0,n=[])=>{const o=e.slice();return n.forEach(r=>{const{position:a=1}=r,i=o.find(({type:c})=>c==="DOUBLE_TILE_ADVERT");let l=(a-1)*t;i?.rowIndex===a&&(i.rowIndex+=1),i?.indexOnSmallScreen===a-1&&(i.indexOnSmallScreen+=1),i&&l!==0&&t>1&&(l-=1),o.splice(l,0,dvt({...r,position:a}))}),o},pvt={xs:"S",sm:"M",md:"L",lg:"XL"},OS=(e,t)=>({type:"PRODUCT",group:t,id:e}),mvt=(e,t)=>({type:"FAVOURITE_TILE",group:t,id:e}),hvt=(e,t,n)=>{if(t.featuredProductsPerViewportMap)(n?t.featuredProductsPerViewportMap[pvt[n]]:t.featuredProductsPerViewportMap.XL).forEach(r=>e.push(OS(r,t)));else if(t.viewportConfig){let o=t.products.length;n&&(o=t.viewportConfig[n]),t.products.slice(0,o).forEach(r=>{e.push(OS(r,t))})}},gvt=(e,t)=>{const{currentBreakpoint:n}=h.useContext(kn),o=es("default-max-num-products-displayed-in-favorites-cluster"),r=Ne(),[a,i]=Ee(["sa.fav","fbf"]),{favoritesOnly:l=void 0}=Qe.parse(r.search),d=t&&!l&&a&&i&&t;return h.useMemo(()=>e?e.reduce((u,p)=>(Ut.FEATURED===p.type||Ut.FEATURED_CROSS_SELL===p.type?hvt(u,p,n):d&&p.type==="favorite"&&p.products.length===Number(o)?(p.products.forEach(E=>{u.push(OS(E,p))}),u.push(mvt("favorite-tiles",p))):p.products.forEach(E=>{u.push(OS(E,p))}),u),[]):[],[e,n])},Evt=(e,t=!1)=>{const[n,o]=h.useState(0);return h.useEffect(()=>{if(!t)return()=>{};const r=Dd(()=>{e&&e.current&&o(window.getComputedStyle(e.current).getPropertyValue("grid-template-columns").split(" ").length)},100);return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[t,e?.current]),n},fvt=(e,t,n,o,r,a,i)=>{const l=gvt(e,i),[c,d]=Ee(["sb.test","sb.vs.ca"]),u=o&&r||n?.length!==0,p=Evt(a,u),g=h.useMemo(()=>{if(l.length===0||!t||t.length===0||c&&d&&n?.length!==0)return l;const E=new Map;t?.forEach((C,T)=>{C.position&&E.set(C.position,T)});const y=[];let I=0;l.forEach(C=>{let T=E.get(I+1);for(;T||T===0;)y.push(t[T]),I+=1,T=E.get(I+1);y.push(C),I+=1});const S=t.filter(C=>C.position&&C.position>I);return S.length>0?y.concat(S):y},[l,t]);return h.useMemo(()=>{let E=g;return o&&(E=nmt(E,p,r)),n?.length!==0&&p!==0&&(!c||c&&d||c&&!d&&t?.length===0)&&(E=uvt(E,p,n)),E},[g,o,p,n])},yvt=D("bt.top"),Ivt=e=>({renderNode:{[bn.BLOCKS.HEADING_1]:(t,n)=>s.jsx(O,{size:"l",bold:!0,className:"salt-m-b--2",children:n}),[bn.BLOCKS.PARAGRAPH]:(t,n)=>Array.isArray(n)&&n.length===1&&n[0]===""?s.jsx("br",{}):s.jsx(O,{size:"m",className:"salt-m-b--4",children:n}),[bn.BLOCKS.UL_LIST]:(t,n)=>s.jsx("ul",{className:"salt-m-b--4 salt-m-t--0",children:s.jsx(O,{size:"m",children:n})}),[bn.BLOCKS.OL_LIST]:(t,n)=>s.jsx("ol",{className:"salt-m-b--4 salt-m-t--0",children:s.jsx(O,{size:"m",children:n})}),[bn.BLOCKS.LIST_ITEM]:(t,n)=>s.jsx("li",{children:s.jsx(O,{size:"m",children:n})}),[bn.INLINES.HYPERLINK]:(t,n)=>s.jsx(tt,{onClick:()=>e(n,t.data.uri),target:"_blank",size:"m",bold:!0,href:t.data.uri,children:n})}}),Cee=()=>{const e=f(fMe),t=(c,d)=>{r({type:ip.SEO_TEXT_BLOCK_ITEM_CLICKED,SEOItemString:c,url:d})},n=os({breakpoint:"sm-up"}),o=h.useMemo(()=>Ivt(t),[e]),r=ft(),a=rC.documentToReactComponents(e,o),i=f(yvt);h.useEffect(()=>{r({type:ip.SEO_CATEGORY_DESCRIPTION_LOADED})},[]);const{ref:l}=nC({triggerOnce:!0,onChange(c){c&&r({type:ip.SEO_CATEGORY_DESCRIPTION_IMPRESSION})}});return e?s.jsx(xe,{ref:l,className:`salt-m-t--8 ${i?"salt-m-b--2":"salt-m-b--8"}`,condensed:n,"data-test":"seo-content-field",children:s.jsx(Q,{direction:"column",children:a})}):null},Svt=e=>{const t=F(),[n,o]=h.useState(!0),r=async()=>{o(!0),await t(iv(e)),o(!1)};h.useEffect(()=>{e.length>0?r():o(!1)},[e]);const a=Zhe(e);return{productData:f(a),isLoading:n}},u0={landscape:{promotion:{numberOfLines:1,expand:!0,compress:!1},title:{numberOfLines:1},image:{resolution:{height:88,width:88}},packSize:{fontSize:"m",position:Op.OWN_LINE},bottomAttributes:{maxLifestyleIcons:3,ratingBadgeOrBoughtDate:!0},price:{direction:"row"}}},p0=Pe`
    inline-size: ${$(wN)};
`,Cvt=v.div`
    padding-block-start: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
    inline-size: 100%;
    flex: 1;

    [data-retailer-anchor='fop-skeleton'],
    [data-retailer-anchor='fop'] {
        /* stylelint-disable-next-line plugin/use-logical-properties-and-values, liberty/use-logical-spec */
        height: inherit;
    }
`,vvt=({products:e,group:t,page:n,isLoading:o})=>{const{formatMessage:r}=L(),[a,i]=h.useState(!1),l=h.useRef(null);h.useEffect(()=>{if(!l.current)return()=>{};const d=l.current.querySelector('[class*="_horizontal-scroll__content"]'),u=()=>{d&&i(d.scrollWidth>d.clientWidth)};u();const p=new ResizeObserver(Dd(u,250));return p.observe(l.current),()=>{p.disconnect()}},[o]);const c=()=>Array.from({length:e.length}).map((d,u)=>s.jsx(ea,{loading:!0,page:n,type:"products",noOfferLink:!1,displayLandscapeLayout:!0,withoutHeader:!0,fopPositionOnPage:u,overrideConfig:u0,customStyling:p0},`sk-${u}`));return s.jsx(Cvt,{"data-test":"shoppable-banner-carousel",children:s.jsx(to,{ref:l,a11y:{labels:{"next-button":r("scroller.accessibility.viewNext"),"previous-button":r("scroller.accessibility.viewPrevious")}},contrastBackground:!0,navigationButtonPosition:a?"header":"side",title:s.jsx("div",{children:" "}),children:o?c():e.map(({productId:d},u)=>s.jsx("div",{id:`carousel-fop-${u}`,children:s.jsx(ea,{productId:d,group:t,position:u,page:n,subPage:null,noOfferLink:!1,type:"products",withoutHeader:!0,customStyling:p0,displayLandscapeLayout:!0,fopPositionOnPage:u,sendFopImpression:!0,loading:!1,overrideConfig:u0})},d))})})},Tvt=v.div`
    img {
        inline-size: 100%;
    }

    ${re.smUp`
        flex-basis: 400px;
        block-size:100%;
        img {
            block-size:100%;
        }
    `}
`,_vt=({images:e,contentSource:t})=>{const[n]=CT();let o;return n&&(o=xg(e,hat[n])),s.jsx(Tvt,{children:o&&s.jsx(vT,{image:o,contentSource:t,children:s.jsx("img",{src:o.url,alt:o.altText,loading:"lazy"})})})},bvt=v.div`
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    grid-row: auto;
    grid-column: auto;
    background-color: ${({backgroundColor:e})=>e};
    margin-block-start: var(--salt-spacing-4);
    margin-inline: calc(var(--salt-spacing-2) * -1);
    ${re.smUp`
        max-height: 220px;
        grid-column: 1 / -1;
        border-radius: var(--salt-radius-default);
        margin-inline: 0;
        flex-direction: row;
        justify-content: space-between;
    `}
`,xvt=({advert:e,page:t})=>{const{rowIndex:n,backgroundColor:o,images:r,productIds:a}=e,{productData:i,isLoading:l}=Svt(a),[c]=Oce("shoppable_banner_product_limit");let d=i;c.enabled&&(typeof c.variables.productLimit=="number"?d=i.slice(0,c.variables.productLimit):Ue.api.pushError(new Error(`Optimizely: Feature flag 'shoppable_banner_product_limit' is enabled but 
                    'productLimit' is missing or invalid. Value: ${JSON.stringify(c.variables)}`)));const{reportStaticAdvertImpression:u}=nf(t,e.placement),g=UT(()=>{e&&u({id:e.id,name:e.name,altText:r[0]?.altText||"",contentSource:e.contentSource,segments:e.segments,format:e.format,sequence:n,imageUrl:r[0]?.url||""})}),E={type:Ut.SHOPPABLE_BANNER,section:Ut.SHOPPABLE_BANNER,groupTitle:Ut.SHOPPABLE_BANNER,products:a,name:"",clusterBreadcrumbs:[]};return d.forEach(y=>{y.featuredProductCampaign={...y.featuredProductCampaign,campaignId:e.id,campaignName:e.name}}),s.jsxs(bvt,{backgroundColor:o,ref:g,children:[s.jsx(_vt,{images:r,contentSource:e.contentSource}),s.jsx(vvt,{products:d,group:E,page:t,isLoading:l})]})},Avt=(e,t)=>{const n=e.item,o=t.item,r=e.isProductDecorated===t.isProductDecorated&&e.isBeingDecorated===t.isBeingDecorated;return Oi(n,o)&&r},Rvt=h.memo(({displayLandscapeLayout:e,index:t,isProductDecorated:n,item:o,noOfferLink:r=!1,page:a,pageEventId:i,isBeingDecorated:l,type:c,withoutHeader:d})=>{const u=f(au),g=f(D2)?.boolean?.includes("favoritesOnly")??!1,E=f(lD),[y,I]=h.useState(!0),S=h.useRef(null),[C,T]=h.useState(null),[_,A]=h.useState(!0),R=k=>{k&&T(k)};h.useEffect(()=>{if(C)return S.current=Pce(C,k=>{I(k)},{rootMargin:"25% 0px 25% 0px"}),()=>{S.current&&S.current()}},[C]),h.useEffect(()=>{if(!C||!(C instanceof Element))return;const k=new MutationObserver(M=>{M.forEach(w=>{if(w.type==="attributes"){const j=w.target;getComputedStyle(j).display==="none"&&(k.disconnect(),S.current&&S.current(),A(!1))}})});return k.observe(C,{attributes:!0}),()=>{k.disconnect(),S.current&&S.current()}},[C]);const P=()=>{if(a==="categories"){const k=u&&u.length>0?[...u].pop().name:"";return k?Pi(k.trim()):null}return null},N=h.useMemo(()=>a==="regulars"?uZ:{},[a]);if(!_)return null;switch(o.type){case"STATIC_ADVERT":return s.jsx(OZ,{advert:o,page:a,sequence:t},`${o.id}${o.position}`);case"FAVOURITE_TILE":return g?null:s.jsx(PZ,{favouritesAmount:o.group.products.length,isNewProductList:!0},o.id);case"RECIPE_ADVERT":{const k={isNewProductList:!0,sequence:t,productListName:ks(a,P())||"",...a==="search"&&{advertPage:fc.SEARCH,searchPagePath:E},...a==="categories"&&{advertPage:fc.CATEGORY,categoryPagePath:E}};return o.format===mS.RECIPE_CARD?s.jsx(cJ,{...o.fields,...k},`${o.fields.recipeId}${o.position}`):s.jsx(dJ,{...o.fields,...k},`${o.fields.collectionId}${o.position}`)}case"DOUBLE_TILE_ADVERT":{const k=o.aligned==="RIGHT"?"aligned-right":"";return s.jsx(G9,{"data-test":"product-list-ad-container",className:k,rowIndex:o.rowIndex,indexOnSmallScreen:o.indexOnSmallScreen,children:s.jsx(Pk,{page:a,index:t})})}case"SHOPPABLE_BANNER":return s.jsx(xvt,{advert:o,page:a});case"EMPTY_TILE":return s.jsx("span",{"data-test":"empty-tile"});case"PRODUCT":{if(!n&&!l)return null;const{group:k,id:M}=o,j=!(k.type==="featured")&&(l||!y);return s.jsx(ea,{productId:M,loading:j,group:k,position:t+1,page:a,type:c,subPage:P(),noOfferLink:r,displayLandscapeLayout:e,withoutHeader:d,overrideConfig:N,fopPositionOnPage:t,sendFopImpression:!0,pageEventId:i,inViewRef:t===0?void 0:R})}default:return null}},Avt),m0=24,Dvt=({productGroups:e,productsByProductId:t,page:n,noOfferLink:o=!1,type:r,isFetching:a,displayLandscapeLayout:i,withoutHeader:l,productCardAdvertsToInsert:c,loadMoreProducts:d,hasMoreProducts:u,pageEventId:p,onInitialProductsRendered:g})=>{const[E,y]=h.useState([]),[I,S]=h.useState([]),[C,T]=h.useState([]),_=F(),[A,R]=h.useState(!1),P=n==="search",N=f(cvt[n]??lvt),k=LZ[n],[M,w]=f((k??kZ)()),{productList:j}=VE(),G=h.useRef(null),W=fvt(e,c,N,M,w,G,P),H=h.useCallback(be=>!!t[be],[t]),K=h.useMemo(()=>{let be=-1;for(let ce=0;ce<W.length;ce+=1){const me=W[ce];if(me?.type==="PRODUCT")if(H(me.id))be=ce;else return be}return be},[W,H]),X=h.useMemo(()=>{if(K===-1||W.length===0||a)return!1;const be=W.filter(De=>De.type==="PRODUCT"),ce=W[K],me=be[be.length-1];return ce?.type==="PRODUCT"&&me&&(ce.id===me.id||C.includes(me.id))},[K,C,a]),q=h.useCallback(be=>_(av({productIds:be})).then(ce=>{const me=ce.payload.product;Object.entries(me).length===0?(T(be),Ue.api.pushError(new Error(`Failed product decoration, discarding following products: ${be.toString()}`))):T([]),S([]),y([])}).catch(ce=>{Ue.api.pushError(new Error(`Failed product decoration for productIds ${be.toString()}`,{cause:ce})),S([...be])}).finally(()=>{R(!1)}),[C]),ne=h.useCallback(Dd(be=>{q(be)},1e3),[]),ue=h.useCallback(()=>{if(I.length>0){R(!0),ne(I);return}if(E.length>0)return;if(X){u&&d&&(R(!0),d().finally(()=>{R(!1)}));return}R(!0);const be=K+1,ce=be+m0;let me=W.slice(be,ce).filter(d0).map(De=>De.id);me.every(De=>C.includes(De))&&(me=W.slice(be+C.length,ce).filter(d0).map(De=>De.id)),y(me),q(me)},[K,W,E,I,C]),{ref:oe}=nC({rootMargin:"0% 0% 100% 0%",onChange(be){be&&ue()}}),ye=h.useMemo(()=>{if(!u&&X)return W;let be=K+1;return E.length>0&&(be+=m0),W.slice(0,be)},[W,E,K]);h.useEffect(()=>{if(a){R(!0);return}ye.filter(ce=>ce.type==="PRODUCT"&&H(ce.id)).length>0&&g?.(),R(!1)},[a]);const he=()=>Array.from({length:25}).map((be,ce)=>s.jsx(ea,{loading:!0,page:n,type:r,noOfferLink:o,displayLandscapeLayout:i,withoutHeader:l,fopPositionOnPage:ce},`sk-${ce}`)),Ie=(be,ce)=>({index:ce,isProductDecorated:be.type==="PRODUCT"&&H(be.id),item:be,noOfferLink:o,page:n,pageEventId:p,isBeingDecorated:be.type==="PRODUCT"&&E.includes(be.id),type:r,withoutHeader:l}),Fe=(be,ce)=>{if(be.type==="PRODUCT"){const{id:me,group:De}=be;return`${me}${De.type}${De.name}${ce}`}return be.type==="DOUBLE_TILE_ADVERT"?`DOUBLE_TILE_ADVERT${be.indexOnSmallScreen}`:be.type==="EMPTY_TILE"?`EMPTY_TILE${ce}`:be.type==="STATIC_ADVERT"?`${be.id}`:be.type==="RECIPE_ADVERT"?`${be.fields.title}`:be.type==="SHOPPABLE_BANNER"?`SHOPPABLE_BANNER${be.rowIndex}`:""};return ye.length===0?null:s.jsxs(h.Fragment,{children:[s.jsxs(U9,{ref:G,gap:j?j.landscape.gap:"md",mobileGap:j?j.portrait.gap:"md","data-retailer-anchor":"product-list",children:[a?he():s.jsxs(h.Fragment,{children:[!M&&s.jsx(G9,{"data-test":"product-list-ad-container",children:s.jsx(Pk,{page:n})}),ye.map((be,ce)=>h.createElement(Rvt,{...Ie(be,ce),key:Fe(be,ce)}))]}),s.jsx(wT,{})]}),s.jsx("div",{ref:A?null:oe}),n==="categories"?s.jsx(Cee,{}):null]})},vee=e=>t=>t(MQe.fetchSearchPageRecipeAdverts(e)).catch(()=>{}),Ovt=se("GET_SEARCH_PAGE_ADVERTS"),Tee=e=>{const t=typeof e=="string"?e.trim():"";return{type:"API",payload:{url:`/v1/content?${Qe.stringify({page:"SEARCH",key:t})}`,...Ovt}}},{GET_CATALOGUE:Pvt,GET_SEARCH_CATALOGUE:Nvt,GET_NEXT_CATALOGUE_PAGE:Lvt,GET_NEXT_SEARCH_CATALOGUE_PAGE:kvt,GET_CROSS_SELL_PRODUCTS:_ee}=yt.types,jvt=50,Mvt=({category:e,filters:t,sortOption:n,pageToken:o,additional:r,isRetailerCategoryId:a,isCrossSellUpdate:i})=>l=>l({type:"API",payload:{url:`/v6/products/search?${oE({category:e,filters:t,sortOption:n,pageToken:o,isRetailerCategoryId:a,additional:r})}`,...o?Lvt:Pvt,...i?_ee:{}}}),wvt=({category:e,filters:t,sortOption:n,additional:o,pageToken:r,isRetailerCategoryId:a,transformerConfig:i,isCrossSellUpdate:l=!1})=>(c,d)=>{const u=d(),p=AR(u),{term:g=""}=o,E=Qe.stringify({...a?{retailerCategoryId:e}:{categoryId:e},...t&&{filters:Qe.stringify(t,{arrayFormat:"separator",arrayFormatSeparator:","})},q:g==="string"?g.substring(0,jvt):g,sortOptionId:n,pageToken:r,tag:"web",includeAdditionalPageInfo:!r,maxProductsToDecorate:gC(u),maxPageSize:Yv},{skipEmptyString:!0});return c({type:"API",transformerConfig:i,payload:{url:`/v6/product-pages/search?${E}`,service:"web_product_page_ws",pathPrefix:{client:"/api/webproductpagews",server:"/core-api"},options:{...p?{ContentExperienceUserId:p}:{},maxRetries:1},...r?kvt:Nvt,...l?_ee:{}}})},h0={getSearchPage:Mvt,getPPWSSearchPage:wvt},RA=D("s.ppws"),DA=D("seo.rdbl"),OA=D("di"),Fvt=({dispatch:e,data:t,state:n,props:o,crossSellProductsAction:r})=>{const{entities:a,result:{productGroups:i}}=t,l=i?.find(d=>d.type==="featured_cross_sell")?.products;l&&l.find(d=>!a.product[d])&&e(r(o)).then(d=>{let{payload:{responseData:u}}=d;RA(n)&&(u=OC(u,Hn(n)??[],DA(n),OA(n)));for(const p in a.product)a.product[p]===void 0&&delete a.product[p];e(xt.setProducts(u.entities))})},Nk=({category:e,filters:t={},sortOption:n,pageToken:o,additional:r,isRetailerCategoryId:a})=>(i,l)=>{const c=l(),u={transformerConfig:{imageFormats:Hn(c)??[],isSEOReadableURLEnabled:DA(c),isDynamicImagesEnabled:OA(c)},category:e,filters:t,sortOption:n,pageToken:o,additional:r,isRetailerCategoryId:a},p=RA(c)?h0.getPPWSSearchPage:h0.getSearchPage;return i(p(u)).then(g=>{if(!g)return;let{payload:{responseData:E}}=g;RA(c)&&(E=OC(E,Hn(c)??[],DA(c),OA(c)));const{entities:y,result:{productGroups:I,missedPromotions:S,nextPageToken:C,breadcrumbs:T,retailerCategoryId:_}}=E;for(const A in y.product)y.product[A]===void 0&&delete y.product[A];return i(xt.setProducts(y)),o||Fvt({dispatch:i,data:E,state:c,props:u,crossSellProductsAction:p}),S?.length&&i(fo.addMissedPromotions(S)),{products:Kp()(E),productGroups:I,...o&&{nextPageToken:C,productCount:qp(I).length},breadcrumbs:T,retailerCategoryId:_}})},XT=()=>{const e=F(),[t]=Ee(["rec"]),n=Ne();return{fetchSearchResultsPage:({term:r,category:a,sortOption:i,filters:l})=>{const c=new URLSearchParams(n.search),d=r||c.get("q")||void 0;return e(Tee(d)).catch(u=>{Ue.api.pushError(u)}),t&&d&&e(vee(d)).catch(u=>{Ue.api.pushError(u)}),e(Nk({category:a,filters:l,sortOption:i,additional:{term:d},isRetailerCategoryId:!1}))}}},Bvt=v(x.Text)`
    white-space: nowrap;
    text-transform: capitalize;
`,bee=({term:e,href:t,a11yLabel:n,handleSuggestionClick:o,source:r})=>{const a=F(),{fetchSearchResultsPage:i}=XT(),l=()=>{o(),i({term:e}).then(()=>{a(yt.setLastFetchedCatalogueLocation(void 0))})};return s.jsx(x,{asChild:!0,intent:"tertiary-contrast",size:"s",children:s.jsxs(Ye,{intent:"ghost",to:t,state:{source:r,isPrefetched:!0},onClick:l,children:[s.jsx(ie,{children:n}),s.jsx(Bvt,{"aria-hidden":"true",children:e})]})})},Uvt=Fi`
  from {opacity: 0;}
  to {opacity: 1;}`,Gvt=v.div`
    --scrollbar-width: ${({scrollbarWidth:e})=>$(e)};
    --background-color: ${({isSticky:e})=>e?"var(--intent-primary-50)":"var(--background-color)"};

    z-index: 4;
    background-color: var(--background-color);
    inset-block-start: ${({headerSize:e})=>e}px;
    transition: background-color 0.1s linear;
    animation-name: ${({shouldDisplay:e})=>e&&Uvt};
    animation-duration: 0.4s;
    position: sticky;
    overflow: visible;
    inline-size: calc(100vi - var(--scrollbar-width));
    margin-inline-start: calc(50% - (50vi - var(--scrollbar-width) / 2));
`,$vt=v(to)`
    --salt-horizontal-scroll-content-padding: 0;
    --salt-horizontal-scroll-background-color: var(--background-color);
`,Hvt=v.div`
    margin-block: 0;
    margin-inline: auto;
    max-inline-size: ${$(1920)};
`,Vvt=()=>{const e=ft(),t=F(),n=Ne(),{formatMessage:o}=L(),r=f(G=>Nn(G)),a=f(pN),i=f(Qp),l=f(Ms),c=f(iD),[d]=Ee(["seo.rdbl"]),[u,p]=h.useState(!1),[g,E]=h.useState(0),[y,I]=h.useState(0),[S,C]=h.useState(!1),T=h.useRef(0),_=h.useRef(null),A=h.useRef([]);if(h.useEffect(()=>()=>{if(A.current.length>0){const G=a?oA(a):void 0;t(U.analyticsEvent({type:Cs.SEARCH_SUGGESTION_IMPRESSION,searchSuggestionImpressions:A.current,searchSuggestionType:G,pageViewId:r}))}},[]),h.useEffect(()=>{const G=document.getElementById("product-page"),W=Vr(()=>{if(!G)return;const H=G.getBoundingClientRect().top;H&&H<0&&(p(!0),E(T.current),window.removeEventListener("scroll",W))},50);return window.addEventListener("scroll",W),()=>{window.removeEventListener("scroll",W)}},[c]),h.useEffect(()=>{const G=document.getElementById("main-header"),W=new ResizeObserver(([H])=>{const[{blockSize:K}]=H.borderBoxSize;T.current!==K&&(T.current=K,u&&E(K))});if(G){const{innerWidth:H}=window,{clientWidth:K}=document.documentElement,X=H-K;y!==X&&I(X),W.observe(G)}return()=>{W.disconnect()}},[u]),h.useEffect(()=>{const G=_.current?.offsetHeight??0,H=`-${g+G+1}px 0px 0px 0px`,K=new IntersectionObserver(([X])=>{if(X){if(!X.isIntersecting){C(!0);return}C(!1)}},{rootMargin:H,threshold:0});return _.current&&a&&K.observe(_.current),()=>K.disconnect()},[g,a,c]),!a)return null;const[R,P]=oA(a),k=u&&(()=>{const G=new URLSearchParams(n.search),W=decodeURIComponent(a.searchTermFromQueryParam).toLowerCase(),{correctedSearchTerm:H}=i;return H?H.toLowerCase()===W:W===G.get("q")?.toLowerCase()})()&&!!P.length&&!!c,M=R==="REFINED_SEARCH_SUGGESTION"?"refined":"followOn",w={header:o(`smart.search.ribbon.${M}.header`),buttonLabel:G=>o(`smart.search.ribbon.${M}.accessibility.button.label`,{searchTerm:G})},j=(G,W)=>{e({type:Cs.SEARCH_SUGGESTION_CLICKED,id:ct(),userInput:a?.searchTermFromQueryParam,searchSuggestion:G,positionInSuggestionList:W,locale:l,suggestionsCount:P.length,suggestionType:R,location:"RIBBON",pageViewId:r}),e({type:Cs.SELECT_SEARCH_SUGGESTION,searchSuggestion:G,suggestionIndex:W,suggestionType:R,location:"RIBBON"});const H={event:"select_search_suggestion",index:W,location:"RIBBON",search_suggestion:G,type:R};te.sendEvent({GA:H,WA:null})};return k?s.jsx(Gvt,{headerSize:g,ref:_,isSticky:S,scrollbarWidth:y,shouldDisplay:u,className:"salt-p-y--2",children:s.jsx(Hvt,{children:s.jsx($vt,{className:"salt-m-x--2",navigationButtonPosition:"side",title:s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:w.header})}),a11y:{labels:{"next-button":o("scroller.accessibility.viewNextIn",{title:w.header}),"previous-button":o("scroller.accessibility.viewPreviousIn",{title:w.header})}},flush:!0,children:P.map((G,W)=>s.jsx(EH,{triggerOnce:!0,threshold:.79,onChange:H=>{H&&A.current.push({sequence:W,searchSuggestionType:R,location:"RIBBON",searchTerm:P[W]})},children:s.jsx(bee,{href:Za(d,{queryString:`q=${encodeURIComponent(G)}`}),handleSuggestionClick:()=>j(G,W),term:G,a11yLabel:w.buttonLabel(G),source:R})},G))},R)})}):null},Wvt=({flushTop:e})=>e?0:`calc(${$(20)} + var(--salt-spacing-2))`,Yvt=({marginBottom:e})=>e?"var(--salt-spacing-2)":0,qvt=v.div`
    margin-block: ${Wvt} ${Yvt};
    margin-inline: var(--salt-spacing-2) 0;
`,xee=({children:e,flushTop:t=!1,marginBottom:n=!0})=>s.jsx(qvt,{"data-test":"navigable-content-header",flushTop:t,marginBottom:n,children:s.jsx(O,{bold:!0,asChild:!0,size:"l",children:s.jsx("h2",{children:e})})});xee.displayName="NavigableContentHeader";const Kvt=v(Ye)`
    inline-size: 100%;
`,PA=({link:e,onClick:t,dataTestId:n,condensed:o=!1,isSelected:r=!1,onListItemBlur:a,onListItemSubmit:i,...l})=>{const c=h.useRef(null),d=F(),[u]=Ee(["nform"]);h.useEffect(()=>{u||c.current&&r&&c.current.focus()},[r]);const p=E=>{c.current&&(E.key===" "||E.key==="Enter")&&(E.preventDefault(),c.current.click(),i&&i())},g=(E,y)=>{d(U.analyticsEvent({type:rn.SELECT_CATEGORY_GA4_EVENT,location:"dropdown",categoryName:E,retailerCategoryId:y}));const I={event:"select_category",id:y,location:"dropdown",name:E};te.sendEvent({GA:I,WA:null}),d(U.analyticsEvent({type:rn.CATEGORY_FILTER_OPTION_CLICKED,categoryName:E}))};return s.jsx(Be.Item,{children:s.jsx(xe,{className:"salt-d--block",asChild:!0,condensed:o,children:s.jsx(Kvt,{standalone:!r,ref:c,to:e.url,tabIndex:r?0:-1,"data-test":n,onClick:()=>{e.name&&e.retailerCategoryId&&g(e.name,e.retailerCategoryId),t&&t()},onBlur:a,onKeyDown:p,...l,children:e.name})})},e.url)};PA.displayName="CategoriesListItem";function Aee(e,t){return e?e.map(n=>({url:t({category:n.id,fullURLPath:n.fullURLPath,retailerCategoryId:n.retailerCategoryId}),name:n.name,retailerCategoryId:n.retailerCategoryId})):[]}const Lk=h.forwardRef(function({categories:t=[],categoryRootLinks:n=[],buildUrl:o,condensed:r=!1,highlightedIndex:a,onListItemClick:i,onListItemBlur:l,onListKeyDown:c,onListItemSubmit:d},u){return s.jsxs(Be,{innerRef:u,role:"menu",inline:!1,onKeyDown:c,children:[n&&n.map((p,g)=>s.jsx(PA,{role:"menuitem",dataTestId:"root-category-link",condensed:r,isSelected:a===g,link:p,onListItemBlur:l,onClick:i,onListItemSubmit:d},`${p.name}-${p.url}`)),Aee(t,o).map((p,g)=>s.jsx(PA,{role:"menuitem",dataTestId:"category-link",condensed:r,isSelected:a===g+n.length,link:p,onListItemBlur:l,onClick:i,onListItemSubmit:d},`${p.name}-${p.url}`))]})}),zvt=v(rt.Content)`
    max-block-size: ${$(300)};
`,Qvt=v.div`
    max-block-size: ${$(300)};
    overflow-y: auto;
`,PS=e=>e.name?.trim()[0].toLowerCase(),Xvt=h.forwardRef(function({isOpen:t,onClick:n,onDropdownBlur:o,onEscKeysDown:r,categories:a,buildUrl:i,categoryRootLinks:l=[],buttonTitle:c,onOpenByArrows:d,onListItemSubmit:u},p){const g=L(),[E,y]=ae.useState(-1),[I,S,C]=hee(0,[t]),T=a.map(PS),A=[...l.map(PS),...T],R=a.length+l.length,P=E===R-1,N=E===0,k=()=>{y(R-1)},M=()=>{y(0)},w=()=>{y(q=>q+1)},j=()=>{y(q=>q-1)},G=q=>{const ne=q.relatedTarget;ne instanceof HTMLElement&&(S.current&&S.current.contains(ne)||(Ai(),y(-1),o()))},W=q=>{let ne,ue;q.length>1||(ne=E+1,ne>=R&&(ne=0),ue=A.indexOf(q,ne),ue===-1&&(ue=A.indexOf(q,0)),ue>-1&&y(ue))},H=q=>{const{key:ne}=q;switch(ne){case"ArrowDown":P?M():w();break;case"ArrowUp":N?k():j();break;case"Home":case"PageUp":M();break;case"End":case"PageDown":k();break;case"Escape":if(r(),!C.current)return;C.current.focus();break;default:W(ne.toLowerCase());break}},K=q=>{const{key:ne}=q;switch(Eg(),ne){case" ":case"Enter":case"ArrowDown":d(),M();break;case"ArrowUp":N||(d(),k());break}},X=q=>{q.detail!==0&&n()};return s.jsxs(rt.Container,{ref:p,children:[s.jsx(rt.TriggerDefaultButton,{"aria-haspopup":"menu","aria-expanded":t,isOpen:t,text:g.formatMessage(c),"data-test":"category-dropdown-button",fill:!1,onKeyDown:K,onBlur:G,ref:C,onClick:X}),s.jsx(Dk,{isOpen:t,ref:S,left:I,children:s.jsx(zvt,{children:s.jsx(Lk,{condensed:!0,highlightedIndex:E,categories:a,categoryRootLinks:l,buildUrl:i,onListItemBlur:G,onListKeyDown:H,onListItemSubmit:u})})})]})}),Zvt=({categories:e,buildUrl:t,categoryRootLinks:n=[]})=>{const o=L(),r=h.useRef(null),[a,i]=ae.useState(-1),l=e.map(PS),d=[...n.map(PS),...l],u=e.length+n.length,p=a===u-1,g=a===0,E=()=>r.current?.querySelectorAll("a"),y=()=>{const A=u-1,R=E();i(u-1),R?.[A]?.focus()},I=()=>{const R=E();i(0),R?.[0]?.focus()},S=()=>{const A=E();i(R=>(A?.[R+1]?.focus(),R+1))},C=()=>{const A=E();i(R=>(A?.[R-1]?.focus(),R-1))},T=A=>{let R,P;A.length>1||(R=a+1,R>=u&&(R=0),P=d.indexOf(A,R),P===-1&&(P=d.indexOf(A,0)),P>-1&&i(P))},_=(A,R)=>{const{key:P}=A;switch(P){case"ArrowDown":A.preventDefault(),p?I():S();break;case"ArrowUp":A.preventDefault(),g?y():C();break;case"Home":case"PageUp":A.preventDefault(),I();break;case"End":case"PageDown":A.preventDefault(),y();break;case"Tab":I(),R();break;default:T(P.toLowerCase());break}};return s.jsx(rt.Container,{children:s.jsx(mee,{triggerTitle:o.formatMessage("bottom.sheet.categories.title"),a11y:{label:o.formatMessage("bottom.sheet.categories.title")},onClose:I,onOpen:I,renderContent:({closeDropdown:A})=>s.jsx(Qvt,{children:s.jsx(Lk,{ref:r,condensed:!0,highlightedIndex:a,categories:e,categoryRootLinks:n,buildUrl:t,onListKeyDown:R=>{_(R,A)}})})})})},Jvt=h.forwardRef(function(t,n){const[o]=Ee(["nform"]);return o?s.jsx(Zvt,{categories:t.categories,buildUrl:t.buildUrl,categoryRootLinks:t.categoryRootLinks}):s.jsx(Xvt,{ref:n,...t})}),eTt=({isOpen:e,onRequestClose:t,categories:n,categoryRootLinks:o,buildUrl:r,onListItemClick:a,buttonTitle:i,onButtonClick:l})=>{const c=L();return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",onClick:l,"aria-label":c.formatMessage("search.categories.aisles.button"),fill:!0,children:c.formatMessage(i)}),s.jsxs(B,{isOpen:e,onRequestClose:t,scrollToTop:!0,closeMessage:c.formatMessage("categories.accessibility.bottom.sheet.close.button"),asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",className:"salt-m-l--4",children:c.formatMessage("bottom.sheet.categories.title")})}),s.jsx(B.Body,{"data-test":"bottom-sheet-body",children:s.jsx(Lk,{categories:n,categoryRootLinks:o,buildUrl:r,onListItemClick:a})})]})]})},tTt=({categoryRootLinks:e,categories:t,buildUrl:n,messageKey:o="search.refine.aisles.button",sendAnalyticsEvent:r=U.analyticsEvent})=>{const a=F(),[i,l]=h.useState(!1),c=()=>{a(r({type:ht.OPEN_MENU_CLICKED,menuId:"CATEGORY_FILTER"}))},d=()=>{l(!0),c()},u=()=>{l(!1)},p=()=>{i||c(),l(!i)},E=Dm(()=>{Ai(),i&&u()},[i]);return s.jsxs(h.Fragment,{children:[s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(eTt,{buildUrl:n,buttonTitle:"bottom.sheet.categories.title",categories:t,categoryRootLinks:e,isOpen:i,onButtonClick:d,onListItemClick:u,onRequestClose:u})}),s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(Jvt,{isOpen:i,ref:E,categories:t,buttonTitle:o,buildUrl:n,categoryRootLinks:e,onClick:p,onDropdownBlur:u,onEscKeysDown:()=>{Ai(),u()},onListItemSubmit:()=>{Ai(),u()},onOpenByArrows:d})})]})},sTt=({categoryRootLinks:e=[],categories:t,buildUrl:n,className:o})=>{const r=F(),a=(i,l)=>{r(U.analyticsEvent({type:rn.SELECT_CATEGORY_GA4_EVENT,categoryName:i,retailerCategoryId:l,location:"sidebar"}));const c={event:"select_category",id:l,location:"sidebar",name:i};te.sendEvent({GA:c,WA:null}),r(U.analyticsEvent({type:rn.CATEGORY_FILTER_OPTION_CLICKED,categoryName:i}))};return s.jsxs(Be,{inline:!1,className:o,children:[e&&e.map(i=>s.jsx(Be.Item,{children:s.jsx(Ye,{"data-test":"root-category-link",to:i.url,standalone:!0,children:i.name})},i.url)),Aee(t,n).map(i=>s.jsx(Be.Item,{children:s.jsx(Ye,{"data-test":"root-category-link",to:i.url,standalone:!0,onClick:()=>a(i.name||"",i.retailerCategoryId||""),children:i.name})},i.url))]})},kk=({options:e,selectedId:t="",sortHandler:n,onOpen:o=()=>{}})=>{const r=L(),a=e.find(c=>c.id===t)||null,i=dTt(a)?r.formatMessage(a.messageKey):r.formatMessage("sort.button.default"),l=e.map(c=>({value:c.id,name:r.formatMessage(c.messageKey)}));return s.jsx("div",{className:"salt-d--inline-block",children:s.jsx(fs.DropdownSelect,{name:"sort","data-test":"sort-button",id:"sort-dropdown-select",onOpen:o,value:{value:a?.id||"",name:i},options:l,placeholder:r.formatMessage("sort.button.default"),label:{text:r.formatMessage("sort.accessibility.button.closed"),isVisuallyConcealed:!0},onOptionChange:c=>{n({id:c.value,messageKey:c.name,selected:!0})}})})},{RadioIconOff:nTt,RadioIconOn:oTt,RadioText:rTt}=Pa,aTt=v(O)`
    overflow: hidden;
`,iTt=v.strong`
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
`,lTt=({checked:e,label:t,dataTestId:n,onClick:o,highlighted:r,setHighlighted:a,className:i})=>s.jsx(Be.Item,{id:t,role:"option",onClick:o,className:i,"aria-selected":e,onFocus:()=>{a()},tabIndex:0,children:s.jsx(xe,{children:s.jsxs("div",{className:"salt-d--flex",children:[e&&s.jsx(oTt,{name:"radio_on"}),!e&&s.jsx(nTt,{name:"radio_off"}),s.jsx(aTt,{"data-test":n,children:s.jsx(rTt,{asChild:!0,bold:r,children:s.jsx(iTt,{children:t})})})]})})}),Ree=v(lTt)`
    cursor: pointer;
`;Ree.displayName="SortListItemMobile";const jk=({options:e,selectedId:t,sortHandler:n,onOpen:o=()=>{}})=>{const[r,a]=h.useState(!1),i=L(),l=e.find(R=>R.id===t)||null,c=l?.messageKey||"sort.button.default",u=`${i.formatMessage(c)}. ${i.formatMessage("sort.accessibility.button.closed")}`,[p,g]=h.useState(e.findIndex(R=>R.id===t)),[E]=Ee(["nfsch"]),[y,I]=h.useState(l?.id),S=R=>{(R.key==="Enter"||R.key===" ")&&C(e[p])};h.useEffect(()=>(document.addEventListener("keydown",S),()=>{document.removeEventListener("keydown",S)}),[p]),h.useEffect(()=>{r||document.removeEventListener("keydown",S)},[r]);const C=R=>{n(R),a(!1)},T=R=>{n(R),a(!1)},_=()=>{o(),I(t),a(!0)},A=()=>{g(e.findIndex(R=>R.id===t)),a(!1)};return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",fill:!0,onClick:_,"data-test":"sort-mobile-button","aria-label":u,children:s.jsx(b,{id:c})}),s.jsxs(B,{isOpen:r,onRequestClose:A,closeMessage:i.formatMessage("sort.accessibility.bottom.sheet.close.button"),asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"bottom.sheet.sort.title"})})}),s.jsx(B.Body,{"data-test":"sort-bottom-sheet-body",children:E?s.jsx(xe,{children:s.jsx(fs.RadioGroup,{value:y,groupLabel:{text:i.formatMessage("bottom.sheet.sort.title"),isVisuallyConcealed:!0},name:"mobileSort",onChange:I,radios:e.map(R=>({value:R.id,label:i.formatMessage(R.messageKey)}))})}):s.jsx(Be,{inline:!1,role:"listbox",tabIndex:0,children:e.map((R,P)=>s.jsx(Ree,{highlighted:p===P,setHighlighted:()=>g(P),checked:t===R.id,label:i.formatMessage(R.messageKey),dataTestId:"sort-mobile-option",onClick:()=>C(R)},R.id))})}),E&&s.jsx(B.Footer,{children:s.jsx(x,{intent:"primary",fill:!0,onClick:()=>T(e.find(R=>R.id===y)),"data-test":"sort-mobile-submit-button",children:s.jsx(b,{id:"bottom.sheet.sort.confirm"})})})]})]})},Dee=({changeQuerystringLocation:e,sendAnalyticsEvent:t=U.analyticsEvent})=>{const n=f(aD),o=f(cD),r=F(),a=L(),i=d=>{d&&e({sortOption:d.id})},l=()=>{r(t({type:ht.OPEN_MENU_CLICKED,menuId:"SORT"}))},c=()=>s.jsxs(h.Fragment,{children:[s.jsxs(Kt,{breakpoint:"sm-up",remainInDom:!1,children:[s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsx(O,{bold:!0,asChild:!0,size:"l",children:s.jsx("h2",{children:a.formatMessage("sort.title")})})}),s.jsx(kk,{options:n,sortHandler:i,onOpen:l,selectedId:o})]}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(jk,{options:n,sortHandler:i,selectedId:o,onOpen:l})})]});return n&&n.length>0&&c()},cTt=["sorting.option.favorite","sorting.option.life","sorting.option.name.ascending","sorting.option.name.descending","sorting.option.placeholder","sorting.option.price.ascending","sorting.option.price.descending","sorting.option.price.per.ascending","sorting.option.price.per.descending","sorting.option.customer.rating"],dTt=e=>e!==null&&cTt.includes(e.messageKey);Dee.displayName="SortContainer";const uTt=v(xe)`
    display: flex;
    align-items: center;
`,pTt=({filter:e,attribute:t,handleChange:n})=>{const[o,r]=h.useState(()=>e.attributes.some(c=>c.id===t.id&&c.selected));h.useEffect(()=>{r(e.attributes.some(c=>c.id===t.id&&c.selected))},[e]);const{formatMessage:a}=L(),i=()=>t.id==="onOffer"?a("promotions.category.root.name"):t.id==="favoritesOnly"?a("filter.options.label.all.favorites"):t.id==="new"?a("filter.label.new"):"",l=()=>{n(e.id,t.id),r(!o)};return s.jsx(Q,{children:s.jsx(uTt,{condensed:!0,"data-test":t.id,children:s.jsx(Lo,{input:{onChange:l,checked:o},whiteSpace:"nowrap",bold:!1,className:"salt-m-b--0",labelClassName:"salt-m-b--0",label:i()},`${t.id}${e.id}`)})})},mTt=({filter:e,filterHandler:t})=>{const n=f(Xp),o=(i,l)=>n[i].map(c=>({filterId:i,attributeId:c})).concat({filterId:i,attributeId:l}),r=(i,l)=>n[i].filter(c=>c!==l).map(c=>({filterId:i,attributeId:c})),a=(i,l)=>{let c=[];n[i]?n[i].includes(l)?c=r(i,l):c=o(i,l):c=[{filterId:i,attributeId:l}],t(c,i)};return s.jsx(ae.Fragment,{children:e.attributes.map(i=>s.jsx(pTt,{filter:e,attribute:i,handleChange:a},i.id))})},{RadioIconOff:hTt,RadioIconOn:gTt,RadioText:ETt}=Pa,fTt=v(O)`
    overflow: hidden;
`,yTt=v.strong`
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    align-items: center;
`,ITt=v(Rn)`
    align-items: center;
`,Mk=({bold:e=!1,checked:t=!1,itemProps:n,onClick:o,attribute:r})=>{const{label:a,id:i}=r,{formatMessage:l}=L(),c=l(`filter.customer.rating.attributes.${i}.label`);return s.jsx(Be.Item,{onClick:o,tabIndex:0,...n,"data-test":r.id,children:s.jsx(xe,{condensed:!0,children:s.jsxs(ITt,{className:"salt-m-b--0",children:[t&&s.jsx(gTt,{name:"radio_on"}),!t&&s.jsx(hTt,{name:"radio_off"}),s.jsx(fTt,{"data-test":"customer-rating-option",title:c,children:s.jsx(ETt,{asChild:!0,bold:e,children:s.jsxs(yTt,{className:"salt-d--flex salt-gap--2",children:[s.jsx(dT,{rating:Number(a),size:24}),c]})})})]})})})};Mk.displayName="CustomerRatingItem";const g0=(e,t)=>({filterId:e.id,attributeId:t.id}),STt=({filter:e,isButtonFullWidth:t=!1,filterHandler:n,onOpen:o})=>{const r=L(),a=h.useRef(null),i=e.attributes.find(w=>w.selected),l=Dg(e,r),c=r.formatMessage("filter.accessibility.facet",{filterLabel:l}),{getToggleButtonProps:d,getMenuProps:u,getLabelProps:p,getItemProps:g,highlightedIndex:E,selectedItem:y,closeMenu:I,isOpen:S}=Er({items:e.attributes.map(w=>g0(e,w)),labelId:"customer-rating",menuId:"customer-rating-filter",stateReducer:(w,j)=>{const{type:G,changes:W}=j;switch(G){case Er.stateChangeTypes.ToggleButtonClick:return W.isOpen?(o(e.id),{...W,highlightedIndex:e.attributes.findIndex(H=>H.id===i?.id)||-1,selectedItem:{filterId:e.id,attributeId:i?.id||""}}):W;case Er.stateChangeTypes.ItemClick:case Er.stateChangeTypes.ToggleButtonKeyDownEnter:return{...W,highlightedIndex:e.attributes.findIndex(({id:H})=>H===W?.selectedItem?.attributeId),isOpen:!0};case Er.stateChangeTypes.ToggleButtonBlur:return W.selectedItem?{...W,isOpen:!0,selectedItem:y}:W;default:return W}}}),C=d({"aria-expanded":S,"aria-label":c,"aria-labelledby":void 0,"aria-controls":`filter-facet-${e.id}`,"aria-haspopup":"dialog","aria-activedescendant":void 0,ref:a}),T=()=>{a.current&&a.current.focus()},_=w=>{w.key==="Escape"&&(T(),I())},A=()=>{y&&n([{...y,attributeId:y.attributeId}],y.filterId),T(),I()},R=p({htmlFor:void 0}),P=u(),{ref:N,...k}=P,M=Dm(I,[]);return s.jsxs(rt.Container,{ref:M,"data-test":`filter-facet-${e.id}`,children:[s.jsx(rt.TriggerDefaultButton,{isOpen:S,text:e.label,fill:t,"data-test":"customer-rating-filter",...R,...C}),s.jsx(Dk,{isOpen:S,autoWidthLg:!1,"data-test":"filter-facet-dropdown",onKeyDown:_,children:s.jsx(rt.Content,{children:s.jsxs(Be,{inline:!1,...k,innerRef:N,children:[e.attributes.map((w,j)=>{const G=y?.attributeId===w.id,W=g({index:j,item:g0(e,w),"aria-selected":G,tabIndex:-1});return s.jsx(Mk,{bold:E===j,checked:G,attribute:w,itemProps:W},w.id)}),s.jsx(x,{intent:"primary",fill:!0,"aria-label":r.formatMessage("filter.accessibility.apply.button"),onClick:A,tabIndex:0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"search.filter.button.apply"})})})]})})})]})},CTt=({filter:e,filterHandler:t,selectedItems:n})=>{const{formatMessage:o}=L(),r=a=>a.id==="onOffer"?o("promotions.category.root.name"):a.id==="favoritesOnly"?o("filter.options.label.all.favorites"):a.id==="new"?o("filter.label.new"):"";return s.jsx(ae.Fragment,{children:e.attributes.map(a=>{const i=n.some(({attributeId:l})=>l===a.id);return s.jsx(xe,{className:"salt-m-b--2",onClick:l=>{t({filterId:e.id,attributeId:a.id}),l.preventDefault()},children:s.jsx(Lo,{bold:!1,label:void 0,whiteSpace:"nowrap",last:!1,input:{checked:i},"aria-selected":i,children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{className:"salt-m--0",children:r(a)})})},`${a.id}${e.id}`)},a.id)})})},vTt=(e,t,n,o)=>{if(e==="onOffer"&&t==="onOffer")return n.formatMessage("promotions.category.root.name");if(e==="favoritesOnly"&&t==="favoritesOnly")return n.formatMessage("filter.options.label.all.favorites");if(e==="new"&&t==="new")return n.formatMessage("filter.label.new");const r=o?.filter(a=>a.id===e).pop();if(r){const a=r.attributes.filter(i=>i.id===t).pop();if(e==="customerRating"&&a)return n.formatMessage(`filter.customer.rating.attributes.${a.id}.label`);if(a)return a.label}return t},TTt=v(Be.Item)`
    margin-block-end: 0;
`,_Tt=({filterId:e,attributeLabel:t})=>e==="customerRating"?s.jsxs(Q,{gap:["xs"],children:[s.jsx(pe,{name:"reviews",height:18,width:18}),t]}):t,wk=({appliedFilterItem:e,onClickHandler:t,filters:n,dataTestId:o})=>{const r=L(),{filterId:a,attributeId:i}=e,l=vTt(a,i,r,n);return a==="boolean"?null:s.jsx(JO,{minSize:"md",onClick:t,buttonAriaLabel:r.formatMessage("filter.accessibility.clear.single.button",{filterAttribute:l}),as:TTt,dataTestId:o,children:_Tt({filterId:a,attributeLabel:l})})};wk.displayName="FilterAttribute";const bTt=v.button`
    cursor: pointer;
`,xTt=v(O)`
    flex-grow: 1;
`,Oee=({onClick:e,title:t,numberOfSelectedFilters:n})=>{const r=L().formatMessage("filter.accessibility.facet.with.applied",{filterLabel:t,numberOfAppliedFilters:n});return s.jsx(xe,{asChild:!0,children:s.jsx(bTt,{type:"button",onClick:e,"aria-label":r,children:s.jsxs(Q,{align:"center",children:[s.jsx(xTt,{bold:!0,asChild:!0,size:"l",children:s.jsx("h3",{children:t})}),n>0&&s.jsx(Ll,{className:"salt-m-r--2",intent:"secondary",count:n}),s.jsx(pe,{name:"arrow_right"})]})})})};Oee.displayName="FilterFacetCard";const ATt=v(B.Footer)`
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-column-gap: var(--salt-spacing-4);
`,RTt=v(Ll)`
    position: absolute;
    inset-block-start: calc(var(--salt-spacing-2) * -1);
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
`,DTt=({appliedFilters:e,allFiltersHandler:t,analyticsEventsHandler:n})=>{const[o,r]=h.useState(!1),[a]=Ee(["fbcr"]),[i,l]=h.useState(null),[c,d]=h.useState([]),[u,p]=h.useState(!1),g=f(aE),E=L(),y=h.useMemo(()=>Object.keys(e).reduce((q,ne)=>(e[ne].forEach(oe=>{q.push({attributeId:oe,filterId:ne})}),q),[]),[e]),[I,S]=h.useState(y);h.useEffect(()=>{S(y)},[y]);const C=q=>{u&&n({type:ht.CLEAR_ALL_FILTERS_BUTTON_CLICKED,payload:{...e,applyButtonClicked:q.toString()}})},T=(q,ne)=>{!ne&&c.length>0&&i&&n({type:ht.CLEAR_SELECTED_FILTERS_BUTTON_CLICKED,payload:{pageEventAttributes:{[i.id]:c,applyButtonClicked:q.toString()}}})},_=q=>q.id==="onOffer"?E.formatMessage("promotions.category.root.name"):q.id==="favoritesOnly"?E.formatMessage("filter.options.label.all.favorites"):q.id==="new"?E.formatMessage("filter.label.new"):q.label,A=q=>s.jsxs(ae.Fragment,{children:[s.jsx(ie,{children:E.formatMessage("filter.accessibility.facet.list")}),s.jsx(Be,{inline:!1,children:q.attributes.map(ne=>{const ue=I.some(ye=>ye.attributeId===ne.id&&ye.filterId===q.id),oe=_(ne);return q.type==="CUSTOMER_RATING"&&a?s.jsx(Be.Item,{onKeyPress:({key:ye})=>{ye==="Enter"&&k(q,ne)},children:s.jsx(Mk,{onClick:()=>k(q,ne),checked:ue,attribute:ne},ne.id)},`${ne.id}${q.id}`):s.jsx(KT,{label:oe,checked:ue,onChange:()=>{const ye=ue?I.filter(he=>he.attributeId!==ne.id||he.filterId!==q.id):[...I,{attributeId:ne.id,filterId:q.id}];S(ye)},condensed:!1},`${ne.id}${q.id}`)})})]}),R=q=>{const{filterId:ne,attributeId:ue}=q;return s.jsx(wk,{appliedFilterItem:q,onClickHandler:()=>{const oe=I.filter(ye=>ye.attributeId!==ue||ye.filterId!==ne);S(oe)},filters:g,dataTestId:"applied-filter-tag"},ue)},P=q=>{l(q),n({type:ht.OPEN_MENU_CLICKED,payload:{menuId:q.id}})},N=q=>{const ne=I.filter(oe=>oe.attributeId!==q.attributeId),ue=ne.length===I.length?[...ne,q]:ne;S(ue)},k=(q,ne)=>{const oe=[...I.filter(ye=>ye.filterId!==q.id),{attributeId:ne.id,filterId:q.id}];S(oe)},M=()=>{const q=I.some(({filterId:ne})=>ne!=="boolean");return s.jsxs(h.Fragment,{children:[I.length>0&&q&&s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx(O,{bold:!0,asChild:!0,size:"l",children:s.jsx("h2",{children:s.jsx(b,{id:"bottom.sheet.filter.selected.filters.title"})})}),s.jsx(Q,{as:Be,wrap:"wrap",gap:["sm"],"aria-label":E.formatMessage("filter.accessibility.selected.filters.list"),"data-test":"mobile-selected-filters",children:I.map(R)})]}),g?.length&&s.jsxs(ae.Fragment,{children:[s.jsx(ie,{children:E.formatMessage("filter.accessibility.facet.list")}),s.jsx(Be,{inline:!1,children:g.map(ne=>{const ue=Dg(ne,E),oe=I.filter(ye=>ye.filterId===ne.id).length;return s.jsx(Be.Item,{children:ne.id==="boolean"?s.jsx(CTt,{filter:ne,selectedItems:I,filterHandler:N}):s.jsx(Oee,{onClick:()=>P(ne),title:ue,numberOfSelectedFilters:oe})},ne.id)})})]})]})},w=()=>{r(!1),S(y),C(!1),T(!1),l(null),d([])},j=()=>{l(null),T(!1),d([])},G=()=>{if(i){const q=W(i.id);T(!0,q.length>0),l(null)}else C(!0);t(I),r(!1)},W=q=>I.filter(ne=>ne.filterId===q),H=()=>i?I.reduce((ne,ue)=>(ue.filterId===i.id&&ne.push(ue.attributeId),ne),[]):[],K=y.length,X=y.length>0?E.formatMessage("filter.accessibility.manage.button.with.applied",{numberOfAppliedFilters:y.length}):E.formatMessage("filter.accessibility.manage.button");return s.jsxs(h.Fragment,{children:[s.jsxs(x,{intent:"secondary",onClick:()=>r(!0),"data-test":"filters-button","aria-label":X,fill:!0,children:[K>0?s.jsx(RTt,{intent:"secondary",count:K}):null,s.jsx(b,{id:"search.filter.button"})]}),s.jsxs(B,{isOpen:o,onRequestClose:w,closeMessage:E.formatMessage("filter.accessibility.bottom.sheet.close.button"),asBottomSheet:!0,children:[s.jsx(B.Header,{"data-test":"filters-bottom-sheet-header",align:"left",children:s.jsxs(Q,{align:"center",children:[i&&s.jsx(x,{onClick:j,intent:"tertiary",fill:!1,"aria-label":E.formatMessage("filter.accessibility.bottom.sheet.back.button"),"data-test":"filters-bottom-sheet-back-button",children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsx(ee,{as:"h1",children:i?Dg(i,E):s.jsx(b,{id:"bottom.sheet.filter.title"})})]})}),s.jsx(B.Body,{"data-test":"filters-bottom-sheet-body",children:i?A(i):M()}),s.jsxs(ATt,{"data-test":"filters-bottom-sheet-footer",children:[i?s.jsx(x,{"aria-label":E.formatMessage("filter.accessibility.clear.selected.button"),intent:"secondary",onClick:()=>{d(H()),S(I.filter(q=>q.filterId!==i.id))},fill:!0,disabled:I.filter(q=>q.filterId===i.id).length===0,children:s.jsx(b,{id:"filter.button.clear.selected"})}):s.jsx(x,{"aria-label":E.formatMessage("filter.accessibility.clear.all.button"),intent:"secondary",onClick:()=>{S([]),p(!0)},disabled:I.length===0,children:s.jsx(b,{id:"bottom.sheet.filter.button.clear.all"})}),s.jsx(x,{"aria-label":E.formatMessage("filter.accessibility.mobile.apply.button"),intent:"primary",onClick:G,children:s.jsx(b,{id:"search.filter.button.apply"})})]})]})]})},Pee=({changeQuerystringLocation:e})=>{const t=f(aE),n=f(Xp),o=(i,l)=>l.map(c=>s.jsx(wk,{appliedFilterItem:{filterId:i,attributeId:c},onClickHandler:()=>r(i,c),filters:t,dataTestId:"applied-filter-tag"},c)),r=(i,l)=>{const c=a(i,l);e({filters:c})},a=(i,l)=>Object.keys(n).reduce((c,d)=>{if(d!==i)return{...c,[d]:n[d]};const u=n[d].filter(p=>p!==l);return u.length?{...c,[d]:u}:c},{});return Object.keys(n).length>0?s.jsx(Q,{as:Be,align:"center",basis:"100%",wrap:"wrap",gap:["sm"],margin:[null],children:Object.keys(n).map(i=>o(i,n[i]))}):null},Nee=({changeQuerystringLocation:e,sendAnalyticsEvent:t=U.analyticsEvent,isRenderClearAllButton:n=!1})=>{const o=f(aE),r=f(Xp),[a]=Ee(["fbcr"]),i=F(),l=L(),c=({type:I,payload:S})=>{i(t({type:I,...S}))},d=()=>{i(U.analyticsEvent({type:ht.CLEAR_ALL_FILTERS_BUTTON_CLICKED,...r,applyButtonClicked:"true"}))},u=({menuId:I})=>{c({type:ht.OPEN_MENU_CLICKED,payload:{menuId:I}})},p=({filterId:I,selectedAttributes:S,applyButtonClicked:C})=>{c({type:ht.CLEAR_SELECTED_FILTERS_BUTTON_CLICKED,payload:{pageEventAttributes:{[I]:S,applyButtonClicked:C.toString()}}})},g=I=>{const S=I.filter(C=>C).reduce((C,T)=>(C[T.filterId]||(C[T.filterId]=[]),C[T.filterId].includes(T.attributeId)||C[T.filterId].push(T.attributeId),C),{});e({filters:S})},E=(I,S)=>{const C={};I.length>0&&(C[S]=I.map(T=>T.attributeId)),o?.forEach(T=>{if(T.id!==S){const _=T.attributes.filter(A=>A.selected).map(A=>A.id);_.length>0&&(C[T.id]=_)}}),e({filters:C})},y=()=>s.jsxs(h.Fragment,{children:[s.jsxs(Kt,{breakpoint:"sm-up",remainInDom:!1,children:[s.jsx(Kt,{breakpoint:"lg-up",remainInDom:!1,children:s.jsxs(h.Fragment,{children:[s.jsxs(Q,{justify:"space-between",align:"center",children:[s.jsx(O,{className:n?"":"salt-m-t--4",asChild:!0,size:"l",bold:!0,children:s.jsx("h2",{children:l.formatMessage("filter.title")})}),n&&s.jsx(x,{className:"salt-m-l--4",intent:"tertiary",fill:!1,"data-test":"clear-filters-button",onClick:()=>{e({filters:[]}),d()},"aria-label":l.formatMessage("filter.accessibility.clear.all.button"),children:s.jsx(x.Text,{children:s.jsx(b,{id:"filter.button.clear.all"})})})]}),n&&s.jsx(Pee,{changeQuerystringLocation:e})]})}),o.map(I=>I.type==="BOOLEAN"?s.jsx(mTt,{filter:I,filterHandler:E}):I.type==="CUSTOMER_RATING"&&a?s.jsx(STt,{filter:I,filterHandler:E,onOpen:S=>u({menuId:S}),isButtonFullWidth:!0},I.id):s.jsx(Eee,{filter:I,filterHandler:E,onOpen:S=>u({menuId:S}),clearedFilterAttributesHandler:S=>p({...S})},I.id))]}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(DTt,{appliedFilters:r,allFiltersHandler:g,analyticsEventsHandler:c})})]});return s.jsx(h.Fragment,{children:o&&o.length>0&&y()})};Nee.displayName="FiltersContainer";const OTt=D("bt.top"),PTt=({additionalNavigableContentFactory:e,categories:t,buildUrl:n,children:o,showRefineSortFilters:r,refine:a,showCategoryRefineGroupOnly:i,categoryRootLinks:l,changeQuerystringLocation:c,selectedSortOptionId:d,showSortAndFilters:u})=>{const{currentBreakpoint:p}=h.useContext(kn),g=f(Xp),E=Ke[p||""]||0,y=E>Ke.xs&&E<Ke.lg,I=L(),S=F(),C=f(OTt),T=()=>l||t&&t.length>0,_=()=>{S(U.analyticsEvent({type:ht.CLEAR_ALL_FILTERS_BUTTON_CLICKED,...g,applyButtonClicked:"true"}))},A=()=>s.jsx(tTt,{categoryRootLinks:l,categories:t,buildUrl:n,onOpen:a.onOpen,messageKey:"search.categories.aisles.button"}),R=()=>s.jsx(Lt,{breakpoint:"lg-up",display:"inline",remainInDom:!1,children:s.jsx(Mh.Bar,{children:s.jsx(Mh,{children:s.jsx("div",{className:"salt-m--1",children:A()})})})}),P=()=>s.jsx(x,{className:"salt-m-l--4",intent:"tertiary",fill:!1,onClick:()=>{c({filters:[]}),_()},"aria-label":I.formatMessage("filter.accessibility.clear.all.button"),children:s.jsx(x.Text,{children:s.jsx(b,{id:"filter.button.clear.all"})})}),N=n({filters:{},sortOption:d}),M=Object.keys(g).some(H=>H!=="boolean"),w=C?"salt-m-b--2":"",W=[u||t&&t.length>0?"salt-m-x--2 lg:salt-m-l--0":"salt-m-x--2",w].filter(Boolean).join(" ");return s.jsxs(V,{flush:!0,children:[(r||t&&t.length>0)&&s.jsxs(V.Item,{colSpan:{xs:12,lg:2},children:[i&&T()&&R(),r&&s.jsxs(Mh,{children:[e?.()&&s.jsx("div",{className:`salt-m-b--2 sm:salt-m-b--4 ${u?"lg:salt-m--8":""}`,children:e()}),y&&u&&s.jsxs(ae.Fragment,{children:[s.jsx(O,{className:`${M&&"salt-d--inline"} salt-m-y--2 salt-m-x--2`,bold:!0,asChild:!0,size:"l",children:s.jsx("h2",{children:I.formatMessage("tablet.filter.title")})}),M&&P()]}),s.jsxs(Q,{wrap:"nowrap",wrapSmUp:"wrap",gap:["sm"],margin:["xs","sm"],marginSmUp:["xs","sm"],marginLgUp:[null,null,null,"sm"],directionLgUp:"column",gapLgUp:["md"],additionalCssLgUp:`
                                            > * {
                                                width: 100%;
                                            }
                                        `,children:[u&&s.jsxs(h.Fragment,{children:[y&&M&&s.jsx(Pee,{changeQuerystringLocation:c}),s.jsx(Dee,{changeQuerystringLocation:c}),s.jsx(Nee,{changeQuerystringLocation:c,clearFiltersUrl:N,isRenderClearAllButton:M})]}),T()&&s.jsx(Lt,{breakpoint:"lg-up",remainInDom:!1,children:A()})]})]}),T()&&s.jsxs(Kt,{breakpoint:"lg-up",children:[s.jsx(xee,{flushTop:!r||!u,children:s.jsx(b,{id:"navigation.categories.title"})}),s.jsx(sTt,{categoryRootLinks:l,categories:t,buildUrl:n,className:"salt-m-t--0 salt-m-r--2 salt-m-b--2 salt-m-l--2"})]})]}),s.jsx(V.Item,{colSpan:{xs:12,lg:r||t&&t.length>0?10:12},children:s.jsx("div",{className:W,children:o})})]})},NTt=(e,t,n)=>Uo(e.retailerProductId,kc(e.name,{isSEOReadableURLEnabled:n}),{basePath:t,queryString:""}),LTt=({products:e,seoReadableLinks:t})=>{const n=f(a=>Ze(a,"structured-data-home-url"));if(!n||e.length===0)return null;const r={"@context":"https://schema.org","@type":"ItemList",itemListElement:e.map((a,i)=>({"@type":"ListItem",position:i,url:NTt(a,n,t)}))};return s.jsx(Gn,{children:s.jsx("script",{"data-test":"product-listing-structured-data",type:"application/ld+json",children:JSON.stringify(r)})})},kTt=D("seo.ra"),jTt=D("seo.rdbl"),MTt=D("dso"),wTt=D("cfop"),FTt=D("new.prl"),BTt=D("sss");class UTt extends h.Component{static getDerivedStateFromProps(t,n){const o=Qe.parse(t.location.search),r=t.matchSublocationId?t.matchSublocationId(o):o.sublocationId;return{...n,category:r,fullURLPath:t.breadcrumbFullURLPath,isNoIndexPage:!!o.q,pageKey:r||o.q}}fopContainerElementRef;constructor(t){super(t),this.buildUrl=this.buildUrl.bind(this),this.getPageResults=this.getPageResults.bind(this),this.handleFopVisibiltyChange=this.handleFopVisibiltyChange.bind(this),this.getCategoryRootLinks=this.getCategoryRootLinks.bind(this),this.changeQuerystringLocation=this.changeQuerystringLocation.bind(this),this.fopContainerElementRef=h.createRef(),this.handleFetchNextPage=this.handleFetchNextPage.bind(this),this.sendSelectCategoryEvent=this.sendSelectCategoryEvent.bind(this),this.state={category:void 0,fullURLPath:""}}componentDidMount(){const{catalogueLastUpdated:t,isServerRendered:n,lastFetchedCatalogueLocation:o,actions:r,location:a,breadcrumb:i,retailerCategoryId:l}=this.props,c=a.state&&a.state.fromSlotBooking;n?(t?(this.sendActiveAttributesIfCataloguePage(),this.sendShowCategoryPageEvent(i,l),r.setLastFetchedLocation(this.locationAsString())):this.getPageResults(),this.sendServerRenderedSortAndFilterEvents()):this.locationAsString()===o&&!c?(this.sendActiveAttributesIfCataloguePage(),this.sendShowCategoryPageEvent(i,l)):this.getPageResults()}shouldComponentUpdate(t,n){return!!(t.productsByProductId!==this.props.productsByProductId||t.products!==this.props.products||t.totalProducts!==this.props.totalProducts||this.isPageDifferent(t,n)||t.pageViewId!==this.props.pageViewId||t.shouldShowScrollToTopButton!==this.props.shouldShowScrollToTopButton||this.props.page==="regulars"&&t.productGroups!==this.props.productGroups||!rp(this.props.withinGridProductCards,t.withinGridProductCards))}componentDidUpdate(t,n){const{filtersFromQueryString:o,products:r,page:a,catalogueLastUpdated:i,selectedSortOptionId:l,actions:c,pageViewId:d,location:u}=this.props,p=a==="search"||a==="categories";t.catalogueLastUpdated!==i&&this.sendActiveAttributesIfCataloguePage(),this.isPageDifferent(t,n)?this.getPageResults().then(()=>{if(p){const E=Qe.parse(u.search),y=Qe.parse(t.location.search);if(E.sortBy!==y.sortBy){c.sendAnalyticsEvent({type:ht.APPLY_SORT_EVENT,sortOptionId:l,pageType:a});const I={event:"apply_sort",sort:l,type:a};te.sendEvent({GA:I,WA:null})}rp(t.filtersFromQueryString,o)||this.sendApplyFilterEvent(a,o,r)}}):t.pageViewId!==d&&this.sendActiveAttributesIfCataloguePage()}sendServerRenderedSortAndFilterEvents(){const{filtersFromQueryString:t,products:n,page:o,selectedSortOptionId:r,actions:a}=this.props;if(o==="search"||o==="categories"){if(r){a.sendAnalyticsEvent({type:ht.APPLY_SORT_EVENT,sortOptionId:r,pageType:o});const i={event:"apply_sort",sort:r,type:o};te.sendEvent({GA:i,WA:null})}this.sendApplyFilterEvent(o,t,n)}}sendViewCategoryPageViewEvent(t){const{actions:n}=this.props;if(t.length){const o=t.at(-1),r=t.reduce((i,l,c)=>c<5?(i[`category${c+1}`]=l.name,i):i.categoryMore?(i.categoryMore=`${i.categoryMore}/${l.name}`,i):(i.categoryMore=l.name,i),{category1:null,category2:null,category3:null,category4:null,category5:null,categoryMore:null});n.sendAnalyticsEvent({type:rn.VIEW_CATEGORY_PAGE_VIEW,categoryName:o?.name,retailerCategoryId:o?.retailerCategoryId,...r});const a={event:"view_category",id:o?.retailerCategoryId,name:o?.name,category1:r.category1,category2:r.category2,category3:r.category3,category4:r.category4,category5:r.category5,category_more:r.categoryMore};te.sendEvent({GA:a,WA:null})}}getPageResults(t=0){const{isDefaultSortOrderEnabled:n,fetchPage:o,location:r,navigationType:a,searchQuery:i,selectedSortOptionId:l,actions:c,filtersFromQueryString:d,sortOptions:u}=this.props,p=Qe.parse(r.search);if(r.state?.isPrefetched&&a!=="POP")return Promise.resolve();const g=u&&u.find(E=>E.selected);return a==="POP"&&p.q===i?.searchTerm&&(p.sortBy===g?.id||p.sortBy===void 0&&(g?.id==="favorite"||g?.id==="relevance"))&&Oi(d,this.getNonEmptyAppliedFilters())?Promise.resolve():o({offset:t,category:this.state.category,filters:Yp(p),sortOption:n?p.sortBy:l})?.then(E=>{if(E){const{breadcrumbs:y,retailerCategoryId:I}=E;c.setLastFetchedLocation(this.locationAsString()),this.sendShowCategoryPageEvent(y,I)}return E})}isPageDifferent(t,n){return t.location.search!==this.props.location.search||n.category!==this.state.category}getAppliedFilters(){return this.props.filters.reduce((t,n)=>({...t,[n.id]:n.attributes.filter(o=>o.selected).map(o=>o.id)}),{})}sendApplyFilterEvent(t,n,o){const r=o.length===0,a=Object.keys(n).length===0;let i="";if(n&&Object.entries(n).forEach(([l,c])=>{i+=`${l}=${c?.toString()};`}),this.props.actions.sendAnalyticsEvent({type:r&&!a?ht.FILTER_NO_RESULT:ht.APPLY_FILTER_EVENT,pageType:t,filters:i||null}),r&&!a){const l={event:"filter_no_results",filters:i,type:t};te.sendEvent({GA:l,WA:null})}else{const l={event:"apply_filter",filters:i,type:t};te.sendEvent({GA:l,WA:null})}}getNonEmptyAppliedFilters(){const t=Object.entries(this.getAppliedFilters()).filter(n=>n[1].length>=1);return Object.fromEntries(t)}sendShowCategoryPageEvent(t,n){const{actions:o}=this.props;if(t&&t.length){const r=t.map(i=>i.name).join("/");o.sendAnalyticsEvent({type:ht.SHOW_CATEGORY_PAGE_EVENT,retailerId:n,categoryName:r});const a={event:"event",eventAction:"ShowCategory",eventCategory:"Catalogue",categoryName:r,eventLabel:n};te.sendEvent({GA:a,WA:null}),this.sendViewCategoryPageViewEvent(t)}}sendActiveAttributesIfCataloguePage(){const{actions:t,breadcrumb:n,selectedSortOptionId:o,totalProducts:r,pageError:a}=this.props,i=(n||[]).map(u=>u.id),l=i[i.length-1],c=this.getNonEmptyAppliedFilters(),d={TOTAL_PRODUCTS:r.toString(),SORT:o,BREADCRUMBS:i,PAGE_LOAD_ERROR:!!a,...c};l&&(d.CATEGORY=l),t.sendAnalyticsEvent({type:ht.CATALOGUE_ATTRIBUTES,attributes:d})}changeQuerystringLocation(t){return this.props.navigate(this.buildUrl(t))}locationAsString(){const{location:t}=this.props;return`${t.pathname}${t.search}`}getCategoryId(t,n){const{enableRegionAgnosticCategoriesPerSection:o,isRegionAgnosticEnabled:r}=this.props;return o&&r?n||t||this.state.category:t??this.state.category}buildUrl(t){const{category:n,filters:o,fullURLPath:r,sortOption:a,retailerCategoryId:i}=t,l=r??(this.state.fullURLPath||"");return this.props.getTargetUrl({category:this.getCategoryId(n,i),filters:o??this.props.filtersFromQueryString,fullURLPath:l?.toLowerCase(),...a!==null&&{sortOption:a??this.props.selectedSortOptionId}})}buildBreadcrumbLinks(){const{rootBreadcrumb:t,isDefaultSortOrderEnabled:n}=this.props,o=[];return t&&o.push(t),o.push(...this.props.breadcrumb.map(r=>({id:r.id,name:r.name,retailerCategoryId:r.retailerCategoryId,url:this.buildUrl({category:r.id,fullURLPath:r.fullURLPath,sortOption:n?null:this.props.selectedSortOptionId,retailerCategoryId:r.retailerCategoryId})}))),o}hasNoProducts(){return!this.props.products.length&&this.props.catalogueLastUpdated&&this.props.totalProducts===0}getCategoryRootLinks(){const{category:t}=this.state;return t&&this.props.categoryRootLinks?this.props.categoryRootLinks:void 0}shouldShowRefineSortAndFilters(){const{showCategoryRefineGroupOnly:t,hideFilterBar:n,filtersFromQueryString:o,products:r}=this.props,a=!!Object.keys(o).length;return!t&&!n&&(a||!!r.length)}shouldCataloguePageShowFetching(){return!this.props.isServerRendered&&this.props.isCatalogueFetching}renderScrollToTopButton(){return s.jsx(See,{className:"salt-m-y--4",focusElement:"#main-header-logo"})}handleFopVisibiltyChange(t){const{products:n,nextPageToken:o,totalProducts:r,handleFopVisibiltyChange:a}=this.props;a?.({fops:t,category:this.state.category,nextPageToken:o,totalProductsDecorated:n.length,totalProducts:r})}handleFetchNextPage(){const{fetchNextPage:t}=this.props;return t?t({category:this.state.category,nextPageToken:this.props.nextPageToken}):Promise.resolve()}renderProductsPage(){const{breadcrumb:t,rootBreadcrumb:n,fopControlsFactory:o,additionalNavigableContentFactory:r,hideBreadcrumb:a,page:i,withoutHeader:l}=this.props,c=n?[n,...t]:[...t],d=c.length>0?c.map(p=>p.name).join(" > "):null,u=a&&!(i==="logged-in-homepage"||i==="logged-out-homepage");return s.jsxs("div",{"data-test":"products-page",id:"product-page",...u?{className:"salt-m-t--4"}:{},children:[s.jsx(LTt,{products:this.props.products,seoReadableLinks:this.props.isSEOReadableURLEnabled}),s.jsx(DS,{page:this.props.page,pageKey:this.state.pageKey,sizes:["SMALL","MEDIUM"]}),s.jsxs(PTt,{additionalNavigableContentFactory:r,categoryRootLinks:this.getCategoryRootLinks(),showCategoryRefineGroupOnly:this.props.showCategoryRefineGroupOnly,categories:this.props.categories,buildUrl:this.buildUrl,showRefineSortFilters:this.shouldShowRefineSortAndFilters(),refine:{onOpen:()=>{this.props.actions.sendAnalyticsEvent({type:ht.OPEN_MENU,menu:"REFINE"})}},changeQuerystringLocation:this.changeQuerystringLocation,selectedSortOptionId:this.props.selectedSortOptionId,showSortAndFilters:this.props.showSortAndFilters,children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx(DS,{page:this.props.page,pageKey:this.state.pageKey,sizes:["LARGE"]}),this.props.page==="regulars"&&s.jsx(avt,{page:this.props.page,onInitialFopLoad:this.props.onInitialFopLoad,rankingScoreByProductId:this.props.rankingScoreByProductId}),this.props.isNewProductListEnabled&&this.props.isConfigurableFopEnabled?s.jsx(Dvt,{productGroups:this.props.productGroups,productsByProductId:this.props.productsByProductId,page:this.props.page,type:"catalogue",isFetching:this.shouldCataloguePageShowFetching(),productCardAdvertsToInsert:this.props.withinGridProductCards,loadMoreProducts:this.props.fetchNextPage&&this.handleFetchNextPage,hasMoreProducts:!!this.props.nextPageToken,onInitialProductsRendered:this.props.onInitialFopLoad,withoutHeader:l}):s.jsxs(h.Fragment,{children:[s.jsx(uo,{hideTopBorder:!this.props.hideFilterBar,productGroups:this.props.productGroups,productsByProductId:this.props.productsByProductId,page:this.props.page,type:"catalogue",isFetching:this.shouldCataloguePageShowFetching(),isNextPageFetching:this.props.isNextCataloguePageFetching,onInitialFopLoad:this.props.onInitialFopLoad,renderInitial:()=>s.jsx(Pk,{page:this.props.page}),rankingScoreByProductId:this.props.rankingScoreByProductId,breadcrumbValue:d,onFopVisibilityChange:this.props.handleFopVisibiltyChange&&this.handleFopVisibiltyChange,fopControlsFactory:o,hideMoreOptions:!this.props.isUserLoggedIn,withinGridProductCards:this.props.withinGridProductCards,infiniteScrollScrollableElementRef:this.fopContainerElementRef,withoutHeader:l}),i==="categories"?s.jsx(Cee,{}):null]}),this.props.shouldShowScrollToTopButton&&this.renderScrollToTopButton()]})]})}renderPages(){return this.hasNoProducts()&&!this.shouldCataloguePageShowFetching()?Object.keys(this.props.filtersFromQueryString).length?this.props.noProductsFilteredPage?.({term:this.props.breadcrumb[0]&&this.props.breadcrumb[0].name,clearFilters:()=>this.changeQuerystringLocation({filters:{}})}):this.props.noProductsPage?.({term:this.props.breadcrumb[0]&&this.props.breadcrumb[0].name}):this.renderProductsPage()}isCategoryBreadcrumbInURLCorrect(){const{location:t,breadcrumbFullURLPath:n}=this.props;return bo(n).toLowerCase()===t.pathname.toLowerCase()}sendSelectCategoryEvent(t){const{sendAnalyticsEvent:n}=this.props.actions;if(t.retailerCategoryId){n({type:rn.SELECT_CATEGORY_GA4_EVENT,location:"breadcrumb",categoryName:t.name,retailerCategoryId:t.retailerCategoryId});const o={event:"select_category",id:t.retailerCategoryId,location:"breadcrumb",name:t.name?.toString()||""};te.sendEvent({GA:o,WA:null})}}render(){const{pageError:t,isSEOReadableURLEnabled:n,breadcrumbFullURLPath:o,location:r,page:a,categoryId:i,smartSearchSuggestionsFFEnabled:l}=this.props,{isNoIndexPage:c}=this.state;if(!this.props.isCatalogueFetching){if(t)return t.statusCode===Go.NOT_FOUND?s.jsx(ot,{}):s.jsx(jn,{showRefreshLink:!0,statusCode:t.statusCode});const u=Qe.parse(r.search);if(n&&a==="categories"&&u.sublocationId===i&&!this.isCategoryBreadcrumbInURLCorrect()){const p=o?.toLowerCase(),g=bo(p,{queryString:r.search.replace("?","")});return s.jsx(En,{to:g})}}const d=l&&a==="search";return s.jsxs(h.Fragment,{children:[c&&s.jsx(Gn,{children:s.jsx("meta",{name:"robots",content:"noindex"})}),!this.props.hideBreadcrumb&&s.jsxs(sn,{id:"products-page-breadcrumb",children:[s.jsx(ZJ,{breadcrumbs:this.buildBreadcrumbLinks()}),s.jsx(rm,{className:`${this.props.breadcrumbSubtitle?"salt-m-b--2":""} ${this.props.breadcrumbSubtitle?"lg:salt-m-b--2":"lg:salt-m-b--1"}`,preface:this.props.breadcrumbPreface,trail:this.buildBreadcrumbLinks(),linkElement:Ye,onClick:this.sendSelectCategoryEvent,"data-test":"products-page-breadcrumb-list"}),this.props.breadcrumbSubtitle&&s.jsx("div",{className:"salt-m-b--1",children:this.props.breadcrumbSubtitle})]}),!this.props.hideGtmTarget&&s.jsx(vu,{targetName:yc.LWCD}),d&&s.jsx(Vvt,{},Qe.parse(r.search).q?.toString()),this.props.belowBreadcrumbContentFactory&&this.props.belowBreadcrumbContentFactory(),this.renderPages()]})}}const GTt=(e,t)=>{const n=t.page==="regulars";return{breadcrumb:au(e),categories:t.categories?t.categories:nge(e),filters:aE(e),sortOptions:aD(e),filtersFromQueryString:Xp(e),isCatalogueFetching:ege(e),categoryId:tge(e),retailerCategoryId:sge(e),catalogueLastUpdated:x2(e),breadcrumbFullURLPath:rD(e),products:Jhe(e),productsByProductId:n?s8e(e):mo(e),productGroups:n?n8e(e):b2(e),selectedSortOptionId:cD(e),totalProducts:iD(e),lastFetchedCatalogueLocation:lD(e),isServerRendered:Rt(e),pageViewId:Nn(e),rankingScoreByProductId:A2(e),isSEOReadableURLEnabled:jTt(e),nextPageToken:rge(e),isNextCataloguePageFetching:rE(e),isDefaultSortOrderEnabled:MTt(e),smartSearchSuggestionsFFEnabled:BTt(e),isConfigurableFopEnabled:wTt(e),isNewProductListEnabled:FTt(e),isUserLoggedIn:Xe(e),isRegionAgnosticEnabled:kTt(e),searchQuery:Qp(e)}},$Tt=e=>({actions:vl({sendAnalyticsEvent:U.analyticsEvent,setLastFetchedLocation:yt.setLastFetchedCatalogueLocation},e)}),Vm=Tt(Ht,we(GTt,$Tt))(UTt),yf=({clearFilters:e,page:t,term:n})=>{const o=ft(),r=f(Xp);h.useEffect(()=>{o({type:ht.NO_FILTERED_RESULTS_RETURNED,filtersFromQueryString:r,term:n});const i={event:"event",eventAction:"NoFilteredResults",eventCategory:"Catalogue",eventLabel:n};te.sendEvent({GA:i,WA:null})},[]);const a=()=>{o({type:ht.NO_FILTERED_RESULTS_RETURNED_CLEAR_FILTERS_BUTTON_CLICKED,filtersFromQueryString:r,term:n});const i={event:"event",eventAction:"NoFilteredResultsClearFiltersClicked",eventCategory:"Catalogue",eventLabel:n};te.sendEvent({GA:i,WA:null}),e()};return s.jsxs(h.Fragment,{children:[s.jsx(DS,{page:t,pageKey:n,sizes:["LARGE","MEDIUM","SMALL"],isNoProductsPage:!0}),s.jsx("div",{className:"salt-m-y--16",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{titleIcon:"info_default",title:"catalogue.no.results.filtered.title",titleAs:"h2",primaryButton:{text:"catalogue.no.results.filtered.clear.filters",onClick:a}})})})})]})},HTt=()=>s.jsx(V,{fixed:!0,className:"salt-m-y--16",children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:"favourites",title:"favorites.no.results.title",titleAs:"h2",description:"favorites.no.results.text",gtmTargetNameKey:"AWCV",primaryButton:{text:"favorites.no.results.open.navigation",to:"/products"}})})}),E0=({category:e=void 0,sortOption:t=void 0,filters:n={}}={})=>`/favorites?${nE({category:e,filters:n,sortOption:t})}`,VTt=D("bt.top"),WTt=()=>{const e=L(),t=Ne(),n=Ge(),o=F(),r=f(zp),i=f(oD)===0,l=f(VTt),c=ff(),d=()=>i?void 0:{name:e.formatMessage({id:"favorites.title"}),url:E0()},u=f(rE),p=({category:y,filters:I,sortOption:S})=>(o(QT()),o(AA({category:y,filters:I,sortOption:S}))),g=({category:y,nextPageToken:I})=>o(AA({category:y,pageToken:I})).then(S=>{!u&&S&&S.nextPageToken&&S.productCount===0&&g({category:y,nextPageToken:S.nextPageToken})}),E=h.useCallback(()=>{o(ds({name:Xxe}))},[o]);return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"favorites.title"}),s.jsx(ie,{asChild:!0,children:s.jsx("h1",{children:e.formatMessage({id:"favorites.title"})})}),s.jsx(Vm,{pageError:r,navigate:n,fetchPage:p,page:"favorites",rootBreadcrumb:d(),hideBreadcrumb:i,getTargetUrl:E0,location:t,onInitialFopLoad:E,noProductsPage:()=>s.jsx(HTt,{}),noProductsFilteredPage:({clearFilters:y,term:I})=>s.jsx(yf,{clearFilters:y,page:"favorites",term:I}),showSortAndFilters:!0,fetchNextPage:g,shouldShowScrollToTopButton:l?!1:c}),l&&s.jsx(Du,{})]})},Lee=()=>s.jsx(Et,{type:"Favorites::route",children:s.jsx(zT,{activeTab:pa.FAVORITES,children:s.jsx(WTt,{})})});Lee.fetchData=async({context:{store:e,url:t}})=>{const n=t.searchParams.get("sublocationId")??"",o=t.searchParams.get("sortBy")??"",r=At(e.getState()),a=Yp(ps.parse(t.search)),i=AA({category:n,filters:a,sortOption:o}),l=`${t.pathname}${t.search}`,c=r?.length?l.replace(r,""):l;await Promise.all([e.dispatch(i),e.dispatch(yt.setLastFetchedCatalogueLocation(c)),e.dispatch(QT())])};const YTt={PROMOTIONS:{path:di(),titleKey:"promotions.tab"},COUPONS:{path:zE(),titleKey:"coupons.tab"}},kee=({tabs:e=YTt,activeTabType:t,onTabClick:n})=>{const o=L();return s.jsx(Kr,{highlightedId:t,className:"salt-m-t--8 salt-m-b--2",children:Object.entries(e).map(([r,a])=>{const i=r===t;return s.jsx(Kr.Link,{id:r,to:i?void 0:qTt(a.path),onClick:()=>n&&n(r),children:o.formatMessage(a.titleKey)},r)})})},qTt=e=>({...Js(e),search:"?source=tabs"}),KTt=se("GET_PROMOTIONS_PAGE_ADVERTS"),jee=()=>({type:"API",payload:{url:"/v1/content?page=PROMOTIONS",...KTt}}),zTt={landscape:{promotion:{numberOfLines:1,compress:!1},title:{numberOfLines:1},controlsContainer:{position:"priceLine",style:"small"},image:{resolution:{height:88,width:88}},packSize:null,countryOfOrigin:null,bottomAttributes:null,unitPrice:null,price:{direction:"column"}}},QTt=(e="")=>e.charAt(0).toUpperCase()+e.slice(1),XTt=({page:e})=>{const t=f(D("so.pro.micro")),n=f(Ol),o=f(m6e),r=f(Xe),a=F(),l=t?zTt:{landscape:{promotion:{compress:!1}}};h.useEffect(()=>{!n.isFetching&&!n.lastUpdated&&!n.fetchError&&r&&a(xs.getCurrentCustomer())},[n]);const{formatMessage:c}=L(),d={loggedInTitle:c("shopper.optimisations.logged.in.recommendations.carousel.title",{name:QTt(n?.data?.moniker)}),loggedOutTitle:c("shopper.optimisations.logged.out.recommendations.carousel.title")},u=!o.lastUpdated,g=(()=>{if(u){const{products:y,group:I}=qT("inspiration_carousel");return gl(y,I)}if(o.data){const y=o.data.products.map(C=>C.productId),I=kp({productIds:y,title:r?d.loggedInTitle:d.loggedOutTitle,productType:"inspiration_carousel"}),S={recommendationId:o.data.recommendationId};return gl(y,I,S)}return[]})();if(!u&&!g.length||o.fetchError)return null;const E=n.lastUpdated?s.jsxs("div",{className:"salt-d--flex",children:[s.jsx(pe,{name:"genie",className:"salt-m-r--2"}),s.jsx(ee,{as:"h2",children:d.loggedInTitle})]}):s.jsx(_e,{width:"10%",height:"30px"});return s.jsx("div",{className:"salt-p-t--2 salt-p-b--4","data-test":"recommended-products-carousel",children:s.jsx(pf,{overrideConfig:l,products:g,titleElement:r?E:d.loggedOutTitle,a11yTitleText:r?d.loggedInTitle:d.loggedOutTitle,loading:u,page:e})})},f0=D("pql.promo"),y0=D("seo.rdbl"),I0=D("di"),ZTt=(e,t,n,o)=>(r,a)=>{const i=a(),l=D("di"),c=Hn(i);return r(yi.getPromotionDetails(e,t,l(i),c,n,o)).then(d=>{if(!d)return;const u=IN(d.payload.responseData,l(i),c),{entities:p,result:{missedPromotions:g}}=u;for(const E in p.product)p.product[E]===void 0&&delete p.product[E];return p&&r(xt.setProducts(p)),g?.length&&r(fo.addMissedPromotions(g)),u})},NA=({category:e,filters:t={},sortOption:n,pageToken:o,isRetailerCategoryId:r})=>(a,i)=>{const l=i();return a(f0(l)?yi.getPQLPromotionsPage({imageFormats:Hn(l)??[],isSEOReadableURLEnabled:y0(l),isDynamicImagesEnabled:I0(l)},e,t,n,o,r):yi.getPromotionsPage(e,t,n,o,r)).then(c=>{if(!c)return;let{payload:{responseData:d}}=c;f0(l)&&(d=Bx(d,Hn(l)??[],y0(l),I0(l)));const{entities:u,result:{missedPromotions:p,nextPageToken:g,productGroups:E,breadcrumbs:y,retailerCategoryId:I}}=d;for(const S in u.product)u.product[S]===void 0&&delete u.product[S];return a(xt.setProducts(u)),p?.length&&a(fo.addMissedPromotions(p)),{nextPageToken:g,productCount:qp(E).length,breadcrumbs:y,retailerCategoryId:I}})},Mee={getPromotionDetails:ZTt},JTt=()=>{const e=F(),t=Ge(),n=f(Ms);h.useEffect(()=>{e(U.analyticsEvent({type:Va.PROMOTIONS_NO_RESULTS,locale:n}))},[]);const o=()=>{t(fn())};return s.jsx(V,{fixed:!0,className:"salt-m-y--16",children:s.jsx(V.Item,{colStart:{sm:3,md:4,lg:5},colSpan:{xs:12,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:"promotion",title:"promotions.no.results.title",titleAs:"h2",description:"promotions.no.results.subtext",primaryButton:{text:"promotions.no.results.open.navigation",onClick:o}})})})},wee=e=>{if(e==="promotions")return{};const n=(e?.endsWith("/")?e.slice(0,-1):e)?.split("/")??[],o=n.pop();return{sublocationId:o?.length?o:void 0,fullCataloguePath:n.length?n.join("/"):void 0}},LA=D("seo.rdbl"),kA=D("seo.ra"),e_t=D("cp"),t_t=D("so.promotion"),s_t=D("bt.top"),n_t=()=>{const e=F(),t=L(),n=Ne(),o=Ge(),r=nn(),{sublocationId:a}=wee(r["*"]),i=f(zp),l=f(rE),c=f(Zd),d=f(oD),u=f(LA),p=f(kA),g=f(e_t),E=f(t_t),y=f(s_t),I=ff(),S=()=>{E&&e(d6e())};h.useEffect(()=>{S()},[]);const C=j=>{j==="COUPONS"&&e(U.analyticsEvent({type:Va.COUPONS_TAB_CLICKED}))},T=j=>u?a:j.sublocationId,_=()=>{e(ds({name:lAe}))},A=()=>{const j=t.formatMessage("page.seo.heading",{tagline:t.formatMessage("promotions.page.seo.header.tagline"),separator:" ",name:c});if(!(d===0&&g))return{name:j,url:R()}},R=({category:j=void 0,sortOption:G=void 0,filters:W={},fullURLPath:H=""}={})=>{const K=nE({...!u&&{category:j},filters:W,sortOption:G});return u?Nh(j,H,{queryString:K}):di(void 0,{queryString:K})},P=()=>[{name:t.formatMessage({id:"promotions.category.root.name"}),url:R()}],N=({category:j,nextPageToken:G})=>e(NA({category:j,pageToken:G})).then(W=>{!l&&W&&W.nextPageToken&&W.productCount===0&&N({category:j,nextPageToken:W.nextPageToken})}),k=({fops:j,category:G,nextPageToken:W,totalProductsDecorated:H,totalProducts:K})=>{e(ai({products:j,updateProducts:!0})),!l&&W&&H>=K-Yv*.2&&N({category:G,nextPageToken:W})},M=({category:j,filters:G,sortOption:W})=>(e(jee()).catch(H=>{Ue.api.pushError(H)}),e(NA({category:j,filters:G,isRetailerCategoryId:p,sortOption:W})).catch(H=>{Ue.api.pushError(H)})),w=()=>E&&!a?s.jsx(XTt,{page:"promotions"}):null;return s.jsxs(h.Fragment,{children:[g&&s.jsx(kee,{activeTabType:"PROMOTIONS",onTabClick:j=>C(j)}),s.jsx(bt,{title:"promotions.title",seoFriendlyMeta:{metaDescriptionTagline:"promotions.meta.descriptionTagline",pageDescription:t.formatMessage("promotions.title")}}),g&&s.jsx(ie,{asChild:!0,children:s.jsx("h1",{children:t.formatMessage({id:"promotions.title"})})}),s.jsx(Vm,{navigate:o,showSortAndFilters:!0,categoryRootLinks:P(),fetchPage:M,page:"promotions",rootBreadcrumb:A(),hideBreadcrumb:g?d===0:!1,belowBreadcrumbContentFactory:w,getTargetUrl:j=>R(j),location:n,onInitialFopLoad:_,noProductsPage:()=>s.jsx(JTt,{}),noProductsFilteredPage:({clearFilters:j,term:G})=>s.jsx(yf,{clearFilters:j,page:"promotions",term:G}),handleFopVisibiltyChange:k,shouldShowScrollToTopButton:y?!1:I,pageError:i,matchSublocationId:T,enableRegionAgnosticCategoriesPerSection:!0,fetchNextPage:N}),y&&s.jsx(Du,{})]})},jA=()=>s.jsx(Et,{type:"Promotions::route",children:s.jsx(n_t,{})});jA.fetchData=async({store:e,params:t,req:n})=>{const o=e.getState(),{sublocationId:r}=n.query,a=wee(t["*"]),i=r||a?.sublocationId,l=decodeURIComponent(n.url),c=l.split("?")[1],d=At(o),u=r?Fx(n.query):c,{sortBy:p}=n.query,g=Yp(n.query)||{};if(kA(o)){await e.dispatch(yt.getCategoryEntity({queryString:`id=${i}`}));const I=R2(e.getState());if(I?.id&&i!==I?.retailerId){const S={queryString:u,basePath:d},C=I?.retailerId;return{redirectTo:LA(o)?Nh(C,I?.encodedName?.toLowerCase(),S):di(C,S),statusCode:Go.MOVED_PERMANENTLY}}}const E=[e.dispatch(NA({category:i,sortOption:p,filters:g,isRetailerCategoryId:kA(o)})).then(()=>{e.dispatch(yt.setLastFetchedCatalogueLocation(n.originalUrl))}),e.dispatch(jee())];await Promise.all(E);const y=zp(e.getState());if(LA(o)&&!y){const I=rD(e.getState())?.toLowerCase(),S=Nh(i,I,{queryString:u});if(l.toLowerCase()!==S.toLowerCase())return{redirectTo:Nh(i,I,{queryString:u,basePath:d}),statusCode:Go.MOVED_PERMANENTLY}}};const o_t=({rootpageTitle:e,subpageTitle:t,seoFriendlyMeta:n})=>{const o=f(au),r=L(),i=o&&o.length>0?[...o].pop().name:null,l=i?t:e,c=o&&o[0]?.name||r.formatMessage("search.categories.title"),d=()=>c===i?c:i?`${c}${r.formatMessage("page.title.separator")}${i}`:c,u={metaDescriptionTagline:c===i?n?.metaDescriptionTagline:n?.metaSubDescriptionTagline,pageDescription:d()};return s.jsx(bt,{title:l,seoFriendlyMeta:u,values:i?{subPageName:i,rootCategoryName:c,separator:r.formatMessage("page.title.separator"),rootPageName:r.formatMessage(e)}:void 0})},r_t=()=>{let e=[],t="";const n=ft(),o=f(u=>Nn(u)),{formatMessage:r}=L(),[a]=Ee(["seo.rdbl"]),i=f(pN),l=f(Ms),c=F();i&&(e=i.refined.slice(0,5),t=i.searchTermFromQueryParam);const d=(u,p)=>{n({type:Cs.SEARCH_SUGGESTION_CLICKED,id:ct(),userInput:t,searchSuggestion:u,positionInSuggestionList:p,locale:l,suggestionsCount:e.length,suggestionType:"REFINED_SEARCH_SUGGESTION",location:"NO_RESULTS",pageViewId:o}),n({type:Cs.SELECT_SEARCH_SUGGESTION,searchSuggestion:u,suggestionIndex:p,suggestionType:"refined",location:"NO_RESULTS"})};return h.useEffect(()=>{e.length&&c(U.analyticsEvent({pageViewId:o,type:Cs.SEARCH_SUGGESTION_IMPRESSION,searchSuggestionImpressions:e.map((u,p)=>({sequence:p,searchSuggestionType:"REFINED_SEARCH_SUGGESTION",location:"NO_RESULTS",searchTerm:u}))}))},[]),s.jsxs(Q,{direction:"column",gap:["md"],children:[s.jsxs(Q,{gap:["sm"],wrap:"nowrap",align:"center",children:[s.jsx(pe,{name:"search"}),s.jsx(ee,{as:"h2",children:r("search.no.results.suggestion.title",{title:t})})]}),s.jsx(O,{size:"l",children:r("search.no.results.suggestion.title.subtext")}),s.jsx(Q,{gap:["sm"],align:"center",justify:"flex-start","data-test":"suggestion-search-list",children:e.length>0?e.map((u,p)=>s.jsx(bee,{a11yLabel:r("smart.search.ribbon.refined.accessibility.button.label",{searchTerm:u}),href:Za(a,{queryString:`q=${u}`}),term:u,source:"REFINED_SEARCH_SUGGESTION",handleSuggestionClick:()=>d(u,p)},u)):s.jsx(x,{asChild:!0,intent:"primary",fill:!0,children:s.jsx(Ye,{intent:"ghost",href:bo(),children:s.jsx(x.Text,{children:r("catalogue.no.results.open.navigation")})})})})]})},Fk=({page:e,term:t,icon:n="info_default",subtext:o=""})=>{const r=Ge(),a=f(Ms),i=ft(),[l]=Ee(["sss"]),{smartSearchSuggestions:c,isFetching:d,lastUpdated:u}=f(a6),p=l&&e==="search"&&c?.refined.length;h.useEffect(()=>{i({type:ht.CATALOGUE_NO_RESULTS,term:t,locale:a});const y={event:"event",eventAction:"NoResults",eventCategory:"Catalogue",eventLabel:t};te.sendEvent({GA:y,WA:null}),i({type:ht.SEARCH_NO_RESULTS,term:t});const I={event:"search_no_results",search_term:t};te.sendEvent({GA:I,WA:null})},[]);const g=()=>{i({type:ht.CATALOGUE_NO_RESULTS_BROWSE_CLICKED,term:t,locale:a});const y={event:"event",eventAction:"NoResultsBrowseClicked",eventCategory:"Catalogue",eventLabel:t};te.sendEvent({GA:y,WA:null}),r(bo())};return l&&(d||!u)?null:s.jsxs(h.Fragment,{children:[s.jsx(DS,{page:e,pageKey:t,sizes:["LARGE","MEDIUM","SMALL"],isNoProductsPage:!0}),s.jsx("div",{className:"salt-m-y--16",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:p?s.jsx(r_t,{}):s.jsx(Os,{title:"catalogue.no.results.title",titleAs:"h2",titleIcon:n,description:o,primaryButton:{text:"catalogue.no.results.open.navigation",onClick:g}})})})})]})},a_t=1e4,i_t=3,Qc=16,l_t={headlineText:m.string,headlineColor:m.string,alt:m.string.isRequired,images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired})).isRequired,dataTest:m.string,headlineDataTest:m.string},c_t={headlineText:void 0,headlineColor:"#000000",dataTest:void 0,headlineDataTest:void 0},kb=e=>e/i_t,vy=(e,t,n)=>{const o=e.find(a=>kb(a.width)>=t&&kb(a.width)<n);if(!o)return"display: none;";const r=kb(o.height);return`
        display: block;
        background-image: url(${o.url});
        height: ${$(r)};
        background-size: auto ${r}px;
    `},Fee=v.div.withConfig({shouldForwardProp:e=>!["width","images","href"].includes(e)})`
    position: relative;
    background-color: var(--intent-secondary-100);
    background-repeat: no-repeat;
    background-position: center;
    inline-size: ${({width:e})=>e};
    border-radius: var(--salt-radius-default);

    ${({images:e})=>vy(e,Ke.xs*Qc,Ke.sm*Qc)}

    ${re.smUp`
        ${({images:e})=>vy(e,Ke.sm*Qc,Ke.md*Qc)}
    `}

    ${re.mdUp`
        ${({images:e})=>vy(e,Ke.md*Qc,Ke.lg*Qc)}
    `}

    ${re.lgUp`
        ${({images:e})=>vy(e,Ke.lg*Qc,a_t)}
    `};
`,d_t=v.span.withConfig({shouldForwardProp:e=>!["headlineColor","width","images","href"].includes(e)})`
    font-size: var(--salt-display-font-size);
    font-weight: 600;
    color: ${({headlineColor:e})=>e};
    position: absolute;
    inset-block-end: var(--salt-spacing-8);
    inset-inline-start: var(--salt-spacing-8);
`,If=({images:e,headlineText:t,headlineColor:n,alt:o,dataTest:r,headlineDataTest:a})=>s.jsxs(Fee,{images:e,"data-test":r,children:[s.jsx(ie,{children:o}),t&&t.length>0&&s.jsx(d_t,{"data-test":a,headlineColor:n,children:t})]});If.propTypes=l_t;If.defaultProps=c_t;If.HorizontalHeroBackground=Fee;const Bee=()=>{const e=F(),t=h.useCallback(a=>{e(U.analyticsEvent({type:rn.HORIZONTAL_HERO_BANNER_IMPRESSION,...a}));const i={ecommType:"enhanced",event:"view_promotion",eventCategory:"Event page",eventAction:"HERO_IMAGE_BANNER_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Category Event",id:a.id,name:a.name,creative:a.imageId,position:"Hero Image"}]}}};te.sendEvent({GA:i,WA:null})},[e]),n=h.useCallback(a=>{e(U.analyticsEvent({type:rn.SUB_CATEGORY_IMAGE_IMPRESSION,...a}));const i={ecommType:"enhanced",event:"view_promotion",eventCategory:"Event page",eventAction:"SUB_CATEGORY_IMAGE_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Category Event",id:a.id,name:a.subCategoryName,creative:a.imageId,position:`Sub category image ${a.sequence}`}]}}};te.sendEvent({GA:i,WA:null})},[e]),o=h.useCallback(a=>{e(U.analyticsEvent({type:rn.SUB_CATEGORY_IMAGE_CLICKED,...a}));const i={ecommType:"enhanced",event:"select_promotion",eventCategory:"Event page",eventAction:"SUB_CATEGORY_IMAGE_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"Category Event",id:a.id,name:a.subCategoryName,creative:a.imageId,position:`Sub category image ${a.sequence}`}]}}};te.sendEvent({GA:i,WA:null})},[e]),r=h.useCallback(a=>{e(U.analyticsEvent({type:rn.SHOP_IN_SHOP_CATEGORY_PAGE_VIEW,...a}));const i={event:"view_shop_in_shop",name:a.name,id:a.id,type:a.pageType};te.sendEvent({GA:i,WA:null})},[e]);return{reportHorizontalHeroImpression:t,reportSubCategoryImpression:n,reportSubCategoryClick:o,reportPageView:r}},u_t={id:m.string.isRequired,label:m.string,name:m.string.isRequired,categoryId:m.string,categoryName:m.string,images:m.shape({hero:m.shape({id:m.string.isRequired,name:m.string,headline:m.string,headlineHexColour:m.string,altText:m.string,contentType:m.string,images:m.arrayOf(m.shape({url:m.string,width:m.number.isRequired,height:m.number.isRequired})).isRequired}).isRequired,subCategories:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired,label:m.string.isRequired,altText:m.string.isRequired,contentType:m.string,images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired})).isRequired,target:m.oneOfType([m.shape({linkType:m.string,openInNewTab:m.bool,ids:m.array}),m.shape({linkType:m.string,openInNewTab:m.bool,values:m.array})]).isRequired})).isRequired})},p_t={reportImpression:m.func.isRequired,children:m.element.isRequired},m_t={children:void 0,reportImpression:void 0},Bk=({reportImpression:e,children:t})=>{const n=TE(e);return s.jsx("div",{ref:n,"data-test":"sis-sub-category",children:t})};Bk.propTypes=p_t;Bk.defaultProps=m_t;const h_t=e=>e?.startsWith("/")&&!e.includes("source=")?e.includes("?")?`${e}&source=SUB_CATEGORY_IMAGE_CLICKED`:`${e}?source=SUB_CATEGORY_IMAGE_CLICKED`:e,g_t=(e,{isSEOReadableURLEnabled:t})=>{if(e)return h_t(Aa.calculateLegacyTargetUrl(e,{isSEOReadableURLEnabled:t}))},E_t=e=>e.openInNewTab?"_blank":void 0,jb=e=>e?e.substring(e.lastIndexOf("/")+1):"",Uk=({id:e,name:t,label:n,images:o,categoryId:r,categoryName:a})=>{const i=Bee();h.useEffect(()=>{i.reportPageView({event:"view_shop_in_shop",name:t??"",id:e,pageType:"category"})},[]),h.useEffect(()=>{i.reportHorizontalHeroImpression({id:e??"",name:t??"",categoryId:r??"",categoryName:a??"",imageId:o?.hero?.images[0]?.url?jb(o?.hero?.images[0]?.url):"",eventId:e,eventHeadline:o?.hero?.headline??""})},[e,o]);const[l]=Ee(["seo.rdbl"]),c=h.useRef([]),d=h.useCallback(({parentCategoryId:E,imageId:y,subCategoryId:I,subCategoryName:S,subCategoryLabel:C,value:T,linkType:_,sequence:A})=>{i.reportSubCategoryClick({id:e??"",parentCategoryId:E,subCategoryId:I,subCategoryName:S,subCategoryLabel:C,value:T,linkType:_,imageId:y,sequence:A?.toString(),event:"shop_in_shop_navigation",pageType:"category"})},[]),u=h.useCallback(({imageId:E,subCategoryId:y,subCategoryName:I,subCategoryLabel:S,sequence:C})=>{c.current.includes(C)||(c.current.push(C),i.reportSubCategoryImpression({id:e??"",categoryId:r??"",categoryName:a??"",imageId:E,subCategoryId:y,subCategoryName:I,subCategoryLabel:S,sequence:C?.toString()}))},[r,a]);if(!o)return null;const{hero:p,subCategories:g}=o;return s.jsxs("div",{className:"salt-m-x--4",children:[s.jsx("div",{className:"salt-m-y--4",children:n&&s.jsx(ee,{as:"h1","ata-test":"sis-label",children:n})}),p&&s.jsx("div",{className:"salt-m-b--4",children:s.jsx(If,{images:p.images,headlineText:p.headline,headlineColor:p.headlineHexColour,alt:p.altText??"",dataTest:"category-event-hero",headlineDataTest:"sis-hero-headline"})}),g&&s.jsx(Oe.MediaCardCollection,{formatting:"normal",gridVariant:"auto-fill",children:g.map((E,y)=>{const I=g_t(E?.target,{isSEOReadableURLEnabled:l}),S=E_t(E?.target);return s.jsx(Bk,{reportImpression:()=>u({imageId:E?.images[0]?.url?jb(E?.images[0]?.url):"",subCategoryId:E?.id??"",subCategoryName:E?.name??"",sequence:y.toString(),subCategoryLabel:E?.label??""}),children:s.jsx(Oe.MediaNavigationCard,{variant:"fullImage",formatting:"normal",src:E?.images[0]?.url??"",alt:E?.altText,title:E?.label,href:I,target:S,titleDataTest:"sis-sub-category-label",onClick:()=>{d({parentCategoryId:r??"",subCategoryId:E?.id??"",subCategoryName:E?.name??"",imageId:E?.images[0]?.url?jb(E?.images[0]?.url):"",linkType:E?.target.linkType??"",subCategoryLabel:E?.label??"",value:I,sequence:y.toString()})}})},E?.id??y)})})]})};Uk.propTypes=u_t;Uk.defaultProps={id:"",label:"",images:void 0,categoryId:"",categoryName:""};const f_t={html:""},Uee=({html:e,id:t,name:n})=>{const o=Bee();return h.useEffect(()=>{o.reportPageView({event:"view_shop_in_shop",name:n,id:t,pageType:"category"})},[]),e?s.jsx("div",{className:"salt-m--4",dangerouslySetInnerHTML:{__html:e},"data-test":"html-category-event"}):null};Uee.defaultProps=f_t;const y_t={id:m.string.isRequired,label:m.string,name:m.string,contentFormat:m.string.isRequired,html:m.string,breadCrumbs:m.arrayOf(m.shape({id:m.string,name:m.string})).isRequired,images:m.shape({hero:m.shape({id:m.string,name:m.string,headline:m.string,headlineHexColour:m.string,altText:m.string,contentType:m.string,images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired})).isRequired}).isRequired,subCategories:m.arrayOf(m.shape({id:m.string,name:m.string,label:m.string.isRequired,altText:m.string.isRequired,contentType:m.string,images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired})).isRequired,target:m.oneOfType([m.shape({linkType:m.string,openInNewTab:m.bool,ids:m.array,encodedName:m.string}),m.shape({linkType:m.string,openInNewTab:m.bool,values:m.array,encodedName:m.string})]).isRequired})).isRequired})},I_t={id:"",name:"",label:"",contentFormat:"",html:"",images:void 0,breadCrumbs:void 0},Gk=({id:e,name:t,label:n,contentFormat:o,images:r,html:a,breadCrumbs:i})=>{const l="html",c="images",d=i?i.slice(-1)[0]:void 0;if(!d)return null;switch(o.toLowerCase()){case c:return s.jsx(Uk,{name:t??"",label:n??"",images:r,id:e,categoryId:d?.id,categoryName:d?.name});case l:return s.jsx(Uee,{html:a,id:e,name:t??""});default:return null}};Gk.propTypes=y_t;Gk.defaultProps=I_t;const S0=e=>{const{ITEM_ID:t,ITEM_NAME:n,SEQUENCE:o,SEQUENCE_OF_ITEM_ON_PAGE:r,PAGE_TYPE:a,PAGE_NAME:i,LINK_TYPE:l,LINK_VALUE:c}=e;return i==="homepage"?{id:t,name:n,event:"select_homepage_tile",navigation:"grid",index:o,location:r,link_type:l,target:c}:i==="static_page"?{event:"static_page_navigation",id:t,name:n,navigation:"grid-tile",type:a,index:r,link_type:l,target:c}:i==="shop_in_shop"?{id:t,name:n,event:"shop_in_shop_navigation",navigation:"grid-tile",type:a,index:r,location:null,link_type:l,target:c}:null},ka=()=>{const e=F(),t=h.useCallback(E=>{e({type:Ls.COMPONENTIZED_ATTRIBUTES,payload:E})},[e]),n=h.useCallback(E=>{e({type:Ls.GRID_IMPRESSION,payload:E})},[e]),o=h.useCallback(E=>{e({type:Ls.GRID_ITEM_IMPRESSION,payload:E})},[e]),r=h.useCallback(E=>{e({type:Ls.HORIZONTAL_HERO_BANNER_CLICK,payload:E});const{BANNER_ID:y,BANNER_NAME:I,PAGE_NAME:S,PAGE_TYPE:C,LINK_TYPE:T,TARGET_URL:_,SEQUENCE:A}=E;if(S==="homepage")return;const R={event:`${S}_navigation`,id:y,name:I,navigation:"hero",type:C,index:A,location:null,link_type:T,target:_};te.sendEvent({GA:R,WA:null})},[e]),a=h.useCallback(E=>{e({type:Ls.HORIZONTAL_HERO_BANNER_IMPRESSION,payload:E})},[e]),i=h.useCallback(E=>{e({type:Ls.GRID_ITEM_CLICKED,payload:E});const y=S0(E);y&&te.sendEvent({GA:y,WA:null})},[e]),l=h.useCallback(E=>{e({type:Ls.GRID_ITEM_CLICKED,payload:E});const y=S0(E);y&&te.sendEvent({GA:y,WA:null})},[e]),c=h.useCallback(E=>{e({type:Ls.CAROUSEL_ITEM_CLICKED,payload:E});const{ITEM_ID:y,ITEM_NAME:I,SEQUENCE:S,SEQUENCE_OF_ITEM_ON_PAGE:C,LINK_TYPE:T,LINK_VALUE:_}=E,A={id:y,name:I,event:"select_homepage_tile",navigation:"carousel",index:S,location:C,link_type:T,target:_};te.sendEvent({GA:A,WA:null})},[e]),d=h.useCallback(E=>{e({type:Ls.NAV_MENU_CLICKED,payload:E})},[e]),u=h.useCallback(E=>{e({type:Ls.NAV_ITEM_CLICKED,payload:E});const{ITEM_ID:y,ITEM_NAME:I,LOCATION:S,PAGE_TYPE:C,PAGE_NAME:T,LINK_TYPE:_,LINK_VALUE:A}=E;if(T==="homepage")return;const R={id:y,name:I,event:`${T}_navigation`,navigation:"navigation",type:C,index:null,location:S,link_type:_,target:A};te.sendEvent({GA:R,WA:null})},[e]),p=h.useCallback(E=>{e({type:Ls.RICH_TEXT_IMPRESSION,payload:E})},[e]),g=h.useCallback(E=>{e({type:Ls.RICH_TEXT_LINK_CLICKED,payload:E});const{RICH_TEXT_ID:y,LINK_TYPE:I,LINK_VALUE:S,PAGE_NAME:C,PAGE_TYPE:T,LOCATION:_}=E;if(C==="homepage")return;const A={id:y,name:y,event:`${C}_navigation`,navigation:"link",type:T,index:null,location:_,link_type:I,target:S};te.sendEvent({GA:A,WA:null})},[e]);return{reportComponentizedAttributes:t,reportGridImpression:n,reportGridItemImpression:o,reportHorizontalHeroBannerClicked:r,reportHorizontalHeroBannerImpression:a,reportGridItemClicked:l,reportCarouselItemClicked:c,reportGridLeadImageClicked:i,reportNavigationMenuClicked:d,reportNavigationItemClicked:u,reportRichTextImpression:p,reportRichTextLinkClicked:g}},S_t=(e,t)=>e?.startsWith("/")&&!e.includes("source=")?e.includes("?")?`${e}&source=${t}`:`${e}?source=${t}`:e,Wm=e=>e?.openInNewTab?"_blank":void 0,Bc=(e,t,{isSEOReadableURLEnabled:n})=>{if(e)return S_t(Aa.calculateLegacyTargetUrl(e,{isSEOReadableURLEnabled:n}),t)},C_t=(e,t)=>e.filter(n=>n.componentType===t),v_t=(e,t,n)=>e.slice(0,n+1).filter(r=>r.componentType===t).length-1,Ty={getComponentizedItemsByType:C_t,getSequenceByType:v_t},Gee=({children:e,target:t,source:n,onClick:o=void 0})=>{const[r]=Ee(["seo.rdbl"]);if(!t)return s.jsx(h.Fragment,{children:e});const a=Bc(t,n,{isSEOReadableURLEnabled:r}),i=Wm(t);return s.jsx(tt,{"data-test":`${n}-anchor`,href:a,target:i,...o&&{onClick:()=>o()},children:e})},Uc=(e,t={root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5})=>{const n=h.useRef(null),o=Ev(n,{freezeOnceVisible:!0,...t}),r=h.useMemo(()=>!!o?.isIntersecting,[o]);return h.useEffect(()=>{r&&e()},[r]),n},C0="fm",T_t="w",__t="avif",b_t="webp",tr=(e,t,n=!1)=>{const o=e.find(i=>i.assetSize===t);if(!o)return[];const{url:r,width:a}=o;return[__t,b_t].map(i=>[`${r}?${C0}=${i}&${T_t}=${a/2} ${n?"1x":`${a/2}w`}`,`${r}?${C0}=${i} ${n?"2x":`${a}w`}`].join(","))},x_t=v.div`
    border-radius: var(--salt-radius-default);
    inline-size: 100%;
    aspect-ratio: 2 / 1;
    background-color: var(--intent-secondary-100);

    ${re.smUp`
        aspect-ratio: 4 / 1;
    `}

    ${re.lgUp`
        aspect-ratio: 6 / 1;
    `}
`,A_t=()=>s.jsx(x_t,{className:"salt-m-b--2 md:salt-m-b--4",children:s.jsx(_e,{height:"100%"})}),R_t=v.img`
    border-radius: var(--salt-radius-default);
    display: block;
    inline-size: 100%;
`,D_t=v.picture`
    ${e=>`
        display: ${e.isFetching?"none":"block"};
    `}
    aspect-ratio: 2 / 1;
    ${re.smUp`
        aspect-ratio: 4 / 1;
    `}

    ${re.lgUp`
        aspect-ratio: 6 / 1;
    `}
`,O_t=({data:{images:e,altText:t,id:n,target:o,name:r},meta:a})=>{const i=ka(),[l,c]=h.useState(!0),d=Uc(()=>{const y={ENTRY_ID:a.ENTRY_ID,ENTRY_NAME:a.ENTRY_NAME,HERO_IMAGE_ID:a.HERO_IMAGE_ID,LINK_TYPE:o?.linkType??"",PAGE_TYPE:a.PAGE_TYPE,SEQUENCE:a.SEQUENCE,TARGET_URL:o?.values[0]??"",ENTRY_PUBLISHED_TIMESTAMP:a.ENTRY_PUBLISHED_TIMESTAMP};i.reportHorizontalHeroBannerImpression(y)}),u=()=>{a.LOCATION&&a.BANNER_PLACEMENT&&i.reportHorizontalHeroBannerClicked({BANNER_ID:n,BANNER_NAME:r,CONTENT_SOURCE:"CONTENTFUL",LINK_TYPE:o?.linkType??"",LOCATION:a.LOCATION,PLACEMENT:a.BANNER_PLACEMENT,SEGMENT_ID:"",SEQUENCE:a.SEQUENCE,TARGET_URL:o?.values[0]??"",PAGE_TYPE:a.PAGE_TYPE,PAGE_NAME:a.PAGE_NAME})},p={sm:tr(e,"RATIO_2_1"),md:tr(e,"RATIO_4_1"),lg:tr(e,"RATIO_6_1")},g=e?.find(y=>y.assetSize==="RATIO_2_1")?.url||"",E=()=>{c(!1)};return h.useEffect(()=>{d.current?.complete&&E()},[]),s.jsxs(ae.Fragment,{children:[l&&s.jsx(A_t,{}),s.jsx(Gee,{source:"HERO_IMAGE",target:o,onClick:u,children:s.jsxs(D_t,{isFetching:l,children:[Object.entries(p).map(([y,I])=>{const[S,C]=I;return s.jsxs(ae.Fragment,{children:[s.jsx("source",{media:fl[y],srcSet:S,type:"image/avif"},y),s.jsx("source",{media:fl[y],srcSet:C,type:"image/webp"},y)]},y)}),s.jsx(R_t,{"data-test":`hero-image-${n}`,ref:d,src:g,alt:t,onLoad:E})]})})]})},P_t={lg:"RATIO_4_1",md:"RATIO_4_1",sm:"RATIO_4_1",xs:"RATIO_2_1"},N_t={lg:"RATIO_4_1",md:"RATIO_2_1",sm:"RATIO_4_1",xs:"RATIO_2_1"},L_t={lg:"RATIO_2_1",md:"RATIO_1_1",sm:"RATIO_2_1",xs:"RATIO_1_1"},k_t={lg:"RATIO_4_1",md:"RATIO_2_1",sm:"RATIO_2_1",xs:"RATIO_1_1"},j_t={lg:"RATIO_4_1",md:"RATIO_2_1",sm:"RATIO_2_1",xs:"RATIO_1_1"},M_t={lg:"RATIO_2_1",md:"RATIO_2_1",sm:"RATIO_2_1",xs:"RATIO_1_1"},w_t=e=>{switch(e){case"ITEMS-2__A":return P_t;case"ITEMS-3__A":return N_t;case"ITEMS-4__A":return L_t;case"ITEMS-6__A":return k_t;case"ITEMS-8__A":return j_t;case"ITEMS-9__A":return M_t;default:return null}},F_t=e=>w_t(e),B_t=v.div`
    grid-area: ${e=>e.gridArea};

    .grid-card {
        max-inline-size: none;
        min-inline-size: unset;
        inline-size: 100%;
    }
`,U_t=({data:e,meta:t,gridArea:n})=>{const{tile:o,ratios:r}=e,[a]=Ee(["seo.rdbl"]),i=Bc(o?.target,"GRID_IMAGE",{isSEOReadableURLEnabled:a}),l=Wm(o?.target),c=ka(),d=Uc(()=>c.reportGridItemImpression({...t,LINK_VALUE:i||""})),u={xs:tr(o?.images,r?.xs),sm:tr(o?.images,r?.sm),md:tr(o?.images,r?.md),lg:tr(o?.images,r?.lg)},p=o?.images?.find(E=>E.assetSize===r?.lg)?.url||"",g=()=>{c.reportGridItemClicked({ENTRY_ID:t.ENTRY_ID,ENTRY_NAME:t.ENTRY_NAME,GRID_ID:t.GRID_ID,ITEM_ID:o.id,ITEM_NAME:o.name,ITEM_TYPE:"TILE_IMAGE",LINK_TYPE:o.target?.linkType||"",LINK_VALUE:i||"",PAGE_TYPE:t.PAGE_TYPE,PAGE_NAME:t.PAGE_NAME,SEQUENCE:t.SEQUENCE,SEQUENCE_OF_ITEM_ON_PAGE:t.SEQUENCE_OF_ITEM_ON_PAGE})};return s.jsx(B_t,{"data-test":`grid-tile-${o.id}`,ref:d,gridArea:n,children:s.jsx(Oe.MediaNavigationCard,{className:"grid-card",variant:"fullImage",formatting:"small",dynamicHeight:!0,breakpointSrcSet:u,fallbackSrc:p,isLoading:!p,alt:o?.altText,title:o?.label,content:o?.description,href:i,target:l,onClick:g})})},G_t=(e,t)=>t?t.slice(0,e).map(o=>o.items.length).reduce((o,r)=>+o+ +r,0):0,$_t={getNumberOfPreviousGridTiles:G_t},H_t={"ITEMS-2__A":{xs:`
        "gridTile1"
        "gridTile2"
    `,sm:`
        "gridTile1"
        "gridTile2"
    `,md:`
        "gridTile1 gridTile2"
    `,lg:`
        "gridTile1 gridTile2"
    `},"ITEMS-3__A":{xs:`
        "gridTile1"
        "gridTile2"
        "gridTile3"
    `,sm:`
        "gridTile1"
        "gridTile2"
        "gridTile3"
    `,md:`
        "gridTile1 gridTile2 gridTile3"
    `,lg:`
        "gridTile1 gridTile2 gridTile3"
    `},"ITEMS-4__A":{xs:`
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
    `,sm:`
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
    `,md:`
        "gridTile1 gridTile2 gridTile3 gridTile4"
    `,lg:`
        "gridTile1 gridTile2 gridTile3 gridTile4"
    `},"ITEMS-6__A":{xs:`
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
        "gridTile5 gridTile6"
    `,sm:`
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
        "gridTile5 gridTile6"
    `,md:`
        "gridTile1 gridTile2 gridTile3"
        "gridTile4 gridTile5 gridTile6"
    `,lg:`
        "gridTile1 gridTile2 gridTile3"
        "gridTile4 gridTile5 gridTile6"
    `},"ITEMS-8__A":{xs:`
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
        "gridTile5 gridTile6"
        "gridTile7 gridTile8"
    `,sm:`
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
        "gridTile5 gridTile6"
        "gridTile7 gridTile8"
    `,md:`
        "gridTile1 gridTile2 gridTile3 gridTile4"
        "gridTile5 gridTile6 gridTile7 gridTile8"
    `,lg:`
        "gridTile1 gridTile2 gridTile3 gridTile4"
        "gridTile5 gridTile6 gridTile7 gridTile8"
    `},"ITEMS-9__A":{xs:`
        "gridLead gridLead"
        "gridTile1 gridTile2"
        "gridTile3 gridTile4"
        "gridTile5 gridTile6"
        "gridTile7 gridTile8"
    `,sm:`
        "gridLead gridLead gridTile1"
        "gridLead gridLead gridTile2"
        "gridTile3 gridTile4 gridTile5"
        "gridTile6 gridTile7 gridTile8"
    `,md:`
        "gridLead gridLead gridTile1 gridTile2"
        "gridLead gridLead gridTile3 gridTile4"
        "gridTile5 gridTile6 gridTile7 gridTile8"
    `,lg:`
        "gridLead gridLead gridTile1 gridTile2 gridTile3 gridTile4"
        "gridLead gridLead gridTile5 gridTile6 gridTile7 gridTile8"
    `}},V_t=e=>{const t=H_t[e];return Pe`
        grid-template-areas: ${t.xs};

        ${re.smUp`
            grid-template-areas: ${t.sm};
        `}

        ${re.mdUp`
            grid-template-areas: ${t.md};
        `}

        ${re.lgUp`
            grid-template-areas: ${t.lg};
        `}
    `},W_t=v.div`
    @media (min-width: ${Ke.sm}em) {
        block-size: 1px;
        flex-grow: 1;
    }
`,Y_t=v.img`
    border-radius: var(--salt-radius-default);
    object-fit: cover;
    inline-size: 100%;
    block-size: 100%;
`,q_t=v.div`
    display: flex;
    flex-direction: column;
    grid-area: gridLead;
`,K_t=v.picture`
    display: flex;
    block-size: 100%;
`,z_t=({data:e,meta:t})=>{const{tile:n}=e,o={xs:tr(n?.images,"RATIO_2_1"),sm:tr(n?.images,"RATIO_1_1"),md:tr(n?.images,"RATIO_1_1"),lg:tr(n?.images,"RATIO_1_1")},r=n?.images?.find(d=>d.assetSize==="RATIO_1_1")?.url||"",[a]=Ee(["seo.rdbl"]),i=Bc(n?.target,"GRID_IMAGE",{isSEOReadableURLEnabled:a}),l=ka(),c=Uc(()=>l.reportGridItemImpression(t));return s.jsx(q_t,{children:s.jsx(W_t,{children:s.jsx(Gee,{source:"GRID_IMAGE",target:n.target,onClick:()=>{l.reportGridLeadImageClicked({ENTRY_ID:t.ENTRY_ID,ENTRY_NAME:t.ENTRY_NAME,GRID_ID:t.GRID_ID,ITEM_ID:n.id,ITEM_NAME:n.name,ITEM_TYPE:"LEAD_IMAGE",LINK_TYPE:n.target?.linkType||"",LINK_VALUE:i||"",PAGE_TYPE:t.PAGE_TYPE,PAGE_NAME:t.PAGE_NAME,SEQUENCE:t.SEQUENCE,SEQUENCE_OF_ITEM_ON_PAGE:t.SEQUENCE_OF_ITEM_ON_PAGE})},children:s.jsxs(K_t,{ref:c,children:[Object.entries(o).map(([d,u])=>{const[p,g]=u;return s.jsxs(ae.Fragment,{children:[s.jsx("source",{media:fl[d],srcSet:p,type:"image/avif"},d),s.jsx("source",{media:fl[d],srcSet:g,type:"image/webp"},d)]})}),s.jsx(Y_t,{"data-test":`grid-lead-${n.id}`,src:r,alt:n.altText})]})})})})},Q_t=v.div`
    display: grid;
    ${e=>V_t(e.layout)}
    ${re.xs`
        gap: var(--salt-spacing-2);
    `}
    ${re.smUp`
        gap: var(--salt-spacing-4);
    `}
    grid-auto-columns: minmax(1px, 1fr);
`,X_t=e=>`gridTile${e+1}`,Z_t=({data:e,meta:t})=>{const{layout:n,label:o}=e,r=F_t(n),a=ka(),i=Uc(()=>a.reportGridImpression(t)),l=h.useMemo(()=>$_t.getNumberOfPreviousGridTiles(t.SEQUENCE_BY_TYPE,t.COMPONENTIZED_ITEMS_BY_TYPE),[]),c=h.useMemo(()=>e.items.find(u=>u.type==="LEAD_IMAGE"),[e.items]),d=h.useMemo(()=>e.items.filter(u=>u.type==="GRID_TILE"),[e.items]);return s.jsxs(h.Fragment,{children:[o&&s.jsx(ee,{as:"h2",className:"salt-p-b--4",children:o}),!!e?.items?.length&&s.jsxs(Q_t,{"data-test":`grid-${n}`,ref:i,layout:n,children:[c&&s.jsx(z_t,{data:{tile:c},meta:{ENTRY_ID:t.ENTRY_ID,ENTRY_NAME:t.ENTRY_NAME,GRID_ID:e.id,ITEM_ID:c.id,ENTRY_PUBLISHED_TIMESTAMP:c.publishedAt,ITEM_TYPE:"HERO_IMAGE",LABEL:c.label,ALT_TEXT:c.altText,PAGE_TYPE:t.PAGE_TYPE,PAGE_NAME:t.PAGE_NAME,SEQUENCE:0,SEQUENCE_OF_ITEM_ON_PAGE:l}}),d.map((u,p)=>s.jsx(U_t,{gridArea:X_t(p),data:{tile:u,ratios:r},meta:{ENTRY_ID:t.ENTRY_ID,ENTRY_NAME:t.ENTRY_NAME,GRID_ID:e.id,ITEM_ID:u.id,ENTRY_PUBLISHED_TIMESTAMP:u.publishedAt,ITEM_TYPE:"TILE_IMAGE",LABEL:u.label,ALT_TEXT:u.altText,LINK_TYPE:u.target?.linkType||"",LINK_VALUE:u.target?.values[0]||"",PAGE_TYPE:t.PAGE_TYPE,PAGE_NAME:t.PAGE_NAME,SEQUENCE:p,SEQUENCE_OF_ITEM_ON_PAGE:l+p}},u.id))]})]})},Mb=(e,t)=>e.substring(e.lastIndexOf("/")+1)===t?.target?.values[0]?.replace("?type=componentized",""),$ee=(e,t)=>{switch(t?.target?.linkType){case"SHOP_IN_SHOP_TEMPLATED":return Mb(e,t);case"SHOP_IN_SHOP":return Mb(e,t);case"CATEGORY":return Mb(e,t);default:return!1}},$k=(e,t)=>{let n=!1;const o=new Array;t?.items?.forEach(a=>{const i=$k(e,a);(i.isCurrentPage||i.isActive)&&(n=!0),o.push(i)});const r={...t,isActive:n,items:o??[]};return r.isCurrentPage||(r.isCurrentPage=$ee(e,r)),r},J_t=(e,t)=>{const n=new Array;return t.items.forEach(o=>n.push($k(e,o))),{id:t.id,componentType:t.componentType,items:n}},ebt=e=>({items:e}),MA=e=>Array.isArray(e)?1+Math.max(...e.map(MA)):e.items&&e.items.length?1+Math.max(...e.items.map(MA)):0,tbt=(e,t,n)=>n===0?e:t?t.items:[],sbt=e=>({back:e.formatMessage("navigation.back"),title:e.formatMessage("shopinshop.navigation.title"),browse:e.formatMessage("shopinshop.navigation.title"),attributeTitle:e.formatMessage("shopinshop.navigation.title")}),nbt=(e,t)=>{const n=new Array;for(let o=0;o<e;o+=1)n.push({paneIndex:o,selectedNavigationItemIndex:void 0,selected:void 0,parent:o===0?t:void 0});return n},obt=(e,t,n,o)=>{const r=t-1;return r<0||(e[r]&&(e[r].selected=n,e[r].selectedNavigationItemIndex=o),e[t]&&(e[t].parent=n)),e},rbt=(e,t)=>{const n=t+1;return e[n]&&(e[n].parent=void 0),e[t]&&(e[t].selected=void 0,e[t].selectedNavigationItemIndex=void 0),e},abt=(e,t)=>{let n="";const o=[...e];return t!==void 0&&o.push(t),o.forEach((r,a)=>{a!==0&&(n+="_"),n+=r}),n},Gr={toNavigationBarData:J_t,enrichNavigationState:$k,isCurrentPage:$ee,getNavigationItemsDepth:MA,createRootNavigation:ebt,getNavigationItemsForPane:tbt,getFormatMessage:sbt,getInitialNavigationPanes:nbt,increamentNavigationPanes:obt,decreamentNavigationPanes:rbt,getDataLayerLocation:abt},v0=({item:e,isSEOReadableURLEnabled:t,onItemClick:n,meta:o,itemLevel:r,index:a,selectedNavigationItemIndexes:i})=>{const l=ka();if(e.isCurrentPage)return s.jsx(O,{bold:!0,children:e.label});const c=Bc(e?.target,"NAV_BAR",{isSEOReadableURLEnabled:t})||"",d=Wm(e?.target);return e?.target.linkType===kt.ABSOLUTE_WEB_ADDRESS?s.jsx(tt,{href:c,target:d,onClick:()=>{l.reportNavigationItemClicked({CAMPAIGN_ID:o.CAMPAIGN_ID,CAMPAIGN_NAME:o.CAMPAIGN_NAME,ITEM_ID:e.id,ITEM_NAME:e.name,LABEL:e.label,ITEM_TYPE:"DROPDOWN_ITEM",LEVEL:r,LINK_TYPE:e.target.linkType,LINK_VALUE:e.target.values[0],PAGE_TYPE:o.PAGE_TYPE,PAGE_NAME:o.PAGE_NAME,LOCATION:Gr.getDataLayerLocation(i,a)}),n()},children:e.label}):s.jsx(Ye,{to:c,target:d,onClick:()=>{l.reportNavigationItemClicked({CAMPAIGN_ID:o.CAMPAIGN_ID,CAMPAIGN_NAME:o.CAMPAIGN_NAME,ITEM_ID:e.id,ITEM_NAME:e.name,LABEL:e.label,ITEM_TYPE:"DROPDOWN_ITEM",LEVEL:r,LINK_TYPE:e.target.linkType,LINK_VALUE:e.target.values[0],PAGE_TYPE:o.PAGE_TYPE,PAGE_NAME:o.PAGE_NAME,LOCATION:Gr.getDataLayerLocation(i,a)}),n()},children:e.label})},ibt=v(rt.TriggerSaltButton)`
    svg {
        pointer-events: none;
    }
`,lbt=v(rt.Body)`
    overflow-y: hidden;
    white-space: normal;
    inline-size: max-content;
    max-inline-size: calc(50vi + 50% - 10px);
`,cbt=v(Be.Item)`
    font-weight: bold;
`,dbt=({levelTwoItem:e,isSEOReadableURLEnabled:t,meta:n,selectedNavigationItemIndexes:o})=>{const[r,a]=h.useState(!1),[i,l]=h.useState(!1),c=()=>{i&&(l(!1),a(!1))},d=()=>{l(!i),a(!1)},u=Dm(c,[i]),p=typeof window<"u"?{rootMargin:"0px 0px 10000px 0px",threshold:.999,freezeOnceVisible:!0}:{rootMargin:"-80px 0px 0px 0px",threshold:.5},g=h.useRef(null),E=Ev(g,p);return h.useCallback(()=>{const y=E&&!E.isIntersecting;i&&y&&a(!r)},[E]),s.jsxs(rt.Container,{className:"salt-d--inline-block",ref:u,children:[s.jsx(ibt,{"data-test":`navigation-bar-dropdown-button-${e.id}`,intent:"secondary",size:"s",text:e.label,fill:!1,onClick:d,isOpen:i,"aria-expanded":i,"aria-haspopup":"true"}),s.jsx(lbt,{ref:g,isOpen:i,style:{right:r?"0px":void 0},children:s.jsx(rt.Content,{children:s.jsxs(Be,{inline:!1,children:[s.jsx(cbt,{"data-test":`navigation-bar-dropdown-item-${e.id}`,children:s.jsx(v0,{item:e,isSEOReadableURLEnabled:t,onItemClick:c,meta:n,index:e.index,itemLevel:1,selectedNavigationItemIndexes:o})}),e.items.map((y,I)=>s.jsx(Be.Item,{"data-test":`navigation-bar-dropdown-item-${y.id}`,children:s.jsx(v0,{item:y,isSEOReadableURLEnabled:t,onItemClick:c,meta:n,itemLevel:2,index:I,selectedNavigationItemIndexes:[...o,e.index]})},`navigation-bar-dropdown-item-${y.id}`))]})})})]})},ubt=({levelTwoItem:e,isSEOReadableURLEnabled:t,meta:n,index:o,selectedNavigationItemIndexes:r,...a})=>{const i=ka();if(e.isCurrentPage)return s.jsx(x,{intent:"secondary",size:"s",...a,children:e.label});const l=Bc(e?.target,"NAV_BAR",{isSEOReadableURLEnabled:t}),c=Wm(e?.target),d=e?.target.linkType===kt.ABSOLUTE_WEB_ADDRESS,u=()=>{i.reportNavigationItemClicked({CAMPAIGN_ID:n.CAMPAIGN_ID,CAMPAIGN_NAME:n.CAMPAIGN_NAME,ITEM_ID:e.id,ITEM_NAME:e.name,LABEL:e.label,ITEM_TYPE:"BUTTON",LEVEL:1,LINK_TYPE:e.target.linkType,LINK_VALUE:e.target.values[0],PAGE_TYPE:n.PAGE_TYPE,PAGE_NAME:n.PAGE_NAME,LOCATION:Gr.getDataLayerLocation(r,o)})},p=()=>d?s.jsx(tt,{intent:"ghost",href:l,target:c,onClick:u,...a,children:s.jsx(x.Text,{children:e.label})}):s.jsx(Ye,{intent:"ghost",to:l??"",target:c,onClick:u,...a,children:s.jsx(x.Text,{children:e.label})});return s.jsx(x,{intent:"secondary",asChild:!0,size:"s",children:p()})},pbt=v(Be.Item)`
    margin-block-end: 0;
`,mbt=(e,t,n,o)=>e.items.map((r,a)=>{const i=Bc(r?.target,"NAV_BAR",{isSEOReadableURLEnabled:t}),l=Wm(r?.target),c=r?.target.linkType===kt.ABSOLUTE_WEB_ADDRESS,{id:d}=r,u=`navigation-bar-tab-${r.id}`,p=`navigation-bar-tab-${r.id}`,g=r.isCurrentPage?void 0:i,E=r.isCurrentPage?void 0:()=>{o.reportNavigationItemClicked({CAMPAIGN_ID:n.CAMPAIGN_ID,CAMPAIGN_NAME:n.CAMPAIGN_NAME,ITEM_ID:r.id,ITEM_NAME:r.name,LABEL:r.label,ITEM_TYPE:"TAB",LEVEL:0,LINK_TYPE:r.target.linkType,LINK_VALUE:r.target.values[0],PAGE_TYPE:n.PAGE_TYPE,PAGE_NAME:n.PAGE_NAME,LOCATION:Gr.getDataLayerLocation([n.SEQUENCE],a)})};return c?s.jsx(Kr.Link,{id:d,isSSRNavigation:!0,"data-test":p,href:g,target:r.isCurrentPage?void 0:l||"_self",onClick:E,children:r.label},u):s.jsx(Kr.Link,{id:d,isSSRNavigation:!0,"data-test":p,href:g,onClick:E,children:r.label},u)}),hbt=(e,t,n,o)=>s.jsx(Q,{gap:["sm"],as:Be,children:e.items.map((r,a)=>s.jsx(pbt,{children:r.items.length>0?s.jsx(dbt,{levelTwoItem:{...r,index:a},isSEOReadableURLEnabled:t,meta:n,selectedNavigationItemIndexes:o}):s.jsx(ubt,{levelTwoItem:r,isSEOReadableURLEnabled:t,"data-test":`navigation-bar-button-${r.id}`,meta:n,index:a,selectedNavigationItemIndexes:o})},`navigation-bar-button-${r.id}`))}),gbt=({data:e,meta:t})=>{const[n]=Ee(["seo.rdbl"]),o=ka(),r=e.items.find(c=>c.isActive||c.isCurrentPage),a=e.items.find(c=>c.isCurrentPage),i=e.items.findIndex(c=>c.id===r?.id),l=(r?.items||[]).length>0&&i!==void 0;return s.jsxs("div",{"data-test":"navigation-bar-tabs",children:[s.jsx(Kr,{highlightedId:a?.id||"","data-test":"navigation-bar-carousel-carousel",className:"salt-m-y--4",children:mbt(e,n,t,o)}),r&&l&&hbt(r,n,t,[t.SEQUENCE,i])]})},T0=v.div`
    white-space: pre-wrap;
    word-wrap: break-word;
`,_0=v(tt)`
    align-items: center;
    display: flex;
    justify-content: space-between;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-4);
    font-size: var(--salt-text-l-font-size);

    &:hover {
        text-decoration: ${({hasChildren:e})=>e?"none":"underline"};
    }

    &:focus {
        background-color: var(--intent-secondary-100);
    }
`,Ebt=e=>{const t=e.parentElement?.previousSibling?.firstChild;t&&t.focus()},b0=(e,t)=>{const n=t==="next"?e.nextElementSibling:e.previousElementSibling;n&&n.focus()},fbt=(e,t,n)=>e.paneIndex===0&&e.paneIndex===t&&n===0?!0:e.paneIndex===t&&n===-1,ybt=({navigationItem:e,isSEOReadableURLEnabled:t,goToChildPane:n,paneOptions:o,activePaneIndex:r,index:a,meta:i,isLastItem:l,selectedNavigationItemIndexes:c,navigationBarId:d})=>{const u=ka(),p=fbt(o,r,a);let g=null;h.useEffect(()=>{const I=p?setTimeout(()=>g?.focus(),100):void 0;return()=>{clearTimeout(I)}},[g,p]);const E=(I,S)=>{const C=I.key,T=I.code;l&&I.key==="Tab"&&!I.shiftKey?I.preventDefault():S&&(C==="Enter"||T==="Space"||C===" "||C==="ArrowRight")?(I.stopPropagation(),I.preventDefault(),n(r,e,a)):C==="ArrowUp"&&r===0&&a===0?document.getElementById(`navigation-bar-menu-button-${d}`)?.focus():C==="ArrowUp"&&a===-1?Ebt(I.currentTarget):C==="ArrowUp"?b0(I.currentTarget,"previous"):C==="ArrowDown"&&b0(I.currentTarget,"next")},y=()=>{const I=e?.target?Bc(e?.target,"NAVIGATION_BAR",{isSEOReadableURLEnabled:t}):"",S=o.parent?.id===e?.id,C=S||e.isCurrentPage||e.isActive,T=!!e.items.length&&!S&&r<2,_=T?0:void 0,A=`navigationitem-${e.id}_${o.paneIndex}`;return T?s.jsxs(_0,{"aria-haspopup":"true",role:"menuitem",onClick:R=>{R.stopPropagation(),R.preventDefault(),n(r,e,a)},onKeyDown:R=>E(R,!0),isSEOReadableURLEnabled:t,"data-test":A,hasChildren:T,tabIndex:_,ref:R=>{g=R},children:[s.jsx(T0,{children:s.jsx(O,{className:"salt-d--inline",size:"l",bold:C,children:e.label})}),T&&s.jsx(pe,{name:"arrow_right",height:16,width:16})]}):s.jsx(_0,{href:I,"aria-haspopup":"false",selected:o.selected,isSEOReadableURLEnabled:t,hasChildren:!1,"data-test":A,tabIndex:_,ref:R=>{g=R},onClick:()=>{u.reportNavigationItemClicked({CAMPAIGN_ID:i.CAMPAIGN_ID,CAMPAIGN_NAME:i.CAMPAIGN_NAME,ITEM_ID:e.id,ITEM_NAME:e.name,LABEL:e.label,ITEM_TYPE:"DROPDOWN_ITEM",LEVEL:o.paneIndex,LINK_TYPE:e.target.linkType,LINK_VALUE:e.target.values[0],PAGE_TYPE:i.PAGE_TYPE,PAGE_NAME:i.PAGE_NAME,LOCATION:Gr.getDataLayerLocation(c,a===-1?void 0:a)})},onKeyDown:R=>E(R,!1),...e.target?.openInNewTab?{target:"_blank"}:{},children:s.jsx(T0,{children:s.jsx(O,{className:"salt-d--inline",size:"l",bold:C,children:e.label})})})};return s.jsx(ae.Fragment,{children:y()})},Hee=v(ybt)``,Ibt=v.ul`
    list-style: none;
    margin: 0;
    padding: 0;
    position: relative;
    inline-size: 100%;
`,Sbt=({paneOptions:e,goToChildPane:t,activePaneIndex:n,isSEOReadableURLEnabled:o,meta:r,selectedNavigationItemIndexes:a,navigationBarId:i})=>{const l=e.parent;return l?s.jsx(Hee,{isSEOReadableURLEnabled:o,goToChildPane:t,activePaneIndex:n,navigationItem:l,paneOptions:e,index:-1,meta:r,isLastItem:!1,selectedNavigationItemIndexes:a,navigationBarId:i},`navigationitem-${l.id}`):null},Cbt=({paneOptions:e,goToChildPane:t,activePaneIndex:n,isSEOReadableURLEnabled:o,meta:r,selectedNavigationItemIndexes:a,navigationBarId:i})=>{const l=e.parent?.items;return l?l.map((c,d)=>s.jsx(Hee,{isSEOReadableURLEnabled:o,goToChildPane:t,activePaneIndex:n,navigationItem:c,paneOptions:e,index:d,meta:r,isLastItem:d===l.length-1,selectedNavigationItemIndexes:a,navigationBarId:i},`navigationitem-${c.id}`)):null},vbt=({paneOptions:e,goToChildPane:t,activePaneIndex:n,isSEOReadableURLEnabled:o,meta:r,selectedNavigationItemIndexes:a,navigationBarId:i})=>s.jsxs(Ibt,{id:`navigation-bar-menu-${i}`,"aria-labelledby":`navigation-bar-menu-button-${i}`,children:[n!==0&&Sbt({paneOptions:e,goToChildPane:t,activePaneIndex:n,isSEOReadableURLEnabled:o,meta:r,selectedNavigationItemIndexes:a,navigationBarId:i}),Cbt({paneOptions:e,goToChildPane:t,activePaneIndex:n,isSEOReadableURLEnabled:o,meta:r,selectedNavigationItemIndexes:a,navigationBarId:i})]}),Tbt=v(vbt)``,_bt=v.div`
    background-color: var(--intent-contrast);
    box-sizing: border-box;
    overflow: hidden auto;
    backface-visibility: hidden;
    inline-size: 100%;
`,bbt=v.button`
    display: flex;
    flex-direction: row;
    align-items: center;
    inline-size: 100%;
    line-height: 0;
    background-color: transparent;
    border: none;

    &:hover,
    &:focus {
        background-color: var(--intent-secondary-100);
    }
`,xbt=({paneOptions:e,activePaneIndex:t,isSEOReadableURLEnabled:n,formatMessage:o,goToPreviousPane:r,goToChildPane:a,meta:i,selectedNavigationItemIndexes:l,navigationBarId:c})=>s.jsxs(_bt,{children:[e.paneIndex!==0&&e.paneIndex===t&&s.jsx(Lt,{breakpoint:"lg-up",children:s.jsxs(bbt,{className:"salt-p-y--4 salt-p-r--0 salt-p-l-4",type:"button",onFocus:d=>d.stopPropagation(),onClick:d=>{d.stopPropagation(),d.preventDefault(),r(t)},onKeyDown:d=>{const u=d.key;u==="Enter"||u==="Space"||u==="ArrowLeft"?(d.stopPropagation(),d.preventDefault(),r(t)):u==="ArrowDown"&&(d.currentTarget.parentElement?.nextSibling?.firstChild).focus()},"data-back-button":!0,children:[s.jsx(pe,{verticalAlign:"middle",name:"arrow_left",height:18,width:18}),s.jsx("div",{className:"salt-m-r--2",children:s.jsx(O,{size:"l",className:"salt-d--inline-block",children:o.back})})]})}),s.jsx(Tbt,{paneOptions:e,activePaneIndex:t,isSEOReadableURLEnabled:n,goToChildPane:a,meta:i,selectedNavigationItemIndexes:l,navigationBarId:c})]}),Abt=({panes:e,isSEOReadableURLEnabled:t,formatMessage:n,activePaneIndex:o,goToPreviousPane:r,goToChildPane:a,meta:i,navigationBarId:l})=>{const c=[i.SEQUENCE,...e.filter(d=>d.selectedNavigationItemIndex!==void 0).map(d=>d.selectedNavigationItemIndex)];return s.jsx(h.Fragment,{children:e&&e.map(d=>s.jsx(xbt,{paneOptions:d,activePaneIndex:o,goToPreviousPane:r,goToChildPane:a,formatMessage:n,isSEOReadableURLEnabled:t,meta:i,selectedNavigationItemIndexes:c,navigationBarId:l},`paneindex${d.paneIndex}`))})},Rbt=v.div`
    ${Nce("fixed","0px","0px","0px","0px")}
    ${dR("transform .2s linear opacity")}
    background-color: rgb(0 0 0 / 75%);
    block-size: 100%;
    opacity: 0.7;
    inline-size: 100%;
    z-index: ${$t.overlay};
`,Dbt=v(rt.TriggerSaltButton).withConfig({shouldForwardProp:e=>!["isOpen"].includes(e.toString())})`
    z-index: ${({isOpen:e})=>e?$t["nav-menu"]-1:$t["nav-button"]-1};
`,Obt=v(rt.Content).attrs(({numberOfPanes:e,dropdownHeight:t,activePaneIndex:n})=>({style:{width:`${100*e}%`,maxHeight:t,transform:`translateX(calc(${n*(100/e)}% * var(--translate-direction)))`}}))`
    --translate-direction: -1;

    html[dir='rtl'] & {
        --translate-direction: 1;
    }

    display: flex;
    margin: 0;
    padding: 0;
    transition: transform 300ms ease-in-out;
    overflow-y: hidden;
`,Pbt=v(rt.Container)`
    position: relative;
`,Nbt=v(rt.Body)`
    z-index: ${$t["nav-menu"]};
    inline-size: ${"calc(100vi - var(--salt-spacing-4))"};
    ${re.smUp`
        max-width: 455px;
    `}
`,Lbt=v.div`
    ${re.smUp`
        max-width: 455px;
    `}
`,kbt=3,jbt=({data:e,meta:t})=>{const n=L(),o=h.useRef(null),r=ka(),[a,i]=h.useState(!1),[l,c]=h.useState(0),[d,u]=h.useState("100vh"),[p,g]=h.useState("100vh"),[E,y]=h.useState(0),I=Gr.getFormatMessage(n),[S]=Ee(["seo.rdbl"]),C=Gr.createRootNavigation(e.items);h.useLayoutEffect(()=>{if(a&&o.current){const{top:j}=o.current.getBoundingClientRect();y(j)}a&&Eg()},[a]);const T=h.useMemo(()=>Math.min(kbt,Gr.getNavigationItemsDepth(C)),[]),[_,A]=h.useState(()=>Gr.getInitialNavigationPanes(T,C)),R=h.useCallback((j,G,W,H)=>{const K=Math.max(0,j+G);c(K),G===1&&W&&H!==void 0&&A(X=>Gr.increamentNavigationPanes(X,K,W,H)),G===-1&&K!==0&&A(X=>Gr.decreamentNavigationPanes(X,K)),K===0&&A(Gr.getInitialNavigationPanes(T,C))},[l,A]),P=(j,G,W)=>{R(j,1,G,W)},N=h.useCallback(j=>{R(j,-1)},[]),k=h.useCallback(()=>{i(!0)},[]),M=h.useCallback(()=>{i(!1),c(0),Ai()},[]),w=()=>{let j;typeof window<"u"&&typeof document<"u"&&(j=window.innerHeight);const W=j?`${j}px`:"100vh";u(W)};return h.useEffect(()=>(w(),window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)),[]),h.useEffect(()=>{if(a){const j=E?E+25:0,G=`calc(${d} - ${$(j)})`;g(G)}},[d,a,E]),h.useEffect(()=>{a&&r.reportNavigationMenuClicked({TOTAL_ITEMS:e.items.length})},[a]),s.jsx(Lt,{breakpoint:"lg-up",display:"inline-block",children:s.jsxs(Lbt,{children:[s.jsx(ie,{children:s.jsx(O,{children:I.browse})}),s.jsxs(Pbt,{as:"nav","aria-label":I.browse,children:[a&&s.jsx(Rbt,{"data-test":"overlay",onClick:M}),s.jsx(Lt,{breakpoint:"lg-up",display:"inline-block",children:s.jsx(Dbt,{intent:"secondary",text:I.browse,id:`navigation-bar-menu-button-${e.id}`,isOpen:a,title:I.attributeTitle,"data-test":"navigation-bar-mobile-button",onClick:()=>a?M():k()})}),a&&s.jsx(Nbt,{isOpen:a,ref:o,children:s.jsx(Obt,{activePaneIndex:l,"data-test":"navigation-bar-mobile__dropdown-content",numberOfPanes:T,dropdownHeight:p,children:_&&s.jsx(Abt,{isSEOReadableURLEnabled:S,panes:_,formatMessage:I,activePaneIndex:l,goToPreviousPane:N,goToChildPane:P,meta:t,navigationBarId:e.id})})})]})]})})},Mbt=v.div``,wbt=({data:e,meta:t})=>{const{pathname:n}=Ne(),o=h.useMemo(()=>Gr.toNavigationBarData(n,e),[n]);return s.jsxs(Mbt,{suppressHydrationWarning:!0,"data-test":`navigation-bar-${e.id}`,children:[s.jsx(Lt,{breakpoint:"lg-up",children:s.jsx(jbt,{data:o,meta:t})}),s.jsx(Kt,{breakpoint:"lg-up",children:s.jsx(gbt,{data:o,meta:t})})]})},Fbt=({node:e,children:t,richTextId:n,analyticsEvents:o,pageName:r,pageType:a,location:i})=>{const l=()=>{o.reportRichTextLinkClicked({RICH_TEXT_ID:n,LINK_TYPE:"EXTERNAL WEB ADDRESS",LINK_VALUE:e.data.uri,PAGE_NAME:r,PAGE_TYPE:a,LOCATION:i})};return s.jsx("a",{href:e.data.uri,onClick:l,children:t})},Bbt=(e,t,n,o,r)=>{let a;return{renderNode:{[bn.BLOCKS.HEADING_1]:(i,l)=>s.jsx(ee,{as:"h2",children:l}),[bn.BLOCKS.HEADING_2]:(i,l)=>s.jsx(ee,{as:"h2",children:l}),[bn.INLINES.HYPERLINK]:(i,l)=>(a=a!==void 0?a+1:0,s.jsx(Fbt,{node:i,richTextId:e,analyticsEvents:t,pageName:n,pageType:o,location:`${r}_${a}`,children:l}))}}},Ubt=({data:e,meta:t})=>{const n=ka(),o=Uc(()=>{const i={CAMPAIGN_ID:t.CAMPAIGN_ID,CAMPAIGN_NAME:t.CAMPAIGN_NAME,RICH_TEXT_ID:e.id,SEQUENCE:t.SEQUENCE};n.reportRichTextImpression(i)}),r=h.useMemo(()=>Bbt(e.id,n,t.PAGE_NAME,t.PAGE_TYPE,t.SEQUENCE),[e]),a=h.useMemo(()=>rC.documentToReactComponents(JSON.parse(e.richText),r),[e]);return s.jsx(V,{"data-test":`rich-text-${e.id}`,flush:!0,children:s.jsx(V.Item,{colStart:{md:3,lg:4},colSpan:{xs:12,md:8,lg:6},children:s.jsx("div",{ref:o,children:a})})})},Gbt=(e,t)=>t?t.slice(0,e).map(o=>o.items.length).reduce((o,r)=>+o+ +r,0):0,$bt={getNumberOfPreviousCarouselTiles:Gbt},dh={lg:"RATIO_2_1",md:"RATIO_2_1",sm:"RATIO_1_1",xs:"RATIO_1_1"},Hbt=({data:e,meta:t})=>{const{formatMessage:n}=L(),o=dr(),r=ka(),a=Uc(()=>r.reportGridImpression(t)),[i]=Ee(["seo.rdbl"]),l=h.useMemo(()=>$bt.getNumberOfPreviousCarouselTiles(t.SEQUENCE_BY_TYPE,t.COMPONENTIZED_ITEMS_BY_TYPE),[]);if(e.items.length===0)return null;const c=(p,g)=>{if(!p)return;const{id:E,label:y,altText:I,target:S,publishedAt:C}=e.items[g];r.reportGridItemImpression({ENTRY_ID:t.ENTRY_ID,ENTRY_NAME:t.ENTRY_NAME,GRID_ID:e.id,ENTRY_PUBLISHED_TIMESTAMP:C,ITEM_TYPE:"TILE_IMAGE",ITEM_ID:E,LABEL:y,ALT_TEXT:I,SEQUENCE:g,LINK_TYPE:S?.linkType||"",LINK_VALUE:S?.values[0]||""})},d=e.items.map((p,g)=>{const{id:E,name:y,label:I,description:S,altText:C}=p,T=Bc(p?.target,"CAROUSEL_IMAGE",{isSEOReadableURLEnabled:i}),_=Wm(p?.target),A=o==="sm"||o==="xs"?"small":"normal",R={xs:tr(p?.images,dh.xs),sm:tr(p?.images,dh.sm),md:tr(p?.images,dh.md),lg:tr(p?.images,dh.lg)},P=p?.images?.find(N=>N.assetSize===dh.lg)?.url||"";return s.jsx(EH,{triggerOnce:!0,className:"salt-d--inline",onChange:N=>{c(N,g)},"data-test":"carouselTile",children:s.jsx(Oe.MediaNavigationCard,{variant:"fullImage",formatting:A,title:I,dynamicHeight:!0,breakpointSrcSet:R,fallbackSrc:P,alt:C,content:S,href:T,target:_,onClick:()=>{r.reportCarouselItemClicked({ENTRY_ID:t.ENTRY_ID,ENTRY_NAME:t.ENTRY_NAME,GRID_ID:e.id,ITEM_ID:p.id,ITEM_NAME:y,ITEM_TYPE:"TILE_IMAGE",LINK_TYPE:p.target?.linkType||"",LINK_VALUE:p.target?.values[0]||"",PAGE_NAME:t.PAGE_NAME,SEQUENCE:g,SEQUENCE_OF_ITEM_ON_PAGE:l+g})}})},E)}),u={labels:{"next-button":n("scroller.accessibility.viewNextIn",{title:e.label}),"previous-button":n("scroller.accessibility.viewPreviousIn",{title:e.label})}};return s.jsx(to,{flush:!0,spacing:4,a11y:u,ref:a,navigationButtonPosition:"header",title:s.jsx(to.Title,{children:e.label}),children:d})},Vbt=({items:e,item:t,id:n,name:o,index:r,meta:a,isLastComponent:i})=>{const l=i?{}:{className:"salt-m-b--2 md:salt-m-b--4"};switch(t.componentType){case"HERO_IMAGE_CONTAINER":return s.jsx("div",{...l,children:s.jsx(O_t,{data:t,meta:{BANNER_PLACEMENT:a.BANNER_PLACEMENT,ENTRY_ID:n,ENTRY_NAME:o,HERO_IMAGE_ID:t.id,LOCATION:a.LOCATION,SEQUENCE:r,PAGE_TYPE:a.PAGE_TYPE,ENTRY_PUBLISHED_TIMESTAMP:a.ENTRY_PUBLISHED_TIMESTAMP,PAGE_NAME:a.PAGE_NAME}})});case"GRID_CONTAINER":return s.jsx("div",{...l,children:s.jsx(Z_t,{data:t,meta:{GRID_TYPE:"Grid",GRID_ID:t.id,ENTRY_ID:n,ENTRY_NAME:o,GRID_LAYOUT:t.layout,SEQUENCE:r,SEQUENCE_BY_TYPE:Ty.getSequenceByType(e,"GRID_CONTAINER",r),COMPONENTIZED_ITEMS_BY_TYPE:Ty.getComponentizedItemsByType(e,"GRID_CONTAINER"),PAGE_TYPE:a.PAGE_TYPE,ENTRY_PUBLISHED_TIMESTAMP:a.ENTRY_PUBLISHED_TIMESTAMP,PAGE_NAME:a.PAGE_NAME}})});case"CAROUSEL_CONTAINER":return s.jsx("div",{...l,children:s.jsx(Hbt,{data:t,meta:{GRID_TYPE:"Carousel",GRID_LAYOUT:t.items.length,ENTRY_ID:n,GRID_ID:t.id,ENTRY_NAME:o,SEQUENCE:r,SEQUENCE_BY_TYPE:Ty.getSequenceByType(e,"CAROUSEL_CONTAINER",r),COMPONENTIZED_ITEMS_BY_TYPE:Ty.getComponentizedItemsByType(e,"CAROUSEL_CONTAINER"),ENTRY_PUBLISHED_TIMESTAMP:a.ENTRY_PUBLISHED_TIMESTAMP,PAGE_NAME:a.PAGE_NAME}})});case"NAV_BAR":return s.jsx("div",{...l,children:s.jsx(wbt,{data:t,meta:{CAMPAIGN_ID:n,CAMPAIGN_NAME:o,NAVIGATION_BAR_ID:t.id,SEQUENCE:r,PAGE_TYPE:a.PAGE_TYPE,PAGE_NAME:a.PAGE_NAME}})});case"RICH_TEXT":return s.jsx(Ubt,{data:t,meta:{PAGE_TYPE:a.PAGE_TYPE,PAGE_NAME:a.PAGE_NAME,CAMPAIGN_ID:n,CAMPAIGN_NAME:o,SEQUENCE:r}});default:return null}},Vee=({items:e,id:t,name:n,meta:o})=>s.jsx(h.Fragment,{children:e.map((r,a)=>{const i=e.length-1===a;return s.jsx(h.Fragment,{children:Vbt({item:r,id:t,name:n,index:a,items:e,meta:o,isLastComponent:i})},r.id)})}),Hk=({items:e=[],id:t,name:n,meta:o})=>{const r=ka();return h.useEffect(()=>{const{totalGrids:a,totalHeroImages:i,totalCarousels:l}=e.reduce((c,d)=>{switch(d.componentType){case"HERO_IMAGE_CONTAINER":return{...c,totalHeroImages:c.totalHeroImages+1};case"GRID_CONTAINER":return{...c,totalGrids:c.totalGrids+1};case"CAROUSEL_CONTAINER":return{...c,totalCarousels:c.totalCarousels+1};default:return c}},{totalGrids:0,totalHeroImages:0,totalCarousels:0});r.reportComponentizedAttributes({TOTAL_GRIDS:a,TOTAL_HERO_IMAGE_BANNERS:i,TOTAL_CAROUSELS:l,ENTRY_ID:t})},[e]),s.jsx(Vee,{id:t,items:e,name:n,meta:{PAGE_TYPE:o.PAGE_TYPE,PAGE_NAME:o.PAGE_NAME,BANNER_PLACEMENT:o.BANNER_PLACEMENT,LOCATION:o.LOCATION,ENTRY_PUBLISHED_TIMESTAMP:o.ENTRY_PUBLISHED_TIMESTAMP}})},ZT=()=>{const e=F(),t=h.useCallback(a=>{const i={ecommType:"enhanced",event:"view_promotion",eventCategory:"Shop in Shop page",eventAction:"HERO_IMAGE_BANNER_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Shop in Shop",id:a.id,name:a.name,creative:a.imageId,position:"Hero Image"}]}}};return te.sendEvent({GA:i,WA:null}),e(U.analyticsEvent({type:Ea.HORIZONTAL_HERO_BANNER_IMPRESSION,...a}))},[e]),n=h.useCallback(a=>{const i={event:"view_promotion",ecommType:"enhanced",eventCategory:"Shop in Shop page",eventAction:"SUB_CATEGORY_IMAGE_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Shop in Shop",id:a.id,name:a.subCategoryName,creative:a.imageId,position:`Sub category image ${a.sequence}`}]}}};return te.sendEvent({GA:i,WA:null}),e(U.analyticsEvent({type:Ea.SUB_CATEGORY_IMAGE_IMPRESSION,...a}))},[e]),o=h.useCallback(a=>{const i={event:"select_promotion",ecommType:"enhanced",eventCategory:"Shop in Shop page",eventAction:"SUB_CATEGORY_IMAGE_CLICKED",ecommerce:{promoClick:{promotions:[{promotionType:"Shop in Shop",id:a.id,name:a.subCategoryName,creative:a.imageId,position:`Sub category image ${a.sequence}`}]}}};te.sendEvent({GA:i,WA:null}),e(U.analyticsEvent({type:Ea.SUB_CATEGORY_IMAGE_CLICKED,...a}))},[e]),r=h.useCallback(a=>{const i={event:"view_shop_in_shop",name:a.name,id:a.id,type:a.pageType};te.sendEvent({GA:i,WA:null}),e(U.analyticsEvent({type:Ea.SHOP_IN_SHOP_PAGE_VIEW,...a}))},[e]);return{reportHorizontalHeroImpression:t,reportSubCategoryImpression:n,reportSubCategoryClick:o,reportPageView:r}},Wbt={id:"",name:"",label:"",componentItems:[]},Wee=({label:e,componentItems:t,id:n,name:o})=>{const r=ZT();return h.useEffect(()=>{r.reportPageView({event:"view_shop_in_shop",name:o??"",id:n,pageType:"category"})},[]),s.jsxs("div",{className:"salt-m-t--2 salt-m-r--2 salt-m-l--2","data-test":"sis-category-componentized",children:[e&&s.jsx(ee,{as:"h1","data-test":"sis-label",className:"salt-m-t--4 salt-m-b--4",children:e}),s.jsx(Hk,{items:t,id:n,name:o,meta:{PAGE_TYPE:"category",PAGE_NAME:"shop_in_shop",BANNER_PLACEMENT:"ABOVE_GRID",LOCATION:"SHOP_PRODUCTS"}})]})};Wee.defaultProps=Wbt;const Ybt=ae.memo(Wee,function(t,n){return t.id===n.id}),Yee=e=>t=>t(GQe.fetchCategoryPageRecipeAdverts(e)).catch(()=>{}),qbt=se("GET_CATEGORY_PAGE_ADVERTS"),qee=e=>({type:"API",payload:{url:`/v1/content?${Qe.stringify({page:"CATEGORY",key:e},{sort:!1})}`,...qbt}}),Kee=e=>{if(e==="products"||e==="categories")return{};const n=(e?.endsWith("/")?e.slice(0,-1):e)?.split("/")??[],o=n.pop();return{sublocationId:o?.length?o:void 0,fullCataloguePath:n.length?n.join("/"):void 0}},zee=D("seo.rdbl"),Kbt=D("cat.evt"),wA=D("seo.ra"),Qee=D("rec"),zbt=D("bt.top"),Qbt=()=>{const e=L(),t=ws(),n=Ne(),o=Ge(),r=nn(),{sublocationId:a}=Kee(r["*"]),i=f(zee),l=f(Kbt),c=f(wA),d=f(Qee),u=f(zp),p=f(EMe),g=f(au),E=f(xpt),y=f(VQe),I=f(zbt),S=f(rE),C={allProducts:e.formatMessage("navigation.products")},T=l&&p,_=T&&p.contentFormat!=="COMPONENTIZED",A=T&&p.contentFormat==="COMPONENTIZED",R=!!(A&&p?.componentItems?.length||_&&g?.length),P=ff(),N=()=>{t(ds({name:T?zxe:Kxe,variant:T?"shop-in-shop":void 0}))},k=j=>i?a:j.sublocationId,M=({category:j=void 0,sortOption:G=void 0,filters:W={},fullURLPath:H=""}={})=>{const K=nE({...!i&&{category:j},filters:W,sortOption:G});if(i){const X=H.toLowerCase();return Sa(j,X,{queryString:K})}return ao({queryString:K})},w=({category:j,nextPageToken:G})=>t(WGe({uri:"/v6/products",category:j,pageToken:G,isRetailerCategoryId:c})).then(W=>{!S&&W&&W.nextPageToken&&W.productCount===0&&w({category:j,nextPageToken:W.nextPageToken})});return s.jsxs(h.Fragment,{children:[_&&s.jsx(Gk,{id:p.id,name:p.name,label:p.label,contentFormat:p.contentFormat,images:p.images,html:p.html,breadCrumbs:g}),A&&s.jsx(Ybt,{id:p.id,label:p.label,name:p.name,componentItems:p.componentItems}),s.jsx(o_t,{rootpageTitle:"search.categories.title",subpageTitle:"categories.subpage.title",seoFriendlyMeta:{metaDescriptionTagline:"category.meta.descriptionTagline",metaSubDescriptionTagline:"subcategory.meta.descriptionTagline"}}),s.jsx(Vm,{navigate:o,enableRegionAgnosticCategoriesPerSection:!0,hideBreadcrumb:R,fetchPage:({category:j,filters:G,sortOption:W})=>(t(qee(j)).catch(H=>{Ue.api.pushError(H)}),d&&j&&t(Yee(j)).catch(H=>{Ue.api.pushError(H)}),t(Ez({uri:"/v6/products",category:j,filters:G,sortOption:W,isRetailerCategoryId:c}))),page:"categories",getTargetUrl:j=>M(j),rootBreadcrumb:{name:C.allProducts,url:M()},location:n,noProductsFilteredPage:({clearFilters:j,term:G})=>s.jsx(yf,{clearFilters:j,page:"categories",term:G}),noProductsPage:({term:j})=>s.jsx(Fk,{page:"categories",term:j}),pageError:u,onInitialFopLoad:N,matchSublocationId:k,showSortAndFilters:!0,withinGridProductCards:[...E,...y],fetchNextPage:w,shouldShowScrollToTopButton:I?!1:P}),I&&s.jsx(Du,{})]})},_I=()=>s.jsx(Et,{type:"Categories::route",children:s.jsx(Qbt,{})});_I.fetchData=async({context:{store:e,url:t},params:n})=>{const o=e.getState(),r=Kee(n["*"]),a=ps.parse(t.search),i=(t.searchParams.get("sublocationId")??"")||r.sublocationId,l=t.searchParams.get("sortBy")??"",c=Yp(ps.parse(t.search)),u=`${decodeURIComponent(t.pathname)}${t.search}`,p=u.split("?")[1],g=At(o),y=[Ez({uri:"/v6/products",category:i,filters:c,sortOption:l,isRetailerCategoryId:wA(o)}),qee(i),...Qee(o)&&i?[Yee(i)]:[]];if(wA(o)){await e.dispatch(yt.getCategoryEntity({queryString:`id=${i}`}));const T=R2(e.getState()),_=i?Fx(a):p;if(T?.retailerId&&i!==T?.retailerId){const A=T?.encodedName.toLowerCase(),R=Sa(T?.retailerId,A,{queryString:_,basePath:g});return Promise.resolve({redirectTo:R,statusCode:Go.MOVED_PERMANENTLY})}}await Promise.allSettled(y.map(T=>e.dispatch(T)));const I=`${t.pathname}${t.search}`,S=g?.length?I.replace(g,""):I;e.dispatch(yt.setLastFetchedCatalogueLocation(S));const C=zp(e.getState());if(zee(o)&&!C){const T=rD(e.getState()),_=i?Fx(a):p,A=Sa(i,T,{queryString:_,basePath:g});if(u.toLowerCase()!==A.toLowerCase()){const R=T.toLowerCase(),P=Sa(i,R,{queryString:_,basePath:g});return Promise.resolve({redirectTo:P,statusCode:Go.MOVED_PERMANENTLY})}}return Promise.resolve()};const x0=D("showpromopage"),Xbt=e=>[{path:"/products",Component:e.Main,key:"main",children:[{index:!0,Component:_I}]},{path:"/categories",Component:e.Main,key:"main",children:[{index:!0,Component:_I},{path:"*",Component:_I}]},{path:"/favorites",Component:e.Main,key:"main",children:[{index:!0,Component:$s(Xe,Lee)}]},{path:"/promotions",Component:e.Main,key:"main",children:[{index:!0,Component:as(x0,jA,ot)},{path:"*",Component:as(x0,jA,ot)}]}],Xee=()=>{const e=f(Zg),t=e?Tr({inCheckoutWalk:!1,shippingGroupType:e}):jt();return s.jsx(En,{to:t})},Zee=()=>{const e=f(n=>n.router.location.search),t=!!ps.parse(e)[Ed];return s.jsx(En,{to:vr({queryString:t?Iv:""})})},Zbt=()=>{const e=f(Vze),t=f(o=>o.router.location.search),n=!!ps.parse(t)[Ed];return e?s.jsx(En,{to:zg({pageKey:e,queryString:n?Iv:""})}):s.jsx(Zee,{})},Jbt=1,Jee=()=>{const e=F(),{actions:t}=st({performanceMark:ds})(e);return t.performanceMark},Ym=()=>{const e=Ne(),t=f(k5(e)),n=f(Iu),o=f(L5),r=t&&t.pageIndex+1,a=r&&n?.data?.pages?.[r];return{currentPage:t,nextPage:a?{...a,pageIndex:r}:void 0,numberOfPages:o+Jbt,shouldRefetch:n.data?.shouldRefetch,isFetching:n.isFetching}},ete=()=>{const e=Jee(),t=f(Iu),{currentPage:n}=Ym();return o=>n&&t?.data?.pages?.[n.pageIndex+1]?e({name:rAe,attributes:{pageIndex:n.pageIndex},event:o}):e({name:iAe,event:o})},tte=()=>{const e=F(),{currentPage:t}=Ym(),n=f(Ct);if(t&&t.productGroups.find(o=>o.freeGifts)){const{productGroups:o}=t;let r=0;const a=o.find(i=>i.freeGifts)?.freeGifts?.promotions?.reduce((i,l)=>{for(const c of l.products)c.selected&&(r+=1);return{allCount:i.allCount+l.products.length,selectedCount:r}},{allCount:0,selectedCount:0});return()=>{e(U.analyticsEvent({type:Zn.CONTINUE_SHOPPING_CLICKED,description:"Checkout walk continue checkout button clicked",pageEventAttributes:{orderId:n,availableGifts:a?.allCount,selectedGifts:a?.selectedCount}}))}}return()=>{}},ste=()=>{const e=L();return{title:e.formatMessage({id:"checkout.walk.progress.title"}),button:e.formatMessage({id:"checkout.walk.next"}),next:e.formatMessage({id:"checkout.walk.next"}),notice:e.formatMessage({id:"checkout.walk.scroll.notice"})}},nte=()=>f(D("cs.prind")),ext=({productGroup:e,shouldDisplayGroupTitle:t=!0})=>{const n=Jee(),o=f(Iu),r=f(ts),{engine:a,groupTitle:i}=e,l=Ne(),c=aN(l);return s.jsxs(h.Fragment,{children:[t&&i?s.jsx("div",{className:"salt-m--2","data-test":`checkout-walk-fop-group-${i}-title`,children:s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("h2",{children:i})})}):s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:i})}),s.jsx("div",{className:"salt-m-x--2","data-test":`checkout-walk-fop-group-${i}`,children:s.jsx(uo,{onInitialFopLoad:()=>n({name:aAe}),productGroups:[{...e,section:a}],productsByProductId:r,page:`checkout-walk-${Pi(c)}`,type:"catalogue",isFetching:o.isFetching,showMissedPromotions:a==="MISSED_PROMOTIONS"})})]},a)},txt=({productGroup:e,shouldDisplayGroupTitle:t=!0})=>s.jsx(Et,{type:"CheckoutWalkFopGroup::route",children:s.jsx(ext,{productGroup:e,shouldDisplayGroupTitle:t})}),sxt=v(V.Item)``,nxt=v(V)`
    @media (min-width: ${Ke.sm}em) {
        grid-template-columns: repeat(auto-fill, minmax(300px, 344px));
    }
    @media (max-width: ${Ke.sm}em) {
        grid-template-columns: none;
    }
`,oxt=({productGroup:e,pageSubtitle:t})=>{const n=F(),{formatMessage:o}=L(),r=f(Iu),a=Ne(),i=aN(a),l=f(Wze()),{freeGifts:c,groupTitle:d}=e;let u=[];c?.promotions.forEach(E=>{const y=E.products.map(I=>I.productId);u=[...u,...y]}),h.useEffect(()=>()=>{n(iv(u))},[]),h.useEffect(()=>{n(U.analyticsEvent({type:Zn.CHECKOUT_WALK_FREE_GIFT,location:a}))},[n,a]);const p=c?.allPromotionsUsageLimit!=null?c.allPromotionsUsageLimit:l.availableProductsCount,g=(E,y)=>y>0?o("free.gift.campaign.limit.any.selected",{selected:y,count:E}):o("free.gift.campaign.limit.none.selected",{count:E});return s.jsxs(h.Fragment,{children:[s.jsx("h2",{className:"salt-m-x--2","data-test":"checkout-walk-free-gifts-all-counter","aria-label":o("free.gift.total.limit.accessibility",{selected:l.allSelectedCount,total:p}),children:o("free.gift.total.limit",{selected:l.allSelectedCount,total:p})}),t&&s.jsx(O,{asChild:!0,className:"salt-m-x--2 salt-m-y--4",children:s.jsx("p",{children:t})}),c?.promotions.map(({promotionUsageLimit:E,promotionId:y,products:I},S)=>{const C=E??I.length,T=I.map(N=>N.productId),_=l.allSelectedCount>=p,A=!!l?.[y]&&l[y]>=C,R=I.reduce((N,k)=>({...N,[k.productId]:k.selected}),{}),P=()=>s.jsx(nxt,{flush:!0,children:I.map(({productId:N},k)=>s.jsx(sxt,{children:s.jsx(ea,{productId:N,group:{products:T,type:"products",section:"free_gift",name:`free-gifts-${N}`,clusterBreadcrumbs:[],gifts:{isAllPromotionsLimitReached:_,isSinglePromotionLimitReached:A,selectedGifts:R},groupTitle:d,promotionId:y},position:k,page:`checkout-walk-${i}`,subPage:null,noOfferLink:!1,type:"products",withoutHeader:!0,displayLandscapeLayout:!0,fopPositionOnPage:k,sendFopImpression:!0,loading:r.isFetching})},N))},y);return s.jsx("div",{className:"salt-m-x--2",children:c?.promotions.length>1?s.jsxs(rs,{children:[s.jsx(rs.Title,{active:!0,children:s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("h2",{"aria-label":o("free.gift.campaign.limit.accessibility",{selected:l?.[y],total:E,index:S+1}),children:g(E,l?.[y]??0)})})}),s.jsx(rs.Content,{active:!0,className:"salt-p-x--0",children:P()})]}):s.jsx(ae.Fragment,{children:P()})},y)})]})},rxt=e=>s.jsx(Et,{type:"CheckoutWalkFreeGifts::route",children:s.jsx(oxt,{...e})}),Vk=({handleRedirect:e,onContinueClick:t=()=>{}})=>{const{next:n}=ste(),o=ete(),r=tte(),a=h.useCallback(()=>{o(),r(),t()},[o,t,r]);return s.jsx(x,{intent:"action",fill:!0,asChild:!0,onClick:a,"data-test":"checkout-walk-crumbs-link",children:s.jsx(Ye,{to:e(),intent:"ghost",children:s.jsx(x.Text,{children:n})})})};Vk.propTypes={handleRedirect:m.func.isRequired,onContinueClick:m.func};Vk.defaultProps={onContinueClick:()=>{}};const axt=D("barv2"),ixt=()=>{const e=f(Iu),{currentPage:t}=Ym(),n=L(),o={position:(e.data.pages.length+1).toString(),name:n.formatMessage({id:"checkout.progress.payment"}),selected:!1},r=(a,i)=>({position:(i+1).toString(),name:a,selected:i===t?.pageIndex});return e?.data?.pages?[...e.data.pages.map(a=>a.pageShortName).map(r),o]:[]},lxt=({label:e,onClick:t=()=>{},url:n,"data-test":o})=>{const r=ixt(),a=f(axt);return s.jsx(YO,{"data-test":o,trail:r,v2Enabled:a,messages:e,onClick:t,url:n})},cxt=({children:e,handleRedirect:t,pageTitle:n,pageName:o})=>{const r=ete(),a=tte(),{button:i,notice:l,title:c}=ste(),{currentPage:d,numberOfPages:u}=Ym(),p=nte(),{formatMessage:g}=L(),E=(d?.pageIndex||0)+1,y=`${E}/${u}`,I=_=>{a(),r(_)},S=s.jsx(ee,{as:"h1","data-test":"checkout-walk-page-name",children:o}),C=s.jsx(Vk,{handleRedirect:t}),T=g("checkout.walk.progress.title",{step:E,numberOfSteps:u,alternativePageName:o});return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:n,skipFormatTitle:!0}),s.jsx(sn,{children:p?s.jsx(ra,{progressFraction:y,overrideText:S,ariaText:T,ringContent:s.jsx(O,{size:"l",bold:!0,children:y})}):S}),s.jsx(Lt,{breakpoint:"sm-up",children:s.jsx(Te,{intent:"action",className:"salt-m-x--2 salt-m-b--4",text:l,showIcon:!1})}),e,s.jsxs(h.Fragment,{children:[s.jsx(Lt,{breakpoint:"sm-up",children:s.jsx("div",{className:"salt-m--2",children:C})}),s.jsx(Kt,{breakpoint:"sm-up",children:s.jsx(lxt,{"data-test":"checkout-walk-crumbs",label:{button:i,title:c},onClick:I,url:t()})})]})]})},dxt=e=>s.jsx(Et,{type:"CheckoutWalkCrumbsLayout::route",children:s.jsx(cxt,{...e})}),uxt=()=>{const e=F(),{actions:t}=st({analyticsEvent:U.analyticsEvent})(e);return t.analyticsEvent},pxt=()=>{const e=F();return{checkoutWalkGa4Event:n=>{const o=U.analyticsEvent({type:Zn.CHECKOUT_WALK_GA4,...n}),r={event:"checkout_walk",index:n.index??null,name:n.name??null,currency:n.currency??null,value:n.value?Number(n.value):null,osp_transaction_id:n.transactionId,group_id:n.groupId};return te.sendEvent({GA:r,WA:null}),e(o)}}},JT=()=>f(e=>Ra(e)),Sf=()=>f(e=>$p(e)),Wk=()=>f(e=>Ar(e)),Yk=()=>f(Ct)||"",ote=()=>f(e=>Jg(e)),rte=()=>f(e=>MR(e)),mxt=()=>{const e=JT(),t=ote();return!!(t&&e&&Number(e.amount)<Number(t.amount))},ate=()=>f(e=>Jue(e)),hxt=()=>Nm(Wn(["sumsub","bt.spl"])),ite=()=>f(e=>RV(e)),gxt=()=>{const e=He(),t=ite();return t?e(t):""},Ext=()=>{const{pathname:e}=Ne(),t=Yk(),n=Wk();return!!zr({path:cn(t),end:!1},e)&&n},fxt=()=>{const e=Ne();return new URLSearchParams(e.search).get("in-checkout-walk")==="true"},e_=()=>{const{pathname:e}=Ne(),t=Ext(),n=fxt(),o=[jt(),na(),Dc()].some(a=>zr({path:a,end:!1},e)),r=![rO(),Qg()].some(a=>zr({path:a,end:!1},e));return o&&r||t||n},yxt=()=>{const{pathname:e}=Ne();return!!zr({path:zg(),end:!1},e)},Ixt=()=>{const{pathname:e}=Ne();return!!zr({path:jt(),end:!1},e)},Cf=()=>{const e=e_(),t=yxt();return!hxt()&&e&&!t},qm=()=>{const e=He(),t=JT();return t?e(t):"?"},qk=()=>{const e=He();return h.useCallback(t=>e(t),[e])},Sxt=()=>{const e=L(),t=qk();return h.useCallback((n,o)=>e.formatMessage(n,{amount:t(o)}),[t,e])},Cxt=()=>{const e=f(Wn(["hhmin","bt.spl"])),t=rte(),n=Sxt(),o=ote(),r=!e&&t&&o&&Number(o?.amount||0)>.01,a=Cf(),i=ate(),l=ite(),c=qk(),d=os({breakpoint:"sm-up"});return r?{type:"action",message:d?c(o):n("header.order.status.minimum.order.short",o),"data-test":"checkout-threshold"}:!a&&i&&l?{type:"promotion",message:d?c(l):n("header.order.status.savings",l),"data-test":"savings"}:null},vxt=()=>{const e=F();return h.useCallback(t=>e(ds({name:Jxe,event:t,attributes:{}})),[e])},Kk=()=>{const e=Wk(),t=Yk();return e?cn(t):jt()},lte=()=>f(e=>BR(e)),zk=()=>{const e=f(D("exptr")),t=e_(),n=os({breakpoint:"sm-up"});return e&&!t&&!n},Txt=()=>{const e=L(),t=Cf(),n=qm(),o=zk(),r=t?e.formatMessage("header.topbar.basket.button.aria.label"):`${e.formatMessage("basket.button.alternative")} ${n}`,a=e.formatMessage(o?"basket.button.open.expanded.trolley.alternative":"basket.button.open.basket.page.alternative");return`${r} - ${a}`},cte=()=>{const e=Cf();return{name:Wk()?"orders_edit":"trolley",hidePrice:e}},_xt=()=>{const e=Cf(),t=Sf();return t>0&&!e?{type:"action",value:t,"data-synthetics":"basket-item-counter","data-test":"basket-counter","aria-hidden":"true"}:null},bxt=()=>!e_(),xxt=()=>{const e=zk(),t=i0e(),n=vxt(),o=Kk();return e?{onClick:()=>{t()}}:{to:o,onClick:()=>{n()}}},Qk=()=>f(e=>or(e)),Axt=()=>{const e=uxt(),{currentPage:t}=Ym(),{checkoutWalkGa4Event:n}=pxt(),o=f(Ct),r=f(Ra),a=Qk(),i=(c,d)=>{e({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{CHECKOUT_WALK_PAGE_NAME:t?.pageName,CHECKOUT_WALK_PAGE_SECTION:c.groupTitle,CHECKOUT_WALK_PAGE_SECTION_INDEX:d,CHECKOUT_WALK_PAGE_INDEX:t?.pageIndex,CHECKOUT_WALK_SECTION_PRODUCTS_ENGINE:c.engine}})},l=()=>{n({index:t?.pageIndex,name:t?.pageShortName,currency:r?.currency,value:r?.amount,transactionId:o,groupId:a})};return()=>{t?.productGroups?.forEach(i),l()}},Rxt=()=>{const e=F(),{pathname:t}=Ne(),{currentPage:n,nextPage:o,shouldRefetch:r}=Ym(),a=Axt(),i=h.useRef(!0),l=()=>{if(o){const{pageKey:E}=o;return zg({pageKey:E})}return vr()};if(h.useEffect(()=>{a()},[t]),h.useEffect(()=>(r&&i.current&&(e(FL()),i.current=!1),()=>{e(Hr.clearCheckoutWalk())}),[e,r]),!n)return s.jsx(En,{to:vr()});const{productGroups:c,pageName:d,pageDescription:u}=n,p=c.length>1,g=c.find(E=>E.freeGifts);return s.jsx(dxt,{handleRedirect:l,pageName:d,pageTitle:u,children:g?s.jsx(rxt,{productGroup:g,pageSubtitle:n.pageSubtitle}):c.map((E,y)=>s.jsx(txt,{productGroup:E,shouldDisplayGroupTitle:p},E.freeGifts?.promotions[y]?.promotionId))})},Dxt=()=>s.jsx(Et,{type:"CheckoutWalk::route",children:s.jsx(Rxt,{})}),Oxt=()=>(e,t)=>{const n=xr(t());return e(qy.getWalletItems(n))},Km={getWalletItems:Oxt},Pxt=(e,t,n=100)=>(Math.round(+e*n)+Math.round(+t*n))/n,dte=e=>e.data.orderPayment?.paymentMethodGroups?.data?.overridePaymentMethodGroups,ute=e=>e.data.orderPayment.orderPaymentCheckoutSummary.data,pte=e=>e.data.orderPayment.orderPaymentCheckoutSummary.isFetching||e.data.orderPayment.orderPaymentCheckoutSummaryWithPaymentMethodGroups.isFetching,Xk=e=>D("pcs.v2")(e)?e.data.orderPayment.orderPaymentCheckoutSummaryWithPaymentMethodGroups.data?.totalBufferRate:e.data.orderPayment.orderPaymentCheckoutSummary.data?.totalBufferRate,mte=e=>e.data.orderPayment.orderMultiPayments.data?.payments.filter(t=>t.paymentMethod.category==="MONETARY");Y(mte,e=>e?.reduce((t,n)=>Pxt(t,n.total.amount),0));const Zk=e=>e.data.orderPayment.orderMultiPayments.data?.payments.filter(t=>t.paymentMethod.category==="LOYALTY"),hte=e=>e.data.orderPayment.orderMultiPayments.data?.payments||[],gte=e=>e.data.orderPayment.orderMultiPayments.data?.total,Ete=e=>e.data.orderPayment.orderPaymentCheckoutSummaryWithPaymentMethodGroups.data,Jk=Y(Ete,e=>e?.paymentMethodGroups),Nxt=Y(Jk,e=>e?.find(t=>t.name===dt.LOYALTY&&t.available)),Lxt=({state:e,request:t})=>{const{endpoint:n,httpMethod:o,body:r}=t,a=go({basePath:At(e),target:n}),i=JSON.stringify(r),l={"client-route-id":Do(e),"X-CSRF-TOKEN":Na(e),...i&&{"content-type":"application/json; charset=utf-8"}};return fetch(a,{method:o,credentials:"same-origin",headers:l,body:i}).then(c=>c.ok?c.json():Promise.reject(c))},kxt=e=>e.map(({codeName:t})=>({type:t})),jxt=e=>(t,n)=>{const o=n(),i={endpoint:`/payospgateway/v1/active-psps?${Qe.stringify({paymentFlow:e})}`,httpMethod:"GET"};return Lxt({state:o,request:i}).then(l=>{const c=kxt(l);return t(XQ.pspsFetched(e,c)),c})},fte={fetchActivePsps:jxt},A0=e=>e?e.sort((t,n)=>eg(t.expiryDate)-eg(n.expiryDate)):[],Mxt=e=>{const{availablePaymentChecks:t,checksMissingRequiredTotal:n,maxAmountPayableByPaymentCheck:o}=e?.payload?.responseData||{};return Promise.resolve({payload:{responseData:{availablePaymentChecks:A0(t),checksMissingRequiredTotal:A0(n),maxAmountPayableByPaymentCheck:o}}})},wxt=(e,t,n,o)=>{if(e&&e.payload&&e.payload.responseData){const r=e.payload.responseData||{},{availablePaymentChecks:a,checksMissingRequiredTotal:i}=r;o(U.analyticsEvent({type:Ot.PAYMENT_CHECKS_AVAILABILITY_FETCHED_ANALYTICS,paymentChecks:{availablePaymentChecks:a,checksMissingRequiredTotal:i},customerId:t,orderId:n}))}return Promise.resolve(e)},Fxt=({basketTotal:e,orderId:t})=>(n,o)=>{const r=xr(o());return n(hI.fetchAvailablePaymentChecks({basketTotal:e,orderId:t})).then(a=>Mxt(a)).then(a=>wxt(a,r,t,n))},ej={fetchAvailablePaymentChecks:Fxt},yte=e=>{const t=Ct(e),n=bl(e),o=or(e),r=n?.money?.amount;return{loyaltyAmount:r?Number(r):null,orderId:t,groupId:o}},Bxt=e=>async(t,n)=>{const o=n(),r=Ct(o);try{await t(lS.addLoyaltyUnitsToBasket(e)),await t(Yt.getBasket()),Z.success("basket.add.loyalty.units.success");const{loyaltyAmount:a,groupId:i}=yte(o),l={transactionId:r,loyaltyAmount:a,groupId:i};t(U.analyticsEvent({type:$I.USE_LOYALTY,...l}));const c={event:"use_loyalty",osp_transaction_id:r,loyalty_amount:a??0,group_id:i};te.sendEvent({GA:c,WA:null}),t(sr.getPaymentCheckoutSummaryService()),t(U.analyticsEvent({type:Le.LOYALTY_POINTS_ADD_SUCCESS,payload:{pageEventAttributes:{type:"loyaltyPayment",orderId:r}}}))}catch{t(U.analyticsEvent({type:Le.LOYALTY_POINTS_ADD_FAILURE,payload:{pageEventAttributes:{type:"loyaltyPayment",orderId:r}}})),Z.error("basket.add.loyalty.units.error")}},Uxt=()=>async(e,t)=>{try{const n=t();await e(lS.removeLoyaltyUnitsFromBasket()),await e(Yt.getBasket()),DV(n)==="ORDER_EDIT"&&Z.success("loyalty.units.remove.notification.refresh");const{orderId:o,loyaltyAmount:r,groupId:a}=yte(n),i={transactionId:o,loyaltyAmount:r,groupId:a};e(U.analyticsEvent({type:$I.REMOVE_LOYALTY,...i}));const l={event:"remove_loyalty",osp_transaction_id:o??"",loyalty_amount:r??0,group_id:a};te.sendEvent({GA:l,WA:null}),e(sr.getPaymentCheckoutSummaryService())}catch{Z.error("basket.remove.loyalty.units.error")}},Pg={addLoyaltyUnitsToBasket:Bxt,removeLoyaltyUnitsFromBasket:Uxt},Gxt=()=>async(e,t)=>{const n=t(),o=D("cdm")(n),r=xn(n)?.slotId;!o||!r||await e(Zr.getConciergeDelivery(r))},$xt=e=>async(t,n)=>{const o=n(),a=is(o)?.orderId,l=xn(o)?.slotId;!l||!a||await t(Zr.saveConciergeDelivery({slotId:l,isLeftAtConcierge:e,orderId:a}))},Ite={getConciergeDelivery:Gxt,saveConciergeDelivery:$xt},Bh=e=>{switch(e){case"vouchers.validation.failure.accountCountCondition":case"CUSTOMER_USAGE_EXCEEDED":return"vouchers.validation.failure.account.count.condition";case"vouchers.validation.failure.checkoutDateCondition":case"WRONG_CHECKOUT_DATE":return"vouchers.validation.failure.checkout.date.condition";case"vouchers.validation.failure.deliveryDateCondition":case"WRONG_DELIVERY_DATE":return"vouchers.validation.failure.delivery.date.condition";case"vouchers.validation.failure.firstTimeShopperCondition":case"CUSTOMER_NOT_FIRST_TIME_SHOPPER":return"vouchers.validation.failure.first.time.shopper.condition";case"vouchers.validation.failure.globalCountCondition":case"GLOBAL_USAGE_EXCEEDED":return"vouchers.validation.failure.global.count.condition";case"vouchers.validation.failure.shoppingNumberCondition":return"vouchers.validation.failure.shopping.number.condition";case"vouchers.validation.failure.voucherAssignedToAccountCondition":case"WRONG_CUSTOMER":return"vouchers.validation.failure.voucher.assigned.to.account.condition";case"vouchers.validation.failure.voucherExistsForCodeCondition":case"CODE_NOT_FOUND":case"PromotionNotFound":case"PROMOTION_NOT_FOUND":return"vouchers.validation.failure.voucher.exists.for.code.condition";case"vouchers.validation.failure.voucherDeactivatedCondition":return"vouchers.validation.failure.voucher.deactivated.condition";case"BetterPromotionWasAvailable":case"BETTER_PROMOTION_WAS_AVAILABLE":return"vouchers.validation.failure.better.promotion.was.available";case"ItemMinimumSpendNotMet":case"ITEM_MINIMUM_SPEND_NOT_MET":return"vouchers.validation.failure.item.minimum.spend.not.met";case"MinimumSpendNotMet":case"MINIMUM_SPEND_NOT_MET":return"vouchers.validation.failure.minimum.spend.not.met";case"ProductsToBuyMissingInBasket":case"PRODUCTS_TO_BUY_MISSING_IN_BASKET":case"ProductsToRewardMissingInBasket":case"PRODUCTS_TO_REWARD_MISSING_IN_BASKET":return"vouchers.validation.failure.products.missing.in.basket";case"NoLegalToPromoteItems":case"NO_LEGAL_TO_PROMOTE_ITEMS":return"vouchers.validation.failure.no.legal.to.promote.items";case"basket-ws-100":return"too.many.requests.error.message";case"MARKETING_CONSENTS_NOT_PROVIDED":return"vouchers.validation.failure.marketing.consents.not.provided";default:return"vouchers.validation.failure.unknown.reason"}},Hxt=D("mktg.vou"),Vxt=(e,t,n,o)=>{const{formatNumber:r}=n,i=(t?.vouchers||[]).find(c=>c.voucherId===e);if(!i)return e;const l=ii(r,i.savings,o);return`${e} (${l})`},Wxt=(e,t,n)=>async(o,r)=>{let a;try{if(Hxt(r())){a=await o(ec.addVoucherWithMarketingPreferences(e,n));const{voucherAddResult:u}=a.payload.responseData;if(!u?.valid||!u?.inBasket){const p=t.formatMessage(Bh(u?.errorCode));return o(U.analyticsEvent({type:Re.VOUCHER_ADD_FAILURE,voucherId:e,failureMessage:p})),p}n&&Z.info("marketing.preferences.update.success")}else{a=await o(ec.addVoucherToBasket(e));const{vouchersAddResult:u}=a.payload.responseData;if(!u.length||!u[0]?.valid||!u[0]?.inBasket){const p=t.formatMessage(Bh(u[0]?.validationErrorCode));return o(U.analyticsEvent({type:Re.VOUCHER_ADD_FAILURE,voucherId:e,failureMessage:p})),p}}}catch{const p=t.formatMessage(Bh(void 0));return o(U.analyticsEvent({type:Re.VOUCHER_ADD_FAILURE,voucherId:e,failureMessage:p})),p}o(sr.getPaymentCheckoutSummaryService());let i=r();const l=await o(Yt.getCheckoutBasket({appliedPaymentCheckId:FR(i)?.paymentCheckId,fetchAllocatedPaymentChecks:D("pay.check.use")(i)}));if(i=r(),o(yu(a?.payload.responseData.pricingNotifications,!0)),o(U.analyticsEvent({type:Re.VOUCHER_ADD_SUCCESS,voucherId:e,tickboxName:t.formatMessage("marketing.optin.vouchers.title"),tickboxSelected:n!==void 0?n:null,voucherDescription:Vxt(e,l,t,Bi(i))})),tpe(i).every(u=>u.voucherId!==e)){o(U.analyticsEvent({type:HI.USE_PROMOTION_CODE,voucherCode:e,transactionId:Ct(i),groupId:or(i)}));const u={event:"use_promotion_code",id:e,group_id:or(i),osp_transaction_id:Ct(i)||""};te.sendEvent({GA:u,WA:null})}return o(J.closeModal()),Z.success("checkout.summary.basket.summary.voucher.success"),null},Yxt=e=>(t,n)=>t(ec.removeVoucherFromBasket(e.voucherId)).then(async o=>{const r=n(),a=FR(r);await t(Yt.getCheckoutBasket({appliedPaymentCheckId:a?.paymentCheckId})),t(yu(o?.payload.responseData.pricingNotifications??[],!0)),t(sr.getPaymentCheckoutSummaryService()),t(U.analyticsEvent({type:Re.VOUCHER_REMOVED,voucherId:e.voucherId,voucherDescription:`${e.voucherId} (${e.savings})`}));const i=Ct(r),l=or(r);t(U.analyticsEvent({type:HI.REMOVE_PROMOTION_CODE,voucherCode:e.voucherId,transactionId:i,groupId:l}));const c={event:"remove_promotion_code",id:e.voucherId,group_id:or(r),osp_transaction_id:Ct(r)??""};te.sendEvent({GA:c,WA:null}),Z.success("checkout.summary.basket.summary.voucher.removed")}).catch(o=>{throw new Error(o)}),NS={addVoucherToBasket:Wxt,removeVoucherFromBasket:Yxt},qxt=v.object`
    inline-size: 100%;
`,Kxt=({altText:e,url:t})=>t?s.jsx("div",{className:"salt-m-t--16",children:s.jsx(qxt,{title:e,data:t,type:"image/svg+xml","data-test":"age-restriction-banner"})}):null,zxt=e=>({url:Ze(e,"french-age-restriction-banner-url")||void 0,altText:Ze(e,"french-age-restriction-banner-alternative-text")||void 0}),t_=we(zxt)(Kxt),Ste=(e="en")=>new Intl.Collator(e,{numeric:!0}).compare,Qxt=e=>{const t=Ste(e);return(n,o)=>t(n.sellerName||"",o.sellerName||"")},Cte=(e,t,n)=>{const o=Ste(n),a=[...e.keys()].filter(l=>l!==t.sellerName).sort(o);return[t.sellerName,...a].map(l=>({sellerName:l,products:e.get(l)})).filter(l=>l.products)};function tj(e,t,n){const o=e.find(i=>i.sellerName===t),a=e.filter(i=>i.sellerName!==t).sort(Qxt(n));return o?[o,...a]:a}function _y(e){return qe(e.expirationDate,qe.ISO_8601,!0).isValid()}function R0(e){return[...e].sort((t,n)=>!_y(t)&&!_y(n)?0:_y(t)?_y(n)&&qe(n.expirationDate).isBefore(qe(t.expirationDate))?1:-1:1)}function Xxt(e,t){return t?.map(n=>({sellerId:n.sellerId,sellerName:n.sellerName,groupName:n.sellerName,items:e?.products?.filter(o=>o.sellerId===n.sellerId)?.map(o=>o.productId)||[]}))||[]}const vte=({basketItems:e=[],blurOverlay:t,orderItems:n=[],isOrderConfirmation:o=!1})=>{const r=f(E=>Ze(E,"seller-sales-enabled")==="true"),a=f(AP),i=f(xP)||[],l=f(bv)||[],c=f(l2e),d=f(ts),u=f(_C),p=f(Ms);let g=[];return o||(g=r&&u?.length?u:[{items:e?.map(E=>E.productId)||[]}]),o&&(r?g=tj(Xxt(a,l),c,p):g=[{items:i?.map(E=>E.product?.productId||"")||[],sellerId:"",sellerName:""}]),s.jsx(Q,{"data-test":"expanded-products-list",gap:["sm"],className:"salt-m-t--4",children:g.map(({groupName:E,items:y})=>{let I=[];return o?r?I=n?.filter(S=>y.includes(S.productId))||[]:I=i?.map(S=>({productId:S.product?.productId,quantity:{quantityInBasket:S.quantity}}))||[]:I=e?.filter(S=>y.includes(S.productId))||[],s.jsxs(h.Fragment,{children:[r&&E&&!!y.length&&s.jsx(tl,{className:"salt-d--block salt-m-t--4 salt-m-b--2",groupName:E}),I?.map(S=>{const C=d[S.productId];return s.jsx(gJ,{basketItem:S,fullWidth:!0,blurOverlay:t,children:C&&s.jsx(O,{className:"salt-m-l--2",children:s.jsx("span",{translate:"no",children:`${S.quantity.quantityInBasket}x ${C.name}`})})},S.productId)})]},E)})})},Zxt=({basketItems:e,isOrderConfirmation:t})=>{const[n]=Ee(["ord.def.col"]),o=os({breakpoint:"lg-up"}),[r,a]=h.useState(o&&!n),i=f(AP),l=f(xP)||[],c=f(T=>Ze(T,"seller-sales-enabled")==="true"),d=L(),u=d.formatMessage("checkout.summary.basket.overview.header.main"),p=ft(),g=()=>{p({type:r?Ve.ITEM_WINDOW_REDUCED:Ve.ITEM_WINDOW_EXPANDED}),a(!r)},{currentBreakpoint:E}=h.useContext(kn),I=["md","lg"].includes(E)?s.jsx(Tu,{}):void 0;let S=[],C=[];return t?(c?S=i?.products?.map(T=>({...T,quantity:{quantityInBasket:T.quantity}}))||[]:S=l?.map(T=>({productId:T.product?.productId,quantity:{quantityInBasket:T.quantity}}))||[],C=S):C=e,s.jsx("div",{className:"salt-m-b--4",children:s.jsxs(Je,{expanded:r,onToggle:g,aria:{expandedLabel:d.formatMessage("checkout.summary.basket.overview.header.main"),collapsedLabel:d.formatMessage("checkout.summary.basket.overview.header.main")},children:[s.jsx(hf,{name:u,basketItems:C}),s.jsxs(Je.ControlSection,{children:[s.jsx(Gm,{basketItems:C,name:u}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentCollapsed,{children:s.jsx(VT,{basketItems:C,visible:!r,setExpanded:a})}),s.jsx(Je.ContentExpanded,{isScrollHidden:!0,children:s.jsx(vte,{basketItems:e,blurOverlay:I,orderItems:S,isOrderConfirmation:t})})]})})},Jxt=e=>({basketItems:_l(e)}),Tte=Tt(we(Jxt))(Zxt),_te=(e,t)=>({OUT_OF_STOCK:t.formatMessage("product.availability.out.of.stock",{itemQty:e.missingAmount}),TIME_RESTRICTION:e.deliveryTimeRestrictionMessage??t.formatMessage("product.availability.time.restriction",{to:e.timeRestriction?.deliverableTo,from:e.timeRestriction?.deliverableFrom}),LIMITED_AVAILABILITY:t.formatMessage("product.availability.limited",{addedAmount:e.addedAmount,requestedAmount:e.requestedAmount}),CHECKOUT_TIME_RESTRICTED:e.checkoutTimeRestrictionMessage??t.formatMessage("product.checkout.time.restriction",{to:e.checkoutTimeRestriction?.checkoutTo,from:e.checkoutTimeRestriction?.checkoutFrom}),EXCEEDED_MAX_QUANTITY:t.formatMessage("fop.max.quantity")}),eAt=()=>{const e=L(),t=f(KZe);return s.jsx(Be,{inline:!1,children:t.map(n=>s.jsx(Be.Item,{children:s.jsx(xe,{condensed:!0,children:s.jsx(Ef,{product:n,messages:_te(n,e)})})},n.productId))})},Ng="UNAVAILABLE_ITEMS_MODAL_NAME",tAt=()=>{const{removeInvalidProducts:e,isRemovingProducts:t,isModalOpen:n,closeModal:o,checkoutErrorCode:r}=rAt();return s.jsxs(B,{showCloseIcon:!0,onRequestClose:o,isOpen:n,aria:{labelledby:Ng},children:[s.jsx(B.Header,{align:"left","aria-live":"polite",children:s.jsx(ee,{as:"h1",id:Ng,children:s.jsx(b,{id:"checkout.summary.invalid.items.modal.title"})})},"header"),s.jsxs(B.Body,{children:[s.jsx(Te,{className:"salt-m-b--2",intent:"error",size:"s",text:s.jsx(b,{id:"slotbooking.modal.oos.items.unavailable"})}),s.jsx(eAt,{})]},"body"),s.jsxs(B.Footer,{align:"left",children:[r===jX?s.jsx(x,{className:"salt-m-r--1",onClick:o,intent:"secondary",fill:!0,asChild:!0,"data-test":"back-to-basket",children:s.jsx(tt,{intent:"ghost",href:jt(),children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.invalid.items.modal.back.to.cart"})})})}):s.jsx(x,{className:"salt-m-r--1",onClick:o,intent:"secondary",fill:!0,asChild:!0,"data-test":"find-another-slot",children:s.jsx(tt,{intent:"ghost",href:Tr({inCheckoutWalk:!0}),children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.invalid.items.modal.find.slot"})})})}),s.jsx(x,{className:"salt-m-l--1",onClick:e,intent:"primary",fill:!0,loading:t,children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.invalid.items.modal.remove.products"})})})]},"footer")]})},sAt={ageConfirmed:!1},bte="PHARMACY_MODAL",nAt=Object.freeze({PENDING:"PENDING",ERROR:"ERROR",OK:"OK",CANCEL:"CANCEL",READY:"READY"}),xte=ae.createContext(sAt),oAt=()=>h.useContext(xte),Ou=()=>{const e=f(D("pay.slct")),t=f(D("pay.pmf"));return e&&t},rAt=()=>{const e=F(),[t,n]=h.useState(!1),o=f($Q),r=Ge(),a=f(Yn(Ng))?.checkoutErrorCode,i=f($e(Ng)),l=o?.limitedProducts||[],c=o?.cartSplitRequired||!1,d=()=>e(J.closeModal()),u=(g,E)=>{if(c||g&&E){const y=g&&E;r(jt(),{state:{isBasketBelowThreshold:y}})}};return{removeInvalidProducts:()=>{n(!0),e(ir.removeBasketItems(l.map(({productId:g,missingAmount:E})=>({productId:g,quantity:E})))).then(g=>{const E=g?.basket;u(!E?.checkout?.basketAboveThreshold,!!E?.checkout?.minimumCheckoutThreshold),d()}).catch(()=>(n(!1),Z.error("request.error.title")))},isRemovingProducts:t,isModalOpen:i,closeModal:d,checkoutErrorCode:a}},Lg=()=>{const e=f(D("pcs.v2"));return f(t=>e?Ete(t):ute(t))},Ate=()=>{const e=f(D("pcs.v2"));return f(t=>e?Jk(t):dte(t))},sj=()=>{const e=f(D("pcs.v2")),t=f(D("oed")),n=f(D("loy.waon")),o=Lg();return!t||!n?!1:e?o?.paymentMethodGroups?.filter(({name:r,displayable:a})=>a&&r!=="LOYALTY").length===0:Number(o?.checkoutPayment?.amountPaidByCustomer)===0&&Number(o?.checkoutPayment?.amountToBeCharged)===0},Rte=()=>{const e=f(D("pcs.v2")),t=f(D("oed")),n=f(D("loy.waon")),o=Lg();if(!t||!n)return{hideLoyaltyPaymentButton:!1,disableLoyaltyPaymentButton:!1};if(e){const r=o?.paymentMethodGroups?.find(({name:a})=>a==="LOYALTY");return{hideLoyaltyPaymentButton:!r?.displayable,disableLoyaltyPaymentButton:!r?.available}}else return{hideLoyaltyPaymentButton:Number(o?.checkoutPayment?.amountToBeCharged)===0&&Number(o?.checkoutLoyaltyPayment?.amountToBeCharged)===0,disableLoyaltyPaymentButton:!1}},aAt=(e,t)=>{const{deliveryTimeInMinutes:n,collectionTimeInMinutes:o}=t||{},r=Lv(e);return n&&o?e.formatMessage("checkout.summary.express.collection.info",{readyTimeSpan:r(n),maxTimeSpan:r(o)}):null},iAt=e=>{const t=f(D("md.sl")),n=e?.deliveryMethod===pt.clickAndCollect.method,o=e?.slotType==="STANDARD",r=e?.deliveryStartDate?.slice(0,10)!==e?.deliveryEndDate?.slice(0,10);return t&&n&&o&&r},Dte=e=>{const t=L(),n=iAt(e),o=e?.deliveryType===pt.clickAndCollect.type,r=e?.deliveryType===pt.vanDelivery.type,a=e?.slotType==="ON_DEMAND",i=r&&a,l=o&&a,c=o?t.formatMessage("checkout.summary.collection.title"):t.formatMessage("checkout.summary.delivery.title"),d=l&&aAt(t,e);return{isCollection:o,isFastDelivery:i,standardTitle:!l&&!n&&c,expressCollectionTitle:(l||n)&&t.formatMessage("express.collection.delivery.card.title"),expressCollectionDescription:d,shouldShowStandardDateForExpressCollection:n||l&&!d}},lAt=()=>{const e=Ou(),t=f(tN);return e&&t===dt.CASH_ON_DELIVERY},cAt=()=>{const e=F(),t=Ou(),n=f(tN),o=Bn(n);h.useEffect(()=>{t&&o!==n&&n===dt.CASH_ON_DELIVERY&&e(Zr.setConciergeDelivery(!1))},[n,e,t,o])},Ote=({message:e})=>{const t=L();return s.jsx(Te,{size:"s",intent:"warning",text:s.jsxs(O,{"data-test":"delivery-collection-point",children:[t.formatMessage("checkout.delivery.collection.point.label")," ",e]})})},s_=({delivery:e})=>e?.address?s.jsx("div",{className:"salt-m-t--2 salt-overflow-wrap--anywhere",children:s.jsxs(O,{"data-pii":"true",bold:!0,children:[s.jsx(b,{id:"checkout.summary.delivery.address.label"}),": ",s.jsxs(O,{"data-test":"delivery-address-body",children:[e.addressNickName&&`${e.addressNickName} - `,e.address]})]})}):null,nj=({delivery:e})=>e?.addressNotes?s.jsx("div",{className:"salt-m-t--2",children:s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"settings.address.book.add.modal.notes.label"}),": ",s.jsx(O,{"data-test":"delivery-address-notes",children:e.addressNotes})]})}):null,oj=({externalAddress:e})=>{const{addressDetails:t,externalCollectionPointId:n}=e;return t.openingHours&&t.locationDescription?s.jsx(O,{size:"m",children:s.jsx(b,{id:"delivery.card.locker.external.address.with.location.description.and.opening.hours",values:{lockerName:n,externalAddress:t.formattedAddress,locationDescription:t.locationDescription,openingHours:t.openingHours}})}):t.openingHours?s.jsx(O,{size:"m",children:s.jsx(b,{id:"delivery.card.locker.external.address.with.opening.hours",values:{lockerName:n,externalAddress:t.formattedAddress,openingHours:t.openingHours}})}):t.locationDescription?s.jsx(O,{size:"m",children:s.jsx(b,{id:"delivery.card.locker.external.address.with.description",values:{lockerName:n,externalAddress:t.formattedAddress,locationDescription:t.locationDescription}})}):s.jsx(O,{size:"m",children:s.jsx(b,{id:"delivery.card.locker.external.address",values:{lockerName:n,externalAddress:t.formattedAddress}})})},rj=e=>e.data.delivery.deliveryDetails,dAt=Y(rj,e=>e.isFetching);Y(rj,e=>e.error);const Hl=Y(rj,e=>e.options),aj=Y(Hl,e=>e?.additionalInformation),Pte=Y(Hl,e=>e?.dropOff),n_=Y(Pte,e=>e?.options||[]),ij=Y(Pte,e=>e?.options.find(t=>t.id===e?.selectedId)),Nte=Y(Hl,e=>e?.entryInstructions),Lte=Y(Nte,e=>e?.options.find(t=>t.id===e?.selectedId)),lj=Y(Nte,e=>e?.options||[]),uAt=e=>Y(lj,t=>e&&t.length?t.filter(n=>n.dropOffAssignment.includes(e)):[]),cj=e=>Y(n_,t=>t.find(n=>n.id===e)),dj=e=>Y(lj,t=>t.find(n=>n.id===e)),pAt=e=>Y(cj(e),t=>t?.entryInstructionsRequired||!1),mAt=e=>Y(dj(e),t=>t?.additionalInformationRequired||!1),kte=Y(Hl,e=>e?.deliveryAsset),o_=Y(kte,e=>e?.options||[]),jte=e=>Y(o_,t=>e?t.filter(n=>!n.dropOffAssignment||n.dropOffAssignment.includes(e)):t.filter(n=>!n.dropOffAssignment)),hAt=e=>Y(o_,t=>t.find(n=>n.id===e)),gAt=Y(kte,e=>e?.options.find(t=>t.id===e?.selectedId)),EAt=({onConfirm:e,isLoading:t})=>{const{formatMessage:n}=L();return s.jsx(x,{intent:"primary",loading:t,onClick:e,"data-test":`${mj}-confirm-button`,fill:!0,children:s.jsx(x.Text,{children:n("delivery-details-modal.confirm-button.label")})})},fAt="UNATTENDED",yAt="ATTENDED_WITH_UNATTENDED_CONSENT",IAt=D("daddi"),Mte=e=>async(t,n)=>{const{formData:o,deliveryDestinationId:r}=e,{additionalInformationValue:a,entryInstructionId:i,dropOffId:l,deliveryAssetId:c}=o,d=n(),u=Ct(d),p=vn(d),g=Hl(d),E={additionalInformation:g?.additionalInformation?.value!==a,entryInstruction:i&&g?.entryInstructions?.selectedId!==i,dropOff:l&&g?.dropOff?.selectedId!==l,deliveryAsset:c&&g?.deliveryAsset?.selectedId!==c},y=Object.values(E).some(Boolean);if(u&&r&&y&&p){const I={additionalInformation:{value:a},...i?{entryInstruction:{id:i}}:{},...l?{dropOff:{id:l}}:{},...c?{deliveryAsset:{id:c}}:{}},S=await t(dd.updateDeliveryOptions({orderId:u,regionId:p,deliveryDestinationId:r,data:I}));if(S?.payload?.responseData)return t(dd.setDeliveryOptions(S.payload.responseData)),S.payload.responseData}return null},uj=({deliveryDestinationId:e})=>async(t,n)=>{const o=n(),r=IAt(o),a=Ct(o),i=vn(o);if(r&&a&&e&&i)try{await t(dd.getDeliveryOptions(a,e,i))}catch{Z.error("toast.notification.generic.error")}},hs={ADDITIONAL_INFORMATION:"additionalInformation",DROP_OFF_OPTION:"dropOffOption",ENTRY_INSTRUCTION:"entryInstruction",DELIVERY_ASSET:"deliveryAsset"},SAt=400,Uh="onSubmit",CAt=({deliveryDestinationId:e,forceDeliveryAssetSelectVisibility:t})=>{const n=F(),[o,r]=h.useState(!1),a=f(lj),i=f(o_),l=f(ij),c=f(Lte),d=f(gAt),u=f(aj),p={[hs.DROP_OFF_OPTION]:l?.id||"",[hs.ENTRY_INSTRUCTION]:c?.id||"",[hs.ADDITIONAL_INFORMATION]:u?.value||"",[hs.DELIVERY_ASSET]:d?.id||""},g=Dn({defaultValues:p,mode:Uh,reValidateMode:Uh}),E=g.watch(hs.DELIVERY_ASSET,d?.id||""),y=A=>{const R=A.target.value;I(R),S(R)},I=A=>{const R=g.getValues(hs.ENTRY_INSTRUCTION);a.filter(k=>k.dropOffAssignment.includes(A)).some(k=>k.id===R)||(g.resetField(hs.ENTRY_INSTRUCTION,{defaultValue:""}),g.clearErrors([hs.ENTRY_INSTRUCTION,hs.ADDITIONAL_INFORMATION]))},S=A=>{i.filter(N=>!N.dropOffAssignment||N.dropOffAssignment.includes(A)).some(N=>N.id===E)||(g.setValue(hs.DELIVERY_ASSET,""),g.clearErrors([hs.DELIVERY_ASSET]),t())},C=()=>{g.unregister(hs.ADDITIONAL_INFORMATION)},T=A=>A[hs.DROP_OFF_OPTION]?ah.DROP_OFF:A[hs.ENTRY_INSTRUCTION]?ah.ENTRY_INSTRUCTIONS:A[hs.ADDITIONAL_INFORMATION]?ah.ADDITIONAL_INFORMATION:A[hs.DELIVERY_ASSET]?ah.DELIVERY_ASSETS:null,_=async()=>{r(!0);const A=await g.trigger();let R;if(A){const P=g.getValues();try{const N=await n(Mte({deliveryDestinationId:e,formData:{additionalInformationValue:P[hs.ADDITIONAL_INFORMATION]||"",dropOffId:P[hs.DROP_OFF_OPTION],entryInstructionId:P[hs.ENTRY_INSTRUCTION],deliveryAssetId:E}}));return N&&Z.success("delivery-details-saved.toast"),n(J.closeModal()),r(!1),{updatedDeliveryOptions:N,errorType:null}}catch{R=ah.API_ERROR,Z.error("toast.notification.generic.error")}}else{const{errors:P}=g.formState;R=T(P)}return r(!1),{updatedDeliveryOptions:null,errorType:R}};return{formContext:g,isUpdating:o,defaultValues:p,dropOffDefaultOptionTitle:l?.displayValue,handleSubmit:_,handleDropOffChange:y,handleEntryInstructionChange:C}},vAt=()=>{const e=f(D("dass")),t=L(),n=t.formatMessage({id:"delivery-details-modal.unattended-handover-disclaimer.text"}),o=t.formatMessage({id:"delivery-details.packaging-protection-info.text"}),r=e?n:t.formatMessage({id:"delivery-details-modal.unattended-handover-complete-disclaimer.text"},{liability_disclaimer:n,packaging_protection_info:o});return s.jsx(O,{"data-test":"delivery-details-modal-unattended-handover-disclaimer-text",size:"s",children:r})},pj=(e,t,n)=>e({id:"delivery-details-modal.select-field.accessibility.required-error.label"},{fieldTitle:t,errorMessage:n}),TAt=({intl:e,required:t,optionSelected:n,hasError:o=!1,fieldTitle:r="",errorMessage:a=""})=>{const{formatMessage:i}=e,l={label:r,placeholder:i("delivery-details-modal.delivery-asset-selector.select-option"),required:a,helperText:i("delivery-details.packaging-protection-info.text")},c=o?pj(i,r,a):i(n?"delivery-details.delivery-asset-selector.filled-with-description.option.accessibility.label":"delivery-details-modal.delivery-asset-selector.accessibility.select-option.label",{required:t?i("validation.msg.required"):"",title:l.label,packagingProtectionInfo:l.helperText,optionSelected:n});return{...l,ariaLabel:c}},wte=({customLabel:e,required:t=!0,options:n=[],onChange:o=()=>{},mode:r})=>{const a=L(),{formatMessage:i}=a,l=po(),c=Od({name:hs.DELIVERY_ASSET}),d=i4(),u=f(hAt(c)),p=!!l.formState.errors[hs.DELIVERY_ASSET],g=i("delivery-details.delivery-asset-selector.title"),E=i("delivery-details-modal.validation.error.delivery-asset-not-selected"),y=h.useMemo(()=>n.map(S=>({value:S.id,label:d({item:S})})),[n]);if(n.length===0)return null;const I=TAt({intl:a,required:t,optionSelected:d({item:u}),hasError:p,fieldTitle:g,errorMessage:E});return s.jsx(Am,{name:hs.DELIVERY_ASSET,label:e||I.label,onChangeCallback:o,"data-test":"delivery-asset-select",placeholder:I.placeholder,helperText:I.helperText,ariaLabel:I.ariaLabel,defaultValue:c,required:{value:t,message:I.required||""},options:y,mode:r})},_At=({onChange:e,mode:t,options:n})=>{const{formatMessage:o}=L(),r=po(),a=Od({name:hs.DROP_OFF_OPTION}),i=f(cj(a)),l=!!r.formState.errors[hs.DROP_OFF_OPTION],c=o("delivery-details-modal.drop-off-options.title"),d=o("delivery-details-modal.validation.error.drop-off-options-not-selected");if(n.length===0)return null;const u=()=>l?pj(o,c,d):i?o({id:"delivery-details-modal.drop-off.filled.option.accessibility.label"},{required:o("validation.msg.required"),option_selected:i.displayValue}):o({id:"delivery-details-modal.drop-off.select.option.accessibility.label"},{required:o("validation.msg.required")}),p={label:c,placeholder:o("slot.booking.delivery.select-drop-off-option"),required:d,ariaLabel:u()},g=n.map(E=>({value:E.id,label:E.displayValue}));return s.jsx(Am,{name:hs.DROP_OFF_OPTION,label:p.label,onChangeCallback:e,"data-test":"drop-off-select",placeholder:p.placeholder,defaultValue:a,ariaLabel:p.ariaLabel,required:{value:!0,message:p.required},options:g,mode:t})},bAt=({options:e,onChange:t,mode:n})=>{const{formatMessage:o}=L(),r=po(),a=Od({name:hs.DROP_OFF_OPTION}),i=f(pAt(a)),l=Od({name:hs.ENTRY_INSTRUCTION}),c=f(dj(l)),d=!!r.formState.errors[hs.ENTRY_INSTRUCTION],u=o("delivery-details-modal.entry-instructions.title"),p=o("delivery-details-modal.validation.error.entry-instructions-not-selected");if(!e.length)return null;const g=()=>d?pj(o,u,p):c?o({id:"delivery-details-modal.entry.instructions.filled.option.accessibility.label"},{required:i?o("validation.msg.required"):"",option_selected:c.displayValue}):o({id:"delivery-details-modal.entry.instructions.select.option.accessibility.label"},{required:i?o("validation.msg.required"):""}),E={label:u,placeholder:o("delivery-details-modal.select-instructions.title"),required:p,ariaLabel:g()},y=e.map(I=>({value:I.id,label:I.displayValue}));return s.jsx(Am,{name:hs.ENTRY_INSTRUCTION,label:E.label,onChangeCallback:t,"data-test":"entry-instruction-select",placeholder:E.placeholder,ariaLabel:E.ariaLabel,defaultValue:l,required:{value:i,message:E.required},options:y,mode:n})},xAt=({formContext:e})=>{const t=f(D("dede")),{formatMessage:n}=L(),{getValues:o}=e,r=o(hs.ENTRY_INSTRUCTION),a=o(hs.ADDITIONAL_INFORMATION),i=f(dj(r)),l=f(mAt(r)),c=f(aj),d=t&&l,u=d?n({id:"validation.msg.required"}):"",p=i?.additionalInformationHint||c?.defaultHint||"",g=t?"delivery-details-modal.additional-information.title":"delivery-instructions.title",E=t?n(a?"delivery-details-modal.additional.instructions.filled.option.accessibility.label":"delivery-details-modal.additional.information.select.option.accessibility.label",a?{required:u,information_entered:a}:{required:u,hint:p}):n(a?"delivery-details-modal.delivery.instructions.filled.option.accessibility.label":"delivery-details-modal.delivery.instructions.select.option.accessibility.label",a?{required:u,informationEntered:a}:{required:u,hint:p});return{additionalInfoLabel:g,additionalInfoAriaLabel:E,isAdditionalInfoRequired:d,additionalInfoPlaceholder:p}},AAt=({formContext:e,shouldShowMoreDeliveryDetails:t=!1,showDeliveryAssetSelect:n=!1,handoverType:o,dropOffOptions:r,instructionOptions:a,deliveryAssetOptions:i,onSubmit:l,handleDropOffChange:c,handleEntryInstructionChange:d})=>{const{additionalInfoLabel:u,additionalInfoAriaLabel:p,isAdditionalInfoRequired:g,additionalInfoPlaceholder:E}=xAt({formContext:e}),y=t&&(o===fAt||o===yAt);return s.jsx(On,{...e,children:s.jsxs("form",{"data-test":`${mj}-form`,onSubmit:e.handleSubmit(l),children:[t&&s.jsxs(h.Fragment,{children:[s.jsx(_At,{options:r,onChange:c,mode:Uh}),s.jsx(bAt,{options:a,onChange:d,mode:Uh})]}),s.jsx(iT,{name:hs.ADDITIONAL_INFORMATION,label:u,ariaLabel:p,formattedPlaceholder:E,required:g,requiredMessage:"delivery-details-modal.validation.error.additional-information-is-empty",maxLength:SAt}),n&&s.jsx(wte,{options:i,mode:Uh}),y&&s.jsx(vAt,{})]})})},RAt=({className:e})=>{const{formatMessage:t}=L(),o=f(D("dede"))?"delivery-details-modal.title":"delivery-instructions.title";return s.jsx(ee,{as:"h1",className:e,children:t(o)})},vf="DELIVERY_DETAILS_MODAL_NAME",mj="delivery-details-modal",Fte=({trigger:e=Vx.DELIVERY_OPTIONS_CLICKED,onDeliveryDetailsSaved:t=()=>{},handleModalClose:n=()=>{},showDeliveryAssetInitially:o=!0,deliveryDestinationId:r})=>{const[a,i]=h.useState(!1),[l,c]=h.useState(null),d=F(),u=f($e(vf)),[p,g]=Ee(["dede","dass"]),{deliveryDetailsModalDisplayed:E,deliveryOptionsViewed:y}=Or(),I=()=>{i(!0)},S=()=>{i(!1)},{formContext:C,isUpdating:T,defaultValues:_,dropOffDefaultOptionTitle:A,handleSubmit:R,handleDropOffChange:P,handleEntryInstructionChange:N}=CAt({forceDeliveryAssetSelectVisibility:I,deliveryDestinationId:r}),k=Od({control:C.control,name:hs.DROP_OFF_OPTION}),M=f(cj(k)),w=f(n_),j=f(uAt(k)),G=f(jte(k)),W=!!(g&&(o||a)&&G.length);h.useEffect(()=>{u&&(S(),C.reset(_),y({selectedDropOff:A}))},[u]);const H={trigger:e,deliveryInstructionsEnabled:!0,unattendedDeliveryEnabled:!!(p&&w.length),assetChoiceEnabled:W,dropOffOptionsSelected:M?.displayValue,...l?{errorDisplayed:l}:{}},K=()=>{E({...H,modalClosed:XF.CLOSED}),c(null),d(J.closeModal()),C.reset(),n()},X=()=>{R().then(({updatedDeliveryOptions:ne,errorType:ue})=>{ue&&!l?c(ue):ue||(E({...H,modalClosed:XF.CONFIRMED}),c(null)),ne&&t(ne)})},q={handoverType:M?.handoverType,formContext:C,shouldShowMoreDeliveryDetails:p,showDeliveryAssetSelect:W,dropOffOptions:w,instructionOptions:j,deliveryAssetOptions:G,onSubmit:R,handleEntryInstructionChange:N,handleDropOffChange:P};return s.jsxs(B,{isOpen:u,onRequestClose:K,asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(RAt,{})}),s.jsx(B.Body,{"data-test":mj,children:s.jsx(AAt,{...q})}),s.jsx(B.Footer,{children:s.jsx(EAt,{onConfirm:X,isLoading:T})})]})},DAt=()=>{const e=F(),t=f(D("daddi")),n=f(D("dede")),o=f(Hl),r=f(ij),a=f(Lte),i=!!o?.additionalInformation?.value,l=t&&(i||!n),c=n&&!!a?.displayValue,d=n&&!!r?.displayValue,u=()=>{e(J.openModal(vf))},p=()=>n?"delivery-view.additional-information.label":i?"delivery-view.delivery-instructions.title":"delivery-view.delivery-instructions.title.empty-content",g=()=>n?"delivery-view.edit-delivery-details-button.title":i?"delivery-view.edit-delivery-instructions-button.title":"delivery-view.add-delivery-instructions-button.title";return{isDeliveryAdditionalInfoEnabled:t,isDeliveryDetailsEnabled:n,showAdditionalInfo:l,showDeliveryDetailsEntry:c,showDeliveryDetailsDropOff:d,onEditDeliveryDetailsClick:u,additionalInfoLabelId:p(),buttonTextId:g(),defaultDeliveryOptions:o,defaultDeliveryDetailsDropOff:r,defaultDeliveryDetailsEntryInstructions:a}},OAt=/\S+/,PAt=e=>OAt.test(e||""),NAt=v.div`
    word-wrap: break-word;
`,hd=({labelId:e="",value:t="",allowEmpty:n=!1})=>{const o=s.jsx(O,{bold:!0,children:s.jsx(b,{id:e})}),r=n||PAt(t);return s.jsx(ae.Fragment,{children:r&&s.jsx(NAt,{className:"salt-m-t--2",children:s.jsx(b,{id:"delivery-view.entry",values:{label:o,value:t}})})})},hj=()=>{const{isDeliveryDetailsEnabled:e,isDeliveryAdditionalInfoEnabled:t,showDeliveryDetailsDropOff:n,defaultDeliveryDetailsDropOff:o,showDeliveryDetailsEntry:r,defaultDeliveryDetailsEntryInstructions:a,showAdditionalInfo:i,additionalInfoLabelId:l,defaultDeliveryOptions:c,onEditDeliveryDetailsClick:d,buttonTextId:u}=DAt();return!t&&!e?null:s.jsxs("div",{"data-test":"pre-order-delivery-details",className:"salt-m-t--4",children:[n&&s.jsx(hd,{labelId:"delivery-view.drop-off-option.label",value:o?.displayValue}),r&&s.jsx(hd,{labelId:"delivery-view.entry-instruction.label",value:a?.displayValue}),i&&s.jsx(hd,{labelId:l,value:c?.additionalInformation?.value,allowEmpty:!e}),s.jsx(x,{fill:!0,className:"salt-m-t--2",onClick:d,intent:"secondary","data-test":"edit-delivery-details",children:s.jsx(x.Text,{children:s.jsx(b,{id:u})})})]})},LAt={DELIVERY_DETAILS_NOT_FOUND:404},Bte=se("GET_DELIVERY_DETAILS"),kAt=e=>({type:"API",payload:{url:`/ecomfulfillments/v1/order/${e}/delivery-details`,options:{method:"GET"},service:"ecomfulfillments",...Bte}}),jAt={getDeliveryDetails:kAt,types:{GET_DELIVERY_DETAILS:Bte}},MAt=D("daddi"),wAt=({orderId:e}={})=>{const t=F(),n=f(MAt),[o,r]=h.useState(null),[a,i]=h.useState(!1);return h.useEffect(()=>{(async()=>{if(n&&e){i(!0);try{const c=await t(jAt.getDeliveryDetails(e));c?.payload?.responseData&&r(c.payload.responseData)}catch(c){c.statusCode!==LAt.DELIVERY_DETAILS_NOT_FOUND&&Z.error("toast.notification.generic.error")}finally{i(!1)}}})()},[e]),{deliveryDetails:o,isLoading:a}},Tf=h.memo(({orderId:e})=>{const t=i4(),{deliveryDetails:n}=wAt({orderId:e}),[o,r,a]=Ee(["daddi","dede","dass"]),{additionalInformation:i,entryInstruction:l,dropOff:c,deliveryAsset:d}=n??{},u=o&&!!i?.value,p=r&&!!l?.displayValue,g=r&&!!c?.displayValue,E=a&&!!d?.displayValue;if(!o||!u&&!g&&!p&&!E)return null;const y=r?"delivery-view.additional-information.label":"delivery-view.delivery-instructions.title",I={item:d,withDescription:!1};return s.jsxs("div",{"data-test":"post-order-delivery-details",className:"salt-m-t--2",children:[g&&s.jsx(hd,{labelId:"delivery-view.drop-off-option.label",value:c?.displayValue}),p&&s.jsx(hd,{labelId:"delivery-view.entry-instruction.label",value:l?.displayValue}),u&&s.jsx(hd,{labelId:y,value:i?.value}),E&&s.jsx(hd,{labelId:"delivery-view.delivery-asset.label",value:t(I)})]})}),_t={messages:{EMPTY_WALLET:"EMPTY_WALLET",NO_WALLET_ITEM_SELECTED:"NO_WALLET_ITEM_SELECTED",DEFAULT_WALLET_ITEM_EXPIRED:"DEFAULT_WALLET_ITEM_EXPIRED",NO_SLOT_SELECTED:"NO_SLOT_SELECTED",CONCIERGE_SAVING_ERROR:"CONCIERGE_SAVING_ERROR",BASKET_BELOW_THRESHOLD:"BASKET_BELOW_THRESHOLD",BASKET_MARKED_CANNOT_CHECKOUT:"BASKET_MARKED_CANNOT_CHECKOUT",TERMS_AND_CONDITIONS_UNCHECKED:"TERMS_AND_CONDITIONS_UNCHECKED",VALIDATION_SUCCESS:"VALIDATION_SUCCESS",RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE:"RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE",RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_NAME:"RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_NAME",RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_DEFINITION:"RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE",AGE_CHECK_NOT_CONFIRMED:"AGE_CHECK_NOT_CONFIRMED",BONUS_CHECK_NOT_AVAILABLE:"BONUS_CHECK_NOT_AVAILABLE",RECURRING_ORDERS_TO_SAVE_PAYMENT_METHOD_UNCHECKED:"RECURRING_ORDERS_TO_SAVE_PAYMENT_METHOD_UNCHECKED",NO_BILLING_ADDRESS:"NO_BILLING_ADDRESS",TERMS_AND_CONDITIONS_FETCH_ERROR:"TERMS_AND_CONDITIONS_FETCH_ERROR",INVALID_SLOT_ERROR:"INVALID_SLOT_ERROR",UNSUPPORTED_PAYMENT_METHOD_GROUP_ERROR:"UNSUPPORTED_PAYMENT_METHOD_GROUP_ERROR",NO_FINANCING_PROVIDER_SELECTED:"NO_FINANCING_PROVIDER_SELECTED",PAYMENT_CHECKOUT_RESTRICTION:"PAYMENT_CHECKOUT_RESTRICTION",NO_AVAILABLE_PAYMENT_METHOD:"NO_AVAILABLE_PAYMENT_METHOD"},status:{SUCCESS:"SUCCESS",FAILURE:"FAILURE"}},Tn=!1,FAt={status:_t.status.SUCCESS,message:_t.messages.VALIDATION_SUCCESS},BAt={focusErrorElement:(e,t)=>{}},{AGE_CHECK_NOT_CONFIRMED:UAt,TERMS_AND_CONDITIONS_UNCHECKED:GAt,DEFAULT_WALLET_ITEM_EXPIRED:$At,NO_BILLING_ADDRESS:HAt,NO_FINANCING_PROVIDER_SELECTED:VAt,RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE:WAt,RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_DEFINITION:YAt,RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_NAME:qAt,NO_WALLET_ITEM_SELECTED:KAt,EMPTY_WALLET:zAt,UNSUPPORTED_PAYMENT_METHOD_GROUP_ERROR:QAt}=_t.messages,Vd={[GAt]:"terms-and-conditions",[zAt]:"payment-section",[$At]:"payment-section",[KAt]:"payment-section",[VAt]:"financing-provider-dropdown",[QAt]:"payment-section",[UAt]:"age-confirmation",[YAt]:Ko,[qAt]:hr,[HAt]:"billing-address-button"},Ute=ae.createContext(BAt),XAt=()=>h.useContext(Ute),ZAt=({children:e})=>{const t=(n,o)=>{if(n)if(n===WAt){const r=Vd[o?.isRecurringDefinitionValid||o?.isRecurringNameValid];document.getElementById(r)?.focus({preventScroll:!0})}else document.getElementById(Vd[n])?.focus({preventScroll:!0})};return s.jsx(Ute.Provider,{value:{focusErrorElement:t},children:e})},gj=({ageRestriction:e,ageConfirmed:t,onClickAgeConfirmation:n,isAgeConfirmationError:o,ageConfirmationFormRef:r})=>{const a=L(),[i]=Ee(["nfchk"]);return s.jsxs("div",{className:"salt-m-t--4",ref:r,children:[i?s.jsx(fs.Checkbox,{id:Vd[_t.messages.AGE_CHECK_NOT_CONFIRMED],name:"summary-age-confirmation-checkbox",value:"summary-age-confirmation-checkbox",checked:t,onChange:n,label:s.jsx(b,{id:"checkout.summary.age.confirmation.label",values:{age:e}}),error:o?a.formatMessage("checkout.summary.age.confirmation.error"):"",required:!0,"data-test":"summary-age-confirmation-checkbox"}):s.jsx(Lo,{last:!0,id:Vd[_t.messages.AGE_CHECK_NOT_CONFIRMED],input:{checked:t,onChange:n},bold:!1,meta:{error:o?a.formatMessage("checkout.summary.age.confirmation.error"):"",invalid:o,touched:o},label:s.jsx(b,{id:"checkout.summary.age.confirmation.label",values:{age:e}}),whiteSpace:"pre-wrap","data-test":"summary-age-confirmation-checkbox"}),s.jsx(Te,{className:"salt-m-t--2",intent:"warning",size:"s",text:s.jsx(b,{id:"checkout.summary.age.confirmation.warning"})})]})},JAt=({orderId:e,carrierDetails:t,delivery:n,isCompletedOrder:o=!1,actions:r,canChangeDelivery:a=!0,onChangeDeliveryButtonClick:i,onClickAgeConfirmation:l=()=>{},ageConfirmed:c=!1,isAgeConfirmationEnabled:d,isAgeConfirmationError:u=!1,ageConfirmationFormRef:p})=>{const g=ci(),E=Ge(),y=f(D("daddi")),{externalAddress:I,ageRestriction:S}=n||{},C=!y&&!I,{name:T,iconUrl:_,iconDescription:A}=t,R=f(Oo),P=async()=>{i&&i(I?.externalCollectionPointId);const k=await ko.fetchAnalyticsMetadataByActiveCart(R);r.sendAnalyticsEvent({type:Le.BEGIN_CHECKOUT,meta:k}),g(k),E(Tr({inCheckoutWalk:!0}))},N=I?s.jsx(oj,{externalAddress:I}):s.jsx(s_,{delivery:n});return s.jsxs(xe,{className:"salt-m-b--2",children:[s.jsxs(Q,{align:"center",wrap:"nowrap",as:"span",className:"salt-m-b--2",children:[s.jsx(Q,{as:"span",className:"salt-m-r--2",children:s.jsx(el,{src:_,alt:T!==A?A:void 0,height:31,width:31})}),s.jsx(ee,{as:O,children:T})]}),s.jsxs(Q,{direction:"column",className:"salt-m-b--2",gap:["sm"],children:[s.jsx(O,{size:"l",bold:!0,children:s.jsx(Hm,{dates:{deliveryStartDate:n?.deliveryStartDate,deliveryEndDate:n?.deliveryEndDate,deliveryTimeInMinutes:n?.deliveryTimeInMinutes,collectionTimeInMinutes:n?.collectionTimeInMinutes,timeZoneId:n?.timeZoneId},carrierType:t.slotBookingComponent,slotTimesDisplayMode:o?d4:t.slotTimesDisplayMode})}),N]}),C&&s.jsx(nj,{delivery:n}),a&&s.jsx("div",{className:"salt-m-t--4",children:s.jsx(x,{onClick:P,intent:"secondary",fill:!0,"data-test":"change-delivery-button",children:s.jsx(b,{id:"checkout.summary.delivery.change.button"})})}),o?s.jsx(Tf,{orderId:e}):s.jsx(hj,{}),S&&d&&s.jsx(gj,{ageRestriction:S,ageConfirmed:c,ageConfirmationFormRef:p,onClickAgeConfirmation:l,isAgeConfirmationError:u})]})},Ej=({size:e})=>{const t=L(),n=F(),o=f(kE),r=Ou(),a=lAt(),[i]=Ee(["nfchk"]);return s.jsxs("div",{className:"salt-d--block salt-m-t--4 salt-m-b--2","data-test":"concierge-delivery",children:[s.jsxs("span",{className:"salt-d--block salt-m-y--2",children:[s.jsx(O,{className:"salt-d--inline salt-m-r--1",bold:!0,size:e,children:s.jsx(b,{id:"checkout.summary.concierge.delivery.notification"})}),s.jsx(O,{className:"salt-d--inline",size:e,children:s.jsx(b,{id:"checkout.summary.concierge.delivery.notification.optional"})})]}),!a&&(i?s.jsx(fs.Checkbox,{name:"concierge-checkbox",value:"concierge-checkbox",checked:o,onChange:()=>n(Zr.setConciergeDelivery(!o)),label:s.jsxs(h.Fragment,{children:[s.jsx(O,{className:"salt-m-r--1",children:s.jsx(b,{id:"checkout.summary.concierge.termsandconditions.prelink.text"})}),s.jsx(tt,{target:"_blank",href:t.formatMessage("checkout.summary.concierge.termsandconditions.link.url"),onClick:()=>{n(U.analyticsEvent({type:Le.CONCIERGE_TERMS_AND_CONDITIONS_CLICKED}))},children:s.jsx(b,{id:"checkout.summary.concierge.termsandconditions.link.text"})})]}),"data-test":"concierge-checkbox"}):s.jsx(Lo,{last:!0,input:{onChange:()=>n(Zr.setConciergeDelivery(!o)),checked:o},bold:!1,label:s.jsxs(h.Fragment,{children:[s.jsx(O,{className:"salt-m-r--1",children:s.jsx(b,{id:"checkout.summary.concierge.termsandconditions.prelink.text"})}),s.jsx(tt,{target:"_blank",href:t.formatMessage("checkout.summary.concierge.termsandconditions.link.url"),onClick:()=>{n(U.analyticsEvent({type:Le.CONCIERGE_TERMS_AND_CONDITIONS_CLICKED}))},children:s.jsx(b,{id:"checkout.summary.concierge.termsandconditions.link.text"})})]}),"data-test":"concierge-checkbox"})),r&&s.jsx(Te,{intent:"info",size:"s","data-test":"concierge-pay-on-delivery-notification",text:t.formatMessage("checkout.summary.concierge.delivery.pay.on.delivery.notification")})]})};Ej.defaultProps={size:"l"};const eRt=({actions:e,delivery:t,isAgeConfirmationError:n=!1,onClickAgeConfirmation:o=()=>{},ageConfirmationFormRef:r,showDeliveryPass:a=!1,canChangeDelivery:i=!0,isAgeConfirmationEnabled:l=!1,ageConfirmed:c=!1,isConciergeDeliveryMethodEnabled:d=!1,conciergeDelivery:u=!1,onChangeDeliveryButtonClick:p,isCompletedOrder:g,orderId:E})=>{const y=ci(),I=Ge(),S=f(Oo);if(!t)return null;const C=t.deliveryType===pt.clickAndCollect.type,T=C?"checkout.summary.collection.change.button":"checkout.summary.delivery.change.button",_=async()=>{p&&p();const A=await ko.fetchAnalyticsMetadataByActiveCart(S);e.sendAnalyticsEvent({type:Le.BEGIN_CHECKOUT,meta:A}),y(A),I(Tr({inCheckoutWalk:!0}))};return s.jsxs(h.Fragment,{children:[a&&t.hasDeliveryPass?s.jsx(Te,{intent:"success",showIcon:!1,text:s.jsx(b,{id:"checkout.complete.delivery.pass"}),link:s.jsx(Te.Link,{to:LP(),children:s.jsx(b,{id:"checkout.complete.manage.delivery.pass"})})}):null,t.ageRestriction&&!l&&s.jsx(Te,{className:i?"salt-m-b--2":"",intent:"warning",text:s.jsx(b,{id:"checkout.summary.age.restriction.warning",values:{age:t.ageRestriction}}),showIcon:!1}),d&&i&&!C&&s.jsx(Ej,{size:"m"}),d&&!i&&u&&s.jsx("div",{className:"salt-m-t--4","data-test":"concierge-info",children:s.jsx(Te,{intent:"info",text:s.jsx(b,{id:"checkout.complete.concierge.info"})})}),i?s.jsx(x,{intent:"secondary",fill:!0,onClick:_,"data-test":"change-delivery-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:T})})}):null,!C&&s.jsx(ae.Fragment,{children:g?s.jsx(Tf,{orderId:E}):s.jsx(hj,{})}),t.ageRestriction&&l&&s.jsx(gj,{ageRestriction:t.ageRestriction,ageConfirmed:c,ageConfirmationFormRef:r,onClickAgeConfirmation:o,isAgeConfirmationError:n})]})},tRt=({delivery:e,orderId:t,onChangeDeliveryButtonClick:n,actions:o,isAgeConfirmationEnabled:r,ageConfirmationFormRef:a,onClickAgeConfirmation:i=()=>{},ageConfirmed:l=!1,isAgeConfirmationError:c=!1,isCompletedOrder:d=!1})=>{const u=ci(),p=L(),g=Ge(),E=f(Oo),y=p.formatNumber(e?.deliveryTimeInMinutes||0,{style:"unit",unit:"minute",unitDisplay:"short"}),I=async()=>{n&&n();const T=await ko.fetchAnalyticsMetadataByActiveCart(E);o.sendAnalyticsEvent({type:Le.BEGIN_CHECKOUT,meta:T}),u(T),g(Tr({inCheckoutWalk:!0}))},S=()=>d?s.jsx(b,{id:"checkout.complete.fast.delivery.title.with.time",values:{time:$o(e?.deliveryEndDate||"",e?.timeZoneId||"",$n)}}):s.jsx(b,{id:"order.details.fast.delivery.title.with.time",values:{duration:y}}),C=()=>d?s.jsxs(ae.Fragment,{children:[s.jsx(Tf,{orderId:t}),s.jsx(Te,{intent:"info",size:"s",className:"salt-m-t--2",text:p.formatMessage("order.card.reserved.fast.delivery.alert")})]}):s.jsx(hj,{});return s.jsxs(xe,{className:"salt-m-b--2",children:[s.jsx(ee,{as:"h2",children:S()}),s.jsx(s_,{delivery:e}),!d&&s.jsxs(ae.Fragment,{children:[e?.ageRestriction&&!r&&s.jsx(Te,{className:"salt-m-t--2",intent:"warning",text:s.jsx(b,{id:"checkout.summary.age.restriction.warning",values:{age:e.ageRestriction}}),showIcon:!1}),s.jsx(x,{className:"salt-m-t--2",intent:"secondary",fill:!0,onClick:I,"data-test":"change-delivery-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.delivery.change.button"})})})]}),C(),!d&&e?.ageRestriction&&r&&s.jsx(gj,{ageRestriction:e.ageRestriction,ageConfirmed:l,ageConfirmationFormRef:a,onClickAgeConfirmation:i,isAgeConfirmationError:c})]})},sRt=D("ag"),nRt=D("cdm"),oRt=e=>{const t=f(D("daddi")),{dateFormat:n,timeFormat:o,isCompletedOrder:r,canChangeDelivery:a=!0,delivery:i=null,showDeliveryPass:l=!1,deliveryCardImpression:c}=e,{isCollection:d,isFastDelivery:u,standardTitle:p,expressCollectionTitle:g,expressCollectionDescription:E,shouldShowStandardDateForExpressCollection:y}=Dte(i),{isReady:I,carrierDetails:S}=$m({carrierId:i?.carrierId,shippingGroupType:i?.shippingGroupType}),{externalAddress:C}=i||{};if(h.useEffect(()=>{I&&i?.addressId&&c&&c(i.addressId,i.deliveryDestinationId,S?.name,C?.externalCollectionPointId)},[S?.name,i?.addressId,i?.deliveryDestinationId,c,C?.externalCollectionPointId,I]),!i||!I)return s.jsx(js.Skeleton,{});if(S)return s.jsx(JAt,{carrierDetails:S,...e});if(u)return s.jsx(tRt,{isCompletedOrder:r,...e});let T=null;i.ageRestriction||l&&i.hasDeliveryPass?T="2":a&&(T="4");const _=s.jsx(O,{size:"l","data-test":"delivery-date",className:"salt-d--inline",bold:!0,children:s.jsx(qn,{dateIsoFrom:i.deliveryStartDate,dateIsoTo:i.deliveryEndDate,dateFormat:n,timeZoneId:i.timeZoneId,timeFormat:o})});return s.jsxs(xe,{children:[s.jsxs("div",{className:"salt-m-b--2 salt-overflow-wrap--anywhere",children:[p&&s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsxs("h2",{children:[p,": ",_]})}),g&&s.jsx(ee,{as:"h2",className:"salt-p-b--2",children:g})]}),s.jsxs("div",{className:`salt-m-b--${T}`,children:[E&&!y&&s.jsx(O,{"data-test":"express-collection-description",size:"l",bold:!0,children:E}),y&&s.jsx(O,{size:"l",bold:!0,children:_}),s.jsx(s_,{delivery:i}),i.additionalInformation&&d&&s.jsx("div",{className:"salt-m-t--4",children:s.jsx(Ote,{message:i.additionalInformation})}),!t&&s.jsxs(ae.Fragment,{children:[i.additionalInformation&&!d&&s.jsx("div",{className:"salt-m-t--2",children:s.jsx(O,{"data-test":"delivery-address-additional-information",className:"salt-d--inline",children:i.additionalInformation})}),s.jsx(nj,{delivery:i})]})]}),s.jsx(eRt,{...e})]})},rRt=e=>({dateFormat:Zt(e),timeFormat:Mt(e),isAgeConfirmationEnabled:sRt(e),isConciergeDeliveryMethodEnabled:nRt(e),conciergeDelivery:kE(e)}),aRt=st({onClickConciergeDelivery:Zr.setConciergeDelivery,sendAnalyticsEvent:U.analyticsEvent}),fj=Tt(Ht,we(rRt,aRt))(oRt),iRt=()=>{const[e,t]=h.useState(!1);return s.jsxs(Je,{expanded:e,onToggle:()=>t(n=>!n),children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"checkout.summary.additional.info.box.title"})}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentCollapsed,{children:s.jsx("div",{className:"salt-m-t--4",children:s.jsx(b,{id:"checkout.summary.additional.info.box.short.description"})})}),s.jsxs(Je.ContentExpanded,{children:[s.jsx("div",{className:"salt-m-t--4",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.additional.info.box.short.description"})})}),s.jsx("div",{className:"salt-m-t--4",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.additional.info.box.extended.description"})})})]})]})},lRt=({billingAddress:e})=>s.jsxs(ae.Fragment,{children:[s.jsxs(O,{className:"salt-m-b--0",children:[s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"invoice.billing.address.individual.name.label"}),":"," "]}),e.fullName]}),s.jsx(O,{className:"salt-m-b--0",children:s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"invoice.billing.address.billing.address.label"}),":"]})}),s.jsxs(O,{children:[e.addressLine1,e.addressLine2?`/${e.addressLine2}`:""]}),s.jsxs(O,{children:[e.postalCode," ",e.city]})]}),cRt=({billingAddress:e})=>s.jsxs(ae.Fragment,{children:[s.jsxs(O,{className:"salt-m-b--0",children:[s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"invoice.billing.address.company.name.label"}),":"," "]}),e.fullName]}),s.jsxs(O,{className:"salt-m-b--0",children:[s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"invoice.billing.address.company.tax.number.label"}),":"," "]}),e.taxNumber]}),s.jsxs(ae.Fragment,{children:[s.jsx(O,{className:"salt-m-b--0",children:s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"invoice.billing.address.billing.address.label"}),":"]})}),s.jsxs(O,{className:"salt-m-b--0",children:[e.addressLine1,e.addressLine2?.length?`/${e.addressLine2}`:""]}),s.jsxs(O,{className:"salt-m-b--0",children:[e.postalCode," ",e.city]})]})]}),Ca={INDIVIDUAL:"individual",COMPANY:"company"},dRt=()=>s.jsxs(ae.Fragment,{children:[s.jsxs(O,{bold:!0,children:[s.jsx(b,{id:"invoice.billing.address.billing.address.label"}),":"]}),s.jsx(b,{id:"invoice.billing.address.not.provided"})]}),D0=({billingAddress:e,type:t})=>{const n=h.useMemo(()=>t===Ca.INDIVIDUAL?s.jsx(lRt,{billingAddress:e}):t===Ca.COMPANY?s.jsx(cRt,{billingAddress:e}):s.jsx(dRt,{}),[e,t]);return s.jsx(V,{className:"salt-m-x--0 salt-m-b--4",children:s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(Q,{direction:t?"column":"row",children:n})})})},uRt=h.forwardRef((e,t)=>{const{formatMessage:n}=L(),{a11y:o,...r}=e,a=o||{labels:{"arrow-left":n("salt.tabs.left.arrow.a11y.label"),"arrow-right":n("salt.tabs.right.arrow.a11y.label")}};return s.jsx(Ny,{a11y:a,...r,ref:t})}),il={...uRt,TabList:Ny.TabList,Tab:Ny.Tab,TabPanel:Ny.TabPanel},pRt=[Ca.INDIVIDUAL,Ca.COMPANY],mRt=({formType:e,setFormType:t})=>{const n=L();return s.jsx(il,{selectedId:e,className:"salt-m-b--8",children:s.jsx(il.TabList,{children:pRt.map(o=>s.jsx(il.Tab,{id:o,onClick:()=>t(o),children:n.formatMessage(`invoice.billing.address.form.${o.toLowerCase()}`)},o))})})},{Header:hRt}=B,gRt=({children:e})=>s.jsx(hRt,{align:"left",children:s.jsx(ee,{as:"h1",id:Mc,children:e})}),Gte=[{name:"street",validationRuleName:"addressLine1",required:!0},{name:"apartment.number",validationRuleName:"addressLine2"},{name:"postal.code",required:!0,validationRuleName:"postalCode"},{name:"city",validationRuleName:"city",required:!0}],ERt=[{name:"full.name",validationRuleName:"fullName",required:!0},...Gte],fRt=e=>{e=e.replace(/[ -]/gi,"");const t=[6,5,7,2,3,4,5,6,7];let n=0;const o=+e.substring(9);for(let r=0;r<t.length;r++)n+=+e[r]*t[r];return n%11===o},yRt=[{name:"company.name",validationRuleName:"fullName",required:!0},{name:"tax.number",validationRuleName:"taxNumber",required:!0,validate:{validateFunction:fRt,message:"invoice.billing.tax.number.invalid.error"}},...Gte],r_=e=>e.data.customer.billingAddress,$te=e=>e.data.customer.billingAddressValidation,pi=({isLoading:e,children:t})=>e?s.jsxs(Q,{direction:"column",align:"center",children:[s.jsx(_s,{}),s.jsx(O,{bold:!0,className:"salt-p-t--2",children:s.jsx(Nt,{id:"loading.spinner.label"})})]}):s.jsx(h.Fragment,{children:t}),IRt={"full.name":"fullName","company.name":"companyName",street:"addressLine1","apartment.number":"addressLine2","postal.code":"postalCode",city:"city","tax.number":"taxNumber"},SRt=(e,t)=>Object.entries(t).some(([n,o])=>o!==e[n]),CRt=(e,t,n,o)=>o?t(e)||n:!0,vRt=({formFields:e,formContext:t,setIsOpen:n,formType:o})=>{const r=L(),a=F(),i=f(D("bam.av")),{data:l}=f(r_),{data:c,isFetching:d}=f($te),u=Ou(),p=f(xn),g=f(D("pcs.v2")),[E,y]=h.useState(!1),I=o===Ca.COMPANY,S=()=>{SRt(l,t.getValues())&&(g?a(sr.withOverridePaymentMethodGroups(sr.getOrderPaymentCheckoutSummaryWithPaymentMethodGroups)):u&&a(sr.getOverridePaymentMethodGroups(p)))},C=()=>{const _=Object.entries(t.getValues()).reduce((j,[G,W])=>({...j,[G]:W?.trim()}),{}),{fullName:A,companyName:R,city:P,postalCode:N,taxNumber:k,addressLine1:M,addressLine2:w}=_;return{customerDetails:{fullName:I?R:A,taxNumber:I?k:void 0},addressDetails:{addressLine1:M,addressLine2:w||null,city:P,postalCode:N}}},T=async()=>{const _=C();try{await a(Jo.postBillingAddress(_)),S(),n(!1)}catch{Z.error("toast.notification.generic.error")}};return h.useEffect(()=>{a(Jo.getBillingAddressValidationRules())},[a]),h.useEffect(()=>{!E&&Object.keys(l).length&&(I&&t.setValue("companyName",l.fullName),Object.entries(l).forEach(([_,A])=>t.setValue(_,A)),y(!0)),t.clearErrors()},[e,t,l,E,I]),s.jsx(pi,{isLoading:d,children:s.jsx(On,{...t,children:s.jsx("form",{onSubmit:t.handleSubmit(T),id:"billingAddressForm",children:s.jsx("div",{children:e.map(({name:_,validationRuleName:A,required:R,validate:P})=>{const N=r.formatMessage(`invoice.billing.address.${_}.input.label`),k=A?{value:new RegExp(c[A]),message:r.formatMessage(`invoice.billing.${_}.wrong.format.error`)}:void 0,M=R?{value:!0,message:r.formatMessage("invoice.billing.required.field.error")}:void 0,w=j=>P?CRt(j,P.validateFunction,r.formatMessage(P.message),i):R&&(!!j.trim()||r.formatMessage("invoice.billing.required.field.error"));return s.jsx(nr,{name:IRt[_],label:N,placeholder:N,required:M,pattern:k,validate:w},_)})})})})})},by={"full.name":"fullName","company.name":"companyName",street:"addressLine1","apartment.number":"addressLine2","postal.code":"postalCode",city:"city","tax.number":"taxNumber"},TRt=e=>e instanceof HTMLInputElement,_Rt=e=>{const t=e.querySelector(":invalid");TRt(t)&&(t?.scrollIntoView({behavior:"smooth",block:"center"}),t?.focus())},bRt=(e,t)=>Object.entries(t).some(([n,o])=>o!==e[n]),xRt=({formFields:e,setIsOpen:t,formType:n})=>{const o=L(),r=F(),[a]=Ee(["bam.av"]),[i,l]=h.useState({}),{data:c}=f(r_),{data:d,isFetching:u}=f($te),p=Ou(),g=f(xn),E=n===Ca.COMPANY,y=A=>{!bRt(c,A)&&!p||r(sr.getOverridePaymentMethodGroups(g))},I=(A,R,P)=>a?R(A)||P:!0,S=A=>{const R=A.entries().reduce((W,[H,K])=>({...W,[H]:K?.toString().trim()}),{}),{fullName:P,companyName:N,city:k,postalCode:M,taxNumber:w,addressLine1:j,addressLine2:G}=R;return{customerDetails:{fullName:E?N:P,taxNumber:E?w:void 0},addressDetails:{addressLine1:j,addressLine2:G||null,city:k,postalCode:M}}},C=A=>{const R={};return e.forEach(({name:P,required:N,validate:k,validationRuleName:M})=>{const w=by[P],j=A.elements.namedItem(w);if(!(j instanceof HTMLInputElement))return;j.setCustomValidity("");const G=j.value.trim();if(N&&!G){const W=o.formatMessage("invoice.billing.required.field.error");R[w]=W,j.setCustomValidity(W);return}if(G){if(k){const W=I(G,k.validateFunction,o.formatMessage(k.message));if(typeof W=="string"){R[w]=W,j.setCustomValidity(W);return}}if(M){const W=d[M];if(W&&!new RegExp(W).test(j.value)){const H=o.formatMessage(`invoice.billing.address.${P}.wrong.format.error`);R[w]=H,j.setCustomValidity(H);return}}}}),R},T=async A=>{A.preventDefault();const R=A.currentTarget;l({});const P=C(R);if(_Rt(R),Object.values(P).length>0){l(P);return}const N=new FormData(R),k=S(N);try{await r(Jo.postBillingAddress(k)),y({...k.customerDetails,...k.addressDetails}),R.reset(),t(!1)}catch{Z.error("toast.notification.generic.error")}};h.useEffect(()=>{r(Jo.getBillingAddressValidationRules())},[r]);const _=()=>{const A={};return E&&(A.companyName=c.fullName),Object.entries(c).forEach(([R,P])=>A[R]=P),A};return s.jsx(pi,{isLoading:u,children:s.jsx(fs,{noValidate:!0,onSubmit:T,id:"billingAddressForm",children:e.map(({name:A,required:R})=>{const P=o.formatMessage(`invoice.billing.address.${A}.input.label`),N=o.formatMessage("salt.form.text-field.clear-button.a11y.label");return s.jsx(fs.TextField,{required:R,placeholder:P,className:"salt-m-b--4",label:{text:P},name:by[A],errorMessage:i[by[A]],defaultValue:_()[by[A]],clearButton:{ariaLabel:N}},A)})})})},ARt=({setIsOpen:e})=>s.jsxs("div",{className:"salt-m-t--8 salt-d--flex",children:[s.jsx(x,{type:"button",fill:!0,className:"salt-m-r--2",intent:"secondary",onClick:()=>e(!1),children:s.jsx(x.Text,{children:s.jsx(b,{id:"invoice.billing.address.modal.cancel"})})}),s.jsx(x,{type:"submit",fill:!0,intent:"primary",form:"billingAddressForm",children:s.jsx(x.Text,{children:s.jsx(b,{id:"invoice.billing.address.modal.confirm"})})})]}),{Body:RRt}=B,DRt="add-billing-address-modal-header",ORt=({isOpen:e,setIsOpen:t,billingAddressType:n})=>{const[o]=Ee(["nfchk2"]),[r,a]=h.useState(()=>Ca.INDIVIDUAL);h.useEffect(()=>a(n||Ca.INDIVIDUAL),[n]);const i=Dn(),c=r===Ca.INDIVIDUAL?ERt:yRt;return s.jsxs(B,{isOpen:e,onRequestClose:()=>t(!1),maxWidth:"md",aria:{labelledby:DRt},children:[s.jsx(gRt,{children:s.jsx(b,{id:"invoice.billing.address.modal.header"})}),s.jsxs(RRt,{children:[s.jsx(mRt,{formType:r,setFormType:a}),o?s.jsx(xRt,{formFields:c,setIsOpen:t,formType:r}):s.jsx(vRt,{formFields:c,setIsOpen:t,formContext:i,formType:r}),s.jsx(ARt,{setIsOpen:t})]})]})},PRt=()=>e=>e(Jo.getDefaultBillingAddress()).catch(t=>(t.statusCode!==404&&Ue.api.pushError(new Error("Default billing address couldn't be fetched")),null)),NRt={getDefaultBillingAddress:PRt},LRt=({setIsModalOpen:e,isBillingAddressProvided:t})=>s.jsx(x,{intent:"secondary",id:Vd[_t.messages.NO_BILLING_ADDRESS],fill:!0,onClick:()=>e(!0),children:s.jsx(x.Text,{children:t?s.jsx(b,{id:"invoice.billing.address.management.change.address.button"}):s.jsx(b,{id:"invoice.billing.address.management.add.address.button"})})}),Hte=e=>!!e&&!!Object.keys(e).length;function kRt(e){if(Hte(e))return e.taxNumber?Ca.COMPANY:Ca.INDIVIDUAL}const yj=({isReadOnly:e,billingAddressRef:t,orderBillingAddress:n,editOrderMode:o,className:r="salt-m-b--4"})=>{const a=F(),[i,l]=h.useState(!1),c=f(r_),d=c.data;h.useEffect(()=>{!o&&o!==null&&!e&&!c.isFetching&&!c.fetchError&&!d.billingAddressId&&a(NRt.getDefaultBillingAddress()),o&&!d.billingAddressId&&n?.billingAddressId&&a(Jo.setBillingAddress(n))},[a,e,d.billingAddressId,c.isFetching,c.fetchError,o,n]);const u=e?n:d,p=kRt(u);return s.jsxs(ae.Fragment,{children:[s.jsxs(xe,{"data-test":"invoice-section",className:r,tabIndex:0,"aria-describedby":"no-billing-address-a11y",ref:t,children:[s.jsxs(ee,{as:"h2",className:"salt-m-b--4",children:[s.jsx(b,{id:"invoice.billing.address.management.box.title"}),":"," ",p===Ca.COMPANY?s.jsx(b,{id:"invoice.billing.address.type.company"}):s.jsx(b,{id:"invoice.billing.address.type.individual"})]}),e?s.jsx(D0,{billingAddress:u,type:p}):s.jsxs(ae.Fragment,{children:[s.jsx(D0,{billingAddress:u,type:p}),s.jsx(LRt,{setIsModalOpen:l,isBillingAddressProvided:Hte(u)})]})]}),s.jsx(ORt,{isOpen:i,setIsOpen:l,billingAddressType:p})]})},wb="concierge-delivery-error-modal-header",jRt=D("m.la.h"),MRt=({onCancel:e=()=>{},onSubmit:t=()=>{},modalLeftAlignEnabled:n})=>{const o=f($e("conciergeDeliveryError")),r=F(),a=h.useCallback(()=>{e(),r(J.closeModal())},[r,e]),i=h.useCallback(l=>{t(l),r(J.closeModal())},[r,t]);return s.jsxs(B,{isOpen:o,onRequestClose:a,aria:{labelledby:wb},children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:wb,"data-test":wb,children:s.jsx(b,{id:"checkout.summary.concierge.delivery.error.modal.header"})})}),s.jsx(B.Body,{children:s.jsx(b,{id:"checkout.summary.concierge.delivery.error.modal.text"})}),s.jsxs(B.Footer,{className:"salt-gap--2",align:n?"left":"center",children:[s.jsx(x,{intent:"secondary",onClick:a,"data-test":"concierge-delivery-error-modal-cancel-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"request.error.cancel.button"})})}),s.jsx(x,{intent:"primary",onClick:i,"data-test":"concierge-delivery-error-modal-submit-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.next.line1"})})})]})]})},wRt=e=>({modalLeftAlignEnabled:jRt(e)}),FRt=we(wRt)(MRt),BRt=D("pay.nsc"),URt=D("pay.ew"),GRt=D("pay.ywlt"),Vte=()=>{const e=F(),t=f(BRt),n=f(URt),o=f(GRt),r=f(vde),a=t&&!o;h.useEffect(()=>{a?e(Gt.setToSavePaymentMethod(r)):n&&e(Gt.setToSavePaymentMethod(!0))},[])},Ij=()=>{const e=f(D(Q3)),t=f(D(bqe)),n=f(D(X3));return e&&t&&!n},$Rt=({actualAmount:e,expectedAmount:t,reason:n,transformed:o})=>({productId:o.productId,name:o.name,image:o.image,alternatives:o.alternatives,reason:n,price:(({original:r,current:a,reference:i})=>({original:r,current:a,reference:i}))(o.price),...t&&{requestedAmount:t},...e&&{addedAmount:e},missingAmount:Math.abs(e-t),...o.timeRestriction&&{timeRestriction:o.timeRestriction},...o.checkoutTimeRestriction&&{checkoutTimeRestriction:o.checkoutTimeRestriction},...o.alcohol&&{alcohol:o.alcohol},...o.deliveryTimeRestrictionMessage&&{deliveryTimeRestrictionMessage:o.deliveryTimeRestrictionMessage},...o.checkoutTimeRestrictionMessage&&{checkoutTimeRestrictionMessage:o.checkoutTimeRestrictionMessage}}),HRt=(e=[])=>e.map(({actualAmount:t,expectedAmount:n,reason:o,product:r})=>$Rt({actualAmount:t,expectedAmount:n,reason:o,transformed:r})),VRt=(e,t)=>{const n=e.map(({reason:o,expectedQuantity:r,actualQuantity:a,productId:i})=>({productId:i,actualAmount:a,expectedAmount:r,reason:o,product:t.find(l=>l.productId===i)}));return HRt(n)},WRt=D("di"),YRt=async(e,t,n,o,r)=>e(xt.decorateProductsPPWSAction(t)).then(async a=>{const{payload:{responseData:i}}=a;await e(ud.setLimitedProducts(VRt(o,i.products.map(l=>si(l,Hn(n)??[],WRt(n)))),r))}),qRt=()=>(e,t)=>e(ud.getCheckoutValidation()).then(async n=>{if(n){const{limitedProducts:o,cartSplitRequired:r}=n.payload.responseData;if(o?.length>0){const a=o.map(l=>l.productId),i=t();await YRt(e,a,i,o,r)}else await e(ud.setLimitedProducts([],r))}}).catch(n=>{Ue.api.pushError(new Error("Couldn't fetch checkout items restrictions"),{context:{errorMessage:n.message}})}),KRt={fetchCheckoutValidation:qRt},{CheckboxIconOff:zRt,CheckboxIconOn:QRt,CheckboxText:XRt,ContentWrapper:ZRt}=QC;function LS({name:e,label:t,required:n,description:o=null,bold:r=!0,value:a,...i}){const l=po(),c=l.watch(e),d=$N(e,l),u=!c&&!!d;return s.jsx(ae.Fragment,{children:s.jsx(_a,{children:s.jsxs(Rn,{onClick:()=>{l.trigger(e)},hasError:u,htmlFor:e,children:[s.jsx("input",{type:"checkbox",id:e,"data-test":e,...i,...l.register(e,{required:n})}),c?s.jsx(QRt,{name:"checkbox_on"}):s.jsx(zRt,{name:"checkbox_off"}),s.jsxs(O,{children:[s.jsx(XRt,{bold:r,children:t}),s.jsxs(ZRt,{children:[o,u&&s.jsx(oi,{role:"alert",children:d})]})]})]})})})}const ll="SELECT_ALL",Gh="CONSENT",Wte="terms-and-conditions-modal",{Header:JRt}=B,eDt=({children:e})=>s.jsx(JRt,{align:"left",children:s.jsx(ee,{as:"h1",id:Wte,className:"salt-p-y--4",children:e})}),tDt=({setIsOpen:e})=>s.jsxs("div",{className:"salt-p-t--4 salt-p-b--8 salt-p-x--8 salt-d--flex",children:[s.jsx(x,{type:"button",fill:!0,className:"salt-m-r--2",intent:"secondary",onClick:()=>e(!1),children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.terms.and.conditions.modal.cancel.button"})})}),s.jsx(x,{type:"submit",fill:!0,intent:"primary",form:"termsAndConditons",children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.terms.and.conditions.modal.place.order.button"})})})]}),sDt=({check:e,index:t,areAllChecked:n,watch:o,setValue:r,setError:a,getFieldState:i,clearErrors:l})=>{const{preLinkText:c,link:d,postLinkText:u,linkText:p}=e,{formatMessage:g}=L(),E=C=>{r(C,!o(C)),n()?(r(ll,!0),l(ll)):(r(ll,!1),a(ll,{message:g("checkout.summary.terms.and.conditions.modal.agree.to.all.error")}))},y=()=>i(ll).invalid&&!o(`${Gh}-${t}`),I=s.jsxs("span",{style:{color:`${y()?"var(--typography-error, var(--intent-error))":"inherit"}`},children:[s.jsx("sup",{children:"*"}),c,s.jsx(tt,{style:{color:"inherit"},target:"_blank",href:d,children:p}),u]}),S=`${Gh}-${t}`;return s.jsx(LS,{name:S,label:I,bold:!1,onClick:()=>E(S),className:"salt-m-l--8"})},nDt=()=>{const{formatMessage:e}=L();return s.jsxs(O,{children:[s.jsx(b,{id:"checkout.summary.terms.and.conditions.modal.gdpr.text"})," ",s.jsxs(tt,{href:e("checkout.summary.terms.and.conditions.modal.gdpr.privacy.policy.url"),children:[" ",s.jsx(b,{id:"checkout.summary.terms.and.conditions.modal.gdpr.privacy.policy"})]})]})},{Body:oDt}=B,rDt=({isOpen:e,setIsOpen:t,checkout:n})=>{const{formatMessage:o}=L(),r=F(),a=f(oJe),i=f(aJe),l=Dn(),{watch:c,setValue:d,handleSubmit:u,setError:p,getFieldState:g,clearErrors:E}=l;h.useEffect(()=>{(async()=>{try{await r(mI.getTermsAndConditions())}catch{Ue.api.pushError(new Error("Terms and conditions fetch error"))}})()},[r]);const y=C=>a.forEach((T,_)=>{d(`${Gh}-${_}`,C)}),I=()=>c(a.map((C,T)=>`${Gh}-${T}`)).every(C=>!!C),S=()=>{d(ll,!c(ll)),c(ll)?y(!0):y(!1)};return s.jsxs(B,{isOpen:e,onRequestClose:()=>t(!1),maxWidth:"md",aria:{labelledby:Wte},isLoading:i,children:[s.jsx(eDt,{children:s.jsx(b,{id:"checkout.summary.terms.and.conditions.modal.header"})}),s.jsxs(oDt,{className:"salt-p-t--0",children:[s.jsx(On,{...l,children:s.jsxs("form",{id:"termsAndConditons",onSubmit:u(n),className:"salt-m-b--8",children:[s.jsx(LS,{name:ll,label:o("checkout.summary.terms.and.conditions.modal.agree.to.all"),onClick:S,bold:!1,required:{value:!0,message:o("checkout.summary.terms.and.conditions.modal.agree.to.all.error")}}),a.map((C,T)=>{const _=`${Gh}-${T}`;return s.jsx(sDt,{areAllChecked:I,index:T,check:C,watch:c,setValue:d,setError:p,getFieldState:g,clearErrors:E},_)})]})}),s.jsx(nDt,{})]}),s.jsx(tDt,{setIsOpen:t})]})},bI="SLOT_NOT_DELIVERABLE_MODAL_NAME",aDt=()=>{const e=F(),t=f($e(bI)),n=()=>e(J.closeModal());return s.jsxs(B,{showCloseIcon:!0,onRequestClose:n,isOpen:t,aria:{labelledby:bI},children:[s.jsx(B.Header,{align:"left","aria-live":"polite",children:s.jsx(ee,{as:"h1",id:bI,children:s.jsx(b,{id:"checkout.summary.slot.not.deliverable.modal.title"})})},"header"),s.jsx(B.Body,{children:s.jsx(b,{id:"checkout.summary.slot.not.deliverable.modal.description"})},"body"),s.jsxs(B.Footer,{align:"left",children:[s.jsx(x,{className:"salt-m-l--1 salt-m-r--1",onClick:n,intent:"secondary",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.slot.not.deliverable.modal.cancel.button"})})}),s.jsx(x,{className:"salt-m-r--1 salt-m-l--1",onClick:n,intent:"primary",fill:!0,asChild:!0,"data-test":"select-shipping-method-button",children:s.jsx(tt,{intent:"ghost",href:Tr({inCheckoutWalk:!0}),children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.slot.not.deliverable.modal.select.shipping.method.button"})})})})]},"footer")]})},iDt=({isOpen:e,onConfirm:t,pendingRecurringOrders:n})=>{const[o]=Ee(["nfchk"]),{formatMessage:r}=L(),a=F(),i=f(l5),l=f(Zt),c=()=>{a(J.closeModal())},d=y=>{try{t(y),localStorage.setItem("editRecurringOrderOption",i)}catch{localStorage.removeItem("editRecurringOrderOption")}c()},u=y=>{const{value:I}=y.target;a(IA.setEditRecurringOrderOption(I))},p=y=>{a(IA.setEditRecurringOrderOption(y))},g=n.map(y=>qs(l,y.date)).join(", "),E=[{value:al.THIS_ORDER_ONLY,label:r("edit.recurring.order.modal.option.one")},{value:al.THIS_AND_FUTURE_ORDERS,label:r("edit.recurring.order.modal.option.two"),additionalText:r("edit.recurring.order.modal.option.two.subtext"),progressiveDisclosure:n.length>0?s.jsx(Te,{size:"s",text:s.jsxs(Q,{children:[r("edit.recurring.order.modal.banner.alert.text"),s.jsx(O,{size:"s",children:g})]}),intent:"warning"}):null}];return s.jsxs(B,{isOpen:e,onRequestClose:c,closeMessage:r("edit.recurring.order.modal.close.icon"),children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h2",children:r("edit.recurring.order.modal.title")})}),s.jsx(B.Body,{children:o?s.jsx(xe,{children:s.jsx(fs.RadioGroup,{groupLabel:{text:r("edit.recurring.order.modal.title"),isVisuallyConcealed:!0},name:"editRecurringOrder",value:i,onChange:p,radios:E,required:!0})}):s.jsxs(Q,{className:"salt-gap-y--2",children:[s.jsx(Ao,{checked:i===al.THIS_ORDER_ONLY,"data-test":"this-order-only-option",value:al.THIS_ORDER_ONLY,disabled:!1,label:"",last:!0,bold:!1,error:"",role:void 0,onChange:u,children:r("edit.recurring.order.modal.option.one")},""),s.jsx(Ao,{checked:i===al.THIS_AND_FUTURE_ORDERS,"data-test":"this-and-future-orders-option",value:al.THIS_AND_FUTURE_ORDERS,disabled:!1,label:"",last:!0,bold:!1,error:"",role:void 0,onChange:u,children:s.jsxs(Q,{children:[r("edit.recurring.order.modal.option.two"),s.jsx(O,{size:"s",children:r("edit.recurring.order.modal.option.two.subtext")})]})},""),i===al.THIS_AND_FUTURE_ORDERS&&n.length>0&&s.jsx(Te,{text:s.jsxs(Q,{children:[r("edit.recurring.order.modal.banner.alert.text"),s.jsx(O,{children:g})]}),intent:"warning",showIcon:!1})]})}),s.jsxs(B.Footer,{align:"center",className:"salt-gap-x--2",children:[s.jsx(x,{intent:"secondary",onClick:c,fill:!0,children:s.jsx(x.Text,{children:r("edit.recurring.order.modal.cancel.button")})}),s.jsx(x,{intent:"primary",onClick:d,fill:!0,children:s.jsx(x.Text,{children:r("edit.recurring.order.modal.confirm.button")})})]})]})};class lDt extends Error{}class cDt extends Error{}const dDt=D("gtm.opfc"),uDt=e=>({"client-route-id":Do(e),"X-CSRF-TOKEN":Na(e),"Content-Type":"application/json"}),pDt=({navigate:e,resultToken:t})=>(n,o)=>{const r=o(),a=At(r);return fetch(go({basePath:a,target:"/v1/orderpayment/checkout/validate"}),{credentials:"same-origin",method:"POST",headers:uDt(r),body:JSON.stringify({resultToken:t})}).then(i=>i.json().then(l=>({response:i,data:l}))).then(({data:i,response:l})=>{if(l&&!l.ok){const c=new Error;return c.statusCode=l.status,c.message=i.message,Promise.reject(c)}return i}).then(async i=>{const l=!dDt(r),{analyticsPayload:c,isOrderFetched:d}=await n(TX(!0,i));d&&(l?n(U.analyticsEvent({type:Le.ORDER_PURCHASED,...c})):localStorage.setItem(rg,JSON.stringify(c)),c.recurringShoppingDefinition&&n(U.analyticsEvent({type:Le.RECURRING_ORDER_CREATED,recurringShoppingDefinition:c.recurringShoppingDefinition}))),n(Yt.getBasket()),e(Qg({orderId:i.orderId}))}).catch(i=>{(i.statusCode===401||i.statusCode===403)&&window.location.assign(Yo({basePath:a,queryString:`destination=${encodeURIComponent(vr({basePath:a}))}`}));const l=i.message&&AC(i.message)?i.message:"order.cow.3ds.error";Z.error(l),n(U.analyticsEvent({type:Le.PLACE_ORDER,status:"FAILURE",error:`FAILED_AFTER_CLICK - ${l}`})),e(vr())})},mDt={validateCheckout:pDt},Sj=()=>{const e=F(),t=Ge(),n=Ne(),{recoveryToken:o}=Qe.parse(n.search),r=!!o;return{canCheckout:()=>e($L()).then(({canCheckout:l,redirect:c})=>(l||t(c),l)),handlePaymentAuthenticationSuccess:l=>(e(ds({name:r?Bxe:Fxe})),e(mDt.validateCheckout({navigate:t,resultToken:l.resultToken})))}},hDt=D("pay.nsc"),gDt=D("pay.ew"),EDt=D("pay.nsd"),fDt=D("rec.o"),yDt=D("pay.check.use"),IDt=D("ag"),SDt=D("cdm"),CDt=D("bam"),vDt=D("bam.r"),TDt=D("cs.tcd"),_Dt=D("ro.e"),bDt=D("loy.waon"),xDt=D("oed"),ADt=D("pcs.v2"),RDt=e=>{const{actions:t,basket:n,walletItemId:o,conciergeDeliveryState:r,isUnsavedPaymentMethodSelected:a,psp:i=null,isBasketOrderUnderEdit:l,isRecurringShoppingDefinitionCreateFormValid:c,recurringShoppingDefinitionCreateFormFieldsValidation:d,isUsePaymentChecksEnabled:u,selectedRecurringShoppingDefinitionCreateFrequency:p,selectedRecurringShoppingDefinitionName:g,setUnresolvableCheckoutErrorAlert:E,appliedPaymentChecks:y=[],isAgeConfirmationEnabled:I,isConciergeEnabled:S,setAgeConfirmationError:C,wallet:T,basketHasItems:_,basketThreshold:A,isNonSavedCardPaymentEnabled:R,isExternalWalletEnabled:P,isRecurringOrdersEnabled:N,scrollToRecurringShoppingDefinitionCreateSection:k,isTermsAndConditionsAcknowledged:M,setTermsAndConditionsAcknowledgeError:w,setFinancingProviderNotSelectedError:j,scrollToPaymentSection:G,updateRecurringDefinitionPayment:W,isNonSavedDialogEnabled:H,setPsp:K,paymentSession:X,toSavePaymentMethod:q,isRecurringOrdersSelected:ne,retailerFinancingPlanId:ue,paymentOptionAndType:{paymentOption:oe,paymentType:ye},selectedRetailerFinancingProvider:he,selectedFinancingProviderId:Ie,billingAddressManagementEnabled:Fe,billingAddress:be,scrollToBillingAddressSection:ce,mandatoryBillingAddressEnabled:me,termsAndConditionsDialogEnabled:De,editRecurringOrdersEnabled:ge,currentOrderEntity:Se,currentRecurringOrderId:Ae,pendingOrders:Ce,recurringOrder:We,editRecurringOrderOption:et,isOrderEditDifferenceEnabled:ve,isLoyaltyPaymentEnabled:lt,isPaymentCheckoutSummaryV2Enabled:St,className:wt=""}=e,[dn,Mo]=h.useState(!1),Zs=f(ho),Mn=f(rJe),Kn=Ate(),gs=f(FN),Vc=Ou(),{focusErrorElement:wa}=XAt(),ca=F(),ju=Ge(),Yl=He(),{formatNumber:Jm}=L(),Wc=f($e("EditRecurringOrders")),{checkoutPayment:Io,checkoutRestrictions:qo,currency:hi}=Lg()||{},So=!N||l||c,mr=oe===dt.PAY_NOW&&!P,ql=mr&&!o&&!a,ol=T.items.find(ut=>ut.isDefault),Kl=ol&&ol.expired,Yc=mr&&!R&&!T.items.length,Nr=Ij(),{ageConfirmed:Gf}=oAt(),eh=f(D("cs.tca"));Vte();const[xw,Aw]=h.useState(!1),Rw=!!Object.keys(be).length,$f=Lg(),Dw=sj(),{hideLoyaltyPaymentButton:Ale}=Rte(),gi=h.useCallback((ut,us)=>Z.warning(ut,us),[]),Ow=h.useCallback(()=>So?Tn:(k(),{status:_t.status.FAILURE,message:_t.messages.RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE,metadata:{...!d.recurringShoppingDefinition&&{isRecurringDefinitionValid:_t.messages.RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_DEFINITION},...!d.recurringName&&{isRecurringNameValid:_t.messages.RECURRING_SHOPPING_DEFINITION_CREATE_FORM_INCOMPLETE_NAME}}}),[So,k]),Pw=h.useCallback(()=>Nr&&ne&&!q?(t.setIsToSavePaymentMethodValid(!1),{status:_t.status.FAILURE,message:_t.messages.RECURRING_ORDERS_TO_SAVE_PAYMENT_METHOD_UNCHECKED}):Tn,[ne,q,Nr]),Nw=h.useCallback(()=>n.slot?Tn:{status:_t.status.FAILURE,message:_t.messages.NO_SLOT_SELECTED},[n]),Lw=h.useCallback(()=>n?.checkout?.canCheckout?Tn:{status:_t.status.FAILURE,message:_t.messages.BASKET_MARKED_CANNOT_CHECKOUT},[n]),kw=h.useCallback(()=>n?.checkout?.basketAboveThreshold?Tn:{status:_t.status.FAILURE,message:_t.messages.BASKET_BELOW_THRESHOLD},[n]),jw=h.useCallback(()=>eh&&!M?(w(),{status:_t.status.FAILURE,message:_t.messages.TERMS_AND_CONDITIONS_UNCHECKED}):Tn,[M,w]),Mw=h.useCallback(()=>{const ut=St&&Kn?.some(us=>us.name!==dt.LOYALTY&&us.displayable);return ql&&ut?(t.setUnselectedPaymentWarning(!0),G(),{status:_t.status.FAILURE,message:_t.messages.NO_WALLET_ITEM_SELECTED}):Tn},[t,ql,G]),ww=h.useCallback(()=>ql&&Kl?(gi("checkout.summary.default.payment.method.expired.toast",{id:"payment-notification-a11y"}),t.setUnselectedPaymentWarning(!0),G(),{status:_t.status.FAILURE,message:_t.messages.DEFAULT_WALLET_ITEM_EXPIRED}):Tn,[t,Kl,ql,G,gi]),Fw=h.useCallback(()=>Yc?(gi("checkout.summary.no.payment.method.toast",{id:"payment-notification-a11y"}),G(),{status:_t.status.FAILURE,message:_t.messages.EMPTY_WALLET}):Tn,[Yc,G,gi]),Bw=h.useCallback(()=>I&&n.ageRestriction&&!Gf?(C?.(),{status:_t.status.FAILURE,message:_t.messages.AGE_CHECK_NOT_CONFIRMED}):Tn,[Gf,n,I,C]),Rle=h.useCallback(()=>Fe&&me&&!Rw?(gi("checkout.summary.no.billing.address.toast",{id:"no-billing-address-a11y"}),ce(),{status:_t.status.FAILURE,message:_t.messages.NO_BILLING_ADDRESS}):Tn,[Fe,Rw,gi]),Uw=h.useCallback(async()=>{if(!S||r.initialValue===r.currentValue||r.currentValue===null||!n?.slot?.slotId)return Tn;try{return await t.saveConciergeDelivery(r.currentValue),r.currentValue?t.sendAnalyticsEvent({type:Le.CONCIERGE_CHECK_BOX_CHECKED}):t.sendAnalyticsEvent({type:Le.CONCIERGE_CHECK_BOX_UNCHECKED}),Tn}catch{return t.openConciergeDeliveryErrorModal(),{status:_t.status.FAILURE,message:_t.messages.CONCIERGE_SAVING_ERROR}}},[t,n,r,S]),Gw=h.useCallback(async()=>{if(u&&y.length>0){const ut=await t.fetchAvailablePaymentChecks({basketTotal:n?.totals?.finalPrice,orderId:n.orderId});if(ut?.payload?.responseData){const{availablePaymentChecks:us}=ut.payload.responseData;if(!y.every(sh=>us.find(aF=>aF.paymentCheckId===sh.paymentCheckId)))return gi("checkout.summary.bonus.check.not.available.toast"),{status:_t.status.FAILURE,message:_t.messages.BONUS_CHECK_NOT_AVAILABLE}}}return Tn},[t,y,n,u,gi]),$w=h.useCallback(()=>Mn?(gi("toast.notification.generic.error"),{status:_t.status.FAILURE,message:_t.messages.TERMS_AND_CONDITIONS_FETCH_ERROR}):Tn,[Mn]),Hw=h.useCallback(()=>!St&&oe===dt.LOYALTY?Tn:Vc&&Kn&&!Kn.find(ut=>ut.name===oe&&ut.available)?(gi("checkout.summary.payment.options.payAtDelivery.limitation.warning",{id:"payment-notification-a11y"}),G(),Ue.api.pushError(new cDt(`selected: ${oe}, available: ${JSON.stringify(Kn)}`)),{status:_t.status.FAILURE,message:_t.messages.UNSUPPORTED_PAYMENT_METHOD_GROUP_ERROR}):Tn,[oe,Kn]),Vw=h.useCallback(()=>{const ut=gs?.financingProviders,us=!ve||!!Number(Io?.amountToBeCharged);return oe===dt.INSTALMENTS&&ut&&ut.length>0&&!he&&us?(G(),j(),{status:_t.status.FAILURE,message:_t.messages.NO_FINANCING_PROVIDER_SELECTED}):Tn},[he,oe,gs,j,Io?.amountToBeCharged]),Ww=h.useCallback(()=>Yl(A),[A,Yl]),Yw=h.useCallback((ut,us)=>{t.analyticsEvent({type:Le.PLACE_ORDER,status:ut.status,error:ut.message,walletItemId:o,isRecurringShoppingDefinitionCreationRequested:us})},[t,o]),qw=h.useCallback(()=>{t.analyticsEvent({type:Le.PLACE_ORDER_CONFIRMATION,isEditedOrder:l});const ut={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventAction:"CheckoutConfirmation",eventLabel:"Not Set",ecommerce:{checkout:{actionField:{step:6,option:l?"edited-order":"new-order"},products:Zs.map(us=>tn(us))}}};te.sendEvent({GA:ut,WA:null})},[t,l,Zs]),Kw=h.useCallback(()=>n?.checkout?.checkoutRestrictions?.includes(Pq.INVALID_SLOT)?{status:_t.status.FAILURE,message:_t.messages.INVALID_SLOT_ERROR}:Tn,[n]),zw=h.useCallback(()=>{const ut={CHARGE_AMOUNT_BELOW_THRESHOLD:"checkout.summary.chargeBelowThreshold.error"};return qo&&qo.length>0?(qo.forEach(({type:us,minimum:Ft})=>{Z.warning({key:ut[us],substitutions:{amount:Jm(Number(Ft),{style:"currency",currency:hi})}},{id:"payment-notification-a11y"})}),{status:_t.status.FAILURE,message:_t.messages.PAYMENT_CHECKOUT_RESTRICTION}):Tn},[qo?.length]),Qw=h.useCallback(()=>lt&&ve&&St&&Kn&&Dw&&!Zw(Kn)?.available?(Z.error("toast.notification.generic.error"),Ue.api.pushError(new lDt("No available payment method error")),{status:_t.status.FAILURE,message:_t.messages.NO_AVAILABLE_PAYMENT_METHOD}):Tn,[Dw,Ale]),Xw=h.useCallback(async()=>Kw()||Fw()||ww()||Mw()||jw()||Vw()||Bw()||kw()||Lw()||Nw()||Ow()||Pw()||Rle()||await Gw()||await Uw()||$w()||Hw()||zw()||Qw()||FAt,[Kw,Bw,kw,Lw,Gw,ww,Mw,Nw,Fw,Ow,jw,Pw,Uw,$w,Hw,Vw,zw,Qw]),Hf=h.useCallback(()=>N&&g!==""&&p&&p!==er&&!l?{name:g,frequency:GKe[p]}:void 0,[N,p,g,l]),Zw=ut=>ut?.find(({name:us})=>us===dt.LOYALTY),Dle=oe===dt.INSTALMENTS&&ue?{instalmentsOptions:{retailerFinancingPlanId:ue===J3?null:ue,retailerFinancingProviderId:he,financingProviderId:Ie}}:{},Jw=()=>({...Dle,group:oe,type:ye||"UNKNOWN",toSave:[dt.PAY_NOW,dt.UNKNOWN].includes(oe)&&q,walletItemId:o}),Ole=ut=>{if(ut?.paymentMethodGroups.filter(Ft=>Ft.name!==dt.LOYALTY).every(({displayable:Ft})=>!Ft)&&lt&&ve){const Ft=Zw(ut?.paymentMethodGroups||[]);return{group:dt.LOYALTY,type:Ft?.applicableType}}return Jw()},Ple=ut=>lt&&ve&&Number($f?.checkoutPayment.amountPaidByCustomer)===0&&Number($f?.checkoutPayment.amountToBeCharged)===0?{group:ut?.loyaltyPaymentMethod?.group,type:ut?.loyaltyPaymentMethod?.type}:Jw(),Nle=()=>St?Ole($f):Ple($f),eF=()=>Se!==void 0&&Se.recurringShoppingDefinition,Lle=()=>{if(!l)return;const ut=ge?et==="THIS_AND_FUTURE_ORDERS":void 0;if(!(ut===void 0&&W===void 0))return{replaceItems:ut,replacePayment:W}},kle=()=>{const ut=Hf();if(!ut&&!l||l&&!eF())return;const us=Lle();if(!ut&&!us)return;let Ft={};return ut&&(Ft={...Ft,signup:ut}),us&&(Ft={...Ft,edit:us}),Ft},{handlePaymentAuthenticationSuccess:jle}=Sj(),Mle=L(),tF=h.useCallback(()=>{const ut=kle(),us={paymentSession:X,billingAddressId:be.billingAddressId,paymentMethod:Nle(),...u&&y&&{paymentCheckIds:y.map(Ft=>Ft.paymentCheckId)},...ut?{recurringOrder:ut}:{},psp:i};t.makeCheckoutRequest(ju,us,jle,Mle,{threshold:Ww()}).then(Ft=>{Ft&&Ft.error&&(Ft.errorMessageKey&&wX.includes(Ft.errorMessageKey)&&t.fetchCheckoutValidation().then(()=>{t.openUnavailableItemsModal({checkoutErrorCode:Ft.errorMessageKey})}),Ft.errorMessageKey&&Ft.errorMessageKey===MX&&t.openSlotNotDeliverableModal(),Ft.showErrorAsAlert&&E(Ft.errorMessageKey))})},[t,y,Ww,Hf,u,i,E,o,W,X,q]),sF=()=>{qw(),X.requestPayment(),tF()},th=h.useCallback(async ut=>{t.performanceMark({name:wxe,event:ut,attributes:void 0});const us=await Xw();us.status===_t.status.FAILURE&&wa(us.message,us.metadata);const Ft=!!Hf();Yw(us,Ft),us.status===_t.status.SUCCESS?De?Mo(!0):sF():(us.message===_t.messages.INVALID_SLOT_ERROR&&t.openInvalidSlotModal(),Aw(!1))},[X,t,Hf,tF,qw,Yw,Xw]);h.useEffect(()=>{xw&&th()},[xw]);const nF=h.useCallback(ut=>{K(ut,()=>{Aw(!0)})},[K]),oF=h.useCallback(ut=>{H&&!o?t.openNonSavedPspModal({setPsp:nF}):th(ut)},[t,th,H,nF,o]),wle=h.useCallback(ut=>{t.setConciergeDelivery(r.initialValue),th(ut)},[t,th,r]),Fle=()=>{ca(J.openModal("EditRecurringOrders"))},Ble=()=>{const ut=Se?.groupedProducts?.products?.map(Ft=>({productId:Ft.productId,quantity:Ft.quantity}))??[],us=n.items.map(Ft=>({productId:Ft.productId,quantity:Ft.quantity.quantityInBasket}));return ut?.length!==us.length?!0:ut.every(({quantity:Ft,productId:sh})=>us.filter(iF=>iF.productId===sh&&iF.quantity!==Ft).length>0)},rF=()=>Ce.orders.map(Ft=>({orderId:Ft.orderId,date:Ft.dates.deliveryStartDate,recurringOrder:Ft.recurringShoppingDefinition?.definitionId??null})).filter(Ft=>Ft.recurringOrder===Ae&&Ft.orderId!==n.orderId).sort((Ft,sh)=>de(Ft.date)-de(sh.date)),Ule=()=>{if(We?.definitionId===Ae)return!0;const ut=de(Se.dates.deliveryStartDate);return rF().some(us=>de(us.date)>ut)},Gle=()=>eF()?Ule():!1,$le=ut=>{ge&&Gle()&&Ble()?Fle():oF(ut)};return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"action",fill:!0,disabled:!_,onClick:$le,"data-synthetics":"place-order-button","data-test":"place-order-button",className:wt,children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.next.line1"})})}),S&&s.jsx(FRt,{onSubmit:wle}),De&&s.jsx(rDt,{isOpen:dn,setIsOpen:Mo,checkout:sF}),Wc&&s.jsx(iDt,{isOpen:Wc,onConfirm:oF,pendingRecurringOrders:rF()})]})},DDt=e=>{const t=is(e),n=Ki(e,t.orderId),o=n?.recurringShoppingDefinition?.definitionId,r=Ac(e),a=dN(o)(e);return{basket:t,wallet:UE(e),conciergeDeliveryState:lWe(e),basketHasItems:Hi(e),basketThreshold:Jg(e),isBasketOrderUnderEdit:Ar(e),isNonSavedCardPaymentEnabled:hDt(e),isNonSavedDialogEnabled:EDt(e),isExternalWalletEnabled:gDt(e),isRecurringOrdersEnabled:fDt(e),isRecurringShoppingDefinitionCreateFormValid:VKe(e),recurringShoppingDefinitionCreateFormFieldsValidation:WKe(e),selectedRecurringShoppingDefinitionCreateFrequency:jE(e),selectedRecurringShoppingDefinitionName:i5(e),isUsePaymentChecksEnabled:yDt(e),appliedPaymentChecks:wR(e),isAgeConfirmationEnabled:IDt(e),isConciergeEnabled:SDt(e),toSavePaymentMethod:ME(e),isRecurringOrdersSelected:eN(e),retailerFinancingPlanId:y5(e),paymentOptionAndType:Im(e),selectedRetailerFinancingProvider:sN(e),selectedFinancingProviderId:nN(e),billingAddressManagementEnabled:CDt(e),billingAddress:r_(e).data,mandatoryBillingAddressEnabled:vDt(e),termsAndConditionsDialogEnabled:TDt(e),editRecurringOrdersEnabled:_Dt(e),currentOrderEntity:n,currentRecurringOrderId:o,pendingOrders:r,recurringOrder:a,editRecurringOrderOption:l5(e),isLoyaltyPaymentEnabled:bDt(e),isOrderEditDifferenceEnabled:xDt(e),isPaymentCheckoutSummaryV2Enabled:ADt(e)}},ODt=e=>({actions:vl({makeCheckoutRequest:ldt,setUnselectedPaymentWarning:Gt.setUnselectedPaymentWarning,analyticsEvent:U.analyticsEvent,performanceMark:ds,fetchAvailablePaymentChecks:t=>ej.fetchAvailablePaymentChecks(t),openConciergeDeliveryErrorModal:()=>J.openModal("conciergeDeliveryError"),sendAnalyticsEvent:U.analyticsEvent,saveConciergeDelivery:Ite.saveConciergeDelivery,setConciergeDelivery:Zr.setConciergeDelivery,openNonSavedPspModal:t=>J.openModal("selectNonSavedPspModal",t),setIsToSavePaymentMethodValid:Gt.setIsToSavePaymentMethodValid,fetchCheckoutValidation:KRt.fetchCheckoutValidation,openUnavailableItemsModal:t=>J.openModal(Ng,t),openSlotNotDeliverableModal:t=>J.openModal(bI,t),openInvalidSlotModal:()=>J.openModal(fP)},e)}),Yte=we(DDt,ODt)(RDt),PDt=({basketSummary:e,page:t})=>{const n=f(PT),o=f(HX),r=f(VX),a=f(HL),i=f(NT),l=f(LT),c=f(YX),d=e?.totals?.itemPriceAfterPromos,u=e?.totals?.paymentSplit?.paidByLoyalty,p=e?.totals?.paymentSplit?.remainingPayment,g=e?.totals?.display?.finalPrice,E=!!Number(e?.totals?.savingsPrice?.amount),y=d?.amount!==e?.totals?.finalPrice?.amount,I=!!Number(e?.totals?.paymentSplit?.paidByLoyalty?.amount)||!!Number(e?.totals?.paymentSplit?.remainingPayment?.amount),S=tE(e?.items);return e?s.jsxs(ae.Fragment,{children:[s.jsxs(fe,{children:[s.jsx(le.Items,{itemsRetailPrice:e?.totals?.itemsRetailPrice,quantity:S,withTaxNote:n}),s.jsx(le.Savings,{savings:e?.totals?.savingsPrice}),l&&i&&E&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:e?.totals?.paymentMethodSavingsPrice}),o&&E&&!!d&&y&&s.jsx(le.Subtotal,{value:d,withTaxNote:n}),s.jsx(VL,{basketSummary:e,taxNoteEnabled:n,getLoyaltySpent:bl,page:t})]}),s.jsx(WL,{basketSummary:e,taxNoteEnabled:n}),r&&u&&p&&I&&s.jsxs(h.Fragment,{children:[s.jsx(le.Separator,{}),s.jsx(fe,{"data-test":"summary-payment-list",children:s.jsx(le.PaymentChecks,{"data-test":"summary-payment-checks",remainingBalance:p,paidByCheck:u})})]}),a&&!c&&g&&u&&s.jsx(le.PaymentLoyalty,{subtotalPrice:g,paidByLoyalty:u}),s.jsx(le.Separator,{})]}):null},NDt=({basketSummary:e,page:t})=>{const n=f(PT),o=f(VX),r=f(HL),a=f(NT),i=f(LT),l=f(YX),c=e?.totals?.paymentSplit?.paidByLoyalty,d=e?.totals?.paymentSplit?.remainingPayment,u=e?.totals?.display?.finalPrice,p=!!Number(e?.totals?.savingsPrice?.amount),g=!!Number(e?.totals?.paymentSplit?.paidByLoyalty?.amount)||!!Number(e?.totals?.paymentSplit?.remainingPayment?.amount);return!e||!e.totalsGroups?null:s.jsx(h.Fragment,{children:e.totalsGroups.map(E=>{if(!Number(E.totals?.display?.finalPrice?.amount))return null;const{groupName:y}=E,I=kT(e.itemGroups,y,e.items);return s.jsxs(ae.Fragment,{children:[s.jsx(tl,{groupName:y,className:"salt-d--block salt-m-y--2"}),s.jsxs(fe,{children:[s.jsx(le.Items,{itemsRetailPrice:e?.totals?.itemsRetailPrice,quantity:I,withTaxNote:n}),s.jsx(le.Savings,{savings:e?.totals?.savingsPrice}),i&&a&&p&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:e?.totals?.paymentMethodSavingsPrice}),s.jsx(VL,{basketSummary:e,taxNoteEnabled:n,getLoyaltySpent:_V(y),page:t})]}),s.jsx(WL,{basketSummary:e,taxNoteEnabled:n}),o&&c&&d&&g&&s.jsxs(h.Fragment,{children:[s.jsx(le.Separator,{}),s.jsx(fe,{"data-test":"summary-payment-list",children:s.jsx(le.PaymentChecks,{"data-test":"summary-payment-checks",remainingBalance:d,paidByCheck:c})})]}),r&&!l&&u&&c&&s.jsx(le.PaymentLoyalty,{subtotalPrice:u,paidByLoyalty:c}),s.jsx(fe,{"data-test":"summary-seller-total",children:s.jsx(le.Subtotal,{value:u,label:"summary.total",withTaxNote:n})})]},y)})})},LDt=()=>{const e=f(WX),t=f(Sdt);return!e&&!t?null:s.jsx("div",{className:"salt-p-t--2 salt-p-x--4","data-test":"loyalty-earnings-summary",children:s.jsx(xu,{getQuantity:eE,allowZero:!0})})},kDt=()=>{const e=F(),t=h.useCallback((o,r,a,i)=>{const l={ADDRESS_ID:o,DELIVERY_DESTINATION_ID:r,CARRIER_NAME:a,EXTERNAL_COLLECTION_POINT_ID:i};return e(U.analyticsEvent({type:Le.DELIVERY_CARD_IMPRESSION,impression:l}))},[e]),n=h.useCallback(o=>e(U.analyticsEvent({type:Le.CHANGE_DELIVERY_BUTTON_CLICKED,EXTERNAL_COLLECTION_POINT_ID:o})),[e]);return h.useMemo(()=>({deliveryCardImpression:t,changeDeliveryButtonClicked:n}),[n,t])},FA=({isExpanded:e})=>{const{formatMessage:t}=L(),n=f(Hue),o=f(D("oed")),r=f(D("loy.waon")),{currency:a,checkoutPayment:i,checkoutLoyaltyPayment:l}=Lg()||{},c=es("seller-sales-enabled")==="true";if(!i||!o)return null;const{amountPaidByCustomer:d,amountToBeCharged:u,amountToBeRefunded:p}=i||{},{amountToBeRefunded:g,amountToBeCharged:E,amountPaidByCustomer:y}=l||{},S=[u,p,r&&g].filter(_=>Number(_)>0).length,C=Number(d)===0&&Number(u)>0&&Number(E)>0,T=(Number(d)>0||Number(y)>0)&&Number(u)>0;return e?s.jsxs(fe,{children:[r&&Number(n?.amount)>0&&s.jsx(le.TotalLoyaltyCharged,{amount:n?.amount,currency:a}),Number(d)>0&&s.jsx(le.TotalCharged,{amount:d,currency:a}),(C||T||S===0)&&s.jsx(le.TotalDifferenceToCharge,{amount:u,currency:a,inline:!e}),(c?!(Number(u)>0):!0)&&Number(p)>0&&s.jsx(le.TotalDifferenceToRefund,{amount:p,currency:a,inline:!e}),r&&Number(g)>0&&s.jsx(le.TotalLoyaltyDifferenceToRefund,{amount:g,currency:a,inline:!e})]}):S===0||S===1&&Number(u)>0?s.jsx(le.TotalDifferenceToCharge,{amount:u,currency:a,inline:!e}):S===1&&Number(p)>0?s.jsx(le.TotalDifferenceToRefund,{amount:p,currency:a,inline:!e}):S===1&&Number(g)>0&&r?s.jsx(le.TotalLoyaltyDifferenceToRefund,{amount:g,currency:a,inline:!e}):S>1?s.jsx(O,{children:t("summary.difference.multiple.transactions")}):null},O0="delivery-asset-card",jDt=({onChange:e})=>{const t=F(),{formatMessage:n}=L(),o=f(Hl),r=f($i),a=f(jte(o?.dropOff?.selectedId)),{deliveryAssetChanged:i}=Or(),l=a.find(p=>p.id===o?.deliveryAsset?.selectedId)?.id||"",c={[hs.DELIVERY_ASSET]:l};h.useEffect(()=>{d.reset(c)},[o?.deliveryAsset?.selectedId]);const d=Dn({defaultValues:c,mode:"onChange"}),u=async()=>{if(await d.trigger()){const g=d.getValues(),E=o?.deliveryAsset?.selectedId;try{const y=await t(Mte({deliveryDestinationId:r,formData:{additionalInformationValue:o?.additionalInformation?.value||"",dropOffId:o?.dropOff?.selectedId||"",entryInstructionId:o?.entryInstructions?.selectedId||"",deliveryAssetId:g[hs.DELIVERY_ASSET]}}));y&&(i({deliveryAssetId:y.deliveryAsset?.selectedId||"",preselectedDeliveryAssetId:E}),e())}catch{Z.error("toast.notification.generic.error")}}};return s.jsx(xe,{"data-test":O0,className:"salt-m-y--4",children:s.jsx(On,{...d,children:s.jsxs("form",{"data-test":`${O0}-form`,onSubmit:d.handleSubmit(u),children:[s.jsx(rr,{children:s.jsx(wte,{options:a,customLabel:s.jsx(O,{size:"l",bold:!0,children:n("delivery-details.delivery-asset-selector.title")}),onChange:u,required:!1})}),s.jsx("button",{type:"submit",className:"salt-d--none",children:"submit"})]})})})},MDt=({className:e=""})=>s.jsx(Te,{className:e,intent:"warning",text:s.jsx(b,{id:"checkout.summary.non.editable.order.alert"})}),wDt=()=>{const[e,t]=h.useState(!1);return s.jsxs(Je,{expanded:e,onToggle:()=>t(n=>!n),children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"checkout.summary.electronic.device.collection.title"})}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentCollapsed,{children:s.jsx("div",{className:"salt-m-t--4",children:s.jsx(b,{id:"checkout.summary.electronic.device.collection.short.description"})})}),s.jsxs(Je.ContentExpanded,{children:[s.jsx("div",{className:"salt-m-t--4",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.electronic.device.collection.short.description"})})}),s.jsx("div",{className:"salt-m-t--4",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.electronic.device.collection.additional.info"})})})]})]})},FDt=({checkoutErrorMessage:e})=>s.jsx(Te,{intent:"error",showIcon:!1,"data-test":"unresolvable-checkout-error-alert",text:e}),BDt=D("cs.tca"),UDt=({isTermsAndConditionsCheckboxAcknowledged:e,isTermsAndConditionsAcknowledgeError:t,toggleTermsAndConditionsCheckbox:n})=>{const o=L(),r=f(BDt),[a]=Ee(["nfchk"]),i=o.formatMessage("checkout.summary.termsandconditions.link.url"),l=o.formatMessage("checkout.summary.termsandconditions.second.link.url"),c=o.formatMessage("checkout.summary.termsandconditions.error");return r?s.jsx(h.Fragment,{children:a?s.jsx(fs.Checkbox,{id:Vd[_t.messages.TERMS_AND_CONDITIONS_UNCHECKED],value:"summary-t-and-c-checkbox",name:"summary-t-and-c-checkbox",checked:e,onChange:n,error:t?c:"",required:!0,label:s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"checkout.summary.termsandconditions.prelink.text"})," ",s.jsx(tt,{target:"_blank",href:i,className:"salt-d--block sm:salt-d--inline",children:s.jsx(b,{id:"checkout.summary.termsandconditions.link.text"})})," ",s.jsx(b,{id:"checkout.summary.termsandconditions.postlink.text"}),l?.trim()&&s.jsxs(h.Fragment,{children:[" ",s.jsx(tt,{href:l,target:"_blank","data-test":"summary-t-and-c-second-link",children:s.jsx(b,{id:"checkout.summary.termsandconditions.second.link.text"})})]})]}),"data-test":"summary-t-and-c-checkbox"}):s.jsx(Lo,{last:!0,id:Vd[_t.messages.TERMS_AND_CONDITIONS_UNCHECKED],input:{onChange:n,checked:e},bold:t,meta:{error:t?c:"",touched:t,invalid:t},label:s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"checkout.summary.termsandconditions.prelink.text"})," ",s.jsx(tt,{target:"_blank",href:i,bold:t,className:"salt-d--block sm:salt-d--inline",children:s.jsx(b,{id:"checkout.summary.termsandconditions.link.text"})})," ",s.jsx(b,{id:"checkout.summary.termsandconditions.postlink.text"}),l?.trim()&&s.jsxs(h.Fragment,{children:[" ",s.jsx(tt,{href:l,target:"_blank","data-test":"summary-t-and-c-second-link",children:s.jsx(b,{id:"checkout.summary.termsandconditions.second.link.text"})})]})]}),"data-test":"summary-t-and-c-checkbox"})}):s.jsxs(O,{children:[s.jsx(b,{id:"checkout.summary.termsandconditions.prelink.text"})," ",s.jsx(tt,{target:"_blank",href:i,className:"salt-d--block sm:salt-d--inline",children:s.jsx(b,{id:"checkout.summary.termsandconditions.link.text"})})," ",s.jsx(b,{id:"checkout.summary.termsandconditions.postlink.text"})," ",l?.trim()&&s.jsx(tt,{href:l,target:"_blank","data-test":"summary-t-and-c-second-link",children:s.jsx(b,{id:"checkout.summary.termsandconditions.second.link.text"})})]})},GDt=e=>{const t=h.useRef({}),n=h.useRef([]),o=(a,i)=>{i!==void 0&&!t.current[i]&&(n.current.push(a),t.current[i]=!0)},r=()=>{n.current.length>0&&(e({type:Ot.WALLET_ITEM_IMPRESSION,walletItemImpressions:n.current}),n.current=[])};return h.useEffect(()=>{r()}),{impression:o,impressionSent:t,queuedImpressions:n}},$Dt=(e,{walletItemId:t,fundingInstrumentId:n})=>{const o=a=>a.walletItemId===t,r=a=>a.fundingInstrumentId===n;return t&&e.find(o)||n&&e.find(r)},HDt=({wallet:e,initialFundingInstrumentId:t,initialWalletItemId:n,getWalletItems:o,updateSelectedPaymentMethod:r,isWalletItemDisabledOrExpired:a,showInvoicePaymentOption:i})=>{const l=F();h.useEffect(()=>{!e.lastUpdated&&!e.isFetching&&o()},[]),h.useEffect(()=>{e.lastUpdated&&c(e.items)},[e.items,i]);const c=d=>{if(i){r(zte);return}const p=$Dt(d,{walletItemId:n,fundingInstrumentId:t})||d.find(y=>y.isDefault),[g]=d,E=p||g||Kte;a(E)&&l(Gt.setPaymentOptionAndType({paymentOption:dt.PAY_NOW,paymentType:at.UNKNOWN})),r(E)}},VDt=e=>e?.filter(t=>t.available&&t.name!==dt.LOYALTY).map(({name:t,retailerFinancingPlanIds:n})=>({name:t,retailerFinancingPlanIds:n})),WDt=()=>async e=>{try{await e(fI.fetchActivePaymentMethodGroups())}catch{Z.error("request.error.title")}},YDt=()=>async(e,t)=>{const n=t(),o=kR(n)?.amount||"",r=D("pcs.v2")(n);let a;r?a=Jk(n):a=dte(n);const i=VDt(a);try{await e(yI.fetchPaymentMethodGroupsMetadata({groups:i??null,amount:o}))}catch{Z.error("request.error.title")}},qDt=()=>async e=>{try{await e(II.fetchPaymentMethodGroupPromotions())}catch{Z.error("request.error.title")}},xI={fetchActivePaymentMethodGroups:WDt,fetchPaymentMethodGroupsMetadata:YDt,fetchPaymentMethodGroupPromotions:qDt},kg=({paymentInfo:{paymentMethodV2:e,cardType:t},iconAriaLabel:n})=>{const o=G6({cardType:t,paymentMethod:e});return s.jsx(pe,{name:o,...KDt(o),"aria-label":n,tabIndex:0})},KDt=e=>{switch(e){case qt.INVOICE:case qt.BANK_TRANSFER:case qt.BLIK:return{};case qt.PAYPAL:return{height:20,width:42};default:return{height:20,width:40}}},Cj=({walletItem:e,checked:t,disabled:n})=>{const o=L(),r=o.formatMessage("checkout.summary.payment.method.expired");let a;e.paymentMethod===at.CARDS?a=o.formatMessage("payment.card.description",{cardName:(e.details.cardTypeDisplayName||"card").toLowerCase(),cardNumber:e.details.lastFourDigits,cardExpiryDate:`(${e.details.expiryMonth}/${e.details.expiryYear})`}):e.paymentMethod===at.PAYPAL&&(a=o.formatMessage("order.online.receipt.payment.accessibility.paypal",{emailAddress:e.details.emailAddress?.toLowerCase()}));const i=s.jsx(kg,{paymentInfo:{paymentMethodV2:e.paymentMethod,...e.details}});return s.jsx(Ao,{checked:t,label:i,name:"payment",disabled:n,error:e.expired?r:"",type:"radio",value:e.walletItemId,"aria-label":a,children:s.jsx(Ag,{paymentInfo:{nonSavedFundingInstrument:!1,paymentMethodV2:e.paymentMethod,...e.details}})},e.walletItemId)},zDt=({walletItem:e,impression:t,onClick:n,disabled:o,checked:r})=>{const a="wallet-item-type-card",i=`wallet-item-row-${e.walletItemId}`;return t({IS_DEFAULT:e.isDefault,WALLET_ITEM_ID:e.walletItemId},e.walletItemId),s.jsx(ba.Row,{onClick:l=>n(l,e),disabled:o,"data-synthetics":a,"data-test":i,children:s.jsx(Cj,{walletItem:e,checked:r,disabled:o})},e.walletItemId)},QDt=({isSelected:e,onClick:t})=>s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-t--4 salt-m-b--4",children:s.jsx(O,{bold:!0,children:s.jsx(b,{id:"checkout.summary.payment.method.unsaved.title"})})}),s.jsx("div",{className:"salt-m-t--4 salt-m-b--4",children:s.jsx(ba,{children:s.jsx(ba.Row,{onClick:t,"data-test":"unsaved-payment-method",children:s.jsx(Ao,{checked:e,name:"payment",label:s.jsx(kg,{paymentInfo:{paymentMethodV2:at.CARDS}}),children:s.jsx(O,{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"data-pii":"true",children:s.jsx(b,{id:"checkout.summary.payment.method.unsaved.description"})})})})})}),e&&s.jsx("div",{className:"salt-m-t--4",children:s.jsx(Te,{intent:"warning","data-test":"payment-unsaved-method-alert",text:s.jsx(b,{id:"checkout.summary.payment.method.unsaved.alert"})})})]}),XDt=({isSelected:e,onClick:t})=>s.jsx("div",{className:"salt-m-t--4 salt-m-b--4",children:s.jsx(ba,{children:s.jsx(ba.Row,{onClick:t,"data-test":"invoice-payment-method",children:s.jsx(Cj,{walletItem:{walletItemId:"INVOICE",paymentMethod:"INVOICE"},checked:e,disabled:!1})})})}),ZDt=({supportNonSavedPayment:e})=>{const t=L(),n={alertText:t.formatMessage("checkout.summary.payment.method.alert"),testName:"payment-missing-wallets-alert"},o={alertText:t.formatMessage("checkout.summary.payment.method.nonblocking.alert"),testName:"payment-missing-wallets-alert-non-blocking"},{alertText:r,testName:a}=e?o:n;return s.jsx(Te,{intent:"warning","data-test":a,text:r,className:"salt-m-b--2",showIcon:!1})},JDt=()=>{const t=L().formatMessage("checkout.summary.default.payment.method.expired.alert");return s.jsx(Te,{intent:"warning","data-test":"payment-default-expired-alert",text:t,className:"salt-m-b--4",showIcon:!1})},eOt=()=>{const t=L().formatMessage("checkout.summary.payment.method.unselected");return s.jsx(Te,{intent:"warning","data-test":"payment-unselected-wallet-alert",text:t,className:"salt-m-b--2",showIcon:!1})},tOt={TOO_MANY_REQUESTS:429},sOt=600,Fb={modalName:"psp",createWalletItemCreationSession:()=>{const e=Rqe(window.location);return yN.createWalletItemCreationSession({url:e})},setAddWalletItemFrameUrl:iS.setAddWalletPspwebFrameUrl},nOt=e=>Z.warning({key:"settings.wallet.create.item.rate.limited",substitutions:{numberOfMinutes:e}}),oOt=()=>Z.error("settings.wallet.create.item.error"),rOt=()=>{const e={event:"event",eventCategory:"Payment",eventAction:"AddWalletItemError"};return te.sendEvent({GA:e,WA:null}),U.analyticsEvent({type:Ot.ADD_WALLET_ITEM,event:"ERROR"})},aOt=()=>{const e={event:"event",eventCategory:"Payment",eventAction:"AddWalletItemStart"};return te.sendEvent({GA:e,WA:null}),U.analyticsEvent({type:Ot.ADD_WALLET_ITEM,event:"START"})},iOt=e=>e.statusCode===tOt.TOO_MANY_REQUESTS,BA=()=>e=>t=>{if(e(J.closeModal()),e(rOt()),iOt(t)){const n=sOt/60;nOt(n)}else oOt()},lOt=()=>e=>Promise.resolve(e(aOt())).then(()=>e(J.openModal(Fb.modalName))).then(()=>e(Fb.createWalletItemCreationSession())).then(t=>e(Fb.setAddWalletItemFrameUrl(t.payload.responseData.sessionUrl))).catch(BA()(e)),cOt=e=>t=>Promise.resolve(t(yN.createWalletItem(e))),_f={startAddWalletItem:lOt,createWalletItem:cOt},dOt=3e3,qte=({throttleTimeoutMs:e=dOt}={})=>{const t=h.useRef(null);return{shouldLogUnauthorizedAttempt:r=>{const a=Vt().valueOf(),i=t.current;return t.current={origin:r,timestamp:a},!i||i.origin!==r||a-i.timestamp>e},resetThrottling:()=>{t.current=null}}},uOt=({pspIFrameRef:e,onTokenizationSuccess:t,onTokenizationError:n,logUnauthorizedPostMessageAttempt:o,isSkipXssCheckEnabled:r=!1})=>{const{shouldLogUnauthorizedAttempt:a}=qte({throttleTimeoutMs:3e3}),i=d=>{d.redirectUrl&&window.location.assign(d.redirectUrl)},l=d=>{const u=e.current?.contentWindow;u&&u.postMessage(d.data,"*")},c=d=>!r&&!zP(d.origin)?(a(d.origin)&&o(d.origin),Promise.resolve()):(l(d),d.data?.type==="TRIGGER_EXTERNAL_REDIRECT"&&i(d.data),d.data?.type==="TOKENIZATION_ERROR"?(n(d),Promise.resolve()):!d.data||d.data.type!=="TOKENIZATION_RESULT_TOKEN"||!d.data.resultToken?Promise.resolve():t(d));h.useEffect(()=>(window.addEventListener("message",c),()=>{window.removeEventListener("message",c)}),[])},pOt="psp",vj=({close:e})=>{const t=F(),n=L(),o=h.useRef(null),r=f($e(pOt)),a=f(D(KP)),i=f(D("pay.skpxss")),l=f(hKe),c=y=>{y&&y.preventDefault(),e?e():t(J.closeModal()),t(iS.resetAddWalletPspwebFrameUrl())};uOt({pspIFrameRef:o,onTokenizationSuccess:async y=>t(_f.createWalletItem(y.data.resultToken)).then(({payload:I})=>{const S={event:"event",eventCategory:"Payment",eventAction:"AddWalletItemSuccess",walletItemId:I?.responseData?.walletItemId};return te.sendEvent({GA:S,WA:null}),t(U.analyticsEvent({type:Ot.ADD_WALLET_ITEM,event:"COMPLETE",walletItemId:I?.responseData?.walletItemId}))}).catch(t(BA())).finally(()=>c()),onTokenizationError:y=>{t(BA())(y),c()},logUnauthorizedPostMessageAttempt:y=>t(U.analyticsEvent({type:Ot.UNAUTHORIZED_POST_MESSAGE_ATTEMPT,origin:y})),isSkipXssCheckEnabled:i});const g="wallet-modal-header",E=!l;return s.jsxs(B,{isOpen:r,onRequestClose:c,aria:{labelledby:g},children:[s.jsx(B.Header,{align:a?"left":"center",children:s.jsx(ee,{as:"h1",id:g,"data-test":g,children:n.formatMessage("settings.wallet.add.card.modal.title")})}),s.jsxs(B.Body,{children:[l&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx("iframe",{sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox",title:n.formatMessage("settings.wallet.add.card.modal.title"),src:l,"data-synthetics":"psp-iframe","data-test":"psp-iframe",height:600,width:"100%",ref:o,style:{display:"initial"}})}),E&&s.jsx("div",{className:"salt-m--8",children:s.jsx(_s,{"data-test":"psp-modal-spinner"})})]})]})},mOt=({isSelected:e,onClick:t})=>s.jsx(ba.Row,{onClick:t,"data-test":"apple-pay-payment-method",children:s.jsx(Cj,{walletItem:{walletItemId:"APPLE_PAY",paymentMethod:"APPLE_PAY"},checked:e,disabled:!1})}),hOt=({applePayId:e})=>{const[,t]=h.useState(!1),o=f(HE)?.some(i=>i.type===at.APPLE_PAY),r=()=>{window.ApplePaySession?.canMakePayments()&&t(!0)},a=(i,l,c,d,u)=>{Ue.api.pushError(new Error("Apple Pay SDK failed to load"),{context:{error:u?.message}})};return h.useEffect(()=>{if(o&&!window.ApplePaySession){const i=document.createElement("script");i.src="https://applepay.cdn-apple.com/jsapi/v1.3.2/apple-pay-sdk.js",i.async=!0,i.integrity="sha384-DZRWMZLyVXr+7shJfal8pIG2v4KisLoSWFjZQMUv0+GWaCwoa82qeHsWrbBIUDPU",i.crossOrigin="anonymous",i.onload=r,i.onerror=a,document.getElementById(e)?.appendChild(i)}},[e,o]),typeof window>"u"?!1:(window.ApplePaySession?.canMakePayments()&&o)??!1},gOt={failedPaymentFundingInstrumentId:m.string,initialFundingInstrumentId:m.string,initialWalletItemId:m.string,primaryButton:m.element,additionalAlert:m.element,isFailedPayment:m.bool,onSelectPaymentMethod:m.func,supportNonSavedPayment:m.bool,selectedPayment:m.shape({walletItemId:m.string,expired:m.bool}),showRecurringOrderCheckbox:m.bool,updatePayerForRecurringOrder:m.func,payerForRecurringOrder:m.bool,isSelectedRecurringShoppingDefinitionFrequencyDefined:m.bool,isOverridePaymentMethodGroupsEnabled:m.bool,overridePaymentMethodGroups:m.arrayOf(m.shape({name:m.string,retailerFinancingPlanIds:m.arrayOf(m.string)})),enablePayByCardOptionWhenNoMetadataAvailable:m.bool},EOt={failedPaymentFundingInstrumentId:void 0,initialFundingInstrumentId:void 0,initialWalletItemId:void 0,isFailedPayment:!1,onSelectPaymentMethod:()=>{},supportNonSavedPayment:!1,primaryButton:null,additionalAlert:null,selectedPayment:void 0,showRecurringOrderCheckbox:!1,payerForRecurringOrder:!1,updatePayerForRecurringOrder:()=>{},isSelectedRecurringShoppingDefinitionFrequencyDefined:!1,overridePaymentMethodGroups:void 0,isOverridePaymentMethodGroupsEnabled:!1,enablePayByCardOptionWhenNoMetadataAvailable:!1},Kte={paymentMethodGroup:dt.PAY_NOW,paymentMethod:at.CARDS,walletItemId:null,isUnsavedPaymentMethodSelected:!0},zte={paymentMethodGroup:dt.B2B_DEFERRED_PAYMENT,paymentMethod:at.INVOICE,walletItemId:null,isUnsavedPaymentMethodSelected:!0},fOt={paymentMethodGroup:dt.PAY_NOW,paymentMethod:at.APPLE_PAY,walletItemId:null,isUnsavedPaymentMethodSelected:!1},bf=e=>{const{additionalAlert:t,failedPaymentFundingInstrumentId:n,initialFundingInstrumentId:o,initialWalletItemId:r,isFailedPayment:a,isSelectedRecurringShoppingDefinitionFrequencyDefined:i,onSelectPaymentMethod:l,payerForRecurringOrder:c,primaryButton:d,selectedPayment:u,showRecurringOrderCheckbox:p,supportNonSavedPayment:g,updatePayerForRecurringOrder:E,overridePaymentMethodGroups:y,isOverridePaymentMethodGroupsEnabled:I,enablePayByCardOptionWhenNoMetadataAvailable:S}=e,[C,T]=h.useState(u),_=F(),A="script-container-id",R=L(),{impression:P}=GDt(ge=>_(U.analyticsEvent(ge))),N=f(UE),k=f(tze),M=f(ge=>ge.session.isSuperuser),w=f(ge=>Ze(ge,"textbox-visibility-management-select-wallet-item-warning-is-selected-aware")==="true"),j=f(ge=>Ze(ge,"textbox-visibility-management-add-wallet-item-button-text-is-wallet-items-aware")==="true"),G=f(HE)||[],W=hOt({applePayId:A}),H=ge=>{ue(ge)||(l(ge),T(ge),_(Gt.setPaymentOptionAndType({paymentOption:ge.paymentMethodGroup,paymentType:ge.paymentMethod})),_(Gt.setToSavePaymentMethod(!ge.isUnsavedPaymentMethodSelected)))};h.useEffect(()=>{I&&y?.length&&_(xI.fetchPaymentMethodGroupsMetadata())},[I&&y?.length]);const K=G.find(ge=>ge.name===dt.B2B_DEFERRED_PAYMENT),q=I&&y?.length>0&&G.find(ge=>ge.name===dt.PAY_NOW)||S||!I,ne=ge=>ge&&ge===n,ue=ge=>ne(ge.fundingInstrumentId)||ge.expired;HDt({wallet:N,initialFundingInstrumentId:o,initialWalletItemId:r,updateSelectedPaymentMethod:H,isWalletItemDisabledOrExpired:ue,getWalletItems:()=>_(Km.getWalletItems()),showInvoicePaymentOption:K});const oe=(ge,Se)=>{ge.preventDefault(),ge.stopPropagation(),H(Se)},ye=ge=>ge&&!ne(ge.fundingInstrumentId)&&he(ge),he=ge=>C&&ge.walletItemId===C?.walletItemId,Ie=({target:{checked:ge}})=>{E(ge)};if(!N.lastUpdated||a&&!n)return s.jsx(js.Skeleton,{});const be=N.items.length>0,ce=w?be:k,me=j&&!be?R.formatMessage("checkout.summary.payment.method.button.empty.wallet"):R.formatMessage("checkout.summary.payment.method.button"),De=C&&C.expired;return s.jsxs(h.Fragment,{children:[s.jsxs("div",{className:"salt-m-b--4 salt-m-t--2",children:[!be&&!a&&s.jsx(ZDt,{supportNonSavedPayment:g}),t,ce&&s.jsx(eOt,{}),be&&q&&s.jsxs(h.Fragment,{children:[s.jsxs(ba,{fluid:!0,children:[De&&s.jsx(JDt,{}),N.items.map(ge=>s.jsx(zDt,{walletItem:ge,impression:P,onClick:oe,disabled:ue(ge),checked:ye(ge)})),W&&s.jsx(mOt,{isSelected:C?.paymentMethod==="APPLE_PAY",onClick:ge=>oe(ge,fOt)})]}),g&&!i&&s.jsx(QDt,{isSelected:C?.paymentMethod==="CARDS"&&C?.isUnsavedPaymentMethodSelected,onClick:ge=>oe(ge,Kte)})]})]}),p&&s.jsx(Lo,{label:s.jsx(b,{id:"payment.modal.recurring.orders.checkbox"}),input:{checked:c,onChange:Ie},bold:!1,"data-test":"use-payment-for-recurring-orders"}),K&&s.jsxs(ae.Fragment,{children:[s.jsx("div",{className:"salt-m-t--4 salt-m-b--4",children:s.jsx(O,{bold:!0,children:s.jsx(b,{id:"checkout.summary.payment.method.other.label"})})}),s.jsx(XDt,{isSelected:C?.paymentMethod==="INVOICE",onClick:ge=>oe(ge,zte)})]}),d,!M&&s.jsx(x,{onClick:()=>{_(U.analyticsEvent({type:Ot.ADD_PAYMENT_METHOD_MODAL_DISPLAYED,userAction:"open"})),_(_f.startAddWalletItem())},size:"m",intent:"secondary",fill:!0,"data-test":"add-payment-method-button","data-synthetics":"add-payment-method-button",children:s.jsx(x.Text,{children:me})}),s.jsx(vj,{}),s.jsx("span",{id:A})]})};bf.propTypes=gOt;bf.defaultProps=EOt;const Qte=e=>{const t=f(Ms);return new Intl.NumberFormat(t||"en-GB",{maximumFractionDigits:2}).format(Number(e)*100)},yOt=({bufferRate:e="0",action:t,analyticsEvent:n})=>{const o=L(),r=Qte(e);return s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-b--4","data-test":"payment-buffer-notice-text",children:s.jsx(b,{id:"checkout.summary.payment.paymentBuffer.notice",values:{bufferPercent:r}})}),s.jsx(x,{intent:"secondary",fill:!0,onClick:Tt(t,()=>n({type:Le.FIND_OUT_MORE_BUTTON_CLICKED,description:"User clicked find out more button"})),"data-test":"payment-buffer-open-modal-button","aria-label":o.formatMessage("checkout.summary.payment.paymentBuffer.accessibility.notice.button",{bufferPercent:r}),children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.payment.paymentBuffer.notice.button"})})})]})},P0=({handleBoxClick:e,paymentMethod:t,icon:n,text:o,dataTest:r,checked:a})=>s.jsx(xe,{onClick:i=>e(i),"data-synthetics":"payment-method-option",children:s.jsx(Ao,{checked:a,label:s.jsx(pe,{name:n}),value:t,"data-test":r,disabled:!1,error:"",role:void 0,last:!0,bold:!0,children:s.jsx(b,{id:o})})}),IOt=({onSelectPaymentMethod:e,isCheckoutSummaryInvoiceModalOpen:t,isSelectedRecurringShoppingDefinitionFrequencyDefined:n})=>{const[o,r]=h.useState(at.INVOICE),a=!n,i=h.useCallback(c=>{e(c),r(c)},[e]),l=(c,d)=>{c.preventDefault(),c.stopPropagation(),i(d)};return h.useEffect(()=>{e(at.INVOICE)},[]),h.useEffect(()=>{!a&&o===at.CARDS&&!t&&i(at.INVOICE)},[t,o,a,i]),s.jsxs(h.Fragment,{children:[s.jsx(P0,{paymentMethod:at.INVOICE,icon:"invoice",text:"checkout.summary.payment.method.label.pay.with.invoice",dataTest:"external-wallet-payment-selector-invoice-radio",handleBoxClick:c=>l(c,at.INVOICE),checked:at.INVOICE===o}),a&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx(P0,{paymentMethod:at.CARDS,icon:"payment_card",text:"checkout.summary.payment.method.label.pay.by.card",dataTest:"external-wallet-payment-selector-card-radio",handleBoxClick:c=>l(c,at.CARDS),checked:at.CARDS===o})})]})},SOt=({isOpen:e,isLoading:t,actions:{closeModal:n},resetRecurringShoppingForm:o})=>{const r=()=>{o(),n()},a=()=>{n()},i="invoice-warning-modal-header";return s.jsxs(B,{isOpen:e,isLoading:t,aria:{labelledby:i},children:[s.jsx(B.Header,{align:"left",children:s.jsxs(ee,{as:"h1",id:i,children:[s.jsx("div",{className:"salt-m-b-r--2 salt-d--inline-block",children:s.jsx(pe,{name:"invoice",height:30,width:30,verticalAlign:"sub"})}),s.jsx(b,{id:"checkout.summary.modal.invoice.title"})]})}),s.jsxs(B.Body,{children:[s.jsx("div",{className:"salt-m-t--4 salt-m-b--8",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.modal.invoice.body"})})}),s.jsx(Te,{intent:"warning",showIcon:!1,text:s.jsx(b,{id:"checkout.summary.modal.invoice.alert.warning.text"})})]}),s.jsxs(B.Footer,{className:"salt-gap--2",align:"left",children:[s.jsxs(x,{intent:"secondary",onClick:r,"data-test":"invoice-warning-modal-cancel-button",children:[s.jsx(ie,{children:s.jsx(b,{id:"checkout.summary.modal.invoice.cancel.accessibility"})}),s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.modal.invoice.cancel"})})]}),s.jsx(x,{intent:"action",onClick:a,"data-test":"invoice-warning-modal-continue-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.modal.invoice.continue"})})})]})]})},COt=e=>({isOpen:$e("checkoutSummaryInvoice")(e),isLoading:b6(e),hasFetchError:x6(e),isFetched:_6(e)}),vOt=st({closeModal:J.closeModal}),TOt=Tt(we(COt,vOt))(SOt),_Ot=({provider:e,onClick:t,instrumentType:n,showProvider:o,intl:r})=>{const a={[np.CARD]:"payment_card",[np.PAYPAL]:"paypal"},i={[np.CARD]:r.formatMessage("settings.wallet.add.item.modal.add.card"),[np.PAYPAL]:r.formatMessage("settings.wallet.add.item.modal.add.paypal")};return s.jsxs(x,{className:"salt-m-b--2",fill:!0,intent:"secondary","data-test":`wallet-item-add-${e.name.toLowerCase()}-button`,"data-synthetics":`wallet-item-add-${e.name.toLowerCase()}-button`,onClick:t,children:[s.jsx(x.Icon,{name:a[n]}),s.jsxs(x.Text,{children:[i[n],o?s.jsxs("span",{"data-test":"provider-name",children:["` ($",e.name,")`"]}):null]})]},e.name)};function bOt({activePsps:e,isOpen:t,onSelectPsp:n}){h.useEffect(()=>{if(!t)return;if(!e.length){Ue.api.pushError(new Error("There is no active psp in the environment"));return}const o=e.filter(r=>!r.isKnown()).map(r=>r.rawId);if(o.length){Ue.api.pushError(new Error(`These activePsps do not match any psp: ${o.join(", ")}`));return}if(e.length===1){const[r]=e;r&&n(r)}},[t,e,n])}const xOt=D("ppn"),AOt=D("m.la.h"),Xte=({isOpen:e=!1,modalLeftAlignEnabled:t=!1,isShowPaymentProviderNameFlagEnabled:n=!1,activePsps:o,actions:r,paymentFlow:a,onSelectPsp:i,close:l})=>{const[c,d]=h.useState(!1),u=L(),p={title:u.formatMessage("settings.wallet.add.item.modal.title")};h.useEffect(()=>{r.fetchActivePsps(a)},[]);const g=C=>{d(!0),i(C),E()};bOt({onSelectPsp:g,activePsps:o,isOpen:e});const E=()=>{r.analyticsEvent({type:Ot.ADD_PAYMENT_METHOD_MODAL_DISPLAYED,userAction:"close"}),d(!1),l?l():r.close()},y=C=>{if(!C.isKnown())return null;const T=C.id===ys.PayPal?np.PAYPAL:np.CARD;return s.jsx(_Ot,{provider:C,onClick:()=>g(C),showProvider:n,instrumentType:T,intl:u},C.name)},I=o.filter(C=>C.isKnown());if(I.length<2)return null;const S="select-wallet-item-modal-header";return s.jsxs(B,{isOpen:e,onRequestClose:()=>E(),loadingPlaceholder:"spinner",isLoading:c,aria:{labelledby:S},children:[s.jsx(B.Header,{align:t?"left":"center",children:s.jsx(ee,{as:"h1",id:S,"data-test":S,children:p.title})}),s.jsx(B.Body,{children:I?.map(C=>y(C))})]})},ROt=e=>({isShowPaymentProviderNameFlagEnabled:xOt(e),modalLeftAlignEnabled:AOt(e)}),DOt=st({fetchActivePsps:fte.fetchActivePsps,close:J.closeModal,analyticsEvent:U.analyticsEvent});Xte.defaultProps={close:void 0,isShowPaymentProviderNameFlagEnabled:!1,modalLeftAlignEnabled:!1};const OOt=we(ROt,DOt)(Xte),POt=EJe(yS.NON_SAVED),Zte=({isOpen:e=!1,activePsps:t,close:n,modalOptions:{setPsp:o}={setPsp:()=>{}}})=>{const r=a=>{a.id===vP.Braintree?o("BraintreePspWeb"):o(a.id)};return s.jsx(OOt,{activePsps:t,onSelectPsp:r,isOpen:e,paymentFlow:yS.NON_SAVED,close:n})};Zte.defaultProps={close:void 0};const N0="selectNonSavedPspModal",NOt=e=>({activePsps:POt(e),isOpen:$e(N0)(e),modalOptions:Yn(N0)(e)}),LOt=we(NOt)(Zte),kOt=({onChange:e})=>{const t=f(eN);return h.useEffect(()=>{e(t)},[t]),{hasRecurringOrders:t}},Tj=({className:e="salt-m-t--4 salt-m-b--2",dataTestId:t="save-payment-details"})=>{const n=F(),o=f(ME),r=L(),a=r.formatMessage("checkout.summary.save.payment.details.link"),i=u=>{n(Gt.setToSavePaymentMethod(u)),n(Gt.setIsToSavePaymentMethodValid(!0))};kOt({onChange:i});const c=f(nze)?"":r.formatMessage("checkout.summary.save.payment.details.validation.error"),d=!!a.trim();return s.jsx("div",{className:e,"data-test":t,children:s.jsx(Lo,{last:!0,input:{onChange:()=>i(!o),checked:o},bold:!!c,meta:{error:c,touched:!!c,invalid:!!c},label:s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"checkout.summary.save.payment.details.prelink.text"}),d&&s.jsx(tt,{className:"salt-d--inline-block",target:"_blank",href:a,children:s.jsx(b,{id:"checkout.summary.save.payment.details.link.text"})})]}),"data-test":"save-payment-details-checkbox"})})},jOt=D("m.la.h"),Jte="failure-modal-header",_j=({actions:e})=>{const t=f(jOt);return s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:t?"left":"center","data-test":"failure-modal-header",children:s.jsx(ee,{as:"h2",id:Jte,children:s.jsx(b,{id:"failure.modal.title"})})},"header"),s.jsx(B.Body,{children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colStart:{xs:2,md:3,lg:4},colSpan:{xs:10,md:8,lg:6},children:s.jsx(Q,{justify:"center",children:s.jsx(pe,{error:!0,name:"status_no",height:100,width:100})})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(O,{children:s.jsx(b,{id:"failure.modal.body"})})})]})},"body"),s.jsx(B.Footer,{align:t?"left":"center",children:s.jsx(x,{fill:!0,intent:"primary","data-test":"failure-modal-button",onClick:e.onButtonClick,children:s.jsx(x.Text,{children:s.jsx(b,{id:"failure.modal.button"})})})})]})},MOt=({modalLeftAlignEnabled:e,isLoyaltyPaymentEnabled:t})=>s.jsxs(B.Header,{align:e?"left":"center",children:[!e&&!t&&s.jsx(pe,{name:"loyalty",height:64,width:64,verticalAlign:"middle"}),!e&&s.jsx("div",{className:"salt-m-l--4"}),s.jsxs(ee,{as:"h2",id:"redeem-loyalty-modal-header",children:[e&&!t&&s.jsx("div",{className:"salt-m-r--1 salt-d--inline-block",children:s.jsx(pe,{name:"loyalty",height:30,width:30,verticalAlign:"sub"})}),s.jsx(b,{id:"loyalty.modal.heading"})]})]}),UA=({type:e="button",isRedeemable:t,closeModal:n,redeemLoyaltyPointsAndClose:o,className:r="salt-m-t--4"})=>s.jsx("div",{className:r,children:t?s.jsx(x,{type:e,intent:"primary",fill:!0,"data-test":"redeem-loyalty-and-close-button","data-synthetics":"basket-redeem-loyalty-points",onClick:e==="button"?o:void 0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"loyalty.modal.redeem.button"})})}):s.jsx(x,{type:e,intent:"primary",fill:!0,"data-test":"back-to-basket-button","data-synthetics":"basket-back",onClick:n,children:s.jsx(x.Text,{children:s.jsx(b,{id:"loyalty.modal.back"})})})}),wOt=D("loyalty"),FOt=({actions:e,currentOrderId:t,balance:n,canRedeem:o,loyaltyDisplayType:r,minSpend:a,balanceProgress:i,minSpendShortfall:l,isBalanceBelowMin:c,areApplicableItemsBelowMin:d,isUnApplicableItemsRestricted:u,isPartiallyRedeemable:p})=>{h.useEffect(()=>{const _={orderId:t,loyaltyMoney:n.money.amount,loyaltyCurrency:n.money.currency,loyaltyUnits:n.units,canRedeemLoyalty:o};e.analyticsEvent({type:Le.APPLICABLE_LOYALTY,..._})},[e,t,n,o]);const g=_=>r==="CURRENCY"?s.jsx(THe,{price:_.money}):_.units,E=()=>s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"loyalty.modal.discount.caption"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,children:s.jsx(bd,{discount:!0,getQuantity:rA})})})]}),y=()=>c?s.jsxs(h.Fragment,{children:[s.jsx(O,{children:s.jsx(b,{id:"loyalty.modal.minimum.caption",values:{minSpend:g(a),minSpendShortfall:g(l)}})}),s.jsx("div",{className:"salt-m-t--4",children:s.jsx(yv,{progress:i})})]}):null,I=()=>d?s.jsx(Te,{intent:"warning",showIcon:!1,text:s.jsx(b,{id:"loyalty.modal.applicable.items.below.min.alert"})}):null,S=()=>u?s.jsx(Te,{intent:"warning",showIcon:!1,text:s.jsx(b,{id:"loyalty.modal.non.applicable.items.alert"})}):null,C=()=>n?s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"loyalty.modal.balance.caption"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(bd,{getQuantity:BE})})]}):null,T=()=>p||d?s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{children:s.jsx(b,{id:"loyalty.modal.redeemable.caption"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(bd,{getQuantity:rA})})]}):null;return s.jsxs(h.Fragment,{children:[s.jsxs(fe,{children:[C(),T(),E()]}),y(),I(),S()]})},BOt=e=>({loyaltyDisplayType:wOt(e)?hN(e):null,minSpend:A6(e),balanceProgress:Q3e(e),minSpendShortfall:W3e(e),balance:BE(e),isPartiallyRedeemable:X3e(e),isBalanceBelowMin:q3e(e),areApplicableItemsBelowMin:K3e(e),isUnApplicableItemsRestricted:z3e(e),canRedeem:Z3e(e),currentOrderId:Ct(e)}),UOt=e=>({actions:vl({analyticsEvent:U.analyticsEvent},e)}),GOt=we(BOt,UOt)(FOt),$Ot=({isRedeemable:e,closeModal:t,addLoyaltyUnitsToBasket:n})=>{const o=()=>{n(),t()};return s.jsxs(B.Body,{children:[s.jsx(GOt,{}),s.jsx(UA,{isRedeemable:e,closeModal:t,redeemLoyaltyPointsAndClose:o})]})},HOt=({usedPoints:e,spendConversionRate:t,isIntendedPointsValid:n,amountToBePaidByCustomer:o})=>{const r=He();return o&&t!==1?s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{padding:"md",children:s.jsx(b,{id:"loyalty.modal.discount.caption"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{intent:"promotion",bold:!0,children:r({...o,amount:n?Wi(e*t):0})})})]}):null},VOt=({balance:e})=>{const t=km({getQuantity:e});return t?s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{padding:"md",children:s.jsx(b,{id:"loyalty.modal.balance.caption"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{bold:!0,children:t})})]}):null},WOt=({amountToBePaidByCustomer:e})=>{const t=He();return e?s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{padding:"md",children:s.jsx(b,{id:"loyalty.modal.order.offered.price.caption"})}),s.jsx(fe.Description,{nowrap:!0,children:s.jsx(O,{bold:!0,"data-test":"loyalty-modal-order-offered-price-amount",children:t(e)})})]}):null},fi={AmountStepMismatch:"loyalty.modal.validation.status.step-mismatch",AmountExceedsBalance:"loyalty.modal.validation.status.balance-exceeded",AmountExceedsOrderValue:"loyalty.modal.validation.status.order-value-exceeded",AmountNotProvided:"loyalty.modal.validation.status.amount-not-provided",NonNumericalInput:"loyalty.modal.validation.status.non-numerical-input",AmountBelowMinSpend:"loyalty.modal.validation.status.below.min.spend",AmountExceedsMaxSpend:"loyalty.modal.validation.status.above.max.spend",MinMonetarySpend:"exceeded.loyalty.points.amount.validation.error"},Fr="loyalty-points-amount-to-use",YOt=v(nr)`
    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
        appearance: none;
        margin: 0;
    }
`,qOt="^[1-9]+[0-9]*$",KOt=({setUsedPoints:e,formContext:t,balance:n,onInvalid:o,closeModal:r,isRedeemable:a,errorMessage:i,minSpendUnits:l,maxSpendUnits:c,minMonetarySpend:d,spendIncrementStep:u,spendConversionRate:p,defaultRedeemableUnits:g,addLoyaltyUnitsToBasket:E,loyaltyUnitsLeftToSpend:y,amountToBePaidByCustomer:I})=>{const S=L(),C=He(),[T]=Ee(["nfchk"]),_=w=>{const j=Number(w);return d&&Number(d.amount)&&j>Number(y)?S.formatMessage(fi.MinMonetarySpend,{points:y,money:C(d)}):j>n.units?S.formatMessage(fi.AmountExceedsBalance):j>c?S.formatMessage(fi.AmountExceedsMaxSpend,{maxSpendUnits:c}):j>Number(I.amount)/p?S.formatMessage(fi.AmountExceedsOrderValue):j<l?S.formatMessage(fi.AmountBelowMinSpend,{minSpendUnits:l}):(e(j),!0)},A=()=>{t.getFieldState(Fr).invalid||(E(Number(t.getValues(Fr))),r())},R=w=>{w.preventDefault();let j="";const G=w.target;G instanceof HTMLInputElement&&!G.validity.valid&&(G.validity.patternMismatch?j=S.formatMessage(fi.NonNumericalInput):G.validity.valueMissing?j=S.formatMessage(fi.AmountNotProvided):G.validity.stepMismatch&&(j=S.formatMessage(fi.AmountStepMismatch)),G.focus()),o(j)},P=w=>{const j=_(w??"");return e(Number(w)),typeof j=="string"?(o(j),!1):(o(""),!0)},N=w=>{w.preventDefault();const j=w.currentTarget,G=j.elements.namedItem(Fr),H=new FormData(j).get(Fr)?.toString();if(!P(H??"")&&G instanceof HTMLInputElement){G.focus();return}j.checkValidity(),E(Number(H)),r()},k=()=>{P("")},M=w=>{const j=w.target.value;P(j)};if(T){const w=S.formatMessage("loyalty.modal.configurable.spend.caption"),j=S.formatMessage("loyalty.modal.configurable.spend.placeholder"),G=S.formatMessage("salt.form.text-field.clear-button.a11y.label");return s.jsxs(fs,{onSubmit:N,onInvalid:R,children:[s.jsx(fs.TextField,{required:!0,type:"number",onBlur:M,onClear:k,step:u,pattern:qOt,errorMessage:i,label:{text:w},placeholder:j,id:Fr,defaultValue:g,name:Fr,"data-test":"configurable-loyalty-points-input-field",clearButton:{ariaLabel:G}},Fr),s.jsx(UA,{type:"submit",className:"salt-m-t--8",closeModal:r,isRedeemable:a})]})}return s.jsx(On,{...t,children:s.jsxs("form",{onSubmit:t.handleSubmit((w,j)=>{j?.preventDefault();const{[Fr]:G}=w;E(Number(G)),r()}),children:[s.jsx(YOt,{name:Fr,id:Fr,label:S.formatMessage("loyalty.modal.configurable.spend.caption"),placeholder:S.formatMessage("loyalty.modal.configurable.spend.placeholder"),pattern:{value:/^[1-9]+[0-9]*$/,message:S.formatMessage(fi.AmountNotProvided.toString())},validate:_,hasRequiredSymbol:!1,type:"number",step:u,valueAsNumber:!1,"data-test":"configurable-loyalty-points-input-field",required:{value:!0,message:S.formatMessage(fi.NonNumericalInput.toString())}},Fr),s.jsx(UA,{isRedeemable:a,closeModal:r,redeemLoyaltyPointsAndClose:A,className:"salt-m-t--8"})]})})},zOt=({redeemableUnits:e,balance:t,spendConversionRate:n,spendIncrementStep:o,isRedeemable:r,closeModal:a,addLoyaltyUnitsToBasket:i,amountToBePaidByCustomer:l,maxSpendUnits:c,minSpendUnits:d,minMonetarySpend:u,loyaltyUnitsLeftToSpend:p})=>{const[g,E]=h.useState(e),y=f(Ct),[I]=Ee(["nfchk"]),[S,C]=h.useState(""),T=F();h.useEffect(()=>{T(U.analyticsEvent({type:Le.LOYALTY_POINTS_DISPLAYED,payload:{pageEventAttributes:{type:"loyaltyPayment",orderId:y,balance:t}}}))},[t,y,T]);const _=Dn({mode:"onBlur",reValidateMode:"onBlur",defaultValues:{[Fr]:e===0?void 0:e}});return s.jsx(B.Body,{children:s.jsxs(fe,{children:[s.jsx(VOt,{balance:BE}),s.jsx(WOt,{amountToBePaidByCustomer:l}),s.jsx(HOt,{usedPoints:g,isIntendedPointsValid:I?!S:!_.getFieldState(Fr).invalid,amountToBePaidByCustomer:l,spendConversionRate:n}),s.jsx(KOt,{errorMessage:S,onInvalid:A=>C(A),defaultRedeemableUnits:e===0?void 0:e.toString(),setUsedPoints:E,formContext:_,spendIncrementStep:o,balance:t,amountToBePaidByCustomer:l,spendConversionRate:n,isRedeemable:r,closeModal:a,addLoyaltyUnitsToBasket:i,maxSpendUnits:c,minSpendUnits:d,minMonetarySpend:u,loyaltyUnitsLeftToSpend:p})]})})},QOt=e=>({amountToBePaidByCustomer:s5e(e),balance:BE(e),spendConversionRate:e5e(e),spendIncrementStep:J3e(e),maxSpendUnits:n5e(e),minSpendUnits:R6(e),minMonetarySpend:o5e(e),loyaltyUnitsLeftToSpend:r5e(e)}),XOt=Tt(we(QOt))(zOt),ZOt=D("m.la.h"),JOt=D("loy.waon"),ePt=({isOpen:e,isLoading:t,hasFetchError:n,isRedeemable:o,redeemableUnits:r,isLoyaltyPaymentEnabled:a,actions:{closeModal:i,addLoyaltyUnitsToBasket:l,getApplicableLoyalty:c},isFetched:d,modalLeftAlignEnabled:u=!1})=>s.jsx(B,{isOpen:e,isLoading:t,onAfterOpen:()=>c(),onRequestClose:i,aria:{labelledby:n?Jte:"redeem-loyalty-modal-header"},asBottomSheet:!0,children:n?s.jsx(_j,{actions:{onButtonClick:()=>c()}}):s.jsxs(h.Fragment,{children:[s.jsx(MOt,{modalLeftAlignEnabled:u,isLoyaltyPaymentEnabled:a}),d&&(a?s.jsx(XOt,{isRedeemable:o,redeemableUnits:r,closeModal:i,addLoyaltyUnitsToBasket:l}):s.jsx($Ot,{isRedeemable:o,closeModal:i,addLoyaltyUnitsToBasket:l}))]})}),tPt=e=>({isOpen:$e("redeemLoyalty")(e),isLoading:b6(e),hasFetchError:x6(e),isRedeemable:Y3e(e),redeemableUnits:EN(e),isFetched:_6(e),modalLeftAlignEnabled:ZOt(e),isLoyaltyPaymentEnabled:JOt(e)}),sPt=e=>({actions:vl({closeModal:J.closeModal,addLoyaltyUnitsToBasket:Pg.addLoyaltyUnitsToBasket,getApplicableLoyalty:Wy.getApplicableLoyalty},e)}),ese=Tt(we(tPt,sPt))(ePt),kS=({type:e,action:t,readOnly:n=!1,children:o})=>{const r=L();return s.jsx(xe,{condensed:!0,"data-test":`summary-${e}`,className:"salt-p--0",children:s.jsxs(Q,{justify:"space-between",align:"center",wrap:"nowrap",children:[s.jsxs(Q,{className:"salt-m-r--1",align:"center",wrap:"nowrap",children:[!n&&s.jsx(pe,{className:"salt-m-r--1",success:!0,name:"status_yes",verticalAlign:"bottom",lineHeight:"0",height:20,width:20}),s.jsx(O,{children:o})]}),!n&&s.jsx(x,{intent:"tertiary",fill:!1,"data-test":`${e}-remove`,"aria-label":r.formatMessage("summary.component.accessibility.discount.remove.button.label"),onClick:t,children:s.jsx(x.Icon,{name:"close_default","aria-hidden":!0})})]})})},tse=({loyaltyInBasket:e,removeLoyaltyUnitsFromBasket:t})=>s.jsx(Be.Item,{children:s.jsx(kS,{type:"loyalty",action:t,children:s.jsx(b,{id:"checkout.summary.discounts.loyalty.redeemed",values:{loyaltyRedeemed:e}})})},"loyalty"),nPt=v.div`
    padding-block: var(--salt-spacing-1) 0;
    padding-inline: var(--salt-spacing-8) 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    column-gap: var(--salt-spacing-1);
`,oPt=v.span`
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border: var(--salt-border-1) solid var(--intent-secondary-900);
    border-radius: var(--salt-radius-default);
    block-size: ${$(24)};
    inline-size: ${e=>`${$(e.containerWidth)}`};
    overflow: hidden;
`,rPt=h.memo(({icons:e})=>{const{formatMessage:t}=L(),n=es("financing-options-option-name");return e?.length?s.jsx(nPt,{"data-test":"payment-list-item-icons",children:e.map(o=>{const r=aPt({name:o,formatMessage:t,defaultAltText:n}),{containerWidth:a,width:i,height:l}=iPt(o);return s.jsxs(oPt,{"data-test":"payment-list-item-icon",containerWidth:a,children:[s.jsx(pe,{name:o,height:l,width:i,"aria-hidden":"true"}),s.jsx(ie,{children:r})]},o)})}):null}),aPt=({name:e,formatMessage:t,defaultAltText:n})=>{switch(e){case qt.VISA:return t("checkout.summary.payment.options.cardsAndPaypal.accessibility.visa");case qt.MASTERCARD:return t("checkout.summary.payment.options.cardsAndPaypal.accessibility.mastercard");case qt.PAYPAL:return t("checkout.summary.payment.options.cardsAndPaypal.accessibility.payPal");case qt.BLIK:return t("checkout.summary.payment.options.payNow.accessibility.blik");case qt.BANK_TRANSFER:return t("checkout.summary.payment.options.payNow.accessibility.bankTransfer");case qt.PAYMENT_CARD:return t("checkout.summary.payment.options.payNow.accessibility.paymentCard");case qt.VISA_PHONE:return t("checkout.summary.payment.options.payNow.accessibility.visaPhone");case qt.GOOGLE_PAY:return t("checkout.summary.payment.options.payNow.accessibility.googlePay");case qt.APPLE_PAY:return t("checkout.summary.payment.options.payNow.accessibility.applePay");case qt.SMARTNEY:return t("checkout.summary.payment.options.payNow.accessibility.smartney");case qt.ONEY:return t("checkout.summary.payment.options.payNow.accessibility.oney");case qt.L_PAY:return t("checkout.summary.payment.options.payNow.accessibility.lPay");default:return n}},iPt=e=>{switch(e){case qt.PAYPAL:return{width:57,containerWidth:69,height:14};case qt.FINANCING_OPTION_ICON:return{width:82,containerWidth:92,height:14};case qt.BANK_TRANSFER:case qt.PAYMENT_CARD:case qt.VISA_PHONE:case qt.GOOGLE_PAY:case qt.APPLE_PAY:return{width:26,containerWidth:36,height:20};case qt.NAVERPAY:case qt.KAKAOPAY:return{width:35,containerWidth:35,height:23};case qt.L_PAY:return{width:45,containerWidth:45,height:23};default:return{width:24,containerWidth:36,height:14}}},{RadioIconOff:lPt,RadioIconOn:cPt}=Pa,dPt=v.div`
    margin-block-end: var(--salt-spacing-0.5);

    &:last-child {
        margin-block-end: var(--salt-spacing-2);
    }
`,uPt=v.label`
    font-weight: 600;
    font-size: ${$(16)};
    display: flex;
    align-items: center;
    column-gap: var(--salt-spacing-1);
    padding-inline-start: 0;
    inline-size: fit-content;
`,pPt=v.input`
    block-size: 0;
    inline-size: 0;
    position: absolute;
    appearance: none;

    &:focus + span {
        outline: ${$(5)} auto Highlight;
        outline: ${$(5)} auto -webkit-focus-ring-color;
        outline-offset: ${$(1)};
    }
`,mPt=({label:e,onChange:t,ariaLabel:n,icons:o,checked:r,children:a,value:i,promotion:l})=>{const{formatMessage:c}=L();return s.jsxs(dPt,{children:[s.jsxs(Q,{"data-test":"payment-list-item-header",className:"salt-m-y--2",direction:"column",children:[s.jsxs(Q,{direction:"row",align:"center",justify:"space-between",additionalCss:"flex: 1",children:[s.jsx(Q,{direction:"row",wrap:"nowrap",children:s.jsxs(uPt,{"aria-label":n,children:[s.jsx(pPt,{type:"radio",checked:r,name:"payment-option","data-test":"payment-list-item-control",value:i,onChange:t,"data-synthetics":"payment-method-option"}),r&&s.jsx(cPt,{name:"radio_on"}),!r&&s.jsx(lPt,{name:"radio_off"}),s.jsx("span",{children:e})]})}),l&&s.jsx(O,{intent:"promotion",size:"s",children:c("checkout.summary.payment.method.promotion.available")})]}),s.jsx(rPt,{icons:o})]}),s.jsx(ov.Provider,{value:{expanded:r,name:"payment-list-item",onToggle:()=>{}},children:s.jsx(Je.ContentExpanded,{children:s.jsx("div",{className:"salt-p salt-p-l--8 salt-p-r--0.5",children:a})})})]})};class hPt extends Error{}class L0 extends Error{}const sse=()=>{const{formatMessage:e}=L(),t=f(HE);return h.useMemo(()=>{if(!t)return[];const n=[{id:dt.PAY_NOW,title:e("checkout.summary.payment.options.payNow.title"),ariaLabel:e("checkout.summary.payment.options.payNow.accessibility.radio.label"),type:at.UNKNOWN},{id:dt.L_PAY,title:e("checkout.summary.payment.options.payNow.lPay.title"),ariaLabel:e("checkout.summary.payment.options.payNow.lPay.accessibility.radio.label"),type:at.L_PAY},{id:dt.CASH_ON_DELIVERY,title:e("checkout.summary.payment.options.payAtDelivery.title"),ariaLabel:e("checkout.summary.payment.options.payAtDelivery.accessibility.radio.label"),type:at.CASH_ON_DELIVERY},{id:dt.B2B_DEFERRED_PAYMENT,title:e("checkout.summary.payment.options.invoice.title"),ariaLabel:e("checkout.summary.payment.options.invoice.accessibility.radio.label"),type:at.INVOICE},{id:dt.INSTALMENTS,title:e("checkout.summary.payment.options.financingOptions.title"),ariaLabel:e("checkout.summary.payment.options.instalments.accessibility.radio.label"),type:at.CARD_INSTALMENTS},{id:dt.KAKAOPAY,title:e("checkout.summary.payment.options.kakaopay.title"),ariaLabel:e("checkout.summary.payment.options.kakaopay.accessibility.radio.label"),type:at.KAKAOPAY},{id:dt.NAVERPAY,title:e("checkout.summary.payment.options.naverpay.title"),ariaLabel:e("checkout.summary.payment.options.naverpay.accessibility.radio.label"),type:at.NAVERPAY}];return t.reduce((o,r)=>{const a=n.find(i=>i.id===r.name&&i.type===r.type);return a&&o.push({...a,promotion:r.promotion,icons:r.iconAssetsNames}),o},[])},[t,e])},jS=({message:e})=>{const n=L().formatMessage(e);return!n.trim()?null:s.jsx(Te,{intent:"info",className:"salt-m-t--2",size:"s",text:n})},gPt=({interestRates:e,commissionFee:t})=>{const{formatNumber:n,formatMessage:o}=L(),r=He();return s.jsxs(Q,{wrap:"wrap",align:"center",justify:"flex-start",children:[e.map(({name:a,value:i,accessibilityLabel:l})=>s.jsxs("span",{className:"salt-m-r--1",children:[s.jsxs(O,{size:"s",className:"salt-m-r--0.5","aria-hidden":"true",children:[a,":"]}),s.jsx(ie,{children:l}),s.jsx(O,{size:"s",bold:!0,children:n(i,{style:"percent",minimumFractionDigits:2})})]},a)),s.jsxs("span",{children:[s.jsxs(O,{size:"s",className:"salt-m-r--0.5",children:[o("checkout.summary.payment.options.financingOptions.calculator.commissionFee"),":"]}),s.jsx(O,{size:"s",bold:!0,children:r(t)})]})]})},EPt=({activeOption:{totalAmount:e,monthlyAmount:t,offerAvailabilityEnd:n,commissionFee:o,interestRates:r}})=>{const a=He(),i=f(Zt),l=h.useMemo(()=>n&&qs(i,n),[n]);return!t||!e||!n||!o||!r?null:s.jsxs("div",{"data-test":"instalments-calculator",children:[t&&s.jsx(ee,{as:"span",className:"salt-m-b--1",children:s.jsx(b,{id:"checkout.summary.payment.options.financingOptions.calculator.paymentPerMonth",values:{paymentAmount:a(t)}})}),e&&s.jsx("div",{className:"salt-m-b--1",children:s.jsx(O,{size:"l",className:"salt-m-r--0.5",children:s.jsx(b,{id:"checkout.summary.payment.options.financingOptions.calculator.total",values:{paymentTotalAmount:a(e)}})})}),r&&o&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx(gPt,{interestRates:r,commissionFee:o})}),l&&s.jsx(Te,{intent:"warning",showIcon:!1,text:s.jsx(b,{id:"checkout.summary.payment.options.financingOptions.calculator.validUntil",values:{validityndDate:l}})})]})},fPt=({activePlan:e,financingPlans:t})=>{const n=es("financing-options-instalment-plans-description-url");if(!t?.length)return null;const o=t.find(r=>r.retailerFinancingPlanId===e);return s.jsxs("div",{className:"salt-m-t--2",children:[o&&s.jsx(EPt,{activeOption:o}),o?.description&&o?.linkDescription&&s.jsxs(O,{"data-test":"financing-option-text",children:[o?.description,n&&s.jsx(tt,{className:"salt-m-l--0.5",target:"_blank",href:n,children:o.linkDescription})]})]})},{RadioIconOff:yPt,RadioIconOn:IPt}=Pa,SPt=v.div`
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--salt-spacing-4);
    cursor: pointer;
    background: white;
    border-radius: var(--salt-radius-default);
    margin-block-end: var(--salt-spacing-1);
`,CPt=v.div`
    display: flex;
    align-items: center;
    gap: var(--salt-spacing-2);
`,vPt=v.span`
    margin-block-end: var(--salt-spacing-2);
`,TPt=({value:e,label:t,promotionText:n,icon:o,isSelected:r,onClick:a,dataTest:i,previousSelectValue:l,enableAriaLabel:c=!0,...d})=>{const{formatMessage:u}=L(),p=E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),a())},g=()=>{const E=[];return E.push(u(r?"checkout.summary.payment.options.financingOptions.modal.accessibility.option.selected.label":"checkout.summary.payment.options.financingOptions.modal.accessibility.option.unselected.label",{option:t})),l&&E.push(l),n&&E.push(n),E.join(", ")};return s.jsxs(SPt,{className:r?"selected":"",onClick:a,onKeyDown:p,"data-test":i||`select-option-${e}`,role:"option",tabIndex:0,"aria-label":c?g():void 0,"aria-selected":r,...d,children:[s.jsxs(CPt,{children:[r?s.jsx(IPt,{name:"radio_on"}):s.jsx(yPt,{name:"radio_off"}),o&&s.jsx(vPt,{children:o}),s.jsx("span",{children:t})]}),n&&s.jsx(O,{intent:"promotion",size:"s",children:n})]})},_Pt=(()=>{let e=0;return{next(){return e+=1,`uid-${e}`}}})(),bPt=v.span`
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: ${({disabled:e})=>e?"var(--intent-content-200)":"var(--intent-content)"};
`,bj=({onChange:e,value:t,children:n,placeholder:o="",size:r="md",id:a="",error:i,label:l="",hideLabel:c,helperText:d="",flush:u=!1,className:p,fill:g,options:E=[],confirmText:y="",confirmArialLabel:I,closeMessage:S="",previousSelectValue:C,autoOpenSecondModal:T=!1,enableAriaLabel:_=!0,secondaryOptions:A=[],blockModalOpening:R=!1,onSecondarySelect:P,...N})=>{const M=h.useRef(a||_Pt.next()).current,w=`${M}-error-message`,j=!!i,[G,W]=h.useState(!1),[H,K]=h.useState(t),[X,q]=h.useState(t),ne=f(sN),ue=f(D("pbpm"));h.useEffect(()=>{ue&&(K(t),q(t))},[ne,ue]);const oe=Ae=>{const Ce=[],We=ve=>Array.isArray(ve.props?.children)&&ve.props.children.length>0,et=ve=>We(ve)&&ve.type!=="option"?ve.props.children.map(lt=>et(lt).flat()):[ve];return h.Children.toArray(Ae).map(ve=>et(ve).flat()).flat().filter(ve=>ve.type==="option").forEach(ve=>{Ce.push({value:ve.props.value,label:ve.props.children})}),Ce},ye=()=>{R||(q(H),W(!0))},he=()=>{W(!1),q(H)},Ie=Ae=>{q(Ae.value)},Fe=()=>{K(X);const Ae={target:{value:X,name:N.name}};e?.(Ae),he()},be=Ae=>{Ae.key==="Enter"&&(Ae.preventDefault(),ye())},ce=()=>{const Ae=me.find(Ce=>Ce.value===H);return Ae?Ae.label:o},me=E.length>0?E:oe(n),De=()=>s.jsx("div",{className:"salt-m-b--4",children:me.map(Ae=>s.jsx(TPt,{value:Ae.value,previousSelectValue:C,label:Ae.label,promotionText:Ae.promotionText,icon:Ae.icon,isSelected:X===Ae.value,onClick:()=>Ie(Ae),dataTest:`select-option-${Ae.value}`,enableAriaLabel:_},Ae.value))}),ge=N["data-test"]&&N["data-test"]!==""?`${N["data-test"]}-select-modal-result`:"select-modal-result",Se="select-modal-header";return s.jsxs(ae.Fragment,{children:[s.jsxs(_a,{"data-test":"select-modal-wrapper",fill:g,className:p,children:[!!l&&s.jsx(Rn,{visuallyConcealed:!!c,hasError:!!i,htmlFor:M,isRequired:N.required,children:l}),d&&s.jsx(O,{className:"salt-d--block salt-m-b--1",children:d}),s.jsx(Xu.SelectWrapper,{hasError:j,size:r,onClick:ye,"data-test":N["data-test"]||"select-modal-trigger",onKeyDown:be,tabIndex:0,children:s.jsx(bPt,{"data-test":ge,disabled:R,children:H?ce():s.jsx(Xu.Placeholder,{hasError:j,children:o})})}),j&&s.jsx(oi,{"data-test":"form-field-error-message",id:w,children:i})]}),s.jsxs(B,{isOpen:G,onRequestClose:he,maxWidth:"sm","data-test":"select-modal-options",closeMessage:S,aria:{labelledby:Se},children:[s.jsx(B.Header,{children:s.jsx(ee,{as:"h1",id:Se,children:s.jsx(O,{children:l})})}),s.jsx(B.Body,{children:De()}),s.jsx(B.Footer,{children:s.jsx(x,{intent:"primary",fill:!0,onClick:Fe,"data-test":"select-modal-confirm","aria-label":I,children:y})})]})]})};bj.displayName="SelectModal";const xPt=({value:e,onChange:t,options:n,activeProvider:o,enableAriaLabel:r=!0})=>{const{formatMessage:a}=L(),i="financing-option-dropdown",l=a("checkout.summary.payment.options.financingOptions.dropdown.label"),c=n.find(({retailerFinancingPlanId:u})=>u===e)?.displayName,d=a("checkout.summary.payment.options.financingOptions.accessibility.radio.label",{financingOption:c});return s.jsx(bj,{label:s.jsx(O,{size:"l",bold:!0,children:l}),confirmText:a("checkout.summary.payment.options.financingOptions.modal.confirm"),confirmArialLabel:a("checkout.summary.payment.options.financingOptions.modal.accessibility.confirm"),id:i,tabIndex:0,name:l,value:e??"",previousSelectValue:o,onChange:t,enableAriaLabel:r,"aria-label":d,closeMessage:a("checkout.summary.payment.options.financingOptions.modal.accessibility.close",{title:l}),"data-test":"financing-options-select",children:n.map(({retailerFinancingPlanId:u,displayName:p})=>s.jsx("option",{value:u?.toString(),children:p},u))})},APt=({value:e,onChange:t,options:n,isFinancingProviderNotSelectedError:o,blocked:r,enableAriaLabel:a=!0})=>{const{formatMessage:i}=L(),l="financing-provider-dropdown",c=i("checkout.summary.payment.options.financingProviders.accessibility.dropdown.label"),d=n.find(({retailerFinancingProviderId:E})=>E===e)?.name,u=i("checkout.summary.payment.options.financingProviders.accessibility.radio.label",{financingProvider:d}),p=i("checkout.summary.payment.options.financingProviders.accessibility.dropdown.placeholder"),g=i("checkout.summary.payment.options.financingProviders.accessibility.dropdown.errorMessage");return s.jsx("div",{className:"salt-m-b--2",tabIndex:0,children:s.jsx(bj,{id:l,name:c,value:e,onChange:t,"aria-label":u,label:s.jsx(O,{size:"l",bold:!0,children:c}),size:"md",placeholder:p,confirmText:i("checkout.summary.payment.options.financingOptions.modal.confirm"),confirmArialLabel:i("checkout.summary.payment.options.financingOptions.modal.accessibility.confirm"),closeMessage:i("checkout.summary.payment.options.financingOptions.modal.accessibility.close",{title:c}),options:n.map(E=>({value:E.retailerFinancingProviderId,label:E.name,promotionText:E.promotion?i("checkout.summary.payment.method.promotion.available"):void 0})),enableAriaLabel:a,blockModalOpening:r,error:!e&&o?g:"","data-test":"financing-providers-select",required:!0,children:n.map(({retailerFinancingProviderId:E,name:y})=>s.jsx("option",{value:E,children:y},E))})})},RPt=({isFinancingProviderNotSelectedError:e,enableAriaLabel:t=!0})=>{const{formatMessage:n}=L(),o=F(),r=f(eu),a=f(FN),i=f(sN),l=f(y5),c=f(D("pbpm")),d=f(npe),u=sse(),p=u.length===1&&u[0]?.type===at.CARD_INSTALMENTS,g=c&&r&&p,E={retailerFinancingPlanId:J3,displayName:n("checkout.summary.payment.options.financingOptions.lumpSum.label")},y=a?.financingPlans?.displayLumpSum;let I=a?.financingPlans?.options;const S=a?.financingProviders||[],C=P=>y?E.retailerFinancingPlanId:I?.find(N=>N?.financingProviders?.indexOf(P)!==-1)?.retailerFinancingPlanId;ae.useEffect(()=>{if(c&&d){const P=S.find(k=>k.financingProviderId===d);if(!P)return;const N=C(P.retailerFinancingProviderId);o(Gt.setFinancingProviders({retailerFinancingProviderId:P.retailerFinancingProviderId,financingProviderId:d})),o(Gt.setFinancingOption(N))}else if(S.length===1){const P=S[0]?.retailerFinancingProviderId,N=S[0]?.financingProviderId;if(!P)return;if(o(Gt.setFinancingProviders({retailerFinancingProviderId:P,financingProviderId:N})),c&&(!d||d!==N)){if(d&&d!==N&&Ue.api.pushError(new hPt("Saved financing provider id is not available on providers list")),!a?.paymentMethodGroupId){Z.error("toast.notification.generic.error"),Ue.api.pushError(new L0("Can't preselect financing provider. Missing instalments method group id"));return}o(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:a.paymentMethodGroupId,financingProviderId:N}}))}const k=C(P);o(Gt.setFinancingOption(k))}},[S,d,a]),ae.useEffect(()=>{const P=I?.find(N=>N.retailerFinancingPlanId===l);if(l&&!P&&i){const N=C(i);o(Gt.setFinancingOption(N))}},[I?.length,i]),y&&I&&(I=[E,...I]);const T=P=>{if(g)return;const N=P.target.value,k=C(N),M=S.find(w=>w.retailerFinancingProviderId===N)?.financingProviderId;if(c){if(!a?.paymentMethodGroupId){Z.error("toast.notification.generic.error"),Ue.api.pushError(new L0("Can't  change financing provider. Missing instalments method group id"));return}o(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:a.paymentMethodGroupId,financingProviderId:M}}))}o(Gt.setFinancingProviders({retailerFinancingProviderId:N,financingProviderId:M})),o(Gt.setFinancingOption(k))},_=P=>{const{value:N}=P.target;o(Gt.setFinancingOption(N))},A=ae.useMemo(()=>I?.filter(P=>P.retailerFinancingPlanId===E.retailerFinancingPlanId?!0:P?.financingProviders?.indexOf(i)!==-1)||[],[i,I]),R=S.find(P=>P.retailerFinancingProviderId===i)?.name;return s.jsxs("div",{"data-test":"financing-option-content",children:[s.jsx(jS,{message:"checkout.summary.payment.options.financingOptions.info"}),S?.length>1&&s.jsx(APt,{value:i,onChange:T,options:S,isFinancingProviderNotSelectedError:e,enableAriaLabel:t,blocked:g}),A.length>0&&l&&s.jsx(xPt,{value:l,activeProvider:R,onChange:_,options:A,enableAriaLabel:t},i+l),l&&s.jsx(fPt,{activePlan:l,financingPlans:A})]})},k0=()=>{const e=L(),t=f(D(Q3)),n=e.formatMessage("checkout.summary.payment.options.payNow.viewAllPaymentMethods.link"),o=!!n.trim();return s.jsxs("div",{"data-test":"pay-now-content",children:[o&&s.jsx(tt,{target:"_blank",href:n,children:s.jsx(b,{id:"checkout.summary.payment.options.payNow.viewAllPaymentMethods.link.text"})}),s.jsx(jS,{message:"checkout.summary.payment.options.payNow.info"}),t&&s.jsx(Tj,{className:"salt-m-y--2",dataTestId:"cards-option-save-details-box"})]})},DPt=({paymentOption:e,isFinancingProviderNotSelectedError:t})=>{switch(e){case dt.PAY_NOW:return s.jsx(k0,{});case dt.INSTALMENTS:return s.jsx(RPt,{isFinancingProviderNotSelectedError:t});case dt.CASH_ON_DELIVERY:return s.jsx("div",{"data-test":"cash-on-delivery-content",children:s.jsx(jS,{message:"checkout.summary.payment.options.payAtDelivery.info"})});case dt.B2B_DEFERRED_PAYMENT:return s.jsx("div",{"data-test":"b2b-deferred-content",children:s.jsx(jS,{message:"checkout.summary.payment.options.invoice.info"})});case dt.KAKAOPAY:case dt.L_PAY:case dt.NAVERPAY:return null;default:return s.jsx(k0,{})}},OPt=v.fieldset`
    border: none;
    padding: 0;
    margin: 0;
    min-inline-size: inherit;
    white-space: normal;
    overflow-wrap: anywhere;
`,PPt=({options:e,testId:t,isFinancingProviderNotSelectedError:n,overridePaymentMethodGroups:o})=>{const{formatMessage:r}=L(),a=F(),{paymentOption:i,paymentType:l}=f(Im),c=f(nN),d=`${i}:${l}`,u=f(D("pbpm")),p=f(GR),E=f(FN)?.financingProviders||[];h.useEffect(()=>{if(!p&&o&&u){Ue.api.pushLog([`PBPM no payment group form basket ${p}`],{level:Si.DEBUG});const I=o?.find(S=>S.available&&S.name!==dt.LOYALTY);if(!I?.paymentMethodGroupId){Z.error("toast.notification.generic.error"),Ue.api.pushLog(["PBPM paymentMethodGroupId unavailable"],{level:Si.ERROR});return}I.name!==dt.INSTALMENTS?(a(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:I.paymentMethodGroupId}})).catch(()=>Z.error("toast.notification.generic.error")),Ue.api.pushLog([`PBPM update checkout cart paymentMethodGroupId: ${I.paymentMethodGroupId}`],{level:Si.DEBUG})):I.name===dt.INSTALMENTS&&E.length===1&&(a(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:I.paymentMethodGroupId,financingProviderId:E[0]?.financingProviderId}})).catch(()=>Z.error("toast.notification.generic.error")),Ue.api.pushLog([`PBPM update checkout cart instalments and only one available financingProviderId: ${I.paymentMethodGroupId}, financingProviderId: ${E[0]?.financingProviderId}`],{level:Si.DEBUG}))}},[]);const y=async I=>{const[S,C]=I.target.value.split(":");if(u){const T=o?.find(_=>_.name===S)?.paymentMethodGroupId;if(T&&S!==dt.INSTALMENTS)try{await a(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:T}}))}catch{Z.error("toast.notification.generic.error");return}else if(T&&S===dt.INSTALMENTS&&c)try{await a(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:T,financingProviderId:c}}))}catch{Z.error("toast.notification.generic.error");return}a(Bd())}a(Gt.setPaymentOptionAndType({paymentOption:S,paymentType:C}))};return s.jsxs(OPt,{"data-test":t,children:[s.jsx(ie,{asChild:!0,children:s.jsx("legend",{children:s.jsx(ee,{as:"h3",children:r("checkout.summary.payment.options.accessibility.invisible.subtitle")})})}),e.map(I=>{const{id:S,title:C,ariaLabel:T,icons:_,type:A,promotion:R}=I,P=l?`${S}:${A}`:S;return s.jsx(mPt,{label:C,onChange:y,checked:P===d,ariaLabel:T,icons:_,value:P,promotion:R,children:s.jsx(DPt,{paymentOption:S,isFinancingProviderNotSelectedError:n})},C)})]})},NPt=({type:e=null,option:t=dt.PAY_NOW})=>{const n=F(),{paymentOption:o,paymentType:r}=f(Im);h.useEffect(()=>{(!r||e&&e!==r||t!==o)&&n(Gt.setPaymentOptionAndType({paymentOption:t,paymentType:e}))},[e,t])},LPt=v.div`
    display: flex;
    align-items: center;
    column-gap: var(--salt-spacing-1);
    padding-inline-start: 0;
`,kPt=v.div`
    padding-block: var(--salt-spacing-1) 0;
    padding-inline: var(--salt-spacing-8) 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    column-gap: var(--salt-spacing-1);
`,Bb=()=>s.jsxs(Q,{className:"salt-m-b--4",direction:"column",children:[s.jsxs(LPt,{children:[s.jsx(_e.Icon,{size:"l"}),s.jsx(_e.Typography,{className:"salt-m--2",fill:50})]}),s.jsx(kPt,{children:s.jsx(_e,{height:"20px",width:"36px"})})]}),jPt=()=>s.jsxs("div",{children:[s.jsx(Bb,{}),s.jsx(Bb,{}),s.jsx(Bb,{})]}),MPt=({usesOverridePaymentMethodGroups:e,overridePaymentMethodGroups:t,isFinancingProviderNotSelectedError:n})=>{const{formatMessage:o}=L(),r=F(),a=f(kR)?.amount,i=f(D("pbpm")),l=f(GR),c=f(LJe),d=f(nN),u=f(RJe)||[],p=f(HE);h.useEffect(()=>{r(xI.fetchActivePaymentMethodGroups())},[]),h.useEffect(()=>{i&&p?.length&&p.length>0&&r(xI.fetchPaymentMethodGroupPromotions())},[p?.length,i,r]),h.useEffect(()=>{a&&!c&&(!e||t)&&r(xI.fetchPaymentMethodGroupsMetadata())},[t,a,e,r]);const g=A=>!!A&&"displayable"in A,E=h.useMemo(()=>{if(i&&l)return t?.find(A=>A?.paymentMethodGroupId===l)},[i,l,t]),y=()=>{const A=t?.find(R=>R.available&&R.name!==dt.LOYALTY);return i&&l&&t&&g(A)?E?.name===dt.LOYALTY?(A.paymentMethodGroupId&&r(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:A.paymentMethodGroupId,financingProviderId:A.name===dt.INSTALMENTS?d:void 0}})),Ue.api.pushLog([`PBPM basketPaymentMethodGroupId: ${l}, preselectedPaymentMethod: ${A.name}`],{level:Si.DEBUG}),A.name||p?.[0]?.name||dt.PAY_NOW):(E||(Z.error("toast.notification.generic.error"),Ue.api.pushLog(["PBPM no memoizedPaymentMethodGroupFromBasket"],{level:Si.DEBUG})),E?.name||A?.name||p?.[0]?.name||dt.PAY_NOW):A?A.name:p?.[0]?.name||dt.PAY_NOW},I=()=>{const A=y();return p?.find(R=>R.name===A)?.type};NPt({option:y(),type:I()});const S=sse(),C="payment-selector",T=o("checkout.summary.payment.options.payAtDelivery.limitation.warning"),_=u.includes(dt.CASH_ON_DELIVERY);return s.jsxs(h.Fragment,{children:[_&&T.trim()&&s.jsx(Te,{intent:"info",className:"salt-m-t--2 salt-m-b--2",size:"s",text:T}),p?s.jsx(PPt,{options:S,testId:C,isFinancingProviderNotSelectedError:n,overridePaymentMethodGroups:t}):s.jsx(jPt,{})]})},wPt=()=>{const e=F(),t=sj(),n=f(D(X3)),o=f(D(Z3)),r=f(D(Aqe)),a=f(D("pcs.v2")),i=f(D("oed")),l=f(D("loy.waon")),c=f(Nxt),d=f(ute);h.useEffect(()=>{!n&&!r&&(t?c?e(Gt.setPaymentOptionAndType({paymentOption:c.name,paymentType:c.applicableType})):!a&&i&&l&&Number(d?.checkoutPayment.amountPaidByCustomer)===0&&Number(d?.checkoutPayment.amountToBeCharged)===0&&d?.loyaltyPaymentMethod?e(Gt.setPaymentOptionAndType({paymentOption:d.loyaltyPaymentMethod.group,paymentType:d.loyaltyPaymentMethod.type})):e(Gt.setPaymentOptionAndType({paymentOption:dt.PAY_NOW,paymentType:at.UNKNOWN})):o||e(Gt.setPaymentOptionAndType({paymentOption:dt.PAY_NOW,paymentType:at.UNKNOWN})))},[e,n,o,t,r,c])},FPt=D("pay.nsc"),BPt=D("pay.ew"),UPt=D("rec.o"),GPt=D("pb.pc"),$Pt=D("pay.nsd"),HPt=D("pay.ywlt"),VPt=D("loy.waon"),WPt=D("pcs.v2"),YPt=({intl:e,actions:t,isNonSavedCardPaymentEnabled:n,isPaymentBufferNoticeInPaymentSectionEnabled:o,isCheckoutSummaryInvoiceModalOpen:r,isRecurringOrdersEnabled:a,paymentSectionRef:i,shouldShowExternalWalletPaymentSelector:l,isSelectedRecurringShoppingDefinitionFrequencyDefined:c,setSelectedPaymentMethodExternalWallet:d,setSelectedWalletItem:u,isNonSavedDialogEnabled:p,isYourWalletEnabled:g,isLoyaltyPaymentEnabled:E,totalBufferRate:y,isFinancingProviderNotSelectedError:I,isPaymentCheckoutSummaryV2Enabled:S})=>{const C=F(),T=Ij(),_=f(D(Z3)),A=f(zv),R=Ou(),P=Ate(),N=f(kE),k=f(xn),M=JSON.stringify(f(Rue)||[]),w=f(kR),j=JSON.stringify(f(mV)||[]),G=f(D("pbpm")),W=f(GR),H=f(xue),K=f(pte),X=T&&!_,q=l&&!_,ne={paymentTitle:e.formatMessage("checkout.summary.payment.method.title"),loyaltyPaymentInfo:e.formatMessage("checkout.summary.payment.loyalty.additional.payment.required")},ue=()=>{t.analyticsEvent({type:Le.RECURRING_SHOPPING_DEFINITION_FREQUENCY_SELECTED,data:{recurringFrequency:er}}),t.analyticsEvent({type:Le.RECURRING_SHOPPING_DEFINITION_LABEL_WRITTEN,data:{recurringFrequencyName:""}})},oe=km({getQuantity:bl});h.useEffect(()=>{S&&!K?C(sr.withOverridePaymentMethodGroups(sr.getOrderPaymentCheckoutSummaryWithPaymentMethodGroups)):R&&C(sr.getOverridePaymentMethodGroups(k))},[R,C,N,k,M,w,j]),cAt();const ye=sj(),{hideLoyaltyPaymentButton:he,disableLoyaltyPaymentButton:Ie}=Rte();h.useEffect(()=>{if(ye&&G&&E&&!K&&!H){const be=P?.find(ce=>ce.name===dt.LOYALTY);be?.paymentMethodGroupId&&be?.paymentMethodGroupId!==W&&C(Yt.updateCheckoutCart({paymentMethodGroup:{paymentMethodGroupId:be.paymentMethodGroupId}})),C(Gt.setPaymentOptionAndType({paymentOption:be?.name,paymentType:be?.applicableType}))}},[ye,G,C,P,W,E]);const Fe=()=>{t.analyticsEvent({type:Le.LOYALTY_POINTS_BUTTON_CLICKED,payload:{pageEventAttributes:{type:"loyaltyPayment",action:Number(oe)?"edit":"apply"}}}),Ie?Z.warning("payment.promotion.loyalty.add.restriction.notification"):t.openLoyaltyRedeemModal()};return wPt(),s.jsxs(xe,{tabIndex:0,"aria-describedby":"payment-notification-a11y",ref:i,children:[s.jsx("div",{className:"salt-m-b--2",children:s.jsx(ee,{as:"h2",children:ne.paymentTitle})}),_&&!g&&!ye&&s.jsx(MPt,{usesOverridePaymentMethodGroups:R,overridePaymentMethodGroups:P,isFinancingProviderNotSelectedError:I}),s.jsx("div",{className:"salt-m-b--4",children:y&&o?s.jsx(h.Fragment,{children:s.jsx("div",{className:"salt-m-b--4",children:s.jsx(yOt,{analyticsEvent:t.analyticsEvent,bufferRate:y,action:t.openPaymentBufferModal})})}):s.jsx(b,{id:"checkout.summary.payment.method.message"})}),q&&s.jsxs(h.Fragment,{children:[s.jsx(IOt,{onSelectPaymentMethod:d,isSelectedRecurringShoppingDefinitionFrequencyDefined:c,isCheckoutSummaryInvoiceModalOpen:r}),a&&s.jsx(TOt,{resetRecurringShoppingForm:ue})]}),g&&s.jsx(bf,{isSelectedRecurringShoppingDefinitionFrequencyDefined:c,isOverridePaymentMethodGroupsEnabled:R,supportNonSavedPayment:n,onSelectPaymentMethod:u,overridePaymentMethodGroups:P}),X&&s.jsx(Tj,{}),p&&s.jsx(LOt,{}),E&&A&&!he&&s.jsxs("div",{children:[s.jsx(Ts,{}),ne.loyaltyPaymentInfo&&s.jsx("div",{className:"salt-m-t--4",children:s.jsx(Te,{intent:"info","data-test":"loyalty-payment-info",text:ne.loyaltyPaymentInfo,showIcon:!1})}),s.jsx("div",{className:"salt-m-t--4",children:!!oe&&s.jsx(Be,{inline:!1,children:s.jsx(tse,{loyaltyInBasket:oe,removeLoyaltyUnitsFromBasket:t.removeLoyaltyUnitsFromBasket})})}),s.jsx("div",{className:"salt-m-t--4",children:s.jsxs(x,{intent:"secondary",fill:!0,"data-test":"loyalty-payment-add",onClick:Fe,loading:H,children:[s.jsx(x.Icon,{name:"loyalty"}),s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.discounts.loyalty"})})]})}),s.jsx(ese,{})]})]})},qPt=e=>({isNonSavedCardPaymentEnabled:FPt(e),externalWalletManagement:BPt(e),isPaymentBufferNoticeInPaymentSectionEnabled:GPt(e),isCheckoutSummaryInvoiceModalOpen:$e("checkoutSummaryInvoice")(e),isRecurringOrdersEnabled:UPt(e),isNonSavedDialogEnabled:$Pt(e),isYourWalletEnabled:HPt(e),isLoyaltyPaymentEnabled:VPt(e),totalBufferRate:Xk(e),isPaymentCheckoutSummaryV2Enabled:WPt(e)}),KPt=e=>({actions:vl({analyticsEvent:U.analyticsEvent,getWalletItems:Km.getWalletItems,openCheckoutSummaryInvoiceModal:()=>J.openModal("checkoutSummaryInvoice"),openPaymentBufferModal:()=>J.openModal("paymentBuffer",!1),openLoyaltyRedeemModal:()=>J.openModal("redeemLoyalty"),removeLoyaltyUnitsFromBasket:Pg.removeLoyaltyUnitsFromBasket,performanceMark:ds},e)}),zPt=Tt(Ht,we(qPt,KPt))(YPt),xj=({getQuantity:e})=>s.jsxs(xe,{"data-test":"loyalty-earnings",children:[s.jsx(ee,{className:"salt-m-b--4",as:"h2",children:s.jsx(b,{id:"checkout.complete.loyalty.title"})}),s.jsx(xu,{getQuantity:e})]}),QPt=se("GET_VOUCHERS_MARKETING_PREFERENCES"),XPt=()=>({type:"API",payload:{service:"marketingpreferences",pathPrefix:{client:"/api/marketing-preferences",server:"/core-api"},options:{method:"GET"},url:"/v1/preferences/groups/voucher/customers/current",...QPt}}),ZPt={getMarketingPreferences:XPt},JPt=({isConsentChecked:e,setConsentCheckbox:t,name:n})=>{const o=L(),[r]=Ee(["nfchk"]),a={title:o.formatMessage("marketing.optin.vouchers.title"),description:o.formatMessage("marketing.optin.vouchers.description")},i=()=>{t(l=>!l)};return e==null?null:s.jsx(ae.Fragment,{children:r?s.jsx(fs.Checkbox,{label:a.title,additionalText:a.description,name:n,value:a.title,className:"salt-m-b--4"}):s.jsx(Lo,{bold:!0,input:{checked:e,onChange:i},label:s.jsx(O,{bold:!0,size:"l",children:a.title}),children:s.jsx(O,{size:"l",children:a.description})})})},eNt=()=>{const e=L(),t=F(),n=h.useRef(null),[o,r]=h.useState(null),[a,i]=h.useState(void 0),[l,c]=h.useState(""),[d,u,p]=Ee(["m.la.h","mktg.vou","nfchk"]),[g,E]=h.useState(!1),y=f(HJe),I=f(VJe),S=f(ope),C=f($e("addVoucher")),T={addVoucherModalTitle:e.formatMessage("voucher.modal.title"),voucherPlaceholder:e.formatMessage("voucher.modal.voucher.placeholder"),voucherInputLabel:e.formatMessage("voucher.modal.voucher.input.label"),clearButtonLabel:e.formatMessage("salt.form.text-field.clear-button.a11y.label"),addVoucherModalSubmitButton:e.formatMessage("voucher.modal.submit.button.text"),addVoucherModalSubmitButtonAriaLabel:e.formatMessage("voucher.modal.submit.button.text.description"),saveMarketingPreferences:e.formatMessage("marketing.optin.vouchers.button.title")},_=M=>{r(M.target.value),i(void 0)},A=h.useCallback(()=>{if(o)t(NS.addVoucherToBasket(o.trim(),e,y?void 0:g)).then(M=>{i(M)});else{const M=e.formatMessage("vouchers.validation.failure.no.code.entered");i(M)}},[o,t,e,g,y]),R=M=>{M.key==="Enter"&&o&&A()},P=()=>{p&&(n.current?.reset(),c("")),p||(r(null),i(void 0)),t(J.closeModal())},N="add-voucher-modal-header",k=M=>{if(!p)return;M.preventDefault();const w=M.currentTarget,j=new FormData(w),G=j.get("voucherId")?.toString(),W=j.get("marketingPreferencesCheckbox");if(G)t(NS.addVoucherToBasket(G.trim(),e,y?void 0:!!W)).then(H=>{c(H)});else{const H=e.formatMessage("vouchers.validation.failure.no.code.entered");c(H)}};return s.jsx(B,{isOpen:C,onRequestClose:P,aria:{labelledby:N},isLoading:I||S,children:s.jsxs(fs,{ref:n,onSubmit:k,children:[s.jsx(B.Header,{align:d?"left":"center",children:s.jsx(ee,{as:"h2",id:N,"data-test":N,children:T.addVoucherModalTitle})}),s.jsx(B.Body,{className:"salt-p-b--2",children:p?s.jsx(fs.TextField,{name:"voucherId",errorMessage:l,"data-test":"voucher-input-field",placeholder:T.voucherPlaceholder,label:{text:T.voucherInputLabel},clearButton:{ariaLabel:T.clearButtonLabel}}):s.jsx(Wo,{type:"text","data-test":"voucher-input-field",label:T.voucherInputLabel,placeholder:T.voucherPlaceholder,meta:{invalid:!!a,touched:!0,error:a},input:{onChange:_,onKeyDown:R}})}),s.jsx(B.Footer,{align:"left",className:"salt-p-t--4",children:s.jsxs(Q,{direction:"column",basis:"100%",children:[!y&&u&&s.jsx(JPt,{isConsentChecked:g,setConsentCheckbox:E,name:"marketingPreferencesCheckbox"}),s.jsx(x,{fill:!0,type:p?"submit":"button",onClick:p?void 0:A,intent:"primary",className:"salt-m-t--4","data-test":"voucher-submit-button","aria-label":T.addVoucherModalSubmitButtonAriaLabel,children:s.jsx(x.Text,{children:u?T.saveMarketingPreferences:T.addVoucherModalSubmitButton})})]})})]})})},nse=m.shape({paymentCheckAmount:ze.isRequired,expiryDate:m.string.isRequired,paymentCheckId:m.string.isRequired,increaseInTotalRequiredBeforeCheckIsAvailable:ze}),ose=m.shape({paymentCheckAmount:ze.isRequired,expiryDate:m.string.isRequired,paymentCheckId:m.string.isRequired,increaseInTotalRequiredBeforeCheckIsAvailable:ze.isRequired}),tNt=(e={})=>(t,n)=>{const o="FAILURE",r="SUCCESS",a=d=>t(U.analyticsEvent({type:Re.REDEEM_PAYMENT_CHECK_BUTTON_CLICKED,pageEventAttributes:{status:d,...e.maxRedeemAmount&&{maxRedeemAmount:e.maxRedeemAmount},...e.minRedeemAmount&&{minRedeemAmount:e.minRedeemAmount},paymentCheckId:e.paymentCheckId,paymentCheckAmount:e.paymentCheckAmount&&e.paymentCheckAmount.amount,paymentCheckCurrency:e.paymentCheckAmount&&e.paymentCheckAmount.currency},description:"User clicked on the redeem payment check button"})),i=d=>t(U.analyticsEvent({type:Le.TOAST_NOTIFICATION_DISPLAYED,description:"A toast notification was displayed",pageEventAttributes:{status:d}})),l=()=>Promise.all([Promise.resolve(Z.warning("checkout.summary.bonus.check.redeem.error.toast")),i("PAYMENT_CHECK_BELOW_THE_THRESHOLD"),a(o)]),c=()=>Promise.all([a(r),Promise.resolve(Z.success("checkout.summary.bonus.check.redeem.success.toast")),i("PAYMENT_CHECK_APPLIED")]);return t(Yt.getCheckoutBasket({appliedPaymentCheckId:e.paymentCheckId})).then(()=>{const d=bV(n());return d&&d.length>=1?l():FR(n())?c():(Ue.api.pushError(new Error(`Expected payment check with id: ${e.paymentCheckId} to be applied or removed, but didn't appear in either list`)),a(o))}).catch(d=>(a(o),i("PAYMENT_CHECK_NETWORK_ERROR"),Promise.resolve(new Error(d))))},sNt={addPaymentCheckToBasket:tNt},nNt=D("m.la.h"),oNt={basketTotalValue:ze.isRequired,paymentChecks:m.shape({checksMissingRequiredTotal:m.arrayOf(ose)}),formattedMessages:m.shape({paymentCheckDescription:m.func.isRequired,costRequirementToUsePaymentCheck:m.func.isRequired,requirementsNotMetBody:m.func.isRequired,backToCheckoutButton:m.string.isRequired,requirementsNotMetBodyDescription:m.string.isRequired}).isRequired,formatPrice:m.func.isRequired,closeModal:m.func.isRequired,modalLeftAlignEnabled:m.bool},rNt={paymentChecks:[],modalLeftAlignEnabled:!1},Aj=({basketTotalValue:e,paymentChecks:t,formatPrice:n,closeModal:o,formattedMessages:r,modalLeftAlignEnabled:a})=>{const i=l=>{const{paymentCheckId:c,paymentCheckAmount:d,expiryDate:u,increaseInTotalRequiredBeforeCheckIsAvailable:p}=l,g=`missing-requirement-payment-check-${c}`;return s.jsxs(fe.Group,{"data-test":g,children:[s.jsx(fe.Title,{children:r.paymentCheckDescription(n(d),gt(u,NI))}),s.jsx(fe.Description,{children:r.costRequirementToUsePaymentCheck(n(p))})]},c)};return s.jsxs(h.Fragment,{children:[s.jsxs(B.Body,{children:[s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("h2",{children:r.requirementsNotMetBody(n(e))})}),s.jsx(O,{children:r.requirementsNotMetBodyDescription}),s.jsx("div",{className:"salt-m-t--4",children:s.jsx(fe,{children:t.checksMissingRequiredTotal.map(l=>i(l))},"payment-checks-requirements-not-met-list")})]}),s.jsx(B.Footer,{align:a?"left":"center",children:s.jsx(x,{intent:"primary",onClick:()=>o(),"data-test":"add-payment-check-modal-back-to-checkout-button",children:s.jsx(x.Text,{children:r.backToCheckoutButton})})})]})};Aj.propTypes=oNt;Aj.defaultProps=rNt;const aNt=e=>({modalLeftAlignEnabled:nNt(e)}),iNt=we(aNt)(Aj),lNt=D("m.la.h"),cNt={formattedMessages:m.shape({backToCheckoutButton:m.string.isRequired,noChecksAvailableBody:m.string.isRequired}).isRequired,closeModal:m.func.isRequired,modalLeftAlignEnabled:m.bool},dNt={modalLeftAlignEnabled:!1},Rj=({modalLeftAlignEnabled:e,closeModal:t,formattedMessages:n})=>s.jsxs(h.Fragment,{children:[s.jsx(B.Body,{children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h2",{children:n.noChecksAvailableBody})})}),s.jsx(B.Footer,{align:e?"left":"center",children:s.jsx(x,{intent:"primary",onClick:()=>t(),"data-test":"add-payment-check-modal-back-to-checkout-button",children:s.jsx(x.Text,{children:n.backToCheckoutButton})})})]});Rj.propTypes=cNt;Rj.defaultProps=dNt;const uNt=e=>({modalLeftAlignEnabled:lNt(e)}),pNt=we(uNt)(Rj),mNt=D("m.la.h"),hNt=D("nfpay"),gNt={paymentChecks:m.shape({isFetching:m.bool.isRequired,fetchError:m.bool.isRequired,lastUpdated:m.number,availablePaymentChecks:m.arrayOf(nse).isRequired,maxAmountPayableByPaymentCheck:ze}).isRequired,formattedMessages:m.shape({paymentCheckDescription:m.func.isRequired,paymentCheckExpiresOn:m.func.isRequired,selectableChecksMaxRedeemable:m.func.isRequired,selectableCheckRadioButtonSelectNone:m.string.isRequired,selectableChecksMaxRedeemableDescription:m.string.isRequired,selectPaymentChecksRedeemButton:m.string.isRequired}).isRequired,formatPrice:m.func.isRequired,closeModal:m.func.isRequired,redeemSelectedPaymentCheck:m.func.isRequired,modalLeftAlignEnabled:m.bool,isSaltFormEnabledForPayments:m.bool},ENt={modalLeftAlignEnabled:!1,isSaltFormEnabledForPayments:!1};class Dj extends h.Component{constructor(t){super(t),this.handlePaymentCheckSelectedForLegacyForm=this.handlePaymentCheckSelectedForLegacyForm.bind(this),this.redeemCheck=this.redeemCheck.bind(this),this.renderSelectableCheck=this.renderSelectableCheck.bind(this),this.renderSelectNonePaymentCheck=this.renderSelectNonePaymentCheck.bind(this);const n={isNoChecksSelectedOption:!0},o="none";this.state={noPaymentChecksSelectedCheck:n,selectedPaymentCheck:n,selectedValue:o,NONE:o}}handlePaymentCheckSelectedForLegacyForm(t,n){t.preventDefault(),t.stopPropagation(),this.setState({selectedPaymentCheck:n})}handlePaymentCheckSelectedForSaltForm=t=>{const{paymentChecks:n}=this.props,{NONE:o,noPaymentChecksSelectedCheck:r}=this.state;if(t===o){this.setState({selectedValue:o,selectedPaymentCheck:r});return}const a=(n.availablePaymentChecks||[]).find(i=>String(i.paymentCheckId)===String(t))||r;this.setState({selectedValue:String(t),selectedPaymentCheck:a})};redeemCheck(){const{closeModal:t,redeemSelectedPaymentCheck:n,paymentChecks:o}=this.props,{selectedPaymentCheck:r,noPaymentChecksSelectedCheck:a}=this.state,i=d=>d&&d.paymentCheckAmount&&d.paymentCheckAmount.amount||0,l=(d,u)=>i(d)-i(u),c=(d,u)=>i(u)-i(d);if(r!==a){const d=i(o.availablePaymentChecks.slice().sort(c)[0]),u=i(o.availablePaymentChecks.slice().sort(l)[0]);n({...r,minRedeemAmount:u,maxRedeemAmount:d}).then(t)}else t()}renderSelectableCheck(t){const{formattedMessages:n,formatPrice:o}=this.props,{paymentCheckId:r,paymentCheckAmount:a,expiryDate:i}=t,{selectedPaymentCheck:l}=this.state,c=`payment-check-radio-${r}`;return s.jsx(xe,{className:"salt-m-b--2",onClick:d=>this.handlePaymentCheckSelectedForLegacyForm(d,t),children:s.jsx(Ao,{checked:t===l,label:n.paymentCheckDescription(o(a),gt(i,NI)),value:r,"data-test":c,last:!0})},r)}renderSelectNonePaymentCheck(){const{formattedMessages:t}=this.props,{noPaymentChecksSelectedCheck:n,selectedPaymentCheck:o}=this.state,r="payment-check-radio-none-selected";return s.jsx(xe,{children:s.jsx(Ao,{checked:o===n,onClick:a=>this.handlePaymentCheckSelectedForLegacyForm(a,n),label:t.selectableCheckRadioButtonSelectNone,value:r,"data-test":r,last:!0})},r)}render(){const{modalLeftAlignEnabled:t,formattedMessages:n,formatPrice:o,isSaltFormEnabledForPayments:r,paymentChecks:a}=this.props,{selectedValue:i,NONE:l}=this.state,c=(a.availablePaymentChecks||[]).map(d=>({value:String(d.paymentCheckId),label:o(d.paymentCheckAmount),additionalText:n.paymentCheckExpiresOn(gt(d.expiryDate,NI))}));return c.push({value:l,label:n.selectableCheckRadioButtonSelectNone}),s.jsxs(h.Fragment,{children:[s.jsxs(B.Body,{children:[s.jsx(O,{bold:!0,asChild:!0,size:"l",children:s.jsx("h2",{children:n.selectableChecksMaxRedeemable(o(a.maxAmountPayableByPaymentCheck))})}),s.jsx(O,{children:n.selectableChecksMaxRedeemableDescription}),s.jsx("div",{className:"salt-m-t--4",children:r?s.jsx(xe,{children:s.jsx(fs.RadioGroup,{name:"payment-checks",groupLabel:{text:n.addPaymentCheckModalTitle,isVisuallyConcealed:!0},value:i,onChange:this.handlePaymentCheckSelectedForSaltForm,radios:c})}):s.jsxs(s.Fragment,{children:[a.availablePaymentChecks.map(d=>this.renderSelectableCheck(d)),this.renderSelectNonePaymentCheck()]})})]}),s.jsx(B.Footer,{align:t?"left":"center",children:s.jsx(x,{intent:"primary",onClick:()=>this.redeemCheck(),"data-test":"add-payment-check-modal-redeem-button",children:s.jsx(x.Text,{children:n.selectPaymentChecksRedeemButton})})})]})}}Dj.propTypes=gNt;Dj.defaultProps=ENt;const fNt=e=>({modalLeftAlignEnabled:mNt(e),isSaltFormEnabledForPayments:hNt(e)}),yNt=we(fNt)(Dj),INt=D("m.la.h"),SNt={isOpen:m.bool,actions:m.shape({closeModal:m.func.isRequired,fetchAvailablePaymentChecks:m.func.isRequired,fetchBasketWithPaymentCheckSplit:m.func.isRequired,analyticsEvent:m.func.isRequired}).isRequired,modalOptions:m.shape({source:m.string,sourceEventId:m.string}),paymentChecks:m.shape({isFetching:m.bool.isRequired,fetchError:m.bool.isRequired,lastUpdated:m.number,availablePaymentChecks:m.arrayOf(nse).isRequired,checksMissingRequiredTotal:m.arrayOf(ose).isRequired,maxAmountPayableByPaymentCheck:ze}).isRequired,intl:m.objectOf(m.object).isRequired,basketTotalValue:ze,orderId:m.string.isRequired,modalLeftAlignEnabled:m.bool,currencyFormat:m.string},CNt={isOpen:!1,basketTotalValue:null,modalOptions:{},modalLeftAlignEnabled:!1};class Oj extends h.Component{constructor(t){super(t),this.formatPrice=this.formatPrice.bind(this),this.areChecksAvailable=this.areChecksAvailable.bind(this),this.areChecksAvailableButMissingRequiredTotal=this.areChecksAvailableButMissingRequiredTotal.bind(this),this.areNoPaymentChecksAvailable=this.areNoPaymentChecksAvailable.bind(this),this.isAvailabilityLoaded=this.isAvailabilityLoaded.bind(this);const{intl:n}=this.props;this.formattedMessages={addPaymentCheckModalTitle:n.formatMessage("checkout.summary.bonus.check.redeem.modal.title"),backToCheckoutButton:n.formatMessage("checkout.summary.bonus.check.requirement.not.met.modal.close.button.description"),noChecksAvailableBody:n.formatMessage("checkout.summary.bonus.check.no.checks.modal.body"),requirementsNotMetBody:o=>n.formatMessage("checkout.summary.bonus.check.requirement.not.met.modal.body",{basketValue:o}),requirementsNotMetBodyDescription:n.formatMessage("checkout.summary.bonus.check.requirement.not.met.modal.body.description"),costRequirementToUsePaymentCheck:o=>n.formatMessage("checkout.summary.bonus.check.requirement.not.met.modal.check.requirement.description",{cost:o}),selectableChecksMaxRedeemable:o=>n.formatMessage("checkout.summary.bonus.check.redeem.modal.body",{maxPayableByBonusCheck:o}),selectableChecksMaxRedeemableDescription:n.formatMessage("checkout.summary.bonus.check.redeem.modal.body.description"),paymentCheckDescription:(o,r)=>n.formatMessage("checkout.summary.bonus.check.redeem.modal.check.description",{cost:o,date:r}),paymentCheckExpiresOn:o=>n.formatMessage("checkout.summary.bonus.check.redeem.modal.check.expires.on",{date:o}),selectableCheckRadioButtonSelectNone:n.formatMessage("checkout.summary.bonus.check.redeem.modal.check.no.redeem.option"),selectPaymentChecksRedeemButton:n.formatMessage("checkout.summary.bonus.check.redeem.modal.button.text")}}areChecksAvailable(){const{paymentChecks:t}=this.props,{availablePaymentChecks:n}=t;return t&&n&&n.length>=1}areChecksAvailableButMissingRequiredTotal(){const{paymentChecks:t}=this.props,{checksMissingRequiredTotal:n}=t;return t&&!this.areChecksAvailable()&&n&&n.length>=1}areNoPaymentChecksAvailable(){return!this.areChecksAvailable()&&!this.areChecksAvailableButMissingRequiredTotal()}formatPrice(t){return t&&t.amount&&t.currency?ii(this.props.intl.formatNumber,t,this.props.currencyFormat):""}isAvailabilityLoaded(){const{paymentChecks:t}=this.props,{isFetching:n,lastUpdated:o,fetchError:r}=t;return o&&!r&&!n}componentDidUpdate(t){const{actions:n,basketTotalValue:o,isOpen:r,modalOptions:a,orderId:i}=this.props,{source:l,sourceEventId:c}=a;r===!0&&t.isOpen===!1&&(n.analyticsEvent({type:Ot.PAYMENT_CHECK_ADD_MODAL_DISPLAYED,source:l,sourceEventId:c}),i&&o&&n.fetchAvailablePaymentChecks({basketTotal:o,orderId:i}).catch(()=>{Z.error("toast.notification.generic.error"),n.closeModal()}))}render(){const{isOpen:t,paymentChecks:n,basketTotalValue:o,actions:r,modalLeftAlignEnabled:a}=this.props;return s.jsxs(B,{isOpen:t,onRequestClose:r.closeModal,isLoading:!this.isAvailabilityLoaded(),loadingPlaceholder:"spinner",children:[s.jsx(B.Header,{align:a?"left":"center","data-test":"add-payment-check-modal-title",children:s.jsx(ee,{as:"h1",children:this.formattedMessages.addPaymentCheckModalTitle})}),t&&this.isAvailabilityLoaded()&&s.jsxs(h.Fragment,{children:[this.areChecksAvailable()&&s.jsx(yNt,{basketTotalValue:o,formattedMessages:this.formattedMessages,formatPrice:this.formatPrice,closeModal:r.closeModal,paymentChecks:n,redeemSelectedPaymentCheck:r.fetchBasketWithPaymentCheckSplit}),this.areChecksAvailableButMissingRequiredTotal()&&s.jsx(iNt,{paymentChecks:n,basketTotalValue:o,formatPrice:this.formatPrice,formattedMessages:this.formattedMessages,closeModal:r.closeModal}),this.areNoPaymentChecksAvailable()&&s.jsx(pNt,{closeModal:r.closeModal,formattedMessages:this.formattedMessages})]})]})}}Oj.propTypes=SNt;Oj.defaultProps=CNt;const j0="addBonusCheck",vNt=e=>({isOpen:$e(j0)(e),paymentChecks:dJe(e),modalOptions:Yn(j0)(e),customerId:xr(e),modalLeftAlignEnabled:INt(e),currencyFormat:Bi(e)}),TNt=st({closeModal:J.closeModal,fetchAvailablePaymentChecks:ej.fetchAvailablePaymentChecks,fetchBasketWithPaymentCheckSplit:e=>sNt.addPaymentCheckToBasket(e),analyticsEvent:U.analyticsEvent}),_Nt=Tt(Ht,we(vNt,TNt))(Oj),bNt=({openAddVoucherModal:e,openLoyaltyRedeemModal:t,basketTotalValue:n,orderId:o,openAddPaymentCheckModal:r,shouldShowAddVoucherButton:a,shouldShowAddLoyaltyButton:i,shouldShowAddPaymentChecksButton:l,isRecurringOrder:c})=>{const[d,u]=Ee(["tp","tp.new"]),p=L(),g=u&&!d,E=p.formatMessage("checkout.summary.discounts.discount.button")||"Discount code",y=p.formatMessage("checkout.summary.discounts.voucher");return s.jsxs(Q,{justify:"space-between",align:"center",gap:["xs"],wrap:"nowrap",children:[a&&s.jsxs(h.Fragment,{children:[s.jsxs(x,{intent:"secondary",fill:!0,"data-test":"voucher-add",onClick:e,children:[s.jsx(x.Icon,{name:"promotion"}),s.jsx(x.Text,{children:g?E:y})]}),s.jsx(eNt,{})]}),i&&s.jsxs(h.Fragment,{children:[s.jsxs(x,{intent:"secondary",fill:!0,"data-test":"loyalty-add",onClick:t,children:[s.jsx(x.Icon,{name:"loyalty"}),s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.discounts.loyalty"})})]}),s.jsx(ese,{})]}),l&&s.jsxs(h.Fragment,{children:[s.jsxs(x,{intent:"secondary",fill:!0,"data-test":"payment-check-add-button",disabled:!n||!o,onClick:I=>{c?Z.warning("checkout.summary.bonus.check.recurringOrder.warning.toast"):r(I)},children:[s.jsx(x.Icon,{name:"loyalty"}),s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.discounts.bonus.check"})})]}),s.jsx(_Nt,{basketTotalValue:n,orderId:o})]})]})},xNt=()=>(e,t)=>e($V()).then(n=>n&&e(VV(n.payload.responseData.entities))).then(n=>{Sk.getDeliveryStatuses(n,e,t())}),Mi={getPendingOrders:xNt},ANt=()=>{const e=F(),t=L(),[n,o]=Ee(["tp","tp.new"]);h.useEffect(()=>{e(Bd())},[e]);const r=f(vJ),a=f(yk),i=f(DJ),l=o&&!n,c=t.formatMessage("toggleablepromotions.list.title"),d=t.formatMessage("toggleablepromotions.list.discounts.added")||"Discounts added",u=t.formatMessage("toggleablepromotions.list.add.cart")||"Add to cart discount",p=!i&&!a,E=l?p?u:d:c;return r?s.jsxs(gn,{direction:"column",className:"salt-m-t--4",children:[s.jsx(O,{size:"l",asChild:!0,className:`${p?"salt-m-t--0 salt-m-b--2":"salt-m-t--0 salt-m-b--4"}`,children:s.jsx("h3",{children:E})}),s.jsx(PJ,{})]}):null},RNt=({removeVoucherFromBasket:e,vouchers:t=[],loyaltyInBasket:n=null,removeLoyaltyUnitsFromBasket:o,isPaymentCheckApplied:r,isVoucherApplied:a,isLoyaltyApplied:i,isLoyaltyPaymentEnabled:l,appliedPaymentChecksInBasket:c=[],removePaymentChecksFromBasket:d})=>{const u=He(),p=E=>E&&E.amount&&E.currency?u(E):"",g=i&&!l;return s.jsxs(Be,{inline:!1,children:[a&&t.map(E=>E&&s.jsx(Be.Item,{children:s.jsx(kS,{type:"voucher",action:Dd(e.bind(null,{voucherId:E.voucherId,savings:p(E.savings)}),500,{trailing:!1}),children:s.jsx(b,{id:"checkout.summary.discounts.voucher.redeemed.with.savings",values:{voucherName:E.voucherId,savings:p(E.savings)}})})},E.voucherId)),g&&s.jsx(tse,{loyaltyInBasket:n,removeLoyaltyUnitsFromBasket:o}),r&&c.map(E=>E&&s.jsx(Be.Item,{children:s.jsx(kS,{type:"payment-check",action:Dd(d.bind(null,{paymentCheckId:E.paymentCheckId}),500,{trailing:!1}),children:s.jsx(b,{id:"checkout.summary.discounts.bonus.check.redeemed",values:{value:p(E.paymentCheckAmount)}})})},"payment-check"))]})},DNt=e=>{const{vouchers:t,loyaltyInBasket:n,isLoyaltyRegistered:o,isLoyaltyRedeemEnabled:r,isUsePaymentChecksEnabled:a,appliedPaymentChecksInBasket:i,isBasketLoading:l,isLoyaltyLoading:c,removePaymentChecksFromBasket:d,isMultiVoucherEnabled:u,isLoyaltyPaymentEnabled:p,orderId:g}=e,E=L(),y=Nm(Xe),I=f(eN),[S,C]=Ee(["tp","tp.new"]),T=f(Ac),[_,A]=ae.useState(!1),R=F(),P=l||c,N=!!t?.length,k=!N||u,M=r&&!!n,w=r&&o&&!M,j=M||w,G=a&&i&&i.length>=1&&!j,W=a&&!G&&!j,H=k||w||W,K=N||M||G;ae.useEffect(()=>{W&&!l&&R(Mi.getPendingOrders())},[R,W,l]),ae.useEffect(()=>{!!T?.orders?.find(he=>he.orderId===g)?.recurringShoppingDefinition?.definitionId&&A(!0)},[T,g]),i&&i.length>=1&&(!a||j)&&d();const X=C&&!S,q=E.formatMessage("checkout.summary.discounts.new.title")||"Discount Information",ne=E.formatMessage("checkout.summary.discounts.title");return s.jsxs(xe,{"data-test":"discount-box",children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(ee,{as:"h2",children:X?q:ne})}),P&&s.jsx("div",{className:"salt-m-t--8 salt-m-b--4",children:s.jsx(_s,{"data-test":"discount-spinner"})}),!P&&H&&s.jsx(bNt,{...e,shouldShowAddVoucherButton:k,shouldShowAddLoyaltyButton:w,shouldShowAddPaymentChecksButton:W&&!_,isRecurringOrder:I}),!P&&K&&s.jsx("div",{className:H?"salt-m-t--4":"",children:s.jsx(RNt,{...e,isLoyaltyApplied:M,isVoucherApplied:N,isPaymentCheckApplied:G,isLoyaltyPaymentEnabled:p})}),y&&(S||C)&&s.jsx(ANt,{})]})},ONt=Ro(["loyalty","loyred"]),PNt=D("pay.check.use"),NNt=e=>D("mvpca")(e)&&Ze(e,"multiple-vouchers-enabled")==="true",LNt=Ro(["loyalty","loyear"]),kNt=D("loyear.csm"),jNt=D("loy.waon"),MNt=D("mktg.vou"),wNt=({actions:e,isMultiVoucherEnabled:t,isLoyaltyRegistered:n,isLoyaltyFetching:o,isLoyaltyRedeemEnabled:r,basketSummary:a,isUsePaymentChecksEnabled:i,isBasketLoading:l,isLoyaltyEarningEnabled:c,loyaltyEarned:d,isLoyaltyEarningMovedToSummaryEnabled:u,isLoyaltyPaymentEnabled:p,isVouchersMarketingPreferencesEnabled:g})=>{const E=()=>{const S=ct();e.analyticsEvent({type:Le.PAYMENT_CHECK_BUTTON_CLICKED,description:"User clicked on the payment check button",pageEventId:S,pageEventAttributes:{orderId:a.orderId}}),e.openAddPaymentCheckModal({sourceEventId:S,source:"PAYMENT_CHECK_BUTTON_CLICK"})},y=async()=>{if(e.analyticsEvent({type:Le.VOUCHER_BUTTON_CLICKED}),e.openAddVoucherModal(),g)try{await e.getMarketingPreferences()}catch{e.closeModal(),Z.error("toast.notification.generic.error")}},I=km({getQuantity:bl});return s.jsxs(h.Fragment,{children:[!u&&c&&d&&d.units>0&&s.jsx("div",{className:"salt-m-b--4",children:s.jsx(xj,{getQuantity:eE})}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(DNt,{vouchers:a.vouchers,openAddVoucherModal:y,openAddPaymentCheckModal:E,removeVoucherFromBasket:e.removeVoucherFromBasket,loyaltyInBasket:I,openLoyaltyRedeemModal:e.openLoyaltyRedeemModal,isMultiVoucherEnabled:t,isLoyaltyRegistered:n,isLoyaltyRedeemEnabled:r,isUsePaymentChecksEnabled:i,appliedPaymentChecksInBasket:a?.appliedPaymentChecks||[],removePaymentChecksFromBasket:e.removedAppliedPaymentChecksFromBasket,removeLoyaltyUnitsFromBasket:e.removeLoyaltyUnitsFromBasket,basketTotalValue:a?.totals?.finalPrice,orderId:a.orderId,isBasketLoading:l,isLoyaltyLoading:o,isLoyaltyPaymentEnabled:p})})]})},FNt=e=>({isMultiVoucherEnabled:NNt(e),isLoyaltyRegistered:zv(e),isLoyaltyFetching:G3e(e),isLoyaltyRedeemEnabled:ONt(e),isLoyaltyEarningMovedToSummaryEnabled:kNt(e),basketSummary:is(e),isUsePaymentChecksEnabled:PNt(e),isLoyaltyEarningEnabled:LNt(e),loyaltyEarned:eE(e),isLoyaltyPaymentEnabled:jNt(e),isVouchersMarketingPreferencesEnabled:MNt(e)}),BNt=e=>({actions:vl({analyticsEvent:U.analyticsEvent,openAddVoucherModal:()=>J.openModal("addVoucher"),openAddPaymentCheckModal:t=>J.openModal("addBonusCheck",t),openLoyaltyRedeemModal:()=>J.openModal("redeemLoyalty"),removeVoucherFromBasket:NS.removeVoucherFromBasket,removedAppliedPaymentChecksFromBasket:rN.removedAppliedPaymentChecksFromBasket,removeLoyaltyUnitsFromBasket:Pg.removeLoyaltyUnitsFromBasket,getMarketingPreferences:ZPt.getMarketingPreferences,closeModal:J.closeModal},e)}),UNt=Tt(Ht,we(FNt,BNt))(wNt),GNt=Wn(["sumsub","bt.spl"]),$Nt=D("cs.ps"),M0=({quantity:e,isLoyaltyRedeemEnabled:t,isLoyaltyPaymentEnabled:n,isUsePaymentChecksEnabled:o,getLoyaltySpent:r,totalsGroup:a,withTaxNote:i=!1,shouldRenderSeparator:l=!0,orderId:c})=>{const d=f(w=>GNt(w)),u=f(w=>$Nt(w)),p=f(w=>Zue(w)),g=u?"always":"auto",E=a.totals?.itemPriceAfterPromos,y=a.totals?.display?.finalPrice,I=a.totals?.paymentSplit?.paidByLoyalty,S=a.totals?.paymentSplit?.remainingPayment,C=a.totals?.savingsPrice,T=a.totals?.paymentMethodSavingsPrice,_=f(D("prp")),A=f(D("oed")),R=f(D("sib")),P=f(w=>Ze(w,"seller-sales-enabled")==="true"),N=!!Number(C?.amount),k=!P||!!a.delivery||!!a?.deliveryPromotions?.length,M=!!Number(I?.amount)||!!Number(S?.amount);return s.jsxs(h.Fragment,{children:[s.jsxs(fe,{children:[e?s.jsx(le.Items,{itemsRetailPrice:a.totals?.itemsRetailPrice,quantity:e,withTaxNote:i}):null,s.jsx(le.Savings,{savings:C}),R&&N&&_&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:T}),d&&!P&&N&&!!E&&E?.amount!==a.totals?.finalPrice?.amount&&s.jsx(le.Subtotal,{value:E,withTaxNote:i}),s.jsx(le.Promotions,{orderLevelPromotions:a.orderLevelPromotions}),s.jsx(le.Vouchers,{appliedVouchers:a.vouchers,vouchersSavingsPrice:a.totals?.vouchersSavingsPrice}),s.jsx(le.Delivery,{delivery:a.delivery,withTaxNote:i,signDisplay:g}),k&&s.jsx(le.DeliveryPromotions,{deliveryPromotions:a?.deliveryPromotions,hideDeliveryPassInfo:!0}),s.jsx(le.BagCharge,{carrierBag:a.carrierBag,withTaxNote:i,signDisplay:g}),s.jsx(le.PreparationCost,{preparationCost:a.preparation,withTaxNote:i,signDisplay:g}),s.jsx(le.Loyalty,{isLoyaltyRedeemEnabled:t,getLoyaltySpent:r}),s.jsx(le.Deposit,{depositsPrice:a.totals?.depositsPrice,withTaxNote:i,signDisplay:g}),s.jsx(le.EnvironmentalHandlingCharge,{environmentalHandlingPrice:a.totals?.environmentalHandlingPrice,withTaxNote:i,signDisplay:g}),s.jsx(le.Invoice,{invoice:a.invoice,withTaxNote:i,signDisplay:g}),s.jsx(le.SmallOrderCharge,{smallOrderPrice:a.smallOrder,orderId:c,thresholds:a.smallOrderChargeThresholds,withTaxNote:i,signDisplay:g,page:"checkout-summary",withIcon:!0})]}),a.totals?.taxesTotals&&s.jsx(le.Taxes,{"data-test":"summary-taxes",finalPrice:a.totals?.finalPrice,components:a.totals?.taxesTotals?.taxes?.components,withTaxNote:i}),o&&I&&S&&M&&s.jsxs(h.Fragment,{children:[s.jsx(le.Separator,{}),s.jsx(fe,{"data-test":"summary-payment-list",children:s.jsx(le.PaymentChecks,{"data-test":"summary-payment-checks",remainingBalance:S,paidByCheck:I})})]}),n&&!A&&y&&I&&s.jsx(le.PaymentLoyalty,{subtotalPrice:y,paidByLoyalty:I}),l&&s.jsx(le.Separator,{}),p&&P&&s.jsx(fe,{"data-test":"summary-seller-total",children:s.jsx(le.Subtotal,{value:y,label:"summary.total",withTaxNote:i})})]})},HNt=Ro(["loyalty","loyred"]),VNt=D("loy.waon"),WNt=Ro(["loyalty","loyear"]),YNt=D("loyear.csm"),qNt=D("pay.check.use"),KNt=D("tx.nts"),zNt=e=>{const{basketSummary:t,quantity:n,expanded:o,loadedViewPortSize:r,formattedMessages:a,isBasketLoading:i,isTermsAndConditionsCheckboxAcknowledged:l,isLoyaltyRedeemEnabled:c,isLoyaltyPaymentEnabled:d,isLoyaltyEarningEnabled:u,isLoyaltyEarningMovedToSummaryEnabled:p,isUsePaymentChecksEnabled:g,isTaxNoteEnabled:E,getLoyaltySpent:y,toggleCollapsibleSummaryBoxState:I}=e,S=f(D("oed")),C=He(),T=f(R=>Ze(R,"seller-sales-enabled")==="true");if(!t||!r)return s.jsxs(Kt,{breakpoint:"sm-up",children:[s.jsx(js,{children:s.jsx(js.Skeleton,{})}),s.jsx(le.Buttons,{loading:i})]});const _=d&&!S?t?.totals?.paymentSplit?.remainingPayment:t?.totals?.display?.finalPrice;return s.jsxs(cs,{expanded:o,onToggle:I,breakpoint:"md-up",sticky:!0,aria:{contentLabel:a.summaryTitle,totalPrice:_&&C(_)},reverseToggleBreakpoint:"md-up",children:[s.jsxs(cs.ControlSection,{children:[o?s.jsx(ee,{as:"span",children:a.summaryTitle}):s.jsxs(Q,{as:"span",direction:"column",gap:["xs"],children:[s.jsx(le.TotalInline,{loading:i,totalPrice:_,withTaxNote:E}),s.jsx(FA,{isExpanded:o})]}),s.jsx(cs.ToggleSwitch,{})]}),s.jsxs(cs.Content,{children:[T&&t.totalsGroups?.length?t.totalsGroups.map(R=>{if(!Number(R.totals?.display?.finalPrice?.amount)&&t.items.length===0)return null;const{groupName:P}=R;return s.jsxs(h.Fragment,{children:[s.jsx(tl,{groupName:P,className:"salt-d--block salt-m-y--2"}),s.jsx(M0,{getLoyaltySpent:_V(P),quantity:kT(t.itemGroups,P,t.items),isLoyaltyRedeemEnabled:c,isLoyaltyPaymentEnabled:d,isUsePaymentChecksEnabled:g,withTaxNote:E,totalsGroup:{...R},shouldRenderSeparator:!1,orderId:t.orderId})]},P)}):s.jsx(M0,{getLoyaltySpent:y,quantity:n,isLoyaltyRedeemEnabled:c,isLoyaltyPaymentEnabled:d,isUsePaymentChecksEnabled:g,withTaxNote:E,totalsGroup:t,orderId:t.orderId}),s.jsx(le.TotalSpaceBetween,{loading:i,totalPrice:_,withTaxNote:E}),s.jsx(FA,{isExpanded:o})]}),s.jsxs("div",{children:[u&&p&&s.jsx("div",{className:"salt-p-t--2","data-test":"loyalty-earnings-summary",children:s.jsx(xu,{getQuantity:eE,allowZero:!0})}),s.jsx(le.Buttons,{loading:i,children:s.jsx(Yte,{isTermsAndConditionsAcknowledged:l,className:"salt-m-t--4",...e})})]})]})},QNt=e=>({basketSummary:is(e),quantity:$p(e),isLoyaltyRedeemEnabled:HNt(e),isLoyaltyPaymentEnabled:VNt(e),isLoyaltyEarningEnabled:WNt(e),isLoyaltyEarningMovedToSummaryEnabled:YNt(e),getLoyaltySpent:bl,isUsePaymentChecksEnabled:qNt(e),isTaxNoteEnabled:KNt(e)}),XNt=Tt(Ht,we(QNt))(zNt),ZNt=D("mtz"),xf=({dateIsoFrom:e,dateIsoTo:t,timeZoneId:n,timeFormat:o,local:r=!1})=>{const a=f(Xd)||"",i=f(ZNt),l=f(Rt);if(!i)return s.jsx(ae.Fragment,{children:Vg(e,t,o)});if(l)return null;const{displayTimeZoneId:c,showTimeZoneAbbreviation:d}=kv(n,a,r);return s.jsx(ae.Fragment,{children:LH(e,t,c,o,d)})},JNt=D("mtz"),jg=({dateIso:e,timeZoneId:t,dateFormat:n,local:o=!1})=>{const r=f(Xd)||"",a=f(JNt),i=f(Rt);if(!a)return s.jsx(ae.Fragment,{children:qs(n,e)});if(i)return null;const{displayTimeZoneId:l,showTimeZoneAbbreviation:c}=A2e(t,r,o);return s.jsx(ae.Fragment,{children:$o(e,l,n,c)})},a_=e=>{const t=F(),[n,o]=h.useState(!0);return h.useEffect(()=>{(async()=>{try{await t(e)}catch{Z.error("toast.notification.generic.error")}o(!1)})()},[]),n},rse=e=>e.data.recurringOrdersSignUp.eligibility.data,ase=e=>e.data.recurringOrdersSignUp.frequency.data,Pj=e=>e.data.recurringOrdersSignUp.slots.data,ise=()=>{const e=f(ase),t=a_(xo.getDeliveryFrequency());return[e,t]},w0=v.div`
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
`,eLt=({sendAnalyticsForFrequencySelected:e,sendAnalyticsForLabelWritten:t})=>{const n=L(),[o]=Ee(["nfchk"]),r=Dn({mode:"onChange",reValidateMode:"onChange"}),a=f(jE),i=f(i5),[l]=ise(),c=u=>{if(!u?.frequencies?.length)return[];const p=u.frequencies.map(E=>({id:`${E.unit}_${E.value}`,value:n.formatMessage(`orders.list.recurring.order.frequency.every.${E.value}.${E.unit.toLowerCase()}`)}));return[{id:er,value:n.formatMessage("checkout.summary.recurring.order.frequency.none")},...p]},d=u=>u.map(({value:p,id:g})=>({value:g,label:p}));if(o){const u=d(c(l)).map(({value:M,label:w})=>({name:w,value:M})),p=u.find(M=>M.value===a),g=n.formatMessage("checkout.summary.recurring.order.frequency.label"),E=n.formatMessage("checkout.summary.recurring.order.name.label"),y=n.formatMessage("checkout.summary.recurring.order.frequency.placeholder"),I=n.formatMessage("checkout.summary.recurring.order.name.placeholder"),S=n.formatMessage("salt.form.text-field.clear-button.a11y.label"),C=M=>{e({[hr]:i,[Ko]:M})},T=M=>{t({[hr]:M,[Ko]:a})},_=a===er,A=a==="",R=A&&i,P=`${n.formatMessage("checkout.summary.recurring.order.frequency.label")} ${n.formatMessage("validation.msg.required")}`,N=!A&&!_&&!i,k=`${n.formatMessage("checkout.summary.recurring.order.name.label")} ${n.formatMessage("validation.msg.required")}`;return s.jsxs(V,{className:"salt-m-b--2",flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(fs.DropdownSelect,{label:{text:g},contrastBackground:!0,options:u,defaultValue:p,placeholder:y,error:R?P:void 0,name:Ko,"data-test":Ko,onOptionChange:({value:M})=>C(M)})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(fs.TextField,{label:{text:E},contrastBackground:!0,defaultValue:i,placeholder:I,id:hr,name:hr,clearButton:{ariaLabel:S},errorMessage:N?k:void 0,onBlur:M=>T(M.target.value)})})]})}return s.jsx(On,{...r,children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(w0,{children:s.jsx("div",{className:"salt-m-b--2",children:s.jsx(Am,{name:Ko,placeholder:n.formatMessage("checkout.summary.recurring.order.frequency.placeholder"),defaultValue:a,label:n.formatMessage("checkout.summary.recurring.order.frequency.label"),onChangeCallback:()=>{e({[hr]:r.getValues(hr),[Ko]:r.getValues(Ko)})},validate:u=>(!u||r.getValues(hr)&&u===er)&&`${n.formatMessage("checkout.summary.recurring.order.frequency.label")} ${n.formatMessage("validation.msg.required")}`||!0,options:d(c(l)),deps:[hr],"data-test":Ko},Ko)})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(w0,{children:s.jsx("div",{className:"salt-m-b--2",children:s.jsx(nr,{name:hr,id:hr,label:n.formatMessage("checkout.summary.recurring.order.name.label"),placeholder:n.formatMessage("checkout.summary.recurring.order.name.placeholder"),defaultValue:i,deps:[Ko],onBlur:()=>t({[hr]:r.getValues(hr),[Ko]:r.getValues(Ko)}),validate:u=>!u&&r.getValues(Ko)&&r.getValues(Ko)!==er&&`${n.formatMessage("checkout.summary.recurring.order.name.label")} ${n.formatMessage("validation.msg.required")}`||!0,type:"text"},hr)})})})]})})},tLt=D("pay.check.use"),sLt=Ro(["loyalty","loyred"]),lse=e=>{const{selectedRecurringShoppingDefinitionCreateFrequency:t,slot:n,isUsePaymentChecksEnabled:o,appliedPaymentChecksInBasket:r,isLoyaltyRedeemEnabled:a,basketLoyaltySpent:i,isLoyaltyRegistered:l,actions:c}=e,d=()=>c.analyticsEvent({type:Le.RECURRING_SHOPPING_DEFINITION_FORM_CARD_IMPRESSION,recurringShoppingDefinitionCreateFormImpression:{CARD_TYPE:"recurringShoppingDefinitionCreateForm"}});h.useEffect(()=>{d()},[]);const u=C=>{c.analyticsEvent({type:Le.RECURRING_SHOPPING_DEFINITION_FREQUENCY_SELECTED,description:"The user has chosen the frequency for its recurring order from the dropdown menu",data:{recurringFrequency:C["recurring-shopping-definition-create-frequency"]}})},p=C=>{c.analyticsEvent({type:Le.RECURRING_SHOPPING_DEFINITION_LABEL_WRITTEN,description:"The user has written the label for its recurring order",data:{recurringFrequencyName:C["recurring-shopping-definition-create-name"]}})},g=()=>t===a5?"checkout.summary.recurring.order.confirmed.frequency.every.1.week.message":"checkout.summary.recurring.order.confirmed.frequency.every.2.weeks.message",E=a&&!!i,I=E||a&&l&&!E,S=o&&r&&r.length>=1&&!I;return s.jsxs(xe,{children:[s.jsx("div",{className:"salt-m-b--2",children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"checkout.summary.recurring.order.title"})})}),S?s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.recurring.order.unavailable.message"})}):s.jsxs(ae.Fragment,{children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.summary.recurring.order.create.message"})})}),s.jsx(eLt,{sendAnalyticsForLabelWritten:p,sendAnalyticsForFrequencySelected:u}),n&&t&&t!==er&&s.jsx(Te,{intent:"action",showIcon:!1,"data-test":"recurring-shopping-definition-create-alert",text:s.jsxs(O,{children:[s.jsx(b,{id:g(),values:{slotTimeRange:s.jsx(xf,{dateIsoFrom:n.start,dateIsoTo:n.end,timeZoneId:n.timeZoneId,timeFormat:e.timeFormat}),startingSlotDate:s.jsx(jg,{dateIso:n.start,timeZoneId:n.timeZoneId,dateFormat:e.dateFormat}),weekDayName:s.jsx(jg,{dateIso:n.start,timeZoneId:n.timeZoneId,dateFormat:Ja})}})," ",s.jsx(b,{id:"checkout.summary.recurring.order.change.slot.message"})]})})]})]})};lse.defaultProps={selectedRecurringShoppingDefinitionCreateFrequency:void 0,slot:void 0};const nLt=e=>({slot:TC(e),timeFormat:Mt(e),dateFormat:cr(e),selectedRecurringShoppingDefinitionCreateFrequency:jE(e),isUsePaymentChecksEnabled:tLt(e),appliedPaymentChecksInBasket:is(e)?.appliedPaymentChecks||[],basketLoyaltySpent:bl(e),isLoyaltyRedeemEnabled:sLt(e),isLoyaltyRegistered:zv(e)}),oLt=st({analyticsEvent:U.analyticsEvent}),rLt=Tt(Ht,we(nLt,oLt))(lse),aLt=Ro(["rec.o","cs.rosu"]),iLt=e=>{const{isBasketOrderUnderEdit:t,basketSummary:n,isRecurringOrdersEnabled:o,isSuperUser:r,isExpressCollectionOrMultidayDelivery:a,isCourierSlot:i,isDefaultShippingGroup:l}=e,c=n.slot?.deliveryMethod===pt.vanDelivery.method&&n.slot?.slotType==="ON_DEMAND";return!o||t||a||i||r||!l||c?null:!n||n.isFetchingCheckoutBasket?s.jsx(js.Skeleton,{}):s.jsx("div",{"data-test":"recurring-shopping-definition-create",tabIndex:0,ref:e.recurringShoppingSectionRef,className:"salt-m-b--4",children:s.jsx(rLt,{})})},lLt=e=>({isBasketOrderUnderEdit:Ar(e),basketSummary:is(e),isExpressCollectionOrMultidayDelivery:Yue(e),isCourierSlot:Xi(e),isRecurringOrdersEnabled:aLt(e),isSuperUser:e.session.isSuperuser,isDefaultShippingGroup:pm(e)}),cLt=Tt(Ht,we(lLt))(iLt),dLt=e=>!e||!e?.slot?null:{deliveryStartDate:e.slot.start,deliveryEndDate:e.slot.end,addressNickName:e.slot.nickname,addressNotes:e.slot.notes,address:e.slot.displayAddress,additionalInformation:e.slot.collectionPointAdditionalInformation,ageRestriction:e.ageRestriction,deliveryType:e.slot.deliveryType,deliveryMethod:e.slot.deliveryMethod,slotType:e.slot.slotType,deliveryTimeInMinutes:e.slot.deliveryTimeInMinutes,collectionTimeInMinutes:e.slot.collectionTimeInMinutes,carrierId:e?.checkout?.delivery?.carrierId,addressId:e?.slot?.addressId,shippingGroupType:e?.checkout?.shippingGroupType,externalAddress:e?.checkout?.delivery?.externalAddress,timeZoneId:e.slot.timeZoneId,deliveryDestinationId:e?.slot?.deliveryDestinationId},uLt=v.div`
    ${re.smUp`
            position: sticky;
            top: ${co.v2.sm}px;
        `}
    ${re.lgUp`
            position: sticky;
            top: ${co.v2.lgUp}px;
        `}
`,pLt=e=>{const t=F(),n=Ne(),o=Ge(),r=f($i),a=f(o_),i=f(mo),[l,c,d,u,p]=Ee(["dass","oed","cs.tcm","cs.tc","cs.bpo"]),[g,E,y,I,S]=Ee(["cs.aib","bam","csc.b","loy.waon","cs.edci"]),[C,T]=h.useState({isOpen:!1,maxAgeRestriction:void 0}),_=h.useRef(null),[A,R]=h.useState(!1),[P,N]=h.useState(!1),k=()=>{R(dn=>!dn),N(!1)},M=()=>{_.current?.scrollIntoView({behavior:"smooth",block:"center"}),N(!0)},{shouldShowUnresolvableErrorAlert:w,ageConfirmed:j,isAgeConfirmationError:G,ageConfirmationFormRef:W,basketSummary:H,isBasketLoading:K,checkoutErrorMessage:X,paymentSectionRef:q,recurringShoppingSectionRef:ne,isSelectedRecurringShoppingDefinitionFrequencyDefined:ue,setSelectedWalletItem:oe,setSelectedPaymentMethodExternalWallet:ye,toggleAgeConfirmationCheckbox:he,shouldShowExternalWalletPaymentSelector:Ie,billingAddressRef:Fe,orderBillingAddress:be,loadedViewPortSize:ce,formattedMessages:me,isFinancingProviderNotSelectedError:De,fetchCheckoutBasketWithDeliveryInfo:ge}=e,Se=H.slot?.deliveryMethod===pt.clickAndCollect.method,Ae=!!H.slot?.latestUpdateTime,Ce=l&&!Se&&!!a.length,We=I&&!c?H?.totals?.paymentSplit?.remainingPayment:H?.totals?.display?.finalPrice,{deliveryCardImpression:et,changeDeliveryButtonClicked:ve}=kDt();h.useEffect(()=>{Se||t(uj({deliveryDestinationId:r}))},[t,r,Se]),h.useEffect(()=>{if(!K){const dn=H.items?.some(Zs=>!!i[Zs.productId]?.verifyMode),Mo=H.items.reduce((Zs,{productId:Mn})=>{const Kn=Number(i[Mn]?.ageRestriction);return Kn>Zs?Kn:Zs},0);dn&&T(Zs=>({...Zs,isOpen:!0,maxAgeRestriction:Mo}))}},[K,H,i,n,o]);const lt=s.jsx("div",{className:"salt-m-b--2 md:salt-m-b--0",children:s.jsx(xe,{"data-test":"summary-t&c-item",tabIndex:0,ref:_,children:s.jsx(UDt,{isTermsAndConditionsCheckboxAcknowledged:A,isTermsAndConditionsAcknowledgeError:P,toggleTermsAndConditionsCheckbox:k})})}),St=s.jsxs(h.Fragment,{children:[s.jsxs("div",{className:"salt-m-b--4",children:[p&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx(Tte,{})}),u&&d&&s.jsx(Lt,{breakpoint:"md-up",remainInDom:!1,children:lt}),s.jsx(fj,{delivery:H.slot&&dLt(H),deliveryCardImpression:et,onChangeDeliveryButtonClick:ve,ageConfirmed:j,isAgeConfirmationError:G,ageConfirmationFormRef:W,onClickAgeConfirmation:he})]}),Ce&&s.jsx(jDt,{onChange:ge}),s.jsx(cLt,{recurringShoppingSectionRef:ne})]}),wt=s.jsxs(h.Fragment,{children:[E&&s.jsx(yj,{billingAddressRef:Fe,orderBillingAddress:be,editOrderMode:H.basketStatus?H.basketStatus==="ORDER_EDIT":null,isReadOnly:!1}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(zPt,{isBasketLoading:K,isSelectedRecurringShoppingDefinitionFrequencyDefined:ue,paymentSectionRef:q,setSelectedPaymentMethodExternalWallet:ye,setSelectedWalletItem:oe,shouldShowExternalWalletPaymentSelector:Ie,isFinancingProviderNotSelectedError:De})}),s.jsx(UNt,{isBasketLoading:K}),S&&s.jsx(wDt,{}),g&&s.jsx(iRt,{})]});return s.jsxs(V,{fixed:!0,flush:!0,"data-test":"summary-grid",children:[!Ae&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(MDt,{})}),w&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx("div",{className:"salt-m-b--2",children:s.jsx(FDt,{checkoutErrorMessage:X})})}),u&&!d&&s.jsx(V.Item,{colSpan:{xs:12},children:lt}),s.jsxs(V.Item,{colSpan:{xs:12,md:8},children:[St,wt]}),s.jsx(V.Item,{colSpan:{xs:12,md:4},children:s.jsxs(uLt,{children:[s.jsx("div",{className:"salt-m-b--4",children:y?s.jsx(wL,{summaryTitle:me.summaryTitle,totalPrice:We,loading:K,basketSummary:H,breakpoint:"md-up",loadedViewPortSize:ce,reverseToggleBreakpoint:"md-up",ariaExpandedLabel:me.summaryExpandLabel,ariaCollapsedLabel:me.summaryContractLabel,renderButtonsSection:()=>s.jsx(Yte,{setTermsAndConditionsAcknowledgeError:M,isTermsAndConditionsAcknowledged:A,className:"salt-m-t--4",...e}),renderItemsSection:()=>s.jsx(PDt,{basketSummary:H,page:"checkout-summary"}),renderItemsBySellerSection:()=>s.jsx(NDt,{basketSummary:H,page:"checkout-summary"}),renderEditOrderDifference:dn=>s.jsx(FA,{isExpanded:dn}),children:s.jsx(LDt,{})}):s.jsx(XNt,{setTermsAndConditionsAcknowledgeError:M,isTermsAndConditionsCheckboxAcknowledged:A,...e})}),u&&d&&s.jsx(Kt,{breakpoint:"md-up",remainInDom:!1,children:lt})]})}),s.jsx(Fte,{showDeliveryAssetInitially:!1,onDeliveryDetailsSaved:ge,deliveryDestinationId:r}),s.jsx(XJ,{age:C.maxAgeRestriction,redirectOnCancel:jt,isOpen:C.isOpen})]})},mLt=e=>{const t=f(mo),[n,o]=h.useState(0),[r,a]=h.useState(()=>{const l=e.items.map(({productId:c,quantity:d})=>({product:t[c],quantity:d.quantityInBasket})).filter(({product:c})=>c?.medicalQuestionnaireRequired);return o(l.length),l.map(({product:c,quantity:d},u)=>({productId:c.productId,retailerProductId:c.retailerProductId,retailerProductName:c.name,quantity:d,index:u}))}),i=h.useCallback(()=>{const[,...l]=r;return a(()=>l),l[0]||null},[r]);return{medicine:r[0]||null,medicinesCount:n,getNextMedicine:i}},hLt=e=>{const t=L(),{numberOfProducts:n,productIndex:o,productName:r}=e;let a=n>1?`${t.formatMessage("checkout.summary.pharmacy.modal.header.prefix",{productIndex:o+1,numberOfProducts:n})} `:"";return a+=`${t.formatMessage("checkout.summary.pharmacy.modal.header",{productName:r})}`,s.jsx(ae.Fragment,{children:a})},gLt=()=>{const e=L();return s.jsx(ae.Fragment,{children:e.formatMessage("checkout.summary.pharmacy.modal.confirmation-required.header")})},ELt=e=>s.jsx(B.Header,{align:"center","data-test":e.headerLabelId,children:s.jsx(ee,{as:"h2",id:e.headerLabelId,children:e.confirmationRequired?s.jsx(gLt,{}):s.jsx(hLt,{...e})})}),fLt=v.iframe`
    position: relative;
    opacity: ${({hide:e})=>e?0:1};
    overflow: hidden;
`,yLt={OUT_OF_SERVICE_TIME:"Cannot deliver at this time"};function F0(e){return new URL(e).origin}const ILt="https://z1ab96-form-web1.wittymushroom-99a09b56.japaneast.azurecontainerapps.io/pharmacy/form",SLt=5e3,CLt="Unexpected error while loading a medical questionnaire iframe",B0={UNKNOWN_STRUCTURE:"Unexpected structure of the event",TIMEOUT:"Event was not received"},vLt=({hide:e,pharmacyData:t,onSuccessCallback:n,onCancelCallback:o,onFailCallback:r,onCannotDeliverAtThisTimeCallback:a,setPending:i})=>{const l=es("medical-questionnaire-url"),c=h.useRef(null),d=h.useRef(void 0),u=F();h.useEffect(()=>{i(!0)},[i]);const p=h.useCallback(y=>{const{reason:I,pharmacyData:S}=y;let C=I||"";"errorReason"in y&&(C=I||(y.errorReason?`${CLt}: ${y.errorReason}`:"")),u(U.analyticsEvent({type:Le.PHARMACY_FORM_IFRAME_LOADING_ERROR,reason:C,pharmacyData:S}))},[u]),g=h.useCallback(y=>{y===yLt.OUT_OF_SERVICE_TIME?a():r()},[a,r]),E=h.useCallback(y=>{if(y.origin!==F0(l)&&y.origin!==F0(ILt)||y.source!==c?.current?.contentWindow)return;clearTimeout(d.current);const{OK:I,PENDING:S,ERROR:C,CANCEL:T,READY:_}=nAt,A=y?.data?.reason;switch(y?.data?.status){case _:c?.current?.contentWindow?.postMessage(t,l),i(!1);break;case S:i(!0);break;case I:i(!1),n();break;case T:i(!1),o();break;case C:{i(!1),p({reason:A,pharmacyData:t}),g(A);break}default:p({reason:A,pharmacyData:t,errorReason:B0.UNKNOWN_STRUCTURE});break}},[l,t,i,n,o,p,g]);return h.useEffect(()=>(window.addEventListener("message",E),d.current=setTimeout(()=>{p({pharmacyData:t,errorReason:B0.TIMEOUT})},SLt),()=>{clearTimeout(d.current),window.removeEventListener("message",E)}),[E,t,p]),s.jsx(fLt,{hide:e,sandbox:"allow-scripts allow-same-origin allow-forms",title:"medicine-form",src:l,"data-synthetics":"medicine-iframe","data-test":"medicine-iframe",height:600,width:"100%",ref:c})},TLt=v(_s)`
    position: absolute;
    inset-block-start: 50%;
    inset-inline-start: 50%;
    transform: translate(-50%, -50%);
    z-index: 1001;
`,_Lt=({productName:e})=>{const t=L();return s.jsx(ae.Fragment,{children:t.formatMessage("checkout.summary.pharmacy.modal.confirmation-required.message",{productName:e})})},bLt=e=>{const[t,n]=h.useState(!1),{setConfirmationRequired:o,setSubmitSuccessful:r,pharmacyData:a,setNotEnoughTime:i}=e,l=h.useCallback(()=>{r(!0)},[r]),c=h.useCallback(()=>{o(!0)},[o]),d=h.useCallback(()=>{o(!0)},[o]),u=h.useCallback(()=>{i(!0)},[i]);return s.jsxs(ae.Fragment,{children:[t&&s.jsx(TLt,{size:"m"}),s.jsx(vLt,{hide:t,pharmacyData:a,setPending:n,onSuccessCallback:l,onCancelCallback:c,onFailCallback:d,onCannotDeliverAtThisTimeCallback:u},a.productId)]})},xLt=e=>s.jsx(B.Body,{children:e.confirmationRequired?s.jsx(_Lt,{productName:e.productName}):s.jsx(bLt,{...e})}),ALt=e=>s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(x,{className:"salt-m-t--4",intent:"primary",fill:!0,onClick:e.continueCheckout,"data-test":"pharmacy-modal-continue-checkout",children:s.jsx(b,{id:"checkout.summary.pharmacy.modal.submit-successful.continue-checkout.button"})})}),RLt=e=>s.jsxs(ae.Fragment,{children:[s.jsx(V.Item,{colSpan:{xs:12,sm:6},children:s.jsx(x,{className:"salt-m-t--4",intent:"secondary",fill:!0,onClick:()=>e.setConfirmationRequired(!1),children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.pharmacy.modal.confirmation-required.try-again.button"})})})}),s.jsx(V.Item,{colSpan:{xs:12,sm:6},children:s.jsx(x,{className:"salt-m-t--4",intent:"primary",fill:!0,onClick:e.removeItemFromBasket,"data-test":"pharmacy-confirm-removal",children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.pharmacy.modal.confirmation-required.remove-item.button"})})})})]}),DLt=e=>e.submitSuccessful?s.jsx(ALt,{...e}):e.confirmationRequired?s.jsx(RLt,{...e}):null,OLt=e=>!e.submitSuccessful&&!e.confirmationRequired?null:s.jsx(B.Footer,{className:"salt-d--block",children:s.jsx(V,{children:s.jsx(DLt,{...e})})}),PLt=e=>{const{getNextMedicine:t,removeItemFromBasket:n,continueCheckout:o,medicine:r,medicinesCount:a,pharmacyData:i}=e,l="medicine-modal-header",[c,d]=h.useState(!1),[u,p]=h.useState(!1),[g,E]=h.useState(!1),y=F(),I=h.useCallback(()=>{d(!1),p(!1),E(!1)},[d,p,E]),S=h.useCallback(()=>{u?(I(),t()):g||c?(I(),n()):d(!0)},[u,c,g,I,t,n]);return s.jsxs(B,{isOpen:e.open,aria:{labelledby:l},onRequestClose:S,contentLabel:"medicine-modal",maxWidth:"lg",children:[s.jsx(ELt,{headerLabelId:l,confirmationRequired:c,productName:r.retailerProductName,productIndex:r.index,numberOfProducts:a}),s.jsx(xLt,{confirmationRequired:c,setConfirmationRequired:d,setNotEnoughTime:E,setSubmitSuccessful:C=>{C&&y(U.analyticsEvent({type:Le.PHARMACY_FORM_SUBMIT_CLICKED,description:"Pharmacy modal submit button clicked",pageEventAttributes:{orderId:i.orderId,productId:i.productId,shipmentDate:i.shipmentDate,retailerCustomerId:i.retailerCustomerId}})),p(C)},productName:r.retailerProductName,pharmacyData:i}),s.jsx(OLt,{confirmationRequired:c,submitSuccessful:u,continueCheckout:()=>{I(),o()},removeItemFromBasket:()=>{I(),n()},setConfirmationRequired:d})]})},NLt=(e,t,n,o)=>{const{productId:r,retailerProductId:a,retailerProductName:i,quantity:l}=e;return{productId:r,shipmentDate:n,retailerCustomerId:o,retailerProductId:a,retailerProductName:i,orderId:t,retailerOrderId:t,retailerProductCnt:l}},LLt=({basket:e,actions:t,open:n,requestId:o})=>{const{medicine:r,medicinesCount:a,getNextMedicine:i}=mLt(e),l=f(ei),c=Ge(),d=F(),u=h.useMemo(()=>r&&e?.orderId&&e?.slot?.start?NLt(r,e.orderId,LI(e.slot.start),l):null,[e.orderId,e?.slot?.start,r,l]),p=h.useCallback(()=>{u&&t.analyticsEvent({type:Le.PHARMACY_FORM_DELETE_ITEM_CLICKED,description:"Button to remove medicine from trolley clicked",pageEventAttributes:{orderId:u.orderId,productId:u.productId,shipmentDate:u.shipmentDate,retailerCustomerId:u.retailerCustomerId}})},[t,u]),g=h.useCallback(()=>{t.closeModal(),p(),t.batchRemoveFromBasket({page:"pharmacy",product:{...r}}),e.items.length===1&&c(jt()),Z.info({key:"checkout.summary.pharmacy.modal.notification.item-removed",substitutions:{productName:r?.retailerProductName}}),i()},[t,e.items?.length,i,c,r,p]),E=h.useCallback(()=>{t.closeModal(),i()},[t,i]),y=h.useCallback(()=>{Ue.api.pushError(new Error(`Pharmacy Form could not be loaded due to missing data. RequestId: ${o}`)),g(),Z.error("toast.notification.generic.error")},[g,o]);h.useEffect(()=>{u&&(t.openPharmacyModal(),t.analyticsEvent({type:Le.PHARMACY_FORM_DISPLAYED,description:"Pharmacy modal displayed",pageEventAttributes:{orderId:u.orderId,productId:u.productId,shipmentDate:u.shipmentDate,retailerCustomerId:u.retailerCustomerId}}))},[t,d,u]);const S=Object.values(u||{}).some(C=>C===void 0);return h.useEffect(()=>{S&&y()},[y,S]),u?s.jsx(PLt,{open:n,medicine:r,medicinesCount:a,pharmacyData:u,getNextMedicine:i,removeItemFromBasket:g,continueCheckout:E}):null},kLt=e=>({open:$e(bte)(e),requestId:fC(e)}),jLt=st({analyticsEvent:U.analyticsEvent,openPharmacyModal:()=>J.openModal(bte),closeModal:J.closeModal,batchRemoveFromBasket:ir.createBatchRemoveFromBasket()}),MLt=Tt(we(kLt,jLt))(LLt),wLt=()=>async e=>{try{await e(xh.getRecurringShoppingDefinitions())}catch{}},mi={getRecurringShoppingDefinitions:wLt},In={INITIATE_AUTHENTICATION:"INITIATE_AUTHENTICATION",PAYMENT_REQUESTED:"PAYMENT_REQUESTED",PAYMENT_CANCELLED:"PAYMENT_CANCELLED"};class Nj{eventCallbacks=[];eventSpecificCallbacks={[In.PAYMENT_REQUESTED]:[],[In.PAYMENT_CANCELLED]:[],[In.INITIATE_AUTHENTICATION]:[]};requestPayment(){this.notify({eventType:In.PAYMENT_REQUESTED})}cancelPayment(){this.notify({eventType:In.PAYMENT_CANCELLED})}initiatePaymentAuthentication({authenticationUrl:t}){this.notify({eventType:In.INITIATE_AUTHENTICATION,payload:{authenticationUrl:t}})}notify(t){this.eventCallbacks.concat(this.eventSpecificCallbacks[t.eventType]).forEach(n=>n(t))}subscribe(t){this.eventCallbacks.push(t)}unsubscribe(t){this.eventCallbacks=this.eventCallbacks.filter(n=>n!==t)}subscribeToEvent(t,n){this.eventSpecificCallbacks[t].push(n)}unsubscribeToEvent(t,n){this.eventSpecificCallbacks[t]=this.eventSpecificCallbacks[t].filter(o=>o!==n)}}const Lj=()=>e=>e(gI.getCheckoutBaseRecoverUrl()),FLt={inModal:!1},BLt=v.iframe`
    inline-size: 100%;
    block-size: ${({iframeHeightInPx:e})=>e}px;
`,cse=({url:e,handleResult:t,handleError:n,handleCancellation:o,inModal:r,frameHeight:a})=>{const i=f(D("s.res")),l=f(D("pay.skpxss")),c=h.useRef(null),d=L(),u=F(),{shouldLogUnauthorizedAttempt:p}=qte({throttleTimeoutMs:3e3});let g;a?g=a:g=r?550:650;const E=T=>u(U.analyticsEvent({type:Ot.UNAUTHORIZED_POST_MESSAGE_ATTEMPT,origin:T})),y={iframeTitle:d.formatMessage("checkout.3ds.iframe.title"),processingOrder:d.formatMessage("checkout.processing.text")},I=T=>{T.redirectUrl?window.location.assign(T.redirectUrl):(Ue.api.pushError(new Error("Received trigger external redirect event, but no redirectUrl was found.")),n())},S=()=>i?void 0:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-top-navigation-by-user-activation",C=T=>{if(!l&&!zP(T.origin)){p(T.origin)&&E(T.origin);return}T.data.type==="CHECKOUT_RESULT_TOKEN"?t(T.data):T.data.type==="CHECKOUT_ERROR"?n(T.data.reason):T.data.type==="CHECKOUT_CANCELLED"?o():T.data.type==="TRIGGER_EXTERNAL_REDIRECT"&&I(T.data)};return h.useEffect(()=>(window.addEventListener("message",C),()=>{window.removeEventListener("message",C)}),[]),s.jsx(BLt,{"data-pii":"true","data-synthetics":"3ds-iframe","data-test":"3ds-iframe",sandbox:S(),src:e,title:y.iframeTitle,ref:c,iframeHeightInPx:g})};cse.defaultProps=FLt;const ULt=D("pay.ew"),GLt=D("pay.paw"),$Lt=v.span`
    font-size: ${$(14)};
`,HLt={actions:m.shape({analyticsEvent:m.func.isRequired,fetchRecoveryUrls:m.func.isRequired}).isRequired,intl:m.any.isRequired,messageCallback:m.func.isRequired,errorCallback:m.func.isRequired,redirectUrlConfig:m.shape({url:m.string.isRequired,text:m.string.isRequired}),location:m.shape({search:m.string.isRequired,state:m.shape({psp:m.string,pspweb:m.shape({url:m.string.isRequired})})}).isRequired,externalWalletManagement:m.bool,isUrlFetching:m.bool,baseUrlLastModified:m.number,recoveryUrls:m.shape({pspweb:m.shape({url:m.string})}),inModal:m.bool,threeDsHeight:m.number},VLt={externalWalletManagement:!1,redirectUrlConfig:void 0,recoveryUrls:{},isUrlFetching:!1,baseUrlLastModified:null,inModal:!1};class kj extends h.Component{constructor(t){super(t),this.handlePspWebMessage=this.handlePspWebMessage.bind(this),this.handle3dsError=this.handle3dsError.bind(this),this.handle3dsCancellation=this.handle3dsCancellation.bind(this),this.setFrameBoxPosition=this.setFrameBoxPosition.bind(this),this.sendPageAttributesEvent=this.sendPageAttributesEvent.bind(this),this.formattedMessages={iframeTitle:t.intl.formatMessage("checkout.3ds.iframe.title"),processingOrder:t.intl.formatMessage("checkout.processing.text"),summaryRedirectWarningText:t.intl.formatMessage("checkout.3ds.summary.redirect.warning.text"),summaryRedirectWarningLinkText:t.intl.formatMessage("checkout.3ds.summary.redirect.warning.link.text")},this.state={isWaiting:!0}}componentDidMount(){const{actions:{fetchRecoveryUrls:t},location:n}=this.props,{recoveryToken:o}=ps.parse(n.search);o&&t(),this.setState({isWaiting:!1}),this.sendPageAttributesEvent()}shouldComponentUpdate(t,n){return n.isWaiting!==this.state.isWaiting||this.isRecoveryLoading(t)!==this.isRecoveryLoading(this.props)}setFrameBoxPosition(t){const n=t.target.parentNode,o=n.getBoundingClientRect().top;n.setAttribute("style",`--frameBoxPosition: ${o}px;`)}handlePspWebMessage({resultToken:t}){this.setState({isWaiting:!0},()=>{const{messageCallback:n}=this.props;return n({resultToken:t})})}handle3dsError(t){let n="order.cow.3ds.failure",o="3ds=failure";return t==="TOKEN_NOT_FOUND"&&(n="payments.notification.token.not.found.error",o=o+"&reason=token-not-found"),Z.error(n),this.props.errorCallback({errorParam:o})}handle3dsCancellation(){return Z.error("order.cow.3ds.user.cancelled"),this.props.errorCallback({errorParam:"3ds=cancelled"})}shouldShowWaiting(){const{isUrlFetching:t,baseUrlLastModified:n}=this.props;return this.state.isWaiting||this.isRecovery()&&this.isRecoveryLoading({isUrlFetching:t,baseUrlLastModified:n})}sendPageAttributesEvent(){this.props.actions.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{IS_EXTERNAL_PAYMENT:this.props.externalWalletManagement}})}renderSpinner(){return s.jsxs("div",{className:"salt-m--8",children:[s.jsx(_s,{"data-test":"3ds-spinner"}),s.jsx("div",{className:"salt-m-t--2",style:{textAlign:"center"},children:this.formattedMessages.processingOrder})]})}renderRedirectWarning(){return s.jsx(Te,{className:"salt-m-t--8 salt-m-x--1 salt-m-b--4",intent:"warning","data-test":"payment-authentication-warning",showIcon:!1,text:s.jsxs($Lt,{children:[s.jsx("span",{className:"salt-d--inline-block",children:this.formattedMessages.summaryRedirectWarningText})," "]}),link:s.jsx(Te.Link,{href:this.props.redirectUrlConfig.url,onClick:this.handle3dsCancellation,"data-test":"3ds-redirect-warning",isSSRNavigation:!0,children:this.props.redirectUrlConfig.text})})}buildPspwebRecoveryUrl(){const{recoveryUrls:t,location:n}=this.props,o=t?.pspweb?.url,{recoveryToken:r}=ps.parse(n.search);return o&&r?`${o}?${ps.stringify({recoveryToken:r})}`:""}isRecovery(){const{pspweb:t}=this.props.location?.state||{};return!t?.url}isRecoveryLoading({isUrlFetching:t,baseUrlLastModified:n}){return t||!n}renderPspContent(){const{pspweb:t}=this.props.location?.state||{};return s.jsx(cse,{url:t?.url||this.buildPspwebRecoveryUrl(),handleResult:this.handlePspWebMessage,handleError:this.handle3dsError,inModal:this.props.inModal,handleCancellation:this.handle3dsCancellation,frameHeight:this.props.threeDsHeight})}render3dsIFrame(){const t=this.renderPspContent();return s.jsxs(h.Fragment,{children:[this.props.isPaymentAuthenticationWarningEnabled&&this.props.redirectUrlConfig&&this.renderRedirectWarning(),this.props.inModal?t:s.jsx(cv,{onLoad:this.setFrameBoxPosition,children:t})]})}render(){return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"checkout.3ds.page.title"}),this.shouldShowWaiting()?this.renderSpinner():this.render3dsIFrame()]})}}kj.propTypes=HLt;kj.defaultProps=VLt;const WLt=e=>({externalWalletManagement:ULt(e),isPaymentAuthenticationWarningEnabled:GLt(e),isUrlFetching:IJe(e),recoveryUrls:JQ(e),baseUrlLastModified:SJe(e)}),YLt=st({analyticsEvent:U.analyticsEvent,fetchRecoveryUrls:Lj}),i_=Tt(Ht,we(WLt,YLt))(kj),qLt={taxGroups:m.arrayOf(m.shape()).isRequired,taxTotal:m.string.isRequired,isTaxGrossDisplayed:m.bool},KLt={isTaxGrossDisplayed:!1},Af=({isTaxGrossDisplayed:e,taxGroups:t,taxTotal:n})=>{const o={totalMessage:e?"payment.modal.tax.breakdown.total.inclusive.tax":"payment.modal.tax.breakdown.total"};return s.jsx(h.Fragment,{children:!!t?.length&&!!n&&s.jsxs(fe,{"data-test":"taxes-breakdown",children:[t.map(r=>s.jsxs(fe.Group,{children:[s.jsxs(fe.Title,{children:[r.displayName," ",s.jsx(hH,{value:r.taxRate/100||0,style:"percent"})]}),s.jsx(fe.Description,{"data-test":"taxes-breakdown-item-description",children:r.valueAndCurrency})]},r.displayName)),s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{children:s.jsx(b,{id:o.totalMessage})}),s.jsx(fe.Description,{"data-test":"taxes-breakdown-total",children:n})]})]})})};Af.propTypes=qLt;Af.defaultProps=KLt;const zLt=D("m.la.h"),QLt=v(B.Body)`
    overflow: hidden;
    flex-direction: column;
`,AI="paymentPsp",l_=e=>{const{isFetching:t=!1,title:n="",url:o=void 0,taxInfo:{taxGroups:r,taxTotal:a}={taxGroups:[],taxTotal:"",isError:!1},isTaxGrossDisplayed:i=!1,handleError:l=()=>{},handleSuccess:c=()=>{},isRecoveringThreeDs:d=!1,location:u={},maxWidth:p="sm",threeDsHeight:g,onClose:E=()=>{},onAfterClose:y=()=>{},asBottomSheet:I=!1}=e,S=L(),C=F(),T=f(zLt),_=Wt(AI),A=k=>{k?.preventDefault?.(),C(U.analyticsEvent({type:bs.SELECTED_DELIVERY_PASS_PLAN_MODAL_DISPLAYED,userAction:"close"})),E?.(),_.close(),y?.()},R=({resultToken:k})=>{k&&c(k)},P={...u,state:{...u.state,pspweb:{url:o}}},N=S.formatMessage("checkout.3ds.summary.redirect.warning.link.text");return s.jsxs(B,{isOpen:_.isOpen,onRequestClose:k=>A(k),isLoading:t,maxWidth:p,asBottomSheet:I,children:[s.jsx(B.Header,{align:T?"left":"center","data-test":"payment-psp-modal-title",children:s.jsx(ee,{as:"h1",children:n})}),s.jsxs(QLt,{className:"salt-d--flex",children:[s.jsx(Af,{isTaxGrossDisplayed:i,taxGroups:r,taxTotal:a}),P.state?.pspweb?.url||d?s.jsx(i_,{"data-test":"payment-psp-subscription-iframe",messageCallback:R,errorCallback:l,location:P,inModal:!0,redirectUrlConfig:{url:vr(),text:N},threeDsHeight:g}):s.jsx("div",{className:"salt-m--8",children:s.jsx(_s,{"data-test":"payment-psp-modal-spinner"})})]})]})},XLt=({actions:e,paymentSession:t})=>{const{canCheckout:n,handlePaymentAuthenticationSuccess:o}=Sj(),[r,a]=h.useState(void 0);h.useEffect(()=>{const d=({eventType:u,payload:p})=>{switch(u){case In.PAYMENT_REQUESTED:a(void 0),e.openPaymentAuthenticationModal();break;case In.PAYMENT_CANCELLED:e.closeModal();break;case In.INITIATE_AUTHENTICATION:n().then(()=>a(p.authenticationUrl)).catch(e.closeModal);break}};return t.subscribe(d),()=>{e.closeModal(),t.unsubscribe(d)}},[]);const i=d=>o({resultToken:d}),l=()=>e.closeModal(),c=r&&{state:{pspweb:{url:r}}};return s.jsx(l_,{handleError:l,handleSuccess:i,url:r,location:c||{}})},ZLt=st({closeModal:J.closeModal,openPaymentAuthenticationModal:()=>J.openModal("paymentPsp")}),JLt=we(null,ZLt)(XLt),ekt=v.div`
    text-align: center;
    background-color: #ea5653;
`,tkt=v.object`
    max-inline-size: 100%;
    inline-size: 350px;
    block-size: auto;
`,skt=({altText:e,url:t})=>t?s.jsx(ekt,{children:s.jsx(tkt,{title:e,data:t,type:"image/svg+xml","data-test":"alcohol-tests-banner"})}):null,nkt=e=>({url:Ze(e,"french-alcohol-tests-banner-url")||void 0,altText:Ze(e,"french-alcohol-tests-banner-alternative-text")||void 0}),okt=we(nkt)(skt),rkt=D("m.la.h"),Ub=e=>({type:Le.PAYMENT_BUFFER_MODAL_DISPLAYED,description:"A payment buffer modal was displayed",pageEventAttributes:{...Object(e)}}),akt=e=>{const{actions:t,intl:n,isOpen:o=!1,openOnPageLoad:r=!1,totalBufferRate:a="0",modalLeftAlignEnabled:i=!1}=e,[l]=Ee(["nfchk"]),[c,d]=h.useState(!1),u=aet(),p=h.useCallback(()=>{r&&u(c),t.closeModal()},[t,c,r,u]),g=Qte(a),E="payment-buffer-modal-header";return s.jsxs(B,{isOpen:o,onAfterOpen:()=>t.analyticsEvent(Ub({userAction:"open"})),onRequestClose:()=>{t.closeModal(),t.analyticsEvent(Ub({userAction:"close",...Object(r&&{checkboxSelected:c,checkboxName:n.formatMessage("checkout.summary.modal.paymentBuffer.checkbox.label")})}))},contentLabel:"payment-buffer-modal",aria:{labelledby:E},children:[s.jsx(B.Header,{align:i?"left":"center","data-test":E,children:s.jsx(ee,{as:"h2",id:E,children:s.jsx(b,{id:"checkout.summary.modal.paymentBuffer.title",values:{bufferPercent:g}})})}),s.jsx(B.Body,{children:s.jsx(O,{asChild:!0,children:s.jsx("p",{children:s.jsx(b,{id:"checkout.summary.modal.paymentBuffer.description",values:{bufferPercent:g}})})})}),r&&s.jsxs(B.Footer,{align:i?"left":"center",flow:"column",children:[l?s.jsx(fs.Checkbox,{name:"cancelOpeningPaymentBufferModalOnLoad",value:"cancelOpeningPaymentBufferModalOnLoad","data-test":"payment-buffer-modal-checkbox","aria-label":n.formatMessage("checkout.summary.modal.paymentBuffer.checkbox.accessibility.label",{bufferPercent:g}),label:n.formatMessage("checkout.summary.modal.paymentBuffer.checkbox.label"),className:"salt-m-b--4",checked:c,onChange:()=>d(!c)}):s.jsx(Lo,{name:"cancelOpeningPaymentBufferModalOnLoad","data-test":"payment-buffer-modal-checkbox","aria-label":n.formatMessage("checkout.summary.modal.paymentBuffer.checkbox.accessibility.label",{bufferPercent:g}),label:s.jsx(b,{id:"checkout.summary.modal.paymentBuffer.checkbox.label"}),input:{onChange:()=>d(!c),checked:c},whiteSpace:"pre-wrap",last:!1,bold:!0}),s.jsx(x,{intent:"primary",onClick:()=>{p(),t.analyticsEvent(Ub({userAction:"continue",checkboxSelected:c,checkboxName:n.formatMessage("checkout.summary.modal.paymentBuffer.checkbox.label")}))},"data-synthetics":"payment-buffer-modal-action-button","data-test":"payment-buffer-modal-action-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.summary.modal.paymentBuffer.button"})})})]})]})},U0="paymentBuffer",ikt=e=>({totalBufferRate:Xk(e),openOnPageLoad:Yn(U0)(e),isOpen:$e(U0)(e),modalLeftAlignEnabled:rkt(e)}),lkt=e=>({actions:vl({closeModal:J.closeModal,analyticsEvent:U.analyticsEvent},e)}),ckt=Tt(Ht,we(ikt,lkt))(akt),dkt=({title:e})=>{const t=f(L5),n=t>0;if(f(D("cs.prind"))&&n){const r=`${t+1}/${t+1}`;return s.jsx(sn,{children:s.jsx(ra,{progressFraction:r,overrideText:s.jsx(ee,{as:"h1",children:e}),ringContent:s.jsx(O,{size:"l",bold:!0,children:r})})})}return s.jsx(sn,{children:s.jsx(ee,{as:"h1",children:e})})},ukt="marketingpreferences",pkt="/api/marketing-preferences",dse="/v1/marketing-preferences-view",mkt=se("GET_MARKETING_PREFERENCES"),hkt=se("UPDATE_MARKETING_PREFERENCES"),use={service:ukt,pathPrefix:{client:pkt,server:"/core-api"}},gkt=()=>({type:"API",payload:{url:dse,...use,...mkt}}),Ekt=e=>({type:"API",payload:{url:dse,...use,options:{body:e,method:"PUT"},...hkt}}),pse={getMarketingPreferences:gkt,updateMarketingPreferences:Ekt},fkt=async({context:{store:e}})=>e.dispatch(jj()),jj=()=>async e=>{try{await e(pse.getMarketingPreferences())}catch(t){Ue.api.pushError(t instanceof Error?t:new Error(`fetchPreferencesService error: ${JSON.stringify(t)}`))}},Mj=()=>{const e=f(x5e),t=F();return{marketingPreferences:e,onFetchMarketingPreferences:h.useCallback(()=>t(jj()),[t])}},mse=()=>{const e=F();return h.useCallback(t=>e(n=>n(pse.updateMarketingPreferences(ykt(t))).then(()=>{const o={event:"event",eventCategory:"Settings",eventAction:"UPDATE_MARKETING_PREFERENCES_SUCCESS",eventLabel:"Not Set"};return te.sendEvent({GA:o,WA:null}),n(jj()),Promise.resolve()}).catch(o=>{const r={event:"event",eventCategory:"Settings",eventAction:"UPDATE_MARKETING_PREFERENCES_ERROR",eventLabel:"Not Set"};throw te.sendEvent({GA:r,WA:null}),o})),[e])},ykt=e=>Object.entries(e).map(([t,n])=>({preferenceId:t,isChecked:n}));function Ikt(e){const t=L();return{messages:{phoneNumberLabel:t.formatMessage("additional.details.modal.phone.number.label"),phoneFormatError:t.formatMessage("additional.details.modal.phone.format.error"),ageConfirmLabel:t.formatMessage("additional.details.modal.age.confirmation.label",{age:e}),ageConfirmRequired:t.formatMessage("additional.details.modal.age.confirmation.required",{age:e})},formatMessage:t.formatMessage}}function Skt({visibleMarketingPreferences:e,settings:{ageConfirmationRequired:t,requiredAge:n},validation:{phoneNumber:o},forwardedRef:r,onSubmit:a}){const i=Bs(),l=po(),c=Ikt(n);function d(){const u=l.getValues();let p={phoneNumber:u.details.mobilePhone!=="",ageConfirmation:u.details.ageConfirmed};l.getFieldState("details.mobilePhone").invalid&&(p.phoneNumberError=!0),u.preferences&&(p={...p,...u.preferences}),i.saveDetailsButtonClickedEvent(p)}return s.jsxs("form",{onSubmit:l.handleSubmit(u=>{const{fields:p,...g}=u;d(),a(g)},()=>{d()}),children:[s.jsx(nr,{name:"details.mobilePhone",label:c.messages.phoneNumberLabel,hasRequiredSymbol:!1,required:{value:!0,message:c.messages.phoneFormatError},pattern:{value:new RegExp(o),message:c.messages.phoneFormatError},"data-pii":"true","data-test":"input-details.mobilePhone"}),e.map(({preferenceId:u,label:p,description:g})=>s.jsx(LS,{name:`preferences.${u}`,label:p,description:g,"data-pii":"true"},u)),t&&s.jsx(LS,{name:"details.ageConfirmed",label:c.messages.ageConfirmLabel,required:{value:!0,message:c.messages.ageConfirmRequired},"data-pii":"true","data-test":"details.ageConfirmed"}),s.jsx("button",{type:"submit","data-test":"additional-details-form-submit",ref:r,className:"salt-d--none",children:"submit"})]})}const Ckt=(e,t)=>t.reduce((n,o)=>{const r=e.find(({id:a})=>a===o);if(r){const{id:a,checkboxText:i,descriptionText:l,isChecked:c}=r;return[...n,{preferenceId:a,label:i||"",description:l||"",value:c}]}return n},[]);function vkt(){const e=f(yde),{marketingPreferences:{preferences:{preferences:t},isFetching:n,lastUpdated:o},onFetchMarketingPreferences:r}=Mj(),a=!(o||n);h.useEffect(()=>{a&&r()},[a]);const i=Ckt(t,e);return{visiblePreferences:i,formData:h.useMemo(()=>i.reduce((l,{preferenceId:c,value:d})=>({...l,[c]:d}),{}),[o])}}const Tkt=ae.forwardRef((e,t)=>{const n=po(),{visiblePreferences:o,formData:r}=vkt(),a=e.customerDetails?.mobilePhone,i=f(mde),l=es("age-restricted-products-confirmation-age"),c=Number(l),u=es("age-restricted-products-should-confirm-age")==="true",[p,g]=h.useState(0);return h.useEffect(()=>{n.setValue("details.mobilePhone",a),n.setValue("preferences",r),g(p+1)},[a,r]),p?s.jsx(Skt,{...e,visibleMarketingPreferences:o,forwardedRef:t,validation:{phoneNumber:i},settings:{requiredAge:c,ageConfirmationRequired:u}}):null}),G0="center",hse=()=>{const e=L(),t=F(),n=ae.useRef(),o=Bs(),r=f($e("additionalDetails")),a=f(Ol),i=es("default-mobile-phone-number-default-country"),{marketingPreferences:{lastUpdated:l}}=Mj(),c=mse(),d={phoneFormatError:e.formatMessage("additional.details.modal.phone.format.error"),modalHeader:e.formatMessage("additional.details.modal.header"),modalBodyLeader:e.formatMessage("additional.details.modal.body.leader"),modalDone:e.formatMessage("additional.details.modal.done")};h.useEffect(()=>{p(a)&&t(xs.getCurrentCustomer())},[]),h.useEffect(()=>{r&&o.userDetailsFormModalDisplayed()},[r]);const u=Dn({mode:"onSubmit"}),p=I=>!I.lastUpdated&&!I.isFetching||I.didInvalidate,g=I=>Promise.allSettled([t(xs.updateAdditionalDetails(I.details,i)),c(I.preferences)]).then(([S])=>{if(S.status==="rejected")throw S.reason;return t(xs.getCurrentCustomer())}).then(()=>t(J.closeModal())).catch(S=>{S.statusCode===400&&u.setError("details.mobilePhone",{type:"pattern",message:d.phoneFormatError})}),E="additional-details-modal-header",y=I=>{t(J.closeModal()),I.type==="click"?o.userDetailsFormModalClosed("cross icon"):I.type==="keydown"&&I.code==="Escape"&&o.userDetailsFormModalClosed("escape click")};return s.jsxs(B,{isOpen:r,onRequestClose:y,isLoading:!a.lastUpdated&&!l,aria:{labelledby:E},children:[s.jsx(B.Header,{align:G0,children:s.jsx(ee,{as:"h1",id:E,children:d.modalHeader})}),s.jsxs(B.Body,{children:[s.jsx(O,{className:"salt-d--block salt-m-b--4",children:d.modalBodyLeader}),s.jsx(On,{...u,children:s.jsx(Tkt,{ref:n,onSubmit:g,customerDetails:a.data})})]}),s.jsx(B.Footer,{align:G0,children:s.jsx(x,{intent:"primary",fill:!0,onClick:()=>n.current?.click(),"data-test":"done-button",children:s.jsx(x.Text,{children:d.modalDone})})})]})},_kt=()=>{const e=F(),t=()=>{e(J.openModal("additionalDetails"))};return s.jsxs(h.Fragment,{children:[s.jsx(V,{className:"salt-m-t--4",children:s.jsxs(V.Item,{colStart:{sm:2,md:4},colSpan:{xs:12,sm:10,md:6},children:[s.jsx(Te,{intent:"warning",showIcon:!1,text:s.jsx(b,{id:"additional.details.checkout.page.message"}),className:"salt-m-t--8"}),s.jsx(Q,{justify:"center",children:s.jsx(x,{intent:"primary",onClick:t,className:"salt-m-t--4",children:s.jsx(x.Text,{children:s.jsx(b,{id:"additional.details.page.button"})})})})]})}),s.jsx(hse,{})]})};let bkt=class extends h.Component{formattedMessages;paymentSectionRef;ageConfirmationFormRef;recurringShoppingSectionRef;billingAddressSectionRef;paymentSession;constructor(t){super(t),this.isBasketLoading=this.isBasketLoading.bind(this),this.setIsWaiting=this.setIsWaiting.bind(this),this.setUnresolvableCheckoutErrorAlert=this.setUnresolvableCheckoutErrorAlert.bind(this),this.setSelectedWalletItem=this.setSelectedWalletItem.bind(this),this.setSelectedPaymentMethodExternalWallet=this.setSelectedPaymentMethodExternalWallet.bind(this),this.toggleCollapsibleSummaryBoxState=this.toggleCollapsibleSummaryBoxState.bind(this),this.scrollToPaymentSection=this.scrollToPaymentSection.bind(this),this.scrollToRecurringShoppingDefinitionCreateSection=this.scrollToRecurringShoppingDefinitionCreateSection.bind(this),this.sendSummaryToggledAnalyticsEvent=this.sendSummaryToggledAnalyticsEvent.bind(this),this.isSelectedRecurringShoppingDefinitionFrequencyDefined=this.isSelectedRecurringShoppingDefinitionFrequencyDefined.bind(this),this.displayPaymentCheckNotificationFetchingAvailability=this.displayPaymentCheckNotificationFetchingAvailability.bind(this),this.sendVouchersAddedToOrderAnalyticsEvent=this.sendVouchersAddedToOrderAnalyticsEvent.bind(this),this.toggleAgeConfirmationCheckbox=this.toggleAgeConfirmationCheckbox.bind(this),this.setAgeConfirmationError=this.setAgeConfirmationError.bind(this),this.setPsp=this.setPsp.bind(this),this.onPaymentSessionEvent=this.onPaymentSessionEvent.bind(this),this.fetchCheckoutBasketWithDeliveryInfo=this.fetchCheckoutBasketWithDeliveryInfo.bind(this),this.scrollToBillingAddressSection=this.scrollToBillingAddressSection.bind(this),this.openModalAdditionalDetails=this.openModalAdditionalDetails.bind(this),this.fetchOrderInEditOrderMode=this.fetchOrderInEditOrderMode.bind(this),this.setFinancingProviderNotSelectedError=this.setFinancingProviderNotSelectedError.bind(this),this.formattedMessages={paymentTitle:t.intl.formatMessage("checkout.summary.payment.method.title"),button:t.intl.formatMessage("checkout.summary.next.line1"),buttonLine2:t.intl.formatMessage("checkout.summary.next.line2"),processingOrder:t.intl.formatMessage("checkout.processing.text"),title:t.intl.formatMessage("checkout.summary.title"),summaryTitle:t.intl.formatMessage("summary.title"),summaryContractLabel:t.intl.formatMessage("summary.component.accessibility.toggle.switch.off.label"),summaryExpandLabel:t.intl.formatMessage("summary.component.accessibility.toggle.switch.on.label")},this.state={isWaiting:!1,walletItemId:null,isUnsavedPaymentMethodSelected:!1,isFinancingProviderNotSelectedError:!1,expanded:!1,loadedViewPortSize:!1,psp:null,selectedExternalWalletPaymentMethod:null,shouldShowUnresolvableErrorAlert:!1,checkoutErrorMessage:"",isCheckoutBasketFetchedOrFetching:!1,ageConfirmed:!1,isAgeConfirmationError:!1,pharmacyReady:!1,orderDetailsReady:!1,paymentChecksFetchedOrFetching:!1},this.paymentSectionRef=ae.createRef(),this.recurringShoppingSectionRef=ae.createRef(),this.ageConfirmationFormRef=ae.createRef(),this.billingAddressSectionRef=ae.createRef(),this.paymentSession=new Nj,t.isPaymentAuthenticationInModalEnabled||this.paymentSession.subscribe(this.onPaymentSessionEvent)}componentDidMount(){const{skipPaymentBufferModalOnPageLoad:t,actions:n,externalWalletManagement:o,isPaymentBufferModalOnLoadEnabled:r,basketSummary:a,isExternalWalletPaymentSelectorEnabled:i,pharmacyEnabled:l,additionalDetails:c,additionalDetailsPopUpSummaryEnabled:d,isPaymentCheckoutSummaryV2Enabled:u,paymentCheckoutSummaryIsFetching:p,navigate:g,isCollapseAllByDefaultEnabled:E}=this.props;d&&(!c.lastUpdated&&!c.isFetching||c.didInvalidate?n.fetchAdditionalDetailsRequired():c.required&&this.openModalAdditionalDetails()),a.fetchErrorCheckoutBasket&&g("/basket",{state:{notification:{type:"error",message:"toast.notification.generic.error"}}}),n.fetchProductEntitiesFromBasket().then(()=>{l&&this.setState({pharmacyReady:!0})}),n.performanceMark({name:sAe}),n.analyticsEvent({type:Le.CHECKOUT_SUMMARY_DISPLAYED});const y={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventLabel:"Not Set",eventAction:"CheckoutSummary",ecommerce:{checkout:{actionField:{step:4},products:this.props.basketProducts?.map(S=>tn(S))}}};te.sendEvent({GA:y,WA:null}),a.isFetchingCheckoutBasket?this.setState({isCheckoutBasketFetchedOrFetching:!0}):this.fetchCheckoutBasketWithDeliveryInfo(),n.fetchActivePsps();const I=typeof window<"u"&&window.matchMedia(`(min-width: ${Ke.md}em)`).matches;if(this.setState({expanded:I&&!E,loadedViewPortSize:!0}),r&&!t&&n.openPaymentBufferModal({openOnPageLoad:!0}),o&&!i){n.analyticsEvent({type:Le.SELECT_PAYMENT});const S={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventLabel:"Not Set",eventAction:"PaymentSelected",ecommerce:{checkout:{actionField:{step:5},products:this.props.basketProducts?.map(C=>tn(C))}}};te.sendEvent({GA:S,WA:null})}n.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{IS_EXTERNAL_PAYMENT:o}}),this.sendVouchersAddedToOrderAnalyticsEvent(),this.fetchOrderInEditOrderMode(),p||(u?n.fetchOrderPaymentCheckoutSummaryWithPaymentMethodGroups():n.fetchOrderPaymentCheckoutSummary())}componentDidUpdate(t){const{actions:n,basketSummary:o,isCheckoutSummaryInvoiceModalOpen:r,isAgeConfirmationEnabled:a,additionalDetails:i,additionalDetailsPopUpSummaryEnabled:l,navigate:c}=this.props;l&&i.required!==t.additionalDetails.required&&i.required&&this.openModalAdditionalDetails();const{selectedExternalWalletPaymentMethod:d}=this.state,u=!this.isSelectedRecurringShoppingDefinitionFrequencyDefined(t)&&this.isSelectedRecurringShoppingDefinitionFrequencyDefined(this.props);this.shouldShowExternalWalletPaymentSelector()&&u&&!r&&d===at.CARDS&&n.openCheckoutSummaryInvoiceModal(),o.fetchErrorCheckoutBasket&&!t.basketSummary.fetchErrorCheckoutBasket&&c("/basket",{state:{notification:{type:"error",message:"toast.notification.generic.error"}}}),Oi(o.vouchers,t.basketSummary.vouchers)||this.sendVouchersAddedToOrderAnalyticsEvent(),a&&!o.isFetchingCheckoutBasket&&t.basketSummary.isFetchingCheckoutBasket&&n.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{AGE_CHECK_REQUIRED:!!o.ageRestriction}}),this.fetchOrderInEditOrderMode(),!this.isBasketLoading()&&!this.state.paymentChecksFetchedOrFetching&&this.displayPaymentCheckNotificationFetchingAvailability()}componentWillUnmount(){this.paymentSession.unsubscribe(this.onPaymentSessionEvent)}onPaymentSessionEvent({eventType:t,payload:n}){switch(t){case In.PAYMENT_REQUESTED:this.setIsWaiting();break;case In.PAYMENT_CANCELLED:this.setIsWaiting();break;case In.INITIATE_AUTHENTICATION:this.onPaymentAuthenticationInitiated({eventType:t,payload:n});break}}fetchCheckoutBasketWithDeliveryInfo(){const{actions:t,isUsePaymentChecksEnabled:n}=this.props;t.getCheckoutBasket({...n&&{fetchAllocatedPaymentChecks:!0}}).then(()=>{t.getConciergeDelivery(),this.setState({isCheckoutBasketFetchedOrFetching:!0}),n&&this.displayPaymentCheckNotificationFetchingAvailability()})}onPaymentAuthenticationInitiated({payload:t}){const{authenticationUrl:n}=t;this.props.navigate(lue(),{state:{pspweb:{url:n}}})}fetchOrderInEditOrderMode(){const{actions:t,basketSummary:n,order:o}=this.props;n.basketStatus==="ORDER_EDIT"&&!this.state.orderDetailsReady&&!o.isFetching&&!o.fetchError&&t.getOrder(n.orderId).then(()=>{this.setState({orderDetailsReady:!0})})}displayPaymentCheckNotificationFetchingAvailability(){const{actions:t,appliedPaymentChecks:n,basketSummary:o,isUsePaymentChecksEnabled:r,removedPaymentChecks:a}=this.props,i=a&&a.length>=1;!r||this.isSelectedRecurringShoppingDefinitionFrequencyDefined(this.props)||o.basketStatus==="ORDER_EDIT"&&(!this.state.orderDetailsReady||this.isRecurringOrder())||(this.setState({paymentChecksFetchedOrFetching:!0}),i?(Z.warning("checkout.summary.bonus.check.redeem.error.toast"),t.analyticsEvent({type:Le.TOAST_NOTIFICATION_DISPLAYED,description:"A toast notification was displayed",pageEventAttributes:{status:"PAYMENT_CHECK_BELOW_THE_THRESHOLD"}})):(!n||n.length<1)&&t.fetchAvailablePaymentChecks({basketTotal:o?.totals?.finalPrice,orderId:o.orderId}).then(l=>{if(l&&l.payload&&l.payload.responseData){const{availablePaymentChecks:c}=l.payload.responseData;c&&c.length>=1&&(Z.info("checkout.summary.bonus.check.available.toast"),t.analyticsEvent({type:Le.TOAST_NOTIFICATION_DISPLAYED,description:"A toast notification was displayed",pageEventAttributes:{status:"PAYMENT_CHECK_AVAILABLE"}}))}}))}isBasketLoading(){const{basketSummary:t}=this.props,{isCheckoutBasketFetchedOrFetching:n}=this.state;return!t||t.isFetching||!n||t.isFetchingCheckoutBasket}setSelectedWalletItem({walletItemId:t,isUnsavedPaymentMethodSelected:n}){this.setState({walletItemId:t,isUnsavedPaymentMethodSelected:n},()=>{const{actions:o,locationPath:r}=this.props;o.analyticsEvent({type:Ot.SELECT_WALLET_ITEM,description:"User selected payment method",pageEventAttributes:{page:r,walletItemId:t||"NOT_SAVED"}});const a={event:"event",eventCategory:"Payment",eventAction:"SelectWalletItem",eventLabel:r,walletItemId:t||"NOT_SAVED"};te.sendEvent({GA:a,WA:null}),o.analyticsEvent({type:Le.SELECT_PAYMENT});const i={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventLabel:"Not Set",eventAction:"PaymentSelected",ecommerce:{checkout:{actionField:{step:5},products:this.props.basketProducts?.map(l=>tn(l))}}};te.sendEvent({GA:i,WA:null})})}setSelectedPaymentMethodExternalWallet(t){const{actions:n}=this.props;t===at.CARDS?(n.setPaymentOptionAndType({paymentOption:dt.PAY_NOW,paymentType:at.UNKNOWN}),this.setState({selectedExternalWalletPaymentMethod:t})):t===at.INVOICE&&(n.setPaymentOptionAndType({paymentOption:dt.B2B_DEFERRED_PAYMENT,paymentType:at.INVOICE}),this.setState({selectedExternalWalletPaymentMethod:t})),n.analyticsEvent({type:Le.SELECT_PAYMENT});const o={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventLabel:"Not Set",eventAction:"PaymentSelected",ecommerce:{checkout:{actionField:{step:5},products:this.props.basketProducts?.map(r=>tn(r))}}};te.sendEvent({GA:o,WA:null})}shouldShowExternalWalletPaymentSelector(){const{isExternalWalletPaymentSelectorEnabled:t,externalWalletManagement:n}=this.props;return t&&n}setIsWaiting(){return new Promise(t=>{this.setState(n=>({isWaiting:!n.isWaiting}),()=>t())})}setFinancingProviderNotSelectedError(){this.setState({isFinancingProviderNotSelectedError:!0})}setUnresolvableCheckoutErrorAlert(t){const{intl:n}=this.props,o=n.formatMessage(t);this.setState({shouldShowUnresolvableErrorAlert:!0,checkoutErrorMessage:o})}toggleAgeConfirmationCheckbox(){const{actions:t}=this.props;this.state.ageConfirmed||t.analyticsEvent({type:Le.AGE_CHECK_CONFIRMED}),this.setState(n=>({ageConfirmed:!n.ageConfirmed,isAgeConfirmationError:!1}))}setAgeConfirmationError(){this.ageConfirmationFormRef.current?.scrollIntoView({block:"center",behavior:"smooth"}),this.setState({isAgeConfirmationError:!0})}scrollToPaymentSection(){this.paymentSectionRef.current.scrollIntoView({block:"center",behavior:"smooth"})}scrollToRecurringShoppingDefinitionCreateSection(){this.recurringShoppingSectionRef.current.scrollIntoView({block:"center",behavior:"smooth"})}scrollToBillingAddressSection(){this.billingAddressSectionRef.current.scrollIntoView({block:"center",behavior:"smooth"})}isSelectedRecurringShoppingDefinitionFrequencyDefined(t){return t.isRecurringOrdersEnabled&&!!t.selectedRecurringShoppingDefinitionCreateFrequency&&t.selectedRecurringShoppingDefinitionCreateFrequency!==er}sendVouchersAddedToOrderAnalyticsEvent(){const{actions:t,basketSummary:{vouchers:n}}=this.props,o=(n||[]).map(({voucherId:r})=>r);t.analyticsEvent({type:Le.VOUCHERS_ADDED_TO_ORDER,voucherIds:o})}sendSummaryToggledAnalyticsEvent(t){const{actions:n}=this.props,o=t?Fo.SUMMARY_COMPONENT_COLLAPSED:Fo.SUMMARY_COMPONENT_EXPANDED,r=t?"User collapsed the summary component":"User expanded the summary component";n.analyticsEvent({type:o,description:r})}toggleCollapsibleSummaryBoxState(t){const{expanded:n}=this.state;this.sendSummaryToggledAnalyticsEvent(n),t.preventDefault(),this.setState(o=>({expanded:!o.expanded}))}renderSpinner(){return s.jsx(_s.WithCustomCaption,{size:"l",className:"salt-m-t--32",children:this.formattedMessages.processingOrder})}isRecurringOrder(){const{order:t}=this.props;return!!t.order?.recurringShoppingDefinition}isOrderUnderEdit(){const{order:t}=this.props;return t.order?.editStatus==="UNDER_EDIT"}setPsp(t,n){this.setState({psp:t},()=>{n()})}renderPage(){const{basketSummary:t,pharmacyEnabled:n,order:o,totalBufferRate:r}=this.props,{psp:a,walletItemId:i,expanded:l,loadedViewPortSize:c,ageConfirmed:d,checkoutErrorMessage:u,shouldShowUnresolvableErrorAlert:p,isAgeConfirmationError:g,isUnsavedPaymentMethodSelected:E,pharmacyReady:y,isFinancingProviderNotSelectedError:I}=this.state;return!t.slot&&!t.isFetchingCheckoutBasket&&t.lastCheckoutBasketUpdated?s.jsx(Xee,{}):s.jsxs(xte.Provider,{value:{ageConfirmed:d},children:[s.jsx(bt,{title:"checkout.summary.title"}),s.jsx(dkt,{title:this.formattedMessages.title}),s.jsx("div",{className:"salt-m-x--2 salt-m-b--2",children:s.jsx(pLt,{shouldShowExternalWalletPaymentSelector:this.shouldShowExternalWalletPaymentSelector(),isSelectedRecurringShoppingDefinitionFrequencyDefined:this.isSelectedRecurringShoppingDefinitionFrequencyDefined(this.props),basketSummary:t,ageConfirmationFormRef:this.ageConfirmationFormRef,ageConfirmed:d,checkoutErrorMessage:u,isAgeConfirmationError:g,shouldShowUnresolvableErrorAlert:p,toggleAgeConfirmationCheckbox:this.toggleAgeConfirmationCheckbox,paymentSectionRef:this.paymentSectionRef,setSelectedWalletItem:this.setSelectedWalletItem,setSelectedPaymentMethodExternalWallet:this.setSelectedPaymentMethodExternalWallet,isBasketLoading:this.isBasketLoading(),recurringShoppingSectionRef:this.recurringShoppingSectionRef,psp:a,expanded:l,formattedMessages:this.formattedMessages,isUnsavedPaymentMethodSelected:E,scrollToPaymentSection:this.scrollToPaymentSection,scrollToRecurringShoppingDefinitionCreateSection:this.scrollToRecurringShoppingDefinitionCreateSection,loadedViewPortSize:c,setAgeConfirmationError:this.setAgeConfirmationError,setUnresolvableCheckoutErrorAlert:this.setUnresolvableCheckoutErrorAlert,toggleCollapsibleSummaryBoxState:this.toggleCollapsibleSummaryBoxState,walletItemId:i,setPsp:this.setPsp,paymentSession:this.paymentSession,billingAddressRef:this.billingAddressSectionRef,scrollToBillingAddressSection:this.scrollToBillingAddressSection,orderBillingAddress:{billingAddressId:o?.order?.billingAddressDetails?.billingAddressId,...o?.order?.billingAddressDetails?.addressDetails,...o?.order?.billingAddressDetails?.customerDetails},totalBufferRate:r,setFinancingProviderNotSelectedError:this.setFinancingProviderNotSelectedError,isFinancingProviderNotSelectedError:I,fetchCheckoutBasketWithDeliveryInfo:this.fetchCheckoutBasketWithDeliveryInfo})}),r&&s.jsx(ckt,{}),n&&y?s.jsx(MLt,{basket:t}):null,s.jsx(Ts,{}),s.jsx(V,{fixed:!0,children:s.jsxs(V.Item,{className:"md:salt-p-x--2",colSpan:{xs:12},children:[s.jsx(t_,{}),s.jsx(okt,{})]})}),s.jsx(tAt,{}),s.jsx(aDt,{})]})}openModalAdditionalDetails(){const{actions:t}=this.props;t.openAdditionalDetailsModal()}render(){const{isWaiting:t}=this.state,{isPaymentAuthenticationInModalEnabled:n}=this.props;return s.jsxs(ae.Fragment,{children:[t?this.renderSpinner():this.renderAdditionalDetailsPage(),n&&s.jsx(JLt,{paymentSession:this.paymentSession})]})}renderAdditionalDetailsPage(){return s.jsx(ae.Fragment,{children:this.props.additionalDetails.required&&this.props.additionalDetailsPopUpSummaryEnabled?s.jsx(_kt,{}):this.renderPage()})}};const xkt=e=>({basketProducts:ho(e)}),Akt=st({analyticsEvent:U.analyticsEvent,getCheckoutBasket:Yt.getCheckoutBasket,getConciergeDelivery:Ite.getConciergeDelivery,fetchActivePsps:fte.fetchActivePsps,fetchAvailablePaymentChecks:ej.fetchAvailablePaymentChecks,openCheckoutSummaryInvoiceModal:()=>J.openModal("checkoutSummaryInvoice"),openPaymentBufferModal:({openOnPageLoad:e})=>J.openModal("paymentBuffer",e),performanceMark:ds,openAdditionalDetailsModal:()=>J.openModal("additionalDetails"),addLoyaltyUnitsToBasket:Pg.addLoyaltyUnitsToBasket,removeVoucherFromBasket:NS.removeVoucherFromBasket,removedAppliedPaymentChecksFromBasket:rN.removedAppliedPaymentChecksFromBasket,removeLoyaltyUnitsFromBasket:Pg.removeLoyaltyUnitsFromBasket,getOrder:jo.getOrder,getRecurringShoppingDefinitions:mi.getRecurringShoppingDefinitions,fetchProductEntitiesFromBasket:Oc,setPaymentOptionAndType:Gt.setPaymentOptionAndType,fetchAdditionalDetailsRequired:xs.getRequiresAdditionalDetails,fetchOrderPaymentCheckoutSummary:qr.getPaymentCheckoutSummary,fetchOrderPaymentCheckoutSummaryWithPaymentMethodGroups:sr.getOrderPaymentCheckoutSummaryWithPaymentMethodGroups}),Rkt=we(xkt,Akt)(bkt),Dkt=D("pay.ew"),Okt=D("rec.o"),Pkt=D("pay.invoice"),Nkt=D("pb.pl"),Lkt=D("pay.check.use"),kkt=D("ag"),jkt=D("pay.pam"),Mkt=D("cs.phm"),wkt=D("sb.pop"),Fkt=D("pcs.v2"),Bkt=D("pay.ywlt"),Ukt=D("ord.def.col"),Gkt=()=>{const e=L(),t=Ge(),n=f(Dkt),o=f(Okt),r=f(Pkt),a=f(Nkt),i=f(Lkt),l=f(kkt),c=f(jkt),d=f(Mkt),u=f(wkt),p=f(tm),g=f(w=>is(w)),E=f(Xk),y=f(jE),I=f(Pxe),S=f(bV),C=f(wR),T=f(As),_=f(qv),A=f(K2),R=f($e("checkoutSummaryInvoice")),P=f(Fkt),N=f(Bkt),k=f(pte),M=f(Ukt);return s.jsx(ZAt,{children:s.jsx(Rkt,{intl:e,navigate:t,externalWalletManagement:n,isRecurringOrdersEnabled:o,isExternalWalletPaymentSelectorEnabled:r,isPaymentBufferModalOnLoadEnabled:a,isUsePaymentChecksEnabled:i,isAgeConfirmationEnabled:l,isPaymentAuthenticationInModalEnabled:c,pharmacyEnabled:d,additionalDetailsPopUpSummaryEnabled:u,locationPath:p,basketSummary:g,selectedRecurringShoppingDefinitionCreateFrequency:y,skipPaymentBufferModalOnPageLoad:I,removedPaymentChecks:S,appliedPaymentChecks:C,order:T,allRecurringDefinitions:_,additionalDetails:A,isCheckoutSummaryInvoiceModalOpen:R,totalBufferRate:E,isPaymentCheckoutSummaryV2Enabled:P,isYourWalletEnabled:N,paymentCheckoutSummaryIsFetching:k,isCollapseAllByDefaultEnabled:M})})},gse=()=>s.jsx(Et,{type:"CheckoutSummary::route",children:s.jsx(Gkt,{})});gse.fetchData=({context:{store:e}})=>e.dispatch(Km.getWalletItems());const $kt=()=>{const t={summaryRedirectWarningLinkText:L().formatMessage("checkout.3ds.summary.redirect.warning.link.text")},n=f(D("dcca")),{handlePaymentAuthenticationSuccess:o,canCheckout:r}=Sj(),a=Ge(),i=Ne(),[l,c]=h.useState(!1);h.useEffect(()=>{n?c(!0):r().finally(()=>c(!0))},[]);const d=({errorParam:u})=>a(vr({queryString:u}));return l?s.jsx(i_,{messageCallback:o,errorCallback:d,redirectUrlConfig:{url:vr(),text:t.summaryRedirectWarningLinkText},location:i}):s.jsx(_s,{size:"l",className:"salt-m-t--32"})},$0=()=>s.jsx(Et,{type:"CheckoutPaymentAuthenticationScene::route",children:s.jsx($kt,{})}),Hkt=({paymentAmountSplitPerMethods:e=[]})=>{const t=e.find(o=>o.paymentMethodCategory==="LOYALTY"),n=t&&t.total?t.total.amount:null;return n?s.jsx(kS,{action:()=>{},type:"payment-details-loyalty",readOnly:!0,children:s.jsx(b,{id:"checkout.summary.discounts.loyalty.redeemed",values:{loyaltyRedeemed:n}})}):null},Vkt=v(O)`
    max-inline-size: 100%;
`,zm=({paymentInfo:e,inline:t=!1})=>{const n=f(Tde),o=Wkt(e,n),{formatMessage:r}=L(),a=i=>{const{paymentMethodV2:l,cardType:c,lastFourDigits:d,expiryMonth:u,expiryYear:p,emailAddress:g}=i;if(l==="PAYPAL")return g?r("order.online.receipt.payment.accessibility.paypal",{emailAddress:g}):r("order.online.receipt.payment.accessibility.paypal.fallback");if(l?.includes("CARD")){if(!c&&!d&&!u&&!p)return r("order.online.receipt.payment.accessibility.card.fallback");if(c&&d&&u&&p)return r("order.online.receipt.payment.accessibility.card",{cardType:c,last4Digits:d,cardExpiryDate:`${u}/${p}`});let E="";if(c&&(E+=c),d){const y=r("order.online.receipt.payment.accessibility.cardEnding",{last4Digits:d});E+=(E?" ":"")+y}if(u&&p){const y=r("order.online.receipt.payment.accessibility.cardExpiryDate",{cardExpiryDate:`${u}/${p}`});E+=(E?" ":"")+y}return E}return l};return s.jsx(Vkt,{"data-test":"payment-info-label",children:t?s.jsxs(gn,{as:"span",direction:"row",align:"center",gap:["sm"],wrap:"nowrap",children:[o&&s.jsx(kg,{paymentInfo:e,iconAriaLabel:a(e)}),s.jsx(Ag,{paymentInfo:e})]}):s.jsxs(h.Fragment,{children:[o&&s.jsxs(h.Fragment,{children:[s.jsx(kg,{paymentInfo:e,iconAriaLabel:a(e)}),s.jsx("br",{})]}),s.jsx(Ag,{paymentInfo:e})]})})},Wkt=({paymentMethodV2:e,cardType:t},n)=>!(Ykt(e,n)||qkt({paymentMethodType:e,cardType:t})),Ykt=(e,t)=>{switch(e){case at.CASH_ON_DELIVERY:return!0;case at.INVOICE:return!t;default:return!1}},qkt=({paymentMethodType:e,cardType:t})=>e===at.CARDS&&t===void 0,Kkt=({paymentInfo:e})=>s.jsx(xe,{children:s.jsx(zm,{paymentInfo:e})}),zkt={paymentInfo:null},Ese=({paymentInfo:e})=>e?s.jsxs(xe,{"data-test":"payment-method",children:[s.jsx(ee,{as:"h2",className:"salt-m-b--4",children:s.jsx(b,{id:"checkout.complete.payment.title"})}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(Hkt,{paymentAmountSplitPerMethods:e.paymentAmountSplitPerMethods})}),s.jsx(Kkt,{paymentInfo:e})]}):null;Ese.defaultProps=zkt;const H0=({navigate:e})=>{const t=()=>{e(fn())};return s.jsxs(xe,{children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(O,{children:s.jsx(b,{id:"checkout.complete.action.buttons.header"})})}),s.jsx(x,{intent:"secondary",fill:!0,"data-test":"back-to-shop-button",onClick:t,children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.complete.back.to.shop"})})})]})},fse="mergeCartWithEditOrder",yse=Y(D("mcweo"),xc,(e,t)=>e&&!!t?.length),Ise=e=>{const t=F();return()=>{t(J.openModal(fse,{orderId:e})),t(U.analyticsEvent({type:Re.ADD_PRODUCT_TO_ORDER_MODAL_DISPLAYED,orderId:e}))}},wj=({redirectToDetails:e=!1})=>{const t=f(As),n=Ge(),o=t?.order,r=o?.orderId,i=f(is)?.checkoutCorrelationId,{formatMessage:l}=L(),c=F(),d=f($e(fse)),u=f(D("m.la.h")),p=async()=>{c(U.analyticsEvent({type:Re.CLOSE_BUTTON_CLICKED,checkoutCorrelationId:i})),c(J.closeModal())},g=async()=>{c(U.analyticsEvent({type:Re.NOT_NOW_BUTTON_CLICKED,orderId:r})),c(J.closeModal()),await c(Mi.getPendingOrders()),r&&await c(ji.editOrder(r,n,{redirectToDetails:e,mergeBasket:!1}))},E=async()=>{c(J.closeModal()),await c(Mi.getPendingOrders()),r&&await c(ji.editOrder(r,n,{redirectToDetails:e,mergeBasket:!0}))},y=f(Zt),I=f(Mt),S=X4({dateIsoFrom:o?.dates?.deliveryStartDate,dateIsoTo:o?.dates?.deliveryEndDate,timeZoneId:o?.dates?.timeZoneId||"UTC",dateFormat:y,timeFormat:I});return s.jsx(B,{isOpen:d,onRequestClose:p,children:s.jsxs(B.ModalForm,{"data-test":"merge-cart-with-edit-order-modal",children:[s.jsxs(B.Header,{align:u?"left":"center",children:[s.jsx(ee,{as:"h1","aria-hidden":!0,children:l("merge-cart-with-edit-order.merge-cart-modal.title")}),s.jsx(ie,{children:l("merge-cart-with-edit-order.merge-cart-modal.title.aria.label")})]}),s.jsx(B.Body,{children:l("merge-cart-with-edit-order.merge-cart-modal.alert.text",{date:S})}),s.jsxs(B.Footer,{align:u?"left":"center",className:"salt-gap-x--2",children:[s.jsx(x,{intent:"secondary",onClick:g,fill:!0,"data-test":"merge-cart-with-edit-order-modal-cancel-button",children:s.jsx(x.Text,{children:l("merge-cart-with-edit-order.merge-cart-modal.cancel-button")})}),s.jsx(x,{intent:"primary",onClick:E,fill:!0,"data-test":"merge-cart-with-edit-order-modal-confirm-button",children:s.jsx(x.Text,{children:l("merge-cart-with-edit-order.merge-cart-modal.confirm-button")})})]})]})})},Fj=({orderId:e,redirectToDetails:t=!1,sendPageView:n})=>{const o=L(),r=F(),a=Ge(),i=f(yse),l=ft(),[c,d]=h.useState(!1),u=f($e("editOrder")),[p,g,E]=Ee(["m.la.h","oed","nfchk"]),y=f(d2e),I=iet(),S=Qk(),C=Ck(),T="edit-order-modal-header",_=()=>{l({type:Gs.EDIT_ORDER_BUTTON_CLICKED,orderId:e,userAction:"Close"}),r(J.closeModal());const M={event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventLabel:"edit-order-clicked",eventAction:"EditOrderButtonClicked",ecommerce:{transactionId:e}};te.sendEvent({GA:M,WA:null})},A=(M,w)=>s.jsxs(Q,{wrap:"nowrap",className:"salt-m-t--4 salt-m-b--8",children:[s.jsx("div",{className:"salt-m-x--2",children:s.jsx(pe,{height:25,width:25,name:M})}),s.jsx(b,{id:w})]}),R=()=>{d(!c)},P=async()=>{await r(Mi.getPendingOrders()),await r(ji.editOrder(e,a,{redirectToDetails:t})),n&&C()},N=Ise(e),k=async()=>{I(c),r(J.closeModal()),l({type:Gs.EDIT_ORDER_BUTTON_CLICKED,orderId:e});const M={event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventLabel:"edit-order-clicked",eventAction:"EditOrderButtonClicked",ecommerce:{transactionId:e}};if(te.sendEvent({GA:M,WA:null}),i)N();else{l({type:Gs.EDIT_ORDER_GA4,orderId:e,groupId:S});const w={event:"edit_order",osp_transaction_id:e,group_id:S};te.sendEvent({GA:w,WA:null}),P()}};return s.jsxs(B,{isOpen:u,onRequestClose:_,aria:{labelledby:T},children:[s.jsx(B.Header,{align:p?"left":"center",children:s.jsx(ee,{as:"h2",id:T,children:o.formatMessage("edit.order.modal.title")})}),s.jsxs(B.Body,{children:[A("orders_edit","edit.order.modal.info.save.changes"),A("slot","edit.order.modal.info.save.slot"),A("payment_card",g&&y?"edit.order.modal.info.charged.or.refunded":"edit.order.modal.info.charged"),s.jsx(Te,{className:"salt-m-y--8",intent:"warning",text:s.jsx(b,{id:"edit.order.modal.warning"})}),E?s.jsx(fs.Checkbox,{label:o.formatMessage("edit.order.modal.checkbox"),"data-test":"edit-order-modal-checkbox",name:"edit-order-modal-checkbox",value:"edit-order-modal-checkbox",checked:c,onChange:R,className:"salt-m-l--2"}):s.jsx(Lo,{label:o.formatMessage("edit.order.modal.checkbox"),input:{checked:c,onChange:R},bold:!1,"data-test":"edit-order-modal-checkbox",className:"salt-m-l--2"})]}),s.jsxs(B.Footer,{align:p?"left":"center",className:"salt-gap-x--2",children:[s.jsx(x,{fill:!0,intent:"secondary",onClick:_,"data-test":"edit-order-cancel-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"edit.order.modal.cancel"})})}),s.jsx(x,{fill:!0,intent:"primary",onClick:k,"data-test":"edit-order-continue-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"edit.order.modal.continue"})})})]})]})},V0=()=>{const e=L(),t=F(),n=Ge(),o=f(Zt),r=f(Mt),a=f(n2e),i=f(GY);if(!a)return s.jsx(js.Skeleton,{});const{orderId:l,confirmOrderChangesBy:c,timeZoneId:d}=a;if(!c)return null;const u={editOrder:e.formatMessage("checkout.complete.edit.order"),editOrderUntil:e.formatMessage("checkout.complete.edit.order.until")},p=()=>{t(U.analyticsEvent({type:Gs.EDIT_ORDER_BUTTON_CLICKED,orderId:l}));const g={event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventLabel:"edit-order-clicked",eventAction:"EditOrderButtonClicked",ecommerce:{transactionId:l}};te.sendEvent({GA:g,WA:null}),t(i?ji.editOrder(l,n,{redirectToDetails:!0,mergeBasket:!1}):J.openModal("editOrder",{orderId:l}))};return s.jsxs(xe,{className:"salt-m-b--4",children:[s.jsx(O,{className:"salt-d--block",children:u.editOrderUntil}),s.jsx(O,{asChild:!0,size:"m",bold:!0,children:s.jsx("strong",{children:s.jsx(Gl,{dateIso:c,timeZoneId:d,local:!0,dateFormat:o,timeFormat:r})})}),qe.utc().isBefore(c)?s.jsx(x,{intent:"secondary",fill:!0,"data-test":"edit-order-button",onClick:p,className:"salt-m-t--4",children:s.jsx(x.Text,{children:u.editOrder})}):null,s.jsx(Fj,{orderId:l,redirectToDetails:!0}),s.jsx(wj,{redirectToDetails:!0})]})},Qkt=Ro(["loyalty","loyred"]),Xkt=D("pay.check.use"),Zkt=D("pay.check.show"),Jkt=Wn(["sumsub","bt.spl"]),ejt=D("cs.ps"),tjt=D("or.ph"),W0=e=>{const{paymentSummary:t,withTaxNote:n=!1,page:o}=e,r=t.deliveryPromotions,{paymentInfo:a}=t||{},{paymentAmountSplitPerMethods:i}=a||{},l=f(D("prp")),c=f(D("sib")),d=f(M=>TP(M)||0),u=f(M=>Qkt(M)),p=f(()=>_P),g=f(M=>Xkt(M)),E=f(M=>Zkt(M)),y=f(M=>Jkt(M)),I=f(M=>ejt(M)),S=f(M=>tjt(M)),C=f(M=>Ze(M,"seller-sales-enabled")==="true"),T=I?"always":"auto",_=M=>(i?.find(w=>w.paymentMethod===M)||{})?.total,A={paidByCheck:_("PAYMENT_CHECK"),paidByCard:_("CARDS"),paidByInvoice:_("INVOICE")},R=Number.isInteger(t.totalItems)?t.totalItems:d,P=!!Number(t?.savings?.amount),N=M=>()=>M.loyalty?.spent,k=()=>R?S?s.jsx(le.Items,{itemsRetailPrice:t.itemPriceAfterPromos||t.retailPrice,quantity:R,withTaxNote:n}):s.jsxs(h.Fragment,{children:[s.jsx(le.Items,{itemsRetailPrice:t.itemsRetailPrice||t.retailPrice,quantity:R,withTaxNote:n}),s.jsx(le.Savings,{savings:t.savings}),s.jsx(le.SavingsWithPaymentMethod,{savings:t?.paymentMethodSavingsPrice})]}):null;return s.jsxs(h.Fragment,{children:[s.jsxs(fe,{children:[k(),c&&P&&l&&!S&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),y&&!!Number(t.savings?.amount)&&!!t.itemPriceAfterPromos&&t.itemPriceAfterPromos?.amount!==t.finalPrice?.amount&&!S&&s.jsx(le.Subtotal,{value:t.itemPriceAfterPromos}),s.jsx(le.Promotions,{orderLevelPromotions:t.orderLevelPromotions}),s.jsx(le.Vouchers,{appliedVouchers:t.appliedVouchers||[],vouchersSavingsPrice:t.vouchersSavingsPrice}),s.jsx(le.Delivery,{delivery:t.delivery,withTaxNote:n,signDisplay:T}),C&&t.isPrimarySeller||!C?s.jsx(le.DeliveryPromotions,{isDeliveryPromotion:!!r?.[0]?.promoId,deliveryPromotions:r}):null,s.jsx(le.BagCharge,{carrierBag:t.carrierBag,withTaxNote:n,signDisplay:T}),s.jsx(le.PreparationCost,{preparationCost:t.preparation,withTaxNote:n,signDisplay:T}),s.jsx(le.Loyalty,{isLoyaltyRedeemEnabled:u,getLoyaltySpent:C?N(t):p}),s.jsx(le.Deposit,{depositsPrice:t.depositsPrice,withTaxNote:n,signDisplay:T}),s.jsx(le.EnvironmentalHandlingCharge,{environmentalHandlingPrice:t.environmentalHandlingPrice,withTaxNote:n,signDisplay:T}),s.jsx(le.Invoice,{invoice:t.invoice,withTaxNote:n,signDisplay:T}),s.jsx(le.SmallOrderCharge,{smallOrderPrice:t.smallOrder,thresholds:t.smallOrderChargeThresholds,withTaxNote:n,signDisplay:T,orderId:t.orderId,page:o})]}),s.jsx(le.Taxes,{finalPrice:t.finalPrice,components:t.taxComponents,withTaxNote:n}),g&&E&&i&&i.length>=1&&(A.paidByCheck||A.paidByInvoice)&&s.jsxs(h.Fragment,{children:[s.jsx(le.Separator,{}),s.jsx(fe,{"data-test":"summary-payment-list",children:s.jsx(le.PaymentChecks,{"data-test":"summary-payment-checks",paidByCheck:A.paidByCheck,paidByCard:A.paidByCard,paidByInvoice:A.paidByInvoice})})]}),C?s.jsx(fe,{"data-test":"summary-seller-total",children:s.jsx(le.Subtotal,{value:t.finalPrice,label:"summary.total"})}):s.jsx(le.Separator,{})]})},sjt=D("tx.nts"),njt=(e,t,n,o)=>e?{...t===e.sellerName?{isPrimarySeller:!0,paymentInfo:n.paymentInfo,appliedVouchers:n.appliedVouchers,bags:n.bags}:{appliedVouchers:[],isPrimarySeller:!1},sellerName:e.sellerName,totalItems:e.totalItems,savings:e.orderTotals?.promoSavings,itemsRetailPrice:e.orderTotals?.retailPrice,depositsPrice:e.orderTotals?.depositsPrice,environmentalHandlingPrice:e.orderTotals?.environmentalHandlingPrice,finalPrice:e.orderTotals?.finalPrice,totalPrice:e.orderTotals?.totalPrice,retailPrice:e.orderTotals?.retailPrice,vouchersSavingsPrice:e.orderTotals?.vouchersSavingsPrice,taxComponents:e.orderTotals?.taxesTotals?.taxes?.components,itemPriceAfterPromos:e.orderTotals?.itemPriceAfterPromos,carrierBag:e.charges?.carrierBag,delivery:e.charges?.delivery,deliveryPromotions:e.charges?.deliveryPromotions,invoice:e.charges?.invoice,orderLevelPromotions:e.orderPromotions,preparation:e.charges?.preparation,loyalty:e.loyalty,smallOrder:e.charges?.smallOrder,orderId:o}:null,ojt=D("mpv");function Y0({paymentSummary:e,orderId:t,expanded:n,setExpanded:o,isLoyaltyEarningEnabled:r,isLoyaltyEarningMovedToSummaryEnabled:a,primarySellerName:i}){const l=Ge(),c=L(),d=F(),u=He(),p=f(w=>bv(w)||[]),g=f(w=>Ms(w)),E=f(w=>Ze(w,"seller-sales-enabled")==="true"),y=f(w=>ojt(w)),I=f(sjt),[S]=f(Zk)||[],C=f(gte),T=w=>{const j=w?Fo.SUMMARY_COMPONENT_COLLAPSED:Fo.SUMMARY_COMPONENT_EXPANDED,G=w?"User collapsed the summary component":"User expanded the summary component";d(U.analyticsEvent({type:j,description:G}))},_=w=>{T(n),w.preventDefault(),o(!n)},A=()=>{l(cn(t))},R=h.useMemo(()=>tj(p,i,g),[p,i,g]),P=nte(),k=Sf()===0||!P;if(!e)return s.jsxs(Kt,{breakpoint:"sm-up",children:[s.jsx(js,{children:s.jsx(js.Skeleton,{})}),s.jsx(le.Buttons,{loading:!0})]});const M=y?C:e.totalPrice;return s.jsxs(cs,{expanded:n,onToggle:_,breakpoint:"sm-up",sticky:!0,stickyBarEnabled:k,aria:{contentLabel:c.formatMessage("summary.title"),totalPrice:M&&u(M)},children:[s.jsxs(cs.ControlSection,{children:[n?s.jsx(ee,{as:"span",children:c.formatMessage("summary.title")}):s.jsx(le.TotalInline,{loading:!e,totalPrice:M,withTaxNote:I},"total"),s.jsx(cs.ToggleSwitch,{},"toggleSwitch")]}),s.jsxs(cs.Content,{children:[E?R.map(w=>{const j=njt(w,i,e,t);return!j||!Number(j.totalPrice?.amount)&&!Number(j.totalItems)?null:s.jsxs(h.Fragment,{children:[s.jsx(tl,{groupName:j.sellerName,className:"salt-d--block salt-m-y--2"}),s.jsx(W0,{paymentSummary:j,withTaxNote:I,page:"order-confirmation"})]},w.sellerId)}):s.jsx(W0,{paymentSummary:e,withTaxNote:I,page:"order-confirmation"}),s.jsx(le.TotalSpaceBetween,{loading:!e,totalPrice:y?C:e.totalPrice,withTaxNote:I},"total")]}),s.jsxs("div",{children:[r&&a&&s.jsx("div",{className:"salt-p-t--2","data-test":"loyalty-earnings-summary",children:s.jsx(xu,{getQuantity:wd,allowZero:!0})}),y&&S&&s.jsx(fe,{children:s.jsx(OL,{amount:S.total.amount,currency:S.total.currency})}),s.jsx(le.Buttons,{children:s.jsx("div",{className:"salt-p-t--4",children:s.jsx(x,{intent:k?"primary":"secondary",fill:!0,onClick:A,"data-test":"view-order-button","data-synthetics":"view-order-button-on-summary",children:s.jsx(x.Text,{children:c.formatMessage("checkout.complete.view.order")})})})})]})]})}const rjt=({big:e})=>{const t=f($p);return s.jsx(O,{asChild:!0,size:"l",bold:!0,className:"salt-d--inline-block","data-test":"basket-reminder-title",children:e?s.jsx("h2",{children:s.jsx(b,{id:"checkout.complete.basket.reminder.title",values:{count:t}})}):s.jsx("strong",{children:s.jsx(b,{id:"checkout.complete.basket.reminder.title",values:{count:t}})})})},ajt=()=>{const e=Ge(),t=qm(),n=()=>{e(jt())};return s.jsx(x,{intent:"primary",fill:!0,onClick:n,"data-test":"basket-reminder-button",children:s.jsxs(x.Text,{children:[s.jsx(b,{id:"checkout.complete.basket.reminder.view.basket"})," ",t]})})},Sse=({big:e=!1})=>s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{className:"salt-d--flex",colSpan:{xs:12,sm:12,md:8},children:s.jsx(Q,{align:"center",children:s.jsx(rjt,{big:e})})}),s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:4},children:s.jsx(ajt,{})})]}),ijt=v.div`
    position: fixed;
    inset-block-end: 0;
    inset-inline: 0;
    max-block-size: calc(100% - var(--salt-spacing-16));
    inline-size: 100%;
    z-index: ${$t["collapsible-box"]};
`,Cse=()=>f($p)?s.jsx(ijt,{"data-test":"sticky-basket-reminder",children:s.jsxs(xe,{children:[s.jsx(Sse,{big:!0}),s.jsx(vE,{renderTo:"#StickyCollapsibleSummary",children:s.jsx(tv,{height:_z})})]})}):null;Cse.displayName="TrolleyBottomBar";const ljt=v(Q)`
    text-align: center;
`,cjt=({formattedMessages:e,orderId:t,className:n})=>s.jsx(ljt,{justify:"center",className:n,children:s.jsxs("div",{className:"salt-m-b--2 md:salt-m-b--0",children:[s.jsx(pe,{success:!0,name:"status_yes",height:42,width:42}),s.jsx(ee,{className:"salt-m-y--2",as:"h1",children:e.title}),s.jsx(O,{size:"m",children:`${e.orderReference}: ${t}`})]})}),vse=({isLoyaltyEarningEnabled:e,loyaltyEarnings:t,getLoyaltyEarned:n})=>!e||!t||t.units===0?null:s.jsx("div",{className:"salt-m-b--4",children:s.jsx(xj,{getQuantity:n})}),djt=()=>s.jsx(Te,{intent:"info","aria-live":"polite",text:s.jsx(b,{id:"canceled.recurring-order-definition.reference-box.text"})}),Rf=e=>{const{pathname:t}=Ne(),n=L(),o=F(),r=f(qv),a={recurringOrderCardTitleAccessibility:n.formatMessage("order.details.recurring.order.card.accessibility.title.label")},{deliveryWindow:i,frequency:l,name:c,definitionId:d}=e.recurringShoppingDefinition,u=Qd(i.dayOfWeekIso,Ja),p=i.from&&i.to?`${i.from} - ${i.to}`:"",g=e.alertType&&e.alertText,E=()=>{o(U.analyticsEvent({type:mt.RECURRING_ORDER_CARD_CLICKED}))},y=r.data.some(C=>C.definitionId===d);if(/\/checkout.*\/complete/.test(t)&&!y)return s.jsx(xe,{className:"salt-m-b--4",children:s.jsx(b,{id:"recurring.order.currently.not.visible"})});if(!y)return s.jsx("div",{className:e.className,children:s.jsx(djt,{"data-test":"created-from-deleted-recurring-order"})});const S=()=>s.jsxs(ae.Fragment,{children:[s.jsx(b,{id:`order.details.recurring.order.frequency.every.${l.value}.${l.unit.toLowerCase()}`}),`, ${u} ${p}`]});return s.jsx("div",{className:e.className,children:s.jsx(V,{flush:!0,children:s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(vs,{"data-test":"order-card-recurring",title:{text:c,as:"h2",a11yText:a.recurringOrderCardTitleAccessibility},description:S(),icon:"recurring_order",to:lo(),onClick:E,alertBanner:g?{intent:e.alertType||"action",text:e.alertText}:void 0},e.orderId)})})})},GA=({className:e="salt-m-b--4"})=>{let t="checkout.complete.express.collection.non.editable.alert";const n=f(t2e);return f(s2e)?null:(n&&(t="checkout.complete.noneditable.fast.delivery.order.message"),s.jsx(Te,{intent:"warning",className:e,text:s.jsx(b,{id:t})}))},ujt=({delivery:e,order:t,formattedMessages:n,getLoyaltyEarned:o,loyaltyEarnings:r,isRecurringOrdersEnabled:a,isLoyaltyEarningEnabled:i,isLoyaltyEarningMovedToSummaryEnabled:l,billingAddressManagementEnabled:c,isBasketProductOverviewEnabled:d,isProgressIndicatorEnabled:u,children:p})=>s.jsxs(V.Item,{colSpan:{xs:12,md:8},children:[!u&&s.jsx(GA,{}),u&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Q,{justify:"center",children:s.jsxs(xe,{className:"salt-m-b--2  md:salt-m-b--4",children:[s.jsx(O,{className:"salt-d--block",size:"l",asChild:!0,bold:!0,children:s.jsx("h2",{children:n.title})}),s.jsx(O,{className:"salt-d--block",size:"m",children:`${n.orderReference}: ${t?.order?.orderId}`})]})})}),d&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx(Tte,{isOrderConfirmation:!0})}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(fj,{orderId:t?.order?.orderId,delivery:e,canChangeDelivery:!1,showDeliveryPass:!0,isCompletedOrder:!0})}),a&&t?.order?.recurringShoppingDefinition&&s.jsx(Rf,{className:"salt-m-b--4",orderId:t.order.orderId,recurringShoppingDefinition:t.order.recurringShoppingDefinition,alertText:t.order.wasEdited?n.recurringOrderUpdatedAlert:n.recurringOrderCreatedAlert,alertType:"success"}),!l&&s.jsx(vse,{loyaltyEarnings:r,getLoyaltyEarned:o,isLoyaltyEarningEnabled:i}),c&&t.order&&s.jsx(yj,{isReadOnly:!0,orderBillingAddress:{billingAddressId:t?.order?.billingAddressDetails?.billingAddressId,...t?.order?.billingAddressDetails?.addressDetails,...t?.order?.billingAddressDetails?.customerDetails}}),p]}),pjt=({isRecurringOrdersEnabled:e,order:t,formattedMessages:n})=>!e||!t?.order?.recurringShoppingDefinition?null:s.jsx(Rf,{className:"salt-m-y--4",orderId:t.order.orderId,recurringShoppingDefinition:t.order.recurringShoppingDefinition,alertText:t.order.wasEdited?n.recurringOrderUpdatedAlert:n.recurringOrderCreatedAlert,alertType:"success"}),mjt=({className:e})=>f($p)?s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(xe,{className:e,"data-test":"basket-reminder-box",children:s.jsx(Sse,{})}),s.jsx(Ts,{})]}):null,hjt=se("GET_ORDER_CONFIRMATION_ADVERTS"),Tse=()=>({type:"API",payload:{url:"/v1/content?page=ORDER_CONFIRMATION",...hjt}}),lc={SMART_SHOP:"smart_shop",CUSTOMER_DEFINED:"customer_defined"},_se=()=>{const e=h.useRef(!1),t=h.useCallback(()=>{e.current=!0},[]);return{isGA4EventSent:e.current,setIsGA4EventSent:t}},bse=()=>{const e=!!(typeof window<"u"&&(window.Optanon||window.OneTrust)),t=f(vv),n=t?e:!0,[o,r]=h.useState(n),a=h.useCallback(()=>{r(!0)},[]);return h.useEffect(()=>{if(!(o||!t))return window.addEventListener("onetrustloaded",a),()=>window.removeEventListener("onetrustloaded",a)},[a,t,o]),o},gjt=(e,t)=>{const n=localStorage.getItem(rg);if(!n)return t&&Ue.api.pushError(new Error(`no locally stored ORDER_PURCHASE data for orderId: ${e}`)),null;try{return JSON.parse(n)}catch{return Ue.api.pushError(new Error("Could not parse local storage data for ORDER_PURCHASE event")),localStorage.removeItem(rg),null}},Ejt=(e,t)=>{const n=f(D("gtm.opfc")),o=f(D("cs.gosd")),r=bse(),a=h.useRef(!1),i=h.useCallback(()=>{if(a.current)return;o&&Ue.api.pushLog([`handler triggered for ORDER_PURCHASE. OrderId: ${e}.`],{level:Si.DEBUG});const l=gjt(e,o);l?.orderId===e?(t({type:Le.ORDER_PURCHASED,...l}),localStorage.removeItem(rg),a.current=!0,o&&Ue.api.pushLog([`ORDER_PURCHASE event sent correctly. OrderId: ${e}.`],{level:Si.DEBUG})):o&&Ue.api.pushError(new Error(`Missing data or wrong orderId (complete page orderId: ${e}) (ls orderId: ${l?.orderId} provided for ORDER_PURCHASE event`))},[e,o,t]);h.useEffect(()=>{if(!n||a.current)return;if(r){i();return}const l=5e3,c=200;let d=0;const u=setInterval(()=>{if(d+=c,r){clearInterval(u),i();return}d>=l&&(clearInterval(u),o&&Ue.api.pushError(new Error(`Timed out waiting for OneTrust for OrderId: ${e}`)))},c);return()=>clearInterval(u)},[r,i,n,o,e])},q0="oces",fjt=(e,t,n)=>{const o=f(D("cc.op")),[r,a]=Fp(),i=f(y=>Ki(y,e)),l=f(Oo),c=bse(),d=f(ts),u=f(or),p=f(Qs),g=f(Qr.server.getComputedState).metadata.hasCustomerSubscriptions,E=r.get(q0)==="1";h.useEffect(()=>{!e||E||i||n(e)},[n,e,E,i]),h.useEffect(()=>{!e||E||!i||!c||(t({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{ORDER_CONFIRM_ORDER_ID:e}}),o&&((async(I,S)=>{let C;if(S?.checkoutId&&(C=await ko.fetchAnalyticsMetadataByCheckoutId(S.checkoutId,l)),t({type:Le.ORDER_CONFIRMED,orderId:I,meta:C}),S){const T=Uct({wasEdited:!!S?.wasEdited,order:S});te.sendEvent({GA:T,WA:null}),Gct({order:i,productEntities:d,groupId:u,featuredProductCampaigns:p,hasDeliveryPass:g,meta:C}).forEach(A=>{te.sendEvent({GA:A,WA:null})})}})(e,i),r.set(q0,"1"),a(r,{replace:!0})))},[n,o,t,e,l,E,i,r,a,c,d,u,p,g])},yjt=({total:e})=>{const{formatMessage:t}=L(),n=He();return s.jsx(O,{children:`${t("summary.loyalty.units.name")}${` (${n(e)})`}`})},Ijt=({charged:e,refunded:t})=>{const{formatMessage:n}=L(),o=He(),r={charged:n("multipayment.loyalty.points.paid",{points:o(e)}),refunded:n("multipayment.loyalty.points.refunded",{points:o(t)})};return Number(e.amount)?s.jsx(O,{children:r.charged}):Number(t.amount)?s.jsx(O,{children:r.refunded}):null},xse=({className:e})=>{const{pathname:t}=Ne(),n=f(D("cc.lca")),o=f(Zk);if(!o||!o?.length)return null;const r=n&&!/\/orders\/\d*\/details$/.test(t);return s.jsx("div",{className:e,children:o.map(a=>{const{lastCheckoutAdjustment:{charged:i,refunded:l}}=a;return s.jsx(xe,{children:r?s.jsx(Ijt,{charged:i,refunded:l}):s.jsx(yjt,{total:a.total})},a.paymentId)})})},Ase=({className:e})=>{const t=f(mte);if(!t||!t?.length)return null;const n=o=>{const{paymentMethod:{type:r},fundingInstrument:a}=o;return{paymentMethodV2:r,nonSavedFundingInstrument:a?.nonSaved,cardType:a?.cardType,lastFourDigits:a?.lastFourDigits,expiryMonth:a?.expiryMonth,expiryYear:a?.expiryYear,emailAddress:a?.emailAddress}};return s.jsx("div",{className:e,children:t.map(o=>s.jsx(xe,{tabIndex:0,children:s.jsx(zm,{paymentInfo:n(o)})},o.paymentId))})},Sjt=()=>f(hte).length?s.jsxs(xe,{"data-test":"payment-method",className:"salt-m-b--4",tabIndex:0,children:[s.jsx(ee,{as:"h2",className:"salt-m-b--4",children:s.jsx(b,{id:"checkout.complete.payment.title"})}),s.jsx(Ase,{className:"salt-m-y--4"}),s.jsx(xse,{className:"salt-m-y--4"})]}):null,hp=[{id:"opt0",textKey:"checkout.complete.feedback.options.notSure",value:null,text:"Im not sure"},{id:"opt1",textKey:"checkout.complete.feedback.options.inNextWeeks",value:"1-2",text:"In the next 1-2 weeks"},{id:"opt2",textKey:"checkout.complete.feedback.options.afterWeeks",value:"2-3",text:"In the next 2-3 weeks"},{id:"opt3",textKey:"checkout.complete.feedback.options.afterWeeks",value:"3",text:"After 3 weeks"}],K0=e=>{const t=hp.findIndex(({id:r})=>r===e);if(t===-1)return null;const n=hp[t]?.textKey??"",o=hp[t]?.value??"";return{optionTextKey:n,optionPosition:t+1,optionValue:o}},z0=({orderId:e})=>{const[t]=Ee(["nfchk"]),[n,o]=h.useState(),r=F(),{formatMessage:a}=L(),i=()=>r(U.analyticsEvent({type:Le.TOAST_NOTIFICATION_DISPLAYED,description:"A toast notification was displayed",pageEventAttributes:{message:"Thank you for your feedback. Your response has been saved."}})),l=g=>{const{type:E,option:y,position:I}=g;r(U.analyticsEvent({type:E,pageEventAttributes:{optionSelected:y,positionSelected:I}}))},c=g=>{r(U.analyticsEvent({type:Le.SUBMIT_FEEDBACK_IMPRESSION,impression:g}))},d=()=>{Z.success("checkout.complete.feedback.notification.success")},u=g=>{const E=K0(g);E&&l({type:Le.SUBMIT_FEEDBACK_INTERACTION,option:a({id:E.optionTextKey},{numberOfWeeks:E.optionValue}),position:E.optionPosition}),o(g)},p=()=>{const g=K0(n);g&&(d(),l({type:Le.SUBMIT_FEEDBACK_BUTTON_CLICKED,option:a({id:g.optionTextKey},{numberOfWeeks:g.optionValue}),position:g.optionPosition}),i())};return h.useEffect(()=>{const g={ORDER_ID:e,OPTION_STRINGS:hp.map(({textKey:E,value:y})=>a({id:E},{numberOfWeeks:y}))};c(g)},[]),s.jsxs(xe,{children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(ee,{as:"span",children:s.jsx(b,{id:"checkout.complete.feedback.title"})})}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(O,{size:"l",children:s.jsx(b,{id:"checkout.complete.feedback.description"})})}),s.jsx("div",{className:"salt-m-b--4",children:t?s.jsx(fs.RadioGroup,{groupLabel:{text:a("checkout.complete.feedback.title"),isVisuallyConcealed:!0},name:"checkoutFeedback",value:n,onChange:u,radios:hp.map(({id:g,textKey:E,value:y})=>({value:g,label:s.jsx(b,{id:E,values:{numberOfWeeks:y}})}))}):s.jsx(Q,{direction:"column",gap:["xs"],children:hp.map(({id:g,textKey:E,value:y})=>s.jsx(Ao,{checked:n===g,"data-test":`checkout-complete-feedback-option-${g}`,value:g,label:"",last:!0,bold:!1,onChange:I=>u(I.target.value),disabled:!1,error:"",role:void 0,children:s.jsx(b,{id:E,values:{numberOfWeeks:y}})},g))})}),s.jsx(x,{intent:"secondary",fill:!0,"data-test":"checkout-complete-feedback-submit",disabled:!n,onClick:p,children:s.jsx(x.Text,{children:s.jsx(b,{id:"checkout.complete.feedback.buttons.submit"})})})]})},Cjt=e=>{const{customerSegments:t}=tO(e);return t.length?t.reduce((n,o)=>n.concat(o.shortCodes||""),"").includes("sho01"):!1},c_=()=>{const e=F(),t=f(V4e);h.useEffect(()=>{t.showRecurringOrderCreatedNotification&&(Z.success({key:"checkout.complete.recurring.order.confirmation.message",substitutions:{recurringOrderName:t.name}}),e(dS.hideRecurringOrderCreatedNotification()))},[t,e])},vjt=Ro(["loyalty","loyear"]),Tjt=D("loyear.csm"),_jt=D("rec.o"),bjt=D("cs.prind"),xjt=D("bam"),Ajt=D("cs.bpo"),Rse=D("mpv"),Rjt=D("cc.fb"),Djt=({isProgressIndicatorEnabled:e,order:t,isRecurringOrdersEnabled:n,isLoyaltyEarningEnabled:o,isLoyaltyEarningMovedToSummaryEnabled:r,getLoyaltyEarned:a,delivery:i,paymentSummary:l,loyaltyEarnings:c,actions:d,billingAddressManagementEnabled:u,isBasketProductOverviewEnabled:p,shouldFetchOrderConfirmationPageAdverts:g,shouldRenderHorizontalAdvertsOnOrderConfirmationPage:E,isOrderMultiPaymentsEnabled:y,isFirstTimeShopper:I,isOrderFeedbackEnabled:S})=>{const C=L(),T=Ge(),_=Ne(),A=h.useRef(!1),R=ps.parse(_.search).orderId,P=F(),{isGA4EventSent:N,setIsGA4EventSent:k}=_se(),[M,w]=h.useState(!1),[,j]=h.useState(!1);h.useEffect(()=>(localStorage.getItem("editRecurringOrderOption")===al.THIS_AND_FUTURE_ORDERS&&Z.success("edit.recurring.order.notification.text"),()=>{localStorage.removeItem("editRecurringOrderOption")}),[]),h.useEffect(()=>{j(!0)},[]),h.useEffect(()=>{n&&d.getRecurringShoppingDefinitions(),g&&d.getOrderConfirmationAdverts(),y&&d.getOrderMultiPayments(R)},[n,g,d,R,y]),Ejt(R,d.sendAnalyticsEvent),fjt(R,d.sendAnalyticsEvent,d.getOrder);const G=Bn(t.isFetching);h.useEffect(()=>{t.isFetching&&(A.current=!1);const q=G&&!t.isFetching,ne=G===void 0&&!t.isFetching;(q||ne)&&!A.current&&(d.performanceMark({name:Uxe}),A.current=!0)},[d,G,t.isFetching]),h.useEffect(()=>{if(!t.isFetching&&!t.fetchError&&!N&&t.order?.recurringShoppingDefinition){P(U.analyticsEvent({type:mt.RECURRING_ORDER_CREATED_GA4_EVENT,recurringShoppingDefinition:t.order.recurringShoppingDefinition,recurringOrderType:lc.CUSTOMER_DEFINED}));const ne={event:"recurring_order_creation",type:lc.CUSTOMER_DEFINED,frequency:wC(t.order.recurringShoppingDefinition.frequency)??"",slot_day:FC(t.order.recurringShoppingDefinition.deliveryWindow)??0,slot_start_time:t.order.recurringShoppingDefinition.deliveryWindow?.from,slot_end_time:t.order.recurringShoppingDefinition.deliveryWindow?.to};te.sendEvent({GA:ne,WA:null}),k()}},[P,N,t,k]),c_();const W=()=>l?y?s.jsx(Sjt,{}):s.jsx("div",{className:"salt-m-b--4",children:s.jsx(Ese,{paymentInfo:l.paymentInfo})}):null,H={heading:C.formatMessage("checkout.complete.header.heading"),title:C.formatMessage("checkout.complete.title"),summaryToggleSwitchOffLabel:C.formatMessage("summary.component.accessibility.toggle.switch.off.label"),summaryToggleSwitchOnLabel:C.formatMessage("summary.component.accessibility.toggle.switch.on.label"),summaryTitle:C.formatMessage("summary.title"),orderReference:C.formatMessage("checkout.complete.order.reference"),viewOrder:C.formatMessage("checkout.complete.view.order"),recurringOrderCreatedAlert:C.formatMessage("checkout.complete.recrurring.order.card.alert"),recurringOrderUpdatedAlert:C.formatMessage("checkout.complete.recurring.order.updated.card.alert")},K=s.jsx(ee,{as:"h1",children:H.heading}),X=()=>s.jsxs(ae.Fragment,{children:[s.jsx(bt,{title:"checkout.complete.page.title"}),e?s.jsx(ra,{completed:!0,overrideText:K}):K]});return R&&!t.fetchError?s.jsxs(h.Fragment,{children:[s.jsx(sn,{className:"salt-p-b--0",children:X()}),s.jsx("div",{className:"salt-p-x--2",children:s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsxs(V,{flush:!0,children:[!e&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(cjt,{className:"salt-m-t--4",formattedMessages:H,orderId:R})}),e&&s.jsxs(Kt,{breakpoint:"sm-up",remainInDom:!1,children:[!t?.order?.dates?.confirmOrderChangesBy&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(GA,{className:"salt-m-b--0 salt-m-t--2"})}),s.jsx(mjt,{className:t?.order?.dates?.confirmOrderChangesBy?"salt-m-b--4 salt-m-t--4":"salt-m-b--4"})]})]})}),s.jsxs(Kt,{breakpoint:"sm-up",remainInDom:!1,children:[s.jsx(ujt,{isLoyaltyEarningEnabled:o,isLoyaltyEarningMovedToSummaryEnabled:r,getLoyaltyEarned:a,loyaltyEarnings:c,formattedMessages:H,isProgressIndicatorEnabled:e,order:t,delivery:i,isRecurringOrdersEnabled:n,billingAddressManagementEnabled:u,isBasketProductOverviewEnabled:p,children:W()}),s.jsxs(V.Item,{colSpan:{xs:12,md:4},children:[s.jsx(V0,{}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(Y0,{paymentSummary:l,orderId:R,primarySellerName:t?.order?.primarySellerName,expanded:M,setExpanded:w,isLoyaltyEarningEnabled:o,isLoyaltyEarningMovedToSummaryEnabled:r})}),S&&I&&s.jsx("div",{className:"salt-m-b--4",children:s.jsx(z0,{orderId:R})}),s.jsx("div",{className:"salt-m-b--2 md:salt-m-b--0",children:s.jsx(H0,{navigate:T})})]})]}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(GA,{}),e&&s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Q,{justify:"center",children:s.jsxs(xe,{className:t?.order?.dates?.confirmOrderChangesBy?"salt-m-b--4 salt-m-t--2":"salt-m-b--4",children:[s.jsx(O,{className:"salt-d--block",size:"l",asChild:!0,bold:!0,children:s.jsx("h2",{children:H.title})}),s.jsx(O,{className:"salt-d--block",size:"m",children:`${H.orderReference}: ${t?.order?.orderId}`})]})})}),s.jsx(V0,{}),s.jsx(pjt,{isRecurringOrdersEnabled:n,order:t,formattedMessages:H}),o&&!r&&s.jsx(vse,{loyaltyEarnings:c,getLoyaltyEarned:a,isLoyaltyEarningEnabled:o}),W(),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(fj,{orderId:R,delivery:i,canChangeDelivery:!1,showDeliveryPass:!0,isCompletedOrder:!0})}),S&&I&&s.jsx("div",{className:"salt-m-b--4",children:s.jsx(z0,{orderId:R})}),s.jsx("div",{className:"salt-m-b--2 md:salt-m-b--0",children:s.jsx(H0,{navigate:T})}),s.jsx(Y0,{paymentSummary:l,orderId:R,primarySellerName:t?.order?.primarySellerName,expanded:M,setExpanded:w,isLoyaltyEarningEnabled:o,isLoyaltyEarningMovedToSummaryEnabled:r})]})}),e&&s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(Cse,{})}),E&&s.jsx(V.Item,{colSpan:{xs:12},"data-test":"horizontal-advert-container",children:s.jsx(tX,{page:"order-confirmation"})})]})})]}):s.jsx(En,{to:"/"})},Ojt=e=>({delivery:OE(e)||null,getLoyaltyEarned:wd,isLoyaltyEarningEnabled:vjt(e),isLoyaltyEarningMovedToSummaryEnabled:Tjt(e),isRecurringOrdersEnabled:_jt(e),order:As(e),paymentSummary:Nc(e)||void 0,loyaltyEarnings:wd(e)||null,isProgressIndicatorEnabled:bjt(e),billingAddressManagementEnabled:xjt(e),isBasketProductOverviewEnabled:Ajt(e),shouldFetchOrderConfirmationPageAdverts:aat(e),shouldRenderHorizontalAdvertsOnOrderConfirmationPage:iat(e),isOrderMultiPaymentsEnabled:Rse(e),isFirstTimeShopper:Cjt(e),isOrderFeedbackEnabled:Rjt(e)}),Pjt=st({getOrder:jo.getDecoratedOrderWithRecurringNotification,sendAnalyticsEvent:U.analyticsEvent,performanceMark:ds,getRecurringShoppingDefinitions:mi.getRecurringShoppingDefinitions,getOrderConfirmationAdverts:Tse,getOrderMultiPayments:qr.getOrderMultiPayments}),Dse=e=>s.jsx(Et,{type:"CheckoutComplete::route",children:s.jsx(Djt,{...e})});Dse.fetchData=({context:{store:e,url:t}})=>{const n=t.searchParams.get("orderId")??"",o=e.getState(),r=Rse(o),a=[e.dispatch(jo.getDecoratedOrderWithRecurringNotification(n))];return a.push(e.dispatch(Tse())),r&&a.push(e.dispatch(qr.getOrderMultiPayments(n))),n?Promise.all(a):null};const Njt=we(Ojt,Pjt)(Dse),Q0=D("cow"),Ljt=e=>[{path:"/checkout",Component:$s(Xe,e.Checkout,jt()),children:[{index:!0,Component:$s(Xe,Ic([{condition:sE,failComponent:Xee},{condition:t=>!Q0(t),failComponent:Zbt}],Zee),jt())},{path:"checkout-walk/:pageKey",Component:$s(Xe,as(Q0,Dxt,ot),jt())},{path:"summary",Component:$s(Xe,gse,jt())},{path:"complete",Component:$s(Xe,Njt,jt())},{path:"3ds",Component:$s(Xe,$0,jt())},{path:"3ds/continue",Component:$0},{path:"*",Component:ot}]}],kjt=!!(typeof window<"u"&&window.document?.createElement),jjt=typeof window<"u"?h.useLayoutEffect:h.useEffect,Mjt=(e,t)=>{const n=h.useRef(e);jjt(()=>{n.current=e},[e]),h.useEffect(()=>{if(!t&&t!==0)return()=>{};const o=setInterval(()=>n.current(),t);return()=>clearInterval(o)},[t])},wjt=()=>{const e=Z.getNotifications().find(t=>t.id===VI);return h.useCallback(()=>{e||Z.warning("basket.unavailable.data.error",{id:VI})},[e])},Fjt=()=>{const e=Z.getNotifications().find(t=>t.id===VI);return h.useCallback(()=>{e&&Z.close(VI)},[e])},Bjt=()=>{const e=f(AV),t=f(r=>r.data.basket.basketId),n=lte(),o=F();Mjt(async()=>{!kjt||!n||(Ue.api.pushError(new Error("Cart: Unavailable data"),{context:{cartId:t||"",unavailableData:JSON.stringify(e)}}),await o(Yt.getBasket()))},n?2e3:null)},Ujt=()=>{const e=lte(),t=Bn(e),n=wjt(),o=Fjt();h.useEffect(()=>{t!==e&&(e?n():o())},[t,e,n,o])},Gjt=()=>(Bjt(),Ujt(),null),Ose=ae.memo(({quantity:e,price:t,testId:n})=>s.jsx(ie,{"aria-live":"polite","aria-relevant":"text","aria-atomic":"true","data-test":n,children:s.jsx(b,{id:"header.topbar.basket.button.accessibility.label.price.shown",values:{quantity:e,price:t}})})),$jt=v.span`
    display: flex;
    place-content: center center;
    align-items: center;
    flex-direction: column;
    ${({breakpoint:e})=>re[br[e].mediaQueryKey]`
        flex-direction: row;
        column-gap: var(--salt-spacing-1);
    `}
`,Hjt=D("tx.nts"),Vjt=v(x.Text)`
    font-size: var(--salt-text-s-font-size);
`,Wjt=()=>{const e=Nm(Hjt),t=Cf(),n=qm(),o=JT();if(t||!o)return s.jsx(Kt,{as:"span",breakpoint:"sm-up",children:s.jsx(b,{id:"header.topbar.basket.button.text","data-test":"basket-text"})});const r=!e||Number(o?.amount??0)===0;return s.jsxs($jt,{breakpoint:"lg-up","aria-hidden":"true",children:[s.jsx("span",{"data-test":"basket-price",children:n}),!r&&s.jsx(Vjt,{"data-test":"basket-price-tax-note",children:s.jsx(b,{id:"price.tax.note.inclusive"})})]})},X0="basket-button-info-badge",Yjt=v(x)`
    position: relative;

    ${re.smUp`
        min-inline-size: ${$(90)};
    `}
`,qjt=v.div`
    position: absolute;
    inset-block-start: calc(var(--salt-spacing-2) * -1);
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
`,Kjt=v.div`
    position: absolute;
    inline-size: 100%;
    display: flex;
    justify-content: center;
    inset-block-start: calc(100% - var(--salt-spacing-2));
`,zjt=Pe`
    background-color: var(--intent-promotion);
    color: var(--intent-promotion-contrast);
`,Qjt=Pe`
    background-color: var(--intent-action-100);
    color: var(--intent-action-100-contrast);
`,Xjt=v(ln)`
    ${e=>e.intent==="action"&&Qjt};
    ${e=>e.intent==="promotion"&&zjt};
    max-block-size: ${$(14)};
    min-block-size: ${$(14)};
    min-inline-size: max-content;
`,Zjt=v(Ll)`
    background-color: ${e=>`var(--intent-${e.intent}-900)`};
    color: var(--intent-action-900-contrast);
`,Jjt=v.div`
    position: relative;
`,eMt=v(_s)`
    block-size: ${$(15)};
    inline-size: ${$(15)};

    &::before {
        border-color: var(--intent-content-100);
    }

    &::after {
        border-block-start-color: var(--intent-content);
    }

    &::before,
    &::after {
        block-size: ${$(15)};
        inline-size: ${$(15)};
        border-width: ${$(3)};
    }
`,Z0=()=>{const e=cte(),t=JT();return s.jsxs(h.Fragment,{children:[t?s.jsx(x.Icon,{className:`${e.hidePrice?"salt-d--block":"salt-d--none sm:salt-d--block"}`,name:e.name}):s.jsx(eMt,{className:"salt-d--block"}),s.jsx(Wjt,{})]})},Pse=()=>{const e=f(D("bt.spl")),t=Sf(),n=qm(),o=Cxt(),r=Txt(),a=cte(),i=_xt(),l=bxt(),c=xxt(),d=rte(),u=mxt(),p=e?u:d;return s.jsxs(h.Fragment,{children:[s.jsx(Ose,{quantity:t,price:n,testId:"basket-live-region"}),s.jsxs(Jjt,{children:[s.jsx(Yjt,{intent:l?"action":"secondary","aria-label":r,"data-test":"basket-button","data-icon":a.name,"data-synthetics":"basket-details-button",onClick:c.onClick,asChild:!!c.to,...o&&{"aria-describedby":X0},children:c.to?s.jsx(Ye,{intent:"ghost",to:c.to,children:s.jsx(Z0,{})}):s.jsx(Z0,{})}),s.jsx(Kjt,{children:o&&s.jsx(Xjt,{id:X0,intent:o.type,text:o.message,"data-test":o["data-test"],"data-synthetics":o["data-synthetics"]})}),s.jsx(qjt,{children:i&&s.jsx(Zjt,{count:i.value,intent:i.type,"data-synthetics":i["data-synthetics"],"data-test":i["data-test"],"aria-hidden":!!i["aria-hidden"]})})]}),s.jsx(Gjt,{}),p&&s.jsx("div",{"data-synthetics":"checkout-threshold"})]})},tMt=v("div")`
    display: flex;
    gap: var(--salt-spacing-4);
`,J0=v.div`
    display: flex;
    justify-content: space-between;
`,sMt=v(O)`
    color: var(--typography-promotion, var(--intent-promotion));
`,e$=v(O)`
    text-align: start;
`,nMt=()=>{const e=krt(),t=U7(),n=jrt();return!(!e||t||n)},oMt=()=>{const e=f(D("tx.nts")),t=f(D("prp")),n=f(D("sib")),o=f(Wn(["sumsub","bt.spl"])),r=L(),a=Kk(),i=qm(),l=ate(),c=gxt(),d=Nm(Hi),u=nMt(),p=r.formatMessage(o?"summary.subtotal":"summary.total"),y=o?"summary.subtotal.price.note":"summary.total.note";return s.jsxs(Q,{direction:"column",additionalCss:"flex: 1;",children:[d&&s.jsxs(h.Fragment,{children:[s.jsxs(J0,{children:[s.jsxs(e$,{size:"l",bold:!0,className:"salt-d--inline-block",children:[s.jsx("span",{"data-test":"expanded-trolley-total-title",children:p}),s.jsx(O,{size:"s","data-test":"expanded-trolley-total-note",className:"salt-m-l--1",bold:!0,children:s.jsx(b,{id:e?"price.tax.note.inclusive":y})})]}),s.jsx(O,{size:"l",bold:!0,children:i})]}),l&&s.jsxs(J0,{children:[s.jsx(e$,{size:"s","data-test":"expanded-trolley-savings",children:s.jsx(b,{id:"summary.savings"})}),s.jsx(sMt,{size:"s",children:c})]}),n&&t&&l&&s.jsx(ui,{className:"salt-d--block salt-m-y--2"})]}),s.jsxs(tMt,{className:"salt-m-t--2",children:[s.jsx(x,{intent:u?"secondary":"action",fill:!0,"data-test":"expanded-trolley-basket-button","data-synthetics":"expanded-trolley-basket-button","aria-label":r.formatMessage("basket.button.open.basket.page.alternative"),asChild:!0,children:s.jsx(Ye,{intent:"ghost",href:a,children:s.jsx(x.Text,{children:s.jsx(b,{id:"view.basket"})})})}),u&&s.jsx(Np,{})]})]})},rMt=()=>{const e=yo();return h.useCallback(()=>{e({type:Re.SMART_CART_BUTTON_CLICKED})},[e])},aMt=()=>{const e=L(),t=rMt();return s.jsx(x,{intent:"primary",onClick:t,fill:!1,"data-test":"expanded-trolley-instant-shop-button",asChild:!0,children:s.jsx(tt,{intent:"ghost",href:Og(),children:s.jsx(x.Text,{children:e.formatMessage("instant.shop.empty.trolley.button")})})})},iMt=v(pe)`
    margin-inline-end: var(--salt-spacing-2);
`,lMt=()=>{const e=L(),t=AT();return s.jsxs("div",{"data-test":"expanded-trolley-empty-state",children:[s.jsxs(Q,{justify:"center",align:"center",wrap:"nowrap",className:"salt-m-t--8",children:[s.jsx(iMt,{name:"trolley",width:15,height:15}),s.jsx(ee,{as:"h2",children:e.formatMessage("basket.empty.message")})]}),s.jsx(Q,{justify:"center",align:"center",wrap:"nowrap",className:"salt-m-t--4",children:t?s.jsx(aMt,{}):s.jsx(O,{size:"l",children:e.formatMessage("empty.trolley.info.message")})})]})},cMt=()=>{const e=L(),{loadingState:t}=LO();return t===dl.INITIAL?null:s.jsx(ie,{children:s.jsx(O,{"data-test":"expanded-trolley-loading-state","aria-live":"polite","aria-relevant":"text","aria-atomic":"true",children:e.formatMessage(t===dl.LOADING?"expanded.trolley.items.loading.state":"expanded.trolley.items.loaded.state")})})},dMt=v("div")`
    max-inline-size: 100%;
`,uMt=(e,{threshold:t=0,root:n=null,rootMargin:o="0%",freezeOnceVisible:r=!1})=>{const[a,i]=h.useState(void 0),l=a?.isIntersecting&&r,c=([d])=>{i(d)};return h.useEffect(()=>{const d=e?.current;if(!!!window.IntersectionObserver||l||!d)return()=>{};const p={threshold:t,root:n,rootMargin:o},g=new IntersectionObserver(c,p);return g.observe(d),()=>g.disconnect()},[e,n,o,l,t]),a},pMt=(e,t,n,o)=>{const r=h.useRef(null),[a,i]=h.useState(!!t),l=uMt(r,{root:n,freezeOnceVisible:!0}),c=h.useMemo(()=>!!l?.isIntersecting,[l]);return h.useEffect(()=>{!c||a||(i(!0),o(e))},[a,c,o,e,i]),r},mMt={landscape:{image:{resolution:{width:88,height:88},paddings:{top:"md",bottom:"md",right:"xs",left:"xs"}},title:{numberOfLines:1},controlsContainer:{position:"priceLine"},bottomAttributes:{ratingBadgeOrBoughtDate:!1,maxLifestyleIcons:0},price:{direction:"column",fontSize:"l",strikethrough:"s"},footerContainer:{inBasketBackground:!1},divider:!1,topAttributes:{favorite:!1,featured:!1,list:!1,regulars:!1},unitPrice:null,countryOfOrigin:null,packSize:{fontSize:"m",position:Op.OWN_LINE},promotion:{numberOfLines:2,compress:!0}}},Nse=({item:e,root:t,loadItemData:n,position:o})=>{const a=f(mo)[e.productId],i=pMt(e.productId,a,t,n);return s.jsx(dMt,{ref:i,"data-test":"expanded-trolley-list-item",className:"salt-m-y--2",children:s.jsx(ea,{displayLandscapeLayout:!0,position:o,fopPositionOnPage:o,product:a,page:"expanded-trolley",subPage:null,noOfferLink:!1,type:"basket",overrideConfig:mMt,loading:!a,group:{type:"unknown",section:"unknown",name:"",products:[],clusterBreadcrumbs:[]}})})},hMt=({innerRef:e})=>{const t=jO(),n=CE();return s.jsx(h.Fragment,{children:n.map((o,r)=>s.jsx(Nse,{item:o,root:e?.current,loadItemData:t,position:r+1},o.productId))})},gMt=({innerRef:e})=>{const t=jO(),n=CE(),o=f(_C);return s.jsx(h.Fragment,{children:o.map(({groupName:r,items:a},i)=>s.jsxs(h.Fragment,{children:[s.jsx(tl,{groupName:r,className:`salt-d--block salt-m-t--${i>0?4:2}`}),a.map((l,c)=>{const d=n.find(u=>u.productId===l);return d?s.jsx(Nse,{item:d,root:e?.current,loadItemData:t,position:c+1},l):null})]},r))})},EMt=()=>{const{formatMessage:e}=L(),t=h.useRef(null),n=f(Hi),o=f(Oo),{viewCartGa4Event:r}=V7(),{data:a,canSendEvent:i,setIsEventSent:l}=W7();h.useEffect(()=>{i&&o&&((async()=>{const u=await ko.fetchAnalyticsMetadataByActiveCart(o);await r({payload:a,cartType:"expanded",meta:u})})(),l())},[i,l,r,a,o]);const c=f(d=>Ze(d,"seller-sales-enabled")==="true");return s.jsx("div",{ref:t,"data-retailer-anchor":"expanded-trolley-content",children:n?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(ee,{as:"h2",children:e("catalogue.products.heading")})}),s.jsx(cMt,{}),c?s.jsx(gMt,{innerRef:t}):s.jsx(hMt,{innerRef:t})]}):s.jsx(lMt,{})})},fMt=()=>{const e=L(),t=Sf(),n=e.formatMessage("header.topbar.basket.button.text"),o=e.formatMessage("shopping.list.card.number.of.items",{numberOfItems:t});return s.jsxs(h.Fragment,{children:[s.jsx(_E,{location:jt(),text:e.formatMessage("basket.button.open.basket.page.alternative"),testId:"expanded-trolley-basket-skip-link"}),s.jsx(O,{asChild:!0,size:"l",bold:!0,id:"drawer-title","aria-label":e.formatMessage("expanded.trolley.close.button.alternative"),children:s.jsx("h1",{children:`${n} (${o})`})})]})},yMt=()=>{const e=L(),t=f($e(pg)),n=Iz(),o=Sf(),r=e.formatMessage("shopping.list.card.number.of.items",{numberOfItems:o}),a=qm();return c0e(),d0e(),s.jsxs(B,{isOpen:t,onRequestClose:n,aria:{label:`${e.formatMessage("expanded.trolley.alternative")} (${r})`},data:{test:"expanded-trolley-drawer"},skipFocusFirst:!0,condensed:!0,context:"drawer",children:[s.jsx(B.Header,{align:"left",children:s.jsx(fMt,{})}),s.jsx(B.Body,{className:"salt-p-y--0",children:s.jsx(EMt,{})}),s.jsx(B.Footer,{children:s.jsx(oMt,{})}),s.jsx(Ose,{quantity:o,price:a,testId:"expanded-trolley-live-region"})]})},IMt=()=>{const[e,t]=h.useState(dl.INITIAL),n=h.useMemo(()=>({loadingState:e,setLoadingState:t}),[e]);return s.jsx("div",{"data-test":"expanded-trolley","data-synthetics":"expanded-trolley",children:s.jsxs(yz.Provider,{value:n,children:[s.jsx(Pse,{}),s.jsx(yMt,{}),s.jsx(fT,{})]})})},SMt=({basketSummary:e})=>{const{onConfirmCheckout:t,isCheckoutLoading:n}=GX(e);return n?null:s.jsx(_E,{location:"/checkout",testId:"checkout-skip-link",text:s.jsx(b,{id:"basket.summary.checkout"}),onClick:t})},CMt=({className:e})=>{const t=f(Wn(["bt.spl","bt.cart"])),n=zk(),o=e_(),r=Ixt(),a=!o||r,i=f(c=>is(c)),l=Iz(!1);return l0e(l),s.jsxs("div",{className:e,children:[a&&s.jsx(SMt,{basketSummary:t?void 0:i}),n?s.jsx(IMt,{}):s.jsx(Pse,{})]})},vMt=({modalName:e=Rr,onModalClose:t,onAddressSave:n})=>{const o=F(),r=f($e(e)),a=Bs(),i=()=>{t(),a.cancelButtonClicked("cross icon"),o(J.closeModal())},l=()=>{n("",""),o(J.closeModal())};return s.jsx(B,{isOpen:r,onRequestClose:i,children:s.jsx(B.Body,{children:s.jsx(j9,{onConfirm:l})})})},Lse=(e,t)=>{const n=e.latitude,o=e.longitude,r=t.latitude,a=t.longitude,i=6371,l=(r-n)*(Math.PI/180),c=(a-o)*(Math.PI/180),d=.5-Math.cos(l)/2+Math.cos(n*(Math.PI/180))*Math.cos(r*(Math.PI/180))*(1-Math.cos(c))/2;return i*2*Math.asin(Math.sqrt(d))},kse=e=>{if(e.type==="click")return typeof e.target.className=="string"&&e.target.className.includes("Fill")?"unfocusedArea":"cross";if(e.type==="keydown")return"escape"},MS=e=>({lat:e.latitude,lng:e.longitude}),TMt=e=>({latitude:e.lat,longitude:e.lng}),Bj=e=>!e.addressLine2||e.addressLine2==="",_Mt=(e,t)=>{t(Di.getDeliveryDestinationDeliverability(e)).then(n=>{const{postalCode:o,longitude:r,latitude:a,name:i,formattedAddress:l}=e;return t(Di.prepareTemporaryDeliveryDestination({name:i,coordinates:{latitude:a,longitude:r},postalCode:o,formattedAddress:l,deliveryMethod:"HOME_DELIVERY",deliveryType:"BRANDED_VAN",deliverability:n.payload.responseData.deliverability}))})},d_=e=>t=>t(Di.getDeliveryDestinationDeliverability(e)).then(n=>n.payload.responseData),jse=e=>t=>e(Di.getTemporaryDeliveryDestination(t.payload.responseData)),bMt=e=>t=>e(hn.openChangeDeliveryDestinationConfirmationModal(Fd,t.payload.responseData)),xMt=(e,t)=>t(Di.createTemporaryDeliveryDestination(e)).then(jse(t)).then(bMt(t)),AMt=(e,t)=>t(Di.createTemporaryDeliveryDestination(e)).then(jse(t)),RMt="select-candidate-address-back";function DMt({onBack:e,children:t}){return s.jsx(sT,{titleTextId:"addresses.select-candidate-address.title",headingTextId:"addresses.select-candidate-address.heading",buttonTestId:RMt,onBack:e,children:t})}const{RadioIconOff:OMt,RadioIconOn:PMt}=Pa,NMt="select-candidate-address-warning",LMt="select-candidate-address-item",kMt="select-candidate-address-submit",jMt=v(Te).withConfig({shouldForwardProp:e=>!["isVisible"].includes(e)})`
    visibility: ${({isVisible:e})=>e?"visible":"hidden"};
`,MMt=v(Q)`
    align-items: center;
`;function wMt({addresses:e,onSubmit:t,onBack:n}){const o=()=>l.findIndex(d=>d),r=Bs();h.useEffect(()=>{r.selectAddressModalDisplayed(e.length-1)},[]);const a=()=>{const d=o();d!==-1&&t(d)},i=d=>{c(u=>{const p=u.map(()=>!1);return p[d]=!0,p})},[l,c]=h.useState(e.map((d,u)=>e.length===1?u===0:u===1));return s.jsxs(DMt,{onBack:n,children:[s.jsx(O,{className:"salt-m-y--8 salt-d--block",children:s.jsx(b,{id:"addresses.select-candidate-address.option-selection"})}),s.jsx(jMt,{showIcon:!1,intent:"warning","data-test":NMt,text:s.jsx(b,{id:"addresses.select-candidate-address.original-address-warning"}),className:"salt-m-b--4",isVisible:o()===0}),s.jsx(Be,{inline:!1,role:"listbox",tabIndex:0,className:"salt-m-b--8",children:e.map((d,u)=>s.jsx(Be.Item,{role:"option","aria-selected":l[u],onFocus:()=>i(u),tabIndex:0,"data-test":LMt,children:s.jsxs(Q,{className:"salt-m-b--8",direction:"column",children:[s.jsxs(MMt,{children:[l[u]?s.jsx(PMt,{name:"radio_on",className:"salt-m-r--0"}):s.jsx(OMt,{name:"radio_off",className:"salt-m-r--0"}),s.jsx(O,{bold:!0,className:"salt-m-l--2",children:u===0?s.jsx(b,{id:"addresses.select-candidate-address.original-address"}):s.jsx(b,{id:"addresses.select-candidate-address.found-address"})})]}),s.jsx(O,{className:"salt-m-l--8 salt-d--block",children:d.formattedAddress})]})},u))}),s.jsx(x,{fill:!0,onClick:a,intent:"primary","data-test":kMt,children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.select-candidate-address.submit"})})})]})}const FMt="confirm-address-map-back";function BMt({onBack:e,children:t}){return s.jsx(sT,{titleTextId:"addresses.confirm-address-map.title",headingTextId:"addresses.confirm-address-map.heading",onBack:e,buttonTestId:FMt,children:t})}const UMt=["geometry"],t$="react-google-map",Mse=()=>{const e=es("google-maps-api-key"),t=f(o=>Eq(o)),n=f(o=>fq(o));return{...Lce({id:`${t$}-script`,googleMapsApiKey:e,language:t,region:n,version:"3.53",libraries:UMt}),reactMapId:t$}},GMt=v.button`
    cursor: pointer;
    user-select: none;
    border-radius: 2px;
    border: none;
    background: white;
    block-size: 40px;
    inline-size: 40px;
    margin-inline-end: 10px;
    padding: 0;
`,$Mt=v(pe)`
    vertical-align: middle;

    svg {
        fill: #666;
        block-size: 40px;
        inline-size: 40px;
        padding: 8px;
    }

    svg:hover {
        fill: #333;
    }
`,HMt=5*60*1e3,VMt=()=>{const[e,t]=h.useState(),[n,o]=h.useState(!1),[r,a]=h.useState(!1);return h.useEffect(()=>{wse(i=>{t(i),a(!0)},()=>{o(!0),a(!0)})},[]),{geoLocation:e,geoLocationError:n,isGeoLocationRequested:r}},wse=(e,t)=>{const n=o=>{const r={lat:o.coords.latitude,lng:o.coords.longitude};e(r)};navigator.geolocation?navigator.geolocation.getCurrentPosition(n,t,{maximumAge:HMt}):t()},WMt=(e,t)=>s.jsx(GMt,{onClick:e,"aria-label":t,children:s.jsx($Mt,{name:"map_location"})}),YMt=(e,t,n,o)=>{const a=document.createElement("div"),i=o.formatMessage("delivery.collection.map.location.button.accessibility"),l=s.jsx(gR,{store:n,children:WMt(t,i)});lR.createRoot(a).render(l),e.controls?.[9]?.push(a)},qMt=()=>s.jsx("svg",{viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C15.7855 2 18.8691 5.00478 18.9959 8.75935L19 9C19 12.3333 16.6667 16.6667 12 22C7.33333 16.6667 5 12.3333 5 9L5.00406 8.75935C5.1309 5.00478 8.21455 2 12 2ZM12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6Z"})}),KMt=v("div")`
    padding: inherit;
    position: absolute;
    z-index: 1000;
    inline-size: 100%;
    block-size: 100%;
    pointer-events: none;

    svg {
        fill: var(--intent-primary);
        position: relative;
        inset-block-start: calc(50% - 45px);
        inset-inline-start: calc(50% - 25px);
        inline-size: 50px;
        block-size: 50px;
    }
`,zMt=h.forwardRef(({height:e="100%",center:t,zoom:n=17,interactive:o=!1,showGeolocationButton:r=!1,showZoomButtons:a=!0,showFixedMarker:i=!1,onBoundsChanged:l=()=>{},onGeolocationError:c=()=>{},onCenterChanged:d,children:u},p)=>{const{isLoaded:g,reactMapId:E}=Mse(),y=Yd(),I=L(),S=Bs(),C=h.useRef(),T=h.useRef(n),_=()=>{if(!C.current)return;const j=T.current,G=C.current.getZoom()||0;G>j?S.zoomButtonClickedEvent("zoomIn"):G<j&&S.zoomButtonClickedEvent("zoomOut"),T.current=G},A=()=>{if(!C||!C.current)return;const j=C.current.getZoom()||0;C.current.setZoom(j+1)},R=()=>{if(!C||!C.current)return;const j=C.current.getZoom()||0;C.current.setZoom(j-1)},P=()=>{S.locateMeButtonClickedEvent(),wse(j=>{!C||!C.current||C.current.panTo(j)},c)},N=()=>{P()},k=j=>{!C||!C.current||C.current.panTo(j)},M=()=>{if(!C||!C.current)return;const j=C.current.getCenter();if(!j)return;const G={lat:j.lat(),lng:j.lng()};d&&d(G)},w=j=>{C.current=j,r&&YMt(j,()=>N(),y,I),t&&j.setCenter?.(t)};return p&&(p.current={zoomIn:A,zoomOut:R,geolocate:P,setCenter:k}),g?s.jsxs(ae.Fragment,{children:[i&&s.jsx(KMt,{"data-test":"custom-marker-container",children:s.jsx(qMt,{})}),s.jsx(fH,{id:E,mapContainerStyle:{height:e},options:{fullscreenControl:!1,cameraControl:!1,streetViewControl:!1,mapTypeControl:!1,clickableIcons:!1,keyboardShortcuts:o,zoomControl:a&&o,gestureHandling:o?"auto":"none"},zoom:n,onZoomChanged:_,onLoad:w,onBoundsChanged:l,onCenterChanged:M,children:u})]}):s.jsx(_e,{"data-test":"placeholder",height:e})}),Uj=h.memo(zMt),QMt="confirm-address-map-submit";function Fse({address:e,onSubmit:t,onBack:n}){const o=Bs(),[r,a]=h.useState(e.location),i=()=>{t(r)},l=d=>{a({latitude:d.latLng?.lat(),longitude:d.latLng?.lng()})},c=()=>{Z.error("delivery.collection.alert.location.permission.blocked")};return h.useEffect(()=>{o.confirmAddressModalDisplayed()},[]),s.jsxs(BMt,{onBack:n,children:[s.jsxs(Q,{direction:"column",className:"salt-m-t--8 salt-m-b--4",children:[s.jsx(O,{bold:!0,children:e.formattedAddress}),s.jsx(O,{className:"salt-m-t--4",children:s.jsx(b,{id:"addresses.confirm-address-map.adjust-pin"})})]}),s.jsx(Uj,{height:"300px",center:MS(r),showGeolocationButton:!0,onGeolocationError:c,interactive:!0,children:s.jsx(yh,{position:MS(r),draggable:!0,onDragEnd:l})}),s.jsx(x,{fill:!0,onClick:i,intent:"primary","data-test":QMt,className:"salt-m-t--8",children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.confirm-address-map.submit"})})})]})}const XMt="confirm-created-address-back";function ZMt({onBack:e,children:t}){return s.jsx(sT,{titleTextId:"addresses.confirm-created-address-map.title",headingTextId:"addresses.confirm-created-address-map.heading",onBack:e,buttonTestId:XMt,children:t})}function u_({address:e,showWarningIfAddressLine2Empty:t=!0,showMap:n=!0,showDeliveryInstructions:o=!1,showAddressLine2:r=!0,addressLine2Label:a,isAddressLine2Required:i=!1,onSubmit:l,onEdit:c,onBack:d}){const u=Bs(),p=e.location?MS(e.location):void 0,g=Bj(e.addressDetails),E={formattedAddress:e.formattedAddress,additionalInformation:"",nickname:"",notes:"",addressLine2:e.addressDetails.addressLine2};return h.useEffect(()=>{u.saveAddressModalDisplayed(g)},[]),s.jsx(ZMt,{onBack:d,children:s.jsxs(h.Fragment,{children:[n&&p&&s.jsx(Uj,{height:"200px",center:p,children:s.jsx(yh,{position:p,clickable:!1})}),s.jsx(C9,{texts:E}),r&&t&&g&&s.jsx(Te,{showIcon:!1,intent:"warning","data-test":"addressLine2-empty-warning",text:s.jsx(b,{id:"addresses.confirm-created-address-map.warning"})}),s.jsx(oT,{showAddressLine2:r,addressLine2Label:a,isAddressLine2Required:i,showDeliveryInstructions:o,defaultValues:E,submitLabelId:"addresses.confirm-created-address-map.submit",onEdit:c,onSubmit:l})]})})}const Bse=({actions:e,onConfirm:t,onVisibleComponentChange:n})=>{const o=Bs(),r=L(),a=qE(),i=!f(D("daddi")),[l,c]=h.useState([]),[d,u]=h.useState(),[p,g]=h.useState(),[E,y]=h.useState(""),[I,S]=VN(E,"MANUAL_FORM_MAP"),{addressGeocoding:C,addressLookup:T,postCustomerAddresses:_,getDeliverability:A}=e,[R,P]=h.useState("FORM"),N=f(cE),k=f(Ms),M=N[0],w=r.formatMessage(`address.form.field.country.name.${M}`);h.useEffect(()=>{n(R)},[R]);const j=oe=>{S(oe);const ye={...oe,country:w};u(ye),Promise.all([C(ye,M),T(ye,M,5)]).then(([he,Ie])=>{const Fe=[he,...Ie];c(Fe),P("SELECT_CANDIDATE_ADDRESS")}).catch(()=>{Z.error("settings.address.book.add.modal.search.no.addresses")})},G=oe=>{const ye=l[oe];g(ye),y(ye.lookupId),oe===0?(o.selectAddressModalClosed("selectAddress","original",oe+1),P("CONFIRM_ADDRESS_MAP")):K(ye).then(he=>{const Ie=he==="DELIVERABLE";o.selectAddressModalClosed("selectAddress","found",oe+1,Ie)})},W=oe=>{const ye={...p,location:oe};g(ye),K(ye).then(he=>{const Ie=he==="DELIVERABLE",Fe=Lse(p.location,oe);o.confirmAddressModalClosed("confirmAddress",Fe,Ie)})},H=oe=>{const ye={...p,addressName:oe.nickname,deliveryInstructions:oe.notes,formattedAddress:oe.formattedAddress,language:k,countryCode:M,addressDetails:{...p.addressDetails,addressLine2:oe.addressLine2},location:p.location,lookupId:p.lookupId};_(ye).then(he=>a(he.addressId)).then(({addressId:he,deliveryDestinationId:Ie})=>{t&&t(he,Ie)}).catch(()=>{Z.error("toast.notification.generic.error")})},K=oe=>A({postalCode:oe.addressDetails.postalCode,latitude:oe.location.latitude,longitude:oe.location.longitude}).then(({deliverability:ye})=>(ye==="DELIVERABLE"?P("CONFIRMATION_FORM"):Z.error("settings.addresses.alert.nondeliverable"),ye)).catch(()=>{Z.error("toast.notification.generic.error")}),X=()=>{o.saveAddressModalClosed("editAddress"),P("FORM")},q=()=>{o.saveAddressModalClosed("back"),P("SELECT_CANDIDATE_ADDRESS")},ne=()=>{o.selectAddressModalClosed("back"),P("FORM")},ue=()=>{o.confirmAddressModalClosed("back"),P("SELECT_CANDIDATE_ADDRESS")};switch(R){case"CONFIRMATION_FORM":return s.jsx(u_,{address:p,onEdit:X,onSubmit:H,onBack:q,showDeliveryInstructions:i,showAddressLine2:Bj(d)});case"SELECT_CANDIDATE_ADDRESS":return s.jsx(wMt,{addresses:l,onSubmit:G,onBack:ne});case"CONFIRM_ADDRESS_MAP":return s.jsx(Fse,{address:p,onSubmit:W,onBack:ue});case"FORM":default:return s.jsx(HN,{formFields:I,onSubmit:j})}};Bse.fetchData=({store:e})=>e.dispatch(Cd.fetchNewAddressFields(void 0,"MANUAL_FORM_MAP"));const Use=se("ADDRESS_GEOCODING"),JMt=(e,t)=>({type:"API",payload:{url:`/v3/address-geocoding?countryCode=${t}`,service:"webaddressws",pathPrefix:{client:"/api/address",server:"/core-api"},options:{method:"POST",body:e},...Use}}),ewt={types:{ADDRESS_GEOCODING:Use},addressGeocoding:JMt},twt=(e,t)=>n=>n(ewt.addressGeocoding(e,t)).then(o=>o.payload.responseData),Gse={addressGeocoding:twt},swt=st({addressGeocoding:Gse.addressGeocoding,addressLookup:QN.addressLookup,postCustomerAddresses:Ap.postCustomerAddresses,getDeliverability:d_}),nwt=we(null,swt)(Bse),owt=({modalName:e=Rr,visibleComponent:t,onModalClose:n,onAddressSave:o})=>{const r=F(),a=f($e(e)),i=Bs(),l=h.useRef(t||"FORM"),c=p=>{l.current=p},d=p=>{const g=kse(p);switch(l.current){case"CONFIRMATION_FORM":i.saveAddressModalClosed(g);break;case"SELECT_CANDIDATE_ADDRESS":i.selectAddressModalClosed(g);break;case"CONFIRM_ADDRESS_MAP":i.confirmAddressModalClosed(g);break;case"FORM":default:i.addAddressModalClosed(g)}n(),r(J.closeModal())},u=(p,g)=>{o(p,g),r(J.closeModal())};return s.jsx(B,{isOpen:a,onRequestClose:d,children:s.jsx(B.Body,{children:s.jsx(nwt,{onConfirm:u,onVisibleComponentChange:c})})})};function Mg({id:e,values:t,...n}){const o=L();let r=o.formatMessage(e);if(t){const a=kce({id:e,defaultMessage:r.replace(/<([^>]+)>/g,"'<$1>'")});r=o.formatMessage(a,t).replace(/'<([^']+)'?>/g,"<$1>")}return s.jsx("span",{...n,dangerouslySetInnerHTML:{__html:Ri(r)}})}const rwt="_header_11kkc_1",awt="_header__row_11kkc_20",iwt="_header__navbar_11kkc_46",lwt="_header__item_11kkc_61",cwt="_header__logo_11kkc_77",dwt="_header__search_11kkc_106",uwt="_matchingTerm_11kkc_170",pwt="_header__bottom_11kkc_178",Df={header:rwt,"header--overlay-visible":"_header--overlay-visible_11kkc_13","header--smart-banner":"_header--smart-banner_11kkc_16",header__row:awt,"header__nav-button":"_header__nav-button_11kkc_34",header__navbar:iwt,"header--alternate":"_header--alternate_11kkc_57",header__item:lwt,"header__item--lg":"_header__item--lg_11kkc_68",header__logo:cwt,"header__logo--s":"_header__logo--s_11kkc_83","header__logo--l":"_header__logo--l_11kkc_91",header__search:dwt,"header__search-list":"_header__search-list_11kkc_121","header__search-list-item":"_header__search-list-item_11kkc_159",matchingTerm:uwt,header__bottom:pwt},mwt=v(Wo)`
    min-inline-size: 0;
    border-start-end-radius: var(--salt-radius-default) !important;
    border-end-end-radius: var(--salt-radius-default) !important;
`,hwt=v.form`
    inline-size: 100%;
    position: relative;
`;function gwt(){const e=h.useRef(null),[t,n]=h.useState(500),o=()=>{if(e.current){const r=e.current.offsetWidth;n(r)}};return h.useEffect(()=>(o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}),[]),{inputRef:e,inputWidth:t}}const Ewt=v.ul`
    position: fixed;
    padding: 0;
    inline-size: ${e=>e.width}px;
    max-block-size: 42.3vb;
    overflow-y: auto;
`,fwt=v.li`
    :hover {
        text-decoration: none;
    }
`,s$=Bp.bind(Df),Gj=({id:e,placeholderMessage:t,hasError:n,onChange:o,onItemSelected:r,onScrollEnd:a,info:i,children:l})=>{const c=h.useRef(null),[d,u]=h.useState(!0),{inputRef:p,inputWidth:g}=gwt();h.useEffect(()=>{const S=C=>{c.current&&!c.current.contains(C.target)&&u(!1)};return window.addEventListener("mousedown",S),()=>{window.removeEventListener("mousedown",S)}},[]);const E=()=>{u(!0)},y=S=>{S.currentTarget.scrollHeight-S.currentTarget.scrollTop===S.currentTarget.clientHeight&&a&&a()},I=S=>{o(S.target.value)};return s.jsxs(hwt,{ref:c,onSubmit:S=>S.preventDefault(),children:[s.jsx(mwt,{hideLabel:!0,last:!0,label:t,ref:p,id:e,"data-test":`${e}-input`,name:e,placeholder:t,input:{onFocus:E,onChange:I},hasError:n,meta:{invalid:!1,touched:!1}}),d&&s.jsxs(Ewt,{className:s$("header__search-list"),"data-test":"search-suggestions-list",onScroll:y,width:g,children:[h.Children.count(l)>0&&i&&s.jsx("div",{className:"salt-p-y--2 salt-p-x--4",children:s.jsx(O,{children:i})}),h.Children.map(l,(S,C)=>s.jsxs("div",{children:[s.jsx(Ts,{}),s.jsx(fwt,{className:s$("header__search-list-item","salt-p--1"),"data-test":"search-suggestions-item",onClick:()=>{u(!1),r(C)},children:S})]}))]})]})},$se=v(Mg)`
    a {
        color: var(--salt-text-color);
        text-decoration: underline;

        &:hover {
            text-decoration: none;
        }

        &:visited {
            color: var(--salt-text-color);
        }
    }
`;v(x)`
    border-inline-start: none;
    border-start-start-radius: 0;
    border-end-start-radius: 0;
`;const ywt=v.div`
    display: flex;
    flex-direction: column;
    flex-basis: 100%;
    min-block-size: calc(var(--salt-spacing-1) * 50);
`,Iwt=v(Q)`
    flex-grow: 1;
`,n$=v(x)`
    flex: 1 1 0;
`,Swt=({onEnterAddressManually:e,onSubmit:t,postCodeRegExp:n=/^[A-Za-z0-9 ]*$/g,actions:o,countryCode:r})=>{const a=Bs(),i=L(),[l,c]=h.useState([]),[d,u]=h.useState(),[p,g]=h.useState(!1),[E,y]=h.useState(!1),[I,S]=h.useState(!1),[C,T]=h.useState(!1),_=i.formatMessage("settings.address.book.add.modal.postcode.placeholder"),A=i.formatMessage("addresses.postcode-lookup.continue"),R=i.formatMessage("addresses.postcode-lookup.enter-address-manually"),P=G=>{const W=l[G];u(W)},k=Vr(G=>{const W=n.test(G);if(g(!1),S(!1),T(!1),c([]),!G){a.searchAddressPostcodeEndTyping(0,!1),g(!0);return}if(!W){a.searchAddressPostcodeEndTyping(0,!0,"invalid postcode"),S(!0);return}M(G)},500),M=G=>{y(!1),c([]),G&&o.addressLookupByPostcode(G,r).then(W=>{c(W),W.length===0?(a.searchAddressPostcodeEndTyping(0,!0,"no results"),y(!0)):a.searchAddressPostcodeEndTyping(W.length,!0)}).catch(W=>{let H="toast.notification.generic.error";W.statusCode===400?(H="settings.addresses.alert.no.areas.found",T(!0)):Z.error(H),a.searchAddressPostcodeEndTyping(0,!0,H)})},w=()=>{if(a.continueAddressAddButtonClicked(),!d){g(!0),document.getElementById("postcode-search")?.focus();return}t(d)},j=(G,W,H)=>s.jsx(O,{className:"salt-p-b--2 salt-d--inline-block","data-test":W,bold:H,children:G.formattedAddress});return s.jsxs(Q,{gap:["sm"],children:[s.jsx(bt,{title:"addresses.postcode-lookup.title"}),s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"addresses.postcode-lookup.title"})}),s.jsx(Gj,{id:"postcode-search",placeholderMessage:_,hasError:p||E||I||C,onChange:k,onItemSelected:P,children:l.map(G=>j(G,"address-search-item-dropdown"))}),s.jsxs(ywt,{children:[C&&s.jsx(O,{children:s.jsx($se,{id:"settings.address.book.add.modal.undeliverable"})}),p&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"settings.address.postcode.required.error.a11y"})})}),E&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"addresses.postcode-lookup.no-results-found"})})}),I&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"settings.address.book.add.modal.postcode.error"})})}),d&&j(d,"selected-address",!0)]}),s.jsxs(Iwt,{gap:["sm"],direction:"column",directionSmUp:"row-reverse",children:[s.jsx(n$,{intent:"primary",onClick:w,"data-test":"continue-button",children:s.jsx(x.Text,{children:A})}),s.jsx(n$,{intent:"secondary",onClick:e,"data-test":"enter-address-manually-button",children:s.jsx(x.Text,{children:R})})]})]})},Gb="add-address-modal-postcode-header",Cwt=D("m.la.h"),vwt={actions:m.shape({addCustomerAddress:m.func.isRequired,getHomeDeliveryDestinationIdByAddressId:m.func.isRequired,modalClose:m.func.isRequired,getCurrentCustomer:m.func.isRequired,fetchAddressesByPostcode:m.func.isRequired}).isRequired,onAddressSave:m.func.isRequired,onModalClose:m.func.isRequired,customerLastUpdated:m.number,hasAddresses:m.bool.isRequired,registrationPostcode:m.string.isRequired,modalLeftAlignEnabled:m.bool,postCodeMask:m.string,modalName:m.string},Twt={isOpen:!1,customerLastUpdated:void 0,modalLeftAlignEnabled:!1,postCodeMask:"",modalName:Rr},$j=({actions:e,onAddressSave:t,onModalClose:n,customerLastUpdated:o,hasAddresses:r,registrationPostcode:a,modalLeftAlignEnabled:i,postCodeMask:l,modalName:c})=>{const d=Bs(),u=L(),p=Dn({mode:"onBlur"}),{isValid:g}=oC({control:p.control}),[E,y]=h.useState(void 0),[I,S]=h.useState(!1),C=f($e(c));h.useEffect(()=>{!o&&!r&&e.getCurrentCustomer()},[]);const T=k=>{y(void 0),e.modalClose(),S(!1),d.cancelButtonClicked(k),d.addressLookupAbandonedGA4(),n()},_=({postcode:k})=>{const M={postCodeUndeliverable:!1,postCodeNotFound:!1,postCodeInvalidCharacters:!1},w=({payload:G})=>{const{responseData:W}=G;y(W),S(!1),d.findAddressButtonClicked(M)},j=G=>{M.postCodeUndeliverable=G.statusCode===400,M.postCodeNotFound=G.statusCode===404,G.statusCode===404&&d.addressLookupAddressNotFound(),y(void 0),S(!0),d.findAddressButtonClicked(M)};return e.fetchAddressesByPostcode(k,!0).then(w).catch(j)},A=()=>{y(void 0),S(!1),p.reset()},R=()=>{const k=p.getValues();g&&k.nickname&&e.addCustomerAddress(k).then(M=>e.getHomeDeliveryDestinationIdByAddressId(M)).then(({addressId:M,deliveryDestinationId:w})=>{d.addAddressSuccess(),e.modalClose(),A(),t(M,w)})},P=()=>{const{nickname:k,notes:M}=p.getValues();d.saveAddressButtonClicked({missingMandatoryField:!k,addressNameFilled:!!k,isDeliveryInstructionsFilled:!!M}),p.handleSubmit(R)()},N=()=>{const k=p.getValues();return!g||!k.nickname};return s.jsxs(B,{isOpen:C,onRequestClose:()=>T("cross icon"),aria:{labelledby:Gb},children:[s.jsx(B.Header,{align:i?"left":"center",children:s.jsx(ee,{as:"h1",id:Gb,"data-test":Gb,children:s.jsx(b,{id:"settings.address.book.add.modal.title"})})}),s.jsxs(B.Body,{children:[s.jsx("div",{className:"salt-m-b--4","data-test":"lookup-form",children:s.jsx(A9,{initialValues:r?{}:{postcode:a},onChange:A,onSubmit:_,isErrorVisible:I,postCodeRegExp:new RegExp(l),sendAnalytics:d})}),I&&s.jsx("div",{className:"salt-p-b--4",children:s.jsx(O,{children:s.jsx($se,{id:"settings.address.book.add.modal.undeliverable"})})}),s.jsx(On,{...p,children:s.jsx(ost,{addresses:E,handleSubmit:R,sendAnalytics:d})})]}),s.jsxs(B.Footer,{align:i?"left":"center",children:[s.jsx(x,{fill:!0,intent:"secondary","data-test":"addresses-cancel-button",onClick:()=>T("cancel button"),children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.button.cancel"})})}),s.jsx(x,{fill:!0,intent:"primary",disabled:N(),onClick:P,"data-test":"addresses-submit-button","aria-label":u.formatMessage("settings.address.book.add.modal.submit.aria.label"),className:"salt-m-l--2",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.add.modal.submit"})})})]})]})};$j.propTypes=vwt;$j.defaultProps=Twt;const _wt=e=>({customerLastUpdated:yEe(e),hasAddresses:RIe(e),registrationPostcode:fEe(e),modalLeftAlignEnabled:Cwt(e),postCodeMask:_R(e)}),bwt=st({addCustomerAddress:IS.addCustomerAddress,getHomeDeliveryDestinationIdByAddressId:YN.getHomeDeliveryDestinationIdByAddressId,modalClose:J.closeModal,getCurrentCustomer:xs.getCurrentCustomer,fetchAddressesByPostcode:eo.fetchAddressesByPostcode}),xwt=we(_wt,bwt)($j),Awt=e=>(t="",n)=>t.length<=e?t:n,Rwt=()=>{const e=L(),t=f(Up),n=f(r=>Ze(r,"validation-address-client-name-max-chars")),o={detailsLabel:e.formatMessage("settings.address.book.add.modal.details.label"),detailsPlaceholder:e.formatMessage("settings.address.book.add.modal.details.placeholder"),restrictedCharsMessage:e.formatMessage("validation.form.restricted.chars")};return s.jsx(nr,{validate:r=>KN(t,o.restrictedCharsMessage)(r),placeholder:o.detailsPlaceholder,name:"details","data-test":"addresses-details-input","data-pii":"true",autoComplete:"off",label:o.detailsLabel,normalize:Awt(n)})},Dwt=({handleSubmit:e})=>{const t=!f(D("daddi")),n=po();return s.jsxs("form",{onSubmit:n.handleSubmit(e),"data-test":"add-address-modal-international-details-form",children:[s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-t--4 salt-m-b--8",children:s.jsx(Rwt,{})}),s.jsx(Ts,{}),s.jsxs("div",{className:"salt-m-t--4 salt-m-b--8",children:[s.jsx(zN,{}),t&&s.jsx(iT,{})]})]}),s.jsx("input",{type:"submit",hidden:!0})]})},Owt={selectedAddress:m.shape({id:m.string.isRequired,formattedAddress:m.string,deliverable:m.bool}).isRequired,detailsFormRef:m.shape({current:m.shape()}),onDetailsFormSubmit:m.func.isRequired,onSearchAgain:m.func.isRequired,submitError:m.bool.isRequired,fetchError:m.bool.isRequired,detailsFormContext:m.shape({handleSubmit:m.func.isRequired}).isRequired,sendAnalytics:m.shape({}).isRequired},Pwt={detailsFormRef:ae.createRef()},Hj=({selectedAddress:e,onDetailsFormSubmit:t,onSearchAgain:n,submitError:o,detailsFormContext:r,fetchError:a,sendAnalytics:i})=>{const l=()=>s.jsx(Q,{justify:"space-between",children:s.jsx(Rn,{children:s.jsx(O,{bold:!0,children:s.jsx(b,{id:"common.address"})})})}),c=()=>s.jsxs(h.Fragment,{children:[s.jsx(On,{...r,children:s.jsx(Dwt,{handleSubmit:r.handleSubmit(t),sendAnalytics:i})}),o&&s.jsx(Te,{"data-test":"details-content-submission-error-alert",text:s.jsx(b,{id:"settings.address.book.add.modal.submit.error"})})]});return s.jsxs(h.Fragment,{children:[l(),a?s.jsx(Te,{"data-test":"details-content-fetch-error-alert",text:s.jsx(b,{id:"settings.address.book.add.modal.fetch.error"})}):s.jsx("div",{className:"salt-m-y--2",children:s.jsx(O,{"data-pii":"true","data-test":"details-content-selected-address",children:e.formattedAddress})}),s.jsx("div",{className:"salt-m-y--2",children:s.jsx(x,{intent:"secondary","data-test":"details-content-search-again-link",onClick:n,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.add.modal.search.again"})})})}),e.deliverable&&c(),!a&&!e.deliverable&&s.jsx("div",{className:"salt-m-t--8",children:s.jsx(Te,{showIcon:!1,"data-test":"details-content-undeliverable-address-error-alert",text:s.jsx(b,{id:"settings.address.book.add.modal.undeliverable"})})})]})};Hj.propTypes=Owt;Hj.defaultProps=Pwt;const Nwt=({addresses:e,onSelectHandler:t,onSubmitFetchAddresses:n,fetchError:o,onAddressSelectFocus:r})=>{const a=L(),i=()=>o?s.jsx(Te,{showIcon:!1,"data-test":"add-address-modal-international-no-addresses-lookup-error",text:e?s.jsx(b,{id:"settings.address.book.add.modal.search.no.addresses","data-test":"lookup-content-search-no-addresses-message"}):s.jsx(b,{id:"settings.address.book.add.modal.search.error","data-test":"lookup-content-search-error-message"})}):null,l=Dn({mode:"onBlur"}),c=h.useMemo(()=>e?.map(({id:u,formattedAddress:p})=>({value:u,label:p,dataTest:"add-address-modal-international-address-select-option"}))??[],[e]),d=u=>l.handleSubmit((p,g)=>{n(g,p)})(u);return s.jsx(h.Fragment,{children:s.jsxs(On,{...l,children:[s.jsxs("form",{id:"modal-lookup-content-form",onSubmit:d,children:[s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx(nr,{label:a.formatMessage("settings.address.book.add.international.modal.search.label"),placeholder:a.formatMessage("settings.address.book.add.international.modal.search.placeholder"),name:"search-label","data-test":"add-address-modal-international-search-address-input"}),i()]}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(x,{type:"submit",intent:"primary",fill:!0,"data-test":"add-address-modal-international-find-address-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.add.modal.find.button"})})})})]}),!!e?.length&&s.jsxs(h.Fragment,{children:[s.jsx(Am,{onChangeCallback:t,label:a.formatMessage("settings.address.book.add.modal.select.address.label"),placeholder:a.formatMessage("settings.address.book.add.modal.select.address.placeholder"),name:"add-address-modal-international-address-select","data-test":"add-address-modal-international-address-select",options:c,onFocus:r}),s.jsx("div",{className:"salt-m-t--4",children:s.jsx(Q,{justify:"center",children:s.jsx(pe,{name:"powered_by_google",height:18,width:144})})})]})]})})},Lwt=D("m.la.h"),kwt={actions:m.shape({addCustomerAddress:m.func.isRequired,addCustomerAddressWithPostcodeUpdate:m.func.isRequired,getHomeDeliveryDestinationIdByAddressId:m.func.isRequired,modalClose:m.func.isRequired,analyticsEvent:m.func.isRequired,fetchAddressesBySearchTerm:m.func.isRequired,fetchDetailsForAddress:m.func.isRequired}).isRequired,onAddressSave:m.func.isRequired,onModalClose:m.func.isRequired,pagePath:m.string.isRequired,modalLeftAlignEnabled:m.bool,modalName:m.string},jwt={modalLeftAlignEnabled:!1,modalName:Rr},Vj=({actions:e,onAddressSave:t,onModalClose:n,modalLeftAlignEnabled:o,pagePath:r,modalName:a})=>{const i=Bs(),l=Dn({mode:"onBlur"}),c=f($e(a)),[d,u]=h.useState({addresses:void 0,selectedAddress:void 0,fetchError:!1,submitError:!1,saveAddressIsFetching:!1,failedSearches:[],postcodeUpdated:!1,isSubmitted:!1}),p=M=>{const w=d.addresses.filter(({id:j})=>j===M.target.value).pop();u({...d,selectedAddress:{...w,isFetching:!0}}),C(w)},g=(M,w)=>{w.preventDefault();const j=()=>{const{addCustomerAddress:G,addCustomerAddressWithPostcodeUpdate:W}=e;return d.postcodeUpdated?W:G};d.isSubmitted||(u({...d,saveAddressIsFetching:!0,isSubmitted:!0}),j()({...d.selectedAddress,...l.getValues()}).then(W=>e.getHomeDeliveryDestinationIdByAddressId(W)).then(({addressId:W,deliveryDestinationId:H})=>(u({...d,submitError:!1}),t(W,H))).then(()=>{i.addAddressSuccess(),T()}).catch(()=>{u({...d,submitError:!0,saveAddressIsFetching:!1,isSubmitted:!1})}))},E=()=>{_(),i.findAddressAgainButtonClicked()},y=(M,w)=>{M.preventDefault();const j=w?.["search-label"]??"";if(j){S(j);return}const G={addressNotFound:!1,addressInvalidCharacters:!0};i.findAddressButtonClicked(G)},I=M=>{M.preventDefault()},S=M=>{const w={addressNotFound:!1,addressInvalidCharacters:!1},j=W=>{const H=W.payload.responseData;u(K=>({lastSearchString:M,fetchError:!1,addresses:H,failedSearches:H.length>0?K.failedSearches:K.failedSearches.concat(M)})),H.length===0?(i.addressLookupAddressNotFound(),w.addressNotFound=!0):i.addressLookupSuccess(),i.findAddressButtonClicked(w)},G=({statusCode:W})=>{u(H=>({...d,lastSearchString:M,failedSearches:H.failedSearches.concat(M),fetchError:!0,addresses:W===404?[]:void 0})),W===500&&(w.addressInvalidCharacters=!0),W===404&&(i.addressLookupAddressNotFound(),w.addressNotFound=!0),i.findAddressButtonClicked(w)};return e.fetchAddressesBySearchTerm(M).then(j).catch(G)},C=M=>{const w=()=>{u({...d,fetchError:!0,selectedAddress:{...M,isFetching:!1},addresses:void 0})},j=W=>{const{lastSearchString:H,failedSearches:K}=d;if(W.deliverable){const q={type:ke.ADDRESS_LOOKUP_SELECTED,lastSearchString:nh(H),failedSearches:K.map(nh).join(", ")};i.addressLookupSelected(q),i.addressLookupAddressSelected()}else{const q={addressDescription:nh(M.value)};i.addressLookupUndeliverable(q),i.addressLookupUndeliverableGA4()}const X={};W.deliverable||(X.addressNotDeliverable=!0),i.dropdownAddressSelected(X),u({...d,fetchError:!1,selectedAddress:{...M,...W,isFetching:!1},failedSearches:[],lastSearchString:void 0})},G=!r.includes(RR());return e.fetchDetailsForAddress(M.id,G).then(j).catch(w)},T=M=>{const{selectedAddress:w,fetchError:j,failedSearches:G,lastSearchString:W}=d;if(w===void 0||j||!w.deliverable){const H={lastSearchString:nh(W),failedSearches:G.map(nh).join(", ")};i.addressLookupAbandoned(H),i.addressLookupAbandonedGA4()}_(),e.modalClose(),l.reset(),M&&i.cancelButtonClicked(M),n()},_=()=>{u({lastSearchString:void 0,failedSearches:[],selectedAddress:void 0,addresses:void 0,fetchError:!1,submitError:!1,saveAddressIsFetching:!1,postcodeUpdated:!1,isSubmitted:!1})},A=()=>{i.addressDropdownOpened()},R=()=>{const{addresses:M,selectedAddress:w,fetchError:j,submitError:G}=d;return w===void 0?s.jsx(Nwt,{addresses:M,onSubmitFetchAddresses:y,onSubmitHandler:I,onSelectHandler:p,fetchError:j,onAddressSelectFocus:A}):w.isFetching?s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-t--8 salt-m-b--2",children:s.jsx(_e,{className:"salt-m-b--2",height:"15px"})}),s.jsxs("div",{className:"salt-m-t--8 salt-m-b--2",children:[s.jsx(_e,{className:"salt-m-b--2",height:"15px"}),s.jsx(_e,{className:"salt-m-b--2",height:"15px"}),s.jsx(_e,{className:"salt-m-b--2",height:"15px",width:"150px"})]})]}):s.jsx(Hj,{selectedAddress:w,onDetailsFormSubmit:g,onSearchAgain:E,submitError:G,fetchError:j,detailsFormContext:l,sendAnalytics:i})},P=M=>{const w=l.getValues(),j={missingMandatoryField:!w.nickname,additionalDetailsFilled:!!w.details,addressNameFilled:!!w.nickname,isDeliveryInstructionsFilled:!!w.notes};return Object.values(l.formState.errors).some(W=>W.type.includes("validate"))&&(j.invalidCharacters=!0),i.saveAddressButtonClicked(j),l.handleSubmit(g)(M)},N=()=>{const{selectedAddress:M,saveAddressIsFetching:w}=d;return M?s.jsxs(B.Footer,{align:o?"left":"center",children:[s.jsx(x,{fill:!0,intent:"secondary","data-test":"intl-address-modal-cancel-button",onClick:()=>T("cancel button"),children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.button.cancel"})})}),M.deliverable&&M.isFetching===!1&&s.jsx(x,{className:"salt-m-l--2",fill:!0,intent:"primary",disabled:w,onClick:P,"data-test":"addresses-submit-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.add.modal.submit"})})})]}):null},k="add-address-modal-international-header";return s.jsxs(B,{isOpen:c,onRequestClose:()=>T("cross icon"),aria:{labelledby:k},viewHeight:d.selectedAddress?void 0:"auto",children:[s.jsx(B.Header,{align:o?"left":"center",children:s.jsx(ee,{as:"h2",id:k,"data-test":k,children:s.jsx(b,{id:"settings.address.book.add.modal.title"})})}),s.jsx(B.Body,{children:R()}),N()]})};Vj.propTypes=kwt;Vj.defaultProps=jwt;const Mwt=e=>({pagePath:tm(e),modalLeftAlignEnabled:Lwt(e),isOpen:$e(Rr)(e)}),wwt=st({analyticsEvent:U.analyticsEvent,addCustomerAddress:IS.addCustomerAddress,addCustomerAddressWithPostcodeUpdate:IS.addCustomerAddressWithPostcodeUpdate,getHomeDeliveryDestinationIdByAddressId:YN.getHomeDeliveryDestinationIdByAddressId,modalClose:J.closeModal,fetchAddressesBySearchTerm:eo.fetchAddressesBySearchTerm,fetchDetailsForAddress:Ap.fetchDetailsForAddress}),Fwt=we(Mwt,wwt)(Vj);v(x)`
    border-inline-start: none;
    border-start-start-radius: 0;
    border-end-start-radius: 0;
`;const Bwt=v.div`
    display: flex;
    flex-direction: column;
    flex-basis: 100%;
    min-block-size: calc(var(--salt-spacing-1) * 50);
`,Uwt=v.div`
    display: flex !important;
    flex-flow: column wrap !important;
    gap: var(--salt-spacing-1);
`,Gwt=v(Q)`
    flex-grow: 1;
`,$wt=v(x)`
    flex: 1 1 0;
`,Hwt=({countryCode:e,actions:t,onSubmit:n})=>{const o=L(),r=Bs(),[a,i]=h.useState([]),[l,c]=h.useState(),[d,u]=h.useState(!1),[p,g]=h.useState(!1),[E,y]=h.useState(!1),I=h.useRef(null),S=h.useRef(""),[C,T]=h.useState(!1),[_,A]=h.useState(!1),R=o.formatMessage("addresses.address-search.input.placeholder"),P=o.formatMessage("addresses.address-search.continue"),N=f(PIe),k=f(NIe),M=f(LIe),w=f(Up),j=new RegExp(w),G=Ie=>{const Fe=a[Ie];T(!1),c(Fe),r.dropdownAddressSelected({position:Ie})},W=Ie=>{const Fe=Ie.trim(),be=3;if(S.current===Fe)return;if(S.current=Fe,A(!1),g(!1),u(!1),y(!1),i([]),Fe.length===0){u(!0);return}if(Fe.length<be){A(!0);return}const ce=j.test(Fe);if(!Fe){r.searchAddressPostcodeEndTyping(0,!1),u(!0);return}if(!ce){r.searchAddressPostcodeEndTyping(0,!0,"invalid address"),y(!0);return}H(Fe)},H=Ie=>{I.current=null,g(!1),i([]),Ie&&t.addressLookupBySearchTerm(Ie,e,void 0,N).then(Fe=>{I.current=Fe.metadata.nextPageToken;const be=Fe.content.slice(0,M);i(be),Fe.content.length===0?(g(!0),r.searchAddressPostcodeEndTyping(0,!0,"no results")):r.searchAddressPostcodeEndTyping(Fe.content.length,!0)}).catch(Fe=>{const be=Fe.statusCode===400?"settings.addresses.alert.no.areas.found":"toast.notification.generic.error";Z.error(be),r.searchAddressPostcodeEndTyping(0,!0,be)})},K=()=>{if(!l){S.current.length===0?(r.searchAddressContinueClicked(a.length,!1,"no address selected"),u(!0)):r.searchAddressContinueClicked(a.length,!0,"no address selected"),document.getElementById("address-search")?.focus();return}X().then(({deliverability:Ie})=>(Ie==="DELIVERABLE"?(r.searchAddressContinueClicked(a.length,!0),n(l)):(r.searchAddressContinueClicked(a.length,!0,"address not deliverable"),T(!0)),Ie)).catch(()=>{Z.error("toast.notification.generic.error"),r.searchAddressContinueClicked(a.length,!0,"error")})},X=()=>l?l.location?t.getDeliverability({postalCode:l.addressDetails.postalCode,latitude:l.location.latitude,longitude:l.location.longitude}):t.getDeliverabilityByAddressDetails(l.addressDetails,e):Promise.reject(),q=()=>I.current!==null&&M>a.length,ne=()=>{const Ie=a.length;return Ie<=N&&!q()?Ie:`${N}+`},ue=()=>a.length>=k,oe=()=>s.jsxs(Q,{direction:"column",gap:["sm"],children:[s.jsx(O,{bold:!0,children:s.jsx(b,{id:"addresses.address-search.results",values:{results:ne()}})}),ue()&&s.jsx(O,{children:s.jsx(b,{id:"addresses.address-search.refine"})})]}),ye=(Ie,Fe)=>s.jsxs(Uwt,{"data-test":Fe,children:[s.jsxs(O,{children:[s.jsxs("b",{children:[s.jsx(b,{id:"addresses.address-search.address-type-new"}),":"]})," ",Ie.formattedAddress]}),s.jsxs(O,{children:[s.jsxs("b",{children:[s.jsx(b,{id:"addresses.address-search.address-type-old"}),":"]})," ",Ie.alternativeFormattedAddress]})]}),he=()=>{q()&&t.addressLookupBySearchTerm(S.current,e,I.current||void 0,N).then(Ie=>{I.current=Ie.metadata.nextPageToken;const Fe=[...a,...Ie.content].slice(0,M);i(Fe)}).catch(Ie=>{const Fe=Ie.statusCode===400?"settings.addresses.alert.no.areas.found":"toast.notification.generic.error";Z.error(Fe)})};return s.jsxs(Q,{gap:["sm"],children:[s.jsx(bt,{title:"addresses.address-search.title"}),s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"addresses.address-search.title"})}),s.jsx(Gj,{id:"address-search",placeholderMessage:R,hasError:d||E||_,onChange:Vr(W,500),onItemSelected:G,onScrollEnd:he,info:oe(),children:a.map(Ie=>ye(Ie,"address-search-item-dropdown"))}),s.jsxs(Bwt,{children:[p&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"addresses.address-search.no-results-found"})})}),E&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"addresses.address-search.invalid-error"})})}),_&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"addresses.address-search.min-characters-error"})})}),d&&s.jsx(O,{intent:"error",role:"alert",className:"salt-p-b--2",children:s.jsx("i",{children:s.jsx(b,{id:"addresses.address-search.required-error"})})}),l&&ye(l,"address-search-item-selected"),C&&s.jsx(O,{bold:!0,intent:"error",role:"alert",className:"salt-m-t--2",children:s.jsx("i",{children:s.jsx(Mg,{id:"addresses.address-search.address-not-deliverable"})})}),!l&&s.jsxs("div",{children:[s.jsx(ee,{as:"h2",className:"salt-p-b--2",children:s.jsx(b,{id:"addresses.address-search.instructions.title"})}),s.jsx(O,{children:s.jsx(Mg,{id:"addresses.address-search.instructions.text"})})]})]}),s.jsx(Gwt,{gap:["sm"],direction:"column",directionSmUp:"row-reverse",children:s.jsx($wt,{intent:"primary",onClick:K,"data-test":"continue-button",children:s.jsx(x.Text,{children:P})})})]})},Vwt=({actions:e,onConfirm:t,onVisibleComponentChange:n})=>{const o=Bs(),r=f(D("addl.mai")),a=qE(),[i,l]=h.useState("SEARCH"),[c,d]=h.useState(),{postCustomerAddresses:u}=e,p=f(cE),g=f(Ms),E=p[0];h.useEffect(()=>{n(i)},[i]);const y=(C,T)=>{const _=C.addressLine2,A={...c,addressName:C.nickname,deliveryInstructions:C.notes,formattedAddress:C.formattedAddress,language:g,countryCode:E,location:c.location,lookupId:c.lookupId};_&&_.length>0&&(A.additionalInformation=_),u(A).then(R=>a(R.addressId)).then(({addressId:R,deliveryDestinationId:P})=>{t&&t(R,P)}).catch(()=>{Z.error("toast.notification.generic.error"),T()})},I=()=>{o.saveAddressModalClosed("back"),l("SEARCH")},S=C=>{d(C),l("CONFIRM")};switch(i){case"CONFIRM":return s.jsx(u_,{address:c,showWarningIfAddressLine2Empty:!1,showMap:!1,showDeliveryInstructions:!1,addressLine2Label:"addresses.address-search.floor-door-number",isAddressLine2Required:r,onSubmit:y,onBack:I});case"SEARCH":default:return s.jsx(Hwt,{actions:e,onSubmit:S,countryCode:E})}},Wwt=st({addressLookupBySearchTerm:QN.addressLookupBySearchTerm,postCustomerAddresses:Ap.postCustomerAddresses,getDeliverability:d_,getDeliverabilityByAddressDetails:Ap.getDeliverabilityByAddressDetails}),Ywt=we(null,Wwt)(Vwt),qwt=({modalName:e=Rr,visibleComponent:t,onModalClose:n,onAddressSave:o})=>{const r=F(),a=f($e(e)),i=Bs(),l=h.useRef(t||"FORM"),c=p=>{l.current=p},d=()=>{l.current==="SEARCH"&&i.searchAddressModalClosed(),n(),r(J.closeModal())},u=(p,g)=>{o(p,g),r(J.closeModal())};return s.jsx(B,{isOpen:a,onRequestClose:d,children:s.jsx(B.Body,{children:s.jsx(Ywt,{onConfirm:u,onVisibleComponentChange:c})})})},Hse=({actions:e,onConfirm:t,onVisibleComponentChange:n,postcodeMask:o})=>{const r=Bs(),a=L(),i=qE(),l=!f(D("daddi")),[c,d]=h.useState(!1),[u,p]=h.useState("POSTCODE"),[g,E]=h.useState(),[y,I]=h.useState(),[S]=h.useState(""),[C]=VN(S,"MANUAL_FORM_MAP"),{addressGeocoding:T,postCustomerAddresses:_,getDeliverability:A}=e,R=f(cE),P=f(Ms),N=R[0],k=a.formatMessage(`address.form.field.country.name.${N}`),M="toast.notification.generic.error";h.useEffect(()=>{n(u)},[u]),h.useEffect(()=>{r.searchAddressPostcodeModalDisplayed()},[]);const w=oe=>{d(!1),I(oe),p("CONFIRMATION_FORM")},j=()=>{r.enterAddressManuallyButtonClicked(),d(!0),p("FORM")},G=()=>{r.saveAddressModalClosed("editAddress"),p(c?"FORM":"POSTCODE")},W=oe=>{const ye={...y,addressName:oe.nickname,deliveryInstructions:oe.notes,formattedAddress:oe.formattedAddress,language:P,countryCode:N,addressDetails:{...y.addressDetails,addressLine2:oe.addressLine2},location:y.location,lookupId:y.lookupId};_(ye).then(he=>i(he.addressId)).then(({addressId:he,deliveryDestinationId:Ie})=>{t&&t(he,Ie)}).catch(()=>{Z.error(M)})},H=()=>{r.saveAddressModalClosed("back"),p(c?"CONFIRM_ADDRESS_MAP":"POSTCODE")},K=oe=>{const ye={...oe,country:k};E(ye),T(ye,N).then(he=>{I(he),p("CONFIRM_ADDRESS_MAP")}).catch(he=>{const Ie=he.statusCode===404?"settings.address.book.add.modal.search.no.addresses":"toast.notification.generic.error";Z.error(Ie)})},X=()=>{p("POSTCODE")},q=oe=>{const ye={...y,location:oe};I(ye),ue(ye).then(he=>{const Ie=he==="DELIVERABLE",Fe=Lse(y.location,oe);r.confirmAddressModalClosed("confirmAddress",Fe,Ie)})},ne=()=>{r.confirmAddressModalClosed("back"),p("FORM")},ue=oe=>A({postalCode:oe.addressDetails.postalCode,latitude:oe.location.latitude,longitude:oe.location.longitude}).then(({deliverability:ye})=>(ye==="DELIVERABLE"?p("CONFIRMATION_FORM"):Z.error("settings.addresses.alert.nondeliverable"),ye)).catch(()=>{Z.error(M)});switch(u){case"POSTCODE":return s.jsx(Swt,{countryCode:N,onSubmit:w,onEnterAddressManually:j,postCodeRegExp:new RegExp(o),actions:e});case"CONFIRM_ADDRESS_MAP":return s.jsx(Fse,{address:y,onSubmit:q,onBack:ne});case"CONFIRMATION_FORM":return s.jsx(u_,{address:y,onEdit:G,onSubmit:W,onBack:H,showDeliveryInstructions:l,showAddressLine2:g!=null&&Bj(g)});case"FORM":default:return s.jsx(HN,{formFields:C,onSubmit:K,onBack:X})}};Hse.fetchData=({store:e})=>e.dispatch(Cd.fetchNewAddressFields(void 0,"MANUAL_FORM_MAP"));const Kwt=st({addressGeocoding:Gse.addressGeocoding,postCustomerAddresses:Ap.postCustomerAddresses,getDeliverability:d_,addressLookupByPostcode:QN.addressLookupByPostcode}),zwt=e=>({postcodeMask:_R(e)}),Qwt=we(zwt,Kwt)(Hse),Xwt=({modalName:e=Rr,onModalClose:t,onAddressSave:n})=>{const o=Bs(),r=F(),a=f($e(e)),i=d=>{const u=kse(d);o.searchAddressPostcodeModalClosed(u),t(),r(J.closeModal())},l=(d,u)=>{n(d,u),r(J.closeModal())},c=()=>{};return s.jsx(B,{isOpen:a,onRequestClose:i,children:s.jsx(B.Body,{children:s.jsx(Qwt,{onConfirm:l,onVisibleComponentChange:c})})})},Zwt=()=>s.jsxs("svg",{"data-test":"google-icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 69 29",width:"66",height:"26",children:[s.jsxs("g",{opacity:".6",fill:"#fff",stroke:"#fff",strokeWidth:"1.5",children:[s.jsx("path",{d:"M17.4706 7.33616L18.0118 6.79504 17.4599 6.26493C16.0963 4.95519 14.2582 3.94522 11.7008 3.94522c-4.613699999999999 0-8.50262 3.7551699999999997-8.50262 8.395779999999998C3.19818 16.9817 7.0871 20.7368 11.7008 20.7368 14.1712 20.7368 16.0773 19.918 17.574 18.3689 19.1435 16.796 19.5956 14.6326 19.5956 12.957 19.5956 12.4338 19.5516 11.9316 19.4661 11.5041L19.3455 10.9012H10.9508V14.4954H15.7809C15.6085 15.092 15.3488 15.524 15.0318 15.8415 14.403 16.4629 13.4495 17.1509 11.7008 17.1509 9.04835 17.1509 6.96482 15.0197 6.96482 12.341 6.96482 9.66239 9.04835 7.53119 11.7008 7.53119 13.137 7.53119 14.176 8.09189 14.9578 8.82348L15.4876 9.31922 16.0006 8.80619 17.4706 7.33616z"}),s.jsx("path",{d:"M24.8656 20.7286C27.9546 20.7286 30.4692 18.3094 30.4692 15.0594 30.4692 11.7913 27.953 9.39011 24.8656 9.39011 21.7783 9.39011 19.2621 11.7913 19.2621 15.0594c0 3.25 2.514499999999998 5.6692 5.6035 5.6692zM24.8656 12.8282C25.8796 12.8282 26.8422 13.6652 26.8422 15.0594 26.8422 16.4399 25.8769 17.2905 24.8656 17.2905 23.8557 17.2905 22.8891 16.4331 22.8891 15.0594 22.8891 13.672 23.853 12.8282 24.8656 12.8282z"}),s.jsx("path",{d:"M35.7511 17.2905v0H35.7469C34.737 17.2905 33.7703 16.4331 33.7703 15.0594 33.7703 13.672 34.7343 12.8282 35.7469 12.8282 36.7608 12.8282 37.7234 13.6652 37.7234 15.0594 37.7234 16.4439 36.7554 17.2962 35.7511 17.2905zM35.7387 20.7286C38.8277 20.7286 41.3422 18.3094 41.3422 15.0594 41.3422 11.7913 38.826 9.39011 35.7387 9.39011 32.6513 9.39011 30.1351 11.7913 30.1351 15.0594 30.1351 18.3102 32.6587 20.7286 35.7387 20.7286z"}),s.jsx("path",{d:"M51.953 10.4357V9.68573H48.3999V9.80826C47.8499 9.54648 47.1977 9.38187 46.4808 9.38187 43.5971 9.38187 41.0168 11.8998 41.0168 15.0758 41.0168 17.2027 42.1808 19.0237 43.8201 19.9895L43.7543 20.0168 41.8737 20.797 41.1808 21.0844 41.4684 21.7772C42.0912 23.2776 43.746 25.1469 46.5219 25.1469 47.9324 25.1469 49.3089 24.7324 50.3359 23.7376 51.3691 22.7367 51.953 21.2411 51.953 19.2723v-8.8366zm-7.2194 9.9844L44.7334 20.4196C45.2886 20.6201 45.878 20.7286 46.4808 20.7286 47.1616 20.7286 47.7866 20.5819 48.3218 20.3395 48.2342 20.7286 48.0801 21.0105 47.8966 21.2077 47.6154 21.5099 47.1764 21.7088 46.5219 21.7088 45.61 21.7088 45.0018 21.0612 44.7336 20.4201zM46.6697 12.8282C47.6419 12.8282 48.5477 13.6765 48.5477 15.084 48.5477 16.4636 47.6521 17.2987 46.6697 17.2987 45.6269 17.2987 44.6767 16.4249 44.6767 15.084 44.6767 13.7086 45.6362 12.8282 46.6697 12.8282zM55.7387 5.22083v-.75H52.0788V20.4412H55.7387V5.220829999999999z"}),s.jsx("path",{d:"M63.9128 16.0614L63.2945 15.6492 62.8766 16.2637C62.4204 16.9346 61.8664 17.3069 61.0741 17.3069 60.6435 17.3069 60.3146 17.2088 60.0544 17.0447 59.9844 17.0006 59.9161 16.9496 59.8498 16.8911L65.5497 14.5286 66.2322 14.2456 65.9596 13.5589 65.7406 13.0075C65.2878 11.8 63.8507 9.39832 60.8278 9.39832 57.8445 9.39832 55.5034 11.7619 55.5034 15.0676 55.5034 18.2151 57.8256 20.7369 61.0659 20.7369 63.6702 20.7369 65.177 19.1378 65.7942 18.2213L66.2152 17.5963 65.5882 17.1783 63.9128 16.0614zM61.3461 12.8511L59.4108 13.6526C59.7903 13.0783 60.4215 12.7954 60.9017 12.7954 61.067 12.7954 61.2153 12.8161 61.3461 12.8511z"})]}),s.jsx("path",{d:"M11.7008 19.9868C7.48776 19.9868 3.94818 16.554 3.94818 12.341 3.94818 8.12803 7.48776 4.69522 11.7008 4.69522 14.0331 4.69522 15.692 5.60681 16.9403 6.80583L15.4703 8.27586C14.5751 7.43819 13.3597 6.78119 11.7008 6.78119 8.62108 6.78119 6.21482 9.26135 6.21482 12.341 6.21482 15.4207 8.62108 17.9009 11.7008 17.9009 13.6964 17.9009 14.8297 17.0961 15.5606 16.3734 16.1601 15.7738 16.5461 14.9197 16.6939 13.7454h-4.9931V11.6512h7.0298C18.8045 12.0207 18.8456 12.4724 18.8456 12.957 18.8456 14.5255 18.4186 16.4637 17.0389 17.8434 15.692 19.2395 13.9838 19.9868 11.7008 19.9868z",fill:"#4285F4"}),s.jsx("path",{d:"M29.7192 15.0594C29.7192 17.8927 27.5429 19.9786 24.8656 19.9786 22.1884 19.9786 20.0121 17.8927 20.0121 15.0594 20.0121 12.2096 22.1884 10.1401 24.8656 10.1401 27.5429 10.1401 29.7192 12.2096 29.7192 15.0594zM27.5922 15.0594C27.5922 13.2855 26.3274 12.0782 24.8656 12.0782S22.1391 13.2937 22.1391 15.0594C22.1391 16.8086 23.4038 18.0405 24.8656 18.0405S27.5922 16.8168 27.5922 15.0594z",fill:"#E94235"}),s.jsx("path",{d:"M40.5922 15.0594C40.5922 17.8927 38.4159 19.9786 35.7387 19.9786 33.0696 19.9786 30.8851 17.8927 30.8851 15.0594 30.8851 12.2096 33.0614 10.1401 35.7387 10.1401 38.4159 10.1401 40.5922 12.2096 40.5922 15.0594zM38.4734 15.0594C38.4734 13.2855 37.2087 12.0782 35.7469 12.0782 34.2851 12.0782 33.0203 13.2937 33.0203 15.0594 33.0203 16.8086 34.2851 18.0405 35.7469 18.0405 37.2087 18.0487 38.4734 16.8168 38.4734 15.0594z",fill:"#FABB05"}),s.jsx("path",{d:"M51.203 10.4357v8.8366C51.203 22.9105 49.0595 24.3969 46.5219 24.3969 44.132 24.3969 42.7031 22.7955 42.161 21.4897L44.0417 20.7095C44.3784 21.5143 45.1997 22.4588 46.5219 22.4588 48.1479 22.4588 49.1499 21.4487 49.1499 19.568V18.8617H49.0759C48.5914 19.4612 47.6552 19.9786 46.4808 19.9786 44.0171 19.9786 41.7668 17.8352 41.7668 15.0758 41.7668 12.3 44.0253 10.1319 46.4808 10.1319 47.6552 10.1319 48.5914 10.6575 49.0759 11.2323H49.1499V10.4357H51.203zM49.2977 15.084C49.2977 13.3512 48.1397 12.0782 46.6697 12.0782 45.175 12.0782 43.9267 13.3429 43.9267 15.084 43.9267 16.8004 45.175 18.0487 46.6697 18.0487 48.1397 18.0487 49.2977 16.8004 49.2977 15.084z",fill:"#4285F4"}),s.jsx("path",{d:"M54.9887 5.22083V19.6912H52.8288V5.220829999999999H54.9887z",fill:"#34A853"}),s.jsx("path",{d:"M63.4968 16.6854L65.1722 17.8023C64.6301 18.6072 63.3244 19.9869 61.0659 19.9869 58.2655 19.9869 56.2534 17.827 56.2534 15.0676 56.2534 12.1439 58.2901 10.1483 60.8278 10.1483 63.3818 10.1483 64.6301 12.1768 65.0408 13.2773L65.2625 13.8357 58.6843 16.5623C59.1853 17.5478 59.9737 18.0569 61.0741 18.0569 62.1746 18.0569 62.9384 17.5067 63.4968 16.6854zM58.3312 14.9115L62.7331 13.0884C62.4867 12.4724 61.764 12.0454 60.9017 12.0454 59.8012 12.0454 58.2737 13.0145 58.3312 14.9115z",fill:"#E94235"})]}),$b=v.button`
    vertical-align: middle;
    background: var(--intent-contrast-100);
    block-size: 40px;
    inline-size: 40px;
    border-radius: var(--salt-radius-default);
    pointer-events: all;
`,Jwt=v(Q)`
    inline-size: 100%;
    block-size: 100%;
    align-items: end;
    justify-content: space-between;
`,o$=({showGoogleIcon:e=!1,mapControlsRef:t})=>{const n=()=>{t?.current?.geolocate()},o=()=>{t?.current?.zoomIn()},r=()=>{t?.current?.zoomOut()};return s.jsxs(Jwt,{gap:["xs"],direction:"row",children:[s.jsx("div",{children:e&&s.jsx(Zwt,{})}),s.jsxs(Q,{gap:["xs"],direction:"column",children:[s.jsx($b,{"data-test":"google-map-geolocate-button",type:"button",onClick:n,children:s.jsx(pe,{verticalAlign:"middle",width:18,height:18,name:"map_location"})}),s.jsx($b,{"data-test":"google-map-zoom-in-button",type:"button",onClick:o,children:s.jsx(pe,{verticalAlign:"middle",width:18,height:18,name:"plus"})}),s.jsx($b,{"data-test":"google-map-zoom-out-button",type:"button",onClick:r,children:s.jsx(pe,{verticalAlign:"middle",width:18,height:18,name:"minus"})})]})]})},r$=v(x)`
    border-start-start-radius: 0;
    border-end-start-radius: 0;
`,eFt=({id:e,defaultValue:t="",placeholderMessage:n,hasError:o,onSubmit:r,onChange:a})=>{const[i,l]=h.useState(t),c=()=>{},d=p=>{l(p.target.value),a(p.target.value)},u=p=>{p.preventDefault(),r(i)};return s.jsx("form",{onSubmit:u,children:s.jsxs(im,{children:[s.jsx(Wo,{last:!0,hideLabel:!0,label:n,id:e,"data-test":`${e}-input`,name:"address_search",type:"text",placeholder:n,input:{onChange:d,onFocus:c},value:i,meta:{invalid:!1,touched:!1},hasError:o}),s.jsxs(r$,{intent:"secondary",fill:!1,type:"submit","data-test":"address-search-button",children:[s.jsx(ie,{children:n}),s.jsx(r$.Icon,{name:"search"})]})]})})},tFt=v.div`
    @media (min-width: ${Ke.sm}em) {
        padding-inline-end: 100px;
    }

    @media (min-width: ${Ke.lg}em) {
        inline-size: 550px;
        block-size: auto;
        position: relative;
        padding-inline-end: 0;
    }

    inline-size: 100%;
    block-size: calc(100vb - 80px);
    position: absolute;
    padding-inline-end: calc(var(--salt-spacing-4) * 2);
    z-index: 1;

    & > div {
        border-radius: var(--salt-radius-default);
    }
`,sFt=v.div`
    @media (min-width: ${Ke.lg}em) {
        padding: 0;
    }

    padding: var(--salt-spacing-2);
    z-index: 2;
`,nFt=v.div`
    @media (min-width: ${Ke.lg}em) {
        padding: 0;
    }

    padding: var(--salt-spacing-2);
    position: relative;
    z-index: 3;
`,oFt=v(Q)`
    flex-grow: 1;
    justify-content: space-between;

    @media (min-width: ${Ke.lg}em) {
        block-size: 597px;
    }

    block-size: calc(100vb - 80px);
`,Hb=v.div`
    flex: 1;
    overflow: hidden;

    @media (min-width: ${Ke.lg}em) {
        max-inline-size: 290px;
    }
`,rFt=v.div`
    flex: 1;
    z-index: 2;
    padding-inline: var(--salt-spacing-2);
    pointer-events: none;

    @media (min-width: ${Ke.lg}em) {
        display: none;
    }
`,aFt=v.div`
    inline-size: 100%;
    block-size: 100%;
    z-index: 1;
    padding-inline-end: var(--salt-spacing-2);
    padding-block-end: var(--salt-spacing-4);
    position: absolute;
    display: none;
    pointer-events: none;

    @media (min-width: ${Ke.lg}em) {
        display: block;
    }
`,a$=v(xe)`
    background-color: var(--background-color);
`,Vse=({title:e="addresses.map-lookup.title",onAddressConfirm:t=()=>{},searchComponent:n="AddressSearchDropdown"})=>{const o=L(),r=F(),a=f(Gp),i=h.useRef(null),[l,c]=h.useState(),[d,u]=h.useState(!1),[p,g]=h.useState(!1),[E,y]=h.useState(!1),[I,S]=h.useState(!1),[C,T]=h.useState(),[_,A]=h.useState([]),{geoLocation:R,geoLocationError:P,isGeoLocationRequested:N}=VMt(),M=f(cE)[0],w=f(ge=>new RegExp(Ze(ge,"customer-addresses-address-details-postal-code-validation")||"")),j=f(D("dds.vp")),G=f(ge=>Number(Ze(ge,"google-maps-default-lat"))),W=f(ge=>Number(Ze(ge,"google-maps-default-long"))),H=f(ge=>Number(Ze(ge,"google-maps-default-zoom"))),[K,X]=h.useState();h.useEffect(()=>{if(N)if(P){const ge={lat:G,lng:W};X(ge),ce(ge)}else R&&(X(R),ce(R))},[R,P,N,G,W]);const q=o.formatMessage("addresses.map-lookup.input-placeholder"),ne=o.formatMessage("settings.address.book.add.modal.postcode.placeholder.aria.label"),ue=()=>{Z.info("delivery.collection.alert.location.permission.blocked")},oe=ge=>{const Se=ge.trim();if(!he(Se)){y(!0);return}y(!1),n==="AddressSearchDropdown"&&Ie(Se)},ye=()=>{if(!l||!l.location){Z.error("addresses.map-lookup.error-no-address");return}g(!1),u(!0),d_({latitude:l.location.latitude,longitude:l.location.longitude,postalCode:l.addressDetails.postalCode})(r).then(({deliverability:ge})=>{u(!1),ge==="DELIVERABLE"?t(l):g(!0)}).catch(()=>{u(!1),Z.error("toast.notification.generic.error")})},he=ge=>!ge||ge.length===0?!1:n==="AddressSearchWithButton"&&j?w.test(ge):!0,Ie=ge=>{const Se=ge.trim(),Ae=he(Se);if(S(!1),g(!1),!Ae){y(!0);return}y(!1),ptt(Se)(r).then(Ce=>{if(!Ce||Ce.length===0){S(!0);return}if(n==="AddressSearchWithButton"){const We=Ce[0];if(!We)return;be(We)}else n==="AddressSearchDropdown"&&A(Ce)}).catch(()=>{Z.error("toast.notification.generic.error")})},Fe=ge=>{const Se=_[ge];Se&&be(Se)},be=ge=>{htt(ge.id)(r).then(Se=>{const Ae=MS({latitude:Se.latitude,longitude:Se.longitude});i.current?.setCenter(Ae),me(Ae)}).catch(()=>{Z.error("toast.notification.generic.error")})},ce=ge=>{!ge||!M||C&&C.lat===ge.lat&&C.lng===ge.lng||(T(ge),g(!1),c(void 0),hst(TMt(ge),M,a)(r).then(Se=>{c(Se)}).catch(()=>{Z.error("toast.notification.generic.error")}))},me=Vr(ce,200),De=ge=>s.jsx(Hb,{"data-test":"address-search-item-dropdown",children:s.jsx(O,{children:ge.formattedAddress})});return s.jsxs(Q,{gap:["md"],direction:"column",children:[s.jsx(bt,{title:e}),s.jsx(ee,{as:"h1",children:s.jsx(b,{id:e})}),s.jsxs(Q,{gap:["md"],direction:"row",wrap:"nowrap",children:[s.jsxs(oFt,{gap:["sm"],direction:"column",children:[s.jsx(nFt,{children:n==="AddressSearchDropdown"?s.jsx(Gj,{id:"search",placeholderMessage:q,hasError:!1,onChange:Vr(oe,500),onItemSelected:Fe,children:_.map(ge=>De(ge))}):s.jsxs(h.Fragment,{children:[s.jsx(eFt,{id:"search-button",placeholderMessage:ne,hasError:E||I,onSubmit:Ie,onChange:Vr(oe,500)}),E&&s.jsx(a$,{className:"salt-m-t--2",children:s.jsx(O,{role:"alert",children:s.jsx(b,{id:"settings.address.book.add.modal.postcode.error"})})}),I&&s.jsx(a$,{className:"salt-m-t--2",children:s.jsx(O,{role:"alert",children:s.jsx(b,{id:"addresses.address-search.no-results-found"})})})]})}),s.jsx(rFt,{children:s.jsx(o$,{mapControlsRef:i,showGoogleIcon:!0})}),s.jsx(sFt,{children:s.jsx(xe,{children:s.jsxs(Q,{gap:["md"],direction:"column",children:[l&&s.jsxs(h.Fragment,{children:[s.jsxs(Q,{gap:["sm"],direction:"column",children:[s.jsxs(Hb,{children:[s.jsx(O,{bold:!0,size:"m",className:"salt-m-r--1",children:s.jsx(b,{id:"addresses.map-lookup.deliver-to"})}),s.jsx(O,{size:"m",children:l.formattedAddress})]}),p&&s.jsx(O,{intent:"error",role:"alert",className:"salt-m-t--4",children:s.jsx(Mg,{id:"addresses.address-search.address-not-deliverable"})})]}),s.jsx(x,{onClick:ye,intent:"primary",fill:!1,"data-test":"map-lookup-button",loading:d,children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.map-lookup.confirm"})})})]}),!l&&s.jsxs(h.Fragment,{children:[s.jsx(Q,{gap:["sm"],direction:"column",children:s.jsxs(Q,{gap:["sm"],direction:"row","flex-wrap":"no-wrap",children:[s.jsx(O,{bold:!0,size:"m",children:s.jsx(b,{id:"addresses.map-lookup.deliver-to"})}),s.jsx(Hb,{children:s.jsx(_e,{height:"18px"})}),s.jsx(_e,{className:"salt-m-b--2",height:"18px"})]})}),s.jsx(_e.Button,{fill:!0,"data-test":"map-lookup-skeleton-button"})]})]})})})]}),s.jsxs(tFt,{children:[s.jsx(aFt,{children:s.jsx(o$,{mapControlsRef:i})}),K&&s.jsx(Uj,{ref:i,height:"100%",center:K,zoom:H,onGeolocationError:ue,onCenterChanged:me,showZoomButtons:!1,showGeolocationButton:!1,showFixedMarker:!0,interactive:!0})]})]})]})},iFt=({onConfirm:e,onVisibleComponentChange:t})=>{const n=F(),[o,r]=h.useState("MAP_LOOKUP"),[a,i]=h.useState(),l=qE(),d=f(cE)[0],u=f(Ms);h.useEffect(()=>{t(o)},[o]);const p=y=>{i(y),r("CONFIRM")},g=async(y,I)=>{if(!a)return;const S=y.addressLine2,C={...a,addressName:y.nickname,deliveryInstructions:y.notes,formattedAddress:y.formattedAddress,language:u,countryCode:d,location:a.location,lookupId:a.lookupId};S&&S.length>0&&(C.additionalInformation=S),u9(C)(n).then(T=>l(T.addressId)).then(({addressId:T,deliveryDestinationId:_})=>{e&&e(T,_)}).catch(()=>{Z.error("toast.notification.generic.error"),I()})},E=()=>{r("MAP_LOOKUP")};switch(o){case"CONFIRM":return s.jsx(u_,{address:a,showWarningIfAddressLine2Empty:!1,showMap:!0,showDeliveryInstructions:!1,addressLine2Label:"addresses.address-search.floor-door-number",onSubmit:g,onBack:E});case"MAP_LOOKUP":default:return s.jsx(Vse,{onAddressConfirm:p})}},lFt=({modalName:e=Rr,onModalClose:t,onAddressSave:n})=>{const o=F(),r=f($e(e)),{currentBreakpoint:a}=h.useContext(kn),i=a==="lg"?"lg":"md",[l,c]=h.useState("MAP_LOOKUP"),[d,u]=h.useState(i),p=()=>{t(),o(J.closeModal())},g=(y,I)=>{n(y,I),o(J.closeModal())},E=y=>{c(y)};return h.useEffect(()=>{u(l==="CONFIRM"?"sm":i)},[l,a,i]),s.jsx(B,{isOpen:r,onRequestClose:p,maxWidth:d,children:s.jsx(B.Body,{children:s.jsx(iFt,{onConfirm:g,onVisibleComponentChange:E})})})},cFt=({flow:e,modalName:t=Rr,submitAddAddress:n=()=>{},onModalClose:o=()=>{}})=>{switch(e){case Co.MANUAL_FORM:case Co.MANUAL_FORM_POSTCODE:return s.jsx(vMt,{modalName:t,onAddressSave:n,onModalClose:o});case Co.MANUAL_FORM_MAP:return s.jsx(owt,{modalName:t,onAddressSave:n,onModalClose:o});case Co.INTERNATIONAL:return s.jsx(Fwt,{modalName:t,onAddressSave:n,onModalClose:o});case Co.UK_POSTCODE_MAP_BACKUP:return s.jsx(Xwt,{modalName:t,onAddressSave:n,onModalClose:o});case Co.KOREAN_ROAD_NAME:return s.jsx(qwt,{modalName:t,onAddressSave:n,onModalClose:o});case Co.MAP_LOOKUP:return s.jsx(lFt,{modalName:t,onAddressSave:n,onModalClose:o});case Co.UK_POSTCODE:default:return s.jsx(xwt,{modalName:t,onAddressSave:n,onModalClose:o})}},dFt=e=>({flow:WE(e)}),p_=we(dFt)(cFt),uFt=(e,t)=>({type:Ns.CHANGE_ADDRESS_BUTTON_CLICKED,payload:{existingDeliveryMethodChanged:e,deliveryMethod:t}}),pFt=e=>({type:Ns.DELIVERY_DESTINATION_HEADER_CLICKED,payload:{deliveryMethod:e}}),mFt=e=>({type:Ns.HOMEPAGE_DELIVERY_DESTINATION_CARD_CLICKED,payload:{deliveryMethod:e}}),hFt=()=>({type:Ns.DELIVERY_DESTINATIONS_SELECTOR_SEARCH_FOCUS}),wi=e=>({type:Ns.DELIVERY_DESTINATION_MODAL_CLOSED,payload:e}),gFt=e=>({type:Ns.DELIVERY_OPTION_MODAL_TRIGGERED,payload:e}),EFt=e=>({type:Ns.HOMEPAGE_BOX_DDS_IMPRESSION,payload:e}),Wse="DEFAULT_CONFIG",Yse="SIMPLIFIED_DELIVERY_CHANGE_CONFIG",i$={[Wse]:{titleId:"delivery.destination.changeConfirmation.header.title",withSlotWarningText:"delivery.destination.changeConfirmation.message.withSlot",withoutSlotWarningText:"delivery.destination.changeConfirmation.message.withoutSlot"},[Yse]:{titleId:"delivery.destination.simple.changeConfirmation.header.title",withSlotWarningText:"delivery.destination.simple.changeConfirmation.message.withSlot",withoutSlotWarningText:"delivery.destination.simple.changeConfirmation.message.withoutSlot"}},qse=e=>e?i$[Yse]:i$[Wse],Kse=()=>{const[e,t]=Ee(["sl.dds","sl.rd"]),n=!!(e||t),o=f(r=>pE(r,[jt()]));return n&&o},fFt=()=>{const{formatMessage:e}=L(),t=Kse(),n=qse(t),o=f(TC);return e(o?n.withSlotWarningText:n.withoutSlotWarningText)},yFt=()=>{const e=F(),t=Kse(),n=qse(t),o=fFt(),{isOpen:r,options:a}=Wt(kP),i=Wt(a?.previous).open,l=()=>{i()},c=wc(),d=Rm(!0,t),u=()=>{if(a?.deliveryDestination){const p={deliveryDestinationId:a.deliveryDestination.deliveryDestinationId,deliveryDestinationChanged:!0,deliveryMethod:a.deliveryDestination.deliveryMethod,userAction:"Delivery method updated",newDeliveryDestinationAdded:!c||c&&!c.data};e(wi(p)),d({addressId:a.deliveryDestination.addressId,deliveryDestinationId:a.deliveryDestination.deliveryDestinationId,regionId:a.deliveryDestination.resolvedRegionId})}};return{isOpen:r,options:a,headerLabelId:n.titleId,deliveryDestinationChangeWarningText:o,confirmDeliveryDestinationChange:u,onBack:l}},Wj=()=>{const e=F();return(t,n)=>e(hn.openChangeDeliveryDestinationConfirmationModal(t,n))},l$="delivery.type.select.breadcrumb",IFt=()=>{const e=F(),{formatMessage:t}=L(),{currentBreakpoint:n}=h.useContext(kn),o=n==="lg"?"lg":"md",r=wc(),a=Wt(Fd),i=Wj(),l=WN(),c=()=>{e(hn.invalidateCustomerCollectionDeliveryDestinations())},d=p=>{if(c(),l(p)){const g={deliveryDestinationId:p.deliveryDestinationId,deliveryDestinationChanged:!1,deliveryMethod:p.deliveryMethod,userAction:"Delivery destination already selected"};return e(wi(g)),a.close()}return i(Fd,p)};return{...a,close:()=>{e(wi({deliveryDestinationChanged:!1,userAction:"Close"})),c(),a.close()},headerLabelId:l$,modalHeader:t(l$),isLoading:!1,modalSize:o,setSelectedDeliveryDestination:d,deliveryDestinationFromSession:r}},Vb={logInButtonText:"delivery.destination.visitor.loginButtonText",loginDescriptionText:"delivery.destination.visitor.loginDescriptionText"},SFt=()=>{const{formatMessage:e}=L(),t=F(),n=Ge();return{loginAction:()=>{n(Ui()),t(wi({deliveryDestinationChanged:!1,userAction:"Log in or register"})),t(J.closeModal())},logInButtonText:e(Vb.logInButtonText),loginDescriptionText:e(Vb.loginDescriptionText),loginButtonMessages:Vb}},CFt=v.div`
    display: flex;
    gap: var(--salt-spacing-4);
    inline-size: 100%;
    align-self: flex-end;
    flex-direction: column;
`,vFt=()=>{const{logInButtonText:e,loginDescriptionText:t,loginAction:n}=SFt();return s.jsxs(CFt,{children:[s.jsx(Ts,{}),t,s.jsx(x,{intent:"secondary",onClick:n,children:s.jsx(x.Text,{children:e})})]})},zse={alignItems:"start",justifyContent:"left",textAlign:"left"},Qse={...zse,marginBottom:"8px",lineHeight:"20px"},Xse={fontSize:"16px"},Zse={...zse,marginBottom:"8px",padding:"0",fontSize:"16px",lineHeight:"20px"},TFt=({chooseButton:e=void 0,chooseDeliveryButtonAccessibilityText:t})=>e?s.jsx(Oe.Action.Footer,{children:s.jsx(x,{intent:"primary",id:"select-temporary-home-address","data-test":"select-temporary-home-address","data-synthetics":"select-temporary-home-address","aria-label":t,onClick:e.onClick,children:s.jsx(x.Text,{children:e.chooseDeliveryButtonText})})}):null,_Ft=({text:e=void 0})=>e?s.jsx(Te,{intent:"warning",text:e,showIcon:!1}):null,bFt=({temporaryDeliveryDestinationWarningText:e,chooseDeliveryButtonAccessibilityText:t})=>s.jsxs(Oe.Action.Body,{style:{...Zse,marginBottom:0},children:[t,s.jsx(_Ft,{text:e})]}),xFt=({temporaryDeliveryDestination:e,temporaryDeliveryDestinationWarningText:t,chooseDeliveryButtonAccessibilityText:n,chooseButton:o})=>e?s.jsxs(Oe.Action,{as:"li",id:"temporaryDeliveryDestination","data-test":"temporaryDeliveryDestination",chip:void 0,innerRef:void 0,children:[s.jsxs(Oe.Action.Header,{style:Qse,children:[s.jsx(pe,{name:"home_delivery",height:20,width:20}),s.jsx(Oe.Action.HeaderText,{style:Xse,"data-test":"collection-location-name",as:"h4",children:e.name})]}),s.jsx(bFt,{temporaryDeliveryDestinationWarningText:t,chooseDeliveryButtonAccessibilityText:n}),s.jsx(TFt,{chooseButton:o,chooseDeliveryButtonAccessibilityText:n})]},"temporaryDeliveryDestination"):s.jsx("div",{}),AFt="postal_code",RFt="postal_code_prefix",Pu=({data:e})=>e.delivery.clickAndCollect.search,Jse=Y(Pu,e=>({query:e.query,lastUpdated:e.lastUpdated})),ene=Y(Pu,e=>({error:e.error,result:e.result})),$A=e=>{const{long_name:t}=e?.address_components?.find(n=>n.types.includes(AFt)&&!n.types.includes(RFt))||{};return t},DFt=Y(Pu,e=>$A(e.result)),OFt=e=>e.control.delivery.temporaryDeliveryDestination,PFt=()=>{const[e]=Ee(["homedel"]),{query:t}=f(Jse),{result:n}=f(ene),o=f(DFt),{formatMessage:r}=L(),a=f(Gp),i=n?.geometry.location.lat(),l=n?.geometry.location.lng(),c=o||t,d=n?.formatted_address,u=F();h.useEffect(()=>{e&&i&&l&&c&&d&&_Mt({name:r("delivery.destination.temporary.home.header"),formattedAddress:d,latitude:i,longitude:l,postalCode:c},u)},[d,c,i,l]);const p=f(OFt),g=p&&p.deliverability!=="NOT_DELIVERABLE"||!1,E=g?void 0:r("delivery.destination.temporary.home.alert.nondeliverable"),y=g&&p?r("accessibility.delivery.destination.temporary.home.button",{postalCode:p.postalCode,formatted_address:p.formattedAddress}):void 0,I=r("delivery.destination.visitor.address.list.collection.header"),S=p&&g?{chooseDeliveryButtonText:r("delivery.destination.temporary.home.chooseButton"),onClick:()=>xMt({...p.coordinates,...p,visitorId:a},u)}:void 0;return e?{temporaryDeliveryDestination:p,chooseButton:S,chooseDeliveryButtonAccessibilityText:y,temporaryDeliveryDestinationWarningText:E,collectionPointsHeader:I}:{temporaryDeliveryDestination:null}},NFt=({showCollectionPoints:e})=>{const{chooseButton:t,chooseDeliveryButtonAccessibilityText:n,temporaryDeliveryDestinationWarningText:o,temporaryDeliveryDestination:r,collectionPointsHeader:a}=PFt();return r?s.jsxs(h.Fragment,{children:[s.jsx(xFt,{chooseButton:t,temporaryDeliveryDestination:r,temporaryDeliveryDestinationWarningText:o,chooseDeliveryButtonAccessibilityText:n}),e?s.jsx("div",{className:"salt-m-b--4",children:a}):null]}):null},Wb="ZERO_RESULTS",LFt=e=>({geocodeConnectionErrorTitle:e.formatMessage("delivery.collection.geocode.connection.error.title"),geocodeConnectionError:e.formatMessage("delivery.collection.geocode.connection.error.message"),geocodeResultsErrorTitle:e.formatMessage("delivery.collection.geocode.results.error.title"),geocodeResultsError:e.formatMessage("delivery.collection.geocode.results.error.message")});class kFt extends h.Component{formattedMessages;constructor(t){super(t);const{intl:n}=this.props;this.formattedMessages=LFt(n),this.renderGeocodeError=this.renderGeocodeError.bind(this)}componentDidUpdate(){const{geocode:t}=this.props;t.error&&t.error!==Wb&&Ue.api.pushError(new Error(`Geocode error: ${t.error}`))}componentWillUnmount(){this.props.actions.clearGeocodeError()}renderGeocodeError(){const{geocode:t}=this.props,n=t.error===Wb?this.formattedMessages.geocodeResultsErrorTitle:this.formattedMessages.geocodeConnectionErrorTitle,o=t.error===Wb?this.formattedMessages.geocodeResultsError:this.formattedMessages.geocodeConnectionError,r=s.jsxs(O,{children:[s.jsx(O,{bold:!0,children:n})," ",o]}),a="error";return t.error&&s.jsx(Te,{className:"salt-m-b--4","data-test":"geocode-error-alert","data-test-type":a,intent:a,text:r,title:n})}render(){return this.renderGeocodeError()||null}}const jFt=e=>({geocode:Pu(e)}),MFt=st({clearGeocodeError:Ss.clearGeocodeError}),wFt=Tt(Ht,we(jFt,MFt))(kFt),FFt=({intl:e,filters:t,applyFilters:n})=>{const o=h.useRef(null),[r,a]=h.useState(new Map),[i,l]=h.useState(!1);h.useEffect(()=>{const g=E=>{o.current.contains(E.target)||l(!1)};return document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[]);const c=()=>{l(!i),a(new Map)},d=()=>{r.size>0&&n([...r.values()]),c()},u=g=>{const E=r.get(g.id);return E?E.selected:g.selected},p=g=>E=>{const y=new Map([[g.id,{...g,selected:E.target.checked}]]);a(new Map([...r,...y]))};return s.jsxs(rt.Container,{ref:o,children:[s.jsx(rt.TriggerDefaultButton,{isOpen:i,fill:!0,text:e.formatMessage("delivery.collection.filter.button.label"),onClick:c,"data-test":"collection-point-filter-dropdown-toggle"}),s.jsxs(rt.Body,{"data-test":"collection-point-filter-dropdown",isOpen:i,children:[s.jsxs(rt.Content,{children:[s.jsx("div",{className:"salt-m-b--2",children:s.jsx(O,{bold:!0,children:s.jsx(b,{id:"delivery.collection.filter.type.text"})})}),t.map(g=>s.jsx(Lo,{bold:!0,label:e.formatMessage(g.labelId),input:{checked:u(g),onChange:p(g)},"data-test":`collection-point-filter-${g.id}`},g.id))]}),s.jsx(rt.Footer,{children:s.jsx(x,{"data-test":"collection-point-filter-apply-button",onClick:d,intent:"primary",children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.collection.filter.apply.button.label"})})})})]})]})},BFt=Ht(FFt),UFt=({filters:e,clearSingleFilter:t,clearAllFilters:n})=>{const o=()=>e.filter(a=>a.selected).map(a=>s.jsx("div",{className:"salt-d--inline-block salt-m-t--1 salt-m-r--1",children:s.jsx(JO,{"data-test":a.id,minSize:"md",onClick:()=>t(a),children:s.jsx(b,{id:a.labelId})},`filter-${a.id}`)},a.id)),r=()=>e.some(a=>a.selected)?s.jsx(x,{intent:"tertiary",fill:!1,"data-test":"collection-points-clear-all-filters",onClick:n,children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.collection.filter.clearAll"})})}):null;return s.jsxs(ae.Fragment,{children:[o(),r()]})},Hu={clearSingleCollectionPointFilter:Ss.clearSingleCollectionPointFilter,clearAllCollectionPointFilters:Ss.clearAllCollectionPointFilters,applyCollectionPointFilters:Ss.applyCollectionPointFilters,clearGeocodeError:Ss.clearGeocodeError,setGeocodeSearchQuery:Ss.setGeocodeSearchQuery,setNearbyCollectionPointsFetching:Ss.setNearbyCollectionPointsFetching},wS="slotbooking-basket-split-modal-header",tne=e=>{const{addressId:t,closeModal:n,confirmAction:o,cancelAction:r,errorAction:a=()=>{}}=e,[i,l]=h.useState(!1),{basketChangedModalDisplayed:c,basketChangedModalConfirmButtonClicked:d,basketChangedModalCancelButtonClicked:u}=Or();h.useEffect(()=>{c({addressId:t})},[]);const p=()=>{u(),r().then(()=>n())},g=()=>{l(!0),d(),o().then(()=>{l(!1),n()}).catch(()=>{l(!1),a()})};return s.jsxs(h.Fragment,{children:[s.jsxs("div",{"aria-live":"polite",id:wS,children:[s.jsx(B.Header,{align:"left","aria-live":"polite",children:s.jsx(ee,{as:"h1",id:wS,children:s.jsx(b,{id:"slotbooking.address.change.affect.trolley.title"})})},"header"),s.jsxs(B.Body,{children:[s.jsx(rr,{className:"salt-m-b--4",children:s.jsx(O,{className:"salt-d--block",children:s.jsx(b,{id:"slotbooking.address.change.affect.trolley.line1"})})}),s.jsx(O,{className:"salt-d--block",children:s.jsx(b,{id:"slotbooking.address.change.affect.trolley.line2"})})]},"body")]}),s.jsxs(B.Footer,{className:"salt-gap-x--2",align:"left",children:[s.jsx(x,{onClick:p,intent:"secondary",fill:!0,children:s.jsx(b,{id:"slotbooking.address.change.affect.trolley.cancel"})}),s.jsx(x,{onClick:g,intent:"primary",loading:i,fill:!0,children:s.jsx(b,{id:"slotbooking.address.change.affect.trolley.confirm"})})]},"footer")]})},HA="addressChangedBasked",GFt=()=>{const e=F(),t=Ge(),n=Kk(),o=()=>e(J.closeModal()),r=f(y=>y.router.location.search),a=f($e(HA)),i=f(Ys),l=f(zs).data,c=f(Po),d=f($i),u=Rm(),p=()=>e(hn.getSelectedDeliveryDestinationData(c)).then(y=>u({addressId:y.payload.responseData.addressId,deliveryDestinationId:y.payload.responseData.deliveryDestinationId,regionId:y.payload.responseData.resolvedRegionId})).then(()=>t(n)),g=async()=>{i!==l?.deliveryMethod&&t(Ui({queryString:r})),e(qV.setSelectedDeliveryDestinationId(d))},E=()=>Z.error("toast.notification.generic.error");return s.jsx(B,{showCloseIcon:!0,onRequestClose:()=>{g(),o()},isOpen:a,aria:{labelledby:wS},children:s.jsx(tne,{addressId:c||"",closeModal:o,cancelAction:g,confirmAction:p,errorAction:E})})},$Ft=(e,t,n)=>t&&Object.keys(t).length>0?e.map(({deliveryDestinationId:o,distance:r})=>({...t[o],distance:r})).filter(o=>!HFt(n)||n.filter(r=>r.selected).some(r=>r.supportedType===o.collectionPointType)):[],HFt=e=>e&&e.some(t=>t.selected),Yj=Y(e=>e.data.delivery.clickAndCollect.collectionPoints.nearbyCollectionPointsOrderWithDistance||[],e=>e.data.delivery.destinations.customerCollection.data,e=>e.data.delivery.clickAndCollect.collectionPoints.filters,$Ft),VFt=({data:e})=>e.delivery.clickAndCollect.collectionPoints.nearbyCollectionPointsStatus,WFt=({data:e})=>e.delivery.destinations.customerCollection.didInvalidate,YFt=({data:e})=>e.delivery.clickAndCollect.collectionPoints.geocodeLookupComplete,qFt=()=>{const e=F();return t=>e(U.analyticsEvent({type:Ns.DELIVERY_DESTINATIONS_SELECTOR_GEOLOCATION_EVENT,payload:t}))},KFt=()=>{const e=F();return t=>e(mFt(t?.deliveryMethod))},zFt=()=>{const e=F(),t=Qk();return(n,o)=>{e(uFt(n,o)),e(U.analyticsEvent({type:Ns.SELECT_DELIVERY_DESTINATION,deliveryMethod:o,groupId:t}));const r={event:"select_delivery_destination",method:o,group_id:t??""};te.sendEvent({GA:r,WA:null})}},c$="delivery.type.collect.point.modal.title",QFt=e=>{const t=F(),n=f(ru),o=f(YFt),r=n.isFetching&&!o,{formatMessage:a}=L(),{currentBreakpoint:i}=h.useContext(kn),l=i==="lg"?"lg":"md",c=a(c$),d=wc(),u=Wt(e),p=Wj(),g=WN(),E=f(ou),y=Wt(gc).open,I=()=>{t(hn.invalidateCustomerCollectionDeliveryDestinations())};return{...u,open:()=>u.open(),close:()=>{t(wi({deliveryDestinationChanged:!1,userAction:"Close"})),I(),u.close()},modalHeader:c,headerLabelId:c$,isLoading:r,modalSize:l,setSelectedDeliveryDestinationDefault:T=>{if(E){u.close(),y({currentDeliveryDestination:T});return}if(I(),g(T)){const _={deliveryDestinationId:T.deliveryDestinationId,deliveryDestinationChanged:!1,deliveryMethod:T.deliveryMethod,userAction:"Delivery destination already selected"};t(wi(_)),u.close();return}p(Em,T)},deliveryDestinationFromSession:d}},sne=()=>{const{formatMessage:e}=L(),t=Gtt(),n=e("delivery.collection.toggle.button.view.list"),o=e("delivery.collection.toggle.button.view.map"),r=e("delivery.collection.map.header.accessibility"),a=e("delivery.destination.collection.changeAddress.button.nearMe"),i=f(Yj),l=f(WFt),{buildLink:c,buildLinkParams:d,resetActiveAddressId:u}=QBt(),p=qFt();return{accessibilityMapHeader:r,listView:n,mapView:o,nearMeButtonText:a,customerCollections:l?[]:i,loadCustomerCollectionDestinations:t,buildLink:c,buildLinkParams:d,resetActiveAddressId:u,sendGeolocationEvent:p}},XFt=v(r4)`
    block-size: 100%;
`,FS=({show:e,children:t})=>s.jsx(XFt,{show:e,children:t}),m_=({data:e})=>e.delivery.clickAndCollect.collectionPoints.activeCustomerCollection,ZFt=v.div`
    align-items: center;
    display: flex;

    > * {
        overflow: hidden;
        text-overflow: ellipsis;
    }

    &:last-child {
        padding-block-end: 0;
    }
`,Yb=v(ZFt)`
    margin-inline-start: var(--salt-spacing-8);
`,JFt=v.li`
    border-block-end: var(--salt-border-1) solid var(--intent-secondary);
    display: flex;
    flex-direction: column;
    padding: var(--salt-spacing-2);
    position: relative;
    background-color: var(--intent-contrast);

    &:focus {
        outline-offset: -4px;
        background-color: var(--intent-primary-50);
    }

    &:last-child {
        border: none;
        margin: 0;
    }
`,qj=()=>s.jsxs(JFt,{children:[s.jsx(Yb,{children:s.jsx(_e,{className:"salt-m-b--2",height:"15px"})}),s.jsx(Yb,{children:s.jsx(_e,{className:"salt-m-b--2",height:"15px"})}),s.jsx(Yb,{children:s.jsx(_e,{className:"salt-d--inline-block",height:"40px"})})]}),eBt=(e,t,n)=>{if(e===void 0)return;const a=e/(t?1609.344:1e3);return n.formatNumber(a,{minimumFractionDigits:1,maximumFractionDigits:1})},tBt=({retailerSettings:e})=>e["use-mile-as-distance-unit"],sBt=()=>f(Y(tBt,e=>String(e).toLowerCase()==="true")),nne=()=>{const e=sBt(),t=L();return{messageId:e?"delivery.collection.distance.format.miles":"delivery.collection.distance.format.kilometers",convertDistanceInMeters:o=>eBt(o,e,t)}},nBt=()=>f(mQ),oBt=v(O)`
    white-space: nowrap;
`,rBt={className:""},one=({className:e,distanceInMeters:t})=>{const{messageId:n,convertDistanceInMeters:o}=nne(),r=nBt(),a=o(t);return r?s.jsx("div",{className:e,children:s.jsx(oBt,{size:"l",children:a&&s.jsx(b,{id:n,values:{distance:a}})})}):null};one.defaultProps=rBt;function h_({html:e,as:t="div",...n}){return s.jsx(t,{...n,dangerouslySetInnerHTML:{__html:Ri(e)}})}const aBt={alignItems:"start",justifyContent:"left",textAlign:"left"},iBt={marginLeft:0},lBt={marginBottom:"16px"},cBt=()=>({borderStyle:"solid",borderWidth:"1px",borderColor:"var(--intent-primary)"}),dBt=v(Oe.Action.Header)`
    align-items: start;
    justify-content: left;
    text-align: start;
    margin-block-end: ${$(6)};
`,uBt=v(Oe.Action.HeaderText)`
    font-size: ${$(16)};
`,pBt={...aBt,marginBottom:"6px",padding:"0",fontSize:"16px"},mBt=v.div`
    align-items: start;
    justify-content: left;
    text-align: start;
    margin-block-end: var(--salt-spacing-2);
`,hBt=v(one)`
    margin-inline-start: auto;
    font-size: ${$(16)};
`,gBt=v(ln)`
    position: absolute;
    inset-block-start: calc(var(--salt-spacing-2) * -1);
    inset-inline-start: calc(var(--salt-spacing-2) * -1);
`,rne=({address:e,onPreviewClick:t=()=>{},onSelectClick:n,id:o,key:r,selected:a,innerRef:i,showPreviewButton:l,asListElement:c,infoWindowDataTestId:d})=>{const u=L(),[p,g]=Ee(["cptb","cptlw"]),E=f(mQ),y={...p?lBt:iBt,...a?cBt:void 0},I=nne(),S=()=>{if(g&&dp.LOCKER===e.collectionPointType)return s.jsx(mBt,{children:s.jsx(Te,{intent:"warning",size:"s",text:u.formatMessage("delivery.collection.type.locker.warning.text")})})},C=()=>{switch(e.collectionPointType){case dp.LOCKER:return u.formatMessage("delivery.collection.type.locker.text");case dp.MOBILE:return u.formatMessage("delivery.collection.type.mobile.text");default:return u.formatMessage("delivery.collection.type.collectionPoint.text")}},T=()=>{const A=e.distance;return A?u.formatMessage(I.messageId,{distance:I.convertDistanceInMeters(A)}):""},_=()=>p?s.jsx(gBt,{intent:"secondary",text:C(),singleLine:!0}):void 0;return s.jsxs(Oe.Action,{as:c?"li":void 0,id:o,"data-test":o,chip:_(),style:y,innerRef:i,children:[s.jsxs(dBt,{children:[a&&s.jsx(pe,{name:"map_marker_hollow",height:24,width:24,primary:!0}),s.jsx(uBt,{"data-test":"collection-location-name",as:"h4",children:e.name}),s.jsx(hBt,{distanceInMeters:e.distance})]}),s.jsx(Oe.Action.Body,{style:pBt,children:s.jsx(h_,{html:e.formattedAddress})}),s.jsxs(Oe.Action.Footer,{children:[S(),s.jsxs("div",{className:"salt-d--flex salt-gap--2",children:[s.jsx(x,{fill:!0,size:"s",intent:"secondary",id:`select-button-collection-location-id-${e.addressId}`,"data-test":`select-button-collection-location-id-${e.addressId}`,"data-testid":d||`select-button-collection-location-id-${e.name}`,"data-synthetics":"address-select-button","aria-label":E?u.formatMessage("delivery.collection.address.select.button.text.with.distance.accessibility",{addressNickname:e.name,address:e.formattedAddress,distance:T()}):u.formatMessage("delivery.collection.address.select.button.accessibility",{addressNickname:e.name,address:e.formattedAddress}),onClick:n,children:s.jsx(x.Text,{children:u.formatMessage("delivery.collection.address.select.button")})}),l&&s.jsx(x,{fill:!1,size:"s",intent:"secondary","aria-label":u.formatMessage("delivery.collection.address.preview.button.accessibility",{addressNickname:e.name}),onClick:t,"data-test":`preview-button-collection-location-id-${e.addressId}`,children:s.jsx(pe,{name:"preview"})})]})]})]},r)},EBt=v.div`
    border: none;
    position: relative;
    overflow: hidden;
`,fBt=v.div`
    padding-block-end: var(--salt-spacing-2);

    &:last-child {
        padding-block-end: 0;
    }
`,yBt=v.ul`
    margin: 0;
    overflow-y: auto;
    scroll-behavior: smooth;
    padding: 0;
    ${re.mdUp`
            max-height: ${$(500)};
        `};
`,IBt=({children:e})=>s.jsx(EBt,{children:s.jsx(fBt,{children:s.jsx(yBt,{children:e})})}),ane=({onDeliveryDestinationSelect:e,isLoading:t,customerCollections:n=[],topElement:o})=>{const r=f(Pu),a=F(),i=f(m_),l=E=>a(Ss.toggleActiveCustomerCollection(E)),c={},d=(E,y)=>{y.addressId&&(c[y.addressId]=y)},u=E=>s.jsx(rne,{address:E,onPreviewClick:()=>l(E),onSelectClick:()=>e(E),id:E.deliveryDestinationId,selected:i?.deliveryDestinationId===E.deliveryDestinationId,innerRef:y=>d(y,E),showPreviewButton:!0,asListElement:!0},E.deliveryDestinationId),p=t?Array.from(Array(3),(E,y)=>s.jsx(qj,{},y)):n.map(u),g=o?[o]:[];return r?.error?null:s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:s.jsx(b,{id:"delivery.collection.list.header.accessibility"})})}),s.jsx(IBt,{children:[...g,...p]})]})},SBt=({result:e,latLng:t,getGeocode:n=()=>Promise.resolve([])})=>async o=>{if(!$A(e))try{const i=(await n({location:t})).find(l=>$A(l));if(i)return await o(Ss.setGeocode({geocode:i}))}catch{}return o(Ss.setGeocode({geocode:e}))},CBt={saveResult:SBt},vBt=v.button`
    cursor: pointer;
    user-select: none;
    border-radius: 2px;
    border: none;
    background: white;
    block-size: 40px;
    inline-size: 40px;
    margin-inline-end: 10px;
    padding: 0;
`,TBt=v(pe)`
    vertical-align: middle;

    svg {
        fill: #666;
        block-size: 40px;
        inline-size: 40px;
        padding: 8px;
    }

    svg:hover {
        fill: #333;
    }
`,_Bt=(e,t,n,o)=>{const a=document.createElement("div"),i=s.jsx(gR,{store:n,children:s.jsx(vBt,{onClick:t,"aria-label":o.formatMessage("delivery.collection.map.location.button.accessibility"),children:s.jsx(TBt,{name:"map_location"})})});lR.createRoot(a).render(i),e.controls?.[9].push(a)},bBt=({height:e="100%",center:t,zoom:n=2,onLoad:o=()=>{},onBoundsChanged:r=()=>{},onCurrentLocationClick:a=()=>{},children:i})=>{const l=L(),c=Number(es("google-maps-default-zoom")??10),{isLoaded:d,reactMapId:u}=Mse(),p=Yd(),g=E=>{E.setCenter?.(t),_Bt(E,a,p,l),o(E)};return d?s.jsx(fH,{id:u,mapContainerStyle:{height:e},options:{streetViewControl:!1},zoom:n||c,onLoad:g,onBoundsChanged:r,children:i}):s.jsx(_e,{height:e})},xBt=h.memo(bBt),ABt={minWidth:"300px",maxWidth:"300px"};class RBt extends h.Component{constructor(t){super(t),this.state={isMobileLayout:this.isMobileLayout()},this.addWindowResizeListener=this.addWindowResizeListener.bind(this),this.removeWindowResizeListener=this.removeWindowResizeListener.bind(this),this.refreshIsMobileLayoutState=this.refreshIsMobileLayoutState.bind(this),this.isMobileLayout=this.isMobileLayout.bind(this),this.addWindowResizeListener()}componentWillUnmount(){this.removeWindowResizeListener()}refreshIsMobileLayoutState(){this.setState({isMobileLayout:this.isMobileLayout()})}isMobileLayout(){return!Rwe.isMdUp()}addWindowResizeListener(){window.addEventListener("resize",this.refreshIsMobileLayoutState)}removeWindowResizeListener(){window.removeEventListener("resize",this.refreshIsMobileLayoutState)}render(){const{address:t,activeCustomerCollection:n,position:o,actions:{toggleActiveCustomerCollection:r}}=this.props,{isMobileLayout:a}=this.state,i=new google.maps.MVCObject;i.set("position",o),i.set("anchorPoint",new google.maps.Point(11,-30));const l=t.deliveryDestinationId===n?.deliveryDestinationId;return a&&l?s.jsx(jce,{anchor:i,options:ABt,onCloseClick:()=>r(t),children:s.jsx(O,{id:"collection-point-card-text",className:"salt-d--flex",children:s.jsx(rne,{address:t,id:`info-window-collection-location-id-${t.addressId}`,onSelectClick:()=>this.props.onDeliveryDestinationSelect(t),infoWindowDataTestId:`info-window-select-button-collection-location-id-${t.name}`},`info-window-${t.addressId}`)})}):null}}const DBt=e=>({activeCustomerCollection:m_(e)}),OBt=st({analyticsEvent:U.analyticsEvent,toggleActiveCustomerCollection:Ss.toggleActiveCustomerCollection,setSelectedAddress:Wa.setSelectedAddress}),PBt=Tt(Ht,we(DBt,OBt))(RBt),d$={iconOffset:[7,20],labelOffset:[7,7]},u$=e=>e&&typeof e.lat=="number"&&typeof e.lng=="number",p$=(e={},t,n,o,r,a={},i,l,c,d,u,p)=>{const g=u$(e)&&t.maps&&!n&&s.jsx(yh,{icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:d.location.fill,fillOpacity:d.location["fill-opacity"],strokeColor:d.location.stroke,strokeOpacity:d.location["stroke-opacity"],strokeWeight:d.location["stroke-weight"],scale:d.location.scale},position:{lat:e.lat,lng:e.lng}},e.lat+e.lng),E=u$(a)&&!n&&s.jsx(yh,{position:{lat:a.lat,lng:a.lng}},a.lat+a.lng),y=()=>{const C=u.map_marker_hollow.split("path d=")[1].split('"');return C&&C[1]};return I=>s.jsx(ae.Fragment,{children:o&&o.map(S=>s.jsx(yh,{clusterer:I,title:S.name,icon:{anchor:new google.maps.Point(...d$.iconOffset),path:y(),labelOrigin:new google.maps.Point(...d$.labelOffset),fillColor:c?.deliveryDestinationId===S.deliveryDestinationId?d.selectedIconFill:d.unselectedIconFill,strokeColor:d.stroke,fillOpacity:d["fill-opacity"],strokeWeight:d["stroke-weight"],scale:c?.deliveryDestinationId===S.deliveryDestinationId?d.selectedIconScale:d.unselectedIconScale},position:{lat:S.coordinates.latitude,lng:S.coordinates.longitude},onClick:()=>{r.analyticsEvent({type:Ns.C_N_C_ADDRESS_PIN_CLICK,addressId:S.addressId}),r.toggleActiveCustomerCollection(S),document.getElementById(`select-button-collection-location-id-${S.addressId}`)?.focus()},zIndex:c?.deliveryDestinationId===S.deliveryDestinationId?google.maps.Marker.MAX_ZINDEX:void 0,children:s.jsx(PBt,{position:{lat:S.coordinates.latitude,lng:S.coordinates.longitude},address:S,buildLinkParams:l,buildLink:i,deliveryMethod:pt.clickAndCollect,onDeliveryDestinationSelect:p})},S.addressId)).concat([g,E])})},m$={map_marker_hollow:'<svg viewBox="0 0 24 24"><path d="M12 2C15.7855 2 18.8691 5.00478 18.9959 8.75935L19 9C19 12.3333 16.6667 16.6667 12 22C7.33333 16.6667 5 12.3333 5 9L5.00406 8.75935C5.1309 5.00478 8.21455 2 12 2ZM12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6Z"/></svg>'},NBt=({user:e,mapProvider:t,error:n,nearbyCollectionPoints:o,actions:r,search:a,buildLink:i,buildLinkParams:l,activeCustomerCollection:c,onDeliveryDestinationSelect:d})=>c?s.jsx(h.Fragment,{children:p$(e,t,n,o,r,a,i,l,c,gg,m$,d)(void 0)}):s.jsx(Mce,{minimumClusterSize:4,children:p$(e,t,n,o,r,a,i,l,c,gg,m$,d)}),LBt=e=>({nearbyCollectionPoints:Yj(e),activeCustomerCollection:m_(e)}),kBt=st({analyticsEvent:U.analyticsEvent,toggleActiveCustomerCollection:Ss.toggleActiveCustomerCollection}),jBt=we(LBt,kBt)(NBt),MBt=v.div`
    border-radius: var(--salt-radius-default);
    overflow: hidden;

    .gm-style .gm-style-iw-c {
        inset-block-start: 30px;
        visibility: hidden;
    }

    .gm-style .gm-style-iw-t::after {
        visibility: hidden;
    }

    #collection-point-card-text {
        font-family: 'Source Sans Pro', sans-serif;
        visibility: visible;
        min-inline-size: 280px;
        max-inline-size: 280px;
        margin-block: 0;
        margin-inline: auto;
    }

    div.cluster img {
        inline-size: 0;
    }

    div.cluster div {
        background-color: 'var(--intent-primary)';
        border-radius: 50%;
        border-color: white;
        border-width: 2px;
        border-style: solid;
        font-size: 14px !important;
        color: white !important;
    }
`,wBt={buildLink:m.func.isRequired,buildLinkParams:m.func.isRequired,region:m.string.isRequired,visible:m.bool.isRequired,defaultLat:m.number.isRequired,defaultLong:m.number.isRequired,defaultZoom:m.number.isRequired,maxAddresses:m.number.isRequired,search:m.shape({error:m.string,query:m.string,lastUpdated:m.number,result:m.shape()}),activeCustomerCollection:m.shape({deliveryDestinationId:m.string,addressId:m.string}),collectionPoints:m.shape({data:m.shape({}),isFetching:m.bool,lastUpdated:m.number,didInvalidate:m.bool,fetchError:m.bool}).isRequired,nearbyCollectionPoints:m.shape({addresses:m.array,lastUpdated:m.number}).isRequired,actions:m.shape({performanceMark:m.func.isRequired,updateNearbyCollectionPoints:m.func.isRequired,setGeocode:m.func.isRequired,clearSearchResult:m.func.isRequired,setGeolocationLookupStatus:m.func.isRequired,setNearbyCollectionPointsFetchingError:m.func.isRequired,resetActiveCustomerCollection:m.func.isRequired}).isRequired,intl:m.any.isRequired,height:m.string,sendGeolocationAnalyticsEvent:m.func.isRequired,markersHidden:m.bool,onDeliveryDestinationSelect:m.func.isRequired},FBt={search:{},activeCustomerCollection:null,height:"557px",markersHidden:!1},cc={},BBt=5*60*1e3,UBt=10*1e3,h$=13,GBt=15,Vu=e=>e&&e.lat&&e.lng,g$=e=>({lat:e.coordinates.latitude,lng:e.coordinates.longitude}),E$=e=>e.filter(t=>t.distance<=UBt),$Bt=e=>{cc.map.fitBounds(e);const{zoom:t}=cc.map;typeof cc.map.setZoom=="function"&&cc.map.setZoom(t>=h$?h$:t)},HBt=e=>({latitude:e.lat,longitude:e.lng});let Kj=class extends h.Component{constructor(t){super(t),this.defaultSettings={center:{lat:this.props.defaultLat,lng:this.props.defaultLong},zoom:this.props.defaultZoom},this.state={user:{},search:{},error:null,zoom:this.defaultSettings.zoom},this.formattedMessages={infoWindow:this.props.intl.formatMessage("delivery.collection.address.select.button")},this.onMapMounted=this.onMapMounted.bind(this),this.updateUserLocation=this.updateUserLocation.bind(this),this.handleNavigatorError=this.handleNavigatorError.bind(this),this.geocodeAddress=this.geocodeAddress.bind(this),this.mapProvider={},this.handleBoundsChange=this.handleBoundsChange.bind(this),this.tryToGetCurrentPosition=this.tryToGetCurrentPosition.bind(this),this.onCurrentLocationClick=this.onCurrentLocationClick.bind(this),this.zoomIntoActiveDeliveryDestination=this.zoomIntoActiveDeliveryDestination.bind(this),this.getGeocode=this.getGeocode.bind(this)}componentWillUnmount(){this.props.actions.clearSearchResult()}componentDidUpdate(t){this.props.collectionPoints.lastUpdated!==t.collectionPoints.lastUpdated&&this.updateAddressDistances(Vu(this.state.search)?this.state.search:this.state.user),this.props.nearbyCollectionPoints.lastUpdated!==t.nearbyCollectionPoints.lastUpdated&&setTimeout(()=>this.updateMapBounds(),0),this.props.search.query!==t.search.query&&this.props.search.query?(this.geocodeAddress(this.props.search.query),setTimeout(()=>this.updateMapBounds(),0)):this.props.search.lastUpdated!==t.search.lastUpdated&&setTimeout(()=>this.updateMapBounds(),0),this.props.visible!==t.visible&&setTimeout(()=>this.updateMapBounds(),0),this.props.activeCustomerCollection&&this.props.activeCustomerCollection.deliveryDestinationId!==t.activeCustomerCollection?.deliveryDestinationId&&this.zoomIntoActiveDeliveryDestination(this.props.activeCustomerCollection)}zoomIntoActiveDeliveryDestination(t){const{map:n}=cc;t&&(n.setCenter(g$(t)),n.setZoom(GBt))}onMapMounted(t){cc.map=t,this.mapProvider=google,this.props.actions.resetActiveCustomerCollection(),navigator.geolocation&&(this.updateAddressDistances(this.state.search),this.updateMapBounds()),Vu(this.state.search)||this.tryToGetCurrentPosition(),setTimeout(()=>this.props.actions.setGeolocationLookupStatus({complete:!0}),0),this.props.actions.performanceMark({name:$xe})}tryToGetCurrentPosition(){navigator.geolocation?navigator.geolocation.getCurrentPosition(this.updateUserLocation,this.handleNavigatorError,{maximumAge:BBt}):this.handleNavigatorError(new Error("Navigator not supported by browser"))}getGeocode({address:t=null,location:n=null}){const o=new google.maps.Geocoder,{region:r}=this.props,a=cc.map.getBounds();return new Promise((i,l)=>{o.geocode({address:t,location:n,region:r,bounds:a},(c,d)=>{d==="OK"&&c?.length>0?i(c):l(d)})})}async geocodeAddress(t){try{const[n]=await this.getGeocode({address:t});if(n){const o=n.geometry.location.lat(),r=n.geometry.location.lng();this.updateSearchLocation({lat:o,lng:r}),this.props.actions.setGeocodeResult({result:n,latLng:new google.maps.LatLng(o,r),getGeocode:this.getGeocode})}}catch(n){this.props.actions.setGeocode({error:n}),this.props.actions.setNearbyCollectionPointsFetchingError()}}updateMapBounds(){const{search:t,user:n}=this.state,{nearbyCollectionPoints:o}=this.props,r=Vu(t),a=Vu(n);if(!r&&!a&&o&&o.addresses.length===0)return;const i=new google.maps.LatLngBounds;r?i.extend(t):a&&i.extend(n),o&&o.addresses.length>0&&E$(o.addresses).forEach(c=>i.extend(g$(c))),(r||a||o&&E$(o.addresses).length>0)&&$Bt(i)}shouldComponentUpdate(t,n){return this.props.collectionPoints.lastUpdated!==t.collectionPoints.lastUpdated||this.props.nearbyCollectionPoints.lastUpdated!==t.nearbyCollectionPoints.lastUpdated||this.props.search.query!==t.search.query&&t.search.query||this.props.search.lastUpdated!==t.search.lastUpdated||this.props.visible!==t.visible||this.props.activeCustomerCollection!==t.activeCustomerCollection||this.props.search.error!==t.search.error&&t.search.error!=="ZERO_RESULTS"&&t.search.result!==void 0?!0:this.state!==n}handleBoundsChange(){const{clientWidth:n}=window.document.body,o=Ke.md*16,a=n>o||this.props.visible;!this.mapPreviouslyShown&&a&&this.updateMapBounds(),this.mapPreviouslyShown=a}updateLocation(t){this.setState({error:null,zoom:this.defaultSettings.zoom},()=>{cc.map.panTo(t),this.updateAddressDistances(t),this.updateMapBounds()})}updateSearchLocation(t){const n={lat:t.lat||t.coords.latitude,lng:t.lng||t.coords.longitude};this.setState(o=>({search:{...o.search,...n}})),this.updateLocation(n)}updateUserLocation(t){const{sendGeolocationAnalyticsEvent:n}=this.props,o={lat:t.lat||t.coords.latitude,lng:t.lng||t.coords.longitude},r=!this.props.search.query;this.setState(a=>({user:{...a.user,...o},search:r?{}:a.search})),r&&this.updateLocation(o),n({didLocationUpdate:!0,error:!1})}updateAddressDistances(t){const n=this.props.collectionPoints?.data?Object.values(this.props.collectionPoints.data):[];if(n&&n.length>0&&typeof google<"u"){const o=Vu(t)?t:this.defaultSettings.center;this.props.actions.updateNearbyCollectionPoints({addresses:n,location:HBt(o),nonDefaultLocationExists:Vu(t)!==void 0,limit:this.props.maxAddresses})}}handleNavigatorError(t){const{sendGeolocationAnalyticsEvent:n}=this.props;n({didLocationUpdate:!1,error:!0,errorMessage:t?t.message:"Navigation Error"}),this.setState({error:t.message,search:{},user:{}}),this.updateAddressDistances(),this.updateMapBounds(),t.code===GeolocationPositionError.PERMISSION_DENIED&&this.showGeolocationBlockedNotification()}showGeolocationBlockedNotification(){Z.info("delivery.collection.alert.location.permission.blocked")}onCurrentLocationClick(){this.props.actions.clearSearchResult(),this.tryToGetCurrentPosition()}render(){const{buildLink:t,buildLinkParams:n,height:o="557px",markersHidden:r}=this.props,{user:a,search:i,error:l,zoom:c}=this.state;return s.jsx(MBt,{children:s.jsx(xBt,{height:o,zoom:c,center:this.defaultSettings.center,onLoad:this.onMapMounted,onBoundsChanged:this.handleBoundsChange,onCurrentLocationClick:this.onCurrentLocationClick,children:r?null:s.jsx(jBt,{user:a,search:i,mapProvider:this.mapProvider,buildLink:t,buildLinkParams:n,error:l,onDeliveryDestinationSelect:this.props.onDeliveryDestinationSelect})})})}};Kj.propTypes=wBt;Kj.defaultProps=FBt;const VBt=e=>({language:Eq(e),region:fq(e),apiKey:Ze(e,"google-maps-api-key"),defaultLat:Number(Ze(e,"google-maps-default-lat")),defaultLong:Number(Ze(e,"google-maps-default-long")),defaultZoom:Number(Ze(e,"google-maps-default-zoom")),maxAddresses:Number(Ze(e,"delivery-collection-address-display-limit")),collectionPoints:ru(e),nearbyCollectionPoints:{...VFt(e),addresses:Yj(e)},search:Pu(e),activeCustomerCollection:m_(e)}),WBt=st({performanceMark:ds,setGeocode:Ss.setGeocode,setGeocodeResult:CBt.saveResult,updateNearbyCollectionPoints:Ss.updateNearbyCollectionPoints,clearSearchResult:Ss.clearSearchResult,setGeolocationLookupStatus:Ss.setGeolocationLookupStatus,setNearbyCollectionPointsFetchingError:Ss.setNearbyCollectionPointsFetchingError,resetActiveCustomerCollection:Ss.resetActiveCustomerCollection}),ine=Tt(Ht,we(VBt,WBt))(Kj),YBt=({isLoading:e,onDeliveryDestinationSelect:t})=>{const{listView:n,mapView:o,accessibilityMapHeader:r,loadCustomerCollectionDestinations:a,customerCollections:i,buildLink:l,buildLinkParams:c,resetActiveAddressId:d,sendGeolocationEvent:u}=sne(),[p,g]=h.useState(!1);h.useEffect(()=>{a()},[]);const E=i.length>0;return s.jsxs(V,{flush:!0,"data-test":"customer-collection-change-modal",children:[s.jsxs(V.Item,{colSpan:{xs:12,md:6},children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(une,{areCustomerCollectionsShown:E})}),s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:6},children:s.jsx(Lt,{breakpoint:"md-up",children:s.jsxs(x,{onClick:()=>g(!p),intent:"secondary",fill:!0,"data-test":"customer-collection-change-modal-toggle-map-button",children:[s.jsx(x.Icon,{name:p?"list":"map_marker_hollow"}),p?n:o]})})})}),s.jsx(V.Item,{children:s.jsx(FS,{show:!p,children:s.jsx(ane,{onDeliveryDestinationSelect:t,customerCollections:i,isLoading:e})})})]}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsxs(FS,{show:p,children:[s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:r})}),s.jsx(ine,{visible:p,buildLink:l,buildLinkParams:c,resetActiveAddressId:d,height:"606px",sendGeolocationAnalyticsEvent:u,markersHidden:!E,onDeliveryDestinationSelect:t})]})})]})},qBt=v(x)`
    position: absolute;
    inset-inline-start: var(--salt-spacing-2);

    @media (min-width: ${Ke.sm}em) {
        inset-inline-start: var(--salt-spacing-4);
    }
`,lne=({onDeliveryDestinationSelect:e,modalName:t,openChooseDeliveryMethodModal:n})=>{const{isOpen:o,close:r,isLoading:a,headerLabelId:i,modalHeader:l,modalSize:c,setSelectedDeliveryDestinationDefault:d}=QFt(t),u=f(ou),p=I=>()=>{setTimeout(()=>{I()},50)},g=()=>{n&&n()},{Header:E,Body:y}=B;return s.jsxs(B,{isOpen:o,onRequestClose:r,isLoading:a,aria:{labelledby:i},maxWidth:c,"data-test":t,children:[s.jsx(E,{children:s.jsxs(Q,{direction:"row",align:"center",children:[u&&s.jsx(qBt,{size:"s",intent:"tertiary",onClick:p(g),fill:!1,"data-test":"test-customer-collection-change-modal-back-button","aria-label":"Back",children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsx(ee,{as:"h1",className:u?"salt-p-l--2 sm:salt-p-l--0":"",id:i,children:l})]})}),s.jsx(y,{children:s.jsx(YBt,{onDeliveryDestinationSelect:e||d,isLoading:a})})]})},f$=({deliveryAddresses:e,deliveryDestinationId:t,addressId:n})=>e.find(o=>o.deliveryDestinationId===t||o.addressId===n),KBt=()=>{const e=F(),t=f(af),n=f(bu),o=(i,l)=>{if(t)return;const c=f$({deliveryAddresses:n,addressId:l,deliveryDestinationId:i});c&&e(Wa.setSelectedAddress(c))};return{submitAddAddress:async(i,l)=>{const c=f$({deliveryAddresses:n,addressId:i,deliveryDestinationId:l});if(c){e(Wa.setSelectedAddress(c));return}const d=await e(I9(i));d&&e(Wa.setSelectedAddress({deliveryDestinationId:d.deliveryDestinationId,addressId:i}))},onDeliveryDestinationSelect:({deliveryDestinationId:i,addressId:l})=>{o(i,l),e(J.closeModal())}}},Gc="slotBookingDeliveryDestinationSelector",zBt=()=>{const{submitAddAddress:e,onDeliveryDestinationSelect:t}=KBt();return s.jsxs(h.Fragment,{children:[s.jsx(p_,{submitAddAddress:e}),s.jsx(GFt,{}),s.jsx(lne,{modalName:Gc,onDeliveryDestinationSelect:t})]})},cne=()=>f(pE),dne=()=>{const e=F();return()=>{e(Ss.resetActiveCustomerCollection())}},QBt=()=>{const e=cne(),t=`?${Qe.stringify({deliveryMethod:"CUSTOMER_COLLECTION",...e&&{"in-checkout-walk":!0}})}`,o=`${DR()}${aue()}`,r=()=>({pathname:o,search:t}),a=()=>`${o}${t}`,i=dne();return{buildLink:a,buildLinkParams:r,resetActiveAddressId:i}},XBt=()=>{const{formatMessage:e}=L(),t=e("delivery.collection.address.search"),n=e("accessibility.collection.points.search.button"),{query:o,lastUpdated:r}=f(Pu),{error:a}=f(ene),i=F(),{options:l}=Wt(Gc),c=l?.postalCode,d=f(z7e),u=()=>i(Hu.clearGeocodeError()),p=h.useCallback(N=>i(Hu.setGeocodeSearchQuery(N)),[i]),g=h.useCallback(()=>i(Hu.setNearbyCollectionPointsFetching()),[i]),E=f(D("cptf")),y=f($7e),I=N=>i(Hu.clearSingleCollectionPointFilter(N)),S=()=>i(Hu.clearAllCollectionPointFilters()),C=N=>i(Hu.applyCollectionPointFilters(N)),T=dne(),_=()=>{T(),i(hFt())},A=N=>k=>{const M=k.target.value;N(M),a!=null&&u()},R=h.useCallback(N=>{N!==""&&N!==o&&(g(),p(N))},[p,g,o]),P=N=>{N.preventDefault&&N.preventDefault();const{currentTarget:k}=N,M=k.elements.address_search.value;R(M)};return h.useEffect(()=>{c&&!o&&d&&R(c)},[c,R,d,o]),{addressSearchText:t,addressSearchButtonText:n,query:o,lastUpdated:r,collectionPointFiltersEnabled:E,collectionPointsFilters:y,applyCollectionPointFilters:C,clearAllCollectionPointFilters:S,clearSingleCollectionPointFilter:I,onSearchFocus:_,changeSearchQuery:A,performSearch:P}},y$=v(x)`
    border-start-start-radius: 0;
    border-end-start-radius: 0;
`,une=({areCustomerCollectionsShown:e})=>{const{addressSearchText:t,addressSearchButtonText:n,query:o,lastUpdated:r,collectionPointFiltersEnabled:a,collectionPointsFilters:i,applyCollectionPointFilters:l,clearSingleCollectionPointFilter:c,clearAllCollectionPointFilters:d,onSearchFocus:u,performSearch:p,changeSearchQuery:g}=XBt(),[E,y]=h.useState(o||"");h.useEffect(()=>{y(o||"")},[r]);const I="search-postcode-input",S=e||i.filter(C=>C.selected).length>0;return s.jsxs(h.Fragment,{children:[s.jsx("form",{onSubmit:p,"data-test":"search-postcode-form",children:s.jsxs(im,{children:[s.jsx(Wo,{last:!0,label:t,id:I,"data-test":I,name:"address_search",type:"text",placeholder:t,input:{onChange:g(y),onFocus:u},value:E,meta:{invalid:!1,touched:!1}}),s.jsxs(y$,{intent:"primary",fill:!1,type:"submit","data-test":"address-search-button",children:[s.jsx(ie,{children:n}),s.jsx(y$.Icon,{name:"search"})]})]})}),a&&S?s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:s.jsx(b,{id:"delivery.collection.filter.header.accessibility"})})}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(BFt,{filters:i,applyFilters:l})}),s.jsx(UFt,{filters:i,clearSingleFilter:c,clearAllFilters:d})]}):null,s.jsx("div",{className:"salt-m-b--2 salt-m-t--2",children:s.jsx(wFt,{})})]})},ZBt=v.div`
    justify-content: space-between;
    display: flex;
    flex-direction: column;
    block-size: 100%;
`,JBt=v(V.Item)`
    display: flex;
    flex-direction: column;
`,eUt=({isLoading:e,setSelectedDeliveryDestination:t})=>{const{listView:n,mapView:o,accessibilityMapHeader:r,loadCustomerCollectionDestinations:a,customerCollections:i,buildLink:l,buildLinkParams:c,resetActiveAddressId:d,sendGeolocationEvent:u}=sne(),{query:p}=f(Jse),[g,E]=h.useState(!1);h.useEffect(()=>{p&&a()},[p]);const y=i.length>0,I=s.jsx(NFt,{showCollectionPoints:y}),S=()=>y?null:s.jsx(vFt,{});return s.jsxs(V,{className:"salt-m-t--4",children:[s.jsxs(JBt,{colSpan:{xs:12,md:6},children:[s.jsx(une,{areCustomerCollectionsShown:y}),s.jsx(V,{flush:!0,className:"salt-p-r--2",children:s.jsx(V.Item,{colSpan:{xs:6},children:s.jsx(Lt,{breakpoint:"md-up",children:s.jsxs(x,{className:g?"salt-m-b--2":"",intent:"secondary",fill:!0,onClick:()=>E(!g),children:[s.jsx(x.Icon,{name:g?"list":"map_marker_hollow"}),s.jsx(x.Text,{children:g?n:o})]})})})}),s.jsx(FS,{show:!g,children:s.jsxs(ZBt,{children:[s.jsx(ane,{onDeliveryDestinationSelect:t,customerCollections:i,isLoading:e,topElement:I}),s.jsx(S,{})]})})]}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsxs(FS,{show:g,children:[s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:r})}),s.jsx(ine,{visible:g,buildLink:l,buildLinkParams:c,resetActiveAddressId:d,height:"610px",sendGeolocationAnalyticsEvent:u,markersHidden:!y})]})})]})},tUt=()=>{const{isOpen:e,close:t,isLoading:n,headerLabelId:o,modalHeader:r,modalSize:a,setSelectedDeliveryDestination:i}=IFt(),{Header:l,Body:c}=B;return s.jsxs(B,{isOpen:e,onRequestClose:t,isLoading:n,aria:{labelledby:o},maxWidth:a,"data-test":Fd,children:[s.jsx(l,{align:"left",children:s.jsx(ee,{as:"h1",id:o,children:r})}),s.jsx(c,{children:s.jsx(eUt,{isLoading:n,setSelectedDeliveryDestination:i})})]})},sUt=()=>{const e=F(),t=f($e(jv)),n=f(Gp),{currentBreakpoint:o}=h.useContext(kn),r=o==="lg"?"lg":"md",a=Wt(gc).open,i=()=>{e(J.closeModal())},l=async c=>{try{const{payload:{responseData:d}}=await AMt({latitude:c.location?.latitude||0,longitude:c.location?.longitude||0,postalCode:c.addressDetails.postalCode,formattedAddress:c.formattedAddress,visitorId:n},e);a({currentDeliveryDestination:d})}catch{Z.error("toast.notification.generic.error")}};return s.jsx(B,{isOpen:t,onRequestClose:i,maxWidth:r,children:s.jsx(B.Body,{children:s.jsx(Vse,{onAddressConfirm:l,searchComponent:"AddressSearchWithButton"})})})},{RadioIconOff:nUt,RadioIconOn:oUt,RadioText:rUt}=Pa,pne=v(Be.Item)`
    margin-block: 0 var(--salt-spacing-4);
`,aUt=v.div`
    opacity: ${({isDisabled:e})=>e?"0.55":"1"};
`,zj=v(gn)`
    flex-flow: row;
`,iUt=v(zj)`
    cursor: ${({isDisabled:e})=>e?"default":"pointer"};
`,lUt=v(O)`
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
`,cUt=({destination:{icon:e,radioLabel:t,radioText:n,radioBtn:o,dataTest:r},isChecked:a,isDisabled:i,handleClick:l})=>s.jsx(pne,{children:s.jsxs(aUt,{isDisabled:i,children:[s.jsxs(iUt,{"data-test":r,tabIndex:i?void 0:0,role:"option","aria-selected":a,isDisabled:i,...!i&&{onClick:l},children:[a&&!i?s.jsx(oUt,{name:"radio_on"}):s.jsx(nUt,{name:"radio_off"}),s.jsx(rUt,{children:s.jsxs(zj,{children:[s.jsx(pe,{name:e,height:20,width:20}),s.jsx(O,{size:"l",bold:!0,className:"salt-m-l--2",children:t})]})})]}),(i||a)&&s.jsxs("div",{className:"salt-m-l--8","data-test":`${r}-content`,children:[n&&s.jsx(lUt,{size:i?"s":"m",className:"salt-d--block salt-m-t--2",children:n}),!i&&o&&s.jsx(x,{intent:"secondary",size:"s",fill:!1,"data-test":o?.dataTest??o.dataTest,onClick:o.action,className:"salt-m-t--2",children:s.jsx(x.Text,{children:o.text})})]})]})}),dUt=ae.memo(cUt);function uUt(e,t){return t&&e.match(t)&&e.match(t).index===0?e.split(t).pop():e}const pUt=()=>function(t,n){return function(r,a){return Promise.all([r(L6.updateAddAddressOrigin(uUt(n,At(a())))),t(iO)])}},mne={redirectToAddAddressForm:pUt()};function mUt(){return Z.warning("addresses.add.max.toast.message")}function hUt(e){return J.openModal(e)}function gUt(){const e=F(),t=f(Xe);h.useEffect(()=>{t&&e(eo.getCustomerAddresses())},[]);const n=f(AIe);return{status:f(bD)?"NOT_READY":"READY",value:n}}function EUt(e){return mne.redirectToAddAddressForm(e,window.location.pathname)}function fUt({maxReached:e,isManualFormFlow:t,isManualFormModalEnabled:n,actions:{showMaxAddressNotificationAction:o,sendAnalytics:r,redirectToAddAddressForm:a,openAddAddressModal:i}}){return()=>{r.addAddressButtonClicked(),e?o():t&&!n?a():i()}}function Nu({modalName:e=Rr}={}){const{status:t,value:n}=gUt(),o=f(p=>Ze(p,"address-maximum-addresses")),r=n>=o,a=f(Gd),i=f(D("mfm")),l=Bs(),c=F(),d=Ge();return t==="NOT_READY"?{status:t,value:()=>{}}:{status:t,value:fUt({maxReached:r,isManualFormFlow:a,isManualFormModalEnabled:i,actions:{showMaxAddressNotificationAction:()=>mUt(),sendAnalytics:l,redirectToAddAddressForm:()=>c(EUt(d)),openAddAddressModal:()=>c(hUt(e))}})}}const yUt=()=>{const{formatMessage:e}=L(),t=f(TC);return e(t?{id:"delivery.destination.selector.plus.changeConfirmation.message.withSlot"}:{id:"delivery.destination.selector.plus.changeConfirmation.message.withoutSlot"})},I$={home:{title:"delivery.destination.selector.plus.scheduled.delivery.option.title",disabled:"delivery.destination.selector.plus.scheduled.delivery.option.unavailable.label",noAddress:"delivery.destination.selector.plus.delivery.option.description",changeAddressBtn:"delivery.destination.selector.plus.delivery.option.change.address.button.title",addAddressBtn:"delivery.destination.selector.plus.button.add.address"},fastHome:{title:"delivery.destination.selector.plus.ondemand.delivery.option.title",disabled:"delivery.destination.selector.plus.ondemand.delivery.option.unavailable.label",noAddress:"delivery.destination.selector.plus.delivery.option.description",changeAddressBtn:"delivery.destination.selector.plus.delivery.option.change.address.button.title",addAddressBtn:"delivery.destination.selector.plus.button.add.address"},collection:{title:"delivery.destination.selector.plus.scheduled.collection.option.title",disabled:"delivery.destination.selector.plus.scheduled.collection.option.unavailable.label",noAddress:"delivery.destination.selector.plus.scheduled.collection.option.description",changeAddressBtn:"delivery.destination.selector.plus.delivery.option.change.collection.point.button.title",addAddressBtn:"delivery.destination.selector.plus.button.choose.collection.point.title"},confirmBtn:"delivery.destination.selector.plus.button.confirm"},IUt=e=>{if(!e)return"";const{name:t,formattedAddress:n,addressId:o,postalCode:r}=e;return o?t?`${t} - ${n}`:n:r||""},SUt=(e,t,n,o,r,a)=>{const i=t?.deliveryMethod===Il,l=t?.deliveryMethod===r;if(i&&!l&&n)return!n.propositions||n.propositions.length===0?"disabled":n.propositions.find(d=>d.propositionType===o)?"unchecked":"disabled";if(!t)return e&&e.isDefault?"checked":"unchecked";if(t.deliveryMethod!==r)return"unchecked";if(t.deliverability==="NOT_DELIVERABLE")return"disabled";if(t.deliveryMethod===xa){if(!t.propositions||t.propositions.length===0)return"disabled";const c=t.propositions.find(d=>d.propositionType===o);if(!c)return"disabled";if(a&&c.regionId!==a)return"unchecked"}return"checked"},CUt=(e,t,n)=>e?e.some(o=>o.propositionType===t&&o.deliveryMethod===n):!1,qb=e=>{const{formatMessage:t}=L(),n=f(nme),o=YE(),r=f(XV).data,a=f(Xe),i=f(cu).data,{id:l,deliveryMethod:c,propositionType:d,icon:u,actions:p,dataTest:g,currentDeliveryDestination:E,forceDeliveryDestinationChange:y}=e,I=CUt(r,d,c);if(console.log("isSupported",I,d,c),console.log("supportedPropositions",r),console.log("currentDeliveryDestination",E),console.log("customerAddresses",i),!I||!r)return;const S=i.find(W=>W.isPrimary&&W.deliveryMethod===xa),C=r.find(W=>W.propositionType===d&&W.deliveryMethod===c),T=SUt(C,E,S,d,c,o.regionId||void 0);console.log("primaryHomeAddress",S),console.log("status",T);let _,A;const R=E?.deliveryMethod===Il,P=E?.deliveryMethod===c;P&&(_=E),R&&!P&&S&&(_=S),_&&(A=_.propositions?.find(W=>W.propositionType===d)?.regionId),R&&!A&&(A=_?.resolvedRegionId),console.log("selectedRegionId",A);const N=I$[l],k={id:l,icon:u,radioLabel:t(N.title),status:T,dataTest:g};if(T==="disabled")return n?void 0:{...k,radioText:t(N.disabled)};const M=IUt(_);if(!M)return l!=="collection"?{...k,radioText:t(N.noAddress),submitBtn:{text:t(N.addAddressBtn),action:p.addAddress}}:{...k,radioText:"",submitBtn:{text:t(N.addAddressBtn),action:p.addAddress}};const w=!_?.addressId,j=l==="collection"||a&&!!E&&!w,G=l!=="collection"&&a&&!!E&&w;return{...k,radioText:M,...j&&{radioBtn:{text:t(N.changeAddressBtn),action:p.changeAddress}},...G&&{radioBtn:{text:t(N.addAddressBtn),action:p.addAddress}},submitBtn:{isConfirm:y||!hne(_,E,A,o.regionId||void 0),text:t(I$.confirmBtn),action:()=>p.confirm(y,_,E,A,o.regionId||void 0)}}},vUt=e=>{const t=e.findIndex(r=>r.status==="checked"),n=e.findIndex(r=>r.status==="unchecked"),o=t!==-1?t:n;return o!==-1?o:0},hne=(e,t,n,o)=>!e||!n?!1:t?.deliveryDestinationId===e.deliveryDestinationId&&n===o,TUt=()=>{const e=F(),t=Ne(),n=Wt(gc),o=nT(),r=f(Xe),a=f(XV),i=t.pathname==="/",l=Rm(t.pathname===Jd()||t.pathname===bc()||i,!1),c=n.options?.currentDeliveryDestination,d=c!=null,u=c||o.data,{value:p}=Nu({modalName:hE});h.useEffect(()=>{!a.lastUpdated&&!a.isFetching&&e(hn.getSupportedPropositions())},[e,a]);const g=Wt(Z4).open,E=Wt(Em).open,y=Wt(jv).open,I=yUt(),S=()=>{E()},C=()=>!a.lastUpdated||a.isFetching,T=(R,P,N,k,M)=>{if(console.log("confirmSelectedDeliveryDestination",P),console.log("currentDeliveryDestination",N),console.log("selectedRegionId",k),console.log("basketRegionId",M),!(!P||!k)){if(!R&&hne(P,N,k,M)){n.close();return}l({deliveryDestinationId:P.deliveryDestinationId,regionId:k,addressId:P.addressId}).then(()=>{n.close()})}},_=[qb({id:"home",deliveryMethod:xa,propositionType:"SCHEDULED",icon:"home_delivery",dataTest:"delivery-destination-radio-home-delivery",actions:{changeAddress:g,addAddress:r?p:y,confirm:T},currentDeliveryDestination:u,forceDeliveryDestinationChange:d}),qb({id:"fastHome",deliveryMethod:xa,propositionType:"FAST",icon:"on_demand",dataTest:"delivery-destination-radio-fast-delivery",actions:{changeAddress:g,addAddress:r?p:y,confirm:T},currentDeliveryDestination:u,forceDeliveryDestinationChange:d}),qb({id:"collection",deliveryMethod:Il,propositionType:"SCHEDULED",icon:"click_collect",dataTest:"delivery-destination-radio-collection",actions:{changeAddress:S,addAddress:S,confirm:T},currentDeliveryDestination:u,forceDeliveryDestinationChange:d})].filter(Boolean),A=vUt(_);return{currentAddress:u?.addressId?u.formattedAddress:u?.postalCode,deliveryDestinationRadios:_,isLoading:C(),isCustomerLoggedIn:r,deliveryDestinationChangeWarningText:I,initialSelectedIndex:A,onVisitorAddressClick:y}},{StyledFooter:_Ut}=$K,bUt=v(B.Body)`
    flex-grow: 1;
    overflow: auto;
    padding: var(--salt-spacing-4);

    ${re.smUp`
        padding-block: ${$(20)};
        padding-inline: ${$(50)};
    `};
`,xUt=v.div`
    inline-size: 100%;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
`,AUt=v(_e.Typography)`
    inline-size: 90%;
`,Kb=()=>s.jsx(pne,{children:s.jsxs(zj,{children:[s.jsx(_e.Icon,{size:"l"}),s.jsxs(xUt,{className:"salt-m-l--2",children:[s.jsx(_e.Typography,{variant:"textL",fill:100}),s.jsx(AUt,{variant:"textM",className:"salt-m-t--2"})]})]})}),RUt=()=>s.jsxs(ae.Fragment,{children:[s.jsx(gne,{}),s.jsxs(bUt,{"data-test":"skeleton-modal-content-body",children:[s.jsx(Kb,{}),s.jsx(Kb,{}),s.jsx(Kb,{})]},"body"),s.jsx(_Ut,{"data-test":"skeleton-modal-content-footer",children:s.jsx(_e.Button,{size:"m",fill:!0})},"footer")]}),DUt=v.div`
    display: flex;
    gap: var(--salt-spacing-8);
    flex-direction: column;
`,OUt=v(x)`
    font-weight: 400;
    padding: var(--salt-spacing-2);
    justify-content: space-between;
`,PUt=v(x.Text)`
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
`,NUt=v(xe)`
    padding: 0;
`,LUt=v(x.Text)`
    text-align: center;
`,kUt=v(B.Footer)`
    padding-block-start: ${({noPaddingTop:e})=>e?"0 !important":"20px"};
`,VA="delivery.destination.selector.plus.title",gne=()=>s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",id:VA,children:s.jsx(b,{id:VA})})}),jUt=()=>{const{isLoading:e,currentAddress:t,deliveryDestinationRadios:n,isCustomerLoggedIn:o,deliveryDestinationChangeWarningText:r,initialSelectedIndex:a,onVisitorAddressClick:i}=TUt(),[l,c]=h.useState(a);h.useEffect(()=>{c(a)},[a]);const d=g=>{c(g)},u=n[l],p=a!==l&&u?.submitBtn?.isConfirm;return e?s.jsx(RUt,{}):s.jsxs(ae.Fragment,{children:[s.jsx(gne,{}),s.jsx(B.Body,{children:s.jsxs(DUt,{children:[!o&&t&&s.jsx(NUt,{children:s.jsxs(OUt,{intent:"tertiary",fill:!0,onClick:i,"data-test":"choose-delivery-method-address",children:[s.jsx(PUt,{className:"sm:salt-d--block",children:t}),s.jsx(x.Icon,{name:"edit"})]})}),s.jsx(xe,{children:s.jsx(Be,{children:n.map((g,E)=>s.jsx(dUt,{destination:g,isChecked:l===E,isDisabled:g.status==="disabled",handleClick:()=>d(E)},g.id))})})]})}),s.jsx(kUt,{align:"left",noPaddingTop:p,children:s.jsxs(Q,{direction:"column",gap:["md"],basis:"100%",children:[p&&s.jsx(O,{"data-test":"delivery-destination-change-warning",children:r}),u?.submitBtn&&s.jsx(x,{intent:"primary","data-test":"choose-delivery-method-submit",onClick:u.submitBtn.action,fill:!0,children:s.jsx(LUt,{children:u.submitBtn.text})})]})})]})},MUt=()=>{const e=F(),t=f($e(gc)),n=()=>e(J.closeModal());return s.jsx(B,{isOpen:t,onRequestClose:n,aria:{labelledby:VA},maxWidth:"sm","data-test":gc,children:s.jsx(jUt,{})})},wUt=v(xe)`
    border-radius: var(--salt-radius-default);
    background-color: var(--intent-contrast) !important;
`,FUt=({isFetching:e,onAddressSelect:t,selectedAddress:n,deliveryAddresses:o,loadHomeDeliveryDestinations:r})=>(h.useEffect(()=>{r()},[]),e?Array.from(Array(3),(a,i)=>s.jsx(qj,{},i)):o.map(a=>{const i=n&&n?.deliveryDestinationId===a.deliveryDestinationId;return s.jsx(wUt,{className:"salt-m-b--0.5 salt-overflow-wrap--anywhere","aria-selected":i,children:s.jsx(Ao,{checked:i,onClick:()=>t(a),label:a.name,value:a.deliveryDestinationId,children:a.formattedAddress})},a.deliveryDestinationId)})),BUt=()=>{const e=F(),t=Ge(),n=f(ou),{value:o}=Nu({modalName:hE});return{onClick:()=>{n||t(Xa()),e(hn.invalidateHomeDeliveryDestinations()),e(wi({deliveryDestinationChanged:!1,userAction:"Add address"})),e(J.closeModal()),n&&o()},textId:n?"slotbooking.address.select.add.new.address":"addresses.add.address"}},Ene=()=>{const{onClick:e,textId:t}=BUt();return s.jsx(x,{fill:!0,intent:"secondary",onClick:e,"data-test":"dds-addresses-add-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:t})})})},UUt=v(V)`
    inline-size: 100%;
`,GUt=({onConfirm:e})=>s.jsx(B.Footer,{children:s.jsxs(UUt,{flush:!0,className:"salt-gap--2",children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{fill:!0,intent:"primary",onClick:e,children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.address.select.confirm"})})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(Ene,{})})]})}),zb="delivery.destination.homeDelivery.changeAddress.header",$Ut=v(x)`
    @media (min-width: ${Ke.sm}em) {
        position: absolute;
        inset-inline-start: var(--salt-spacing-4);
    }
`,HUt=()=>{const{isOpen:e,close:t}=Wt(Z4),[n,o]=h.useState(),r=f(Rl),a=f(qi),i=Wt(gc).open,l=f(YR),c=E9(),d=()=>{t(),i({currentDeliveryDestination:n})},u={isFetching:r.isFetching,onAddressSelect:o,selectedAddress:n,deliveryAddresses:l,loadHomeDeliveryDestinations:c};return h.useEffect(()=>{const g=l.find(E=>E.deliveryDestinationId===a)||l[0];o(g)},[l,a]),s.jsxs(B,{isOpen:e,onRequestClose:t,aria:{labelledby:zb},children:[s.jsx(B.Header,{align:"left",children:s.jsxs(Q,{direction:"row",align:"center",children:[s.jsx($Ut,{size:"s",intent:"tertiary",onClick:i,fill:!1,"aria-label":"Back",children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsx(ee,{as:"h1",id:zb,children:s.jsx(b,{id:zb})})]})}),s.jsx(B.Body,{children:s.jsx(FUt,{...u})}),s.jsx(GUt,{onConfirm:d})]})},g_=()=>{const e=F(),t=wc(),n=f(Hp),o=f(ou),r=!f(Xe),a=E=>{if(E.userAction==="HEADER_CLICKED"){const S=t.data?.deliveryMethod;e(pFt(S))}e(gFt(E));const y=uY[E.userAction];if(!y)return;const I={event:"select_navigation",name:"delivery-destination",location:y};te.sendEvent({GA:I,WA:null})},i=Wt(hE).open,l=Wt(fm).open,c=Wt(Fd).open,d=Wt(jv).open,u=Wt(gc).open,p=!!t.data?.deliveryDestinationId;return{isDDSEnabled:n,isDDSPlusEnabled:o,isVisitor:r,openDDS:E=>{a(E),r?p?l():o?d():c():o?p?u():i():l()},openChooseDeliveryMethodModal:u}},Ka={customerCollectionActionHeader:"delivery.destination.selectedMethod.collection.header",customerCollectionChangeDeliveryTypeDescription:"delivery.destination.selectedMethod.collection.changeToHomeDescription",homeDeliveryActionHeader:"delivery.destination.selectedMethod.home.header",homeDeliveryActionChangeDeliveryTypeDescription:"delivery.destination.selectedMethod.home.changeToCollectionDescription",chooseHomeAddress:"delivery.destination.selectedMethod.home.chooseButtonText",chooseCollection:"delivery.destination.selectedMethod.collection.chooseButtonText",homeDeliveryChangeAddress:"delivery.destination.selectedMethod.home.changeButtonText",customerCollectionChangeAddress:"delivery.destination.selectedMethod.collection.changeButtonText",changeYourDeliveryMethod:"delivery.destinations.visitor.selectedMethod.changeButtonText"},VUt=(e,{homeDeliverySelection:t,collectionPointSelection:n,analyticsAction:o},r,a,i)=>{const l=r(Ka.customerCollectionChangeAddress),c=r(Ka.chooseHomeAddress),d=a&&i?{action:()=>{o(!0,"HOME_DELIVERY"),t()},message:c}:void 0;return{changeAddressButton:{action:()=>{o(!1,"CUSTOMER_COLLECTION"),n()},message:l},actionCardData:yne(r,e),changeDeliveryTypeButton:d,changeDeliveryTypeDescription:r(Ka.customerCollectionChangeDeliveryTypeDescription)}},WUt=(e,{homeDeliverySelection:t,collectionPointSelection:n,analyticsAction:o},r,a,i)=>{const l=r(Ka.homeDeliveryChangeAddress),c=r(Ka.chooseCollection),d=a&&i?{action:()=>{o(!0,"CUSTOMER_COLLECTION"),n()},message:c}:void 0;return{changeAddressButton:{action:()=>{o(!1,"HOME_DELIVERY"),t()},message:l},actionCardData:fne(r,e),changeDeliveryTypeButton:d,changeDeliveryTypeDescription:r(Ka.homeDeliveryActionChangeDeliveryTypeDescription)}},YUt=({homeDeliverySelection:e,collectionPointSelection:t,analyticsAction:n},o,r,a)=>{const i=o(Ka.chooseHomeAddress),l=o(Ka.chooseCollection),c={action:()=>{n(!0,"HOME_DELIVERY"),e()},message:i},d={action:()=>{n(!0,"CUSTOMER_COLLECTION"),t()},message:l};return{changeAddressButton:r?c:d,changeDeliveryTypeButton:r&&a?d:void 0,changeDeliveryTypeDescription:""}},fne=(e,t)=>({icon:"home_delivery",headerMessage:e(Ka.homeDeliveryActionHeader),text:`${t.name?`${t.name} - `:""}${t.formattedAddress}`}),yne=(e,t)=>({icon:"click_collect",headerMessage:e(Ka.customerCollectionActionHeader),text:`${t.name} - ${t.formattedAddress}`}),qUt=(e,t,n)=>{const o={action:t,message:n(Ka.changeYourDeliveryMethod)};switch(e.data?.deliveryMethod){case"HOME_DELIVERY":return{actionCardData:fne(n,e.data),changeAddressButton:o};case"CUSTOMER_COLLECTION":return{actionCardData:yne(n,e.data),changeAddressButton:o};default:return{changeAddressButton:o}}},KUt=(e,t,n,o,r,a)=>{switch(e.data?.deliveryMethod){case"CUSTOMER_COLLECTION":return VUt(e.data,t,n,o,a);case"HOME_DELIVERY":return WUt(e.data,t,n,r,a);default:return YUt(t,n,o,r)}},zUt=()=>{const e=F(),{formatMessage:t}=L(),n=nT(),o=Wt(fm),r=Wt(_p).open,a=Wt(Em).open,i=Wt(Fd).open,l=Wt(jv).open,c=f9(),d=y9(),u=$tt(),p=zFt(),g=f(Xe),E=f(ou),y=KUt(n,{homeDeliverySelection:r,collectionPointSelection:a,analyticsAction:p},t,c,d,u),I=qUt(n,E?l:i,t),S=g?y:I,C=()=>{e(wi({deliveryDestinationChanged:!1,userAction:"Close"}))};return{...o,...S,selectedDeliveryDestination:n.data,isLoading:!1,sendAnalytics:C}},Qb="delivery.destination.selectedMethod.header",QUt=v.div`
    display: flex;
    gap: var(--salt-spacing-4);
    flex-direction: column;
`,XUt=({changeDeliveryTypeButton:e,changeDeliveryTypeDescription:t})=>e?s.jsxs(ae.Fragment,{children:[s.jsx(Ts,{}),t,s.jsx(x,{intent:"secondary","data-test":"delivery-method-change-delivery-method-button-qwe",onClick:e.action,children:s.jsx(x.Text,{children:e.message})})]}):null,ZUt=({actionCardData:e,selectedDeliveryDestination:t})=>s.jsx(ae.Fragment,{children:e&&t&&s.jsxs(Oe.Action,{id:t.deliveryDestinationId,"data-test":t.deliveryDestinationId,innerRef:void 0,chip:void 0,className:"salt-m--0",children:[s.jsxs(Oe.Action.Header,{style:Qse,children:[s.jsx(pe,{name:e.icon,height:20,width:20}),s.jsx(Oe.Action.HeaderText,{style:Xse,as:"h4",children:e.headerMessage})]}),s.jsx(Oe.Action.Body,{style:Zse,children:e.text})]},`your-address-selected-${t.deliveryDestinationId}`)}),S$=()=>{const{isOpen:e,close:t,isLoading:n,selectedDeliveryDestination:o,changeDeliveryTypeButton:r,changeDeliveryTypeDescription:a,changeAddressButton:i,actionCardData:l,sendAnalytics:c}=zUt(),{Header:d,Body:u}=B,p=()=>(c(),t());return s.jsxs(B,{isOpen:e,onRequestClose:p,isLoading:n,aria:{labelledby:Qb},maxWidth:"sm","data-test":fm,children:[s.jsx(d,{align:"left",children:s.jsx(ee,{as:"h1",id:Qb,children:s.jsx(Nt,{id:Qb})})}),s.jsx(u,{children:s.jsxs(QUt,{children:[s.jsx(ZUt,{actionCardData:l,selectedDeliveryDestination:o}),s.jsx(x,{intent:"primary",className:"salt-m-t--4","data-test":"delivery-method-change-address-button",onClick:i.action,children:s.jsx(x.Text,{children:i.message})}),s.jsx(XUt,{changeDeliveryTypeButton:r,changeDeliveryTypeDescription:a})]})})]})},JUt={headerLabelId:"delivery.destination.homeDelivery.changeAddress.header",addAddressButtonTextId:"addresses.add.address"},eGt=()=>{const e=F(),{headerLabelId:t,addAddressButtonTextId:n}=JUt,o=f(Rl),r=f(YR),{formatMessage:a}=L(),i=E9(),l=Wt(_p),c=f(ou),d=wc(),u=Wj(),p=Wt(gc).open,g=WN(),E=()=>e(hn.invalidateHomeDeliveryDestinations()),y=S=>{if(c){l.close(),p({currentDeliveryDestination:S});return}if(E(),g(S)){const C={deliveryDestinationId:S.deliveryDestinationId,deliveryDestinationChanged:!1,deliveryMethod:S.deliveryMethod,userAction:"Delivery destination already selected"};e(wi(C)),l.close();return}u(_p,S)};return{...l,close:()=>{e(wi({deliveryDestinationChanged:!1,userAction:"Close"})),E(),l.close()},headerLabelId:t,modalHeader:a(t),addAddressButtonText:a(n),setSelectedDeliveryDestination:y,isFetching:o.isFetching,deliverableHomeAddresses:r,loadHomeDeliveryDestinations:i,deliveryDestinationFromSession:d}},C$=v.div`
    display: flex;
    gap: var(--salt-spacing-4);
    flex-direction: column;
`,tGt=({isFetching:e,deliverableHomeAddresses:t,setSelectedDeliveryDestination:n,loadHomeDeliveryDestinations:o})=>{h.useEffect(()=>{o()},[]);const r=e?Array.from(Array(3),(i,l)=>s.jsx(qj,{},l)):t.map(i=>s.jsx(vs,{"data-test":`choose-home-delivery-${i.deliveryDestinationId}`,title:{text:i.name,as:"h2"},description:i.formattedAddress,icon:"home_delivery",as:"button",onClick:l=>(l.preventDefault(),l.stopPropagation(),n(i))},i.deliveryDestinationId)),a=s.jsx(C$,{className:"salt-m--2",children:s.jsx(Ene,{})});return s.jsx(C$,{children:[...r,a]})},sGt=({isOpen:e,close:t,modalHeader:n,headerLabelId:o,setSelectedDeliveryDestination:r,deliverableHomeAddresses:a,isFetching:i,loadHomeDeliveryDestinations:l})=>{const{Header:c,Body:d}=B;return s.jsxs(B,{isOpen:e,onRequestClose:t,isLoading:i,aria:{labelledby:o},maxWidth:"sm","data-test":_p,children:[s.jsx(c,{align:"left",children:s.jsx(ee,{as:"h1",id:o,children:n})}),s.jsx(d,{children:s.jsx(tGt,{isFetching:i,deliverableHomeAddresses:a,setSelectedDeliveryDestination:r,loadHomeDeliveryDestinations:l})})]})},nGt=()=>{const e=eGt();return s.jsx(sGt,{...e})},v$=({openChooseDeliveryMethodModal:e})=>s.jsx(lne,{modalName:Em,openChooseDeliveryMethodModal:e}),oGt=()=>{const{headerLabelId:e,isOpen:t,deliveryDestinationChangeWarningText:n,confirmDeliveryDestinationChange:o,onBack:r}=yFt();return s.jsxs(B,{isOpen:t,onRequestClose:r,isLoading:!1,aria:{labelledby:e},maxWidth:"sm","data-test":kP,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",id:e,children:s.jsx(b,{id:e})})}),s.jsx(B.Body,{children:n}),s.jsx(B.Footer,{className:"salt-d--block",align:"left",children:s.jsxs(Q,{direction:"column",directionSmUp:"row-reverse",wrap:"nowrap",gap:["sm"],children:[s.jsx(x,{id:"change-destination-confirmation-button",fill:!0,intent:"primary",onClick:o,children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.destination.changeConfirmation.confirm.button"})})}),s.jsx(x,{fill:!0,intent:"secondary",onClick:r,children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.destination.changeConfirmation.back.button"})})})]})})]})},T$={missingAddressLine1:"delivery.destination.selector.button.missing.address.line1",missingAddressLine2:"delivery.destination.selector.button.missing.address.line2"},rGt=()=>{const{formatMessage:e}=L(),t=f(Xe),o=wc().data,r=o?.deliveryMethod,a=o?.addressId===void 0;return!o||!r?{line1:e(T$.missingAddressLine1),line2:e(T$.missingAddressLine2)}:o.name&&(a||r==="CUSTOMER_COLLECTION"||t)?{line1:o.name}:{line1:o.formattedAddress}},aGt=(e,t)=>{const[n,o]=Fp(),r=f(zs);h.useEffect(()=>{n.get("showDDS")==="true"&&e&&!r.isFetching&&(t({userAction:"EXTERNAL_LINK"}),n.delete("showDDS"),o(n,{replace:!0,state:{silent:!0}}))},[r])},iGt=(e,t,n)=>{const o=f(zs);h.useEffect(()=>{e||!t||o.isFetching||o.data?.deliveryDestinationId||n({userAction:"LOGIN_NO_DD"})},[o])},_$=v.span`
    display: block;
    max-inline-size: ${$(120)};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`,lGt=v(x)`
    max-inline-size: 160px;
    ${re.lgUp`
        min-inline-size: ${$(90)};
    `}
`,cGt=e=>{const t=F(),{isVisitor:n,isDDSPlusEnabled:o,openDDS:r,openChooseDeliveryMethodModal:a}=g_(),{line1:i,line2:l}=rGt(),c=Rm(!1);aGt(o,r),iGt(n,o,r);const d=E=>()=>{setTimeout(()=>{E()},50)},u=(E,y)=>{t(fW()),y&&t(i3(y)).then(I=>{c({addressId:E,deliveryDestinationId:I.payload.responseData.deliveryDestinationId,regionId:I.payload.responseData.resolvedRegionId}).then(d(a))})},p=()=>s.jsxs(ae.Fragment,{children:[s.jsx(S$,{}),n?s.jsx(tUt,{}):s.jsxs(ae.Fragment,{children:[s.jsx(v$,{}),s.jsx(nGt,{})]}),s.jsx(oGt,{})]}),g=()=>s.jsxs(ae.Fragment,{children:[s.jsx(MUt,{}),s.jsx(v$,{openChooseDeliveryMethodModal:a}),n?s.jsxs(ae.Fragment,{children:[s.jsx(S$,{}),s.jsx(sUt,{})]}):s.jsxs(ae.Fragment,{children:[s.jsx(HUt,{}),s.jsx(p_,{modalName:hE,submitAddAddress:u})]})]});return s.jsxs("div",{...e,children:[s.jsxs(lGt,{fill:!0,intent:"secondary","data-test":"delivery-destination-selector-button","data-synthetics":"delivery-destination-selector-button","aria-describedby":"delivery-destination-selector-description","aria-label":`${i} ${l}`,onClick:()=>r({userAction:"HEADER_CLICKED"}),children:[s.jsx(x.Icon,{name:"map_marker_hollow"}),s.jsxs(x.Text,{className:"salt-d--none sm:salt-d--block",children:[s.jsx(_$,{children:i}),s.jsx(_$,{children:l})]})]}),o&&g(),!o&&p()]})},pn={RECIPES:"Recipes",MEAL_PLANNING:"Meal Planning",PROMOTIONS:"Promotions",COUPONS:"Coupons",FAVOURITES:"Favourites",LISTS:"Lists",INSTANT_SHOP:"Instant Shop",REGULARS:"Regulars",RECURRING_ORDERS_SIGN_UP:"Recurring Orders",DELIVERY_PASS:"Delivery Pass",SHOP_IN_SHOP:"SHOP_IN_SHOP_TEMPLATED"},Ine=(e,t,n)=>({[pn.RECIPES]:{icon:"recipes",messageString:{lgUp:"navigation.recipes.link",xsUp:"navigation.recipes.link"},getLocation:o=>({...Js(La()),search:o}),availability:t.recipes,testId:"recipes-button",analytics:{type:"recipes",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"recipes",location:r??"menu"}),e({type:Bt.RECIPES_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the recipes navigation bar button"});const a={event:"select_navigation",name:"recipes",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.PROMOTIONS]:{icon:"promotion",messageString:{lgUp:"promotions.button",xsUp:"promotions.button"},getLocation:o=>({...Js(di()),search:o}),availability:t.promotions,testId:"promotions-button",analytics:{type:"offers",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"promotion",location:r??"menu"}),e({type:Bt.OFFERS_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the offers navigation bar button"});const a={event:"select_navigation",name:"promotion",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.COUPONS]:{icon:"coupons",messageString:{lgUp:"coupons.button",xsUp:"coupons.button"},getLocation:o=>({...Js(zE()),search:o}),availability:t.coupons,count:n.coupons,testId:"coupons-button",analytics:{type:"coupons",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"coupons",location:r??"menu"}),e({type:Bt.COUPONS_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the coupons navigation bar button"});const a={event:"select_navigation",name:"coupons",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.FAVOURITES]:{icon:"favourites",messageString:{lgUp:"favorites.button",xsUp:"navigation.favorites"},getLocation:o=>({...Js(_m()),search:o}),availability:t.favorites,testId:"favourites-button",analytics:{type:"favorites",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"favourites",location:r??"menu"}),e({type:Bt.FAVORITES_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the favorites navigation bar button"});const a={event:"select_navigation",name:"favourites",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.LISTS]:{icon:"list",messageString:{lgUp:"shopping.list.navigation.button",xsUp:"shopping.list.navigation.button"},getLocation:o=>({...Js(jp()),search:o}),availability:t.lists,testId:"shopping-list-button",analytics:{type:"lists",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"lists",location:r??"menu"}),e({type:Bt.LISTS_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the lists navigation bar button"});const a={event:"select_navigation",name:"lists",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.INSTANT_SHOP]:{icon:"smart_cart",messageString:{lgUp:"instant.shop.navigation.button",xsUp:"instant.shop.navigation.button"},getLocation:o=>({...Js(Og()),search:o}),availability:t.instantShop,testId:"instant-shop-button",analytics:{type:"smartCart",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"instant-shop",location:r??"menu"}),e({type:Bt.SMART_CART_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the smart cart navigation bar button"});const a={event:"select_navigation",name:"instant-shop",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.REGULARS]:{icon:"regulars",messageString:{lgUp:"regular.orders.navigation.button",xsUp:"regular.orders.navigation.button"},getLocation:o=>({...Js(Ok()),search:o}),availability:t.regularOrders,testId:"regular-orders-button",analytics:{type:"regularOrders",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"regulars",location:r??"menu"}),e({type:Bt.REGULARS_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the regulars navigation bar button"});const a={event:"select_navigation",name:"regulars",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.RECURRING_ORDERS_SIGN_UP]:{icon:"recurring_order",messageString:{lgUp:"recurring.orders.navigation.button",xsUp:"recurring.orders.navigation.button"},getLocation:o=>({...Js(lo()),search:o}),availability:t.recurringOrders,testId:"recurring-orders-sign-up-button",analytics:{type:"recurringOrdersSingUp",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"recurring-orders",location:r??"menu"}),e({type:Bt.RECURRING_ORDERS_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the recurring orders navigation bar button"});const a={event:"select_navigation",name:"recurring-orders",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.DELIVERY_PASS]:{icon:"delivery_pass",messageString:{lgUp:"delivery.pass",xsUp:"delivery.pass"},getLocation:o=>({...Js(ar()),search:o}),availability:t.deliveryPass,testId:"delivery-pass-button",analytics:{type:"deliveryPass",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"delivery-pass",location:r??"menu"}),e({type:Bt.DELIVERY_PASS_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the delivery pass navigation bar button"});const a={event:"select_navigation",name:"delivery-pass",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}},[pn.SHOP_IN_SHOP]:{testId:"shop-in-shop-button",getLocation:(o,r)=>({...Js(vg(r)),search:o}),availability:t.shopInShop,analytics:{type:"shopInShop",sendClickEvent:o=>{e({type:Bt.SHOP_IN_SHOP_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the shop in shop navigation bar button",pageEventAttributes:{destination:vg(o)}})}}},[pn.MEAL_PLANNING]:{icon:"meal_planning",messageString:{lgUp:"navigation.mealplanner.link",xsUp:"navigation.mealplanner.link"},getLocation:o=>({...Js($T()),search:o}),availability:t.mealPlanning,testId:"meal-planning-button",analytics:{type:"mealPlanning",sendClickEvent:(o,r)=>{e({type:Ds.SELECT_NAVIGATION,name:"meal-planning",location:r??"menu"}),e({type:Bt.MEAL_NAVIGATION_BAR_BUTTON_CLICKED,description:"The user clicked the meal planning button on navigation bar."});const a={event:"select_navigation",name:"meal-planning",location:r??"menu"};te.sendEvent({GA:a,WA:null})}}}}),Sne=[{type:pn.RECIPES},{type:pn.MEAL_PLANNING},{type:pn.PROMOTIONS},{type:pn.COUPONS},{type:pn.FAVOURITES},{type:pn.LISTS},{type:pn.INSTANT_SHOP},{type:pn.REGULARS},{type:pn.RECURRING_ORDERS_SIGN_UP},{type:pn.DELIVERY_PASS}],Cne=e=>e.data.composableNavbar.items,dGt=()=>{const e=F(),{actions:t}=st({analyticsEvent:U.analyticsEvent})(e);return t.analyticsEvent},uGt=v(Ll)`
    position: absolute;
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
    inset-block-start: calc(var(--salt-spacing-2) * -1);
`,pGt=D("cmpnb"),mGt=({composableNavbarItemConfig:e,composableNavbarItemMetadata:t})=>{const n=h.useCallback(()=>e.analytics.sendClickEvent(t?.path,"header-navigation"),[e,t]),o=h.useMemo(()=>e.getLocation("?source=header%20button",t?.path),[e,t]);return s.jsx(Kt,{breakpoint:"lg-up",display:"inline-block",children:s.jsx(x,{"data-test":t?.path?`${t?.path.split("?")[0]}-${e.testId}`:e.testId,intent:"tertiary",size:"s",asChild:!0,onClick:n,children:s.jsxs(Ye,{to:o,intent:"ghost",children:[t?.label??s.jsx(x.Text,{children:s.jsx(b,{id:e.messageString?.lgUp})}),!!e?.count&&s.jsx(uGt,{intent:"secondary",count:e.count})]})})})},hGt=(e,t)=>e?.availability?s.jsx(mGt,{composableNavbarItemConfig:e,composableNavbarItemMetadata:t}):null,gGt=h.memo(({composableNavbarItemsAvailability:e})=>{const t=f(pGt),n=f(Cne),o=f(jN),r=f(Xe),a=dGt();h.useEffect(()=>{d()},[]);const i=t&&n?n:Sne,l=h.useMemo(()=>({coupons:r?o:0}),[r,o]),c=h.useMemo(()=>Ine(a,e,l),[e,l]),d=()=>{const p=["catalogue",...i.map(g=>c[g.type]).filter(g=>g?.availability).map(g=>g.analytics.type)].map((g,E)=>({BUTTON_TYPE:g,POSITION:E}));a({type:Bt.NAVIGATION_BAR_BUTTON_IMPRESSION,navigationBarButtonImpressions:p})};return s.jsx(ae.Fragment,{children:i.map(u=>hGt(c[u.type],u.metadata))})}),Qj=(e,t)=>e.reduce((n,o)=>({...n,[o]:t.formatMessage(`language.${o}`)}),{}),Of=e=>{const t=window.location.search?"&":"?";window.location.href=`${window.location.href}${t}language=${e}`};class EGt extends h.Component{dropdownEl;formattedMessages;constructor(t){super(t),this.state={isOpen:!1},this.closeMenu=this.closeMenu.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.onLanguageChange=this.onLanguageChange.bind(this),this.dropdownEl=ae.createRef(),this.formattedMessages={language:{...Qj(t.languages,t.intl)},preferredLanguage:t.intl.formatMessage("accountSettings.language.selection.label")}}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}componentDidUpdate(t,n){n.isOpen===!1&&this.state.isOpen&&document.addEventListener("mousedown",this.handleClickOutside),n.isOpen&&this.state.isOpen===!1&&document.removeEventListener("mousedown",this.handleClickOutside)}sendCloseEventCallback(){const{actions:t}=this.props;t.analyticsEvent({type:Bt.LOCALE_DROPDOWN_OPENED,userAction:"CLOSE"})}closeMenu(){this.state.isOpen&&this.setState({isOpen:!1},()=>this.sendCloseEventCallback())}toggleMenu(){this.setState(t=>({isOpen:!t.isOpen}),()=>{this.state.isOpen||this.sendCloseEventCallback()})}onLanguageChange(t){const{actions:n}=this.props;n.analyticsEvent({type:Bt.LOCALE_DROPDOWN_OPENED,userAction:"LOCALE SELECTED",localeSelected:t}),n.analyticsEvent({type:_r.LOCALE_CHANGED,locale:t});const o={event:"event",eventAction:"LOCALE_CHANGED",eventCategory:"Locale",eventLabel:t};te.sendEvent({GA:o,WA:null}),n.analyticsEvent({type:_r.LOCALE_CHANGED_GA4,locale:t});const r={event:"locale_changed",locale:t};te.sendEvent({GA:r,WA:null}),Of(t)}handleClickOutside(t){const{target:n}=t;this.dropdownEl&&this.dropdownEl.current&&!this.dropdownEl.current.contains(n)&&this.closeMenu()}render(){const{activeLanguage:t,languages:n}=this.props,{isOpen:o}=this.state;return n.length>1?s.jsxs(rt.Container,{ref:this.dropdownEl,children:[s.jsx(Rn,{visuallyConcealed:!0,htmlFor:"select-language-menu-button",children:`${this.formattedMessages.preferredLanguage} - ${this.formattedMessages.language[t]}`}),s.jsx(rt.TriggerSaltButton,{intent:"secondary",size:"m",text:this.formattedMessages.language[t],"data-synthetics":"header-language-select","data-test":"header-language-dropdown",onClick:this.toggleMenu,isOpen:o,id:"select-language-menu-button","aria-controls":"select-language-menu","aria-expanded":o,"aria-haspopup":"true"}),s.jsx(rt.Body,{isOpen:o,children:s.jsx(rt.Content,{children:s.jsx(Be,{"data-test":"select-language-menu",id:"select-language-menu",children:n.map(r=>s.jsx(Be.Item,{children:s.jsx(rt.ItemButton,{"data-test":`language-item-button-${this.formattedMessages.language[r]}`,lang:r,onClick:()=>this.onLanguageChange(r),children:this.formattedMessages.language[r]})},this.formattedMessages.language[r]))})})})]}):null}}const fGt=e=>({activeLanguage:Ms(e),languages:Wp(e)}),yGt=st({analyticsEvent:U.analyticsEvent}),IGt=Tt(Ht,we(fGt,yGt))(EGt),SGt=D("lng"),CGt=Bp.bind(Df),vGt={languageSelectionEnabled:m.bool.isRequired},vne=({languageSelectionEnabled:e})=>e?s.jsx("div",{className:CGt("header__item","salt-d--none","lg:salt-d--block"),children:s.jsx(IGt,{})}):null;vne.propTypes=vGt;const TGt=e=>({languageSelectionEnabled:SGt(e)&&IP(e)}),_Gt=we(TGt)(vne),bGt=(e,t)=>{const n=e.length;return(t+1)%n},xGt=(e,t)=>{const n=e.length,o=t-1;return o<0?n-1:o},b$=e=>{if(!e||!`${e}`.trim())return[];const t=`${e}`.toLowerCase().trim().replace(/\s{2,}/g," ").split(" ");return[...new Set(t)]},AGt=(e,t)=>e.every(n=>t.some(o=>o.indexOf(n)===0)),RGt=(e,t,n)=>{const o=[],r=b$(t);let a=0;if(e.length===0)return o;do{const i=e[a];if(i){const l=b$(i);AGt(r,l)&&o.push(i)}a+=1}while(a<e.length&&o.length<n);return o},Tne=()=>{const e=f(r=>parseInt(Ze(r,"search-term-search-suggestions-min-characters-for-search-suggestions"),10)),t=f(r=>parseInt(Ze(r,"search-term-search-suggestions-max-search-suggestions"),10)),n=f(r=>parseInt(Ze(r,"search-term-max-character-length"),10)),o=f(r=>Number(Ze(r,"smart-search-suggestions-as-you-type-delay-millis")));return{minCharsToTriggerSearch:e,maxSearchStringLength:n,maxSuggestionsToDisplay:t,smartSearchDelay:o}},DGt=()=>{const e=f(d6),t=F(),n=f(vn);return{getRedirects:()=>{t(Ku.getSearchRedirects(n)).catch(a=>{Ue.api.pushError(a)})},getSearchRedirectUrl:a=>{const i=e.find(l=>l.searchTerm.toLowerCase()===a.toLowerCase());return i?i.targetPath:null}}},OGt=()=>{const e=f(pN),{maxSuggestionsToDisplay:t}=Tne(),n=F(),o=f(vn);return{fetchSmartSearchSuggestions:async a=>{if(a!==e?.searchTermFromQueryParam)try{const i=encodeURIComponent(a),[l,c]=await Promise.all([n(Ur.getRefinedSuggestions(i,o,t)),n(Ur.getFollowOnSuggestions(i,o,t))]);if(l&&c){const d={searchTermFromQueryParam:decodeURIComponent(a),itemAddedToBasket:!1,refined:l.payload.responseData,followOn:c.payload.responseData};n(Ur.loadSmartSearchSuggestions(d))}}catch(i){Ue.api.pushError(i instanceof Error?i:new Error(`fetchSmartSearchSuggestions error: ${JSON.stringify(i)}`))}},smartSearchSuggestions:e}},PGt=v(Ye)`
    white-space: nowrap;
`;function NGt({children:e,url:t,onClick:n,suggestion:o,state:r}){let a=t;const l=f(d6).find(({searchTerm:c=""}={})=>c.toLowerCase()===o.toLowerCase());if(l){const c=l.targetPath;if(!c.startsWith(window.location.origin))return s.jsx(tt,{href:c,onClick:n,children:e});a=c.slice(window.location.origin.length)}return s.jsx(PGt,{className:"salt-overflow--hidden salt-text-overflow--ellipsis",to:a,state:r,onClick:n,children:e})}const LGt=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function kGt(e,t){const n=new RegExp(`(${e.map(r=>LGt(r)).join("|")})`,"ig");return t.split(n).filter(r=>r!=="").map(r=>({text:r,highlighted:!!r.match(n)}))}function jGt({searchWords:e=[],textToHighlight:t=""}){const n=e.filter(o=>typeof o=="string"&&o!=="");return n.length?s.jsx("span",{children:kGt(n,t).map(({text:o,highlighted:r},a)=>{const i=`suggestion-${t}-part-${a}`;return r?s.jsx("b",{className:"matchingTerm",children:o},i):s.jsx("span",{children:o},i)})}):s.jsx("span",{children:t})}const MGt=Bp.bind(Df);function wGt({item:e,index:t,searchWords:n,isSEOReadableURLEnabled:o,onSearchSuggestionClicked:r,source:a}){const i=F(),l=e.trim().split(" ").map(p=>p.charAt(0).toUpperCase()+p.substring(1)).join(" "),c=Za(o,{queryString:`q=${encodeURIComponent(l)}`}),{fetchSearchResultsPage:d}=XT(),u=()=>{r(t,l),d({term:l}).then(()=>{i(yt.setLastFetchedCatalogueLocation(void 0))})};return s.jsx(no.Item,{className:MGt("header__search-list-item"),"data-test":"search-suggestions-item",children:s.jsx(NGt,{url:c,onClick:u,suggestion:l,state:{source:a,isPrefetched:!0},children:s.jsx(jGt,{searchWords:n,textToHighlight:l})})},l)}const FGt=D("seo.rdbl"),BGt=D("sss");function UGt({suggestionsToRender:e,searchTerm:t,onSuggestionClick:n,hideList:o,source:r}){const a=F(),i=h.useMemo(()=>t.split(" "),[t]),l=f(Ms),c=f(FGt),d=f(BGt),u=(p,g)=>{a(U.analyticsEvent({type:d?Cs.SEARCH_SUGGESTION_CLICKED:Cs.SEARCH_SUGGESTION_CHOSEN,id:ct(),userInput:t,searchSuggestion:g,positionInSuggestionList:p,locale:l,...d&&{suggestionsCount:e.length,suggestionType:r,location:"SEARCH_BAR"}})),d&&a(U.analyticsEvent({type:Cs.SELECT_SEARCH_SUGGESTION,searchSuggestion:g,suggestionIndex:p,suggestionType:r,location:"SEARCH_BAR"})),n&&n(g),o&&o()};return s.jsx(h.Fragment,{children:e.map((p,g)=>s.jsx(wGt,{item:p,index:g,searchWords:i,isSEOReadableURLEnabled:c,onSearchSuggestionClicked:u,source:r},p.trim()))})}const GGt=v(Wo)`
    min-inline-size: 0;
    padding-inline-end: 30px;
    border: none;
    ${({headerColorScheme:e})=>e==="default"?"background-color: var(--background-color)":"background-color: var(--intent-contrast)"};
    color: var(--intent-content);

    &::placeholder {
        color: var(--intent-content);
    }
`,$Gt=v(x)`
    border-start-start-radius: 0;
    border-end-start-radius: 0;
`,HGt=v(x)`
    margin-inline-start: -${$(30)};
`,VGt=v("div")`
    margin-block: auto;
    margin-inline: 0;
`,WGt=Bp.bind(Df),YGt=({className:e})=>{const{formatMessage:t}=L(),n=F(),o=Ge(),r=Ne(),a=f(vn),[i,l,c]=Ee(["seo.rdbl","ss.ssm","sss"]),{minCharsToTriggerSearch:d,maxSearchStringLength:u,maxSuggestionsToDisplay:p,smartSearchDelay:g}=Tne(),E=h.useRef(null),y=h.useRef(null),I=h.useCallback(Vr(Se=>{n(Ur.getPrimarySuggestions({searchTerm:Se,limit:p,maxSuggestionsToDisplay:p,regionId:a}))},g),[p,g]),{correctedSearchTerm:S}=f(Qp),C=f(x2),{data:T,isFetching:_}=f(a6),A=f(Ms),R=f(Nn),P=ft(),{getRedirects:N,getSearchRedirectUrl:k}=DGt(),{fetchSmartSearchSuggestions:M,smartSearchSuggestions:w}=OGt(),[j,G]=h.useState(()=>new URLSearchParams(r.search).get("q")||""),{fetchSearchResultsPage:W}=XT(),[H,K]=h.useState(-1),[X,q]=h.useState({type:"EMPTY",suggestions:[]}),ne={placeholder:t("search.placeholder"),clear:t("search.input.clear.text")},ue=es("theme-web-header-color-scheme")||"default";h.useEffect(()=>{const Se=Ae=>{y.current&&!y.current.contains(Ae.target)&&(q({type:"EMPTY",suggestions:[]}),K(-1))};return window.addEventListener("mousedown",Se),N(),T.length||n(Ur.getPrimarySuggestions({searchTerm:"",limit:2e4,maxSuggestionsToDisplay:p,regionId:a})),()=>{window.removeEventListener("mousedown",Se)}},[]),h.useEffect(()=>{const Se=S||j.trim();Se&&M(Se)},[S,C]),h.useEffect(()=>{if(!_&&document.activeElement===E.current){if(l){q({type:"PRIMARY_SEARCH_SUGGESTION",suggestions:T.slice(0,p)});return}he()}_&&!l&&(q({type:"EMPTY",suggestions:[]}),K(-1))},[_]);const oe=()=>{G(""),K(-1),Ie("")},ye=Se=>{const{type:Ae,suggestions:Ce}=Se;K(-1),q(Se),P({type:Cs.SEARCH_SUGGESTION_IMPRESSION,pageViewId:R,searchSuggestionImpressions:Ce.map((We,et)=>({searchTerm:We,sequence:et,location:"SEARCH_BAR",searchSuggestionType:Ae}))})},he=()=>{if(c&&w){const[Se,Ae]=oA(w);if(Ae.length){ye({type:Se,suggestions:Ae});return}}q({type:"PRIMARY_SEARCH_SUGGESTION",suggestions:T.slice(0,p)})},Ie=Se=>{const Ae=Se.trim();if(K(-1),!Ae.length){he();return}if(Ae.length>=d){q({type:"AUTOCOMPLETE_SEARCH_SUGGESTION",suggestions:RGt(T,Se,p)});return}q({type:"EMPTY",suggestions:[]})},Fe=Se=>{const Ae=Se.target.value;l&&I(Ae),G(Ae),Ie(Ae)},be=Se=>{Se.preventDefault();const Ae=Ppe(j),Ce=k(Ae);let We=encodeURIComponent(Ae);if(Ce){const{origin:St}=new URL(Ce);P({type:Cs.SEARCH_REDIRECT,id:ct(),searchTerm:Ae,redirectURL:Ce,locale:A});const wt={event:"search_redirect",search_term:Ae,target:Ce};if(te.sendEvent({GA:wt,WA:null}),St!==window.location.origin){window.location.assign(Ce);return}const dn=Ce.slice(St.length);o(dn);return}if(Ae.length>=u){const St=Ae.lastIndexOf(" ");St>0&&(We=encodeURIComponent(Ae.slice(0,St)))}const et=Za(i,{queryString:`q=${We}`}),ve=H<=-1?"TEXT_SEARCH":X.type;if(W({term:j}).then(()=>{n(yt.setLastFetchedCatalogueLocation(void 0))}),o(et,{state:{source:ve,isPrefetched:!0}}),H>-1&&!c){const St={event:"event",eventCategory:"Search",eventAction:"SuggestionClicked",eventLabel:Ae};te.sendEvent({GA:St,WA:null})}const lt=H>-1?{type:c?Cs.SEARCH_SUGGESTION_CLICKED:Cs.SEARCH_SUGGESTION_CHOSEN,id:ct(),userInput:Ae,searchSuggestion:Ae,positionInSuggestionList:H,locale:A,pageViewId:R,...c&&{suggestionsCount:X.suggestions.length,suggestionType:X.type}}:{type:Cs.SEARCH_FORM_SUBMISSION};P(lt),q({type:"EMPTY",suggestions:[]}),K(-1),E.current?.blur()},ce=()=>{_||he()},me=Se=>{K(Se);const Ae=X.suggestions[Se];Ae&&G(Ae)},De=Se=>{const{key:Ae}=Se,Ce=Se.nativeEvent.isComposing;if(Ae==="ArrowDown"){const We=bGt(X.suggestions,H);Ce||me(We)}if(Ae==="ArrowUp"){Se.preventDefault();const We=xGt(X.suggestions,H);Ce||me(We)}Ae==="Tab"&&(q({type:"EMPTY",suggestions:[]}),K(-1)),Ae==="Escape"&&(q({type:"EMPTY",suggestions:[]}),K(-1))},ge=Se=>{w?.searchTermFromQueryParam.toLowerCase()===Se.toLowerCase()&&G(Se)};return s.jsxs("form",{className:e,role:"search","data-test":"search-form",autoComplete:"off",onSubmit:be,onReset:()=>{oe(),E.current?.focus()},ref:y,children:[s.jsxs(im,{children:[s.jsx(GGt,{hideLabel:!0,last:!0,ref:E,type:"text",name:"q",id:"search",value:j,placeholder:ne.placeholder,maxLength:u,role:"combobox","aria-controls":"search-suggestions-list","aria-expanded":!!X.suggestions.length,input:{onChange:Fe,onKeyDown:De,onFocus:ce},label:"",meta:{touched:!1,invalid:!1},headerColorScheme:ue}),j?s.jsx(VGt,{children:s.jsxs(HGt,{intent:"tertiary",fill:!1,size:"s",type:"reset",children:[s.jsx(ie,{children:ne.clear}),s.jsx(x.Icon,{name:"close_default"})]})}):null,s.jsxs($Gt,{fill:!1,intent:"secondary",type:"submit",children:[s.jsx(ie,{children:ne.placeholder}),s.jsx(x.Icon,{name:"search"})]})]}),!!X.suggestions.length&&s.jsx(no,{className:WGt("header__search-list"),id:"search-suggestions-list",role:"listbox","data-test":"search-suggestions-list",children:s.jsx(UGt,{suggestionsToRender:X.suggestions,searchTerm:j,onSuggestionClick:ge,hideList:()=>{q({type:"EMPTY",suggestions:[]}),K(-1)},source:X.type})})]})},qGt=v.div`
    position: sticky;
    inset-block-start: 0;
    z-index: ${$t.headerWithOverlay};
    display: flex;
    align-items: center;
    gap: var(--salt-spacing-2);
    block-size: ${$(60)};
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
    background: #f2f1f6;
    box-sizing: border-box;
`,KGt=v.img`
    object-fit: contain;
    block-size: 100%;
    border-radius: var(--salt-spacing-2);
`,zGt=v.div`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    overflow: hidden;
`,QGt=v.div`
    font-size: var(--salt-text-m-font-size);
    font-weight: 400;
    color: #090b0a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
`,XGt=v.div`
    font-size: var(--salt-text-s-font-size);
    color: #89888d;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
`,ZGt=v.a`
    flex: 0 0 auto;
    margin-inline-start: var(--salt-spacing-2);
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
    font-size: var(--salt-text-m-font-size);
    text-decoration: none;
    color: #007aff;
    border: none;
`,JGt=v.button`
    color: #bab9be;
    background: none;
    border: none;
    inline-size: 16px;
`,e0t=D("sm.bnnr"),_ne=h.createContext({dismiss:()=>{},isSmartBannerVisible:!1}),bne=()=>{const e=h.useContext(_ne);if(e===void 0)throw new Error("must be used within a SmartBannerProvider");return e},xne=({children:e})=>{const{dismiss:t,isSmartBannerVisible:n}=Fot();return s.jsx(_ne.Provider,{value:{dismiss:t,isSmartBannerVisible:n},children:e})},Ane=()=>{const{formatMessage:e}=L(),{appTitle:t,appAuthor:n,iosAppId:o,androidCustomScheme:r,iosCustomScheme:a,iosIconUrl:i,androidIconUrl:l}=gT(),{isSmartBannerVisible:c,dismiss:d}=bne(),u=f(e0t),p=F(),g=L7(),E=g==="ios",y=E?a:r,I=E?i:l,S=jot(g,y),{androidIntentUrl:C,iosAppStoreUrl:T}=Mot();if(h.useEffect(()=>{if(c&&u){p(U.analyticsEvent({type:Ya.SMART_BANNER_IMPRESSION}));const P={event:"ga4_view_promotion",ecommerce:{creative_slot:"mobile_app_prompt",promotion_name:"Go to app",promotion_id:"go_to_app",link_type:"app",content_source:"config"}};te.sendEvent({GA:P,WA:null})}},[p,u,c]),!u)return null;if(!c)return s.jsx(Gn,{children:s.jsx("meta",{name:"apple-itunes-app",content:`app-id=${o}`})});const _=()=>g==="other"?void 0:{ios:S?a&&`${a}://`:T,android:C}[g],A=()=>{d(),p(U.analyticsEvent({type:Ya.SMART_BANNER_CLOSED}))},R=()=>{p(U.analyticsEvent({type:Ya.SMART_BANNER_CLICKED}));const P={event:"ga4_select_promotion",ecommerce:{creative_slot:"mobile_app_prompt",promotion_name:"Go to app",promotion_id:"go_to_app",link_type:"app",content_source:"config"}};te.sendEvent({GA:P,WA:null})};return s.jsxs(ae.Fragment,{children:[s.jsx(Gn,{children:s.jsx("meta",{name:"apple-itunes-app",content:`app-id=${o}`})}),s.jsxs(qGt,{children:[s.jsx(JGt,{"data-test":"close-smart-banner","aria-label":e({id:"smart.banner.close.ariaLabel"}),onClick:A,children:s.jsx(pe,{name:"close_default",width:12})}),I&&s.jsx(KGt,{"data-test":"smar-banner-logo",src:I,alt:`${t} icon`}),s.jsxs(zGt,{children:[s.jsx(QGt,{"data-test":"smart-banner-app-title",children:t}),n&&s.jsx(XGt,{"data-test":"smart-banner-app-description",children:n})]}),s.jsx(ZGt,{"data-test":"smart-banner-action",onClick:R,href:_(),children:e({id:"smart.banner.open"})})]})]})},t0t=e=>({linkType:e.linkType,openInNewTab:e.openInNewTab,value:null,values:e.values??[],...e.encodedName?{encodedName:e.encodedName}:{}}),s0t=(e,t=!1,n=[])=>n.flatMap(o=>{if(!o)return[];const{menuCampaignItemId:r,...a}=o,i=Aa.normalizeToLegacyTarget(a.target,t),l=Aa.calculateLegacyTargetUrl(i,{isSEOReadableURLEnabled:e});return{...a,id:r,targetUrl:l,target:t0t(i)}}),n0t=(e,t)=>`${gv.MENU_CAMPAIGNS}-${e}-${t}`,o0t=(e,t)=>{const{label:n,iconUrl:o,name:r}=e;return{label:n,name:n,iconUrl:o,navContentType:gv.MENU_CAMPAIGNS,menuCampaignIndex:t,menuCampaignName:r}},r0t=(e,t,n=!1)=>e.map(({menuCampaignId:o,items:r,...a},i)=>({...o0t(a,i),id:n0t(o,i),children:s0t(t,n,r),menuCampaignId:o})),a0t=()=>{const[e=!1,t=!1]=Ee(["seo.rdbl","seo.ra"]),[{data:n}]=Kd({query:i9});return{isFetching:!1,campaigns:r0t(n?.menuCampaigns??[],e,t)}},i0t=()=>{const e=Ne(),t=Me(Do),n=Me(Na),[o,r]=h.useState(!1);return{loading:o,getAuthToken:async()=>{r(!0);const l=await fetch("/chat/auth",Jr({clientRouteId:t,csrfToken:n,method:"GET"}));if(!l.ok)return r(!1),Z.error("request.error.title"),{token:""};const c=await l.json();return r(!1),{token:c.token}},getCustomDataToken:async()=>{r(!0);const l={chatInitiationPage:e.pathname},c=await fetch("/chat/custom-data",Jr({clientRouteId:t,csrfToken:n,method:"POST",contentType:"application/json",body:JSON.stringify(l)}));if(!c.ok)return r(!1),Z.error("request.error.title"),{token:""};const d=await c.json();return r(!1),{token:d.token}}}},l0t=()=>{const e=es("ujet-override-strings");return{getMessages:()=>{if(e)try{return JSON.parse(e)}catch(n){Ue.api.pushError(n instanceof Error?n:new Error(`UJET support chat messages error: ${JSON.stringify(n)}`));return}}}},Rne=h.createContext({ujet:void 0,loading:!1,unreadMessageCount:0}),c0t=({children:e})=>{const t=es("ujet-company-key"),n=es("ujet-logo-url"),o=es("ujet-language"),r=es("ujet-company-host"),a=es("ujet-menu-key-web"),{getMessages:i}=l0t(),l=ft(),{getCustomDataToken:c,getAuthToken:d,loading:u}=i0t(),[p,g]=h.useState(0),[E,y]=h.useState();h.useEffect(()=>(I(),()=>{_()}),[]),h.useEffect(()=>{E?.visible&&p>0&&g(0)},[E?.visible]);const I=()=>{if(typeof window<"u"&&typeof window.UJET=="function"&&!E&&t){const A=new window.UJET({companyId:t,host:r,authenticate:d,logo:n,lang:o});c().then(R=>{A.config({logo:n,disableLauncher:!0,menuKey:a,signedCustomData:R.token,messages:i()}),A.mount("#ujet-support-chat-widget");const P=document.getElementById("ujet-support-chat-widget");if(P?.shadowRoot?.mode==="open"){const k=document.createElement("style");k.textContent=`
                            a {
                                color: var(--typography-primary);
                                text-decoration: none;
                            }
                            a:hover {
                                text-decoration: underline;
                            }
                            .message-card-item, .messages .new-message {
                                background: var(--intent-primary-50);
                                color: var(--typography-primary);
                            }
                            .message-card-item:hover, .messages .new-message:hover {
                                background: var(--intent-primary-100);
                                color: var(--typography-primary);
                                opacity: 1;
                            }
                        `,P.shadowRoot.appendChild(k)}A?.on("chat.message",S),A?.on("chat.connected",C),A?.on("chat.disconnected",T),y(A)}).catch(R=>{Ue.api.pushError(R instanceof Error?R:new Error(`UJET support chat error: ${JSON.stringify(R)}`))})}},S=()=>{const A=localStorage.getItem("ujet:unread")??"0";g(Number(A))},C=()=>{l({type:Ip.CHAT_WITH_US_SESSION_STARTED})},T=()=>{l({type:Ip.CHAT_WITH_US_SESSION_ENDED})},_=()=>{E?.off("chat.message",S),E?.off("chat.connected",C),E?.off("chat.disconnected",T)};return s.jsx(Rne.Provider,{value:{ujet:E,loading:u,unreadMessageCount:p},children:e})},d0t=({children:e})=>{const[t]=Ee(["ccai"]);return t?s.jsx(c0t,{children:e}):s.jsx(h.Fragment,{children:e})},Xj=()=>{const{ujet:e,loading:t,unreadMessageCount:n}=h.useContext(Rne);return{ujet:e,loading:t,unreadMessageCount:n,launchChat:()=>{if(!e){window.location.reload();return}e.visible?e?.hide():e?.show()},destroySession:()=>{e?.destroy()}}},u0t=v.span`
    display: flex;
    align-items: center;
`,Dne=()=>{const e=L(),t=f(At),n=f(ei),o=f(Na),r=f(Do),a=ft(),{destroySession:i}=Xj(),[l]=Ee(["ccai"]),c={logout:e.formatMessage("header.topbar.logout")},d=()=>{try{if(a({type:on.LOGOUT_ANALYTICS,retailerCustomerId:n}),n){const p={event:"event",eventAction:"LoginSuccess",eventLabel:"LoginSuccess",eventCategory:"Login",retailerCustomerId:n};te.sendEvent({GA:p,WA:null})}}catch{Ue.api.pushError(new Error("Unable to send logout event"))}},u=p=>{p.preventDefault(),fetch(p2e({basePath:t}),{method:"POST",credentials:"same-origin",headers:{"client-route-id":r,"content-type":"application/json; charset=utf-8","X-CSRF-TOKEN":o}}).then(g=>g.json()).then(({logoutUrl:g})=>(l&&i(),d(),localStorage.removeItem(cg),window.location.assign(g)))};return s.jsx(tt,{standalone:!0,href:fn(),onClick:u,"data-test":"logout-button","data-synthetics":"logout-form",className:"salt-m-x--4 salt-m-y--2 lg:salt-m-x--0 lg:salt-m-y--0",children:s.jsxs(u0t,{children:[s.jsx(pe,{name:"logout",height:20,className:"salt-m-r--2"}),s.jsx(O,{size:"m",children:c.logout})]})})},p0t=D("ads"),Xb=v.span`
    display: flex;
    align-items: center;
`,m0t=({hasLoyalty:e,displayLoginDetails:t,closeMenu:n,dropdownEl:o})=>{const r=t?jd():Md(),a=i=>{const l=o;l&&l.current&&i.target instanceof HTMLElement&&!l.current.contains(i.target)&&n()};return h.useEffect(()=>(document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}),[]),s.jsx(rt.Body,{isOpen:!0,children:s.jsx(rt.Content,{className:"salt-p-x--2",children:s.jsxs(Be,{inline:!1,id:"account-menu","aria-labelledby":"account-button",children:[e&&s.jsx(Be.Item,{className:"salt-m-b--4",children:s.jsx(Ye,{standalone:!0,to:Tp(),onClick:n,children:s.jsxs(Xb,{children:[s.jsx(pe,{name:"loyalty",height:20,className:"salt-m-r--2"}),s.jsx(O,{size:"m",children:s.jsx(b,{id:"header.topbar.points",values:{amount:s.jsx(bd,{getQuantity:Cg})}})})]})})}),s.jsx(Be.Item,{className:"salt-m-b--4",children:s.jsx(Ye,{standalone:!0,to:"/orders","data-synthetics":"orders-list-menu-button",onClick:n,children:s.jsxs(Xb,{children:[s.jsx(pe,{name:"orders",height:20,className:"salt-m-r--2"}),s.jsx(O,{size:"m",children:s.jsx(b,{id:"header.topbar.orders"})})]})})}),s.jsx(Be.Item,{className:"salt-m-b--4",children:s.jsx(Ye,{standalone:!0,to:r,"data-synthetics":"topbar-account-settings-link",onClick:n,children:s.jsxs(Xb,{children:[s.jsx(pe,{name:"settings",height:20,className:"salt-m-r--2"}),s.jsx(O,{size:"m",children:s.jsx(b,{id:"header.topbar.settings"})})]})})}),s.jsx(Be.Item,{children:s.jsx(Dne,{})})]})})})},h0t=()=>{const e=L(),t=f(p0t),n=f(v6),[o,r]=h.useState(!1),a=h.useRef(null),i={accountDropdown:e.formatMessage("header.topbar.account.dropdown")},l=()=>r(!1),c=()=>r(!o);return s.jsxs(rt.Container,{ref:a,children:[s.jsx(rt.TriggerSaltButton,{intent:"secondary",size:"m",text:i.accountDropdown,iconName:"account","data-test":"account-dropdown-button","data-synthetics":"account-dropdown-button",isOpen:o,id:"account-button",onClick:c,"aria-haspopup":"true","aria-expanded":o?!0:void 0}),o&&s.jsx(m0t,{hasLoyalty:n,displayLoginDetails:t,closeMenu:l,dropdownEl:a})]})},g0t=v(x)`
    position: relative;
    ${re.lgUp`
        max-inline-size: ${$(200)};
    `}
`,E0t=v.div`
    position: absolute;
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
    inset-block-start: calc(var(--salt-spacing-2) * -1);
`,f0t=v.div`
    position: relative;
`,y0t=v(Ye)`
    text-decoration: none;
`,E_=({icon:e="",badge:t,buttonDataTestId:n="",a11yText:o="",children:r})=>{const a=ci(),i=F(),l=f(xn),c=rf(),d=es("theme-web-header-color-scheme");let u="secondary";d==="default"&&(u=l?"secondary":"primary");const p=()=>{i(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Header",componentType:"Header",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),i(U.analyticsEvent({type:Le.BEGIN_CHECKOUT})),a(),i(U.analyticsEvent({type:Zn.CHECKOUT_WALK}))},g=y=>i(ds({name:sm,event:y})),E=y=>{g(y),p(),Z.close(bp)};return s.jsxs(f0t,{children:[s.jsx(g0t,{"data-test":n,asChild:!0,intent:u,onClick:E,children:s.jsxs(y0t,{to:c,children:[s.jsx(ie,{children:o}),s.jsx(x.Icon,{name:e}),s.jsx(x.Text,{className:"salt-d--none sm:salt-d--block",children:r})]})}),s.jsx(E0t,{children:t&&s.jsx(pe,{className:"salt-d--block sm:salt-d--none",name:"status_yes",success:!0})})]})},I0t=()=>{const e=F(),t=f(Xe),{deliveryDestinationId:n,deliveryMethod:o}=f(zs).data||{};h.useEffect(()=>{t&&n&&o&&e(Uy.getDefaultShippingGroupType(o,n))},[t,n,o])},S0t=({slot:e})=>{const{utcStartTime:t,utcEndTime:n,timeZoneId:o}=e,r=L(),a=f(Zt),i=f(Mt),l=e?.deliveryType===pt.clickAndCollect.type,c=e?.deliveryType===pt.vanDelivery.type,d=qe(t,qe.ISO_8601).tz(o).format(),u=qe(n,qe.ISO_8601).tz(o).format(),p=()=>l?"click_collect":c?"home_delivery":"slot";return s.jsxs(E_,{badge:!0,icon:p(),buttonDataTestId:"delivery-slot-details-button",a11yText:r.formatMessage("header.delivery.reserved.a11y"),children:[s.jsx("span",{className:"salt-d--block",children:s.jsx(jg,{dateIso:d,timeZoneId:o,dateFormat:a})}),s.jsx("span",{className:"salt-d--block",children:s.jsx(xf,{dateIsoFrom:d,dateIsoTo:u,timeZoneId:o,timeFormat:i})})]})},C0t=({slot:e})=>{const n=Zi()(e?.deliveryTimeInMinutes),o=L();return s.jsx(E_,{badge:!0,icon:"express_collect",buttonDataTestId:"delivery-slot-details-button",a11yText:o.formatMessage("header.delivery.reserved.a11y"),children:s.jsx(b,{className:"salt-d--none sm:salt-d--block",id:"header.delivery.express.collection",values:{readyTimeSpan:n}})})},v0t=({slot:e})=>{const t=L(),n=t.formatNumber(e?.deliveryTimeInMinutes||0,{style:"unit",unit:"minute",unitDisplay:"short"});return s.jsx(E_,{badge:!0,icon:"on_demand",buttonDataTestId:"delivery-slot-details-button",a11yText:t.formatMessage("header.delivery.reserved.a11y"),children:s.jsx("span",{children:n})})},T0t=e=>{const[t]=Ee(["bt.spl"]),n=f(Vi),o=L();I0t();let r=S0t;return n?.deliveryMethod==="CUSTOMER_COLLECTION"&&n?.slotType==="ON_DEMAND"&&(r=C0t),n?.deliveryMethod==="HOME_DELIVERY"&&n?.slotType==="ON_DEMAND"&&(r=v0t),s.jsxs("div",{...e,children:[n&&s.jsx(r,{slot:n}),!n&&s.jsx(E_,{icon:"slot",buttonDataTestId:"delivery-book-delivery-button",a11yText:o.formatMessage(t?"header.delivery.book.grocery":"header.delivery.book"),children:s.jsx(b,{id:t?"header.delivery.book.grocery":"header.delivery.book"})})]})},_0t={TAB:9,ENTER:13,ESC:27,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40},Xc={missingAddress:"delivery.destination.selector.button.missing.address",delivery:"delivery.destination.selector.plus.scheduled.delivery.option.title",fastDelivery:"delivery.destination.selector.plus.ondemand.delivery.option.title",collection:"delivery.destination.selector.plus.scheduled.collection.option.title"},b0t=()=>{const{formatMessage:e}=L(),t=wc(),{regionId:n}=YE(),o=t.data,r=o?.deliveryMethod;if(!o||!r)return e(Xc.missingAddress);let a="",i="";if(r==="CUSTOMER_COLLECTION")a=e(Xc.collection);else if(r==="JINN")a=e(Xc.delivery);else if(r==="HOME_DELIVERY"){const c=o.propositions;if(!c||c.length===0)return e(Xc.missingAddress);const d=c.find(p=>p.regionId==n);if(!d)return e(Xc.missingAddress);const u=d.propositionType;u==="FAST"?a=e(Xc.fastDelivery):u==="SCHEDULED"&&(a=e(Xc.delivery))}return o.addressId==null?i=o.postalCode:i=o.name||o.formattedAddress,`${a}: ${i}`},x0t=v(tt)``,A0t=({linkElement:e,...t})=>{const{openDDS:n}=g_(),o=b0t(),r=a=>{a.preventDefault(),a.stopPropagation(),n({userAction:"MORE_CLICKED"})};return s.jsx(x0t,{standalone:!0,href:fn(),onClick:r,"data-test":"delivery-destination-selector-navigation-button",as:e,...t,children:s.jsxs(Q,{align:"center",children:[s.jsx(pe,{name:"map_marker_hollow",className:"salt-m-r--2"}),s.jsx(O,{size:"m",children:o})]})})},R0t=({size:e="sm"})=>{const t=L(),n=F(),o=f(Wp),r=f(Ms),a={language:{...Qj(o,t)},selectALanguage:t.formatMessage("accountSettings.language.selection.label")},i=async l=>{const c=l.target.value;n(U.analyticsEvent({type:_r.LOCALE_CHANGED,locale:c}));const d={event:"event",eventAction:"LOCALE_CHANGED",eventCategory:"Locale",eventLabel:c};te.sendEvent({GA:d,WA:null}),n(U.analyticsEvent({type:_r.LOCALE_CHANGED_GA4,locale:c}));const u={event:"locale_changed",locale:c};te.sendEvent({GA:u,WA:null}),Of(c)};return o.length>1?s.jsx(Dr,{fill:!0,hideLabel:!0,label:a.selectALanguage,id:"select-language",onChange:i,value:r,"data-synthetics":"header-language-select",size:e,title:a.selectALanguage,children:o.map(l=>s.jsx("option",{value:l,children:a.language[l]},l))}):null},D0t={isOverlayVisible:!1,setIsOverlayVisible:()=>{}},Zj=h.createContext(D0t),O0t=({children:e})=>{const[t,n]=h.useState(!1);return s.jsx(Zj.Provider,{value:{isOverlayVisible:t,setIsOverlayVisible:n},children:e})},P0t=()=>h.useContext(Zj),N0t=D("lng"),L0t=D("ads"),k0t=D("showpromopage"),j0t=D("seo.rdbl"),M0t=D("cf.mc.on"),w0t=D("cmpnb"),F0t=D("seo.ra"),B0t=D("cp"),Wu="source=navigation",U0t=()=>{const e=document.getElementById("global-block")?.offsetHeight||0,t=document.getElementById("top-tabs")?.offsetHeight||0;return e+t},x$=e=>e?e.substring(e.lastIndexOf("/")+1):"";class G0t extends h.Component{formattedMessages;menuCampaignsImpressionReported;loggedInEntryPoints;loggedOutEntryPoints;additionalBrowseShopLinks;constructor(t){super(t);const{actions:n,intl:o,hasLoyalty:r,isAllPromotionsPageEnabled:a,isCouponPageEnabled:i,isSEOReadableURLEnabled:l,isDeliveryDestinationSelectorEnabled:c,isComposableNavbarEnabled:d,composableNavbarItems:u,composableNavbarItemsAvailability:p,onBrowseClick:g,couponsCount:E,isLoggedIn:y}=this.props;this.state={overheadContentHeight:0},this.fetchFullCategories=this.fetchFullCategories.bind(this),this.onShowNavigation=this.onShowNavigation.bind(this),this.onHideNavigation=this.onHideNavigation.bind(this),this.setOverheadContentHeight=this.setOverheadContentHeight.bind(this),this.generateItemUrl=this.generateItemUrl.bind(this),this.formattedMessages={back:o.formatMessage("navigation.back"),title:o.formatMessage("navigation.title"),browse:o.formatMessage("navigation.browse"),attributeTitle:o.formatMessage("navigation.menu")};const I={coupons:y?E:0},S=Ine(n.analyticsEvent,p,I),C={message:o.formatMessage("promotions.button"),href:di(),onClick:S[pn.PROMOTIONS].analytics.sendClickEvent},T={message:o.formatMessage("coupons.button"),href:zE(),onClick:S[pn.COUPONS].analytics.sendClickEvent,count:I.coupons},_={message:o.formatMessage("navigation.products"),href:l?bo(void 0,{queryString:Wu}):ao({queryString:Wu})};this.additionalBrowseShopLinks=[...a?[C]:[],...i?[T]:[],_];const A={icon:"home",message:o.formatMessage("navigation.home"),href:fn(),onClick:()=>{const ue={event:"select_navigation",name:"home",location:"menu"};return te.sendEvent({GA:ue,WA:null}),this.props.actions.analyticsEvent({type:Ds.SELECT_NAVIGATION,name:"home",location:"menu"})}},R={Component:A0t,componentType:"link"},P=()=>{g(),this.dispatchMenuCampaignsImpression()},N={icon:"browse",message:this.formattedMessages.browse,children:this.props.rootCategories,onClick:P,href:l?bo(void 0,{queryString:Wu}):ao({queryString:Wu})},k=d&&u?u:Sne,M=(ue,oe)=>ue?.availability?{icon:ue.icon,message:oe?.label?oe.label:o.formatMessage(ue.messageString?.xsUp??""),href:ue.getLocation("?source=header%20dropdown",oe?.path),onClick:()=>ue.analytics.sendClickEvent(oe?.path),...ue?.count&&{count:ue.count}}:void 0,w=k.map(ue=>M(S[ue.type],ue.metadata)).filter(ue=>!!ue),j={icon:"loyalty",message:s.jsx(b,{id:"header.topbar.points",values:{amount:s.jsx(bd,{getQuantity:Cg})}}),href:Tp()},G={icon:"orders",message:o.formatMessage("header.topbar.orders"),href:lo(),onClick:()=>{const ue={event:"select_navigation",name:"orders",location:"menu"};return te.sendEvent({GA:ue,WA:null}),this.props.actions.analyticsEvent({type:Ds.SELECT_NAVIGATION,name:"orders",location:"menu"})}},W=this.props.displayLoginDetails?jd():Md(),H={icon:"settings",message:o.formatMessage("header.topbar.settings"),href:W},K={Component:Dne,componentType:"link"},X={icon:"account",message:o.formatMessage("header.topbar.login"),href:Yo(),onClick:()=>{const ue={event:"select_navigation",name:"login",location:"menu"};return te.sendEvent({GA:ue,WA:null}),this.props.actions.analyticsEvent({type:Ds.SELECT_NAVIGATION,name:"login",location:"menu"})}},q={icon:"account_new",message:o.formatMessage("header.topbar.register"),href:xv(),onClick:()=>{const ue={event:"select_navigation",name:"register",location:"menu"};return te.sendEvent({GA:ue,WA:null}),this.props.actions.analyticsEvent({type:Ds.SELECT_NAVIGATION,name:"register",location:"menu"})}},ne={Component:R0t};this.loggedInEntryPoints=[A,N,...w,...r?[j]:[],G,H,...c?[R]:[],K],this.loggedOutEntryPoints=[X,q,A,N,...w,...c?[R]:[],...t.isLanguageSelectEnabled?[ne]:[]],this.menuCampaignsImpressionReported=!1}setOverheadContentHeight(){this.setState({overheadContentHeight:U0t()})}generateItemUrl(t,n,o){const{isSEOReadableURLEnabled:r,categoryDictionary:a,isRegionAgnosticEnabled:i}=this.props,l=t&&!r?`${Wu}&sublocationId=${n}`:`${Wu}`;if(r&&a){if(t){const c=a[n];if(c&&c.fullURLPath){const d=c.fullURLPath.toLowerCase();return Sa(i?o:n,d,{queryString:l})}}return bo(void 0,{queryString:l})}return ao({queryString:l})}onShowNavigation(){this.fetchFullCategories(),this.setOverheadContentHeight(),window.addEventListener("resize",this.setOverheadContentHeight)}onHideNavigation(){window.removeEventListener("resize",this.setOverheadContentHeight)}fetchFullCategories(){this.props.categoriesDepth!==4&&this.props.actions.fetchCategories({depth:4,isSEOReadableURLEnabled:this.props.isSEOReadableURLEnabled})}componentDidUpdate(t){const{location:n}=this.props;t.location.key!==n.key&&(this.menuCampaignsImpressionReported=!1)}dispatchMenuCampaignsImpression(){if(this.menuCampaignsImpressionReported)return;const{isMenuCampaignsEnabled:t,menuCampaigns:n,actions:o}=this.props;t&&n?.campaigns.length&&(n.campaigns.forEach((r,a)=>{const{menuCampaignId:i,menuCampaignName:l,iconUrl:c}=r;o.analyticsEvent({type:Bt.MENU_CAMPAIGN_IMPRESSION,menuCampaignId:i,menuCampaignName:l,fileName:x$(c),position:a.toString()});const d={ecommType:"enhanced",eventCategory:"E-commerce",event:"view_promotion",eventAction:"MENU_CAMPAIGN_IMPRESSION",ecommerce:{promoView:{promotions:[{promotionType:"Menu Campaign",id:i,name:l,creative:x$(c),position:`Menu ${a.toString()}`}]}}};te.sendEvent({GA:d,WA:null})}),this.menuCampaignsImpressionReported=!0)}render(){const{isLoggedIn:t,rootCategories:n,categoriesFetching:o,onBrowseClick:r,categoryDictionary:a,isMenuCampaignsEnabled:i,menuCampaigns:l,actions:c,headerColorScheme:d}=this.props,{overheadContentHeight:u}=this.state,p={categoriesDictionary:{categories:a,rootCategories:n},analyticsEvent:c.analyticsEvent,additionalBrowseShopLinks:this.additionalBrowseShopLinks,...i?{menuCampaigns:l.campaigns}:{},entryPointsInHeader:t?this.loggedInEntryPoints:this.loggedOutEntryPoints,messages:this.formattedMessages,onHideNavigation:this.onHideNavigation,onShowNavigation:this.onShowNavigation,"data-test":"header-shop-categories","data-loading":o||l.isFetching,linkElement:Ye,keyboard:_0t,overheadContentHeight:u,headerColorScheme:d,generateItemUrl:this.generateItemUrl,actions:{onOpen:()=>{this.props.actions.performanceMark({name:UF})},onOpenLgUp:()=>{r(),this.props.actions.performanceMark({name:UF}),this.dispatchMenuCampaignsImpression()},onFirstPaneDisplayed:()=>{this.props.actions.performanceMark({name:cAe})},analyticsEvent:c.analyticsEvent}};return s.jsx(Zj.Consumer,{children:({setIsOverlayVisible:g})=>s.jsx(pHe,{...p,onToggleDropdown:g})})}}const $0t=e=>({categoriesFetching:_q(e),categoriesDepth:bq(e),categoryDictionary:pO(e),rootCategories:xq(e),isAllPromotionsPageEnabled:k0t(e),isCouponPageEnabled:B0t(e),isLanguageSelectEnabled:N0t(e)&&IP(e),isLoggedIn:Xe(e),displayLoginDetails:L0t(e),isSEOReadableURLEnabled:j0t(e),isMenuCampaignsEnabled:M0t(e),isDeliveryDestinationSelectorEnabled:Hp(e),location:UC(e),isComposableNavbarEnabled:w0t(e),composableNavbarItems:Cne(e),isRegionAgnosticEnabled:F0t(e),couponsCount:jN(e)}),H0t=st({fetchCategories:fr.getCategories,performanceMark:ds,analyticsEvent:U.analyticsEvent}),V0t=Tt(Ht,we($0t,H0t))(G0t),W0t=(e,t)=>de(e.dates.deliveryEndDate)-de(t.dates.deliveryEndDate),Y0t=(e=[])=>{const t=e.find(o=>o.editStatus==="UNDER_EDIT");if(t)return t;const n=e.filter(o=>o.editStatus==="EDITABLE").sort(W0t);return n.length>0?n[0]:null},q0t={pendingOrders:{orders:[]}},K0t=v.div`
    display: flex;
    padding-inline: var(--salt-spacing-2);
    padding-block: var(--salt-spacing-2);
    background-color: var(--intent-action-50);
    border-radius: var(--salt-radius-0);
`,One=e=>{h.useEffect(()=>{const{actions:S,isBasketUnderEdit:C}=e;C&&S.getPendingOrders()},[]);const t=L(),n=Ge(),o=Yk(),r=cn(o),{pathname:a}=Ne(),[i]=Ee(["thcu"]),{isBasketUnderEdit:l,descriptiveDateFormat:c,timeFormat:d,pendingOrders:u,actions:{onEdit:p}}=e;if(!l)return null;const g=Y0t(u.orders),E=!!zr({path:r},a);if(g?.editStatus!=="UNDER_EDIT"||i&&E)return null;const y=s.jsx(Gl,{dateIso:g.dates.confirmOrderChangesBy,timeZoneId:g.dates.timeZoneId,local:!0,dateFormat:c,timeFormat:d}),I={edit:t.formatMessage("header.order.status.under.edit"),save:t.formatMessage("header.order.status.save.changes",{editUntil:y})};return s.jsxs(K0t,{"data-test":"order-editing-banner",children:[s.jsx(pe,{width:20,height:20,className:"salt-m-r--2",name:"orders_edit"}),s.jsxs("div",{children:[s.jsx(O,{size:"l",className:"salt-m-r--1",children:I.edit}),s.jsx(Ye,{href:r,className:"salt-d--inline-block",onClick:()=>p(g.orderId,n),children:s.jsx(O,{size:"l",children:I.save})})]})]})};One.defaultProps=q0t;const z0t=e=>({descriptiveDateFormat:Zt(e),timeFormat:Mt(e),isBasketUnderEdit:Ar(e),pendingOrders:Ac(e)}),Q0t=st({onEdit:ji.editOrder,getPendingOrders:Mi.getPendingOrders}),X0t=Tt(we(z0t,Q0t))(One),Z0t=({className:e})=>{const{formatMessage:t}=L(),n={superUser:t("header.topbar.superuser").toUpperCase()};return s.jsx(Te,{className:e,intent:"info",text:s.jsxs(O,{bold:!0,children:[" ",n.superUser]})})},la=e=>{const t=F();return n=>{const o={event:"select_navigation",name:n,location:e};te.sendEvent({GA:o,WA:null}),t(U.analyticsEvent({type:Ds.SELECT_NAVIGATION,name:n,location:e}))}},A$=v.span`
    display: flex;
    align-items: center;
`;function J0t(e,t){const n=`destination=${encodeURIComponent(`${e}${t}`)}`;return Yo({queryString:n})}const e$t=({className:e})=>{const{formatMessage:t}=L(),n=Ne(),o=F(),r=h.useRef(null),[a,i]=h.useState(!1),l=la("header"),c=()=>{a&&i(!1)},d=()=>{i(p=>!p)};h.useEffect(()=>{const p=g=>{r?.current?.contains(g.target)||c()};return a?document.addEventListener("mousedown",p):document.removeEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[a]);const u=J0t(n.pathname,n.search);return s.jsxs(rt.Container,{className:e,ref:r,children:[s.jsx(rt.TriggerSaltButton,{intent:"secondary",size:"m",text:t("header.topbar.login.dropdown"),"data-test":"login-dropdown-button","data-synthetics":"login-dropdown-button",onClick:d,isOpen:a,id:"login-menu-button","aria-controls":"login-menu","aria-expanded":a,"aria-haspopup":"true"}),s.jsx(rt.Body,{isOpen:a,children:s.jsx(rt.Content,{children:s.jsxs(Be,{id:"login-menu","aria-labelledby":"login-menu-button",children:[s.jsx(Be.Item,{className:"salt-m-b--4",children:s.jsx(tt,{standalone:!0,href:u,"data-synthetics":"login-button","data-test":"login-button",onClick:()=>{l("login"),o(U.analyticsEvent({type:on.LOGIN_CLICKED,source:"loggedOutTopbar"})),c()},children:s.jsxs(A$,{children:[s.jsx(pe,{name:"account",className:"salt-m-r--2"}),s.jsx(b,{id:"header.topbar.login"})]})})}),s.jsx(Be.Item,{children:s.jsx(tt,{standalone:!0,href:xv(),"data-test":"register-button",onClick:()=>{l("register"),o(U.analyticsEvent({type:on.REGISTER_CLICKED,source:"loggedOutTopbar"})),c()},children:s.jsxs(A$,{children:[s.jsx(pe,{name:"account_new",className:"salt-m-r--2"}),s.jsx(b,{id:"header.topbar.register"})]})})})]})})})]})},jr=Bp.bind(Df),t$t=D("loyalty"),s$t=D("showpromopage"),n$t=D(_u),o$t=D("rec"),r$t=D(ok),a$t=D("ro.su"),i$t=D("hdp"),l$t=D("dp"),c$t=D("sis"),d$t=D("cp"),u$t=()=>{const e=F(),t=L(),{isOverlayVisible:n}=P0t(),o=f(FE),r=f(j=>is(j)),a=f(wE),i=f(Xe),l=f(t$t),c=f(s$t),d=f(n$t),u=f(o$t),p=f(r$t),g=f(Hp),E=f(a$t),y=f(i$t),I=f(l$t),S=f(c$t),C=f(d$t),T=f(j=>j.session.isSuperuser),{isSmartBannerVisible:_}=bne(),A=a0t(),R=Ne();h.useEffect(()=>{!r.lastUpdated&&!r.isFetching&&e(Yt.getBasket()),l&&i&&!o.isFetching&&!o.lastUpdated&&e(yd.getCustomerLoyalty())},[]);const P=h.useCallback(()=>{e(U.analyticsEvent({type:Bt.CATALOGUE_NAVIGATION_BAR_BUTTON_CLICKED,description:"User clicked on the catalogue navigation bar button"}))},[]),N=h.useCallback(()=>{const j={event:"select_navigation",name:"home",location:"header"};return te.sendEvent({GA:j,WA:null}),e(U.analyticsEvent({type:Ds.SELECT_NAVIGATION,name:"home",location:"header"}))},[]),k=t.formatMessage("home.button"),M=h.useMemo(()=>({deliveryPass:I&&y,favorites:!0,instantShop:!!a,promotions:c,coupons:C,recipes:u,mealPlanning:p,lists:!0,recurringOrders:E,regularOrders:d,shopInShop:S}),[a]),w=es("theme-web-header-color-scheme")||"default";return s.jsxs(h.Fragment,{children:[s.jsxs("header",{className:jr({header:!0,"header--overlay-visible":n,"header--smart-banner":_,"header--alternate":w==="alternate"}),id:"main-header",children:[s.jsxs("div",{className:jr({header__row:!0,header__navbar:!0}),children:[s.jsxs(Ye,{className:jr("header__logo","header__logo--l"),href:"/",id:"main-header-logo",onClick:N,children:[s.jsx(ie,{children:k}),s.jsx(Kx,{title:k,type:"default","aria-hidden":"true"})]}),s.jsxs(Ye,{onClick:N,className:jr("header__logo","header__logo--s"),href:"/",children:[s.jsx(ie,{children:k}),s.jsx(Kx,{title:k,type:"small","aria-hidden":"true"})]}),s.jsx(YGt,{className:jr("header__item","header__search")},Qe.parse(R.search).q?.toString()||R.pathname),i?s.jsxs(h.Fragment,{children:[T&&s.jsx("div",{className:jr("header__item","salt-d--none","lg:salt-d--block"),children:s.jsx(Z0t,{})}),s.jsx("div",{className:jr("header__item","salt-d--none","lg:salt-d--block"),children:s.jsx(h0t,{})})]}):s.jsxs(h.Fragment,{children:[s.jsx(_Gt,{}),s.jsx(e$t,{className:jr("header__item","salt-d--none","lg:salt-d--block")})]}),g&&s.jsx(cGt,{className:jr({header__item:!0,"salt-d--none":i,"sm:salt-d--block":i}),"data-test":"delivery-destination-header-button"}),(!g||i)&&s.jsx(T0t,{className:jr("header__item"),"data-test":"delivery-header-button"}),s.jsx(CMt,{className:jr("header__item")})]}),s.jsxs(Q,{className:jr("header__bottom","salt-gap--2","lg:salt-p--2"),children:[s.jsx("div",{className:jr("header__nav-button","salt-m-y--2","salt-m-l--2","lg:salt-m--0"),children:s.jsx(V0t,{menuCampaigns:A,hasLoyalty:o&&o.registered,onBrowseClick:P,isDeliveryDestinationSelectorEnabled:g,composableNavbarItemsAvailability:M,headerColorScheme:w})}),s.jsx(gGt,{composableNavbarItemsAvailability:M})]}),s.jsx(Wz,{})]}),s.jsx(X0t,{})]})},Pne=()=>s.jsx(O0t,{children:s.jsx(u$t,{})}),p$t={userInputIgnoreDuration:m.number.isRequired,timerStarted:m.bool.isRequired,callbacks:m.arrayOf(m.func.isRequired).isRequired,children:m.func.isRequired},Nne=({userInputIgnoreDuration:e,timerStarted:t,callbacks:n,children:o})=>{const[r,a]=h.useState(void 0);h.useEffect(()=>{t&&a(de())},[t]);const i=n.map(l=>(...c)=>{const d=de();if(r+e<d)return l.apply(l,c)});return o(i)};Nne.propTypes=p$t;const m$t={isOpen:m.bool.isRequired,availableLanguages:m.arrayOf(m.string).isRequired,defaultLocale:m.string.isRequired,userInputIgnoreDuration:m.number,actions:m.shape({closeModal:m.func.isRequired,analyticsEvent:m.func.isRequired,setLanguageRequiresConfirmation:m.func.isRequired}).isRequired},h$t={userInputIgnoreDuration:500},Jj=({availableLanguages:e,isOpen:t,defaultLocale:n,actions:o,userInputIgnoreDuration:r})=>{const a=d=>{o.setLanguageRequiresConfirmation(!1),o.analyticsEvent({type:_r.LOCALE_MODAL_DISPLAYED,userAction:"LOCALE SELECTED",localeSelected:d}),Of(d)},i=()=>{o.setLanguageRequiresConfirmation(!1),o.analyticsEvent({type:_r.LOCALE_MODAL_DISPLAYED,userAction:"CLOSE"}),o.closeModal()},l="language-preference-modal-header",c=[n,...e.filter(d=>d!==n)];return s.jsx(Nne,{timerStarted:t,userInputIgnoreDuration:r,callbacks:[i,a],children:([d,u])=>s.jsx(B,{isOpen:t,aria:{labelledby:l},onRequestClose:d,showCloseIcon:!1,testId:"language-preference-modal",children:s.jsxs(B.Body,{children:[s.jsx(ie,{asChild:!0,id:l,"data-test":l,children:s.jsx("h2",{children:s.jsx(Nt,{id:"language.confirmation.modal.accessibility.heading"})})}),s.jsx(Be,{children:c.map(p=>s.jsx(Be.Item,{children:s.jsx(x,{intent:"secondary",fill:!0,onClick:()=>u(p),lang:p,"data-test":`language-preference-button-${p}`,children:s.jsx(x.Text,{children:s.jsx(b,{id:`language.confirmation.action.${p}`})})})},p))})]})})})},g$t=e=>({availableLanguages:Wp(e),isOpen:$e("languagePreferenceModal")(e),defaultLocale:Ze(e,"default-locale")}),E$t=st({closeModal:J.closeModal,analyticsEvent:U.analyticsEvent,setLanguageRequiresConfirmation:gq.setLanguageRequiresConfirmation});Jj.propTypes=m$t;Jj.defaultProps=h$t;const f$t=we(g$t,E$t)(Jj),y$t={languageRequiresConfirmation:m.bool.isRequired,actions:m.shape({openLanguagePreferenceModal:m.func}).isRequired},Lne=({languageRequiresConfirmation:e,actions:t})=>(h.useEffect(()=>{e===!0&&t.openLanguagePreferenceModal()},[e]),s.jsx(f$t,{})),I$t=e=>({languageRequiresConfirmation:mPe(e)}),S$t=st({openLanguagePreferenceModal:()=>J.openModal("languagePreferenceModal")});Lne.propTypes=y$t;const kne=we(I$t,S$t)(Lne),jne=e=>{const t=yo();h.useEffect(()=>{t({type:Bo.ORDER_DISCOUNT_FORM_PROMOTION_IMPRESSION,promotionsFormImpression:[e]})},[])},C$t=()=>{const e=yo(),t=L(),n=f(Zt),r=f(tft).map(a=>{const i=ym(t,a.validityTime,n);return{orderDiscountFormSection:a.orderDiscountFormSection,orderDiscountFormSectionSequence:a.orderDiscountFormSectionSequence,promotionId:a.promotionId,promotionIdText:a.promotionIdText,promotionIdExpiryText:`${i.label??""} ${i.tag??""}`,promotionIdIsSelected:a.promotionIdIsSelected,promotionIdSequence:a.promotionIdSequence}});h.useEffect(()=>{e({type:Bo.ORDER_DISCOUNT_FORM_PROMOTION_IMPRESSION,promotionsFormImpression:r})},[e,r])},{CheckboxText:R$,CheckboxIconOff:v$t,CheckboxIconOn:T$t}=QC,_$t=({name:e,value:t,description:n,validityTime:o,disabled:r,alwaysChecked:a,ariaDescribedBy:i,analyticsDataForPromotions:l,dateFormat:c,intl:d,checked:u})=>{const p=po(),g=Od({control:p.control,name:e}),E=C=>(g||[]).includes(C)||a?s.jsx(T$t,{name:"checkbox_on"}):s.jsx(v$t,{name:"checkbox_off"}),y=C=>{r&&C.key===" "&&C.preventDefault()},I=C=>{r&&C.preventDefault()},S=ym(d,o,c);return jne({orderDiscountFormSection:l?.[t]?.orderDiscountFormSection,orderDiscountFormSectionSequence:l?.[t]?.orderDiscountFormSectionSequence,promotionId:t,promotionIdText:n,promotionIdExpiryText:`${S.label??""} ${S.tag??""}`,promotionIdIsSelected:(g||[]).includes(t),promotionIdSequence:l?.[t]?.promotionIdSequence}),s.jsxs(Mne,{"data-test":"checkbox-input",disabled:r,onClick:I,children:[s.jsx("input",{...p.register(e,{disabled:r}),"aria-describedby":i,"aria-disabled":r,defaultChecked:u,type:"checkbox",value:t,onKeyDown:y})," ",E(t),s.jsxs(wne,{children:[s.jsx(R$,{"data-test":"description",children:n}),!!S?.label&&s.jsx("span",{"data-test":"expires-label",children:s.jsx(R$,{children:S.label})})]}),!!S?.tag&&s.jsx(Fne,{intent:"secondary","data-test":"expires-today-tomorrow",text:S.tag,singleLine:!0})]})},Mne=v(Rn)`
    ${e=>e.disabled&&Pe`
            background: var(--intent-secondary-100);
            color: var(--intent-content-300);
        `}
    align-items: center;
    inline-size: 100%;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-4);
    margin: 0;
`,wne=v.div`
    display: flex;
    flex-direction: column;
`,Fne=v(ln)`
    margin-inline-start: auto;
`,b$t=Tt(Ht)(_$t),x$t=({data:e,intl:t,...n})=>{const o=t.formatMessage("toggleablepromotions.modal.inclusive.promotions.description");return s.jsxs(ae.Fragment,{children:[s.jsx(O,{asChild:!0,bold:!0,"data-test":"group-description",className:"salt-m-t--4 salt-m-b--2",children:s.jsx("h3",{children:o})}),s.jsx(ba,{fluid:!0,"data-test":"checkbox-group",children:e.map(r=>s.jsx(Bne,{"data-test":"list-item",disabled:!r.changeable,children:s.jsx(b$t,{value:r.promotionId,description:r.description,validityTime:r.validityTime,disabled:!r.changeable,alwaysChecked:r.selected&&!r.changeable,checked:r.selected,...n})},r.promotionId))})]})},Bne=v(ba.Row)`
    min-block-size: ${$(52)};
    padding: 0;
    align-items: stretch;
`,Zb=Tt(Ht)(x$t),{RadioIconOff:A$t,RadioIconOn:R$t,RadioText:D$}=Pa,D$t=({name:e,value:t,description:n,validityTime:o,disabled:r,ariaDescribedBy:a,analyticsDataForPromotions:i,dateFormat:l,intl:c})=>{const d=po(),u=Od({control:d.control,name:e}),p=E=>u===E?s.jsx(R$t,{name:"radio_on"}):s.jsx(A$t,{name:"radio_off"}),g=ym(c,o,l);return jne({orderDiscountFormSection:i?.[t]?.orderDiscountFormSection,orderDiscountFormSectionSequence:i?.[t]?.orderDiscountFormSectionSequence,promotionId:t,promotionIdText:n,promotionIdExpiryText:`${g.label??""} ${g.tag??""}`,promotionIdIsSelected:u===t,promotionIdSequence:i?.[t]?.promotionIdSequence}),s.jsxs(Mne,{disabled:r,children:[s.jsx(O$t,{...d.register(e),"aria-disabled":r,"aria-describedby":a,type:"radio","data-test":"radio-input",value:t,disabled:r})," ",p(t),s.jsxs(wne,{children:[s.jsx(D$,{"data-test":"description",children:n}),!!g?.label&&s.jsx("span",{"data-test":"expires-label",children:s.jsx(D$,{children:g.label})})]}),!!g?.tag&&s.jsx(Fne,{intent:"secondary","data-test":"expires-today-tomorrow",text:g.tag,singleLine:!0})]})},O$t=v.input`
    :focus + span {
        outline: ${$(5)} auto Highlight;
        outline: ${$(5)} auto -webkit-focus-ring-color;
    }
`,P$t=Tt(Ht)(D$t),N$t=({data:e,intl:t,...n})=>{const o=t.formatMessage("toggleablepromotions.modal.exclusive.promotions.description"),r=t.formatMessage("toggleablepromotions.modal.exclusive.promotions.none.option.text");return s.jsxs(ae.Fragment,{children:[s.jsx(O,{asChild:!0,bold:!0,"data-test":"group-description",className:"salt-m-t--4 salt-m-b--2",children:s.jsx("h3",{children:o})}),s.jsx(ba,{fluid:!0,"data-test":"radio-group",children:e.map(a=>s.jsx(Bne,{"data-test":"list-item",disabled:!a.changeable,children:s.jsx(P$t,{value:a.promotionId,description:a.promotionId===hc?r:a.description,validityTime:a.validityTime,disabled:!a.changeable,...n})},a.promotionId))})]})},Jb=Tt(Ht)(N$t),L$t=D("m.la.h"),k$t=D("tp.np"),j$t=({initialValuesForToggleablePromotionsModal:e,promotionSelections:t,modalLeftAlignEnabled:n,toggleablePromotionsNoneOptionEnabled:o,toggleablePromotionsFormData:r,dataToDisplayListOfPreAppliedPromotions:a,headerLabelId:i,intl:l,analyticsDataForPromotions:c,exclusiveNotChangeablePromotionsData:d,dateFormat:u,actions:{submitPromotionSelections:p},handleClose:g})=>{const E=Dn({defaultValues:e}),y=Ne(),I=async j=>{const G=Object.values(j).flat().filter(Boolean),W=t.map(X=>({...X,selected:G.includes(X.promotionId)})),H=A3(W,d),K=t.every(X=>{const q=W.find(ne=>ne.promotionId===X.promotionId);return X.selected===q?.selected});await p(o?W.concat(H):W),g({userAction:fd.SAVE,hasSelectionChange:!K,selectedPromotionId:W.filter(({selected:X})=>X).map(({promotionId:X})=>X)})},S=l.formatMessage("toggleablepromotions.modal.description"),C=l.formatMessage("toggleablepromotions.modal.alternative.description"),T=l.formatMessage("toggleablepromotions.modal.subtitle.general"),_=l.formatMessage("toggleablepromotions.modal.subtitle.description.general"),A=l.formatMessage("toggleablepromotions.modal.subtitle.delivery"),R=l.formatMessage("toggleablepromotions.modal.subtitle.loyalty"),P=l.formatMessage("toggleablepromotions.modal.subtitle.description.loyalty"),N=l.formatMessage("toggleablepromotions.modal.subtitle.preapplied"),k=l.formatMessage("toggleablepromotions.modal.button.cancel"),M=l.formatMessage("toggleablepromotions.modal.button.save.changes"),w=l.formatMessage("toggleablepromotions.modal.title");return s.jsxs(ae.Fragment,{children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h1",id:i,"data-test":i,children:w})}),s.jsxs(B.Body,{children:[s.jsx(On,{...E,children:s.jsxs("form",{onSubmit:E.handleSubmit(I),children:[s.jsx(Te,{intent:"info","data-test":"modal-description",showIcon:!1,text:y.pathname==="/"?C:S}),r.SAVING&&s.jsxs("div",{id:_n.SAVING,children:[s.jsx(O,{asChild:!0,size:"l",bold:!0,className:"salt-m-t--4 salt-m-b--1",children:s.jsx("h2",{children:T})}),s.jsx(O$,{children:_})]}),r.SAVING&&r.SAVING.map(j=>j.limitPerOrder?j.limitPerOrder===1?s.jsx(Jb,{ariaDescribedBy:_n.SAVING,"data-test":"radio-group",name:j.applicationGroupName,data:j.promotions,analyticsDataForPromotions:c,dateFormat:u},j.applicationGroupName):null:s.jsx(Zb,{ariaDescribedBy:_n.SAVING,"data-test":"checkbox-group",name:j.applicationGroupName,data:j.promotions,analyticsDataForPromotions:c,dateFormat:u},j.applicationGroupName)),r.DELIVERY&&s.jsx(O,{id:_n.DELIVERY,asChild:!0,size:"l",bold:!0,className:"salt-m-t--4 salt-m-b--1",children:s.jsx("h2",{children:A})}),r.DELIVERY&&r.DELIVERY.map(j=>j.limitPerOrder?j.limitPerOrder===1?s.jsx(Jb,{ariaDescribedBy:_n.DELIVERY,"data-test":"radio-group",name:j.applicationGroupName,data:j.promotions,analyticsDataForPromotions:c,dateFormat:u},j.applicationGroupName):null:s.jsx(Zb,{ariaDescribedBy:_n.DELIVERY,"data-test":"checkbox-group",name:j.applicationGroupName,data:j.promotions,analyticsDataForPromotions:c,dateFormat:u},j.applicationGroupName)),r.LOYALTY&&s.jsxs("div",{id:_n.LOYALTY,children:[s.jsx(O,{asChild:!0,size:"l",bold:!0,className:"salt-m-t--4 salt-m-b--1",children:s.jsx("h2",{children:R})}),s.jsx(O$,{children:P})]}),r.LOYALTY&&r.LOYALTY.map(j=>j.limitPerOrder?j.limitPerOrder===1?s.jsx(Jb,{ariaDescribedBy:_n.LOYALTY,"data-test":"radio-group",name:j.applicationGroupName,data:j.promotions,analyticsDataForPromotions:c,dateFormat:u},j.applicationGroupName):null:s.jsx(Zb,{ariaDescribedBy:_n.LOYALTY,"data-test":"checkbox-group",name:j.applicationGroupName,data:j.promotions,analyticsDataForPromotions:c,dateFormat:u},j.applicationGroupName))]})}),!!Object.keys(a).length&&s.jsxs(ae.Fragment,{children:[s.jsx(O,{id:VVe,asChild:!0,size:"l",bold:!0,className:"salt-m-t--4 salt-m-b--1",children:s.jsx("h2",{children:N})}),s.jsx(OJ,{dataToDisplayList:a})]})]}),s.jsxs(B.Footer,{children:[s.jsx(x,{className:"salt-m-r--2",intent:"secondary",fill:!0,"data-test":"cancel-discounts",onClick:()=>g({userAction:fd.CANCEL,hasSelectionChange:!1}),children:s.jsx(x.Text,{children:k})}),s.jsx(x,{fill:!0,intent:"primary","data-test":"save-discounts-changes",onClick:E.handleSubmit(I),children:s.jsx(x.Text,{children:M})})]})]})},O$=v.div`
    font-size: var(--salt-text-m-font-size);
`,M$t=e=>({modalLeftAlignEnabled:L$t(e),toggleablePromotionsNoneOptionEnabled:k$t(e),initialValuesForToggleablePromotionsModal:TJ(e),promotionSelections:xJ(e),exclusiveNotChangeablePromotionsData:AJ(e),analyticsDataForPromotions:eft(e),dateFormat:Zt(e)}),w$t=st({submitPromotionSelections:QWe}),F$t=Tt(Ht,we(M$t,w$t))(j$t),B$t=({isOpen:e,toggleablePromotionsFormData:t,dataToDisplayListOfPreAppliedPromotions:n,actions:{sendPromotionsAnalyticsPageEvent:o,close:r}})=>{if(!t)return null;const a="toggleable-promotions-v1-modal-header",i=({userAction:l,hasSelectionChange:c,selectedPromotionId:d})=>{o({type:Bo.ORDER_DISCOUNT_FORM_MODAL_CLOSED,description:"Modal for order promotions is closed",userAction:l,hasSelectionChange:c,selectedPromotionId:d}),r()};return s.jsx(B,{"data-test":"promotions-modal",isOpen:e,onRequestClose:()=>i({userAction:fd.RETURN,hasSelectionChange:!1}),aria:{labelledby:a},children:s.jsx(F$t,{toggleablePromotionsFormData:t,dataToDisplayListOfPreAppliedPromotions:n,headerLabelId:a,handleClose:i})})},U$t=e=>({isOpen:$e("discountOnOrder")(e),toggleablePromotionsFormData:_J(e),dataToDisplayListOfPreAppliedPromotions:fk(e)}),G$t=st({sendPromotionsAnalyticsPageEvent:cp,close:J.closeModal}),Une=Tt(we(U$t,G$t))(B$t),P$=new qd,$$t=!!(typeof window<"u"&&window.document?.createElement),Gne=()=>{const e=f(D("r.coo")),t=Z.getNotifications(),n=L(),o=()=>{const a=pC(MH(13,Ni()));P$.set(an.PRIVACY_ACCEPTED,"True",{expires:a,path:"/"})};if(e){const r="privacytoast",a=!!P$.get(an.PRIVACY_ACCEPTED),i=!!t.find(l=>l.id===r);$$t&&!a&&!i&&Z.info("site.privacy.notification.text",{link:s.jsx(da,{label:n.formatMessage("site.privacy.notification.link.text"),to:n.formatMessage("site.privacy.notification.link.url")}),id:r,onClose:o})}return null},$ne=()=>async(e,t)=>{const n=vn(t());return e(iI.getSlotDisplayModes(n))},H$t=(e=!1)=>({type:"API",payload:{url:"/v3/content/content-blocks",...rI},isSEOReadableURLEnabled:e}),Mp={getContentBlocks:H$t},Hne=3,BS=({isExternalLink:e,target:t,children:n,href:o,...r})=>e||P9e(t?.linkType)?s.jsx(tt,{href:o,target:t?.openInNewTab?"_blank":void 0,...r,children:n}):s.jsx(Ye,{to:o,target:t?.openInNewTab?"_blank":void 0,...r,children:n}),V$t=KL("IN_PAGE"),W$t=cf("IN_PAGE"),Y$t=D("seo.rdbl"),q$t={actions:m.shape({analyticsEvent:m.func.isRequired,fetchContentBlocks:m.func.isRequired}).isRequired,contentBlocksCommonData:m.shape({lastUpdated:m.number,fetchError:m.bool,isFetching:m.bool}).isRequired,contentBlocksInPage:m.shape({id:m.oneOfType([m.string,m.number]),type:m.oneOf(["HEADER","IN_PAGE"]),name:m.string.isRequired,backgroundType:m.string.isRequired,targetUrl:m.string,isExternalLink:m.bool,content:m.shape({images:m.string,solid:m.shape({backgroundSolidColor:m.string.isRequired,bodyText:m.string,callToActionColor:m.string,callToActionText:m.string,headline:m.string.isRequired,textColor:m.string.isRequired}).isRequired}).isRequired,target:m.shape({linkType:m.string.isRequired,value:m.string.isRequired,openInNewTab:m.bool}).isRequired}).isRequired,isContentBlockInPageEmpty:m.bool.isRequired,isSEOReadableURLEnabled:m.bool.isRequired,isBasketBeingEdited:m.bool.isRequired},K$t=v.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    inline-size: 100%;
    gap: ${$(5)};
    padding-block: ${$(6)};
    padding-inline: ${$(16)};
    min-block-size: ${$(52)};
    background-color: ${({backgroundColor:e})=>e};
    color: ${({color:e})=>e};

    ${re.lgUp`
        padding: ${$(10)} ${$(16)};
        min-height: ${$(40)};
    `}
`,z$t=v(Q)`
    flex: 1 1 auto;
    justify-content: flex-start;
    flex-direction: column;
    overflow: hidden;

    ${re.lgUp`
        flex-direction: row;
        flex-wrap: nowrap;
        gap: ${$(10)}
    `}
`,N$=v(O)`
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: block-axis;
    overflow: hidden;
    text-overflow: ellipsis;
    color: ${({color:e})=>e};
`,Q$t=v(O)`
    display: inline;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: ${({callToActionColor:e})=>e};

    &:hover {
        text-decoration: underline;
    }
`,X$t={},eM=({actions:e,contentBlocksCommonData:t,contentBlocksInPage:n,isContentBlockInPageEmpty:o,isBasketBeingEdited:r,isSEOReadableURLEnabled:a})=>{const i=L(),l=Ne(),{fetchContentBlocks:c,analyticsEvent:d}=e,{lastUpdated:u,isFetching:p}=t,[g,E]=h.useState(0),[y,I]=h.useState(ct()),C=[fn(),ao(),di(),Uo(":productId",a?":retailerProductName":void 0),Za(a),vg(":pageId"),NN(":pageId"),...a?[bo(),bo(":fullCataloguePath")]:[]].every(ue=>{const oe=ue===bo(":fullCataloguePath");return!zr({path:ue,end:!oe},l.pathname)}),T=o||C||r;if(h.useEffect(()=>{T||I(()=>{const ue=ct();return d({type:fa.CONTENT_BLOCK_IMPRESSION,contentBlockImpression:{entryId:_,contentBlockType:R,entryName:A,advertId:y}}),ue})},[l.key]),h.useEffect(()=>{g<Hne&&!u&&!p&&c(a).then(()=>{E(0)}).catch(()=>{E(g+1)})},[g,u,p]),T)return null;const{id:_,name:A,type:R,target:P,isExternalLink:N,targetUrl:k,content:{solid:{backgroundSolidColor:M,bodyText:w,callToActionColor:j,callToActionText:G,headline:W,textColor:H}}}=n,K=ue=>{const{target:oe}=ue.nativeEvent;if(oe){d({type:fa.CONTENT_BLOCK_CLICKED,entryId:_,contentBlockType:R,entryName:A,linkType:P.linkType,targetUrl:k,applyDescriptionByType:"IN_PAGE",advertId:y});const ye={event:"content_block_navigation",name:A,id:String(_),link_type:P.linkType,target:k};te.sendEvent({GA:ye,WA:null})}},X=()=>G?s.jsx(Q$t,{bold:!0,callToActionColor:j,"data-test":"content-block-in-page-cta",children:G}):null,q=i.formatMessage("contentBlocks.inPage.aside.aria.label");return W&&M&&H?s.jsx("aside",{"aria-label":q,children:s.jsxs(K$t,{as:BS,onClick:K,onKeyDown:()=>{},standalone:!0,backgroundColor:M,color:H,"data-test":"content-block-in-page",isExternalLink:N,target:P,href:k,children:[s.jsxs(z$t,{children:[s.jsx(N$,{asChild:!0,bold:!0,color:H,"data-test":"content-block-in-page-headline",children:s.jsx("h4",{children:W})}),w&&s.jsx(N$,{color:H,"data-test":"content-block-in-page-body",children:w})]}),X()]})}):null};eM.propTypes=q$t;eM.defaultProps=X$t;const Z$t=e=>({contentBlocksCommonData:qL(e),contentBlocksInPage:V$t(e),isContentBlockInPageEmpty:W$t(e),isBasketBeingEdited:Ar(e),isSEOReadableURLEnabled:Y$t(e)}),J$t=st({analyticsEvent:U.analyticsEvent,fetchContentBlocks:Mp.getContentBlocks}),e1t=we(Z$t,J$t)(eM),t1t=KL("IN_PAGE"),s1t=cf("IN_PAGE"),n1t=D("seo.rdbl"),L$=1*60*1e3,o1t=v.aside`
    display: ${({isInitiallyHidden:e})=>e?"none":"flex"};
    overflow: hidden;
    inline-size: 100%;
    transition:
        max-block-size 0.5s ease-in-out,
        padding 0.5s ease-in-out;

    &:hover {
        text-decoration: none;
    }

    ${({isComponentClosed:e})=>e?Pe`
                  max-block-size: 0;
              `:Pe`
                  max-block-size: 30vb;
              `}
`,r1t=v(Q)`
    flex-grow: 1;
    justify-content: space-between;
    flex-wrap: nowrap;
    align-items: center;
    inline-size: 100%;
    gap: ${$(5)};
    padding-block: ${$(6)};
    padding-inline: ${$(8)};
    min-block-size: ${$(52)};
    background-color: ${({backgroundColor:e})=>e};
    color: ${({color:e})=>e};

    ${re.lgUp`
        justify-content: center;
        padding: ${$(10)} ${$(8)};
        min-height: ${$(40)};
    `}
`,a1t=v(Q)`
    align-items: center;
    flex-wrap: nowrap;
    justify-content: space-between;
    margin: 0;
    inline-size: 100%;
    ${re.lgUp`
        margin: 0 auto;
        inline-size: auto;
    `}
`,i1t=v.div`
    display: inline;
`,k$=v(O)`
    display: inline;
    color: ${({color:e})=>e};
    font-size: var(--salt-text-m-font-size);
    padding-block: ${$(2)} 0;
    ${re.lgUp`
        padding-block: 0;
    `}
`,l1t=v(O)`
    display: inline;
    white-space: nowrap;
    color: ${({callToActionColor:e})=>e};
    text-decoration: underline;
    margin-inline: ${$(16)};
`,c1t=D("cf.cb.ip.cl"),d1t=D("cf.cb.ip.clk"),u1t=()=>{const e=f(c1t),t=f(d1t),n=L(),o=Ne(),[r,a]=h.useState(0),[i,l]=h.useState(ct()),c=F(),d=f(Ce=>qL(Ce)),u=f(Ce=>t1t(Ce));function p(Ce){return typeof Ce=="number"&&Ce>0}let g;typeof window<"u"&&(g=localStorage.getItem(String(u?.id)));const E=g?JSON.parse(g):null,[y,I]=h.useState(g?Number(E.whenToReopen)-de():0),[S,C]=h.useState(!0);h.useEffect(()=>{C(!!E)},[]);const T=()=>{localStorage.removeItem(String(u.id)),I(0),C(!1),l(()=>{const Ce=ct();return c(U.analyticsEvent({type:fa.CONTENT_BLOCK_IMPRESSION,contentBlockImpression:{entryId:j,contentBlockType:W,entryName:G,advertId:Ce}})),Ce})},_=f(Ce=>s1t(Ce)),A=f(Ce=>Ar(Ce)),R=f(Ce=>n1t(Ce)),P=async()=>c(Mp.getContentBlocks(R)),{lastUpdated:N,isFetching:k}=d,M=_||A;h.useEffect(()=>{M||l(()=>{const Ce=ct();return c(U.analyticsEvent({type:fa.CONTENT_BLOCK_IMPRESSION,contentBlockImpression:{entryId:j,contentBlockType:W,entryName:G,advertId:Ce}})),Ce})},[o.key]),h.useEffect(()=>{r<Hne&&!N&&!k&&P().then(()=>{a(0)}).catch(()=>{a(r+1)})},[r,N,k]);const w=h.useRef(null);if(h.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]),h.useEffect(()=>{E&&(E.publishedVersion!==u.publishedVersion&&T(),p(y)?w.current=setTimeout(()=>{T()},y):p(y)||T())},[u.publishedVersion]),M)return null;const{id:j,name:G,type:W,target:H,isExternalLink:K,targetUrl:X,publishedVersion:q,minutesToReappear:ne,content:{solid:{backgroundSolidColor:ue,bodyText:oe,callToActionColor:ye,callToActionText:he,headline:Ie,textColor:Fe}}}=u,be=Ce=>{Ce.preventDefault(),c(U.analyticsEvent({type:fa.CONTENT_BLOCK_CLOSE_BUTTON_CLICKED,entryId:j,entryName:G,advertId:i}));const We=L$*ne,et=de()+L$*ne;localStorage.setItem(String(j),JSON.stringify({publishedVersion:q,whenToReopen:et})),I(We),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{T()},We)},ce=Ce=>{const{target:We}=Ce.nativeEvent;if(We){c(U.analyticsEvent({type:fa.CONTENT_BLOCK_CLICKED,entryId:j,contentBlockType:W,entryName:G,linkType:H.linkType,targetUrl:X,applyDescriptionByType:"IN_PAGE",advertId:i}));const et={event:"content_block_navigation",name:G,id:String(j),link_type:H.linkType,target:X};te.sendEvent({GA:et,WA:null})}},me=()=>he?s.jsx(l1t,{as:BS,onClick:ce,standalone:!0,bold:!0,callToActionColor:ye,"data-test":"content-block-in-page-cta",isExternalLink:K,target:H,href:X,children:he}):null,De=n.formatMessage("contentBlocks.inPage.aside.aria.label"),ge=n.formatMessage("contentBlocks.inPage.aside.close.button"),Se=t&&!S?{as:BS,onClick:ce,isExternalLink:K,target:H,href:X,onKeyDown:()=>{},standalone:!0}:{};return Ie&&ue&&Fe?s.jsx(o1t,{"aria-label":De,isComponentClosed:p(y),isInitiallyHidden:S,...Se,children:s.jsxs(r1t,{backgroundColor:ue,color:Fe,"data-test":"content-block-in-page",children:[s.jsxs(a1t,{children:[s.jsxs(i1t,{children:[s.jsx(k$,{asChild:!0,bold:!0,color:Fe,"data-test":"content-block-in-page-headline",children:s.jsx("h4",{className:"salt-m-r--2",children:Ie})}),oe&&s.jsx(k$,{color:Fe,"data-test":"content-block-in-page-body",children:oe})]}),me()]}),e&&s.jsxs(x,{intent:"tertiary-contrast",size:"s",fill:!1,"data-test":"content-block-close-button",onClick:be,children:[s.jsx(ie,{children:ge}),s.jsx(x.Icon,{name:"close_default"})]})]})}):null},Vne=({isSegmentable:e})=>e?s.jsx(u1t,{}):s.jsx(e1t,{}),p1t=v(Ll)`
    position: absolute;
    inset-block-start: calc(var(--salt-spacing-2) * -1);
    inset-inline-end: calc(var(--salt-spacing-2) * -1);
`,m1t=v.div`
    position: fixed;
    inset-block-start: 72%;
    inset-inline-end: 0;
    z-index: ${$t["nav-button"]};
    transform: rotate(270deg);
    transform-origin: right bottom;
`,h1t=()=>{const{formatMessage:e}=L(),{loading:t,launchChat:n,unreadMessageCount:o}=Xj();return s.jsxs(m1t,{children:[s.jsx(x,{intent:"primary",fill:!1,loading:t,onClick:n,children:s.jsx(x.Text,{children:e("settings.chat.launcher")})}),o>0&&s.jsx(p1t,{"data-test":"ujet-message-count",intent:"promotion",count:o})]})},Wne=()=>{const e=Ne(),[t]=Ee(["ccai"]);return!f(aS).find(a=>!!e.pathname.match(a))&&t?s.jsx(h1t,{}):null},j$=e=>{const{list:t,descriptionText:n,type:o,ariaDescribedBy:r}=e,a=L(),i=f(Zt);return t.length?s.jsxs(gn,{direction:"column",gap:["sm"],"data-test":`${o}-group`,children:[s.jsx(O,{"data-test":"list-description",children:n}),s.jsx(xe,{children:s.jsx(gn,{direction:"column",gap:["lg"],children:t.map(({description:l,promotionId:c,validityTime:d})=>{const u=d?ym(a,d,i):{};return s.jsxs(gn,{direction:"column",gap:["xs"],"aria-describedby":r,"data-test":"list-item",children:[s.jsx(O,{children:l}),!!u?.label&&s.jsx(O,{size:"s","data-test":"list-expire-info",children:u.label})]},c)})})})]}):null},g1t=e=>{const{data:t,name:n,ariaDescribedBy:o}=e,r=L(),a=f(Zt);if(!t.length)return null;const i=r.formatMessage("toggleablepromotions.modal.inclusive.promotions.description"),l=t.map(d=>{const u=ym(r,d.validityTime,a);return{name:n,value:d.promotionId,label:d.description,additionalText:u.label}}),c=(d,u)=>{const{element:p}=d,g=Array.isArray(u.value)?u.value:[],E=String(p.value),y=p.checked?[...g,E]:g.filter(I=>I!==E);u.onChange(y)};return s.jsxs(Q,{direction:"column",gap:["sm"],"data-test":"checkbox-group",children:[s.jsx(O,{"data-test":"checkbox-group-description",children:i}),s.jsx(xe,{children:s.jsx(zd,{name:n,defaultValue:[],render:({field:d})=>{const u=l.map(p=>({...p,checked:d.value?.includes(p.value)||!1}));return s.jsx(fs.CheckboxList,{groupLabel:i,onChange:p=>c(p,d),options:u,"aria-describedby":o})}})})]})},E1t=e=>{const{data:t,name:n,ariaDescribedBy:o}=e,r=L(),a=f(Zt);if(!(u=>u.some(({promotionId:p})=>p!==hc))(t))return null;const l=r.formatMessage("toggleablepromotions.modal.exclusive.promotions.description"),c=r.formatMessage("toggleablepromotions.modal.exclusive.promotions.none.option.text"),d=t.map(u=>{const p=ym(r,u.validityTime,a);return{value:u.promotionId,label:u.promotionId===hc?c:u.description,additionalText:p.label}});return s.jsxs(Q,{direction:"column",gap:["sm"],"data-test":"radio-group",children:[s.jsx(O,{"data-test":"radio-group-description",children:l}),s.jsx(xe,{children:s.jsx(zd,{name:n,render:({field:u})=>s.jsx(fs.RadioGroup,{groupLabel:{text:l,isVisuallyConcealed:!0},name:n,value:u.value??"",onChange:p=>u.onChange(p),radios:d,"aria-describedby":o})})})]})},f1t=e=>{const{availablePromotions:t,ariaDescribedBy:n}=e;return s.jsx(ae.Fragment,{children:t.map(o=>o.promotions.length?o.limitPerOrder?o.limitPerOrder===1?s.jsx(E1t,{ariaDescribedBy:n,name:o.applicationGroupName,data:o.promotions},o.applicationGroupName):null:s.jsx(g1t,{ariaDescribedBy:n,name:o.applicationGroupName,data:o.promotions},o.applicationGroupName):null)})},y1t=e=>{const{availablePromotions:t,unavailablePromotions:n,preAppliedPromotions:o}=e;return!!(o.length||n.length||t.some(r=>r.promotions.length))},I1t=e=>{const{promotionFormData:t,title:n,id:o,description:r}=e,a=L();if(!t||!y1t(t))return null;const i=a.formatMessage("toggleablepromotions.modal.preselected.promotions.description"),l=a.formatMessage("toggleablepromotions.modal.unavailable.promotions.description"),{availablePromotions:c,unavailablePromotions:d,preAppliedPromotions:u}=t;return s.jsxs(ae.Fragment,{children:[s.jsxs(gn,{direction:"column",gap:["xs"],className:"salt-m-t--4 salt-m-b--4",children:[s.jsx(O,{size:"l",bold:!0,"data-test":"section-title",children:n}),r&&s.jsx(O,{"data-test":"section-description",children:r})]}),s.jsxs(gn,{direction:"column",gap:["md"],"data-test":`section-group-${o.toLowerCase()}`,children:[s.jsx(f1t,{availablePromotions:c,ariaDescribedBy:o}),s.jsx(j$,{type:"preselected",list:u,descriptionText:i,ariaDescribedBy:o}),s.jsx(j$,{type:"unavailable",list:d,descriptionText:l,ariaDescribedBy:o})]})]})},S1t=D("m.la.h"),C1t=D("tp.no"),v1t=({toggleablePromotionsFormData:e,headerLabelId:t,handleClose:n})=>{const o=L(),r=f(TJ),a=Dn({defaultValues:r}),i=Ne(),l=f(S1t),c=f(C1t),d=f(xJ),u=f(AJ),p=F();C$t();const g=async M=>{const w=Object.values(M).flat().filter(Boolean),j=d.map(X=>({...X,selected:w.includes(X.promotionId)})),G=A3(j,u),W=d.every(X=>{const q=j.find(ne=>ne.promotionId===X.promotionId);return X.selected===q?.selected}),H=c?j.concat(G):j;if(!H.length){n({userAction:fd.SAVE,hasSelectionChange:!1,selectedPromotionId:[]});return}const{isSuccessful:K}=await p(XWe(H));K&&(p(ZWe()),n({userAction:fd.SAVE,hasSelectionChange:!W,selectedPromotionId:j.filter(({selected:X})=>X).map(({promotionId:X})=>X)}))},E=o.formatMessage("toggleablepromotions.modal.description"),y=o.formatMessage("toggleablepromotions.modal.note"),I=o.formatMessage("toggleablepromotions.modal.alternative.description"),S=o.formatMessage("toggleablepromotions.modal.subtitle.general"),C=o.formatMessage("toggleablepromotions.modal.subtitle.delivery"),T=o.formatMessage("toggleablepromotions.modal.subtitle.loyalty"),_=o.formatMessage("toggleablepromotions.modal.button.cancel"),A=o.formatMessage("toggleablepromotions.modal.button.apply.changes"),R=o.formatMessage("toggleablepromotions.modal.title"),P=o.formatMessage("toggleablepromotions.modal.delivery.promotions.description"),N=o.formatMessage("toggleablepromotions.modal.loyalty.promotions.description"),k=[{key:"SAVING",title:S},{key:"DELIVERY",title:C,description:P},{key:"LOYALTY",title:T,description:N}];return s.jsxs(ae.Fragment,{children:[s.jsx(B.Header,{align:l?"left":"center",children:s.jsx(ee,{as:"h1",id:t,"data-test":t,children:R})}),s.jsx(B.Body,{className:"salt-p-y--4",children:s.jsx(On,{...a,children:s.jsxs("form",{onSubmit:a.handleSubmit(g),children:[s.jsxs(gn,{direction:"column",gap:["md"],children:[s.jsx(O,{"data-test":"promotion-form-description",children:i.pathname==="/"?I:E}),s.jsx(O,{"data-test":"promotion-form-note",className:"salt-m-b--2",children:y})]}),k.map(({key:M,title:w,description:j})=>s.jsx(I1t,{id:_n[M],title:w,promotionFormData:e[M],description:j},M))]})})}),s.jsxs(B.Footer,{children:[s.jsx(x,{className:"salt-m-r--2",intent:"secondary",fill:!0,"data-test":"cancel-discounts",onClick:()=>n({userAction:fd.CANCEL,hasSelectionChange:!1}),children:s.jsx(x.Text,{children:_})}),s.jsx(x,{fill:!0,intent:"primary","data-test":"save-discounts-changes",onClick:a.handleSubmit(g),children:s.jsx(x.Text,{children:A})})]})]})},T1t=e=>typeof e=="object"&&Object.values(e).some(t=>(t.availablePromotions?.some(n=>n.promotions?.length>0)??!1)||t.unavailablePromotions?.length>0||t.preAppliedPromotions?.length>0),_1t=()=>{const e=f($e("discountOnOrder")),t=f(bJ),n=F();if(!T1t(t))return null;const o="toggleable-promotions-v2-modal-header",r=({userAction:a,hasSelectionChange:i,selectedPromotionId:l})=>{n(cp({type:Bo.ORDER_DISCOUNT_FORM_MODAL_CLOSED,description:"Modal for order promotions is closed",userAction:a,hasSelectionChange:i,selectedPromotionId:l})),n(J.closeModal())};return s.jsx(B,{"data-test":"promotions-modal",isOpen:e,onRequestClose:()=>r({userAction:fd.RETURN,hasSelectionChange:!1}),aria:{labelledby:o},maxWidth:"md",children:s.jsx(v1t,{toggleablePromotionsFormData:t,headerLabelId:o,handleClose:r})})},Yne=ia(`
    query GetFooter {
        footer {
            contactUs {
                __typename
                shouldBeOpenedInNewTab
                ... on StaticPageTarget {
                    staticPage
                }
                ... on WebAddressTarget {
                    url
                }
            }
            columns {
                title
                links {
                    text
                    target {
                        __typename
                        shouldBeOpenedInNewTab
                        ... on StaticPageTarget {
                            staticPage
                        }
                        ... on WebAddressTarget {
                            url
                        }
                    }
                }
            }
            socialMedia {
                serviceId
                profileUrl
                tooltip
            }
            feedbackEmail
            legalText {
                firstItem {
                    id
                    name
                    richText
                }
                secondItem {
                    id
                    name
                    richText
                }
            }
        }
    }
`),b1t=(e=[])=>e.flatMap(t=>{if(!t)return[];const n=Aa.normalizeToLegacyTarget(t.target);return{text:t.text,...n}}),x1t=e=>e?e.flatMap(t=>t?{title:t.title,links:b1t(t.links)}:[]):[],A1t=e=>e?e.filter(t=>!!t):[],R1t=e=>e?{firstItem:e.firstItem,secondItem:e.secondItem}:null,D1t=({contactUs:e,columns:t,socialMedia:n,legalText:o})=>({contactLink:e?Aa.normalizeToLegacyTarget(e):{},sections:x1t(t),socialMedia:A1t(n),legalText:R1t(o)}),O1t=({links:e})=>({contactLink:e.contact,sections:e.sections,socialMedia:e.social,legalText:e.legalText}),P1t=()=>{const[e=!1]=Ee(["cf.ft.flx"]),[{data:t}]=Kd({query:Yne}),n=f(({data:r})=>r.content.footer);return{isFetching:!1,footer:e?D1t(t?.footer??{}):O1t(n??{})}},N1t=()=>"/cookie-policy",L1t=({contactLink:{value:e,linkType:t,openInNewTab:n}})=>{const o=L(),r=f(d=>vv(d)&&!!d.retailerSettings["cookies-onetrust-domain"]),a=LN(t,e),i=n?"_blank":void 0,l=n?s.jsx(ie,{children:`(${o.formatMessage("accessibility.link.open.in.new.window")})`}):null,c=t===kt.ABSOLUTE_WEB_ADDRESS||t===kt.WEB_ADDRESS?tt:Ye;return e&&t?s.jsxs(wn.Leading,{children:[t&&a&&s.jsx(x,{intent:"secondary",size:"s",fill:!1,asChild:!0,className:"salt-m-x--1",children:s.jsx(c,{intent:"ghost","data-test":"footer-contact-link",href:a,...i&&{target:i},children:s.jsxs(x.Text,{children:[o.formatMessage("footer.contact"),l&&l]})})}),r&&s.jsx(x,{intent:"secondary",size:"s",fill:!1,asChild:!0,className:"salt-m-x--1",children:s.jsx(Ye,{href:N1t(),role:"link",intent:"ghost",children:s.jsx(x.Text,{children:o.formatMessage("footer.cookie.policy")})})})]}):null},k1t={mhra:m.node,retailerName:m.string,socialMedia:m.arrayOf(m.shape({serviceId:m.string.isRequired,profileUrl:m.string.isRequired,tooltip:m.string.isRequired})).isRequired};function j1t(e,t){const n=e.serviceId.toLowerCase();return s.jsx("div",{className:"salt-m-l--2 salt-d--inline-block",children:s.jsxs(tt,{href:e.profileUrl,target:"_blank",children:[s.jsx(ie,{children:e.tooltip}),s.jsx(pe,{name:n,title:e.tooltip,height:20,width:20,"aria-hidden":"true"})]})},t)}const tM=({mhra:e,retailerName:t,socialMedia:n})=>{const r=L().formatMessage("footer.copyright",{name:t});return s.jsxs(wn.Supplementary,{"data-test":"footer-supplementary",children:[s.jsxs(wn.Row,{children:[r.trim()!==""&&s.jsxs(O,{className:"salt-m-r--4",children:[" ",r]}),s.jsx("div",{className:"salt-d--inline-block",children:n.map((a,i)=>j1t(a,i))})]}),e&&s.jsx(Lt,{breakpoint:"lg-up",children:s.jsx(wn.Row,{children:s.jsx(wn.Image,{right:!0,children:e})})})]})};tM.defaultProps={mhra:null,retailerName:void 0};tM.propTypes=k1t;const qne=()=>{const e=F(),t=h.useCallback(o=>{e({type:qI.FOOTER_LEGAL_TEXT_LINK_CLICKED,payload:o})},[e]),n=h.useCallback(()=>{e({type:qI.FOOTER_LEGAL_TEXT_IMPRESSION})},[e]);return{reportFooterLegalTextLinkClicked:t,reportFooterLegalTextImpression:n}},M1t=v.a`
    color: var(--intent-default);
`,w1t=({node:e,children:t})=>{const n=qne(),o=L(),r=()=>{n.reportFooterLegalTextLinkClicked({LINK_VALUE:e.data.uri})};return s.jsxs(M1t,{href:e.data.uri,target:"_blank",onClick:r,children:[t,s.jsx(ie,{children:`(${o.formatMessage("accessibility.link.open.in.new.window")})`})]})},F1t=()=>({renderNode:{[bn.BLOCKS.HEADING_1]:(e,t)=>s.jsx(ee,{as:"h2",children:t}),[bn.BLOCKS.HEADING_2]:(e,t)=>s.jsx(ee,{as:"h2",children:t}),[bn.BLOCKS.PARAGRAPH]:(e,t)=>s.jsx(O,{size:"s",className:"salt-d--block salt-m-y--1",children:t}),[bn.INLINES.HYPERLINK]:(e,t)=>s.jsx(w1t,{node:e,children:t})}}),Kne=({data:e})=>{const t=h.useMemo(()=>F1t(),[e]),n=h.useMemo(()=>Object.values(e).map(a=>({...a,richText:rC.documentToReactComponents(JSON.parse(a.richText),t)})),[e]),o=qne(),r=Uc(()=>{o.reportFooterLegalTextImpression()});return s.jsx("div",{ref:r,children:s.jsx(V,{"data-test":"legal-text",flush:!0,children:n.map((a,i)=>{const l=i*6+1;return s.jsx(V.Item,{colStart:{md:l},colSpan:{xs:12,sm:6},children:a.richText},a.id)})})})},B1t=D("cf.ft.flx"),zne=e=>{const{linkType:t,value:n}=e,o={openInNewTab:e.openInNewTab,text:e.text,url:LN(t,n),type:t},r=o.openInNewTab?"_blank":void 0;return[kt.ABSOLUTE_WEB_ADDRESS,kt.WEB_ADDRESS].includes(o.type)?s.jsx(tt,{...r?{target:"_blank"}:{},href:o.url,children:o.text}):s.jsx(Ye,{...r?{target:"_blank"}:{},to:o.url,children:o.text})},U1t=e=>e.map(t=>{const n=t.links.map(o=>s.jsx(Be.Item,{"data-test":"footer-page-link",children:zne(o)},o.text));return s.jsxs(wn.List,{className:"salt-p-r--2",children:[s.jsx("div",{className:"salt-m-b--2",children:s.jsx(O,{bold:!0,asChild:!0,"data-test":"footer-links-column",children:s.jsx("h2",{children:t.title})})}),s.jsx(Be,{children:n})]},t.title)}),G1t=(e,t)=>{const n=t.formatMessage("mhra.alternative");return e.companyId&&s.jsxs(tt,{href:`${e.baseUrl}${e.companyId}`,children:[s.jsx(ie,{children:s.jsx(O,{children:n})}),s.jsx(pe,{name:"mhra",title:n,height:93,width:112,"aria-hidden":"true"})]})},$1t=(e,t)=>{const n=s.jsx(rs.Title,{active:!0,children:t.formatMessage("footer.legal.accordion.section")}),o=s.jsx(rs.Content,{active:!0,children:s.jsx(Kne,{data:e})});return[n,o]},H1t=({sections:e,legalText:t,intl:n})=>{const o=a=>s.jsx(Be,{children:a.map(i=>s.jsx(Be.Item,{children:zne(i)},i.text))}),r=e.map(a=>{const i=s.jsx(rs.Title,{active:!1,children:a.title},a.title),l=s.jsx(rs.Content,{active:!1,children:o(a.links)});return[i,l]});return t&&r.push($1t(t,n)),s.jsx(rs,{children:r})},V1t=()=>{const e=L(),{footer:t}=P1t(),{sections:n,contactLink:o,socialMedia:r,legalText:a}=t,i=F(),l=f(g=>({baseUrl:Ze(g,"mhra-base-url"),companyId:Ze(g,"mhra-company-id")})),{lastUpdated:c}=f(b9e),d=f(B1t),u=f(kme),p=G1t(l,e);return h.useEffect(()=>{!c&&!d&&i(k8())},[]),s.jsxs(wn,{id:"footer",children:[s.jsx(L1t,{contactLink:o}),s.jsxs(wn.Body,{children:[s.jsx(wn.Visible,{breakpoint:"sm-up",children:s.jsxs("div",{className:"salt-d--flex",children:[U1t(n),l.companyId&&s.jsx(wn.Image,{children:s.jsx(wn.Visible,{breakpoint:"lg-up",children:p})})]})}),a&&s.jsx(wn.Visible,{breakpoint:"sm-up",className:"salt-m-t--4",children:s.jsx(Kne,{data:a})}),s.jsx(Lt,{breakpoint:"sm-up",children:H1t({sections:n,legalText:a,intl:e})})]}),s.jsx(tM,{mhra:p,socialMedia:r,retailerName:u.name})]})},US=42,W1t=v.div`
    display: flex;
    place-content: center center;
    inline-size: 100%;
    background-color: var(--top-tabs-background-color, var(--intent-secondary-100));
`,Y1t=v.div`
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    overflow: hidden;
    flex: 1;
    padding: 0;
    margin: 0;
    block-size: ${$(US)};
`,q1t=v.nav`
    position: relative;
    display: block;
    block-size: ${$(US)};
    z-index: ${$t["top-tabs"]};

    &::before {
        content: ' ';
        block-size: ${$(1)};
        background: var(--top-tabs-border-color, var(--intent-secondary));
        position: absolute;
        inset-block-end: 0;
        inset-inline-start: 0;
        inline-size: 100%;
    }
`,K1t=Pe`
    display: inline-flex;
    align-items: center;
    position: relative;
    white-space: nowrap;
    text-decoration: none;
    flex-wrap: nowrap;
    min-block-size: ${$(US)};
    max-block-size: ${$(US)};
    padding-block: var(--salt-spacing-1);
    padding-inline: var(--salt-spacing-4);
    color: var(--intent-content);
    inline-size: 100%;
    outline-offset: -${$(5)};

    &::before {
        content: ' ';
        block-size: var(--salt-spacing-05);
        background: ${({active:e})=>e&&"var(--intent-primary-900)"};
        position: absolute;
        inset-block-end: 0;
        inset-inline-start: 0;
        inline-size: 100%;
    }

    &:hover {
        cursor: pointer;
    }

    &:hover::before {
        background: ${({active:e})=>!e&&"var(--intent-primary-300)"};
    }

    &:active::before {
        background: var(--intent-primary-900);
    }
`,Qne=v(O)`
    overflow: hidden;
    text-overflow: ellipsis;
    word-break: break-all;
    white-space: nowrap;
    text-align: ${({textAlign:e})=>e??"center"};

    &::after {
        display: block;
        content: '${({children:e})=>wce(e)}';
        font-weight: bold;
        block-size: 0;
        overflow: hidden;
        visibility: hidden;
    }
`,Xne=v.img`
    margin-inline-end: ${({labelHidden:e})=>e?0:"var(--salt-spacing-1)"};
    block-size: ${$(18)};
    inline-size: ${$(18)};
`,Zne=h.forwardRef(({to:e,href:t,children:n,intent:o,...r},a)=>{const{bold:i,...l}=r;return e?s.jsx(Ye,{ref:a,to:e,...o==="ghost"?l:r,children:n}):s.jsx(tt,{ref:a,href:t,...o==="ghost"?l:r,children:n})}),z1t=v.div`
    overflow: hidden;
`,Q1t=v(Zne).withConfig({shouldForwardProp:e=>!["active","fullWidth"].includes(e)})`
    ${K1t};
`,X1t=h.forwardRef((e,t)=>{const{active:n,iconUrl:o,label:r,labelHidden:a=!1,title:i,link:l}=e;return s.jsx(z1t,{ref:t,children:s.jsxs(Q1t,{active:n,"aria-current":n?"page":void 0,...l,children:[o&&s.jsx(Xne,{src:o,alt:a?r:"",labelHidden:a}),i&&s.jsx(Qne,{bold:n,children:i})]})})}),xd={Header:W1t,ImageIcon:Xne,Link:Zne,LinkTab:X1t,List:Y1t,Navigation:q1t,TabText:Qne},Z1t=v(xd.Link)`
    outline-offset: -${$(9)};
    display: flex;
`,Jne=({dispatchAnalyticsEvent:e,iconUrl:t,id:n,isExternalLink:o,isInDropdown:r,isMatchingCurrentURL:a,label:i,labelHidden:l,openInNewTab:c,tabRef:d,tabOffScreen:u,targetURL:p,closeDropdown:g})=>{const E=F(),y=t&&s.jsx(xd.ImageIcon,{src:t,alt:l?i:"",labelHidden:l}),I=C=>{if(e({isInDropdown:r}),r&&g(),o){const T=new URL(p);T.searchParams.get("confirmRedirect")&&(C.preventDefault(),T.searchParams.delete("confirmRedirect"),E(J.openModal("changeStore",{redirectUrl:T.href})))}};let S={href:p,onClick:I,target:c?"_blank":void 0};if(!o){const C=Js(p),T=Qe.parse(C.search??"");S={onClick:I,target:c?"_blank":void 0,to:{...C,search:`?${Qe.stringify({...T,source:"toptabs"})}`}}}if(r){const C=s.jsxs(h.Fragment,{children:[y,l?void 0:s.jsx(xd.TabText,{bold:a,textAlign:"start",children:i})]});return s.jsx(no.Item,{selected:a,role:"none presentation",children:s.jsx(Z1t,{...S,children:C})},n)}return s.jsx(xd.LinkTab,{active:a,ref:d,title:l?void 0:i,label:i,iconUrl:t??void 0,link:{...S,tabIndex:u?-1:void 0}},n)},J1t=v(rt.Container)`
    position: static;
    display: flex;
    align-items: center;
    visibility: ${({transparent:e})=>e?"hidden":"initial"};

    ${re.smUp`
        position: relative;
    `};
`,eHt=v(rt.Body)`
    z-index: ${$t["top-tabs"]};
    inset-block-start: ${$(KI)};
    inset-inline: var(--salt-spacing-2);
    inline-size: auto;
    min-inline-size: auto;

    ${re.smUp`
        inset-inline-start: initial;
    `};
`,tHt=v(rt.Content)`
    padding: 0;
    overflow: hidden auto;

    &::-webkit-scrollbar {
        appearance: none;
    }

    &::-webkit-scrollbar-thumb {
        border-radius: ${$(100)};
        border: ${$(2)} solid var(--intent-contrast);
        background-color: var(--intent-secondary-900);
    }

    ${re.smUp`
        max-inline-size: ${$(400)};
        min-inline-size: ${$(100)};
    `};
`;class sHt extends h.Component{dropdownEl;dropdownContainer;formattedMessages;constructor(t){super(t),this.state={isOpen:!1,previouslyOpened:!1},this.formattedMessages={dropdownButton:t.intl.formatMessage("top.tabs.dropdown.button.label")??""},this.toggle=this.toggle.bind(this),this.close=this.close.bind(this),this.reset=this.reset.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.dropdownEl=ae.createRef(),this.dropdownContainer=ae.createRef()}shouldComponentUpdate(t,n){const o=this.props.tabs.length!==t.tabs.length,r=n.isOpen!==this.state.isOpen;return o||r}componentDidUpdate(){this.props.tabs.length===0&&this.close()}componentWillUnmount(){window.removeEventListener("mousedown",this.handleClickOutside),window.removeEventListener("keydown",this.handleKeyPress)}toggle(){this.setState(t=>{const n=!t.isOpen;return n?(window.addEventListener("mousedown",this.handleClickOutside),window.addEventListener("keydown",this.handleKeyPress),this.props.dispatchDropdownOpenAnalytics(),t.previouslyOpened===!1&&this.props.dispatchTabImpressions({isInDropdown:!0})):(window.removeEventListener("mousedown",this.handleClickOutside),window.removeEventListener("keydown",this.handleKeyPress)),{isOpen:n,previouslyOpened:!0}})}close(){window.removeEventListener("mousedown",this.handleClickOutside),window.removeEventListener("keydown",this.handleKeyPress),this.setState(()=>({isOpen:!1}))}reset(){window.removeEventListener("mousedown",this.handleClickOutside),window.removeEventListener("keydown",this.handleKeyPress),this.setState(()=>({isOpen:!1,previouslyOpened:!1}))}handleClickOutside(t){const n=this.dropdownEl&&this.dropdownEl.current&&t.target instanceof HTMLElement&&!this.dropdownEl.current.contains(t.target),o=this.dropdownContainer&&this.dropdownContainer.current&&t.target instanceof HTMLElement&&!this.dropdownContainer.current.contains(t.target);n&&o&&this.close()}handleKeyPress(t){t.key==="Escape"&&this.close()}render(){const{tabs:t}=this.props,{isOpen:n}=this.state,o=t.length===0;let r={},a={},i={};return o||(r={"aria-haspopup":"true","aria-controls":"top-tabs-menu","aria-expanded":n,"aria-label":this.formattedMessages.dropdownButton},a={onClick:this.toggle},i={"aria-labelledby":"top-tabs-dropdown-button"}),s.jsxs(J1t,{transparent:o,ref:this.dropdownContainer,"data-test":"top-tabs-dropdown-container",children:[s.jsx(rt.TriggerSaltButton,{size:"s",intent:"secondary",className:"salt-m-r--2",id:"top-tabs-dropdown-button","data-test":"top-tabs-dropdown-button",isOpen:n,disabled:o,...a,...r}),s.jsx(eHt,{align:"right",isOpen:n,ref:this.dropdownEl,fill:!0,children:s.jsx(tHt,{children:s.jsx(no,{id:"top-tabs-menu",...i,children:t.map(l=>s.jsx(Jne,{...l,closeDropdown:this.close,isInDropdown:!0},l.id))})})})]})}}const nHt=Ht(sHt,{forwardRef:!0}),oHt=()=>({isFetching:!1,...f(({data:t})=>t.content.topTabs)}),rHt=()=>{const e=F(),t=h.useCallback(r=>{e({type:xi.TOP_TAB_IMPRESSION,payload:r})},[e]),n=h.useCallback(()=>{e({type:xi.TOP_TAB_DROPDOWN_OPENED,payload:{description:"The dropdown in the top tabs bar was opened"}})},[e]),o=h.useCallback(r=>{e({type:xi.TOP_TAB_CLICKED,payload:r})},[e]);return{reportTopTabImpression:t,reportDropdownOpen:n,reportTopTabClicked:o}},aHt=()=>{const[e,t]=h.useState(),n=h.useRef(e);return[n,r=>{n.current=r,t(r)}]},iHt=D("seo.rdbl"),lHt=()=>{const[e,t]=aHt(),n=F(),o=oHt(),r=h.useRef(),a=h.useRef(null),i=[],l=rHt(),c=Ne(),d=f(iHt),u=L();let p=null,g=null;h.useEffect(()=>(!o.isFetching&&!o.lastUpdated&&n(M8()),S(),()=>{I()}),[]),h.useEffect(()=>{E()?.reset(),I(),S()},[c.pathname]);const E=()=>r.current||null,y=()=>!!E(),I=()=>{p&&p.disconnect(),g&&g.disconnect()},S=()=>{if(!a.current)return;const M={root:a.current,rootMargin:"1px",threshold:1};p=new IntersectionObserver(_,M),g=new IntersectionObserver(A,{rootMargin:"1px",threshold:0}),g.observe(a.current),i.forEach(w=>w.current&&p?.observe(w.current))},C=({isInDropdown:M})=>{const w=Qx.tabsAnalyticsTransformer({isInDropdown:M,numberOfVisibleTabs:e.current,tabs:o.data}),j={ecommType:"enhanced",event:"event",eventAction:"TOP_TAB_IMPRESSION",eventCategory:"E-commerce",ecommerce:{promoView:{promotions:w.map(G=>({promotionType:"Top Tab",id:G.id,name:G.label,creative:null,position:G.positionSeen,topTabIsInDropdown:G.isInDropdown}))}}};return te.sendEvent({GA:j,WA:null}),l.reportTopTabImpression({links:w})},T=()=>{const M={event:"event",eventAction:"TopTabDropdownOpened",eventCategory:"Top Tabs",eventLabel:"Not Set"};te.sendEvent({GA:M,WA:null}),l.reportDropdownOpen()},_=M=>{const w=e.current===void 0,j=e.current||0,G=M.reduce((W,H)=>H.intersectionRatio===1?W+1:w?W:W-1,j);t(G),w&&C({isInDropdown:!1})},A=M=>{const w=M.length>0&&M[0]&&M[0].boundingClientRect.bottom<0;y()&&w&&E()?.close()},R=()=>{const M=o.data,{pathname:w,search:j}=c,G=w+j,W=M.map(q=>{if(q.default)return G===fn();if(!q.isExternalLink){const ne=Qx.extractUniqueIdentifierFromURL(G,q.target.linkType,d);return ne?q.encodedTargetValue.replace("?type=componentized","")===ne.toLowerCase():!1}return typeof window<"u"?q.encodedTargetValue===window.location.href.toLowerCase():!1}),H=!W.some(q=>q),K=M.map((q,ne)=>{const{isExternalLink:ue,targetURL:oe,label:ye,target:{openInNewTab:he},id:Ie,iconUrl:Fe,labelHidden:be}=q,ce=ae.createRef(),me=ne+1,De=({isInDropdown:Se})=>{const Ae={event:"select_tab",name:ye,id:Ie,index:me,location:Se?"in-drop-down":"not-in-drop-down",target:oe};te.sendEvent({GA:Ae,WA:null});const Ce={ecommType:"enhanced",event:"event",eventAction:"TOP_TAB_CLICKED",eventCategory:"E-commerce",ecommerce:{promoClick:{promotions:[{creative:null,id:Ie,name:ye,position:me,promotionType:"Top Tab",topTabIsInDropdown:Se}]}}};return te.sendEvent({GA:Ce,WA:null}),l.reportTopTabClicked({id:Ie,label:ye,tabPosition:me,isInDropdown:Se,targetURL:oe})},ge={isExternalLink:ue,targetURL:oe,id:Ie,isMatchingCurrentURL:W[ne]||H&&q.default,openInNewTab:he,label:ye,labelHidden:be,iconUrl:Fe,tabRef:ce,dispatchAnalyticsEvent:De,tabOffScreen:!!e.current&&me>e.current,closeDropdown:()=>{}};return i[ne]=ce,ge});return{visibleTabsComponents:K.map(q=>s.jsx(Jne,{...q},q.id)),dropdownTabsComponents:e?K.slice(e.current):[]}},P=o.data.length,{visibleTabsComponents:N,dropdownTabsComponents:k}=R();return P>0?s.jsx(xd.Navigation,{id:"top-tabs","data-test":"top-tabs","aria-label":u.formatMessage("accessibility.top-tabs.label"),children:s.jsxs(xd.Header,{children:[s.jsx(xd.List,{ref:a,children:N}),s.jsx(nHt,{ref:r,tabs:k,dispatchTabImpressions:C,dispatchDropdownOpenAnalytics:T})]})}):null},cHt=D("m.la.h"),M$="login-promt-modal-header",dHt=()=>{const e=Ne(),t=F(),n=f($e("loginPrompt")),o=f(cHt),r=f(nue);h.useEffect(()=>{n&&t(U.analyticsEvent({type:on.LOGIN_REGISTER_MODAL_DISPLAYED}))},[n]);const a=()=>{t(U.analyticsEvent({type:on.LOGIN_REGISTER_MODAL_CLICKED,buttonClickedText:"CLOSE",buttonLocation:1}))},i=()=>{t(U.analyticsEvent({type:on.LOGIN_REGISTER_MODAL_CLICKED,buttonClickedText:"X"}))},l=()=>{t(U.analyticsEvent({type:on.LOGIN_REGISTER_MODAL_CLICKED,buttonClickedText:"LOG IN / REGISTER",buttonLocation:2}))},c=()=>{a(),t(J.closeModal())},d=()=>{i(),t(J.closeModal())},u=`${e.pathname}${e.search}`,p=`destination=${encodeURIComponent(u)}`,g=Yo({queryString:p}),E=r?xv():g;return s.jsxs(B,{isOpen:n,onRequestClose:d,aria:{labelledby:M$},children:[s.jsx(B.Header,{align:o?"left":"center",children:s.jsx(ee,{as:"h2",id:M$,children:s.jsx(b,{id:"basket.add.availability.reminder.modal.title"})})}),s.jsx(B.Body,{children:s.jsxs(O,{children:[s.jsx(b,{id:"basket.add.availability.reminder"})," ",s.jsx(b,{id:"basket.add.availability.reminder.login.or.register"})]})}),s.jsx(B.Footer,{align:o?"left":"center",children:s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{intent:"secondary",fill:!0,"data-test":"login-prompt-modal-cancel-button",onClick:c,children:s.jsx(b,{id:"basket.add.availability.reminder.modal.cancel"})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{intent:"primary",fill:!0,asChild:!0,role:"link",className:"salt-m-t--4 md:salt-m--0","data-test":"login-prompt-modal-login-register-button",onClick:l,children:s.jsx(tt,{intent:"ghost",href:E,children:s.jsx(x.Text,{children:s.jsx(b,{id:"basket.add.availability.reminder.modal.button"})})})})})]})})]})},uHt=()=>{const e=F(),t=f(vft),n=yo(),o=f(jJ),r=f(mo);return h.useCallback(async()=>{let a=null;try{a=(await e(ai({products:o?.map(({productId:u})=>({id:u}))||[],ignoreProductCache:!0})))?.payload?.product??null}catch{a=null}const i={...r,...a},l=o?.map(d=>({...i?.[d.productId],...d}));n({type:Re.MERGE_BASKET_CONFLICT,product:l});const c=aYe(l);te.sendEvent({GA:c,WA:null}),t&&l?.length&&n({type:Re.UNAVAILABLE_PRODUCTS,unavailableProducts:l?.map(d=>({PRODUCT_ID:d.productId,RETAILER_PRODUCT_ID:d?.retailerProductId,UNAVAILABLE_REASON:d.reason,QUANTITY_UNAVAILABLE:d.requestedAmount-d.addedAmount,PAGE_EVENT_ID:t}))})},[n,e,o,r,t])},pHt=()=>{const e=F(),t=yo(),n=Fl();return h.useCallback(()=>{t({type:Re.UNAVAILABLE_ITEMS_MODAL_DISPLAYED,description:kJ,pageEventAttributes:{userAction:"Close"}}),n(),e(yr.clearMergeResult())},[t,n,e])},mHt=()=>{const e=Ge(),t=F(),n=yo(),o=f(Cft),r=Fl();return h.useCallback(()=>{n({type:Re.UNAVAILABLE_ITEMS_MODAL_DISPLAYED,description:kJ,pageEventAttributes:{userAction:"Continue"}}),o&&e(o),r(),t(yr.clearMergeResult())},[n,r,t,e,o])},hHt=()=>{const{formatMessage:e}=L(),t=Pm(gf),n=Om(),o=uHt(),r=pHt(),a=mHt();return s.jsxs(B,{isOpen:t,onAfterOpen:o,onRequestClose:r,aria:{labelledby:VG},children:[s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:VG,children:e("basket.merge.conflict.modal.heading")})}),s.jsxs(B.Body,{children:[s.jsx(Te,{className:"salt-m-b--4",intent:"error",text:e("basket.merge.conflict.modal.alert"),showIcon:!1}),s.jsx(MJ,{})]}),s.jsx(B.Footer,{align:n?"left":"center",children:s.jsx(x,{intent:"primary",onClick:a,fill:!0,children:s.jsx(x.Text,{children:e("basket.merge.conflict.modal.ok")})})})]})},f_=()=>e=>e(Hqe()).catch(()=>{}),eoe=e=>(t,n)=>{const{chatId:o}=n().data.recipes.chat.data;return o?t(Yqe(o,Ri(e))).catch(()=>{}):null},gHt=()=>(e,t)=>{const{chatId:n}=t().data.recipes.chat.data;return n?e(qqe(n)).catch(()=>{}):null},EHt=v.div`
    padding: var(--salt-spacing-4);
    background: var(--intent-secondary-100);
`,fHt=({minimiseChat:e})=>{const t=ws(),n=ft(),{formatMessage:o}=L(),r=()=>{t(XP(!0)),n({type:YD,BUTTON_PLACEMENT:"TOP_BAR"})};return s.jsx(EHt,{children:s.jsxs(gn,{justify:"space-between",children:[s.jsxs(gn,{align:"center",children:[s.jsx("div",{className:"salt-m-r--2","aria-hidden":"true",children:s.jsx(pe,{name:"recipes"})}),s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("h2",{children:o("recipes.chat.recipeAssistant")})})]}),s.jsxs(gn,{align:"center",wrap:"nowrap",children:[s.jsxs(x,{intent:"secondary",type:"button",onClick:r,className:"salt-m-r--2",children:[s.jsx(x.Icon,{name:"refresh"}),s.jsx(ie,{children:o("recipes.chat.header.refresh")})]}),s.jsxs(x,{intent:"secondary",onClick:e,className:"salt-m-r--2",children:[s.jsx(x.Icon,{name:"minus"}),s.jsx(ie,{children:o("recipes.chat.header.minimise")})]})]})]})})},yHt=v.div`
    display: flex;
    flex-direction: ${({$messageRole:e})=>e===oo.ASSISTANT?"row":"row-reverse"};
    align-items: center;
    gap: var(--salt-spacing-1);
`,IHt=v.div`
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: pre-wrap;
    padding: var(--salt-spacing-2);
    background: ${({$messageRole:e})=>e===oo.ASSISTANT?"var(--intent-primary-100)":"var(--intent-secondary-900)"};
    ${({$loading:e})=>e?`
                width: 67px;
                height: 30px;
            `:""}
    ${({$align:e})=>e==="left"?Pe`
                  border-radius: 16px;
                  border-end-start-radius: 0;
                  margin-inline-end: var(--salt-spacing-4);
              `:Pe`
                  border-radius: 16px;
                  border-end-end-radius: 0;
                  text-align: end;
                  margin-inline-start: var(--salt-spacing-4);
              `};
`,SHt=v.div`
    display: flex;
    align-items: center;
    gap: var(--salt-spacing-1);
`,ex=v.div`
    animation: 2s loading 0s infinite step-end;
    background: var(--intent-content-200);
    border-radius: 50%;
    inline-size: 6px;
    block-size: 6px;

    @keyframes loading {
        0% {
            background: var(--intent-contrast);
            inline-size: 8px;
            block-size: 8px;
        }

        33% {
            background: var(--intent-content-200);
            inline-size: 6px;
            block-size: 6px;
        }

        100% {
            background: var(--intent-content-200);
            inline-size: 6px;
            block-size: 6px;
        }
    }
`,CHt=()=>{const{formatMessage:e}=L();return s.jsxs(SHt,{role:"status","aria-label":e("recipes.chat.speechBubble.loadingIndicator"),children:[s.jsx(ex,{}),s.jsx(ex,{style:{animationDelay:"0.66s"}}),s.jsx(ex,{style:{animationDelay:"1.32s"}})]})},cl=({messageRole:e=oo.ASSISTANT,align:t=e===oo.ASSISTANT?"left":"right",children:n,loading:o,error:r})=>s.jsxs(yHt,{"data-test":"recipe-chat-message",$messageRole:e,"aria-busy":o,children:[r&&s.jsx(pe,{name:"info_default",warning:!0}),s.jsx(IHt,{$align:t,$messageRole:e,$loading:o,children:o?s.jsx(CHt,{}):n})]}),zu=v.div.attrs({className:"salt-m-t--1"})`
    display: flex;
    align-items: center;
    justify-content: ${({$alignToRight:e})=>e?"end":"start"};
    gap: var(--salt-spacing-2);
`,nd=({children:e,onClick:t})=>s.jsx(x,{intent:"secondary",size:"s",onClick:t,children:e}),tx=({errorType:e,children:t})=>{const n=ws(),o=Me(Zv),r=ft();h.useEffect(()=>{r({type:ZW,CHAT_ID:o})},[]);const a=c=>{n(eoe(c)),r({type:JW})},i=()=>{n(XP(!0)),r({type:YD,BUTTON_PLACEMENT:"IN_CHAT"})},{formatMessage:l}=L();switch(e){case"GET_CHAT_HISTORY_ERROR":return s.jsxs("div",{children:[s.jsx(cl,{messageRole:oo.ASSISTANT,error:!0,children:l("recipes.chat.error.historyLoadError")}),s.jsx(zu,{children:s.jsx(nd,{onClick:()=>n(i),children:l("recipes.chat.error.restartButton")})})]});case"SEND_MESSAGE_ERROR_FATAL":return s.jsxs("div",{children:[s.jsx(cl,{messageRole:oo.ASSISTANT,error:!0,children:l("recipes.chat.error.failedToRespond")}),s.jsx(zu,{children:s.jsx(nd,{onClick:()=>n(i),children:l("recipes.chat.error.restartButton")})})]});case"CREATE_CHAT_ERROR":return s.jsxs("div",{children:[s.jsx(cl,{messageRole:oo.ASSISTANT,error:!0,children:l("recipes.chat.error.failedToRespond")}),s.jsx(zu,{children:s.jsx(nd,{onClick:()=>n(i),children:l("recipes.chat.error.restartButton")})})]});case"SEND_MESSAGE_ERROR_RETRY":return s.jsxs("div",{children:[s.jsx(cl,{messageRole:oo.ASSISTANT,error:!0,children:l("recipes.chat.error.retryOrRestart")}),s.jsx(zu,{children:s.jsx(nd,{onClick:()=>n(i),children:l("recipes.chat.error.restartButton")})})]});case"SEND_MESSAGE_ERROR":return s.jsxs("div",{children:[s.jsx(cl,{messageRole:oo.USER,error:!0,children:t}),s.jsxs(zu,{$alignToRight:!0,children:[l("recipes.chat.error.failedToSend"),s.jsx(nd,{onClick:()=>a(t),children:l("recipes.chat.error.retryButton")})]})]});default:return null}},vHt=v.div`
    display: flex;
    flex-direction: column;
    gap: var(--salt-spacing-2);
`,THt=({message:{message:e,role:t,results:n},chatId:o,sequence:r,hasLatestResults:a})=>{const[i]=Bm(),{formatMessage:l}=L(),c=l("recipes.chat.message.chatbotPrefix"),d=l("recipes.chat.message.userPrefix");return s.jsxs(vHt,{children:[s.jsx(ie,{children:t===oo.ASSISTANT?c:d}),s.jsx(cl,{messageRole:t,children:e},`${o}-${r}`),!!n?.length&&s.jsx(V,{asChild:!0,flush:!0,className:"salt-gap--1",children:s.jsx("ul",{"aria-label":"List of recipe results",role:"presentation",children:n.map((u,p)=>s.jsx(V.Item,{asChild:!0,colSpan:{xs:6},children:s.jsx("li",{children:s.jsx(Bl,{list:ig.RECIPE_ASSISTANT,groupName:"Recommended",groupType:ig.RECIPE_ASSISTANT,sequence:p,responsiveImageHeight:!1,onQueueRecipeImpression:i,skipLinkId:a&&p===0?"recipe-assistant-results":void 0,...u},u.recipeId)})},u.recipeId))})})]})},toe=(e,t)=>{const n=Me(b8),o=Me(JQe);h.useEffect(()=>{if(Object.values(n).find(Boolean))return e(n);if(typeof o>"u")return t();const r=setTimeout(t,o);return()=>clearTimeout(r)},[n,o])},_Ht=()=>{const e=ws(),t=Me($e("recipesChatModal")),n=Me(XQe);h.useEffect(()=>{if(!n)return;const o=setTimeout(()=>e(t?f_():Wqe()),Math.max(0,de(n)-de()));return()=>clearTimeout(o)},[t,n])},bHt=()=>{const e=Me(Zv),{CREATE_CHAT:t}=Me(b8),n=Me(AN);return!!e||t||n==="CREATE_CHAT_ERROR"},xHt=()=>{const e=ws(),t=Me($e("recipesChatModal")),n=Me(Zv);h.useEffect(()=>{if(n)return;const o=s5();o&&(e(Vqe(o.chatId)),e(gHt()),o.isOpen&&!t&&e(J.openModal("recipesChatModal")))},[]),h.useEffect(()=>{!n&&t&&e(f_())},[t])},AHt=e=>{h.useEffect(()=>{if(!e)return;const t=new MutationObserver(n=>{const o=n.every(r=>!r.addedNodes.length);!e?.lastElementChild||o||e.scrollTo(0,e.scrollHeight-e.lastElementChild.clientHeight-parseInt(getComputedStyle(e).paddingBottom,10)-4)});return t.observe(e,{childList:!0}),()=>t.disconnect()},[e])},RHt=e=>{const t=h.useRef();return{setContainerToStoredScrollPosition:h.useCallback(r=>{t.current&&r?.scrollTo(0,t.current)},[t.current]),updateStoredScrollPosition:()=>{t.current=e?.scrollTop}}},DHt=()=>{const[e,t]=h.useState(null),{setContainerToStoredScrollPosition:n,updateStoredScrollPosition:o}=RHt(e);return AHt(e),{scrollContainerRefCallback:h.useCallback(a=>{t(a),n(a)},[]),updateStoredScrollPosition:o}},OHt=()=>{const e=ws(),t=ft(),n=()=>{e(XP(!1)),t({type:QW})},o=()=>{e(f_()),t({type:XW})},{formatMessage:r}=L();return s.jsxs("div",{children:[s.jsx(cl,{messageRole:oo.ASSISTANT,children:r("recipes.chat.refresh.confirmRestart")}),s.jsxs(zu,{children:[s.jsxs(nd,{onClick:n,children:[s.jsx(x.Text,{"aria-hidden":"true",children:r("recipes.chat.refresh.cancelRestartButton")}),s.jsx(ie,{asChild:!0,children:s.jsx(x.Text,{children:r("recipes.chat.refresh.cancelAccessibility")})})]}),s.jsxs(nd,{onClick:o,children:[s.jsx(x.Text,{"aria-hidden":"true",children:r("recipes.chat.refresh.restartButton")}),s.jsx(ie,{asChild:!0,children:s.jsx(x.Text,{children:r("recipes.chat.refresh.restartAccessibility")})})]})]})]})},PHt=v.div`
    block-size: 100%;
    overflow: auto;
    background-color: var(--background-color);
    display: flex;
    flex-direction: column;
    gap: var(--salt-spacing-2);
`,NHt=()=>{const e=Me(x8),t=Me(AN),[n,o]=h.useState({loading:!1,error:t}),r=h.useRef(e);return toe(a=>{(a.SEND_MESSAGE||a.CREATE_CHAT)&&o({error:t,loading:!0}),(t==="SEND_MESSAGE_ERROR"||t==="GET_CHAT_HISTORY_ERROR")&&o({error:t,loading:!1})},()=>o({error:t,loading:!1})),!n.loading&&r.current.length!==e.length&&(r.current=e),{...n,messageHistory:r.current}},LHt=({chatContentRef:e,onScroll:t})=>{const n=Me(A8),{messageHistory:o,loading:r,error:a}=NHt(),i=Me(Zv),l=Me(R8),c=(d,u)=>u===o.length-1&&a==="SEND_MESSAGE_ERROR"?s.jsx(tx,{errorType:a,children:d.message},a):i?s.jsx(THt,{chatId:i,message:d,sequence:u,hasLatestResults:l===u},`${i}-${u}`):null;return s.jsxs(PHt,{className:"salt-p--4",ref:e,"aria-live":"polite","aria-busy":r,role:"log",onScroll:t,children:[a==="GET_CHAT_HISTORY_ERROR"||a==="CREATE_CHAT_ERROR"?s.jsx(tx,{errorType:a},a):s.jsxs(ae.Fragment,{children:[o.map(c),r&&s.jsx(cl,{messageRole:oo.ASSISTANT,loading:!0},"loading")]}),(a==="SEND_MESSAGE_ERROR_RETRY"||a==="SEND_MESSAGE_ERROR_FATAL")&&s.jsx(tx,{errorType:a},a),n&&s.jsx(OHt,{})]})},kHt=v.form`
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--salt-spacing-1);
    padding: var(--salt-spacing-1);
    background: var(--intent-primary-50);
    border-radius: var(--salt-radius-default);
`,jHt=v(_O)`
    field-sizing: content;
    block-size: auto;
    min-block-size: revert;
    resize: block;
    overflow: hidden;

    &::placeholder {
        font-style: italic;
    }

    &::-webkit-scrollbar {
        display: none;
    }
`,MHt=v(x)`
    max-block-size: ${$(40)};
`,wHt=()=>{const e=ws();return t=>{e(eoe(t))}},FHt=e=>{const[t,n]=h.useState(),[o,r]=h.useState({lineHeight:0,paddingHeight:0});return h.useEffect(()=>{if(!e.current||CSS.supports("field-sizing","content"))return;const a=getComputedStyle(e.current);r({lineHeight:parseInt(a.lineHeight,10),paddingHeight:parseInt(a.padding,10)*2})},[e.current]),h.useLayoutEffect(()=>{if(!e.current||CSS.supports("field-sizing","content"))return;e.current.style.setProperty("height","0px");const a=e.current.scrollHeight-o.paddingHeight;n(Math.round(a/o.lineHeight)),e.current.removeAttribute("style")},[e.current?.value]),t},BHt=()=>{const e=h.useRef(null),t=FHt(e),[n,o]=h.useState(""),[r,a]=h.useState(!1),[i,l]=h.useState(!1),c=wHt(),d=Me(A8),u=Me(AN);h.useEffect(()=>{a(d)},[d]),toe(()=>a(!0),()=>{u&&u!=="SEND_MESSAGE_ERROR_RETRY"||a(!1)}),h.useEffect(()=>{r||e.current?.focus()},[r]);const p=({target:S})=>{o(S.value),l(S.value.length===301)},g=({nativeEvent:S,currentTarget:C})=>{S instanceof KeyboardEvent&&S.key==="Enter"&&(S.preventDefault(),n&&C.form?.requestSubmit())},E=S=>{S.preventDefault(),!(r||i)&&(a(!0),c(n),o(""))},{formatMessage:y}=L(),I=Me(R8);return s.jsxs(kHt,{onSubmit:E,children:[s.jsx(jK,{visuallyConcealed:!0,htmlFor:"chat_input",children:y("recipes.chat.input.accessibilityLabel")}),s.jsx(jHt,{as:"textarea",maxLength:301,rows:t,placeholder:y("recipes.chat.input.placeholder"),ref:e,id:"chat_input",name:"recipe-chat",onChange:p,onKeyDown:g,value:n,hasError:i,"aria-invalid":i,"aria-errormessage":"chat_input_error",enterKeyHint:"send"}),s.jsx(MHt,{type:"submit","aria-label":y("recipes.chat.input.submitButton.ariaLabel"),"data-test":"llm-chat-send-button",intent:"primary",disabled:r||i,children:s.jsx(x.Icon,{name:"arrow_right"})}),i&&s.jsx(O,{id:"chat_input_error",intent:"error",children:y("recipes.chat.input.error")}),I!==-1&&s.jsx(_E,{location:"#recipe-assistant-results",testId:"recipe-assistant-results-skip-link",text:y("skip.assistant.results")})]})},UHt=v.div`
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: var(--salt-spacing-1);
    opacity: 0;
    transform: translate(200px, 200px) scale(0);
    transform-origin: bottom;
    transition: all 0.35s;

    ${({$displayCallOut:e})=>e&&`
        opacity: 1;
        transform: translate(0, 0) scale(1);
    `}
`,GHt=v.div`
    ${({$displayCallOut:e})=>e?`
        max-height: 200px;
    `:`
        max-height: 0;
        max-width: 0;
        transition: all 0s 0.35s;
    `}
`,$Ht=({onClose:e,willDisplayCallOut:t})=>{const{formatMessage:n}=L(),[o,r]=h.useState(!1);h.useEffect(()=>{if(!t)return;const i=setTimeout(()=>{r(!0)},3e3);return()=>clearTimeout(i)},[t]),h.useEffect(()=>{!t&&o&&r(!1)},[t]);const a=()=>{r(!1),e()};return s.jsx(GHt,{$displayCallOut:o,children:s.jsxs(UHt,{$displayCallOut:o,children:[s.jsx(x,{intent:"secondary",size:"s",fill:!1,onClick:a,"aria-label":n("recipes.chat.callout.close"),children:s.jsx(x.Icon,{name:"close_default"})}),s.jsx(cl,{messageRole:oo.ASSISTANT,align:"right",children:n("recipes.chat.callout.message")})]})})},HHt=v.div`
    display: ${({$hideButton:e})=>e?"none":"flex"};
    flex-direction: column;
    align-items: flex-end;
    gap: var(--salt-spacing-1);
    position: fixed;
    inset-block-end: var(--salt-spacing-4);
    inset-inline-end: var(--salt-spacing-4);
    z-index: ${$t["collapsible-box"]};
`,VHt=v(x)`
    box-shadow: var(--salt-elevation-shadow-3);
`,WHt=v(x.Text)`
    margin-inline-start: var(--salt-spacing-2);
    max-inline-size: 200px;
    transition:
        margin-inline-start 0.35s,
        max-inline-size 0.35s;

    ${({$hideButtonLabel:e})=>e&&`
            opacity: 0;
            max-width: 0;
            margin-inline-start: 0;
            height: 0;
    `}
`,YHt=v.div`
    z-index: ${$t["collapsible-box"]};
    inline-size: 100%;
    block-size: 100%;
    ${({$availableHeight:e})=>e&&`max-height: ${e}px;`}
    position: fixed;
    background: white;
    opacity: 1;
    border-radius: var(--salt-radius-default);
    box-shadow: var(--salt-elevation-shadow-3);
    display: flex;
    flex-direction: column;
    inset-inline-end: 0;
    inset-block-end: 0;

    ${re.smUp`
        margin-inline-end: var(--salt-spacing-4);
        margin-block-end: var(--salt-spacing-4);
        width: 432px;
        height: 576px;
    `};
`,qHt=()=>{const[e,t]=h.useState();return h.useEffect(()=>{window.visualViewport?.addEventListener("resize",()=>{t(window.visualViewport?.height)})},[]),e},KHt=()=>{const e=ws(),{formatMessage:t}=L(),n=ft(),{scrollContainerRefCallback:o,updateStoredScrollPosition:r}=DHt(),a=qHt(),i=bHt(),l=lJ(),c=Me(ZQe),d=os({breakpoint:"sm-up"}),u=Me($e("recipesChatModal")),p=Me(D("rec.fo"));xHt(),_Ht();const g=()=>{if(u){e(J.closeModal()),n({type:qD});const I={event:"minimize_recipe_assistant"};te.sendEvent({GA:I,WA:null})}else{e(J.openModal("recipesChatModal")),n({type:KD});const I={event:"reopen_recipe_assistant"};te.sendEvent({GA:I,WA:null})}},E=()=>{e(J.openModal("recipesChatModal")),e(f_()),n({type:WD}),e(XB());const I={event:"open_recipe_assistant"};te.sendEvent({GA:I,WA:null})},y=()=>{n({type:zW}),e(XB())};return l?s.jsxs("div",{children:[s.jsxs(HHt,{$hideButton:u,children:[p&&s.jsx($Ht,{willDisplayCallOut:!c&&!i,onClose:y}),s.jsxs(VHt,{intent:"primary",fill:!1,"data-test":"recipe-assistant-button",onClick:i?g:E,id:"recipe-assistant-chat",className:"salt-gap--0",children:[s.jsx(x.Icon,{name:"recipes"}),p&&!i&&s.jsx(ie,{children:t("recipes.chat.callout.message")}),s.jsx(WHt,{"data-test":"recipe-assistant-button-text",$hideButtonLabel:c||i,children:t("recipes.chat.recipeAssistant")}),s.jsx(ie,{children:t(i?"recipes.chat.modal.resumeChat":"recipes.home.recipeAssistantAccessibility")})]})]}),s.jsxs(gp,{isOpen:u,className:"_",overlayClassName:"_",onRequestClose:g,bodyOpenClassName:d?"ReactModal__Body--open":null,contentElement:(I,S)=>s.jsx(YHt,{$availableHeight:a,...I,children:S}),children:[s.jsx(fHt,{minimiseChat:g}),s.jsx(LHt,{chatContentRef:o,onScroll:r}),s.jsx(BHt,{})]})]}):null},zHt=D("m.la.h"),QHt="alternativesModal",XHt=()=>f($e(xp))?s.jsx(ZHt,{}):null,ZHt=()=>{const e=f($e(xp)),t=F(),n=f(S=>zHt(S)),o=f(Yn(xp)),r=h.useRef();h.useRef();const a=o?.productId,i=o?.productName,l=o?.retailerProductId,c=o?.type,d=o?.pageEventId,u=f(S=>I2e(S)),p=f(S=>C2e(S)),g=f(S=>Q6(S));f(S=>mo(S));const E=()=>t(J.closeModal()),y=h.useMemo(()=>{const S=l===g.active,C=g.data&&g.data.alternatives&&g.data.alternatives.length>0;return S&&C},[g,l]),I=h.useMemo(()=>y&&g.data.alternatives?g.data.alternatives.map(S=>S&&S.productId):[],[g,y]);return h.useEffect(()=>{!g.isFetching&&a&&l&&t(Ast(l,c==="slotbooking"?{slotId:u,slotRegionId:p}:void 0,a))},[a,l,u,p,c]),e&&g.fetchError?s.jsx(B,{isOpen:e,onRequestClose:E,aria:{labelledby:ib},children:s.jsx(_j,{actions:{onButtonClick:E}})}):e?s.jsx(B,{isOpen:e,onRequestClose:E,aria:{labelledby:ib},children:s.jsxs(ae.Fragment,{children:[s.jsx(B.Header,{"aria-live":"polite","data-test":"alternatives-modal-header",align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:ib,children:s.jsx(b,{id:"alternative.products.modal.heading",values:{product:i}})})}),s.jsx(B.Body,{"data-test":"alternatives-modal-body",bodyElRef:r,children:s.jsx(Q,{direction:"column",gap:["sm"],children:I.map(S=>s.jsx(ea,{page:QHt,group:{section:Gqe,products:I,type:"cluster"},type:c,pageEventId:d,productId:S,displayLandscapeLayout:!0,withoutHeader:!0,sendFopImpression:!0,loading:g.isFetching||!y},S))})}),s.jsx(B.Footer,{align:n?"left":"center",children:s.jsx(x,{intent:"primary",fill:!0,onClick:E,"data-test":"alternatives-modal-footer-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"alternative.products.modal.footer.button"})})})})]})}):null};v.aside`
    display: flex;
    block-size: ${$(52)};

    ${re.lgUp`
        height: ${$(40)};
    `}
`;const JHt=v.aside`
    display: flex;
    block-size: ${$(52)};
    position: relative;
    z-index: ${$t["content-block-header"]};
`,eVt=v.img`
    display: block;
    inline-size: 100%;
    block-size: 100%;
    object-fit: cover;
`,tVt=v.div`
    min-inline-size: ${$(80)};
    max-inline-size: ${$(80)};

    ${re.lgUp`
        min-width: ${$(60)};
        max-width: ${$(60)};
    `}
`,sVt=v.div`
    flex: 1 1 auto;
`,nVt=KL("HEADER"),oVt=cf("HEADER"),rVt=Fdt("HEADER"),aVt=D("seo.rdbl"),iVt=Object.values(P2e).map(e=>e()),lVt={actions:m.shape({analyticsEvent:m.func.isRequired,fetchContentBlocks:m.func.isRequired}).isRequired,contentBlocksCommonData:m.shape({lastUpdated:m.number,fetchError:m.bool,isFetching:m.bool}).isRequired,contentBlockHeader:m.shape({id:m.oneOfType([m.string,m.number]),type:m.oneOf(["HEADER","IN_PAGE"]),name:m.string,content:m.shape({solid:m.string,images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired,imageAlignment:m.string.isRequired,altText:m.string.isRequired})).isRequired}).isRequired,targetUrl:m.string,isExternalLink:m.bool,target:m.shape({linkType:m.string.isRequired,value:m.string,openInNewTab:m.bool})}).isRequired,isContentBlockHeaderEmpty:m.bool.isRequired,isContentBlockHeaderImagesEmpty:m.bool.isRequired,isSEOReadableURLEnabled:m.bool.isRequired},soe=({actions:e,contentBlocksCommonData:t,contentBlockHeader:n,isContentBlockHeaderEmpty:o,isContentBlockHeaderImagesEmpty:r,isSEOReadableURLEnabled:a})=>{const i=L(),l=Ne(),{fetchContentBlocks:c,analyticsEvent:d}=e,{lastUpdated:u,isFetching:p}=t,[g,E]=h.useState(0),[y,I]=h.useState(ct()),S=3,C=iVt.some(H=>zr({path:H},l.pathname));if(h.useEffect(()=>{g<S&&!u&&!p&&c(a).then(()=>{E(0)}).catch(()=>{E(g+1)})},[g,u,p]),h.useEffect(()=>{o||C||r||I(()=>{const H=ct();return d({type:fa.CONTENT_BLOCK_IMPRESSION,contentBlockImpression:{entryId:T,contentBlockType:A,entryName:_,advertId:y}}),H})},[l.key]),o||C)return null;const{id:T,name:_,type:A,target:R,isExternalLink:P,targetUrl:N,content:{images:k}}=n,M=H=>{const{target:K}=H.nativeEvent;K&&d({type:fa.CONTENT_BLOCK_CLICKED,entryId:T,contentBlockType:A,entryName:_,linkType:R.linkType,targetUrl:N,applyDescriptionByType:"HEADER",advertId:y})},w={style:{display:"flex",height:"100%",width:"100%"}},j=H=>{const K=k.find(q=>q.imageAlignment===H);if(!K)return null;const X=H==="CENTER"?sVt:tVt;return s.jsx(X,{children:s.jsx(eVt,{"data-test":`content-block-header-image-${H.toLowerCase()}`,src:K.url,alt:K.altText})})},G=j("CENTER"),W=()=>{const H={"data-test":"content-block-header-content",...w},K=s.jsxs(h.Fragment,{children:[j("LEFT"),G,j("RIGHT")]});return N?s.jsx(BS,{...H,isExternalLink:P,target:R,href:N,children:K}):s.jsx("div",{...H,children:K})};return G?s.jsx(JHt,{"aria-label":i.formatMessage("contentBlocks.header.aside.aria.label"),onClick:N?M:void 0,onKeyPress:()=>{},"data-test":"content-block-header",id:"global-block",children:W()}):null};soe.propTypes=lVt;const cVt=e=>({contentBlocksCommonData:qL(e),contentBlockHeader:nVt(e),isContentBlockHeaderEmpty:oVt(e),isContentBlockHeaderImagesEmpty:rVt(e),isSEOReadableURLEnabled:aVt(e)}),dVt=st({analyticsEvent:U.analyticsEvent,fetchContentBlocks:Mp.getContentBlocks}),uVt=we(cVt,dVt)(soe),noe=({data:e})=>e.content.staticContentPage,sM=e=>e.type.endsWith("_SUCCESS"),pVt=se("CREATE_MEAL"),mVt=se("EDIT_MEAL"),hVt=se("DELETE_MEAL"),gVt=e=>({type:"API",payload:{url:"/v1/meals",options:{method:"POST",body:e},...pVt,...$E}}),EVt=(e,t)=>({type:"API",payload:{url:`/v1/meals/${e}`,options:{method:"PUT",body:t},...mVt,...$E}}),fVt=e=>({type:"API",payload:{url:`/v1/meals/${e}`,options:{method:"DELETE"},...hVt,...$E}}),ooe=({mealTitle:e,mealIngredients:t,mealNotes:n})=>({title:Ri(e),ingredients:t.reduce((o,{ingredient:r})=>r?o.concat([Ri(r)]):o,[]),notes:n?Ri(n):void 0}),yVt=e=>async(t,n)=>{try{const o=await t(gVt(ooe(e)));if(sM(o)){const{id:r,ingredients:a,notes:i}=o.payload.responseData,l=Tm(n());t(U.analyticsEvent({type:XD,MEAL_ID:r,NUMBER_OF_INGREDIENTS:a.length,...i&&{LENGTH_OF_NOTES:i?.length}})),t(Jv(l));const c={event:"meal_plan_create_meal",id:r};te.sendEvent({GA:c,WA:null})}return o}catch{return Z.error("meals.newMeal.create.error"),null}},IVt=(e,t)=>async(n,o)=>{try{const r=await n(EVt(e,ooe(t)));if(sM(r)){const{id:a,ingredients:i,notes:l}=r.payload.responseData,c=Tm(o());n(U.analyticsEvent({type:ZD,MEAL_ID:a,NUMBER_OF_INGREDIENTS:i.length,...l&&{LENGTH_OF_NOTES:l?.length}})),n(Jv(c));const d={event:"meal_plan_edit_meal",id:a};te.sendEvent({GA:d,WA:null})}return r}catch{return Z.error("toast.notification.generic.error"),null}},SVt=e=>async(t,n)=>{try{const o=await t(fVt(e)),r=Tm(n());if(sM(o)){t(U.analyticsEvent({type:JD,MEAL_ID:e})),t(Jv(r));const a={event:"meal_plan_delete_meal",id:e};te.sendEvent({GA:a,WA:null})}}catch{Z.error("toast.notification.generic.error")}},nM={createMeal:yVt,editMeal:IVt,deleteMeal:SVt},CVt=101,roe=({name:e,className:t})=>{const n=L(),o=n.formatMessage("meals.newMeal.name.title"),r={placeholder:n.formatMessage("meals.newMeal.name.placeholder"),required:{value:!0,message:n.formatMessage("meals.newMeal.missingTitle.error")},maxLength:CVt};return s.jsx("div",{className:t,children:s.jsx(nr,{type:"text",validate:a=>aT(n.formatMessage("validation.msg.required"))(a),label:o,name:e,hasRequiredSymbol:!1,"data-test":"meal-name-input","data-pii":"true",...r})})},vVt=500,aoe=({name:e,className:t})=>{const n=L(),o=n.formatMessage("mealplanning.new-meal.notes.title"),r={placeholder:n.formatMessage("mealplanning.new-meal.notes.placeholder"),maxLength:vVt};return s.jsx("div",{className:t,children:s.jsx(nr,{type:"text",label:o,name:e,"data-pii":"true",...r})})},TVt=v.fieldset`
    padding: 0;
    border: none;
`,_Vt=v.div`
    border-radius: var(--salt-radius-default);

    &:focus-within {
        outline: 5px auto Highlight;
        outline: 5px auto -webkit-focus-ring-color;
    }
`,bVt=v.div`
    position: relative;

    &:first-of-type input {
        border-start-start-radius: var(--salt-radius-default);
        border-start-end-radius: var(--salt-radius-default);
    }

    &:last-of-type input {
        border-end-start-radius: var(--salt-radius-default);
        border-end-end-radius: var(--salt-radius-default);
    }

    &:not(:first-of-type) input {
        border-block-start: 0;
    }

    &:has(input[disabled]):not(:first-of-type)::after {
        content: '';
        background: var(--intent-secondary-300);
        position: absolute;
        inset-inline: var(--salt-spacing-2);
        block-size: var(--salt-border-1);
    }
`,xVt=v(ZC)`
    outline: 0;
    border-radius: var(--salt-radius-0);

    &:focus::placeholder {
        color: transparent;
    }
`,wg=({className:e,children:t})=>{const{formatMessage:n}=L();return s.jsxs(TVt,{className:e,children:[s.jsx(Rn,{as:"legend",children:n("mealplanning.new-meal.ingredients.title")}),s.jsx(_Vt,{children:ae.Children.map(t,o=>s.jsx(bVt,{children:o}))})]})};wg.Input=xVt;const AVt=v(oi)`
    color: var(--salt-text-color);
`,sx=25,RVt=500,ioe=({className:e,mealId:t})=>{const{formatMessage:n}=L(),o=ws(),[r,a]=h.useState(),{register:i,setFocus:l,watch:c}=po(),d=c("mealIngredients"),u=d.at(-1)?.ingredient,{fields:p,append:g,remove:E,replace:y}=Fce({name:"mealIngredients"});return h.useLayoutEffect(()=>{u&&d.length<sx&&g({ingredient:""},{shouldFocus:!1})},[u,d.length]),h.useEffect(()=>{r&&l(`mealIngredients.${r}.ingredient`)},[r]),s.jsxs("div",{className:e,children:[s.jsx(wg,{children:p.map((I,S)=>{const{onBlur:C,...T}=i(`mealIngredients.${S}.ingredient`),_=S===p.length-1,A=R=>{const P=R.clipboardData.getData("text").split(/\r?\n/);if(P.length<=1)return;R.preventDefault();const N=d.filter(j=>j.ingredient),k=sx-N.length,M=P.reduce((j,G)=>{const W=G.replace("","").trim();return W?[...j,{ingredient:W}]:j},[]),w=M.slice(0,k);y(N.toSpliced(S,0,...w)),w.length<M.length&&Z.warning("mealplanning.new-meal.maximum-ingredients-exceeded.notification"),a(S+w.length-1),o(U.analyticsEvent({type:sY,...t&&{MEAL_ID:t},NUMBER_OF_INGREDIENTS:w.length}))};return s.jsx(wg.Input,{maxLength:RVt,"data-test":`meal-ingredients-input-${S}`,placeholder:n("mealplanning.new-meal.ingredients.placeholder"),"data-pii":"true",onPasteCapture:A,onKeyDown:R=>{R.code==="Enter"&&(R.preventDefault(),l(`mealIngredients.${S+1}.ingredient`))},onBlur:R=>{C(R),!R.currentTarget.value.length&&!_&&E(S)},...T},I.id)})}),p.length===sx&&!!u&&s.jsx(AVt,{className:"salt-m-t--2",children:n("mealplanning.new-meal.maximum-ingredients-reached")})]})},DVt=v.form`
    inline-size: 100%;
`,OVt=({closeModal:e})=>{const t=ws(),[n,o]=h.useState(!1),{formatMessage:r}=L(),a={cancelButton:r("meals.newMeal.cancelButton"),submitCreateButton:r("meals.newMeal.createButton")},i=async d=>{d.mealTitle&&(o(!0),await t(nM.createMeal(d)),e(),o(!1))},l=po(),c=()=>{e()};return s.jsx(Q,{children:s.jsxs(DVt,{id:"new-meal-form",onSubmit:l.handleSubmit(i),children:[s.jsx(roe,{name:"mealTitle",className:"salt-m-b--4"}),s.jsx(ioe,{className:"salt-m-b--4"}),s.jsx(aoe,{name:"mealNotes",className:"salt-m-b--4"}),s.jsxs(Q,{justify:"center",wrap:"nowrap",children:[s.jsx(x,{className:"salt-d--none sm:salt-d--flex salt-m-r--2 salt-m-y--0",intent:"secondary",onClick:c,fill:!0,children:s.jsx(x.Text,{children:a.cancelButton})}),s.jsx(x,{intent:"primary",loading:n,fill:!0,type:"submit",children:s.jsx(x.Text,{children:a.submitCreateButton})})]})]})})},PVt=()=>{const e=F(),{formatMessage:t}=L(),n=Me($e("newMealModal")),o=Dn({mode:"onChange",defaultValues:{mealTitle:"",mealIngredients:[{ingredient:""}]}}),r=()=>{e(J.closeModal()),o.reset()};return s.jsx(On,{...o,children:s.jsxs(B,{isOpen:n,onRequestClose:r,maxWidth:"lg",closeMessage:t("mealplanning.new-meal.close.accessibility"),asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"meals.newMeal.title"})})}),s.jsx(B.Body,{children:s.jsx(OVt,{closeModal:r})})]})})},NVt=v.form`
    inline-size: 100%;
`,LVt=({onSubmit:e,mealId:t})=>s.jsxs(NVt,{id:"new-meal-form",onSubmit:e,children:[s.jsx(roe,{name:"mealTitle",className:"salt-m-b--4"}),s.jsx(ioe,{mealId:t,className:"salt-m-b--4"}),s.jsx(aoe,{name:"mealNotes",className:"salt-m-b--4"})]}),kVt=({meal:e,closeModal:t})=>{const n=ws(),{formatMessage:o}=L(),[r,a]=h.useState(!1),i=async d=>{d.mealTitle&&(a(!0),await n(nM.editMeal(e.id,d)),t())},l=Dn({mode:"onChange",defaultValues:{mealTitle:e.title,mealIngredients:e.ingredients.length?e.ingredients.map(d=>({ingredient:d})):[{ingredient:""}],mealNotes:e.notes}}),c=()=>{n(J.openModal("deleteMeal",{meal:e,onConfirm:t,onCancel:()=>{n(J.openModal("mealDetails",e))}})),n(U.analyticsEvent({type:iY,MEAL_ID:e.id}))};return s.jsxs(h.Fragment,{children:[s.jsx(B.Body,{className:"salt-p--0",children:s.jsx(Q,{className:"salt-p--4",children:s.jsx(On,{...l,children:s.jsx(LVt,{mealId:e.id,onSubmit:l.handleSubmit(i)})})})}),s.jsx(B.Footer,{className:"salt-p--0",children:s.jsxs(Q,{direction:"column",additionalCss:"flex: 1;",className:"salt-p--4 salt-gap--2",children:[s.jsx(x,{fill:!0,loading:r,intent:"primary",onClick:l.handleSubmit(i),"data-test":"save-meal-button",children:s.jsx(x.Text,{children:o("meals.editMeal.saveButton")})}),s.jsx(x,{fill:!0,intent:"secondary",onClick:c,"data-test":"delete-meal-button",children:s.jsx(x.Text,{children:o("meals.editMeal.deleteButton")})})]})})]})},jVt=v.img`
    flex: 1;
    object-fit: cover;
    object-position: 50% 50%;
    inline-size: 100%;
    min-block-size: 0;
    max-block-size: ${$(124)};
`,w$=v(x)`
    position: absolute;
    inset-block-start: var(--salt-spacing-2);
    ${({$alignLeft:e})=>e?"inset-inline-start: var(--salt-spacing-2)":"inset-inline-end: var(--salt-spacing-2)"};
    z-index: ${$t.overlay};
`,MVt=v(ee)`
    word-break: break-all;
`,wVt=v(x)`
    flex-shrink: 0;
    align-self: center;
`,FVt=()=>{const e=F(),{formatMessage:t}=L(),[n,o]=h.useState(!1),r=Me($e("mealDetails")),a=Me(Yn("mealDetails")),i=()=>{o(!1),e(J.closeModal())},l=()=>{o(!0),e(U.analyticsEvent({type:nY,MEAL_ID:a?.id}))},c=()=>{e(J.openModal("cancelEditMealModal",{onConfirm:()=>{o(!1),e(J.openModal("mealDetails",a)),e(U.analyticsEvent({type:rY,MEAL_ID:a?.id}))},onCancel:()=>{e(J.openModal("mealDetails",a))}})),e(U.analyticsEvent({type:oY,MEAL_ID:a?.id}))};return!r||!a?null:s.jsxs(B,{onRequestClose:i,isOpen:r,showCloseIcon:!1,condensed:!0,context:"drawer",children:[s.jsxs(B.Header,{align:"left",className:"salt-p--0",children:[s.jsx(jVt,{src:a.image.url,alt:a.image.altText}),n?s.jsxs(w$,{intent:"secondary",onClick:c,$alignLeft:!0,fill:!1,children:[s.jsx(x.Icon,{name:"arrow_left"}),s.jsx(x.Text,{children:t("mealplanning.edit-meal.back-button")})]}):s.jsx(w$,{intent:"secondary",onClick:i,fill:!1,children:s.jsx(x.Icon,{name:"close_default"})})]}),n?s.jsx(kVt,{meal:a,closeModal:i}):s.jsx(B.Body,{className:"salt-p--0",children:s.jsx("div",{"data-test":"meal-details-content",children:s.jsxs(Q,{direction:"column",gap:["md"],className:"salt-m--4",children:[s.jsxs(Q,{justify:"space-between",wrap:"nowrap",direction:"row",gap:["md"],basis:"100%",children:[s.jsx(MVt,{forwardedAs:"h1",size:"s",children:a.title}),s.jsx(wVt,{intent:"secondary",size:"s",fill:!1,onClick:l,"data-test":"edit-meal-button",children:s.jsx(x.Text,{children:t("meals.mealDetails.editButton")})})]}),a.ingredients.length?s.jsx(wg,{children:a.ingredients.map(d=>s.jsx(wg.Input,{value:d,disabled:!0,readOnly:!0},d))}):s.jsxs("div",{children:[s.jsx(Q,{justify:"center",margin:[null,null,"md"],children:s.jsx(pe,{name:"no_ingredients",height:250,width:250})}),s.jsx(O,{asChild:!0,className:"salt-m-b--4",children:s.jsx("div",{children:t("meals.mealDetails.noIngredients.message")})}),s.jsx(x,{className:"salt-m-r--2 salt-m-y--0",intent:"secondary",fill:!0,"data-test":"add-ingredients-button",onClick:l,children:s.jsx(x.Text,{children:t("meals.mealDetails.addIngredientsButton")})})]}),a.notes&&s.jsx(p9,{id:"notes",label:t("mealplanning.new-meal.notes.title"),inputOptions:{disabled:!0,value:a.notes,readOnly:!0}})]})})})]})},BVt=e=>e.data.popupBanner,UVt=e=>e.data.popupBanner.vrTestingMeta,GVt=e=>{const t=F(),{lastUpdated:n,data:o}=f(BVt);return h.useEffect(()=>{!n&&e&&t(FJe())},[n,e]),o},$Vt=[["/products/search","SEARCH",!0],["/products","CATEGORY",!0],["/search","SEARCH",!0],["/categories","CATEGORY",!1],["/favorites","FAVORITES",!0],["/regulars","REGULARS",!0],["/lists","LISTS",!0],["/promotions","PROMOTIONS",!0],["/coupons","COUPONS",!0],["/content","CONTENT_PAGE",!1]],HVt=(e="",t=!1)=>{if(e==="/")return t?"LIHP":"LOHP";let n;return $Vt.forEach(([o,r,a])=>{e.startsWith(o)&&(a||(n=r),e===o&&(n=r))}),n},VVt=()=>{const{pathname:e}=Ne(),t=f(Xe),[n,o]=h.useState(void 0);return h.useEffect(()=>{o(HVt(e,t))},[e,t]),n},loe=e=>{const t=[];for(let n=0;n<localStorage.length;n++){const o=localStorage.key(n);o?.startsWith(e)&&t.push(o)}return t},coe=e=>{const t=`${e}-`,n=loe(t);return!n.length||n.length>1?void 0:n[0]},WVt=(e,t)=>{if(!t)return;loe(e).forEach(o=>{o.endsWith(t)||localStorage.removeItem(o)})},YVt=3e3,$h="current-pop-up-banner-page-count-to-reset",qVt=(e,t)=>typeof e=="number"&&e>0&&t!==void 0,KVt=(e,t)=>{const n=coe($h);if(n){const o=localStorage.getItem(n);o!==null&&Number(o)>0&&e(Number(o));return}t&&(localStorage.setItem(`${$h}-${t}`,"0"),WVt($h,t))},zVt=e=>{e(t=>{const n=coe($h);if(!qVt(t,n))return t;const o=t-1;return localStorage.setItem(n,`${o}`),o})},QVt=({hasPageCollision:e,isRouteWhiteListed:t,popUpVisible:n,pageCount:o,setPopUpVisible:r,showPopup:a})=>{let i;const l=()=>i&&clearTimeout(i);return(e||!t)&&n?(r(!1),l):(!n&&o===0&&t&&!e&&(i=a()),l)},XVt=({isRouteWhiteListed:e,hasPageCollision:t=!1,disableDelay:n=!1,popUpId:o})=>{const r=Ne(),[a,i]=h.useState(!1),[l,c]=h.useState(0),d=f(Cde),u=h.useCallback(()=>setTimeout(()=>i(!0),n?0:YVt),[n]);h.useEffect(()=>{KVt(c,o)},[o]),h.useEffect(()=>QVt({hasPageCollision:t,isRouteWhiteListed:e,popUpVisible:a,pageCount:l,setPopUpVisible:i,showPopup:u}),[r.pathname,e,t,l,a,u]),h.useEffect(()=>{zVt(c)},[r.pathname]);const p=h.useCallback(()=>{const g=Number(d);i(!1),c(g),localStorage.setItem(`${$h}-${o}`,`${g}`)},[d,o]);return{popUpVisible:a,handleClose:p}},doe={POPUP_BANNER:{click:"POPUP_BANNER_CLICKED",impression:"POPUP_BANNER_IMPRESSION",close:"POPUP_BANNER_CLOSE"}},F$=(e,t,n)=>{const o=F(),r=doe[t][e];return h.useCallback(({id:a,advertId:i,name:l,altText:c,targetUrl:d,linkType:u,segments:p,imageUrl:g})=>{const E={id:a,...i&&{advertId:i},name:l,altText:c,targetUrl:d,linkType:u,segments:p,imageUrl:g,location:n,contentSource:"CONTENTFUL",placement:"POP-UP"};if(o(U.analyticsEvent({type:r,...E})),e==="click"){const y=efe(E);te.sendEvent({GA:y,WA:null});const I=nfe(E);te.sendEvent({GA:I,WA:null})}if(e==="impression"){const y=tfe(E);te.sendEvent({GA:y,WA:null});const I=rfe(E);te.sendEvent({GA:I,WA:null})}},[n])},ZVt=e=>{const t=F(),n=doe.POPUP_BANNER.close;return h.useCallback(({id:o,advertId:r,name:a,linkType:i,targetUrl:l,altText:c})=>{const d={id:o,advertId:r,name:a,linkType:i,location:e,targetUrl:l,altText:c,contentSource:"CONTENTFUL",placement:"POP-UP"};t(U.analyticsEvent({type:n,...d}));const u=sfe(d);te.sendEvent({GA:u,WA:null});const p=ofe(d);te.sendEvent({GA:p,WA:null})},[e])},JVt=e=>{const t=F$("click","POPUP_BANNER",e),n=F$("impression","POPUP_BANNER",e),o=ZVt(e);return{reportPopUpBannerClick:t,reportPopUpBannerImpression:n,reportPopupBannerClose:o}},e2t=["/favorites"],t2t=e=>{const{pathname:t}=Ne(),[n,o]=h.useState("");return h.useEffect(()=>{const r=`/${t.split("/")[1]}`;o(r==="/"?"homepage":r)},[t]),e2t.includes(n)&&(e==="/"?n==="homepage":e.startsWith(n))},s2t={LARGE:[960,960],SMALL:[960,240]},n2t=e=>{const[t,n]=h.useState(!1);return h.useEffect(()=>{window&&n(window.matchMedia(e).matches)},[e]),t},o2t=v.div`
    line-height: 0;
    position: fixed;
    z-index: ${$t.popup};
    inline-size: 100%;
    inset-block-end: -100%;
    box-shadow: var(--salt-elevation-shadow-3);
    border-start-start-radius: var(--salt-radius-default);
    border-start-end-radius: var(--salt-radius-default);
    aspect-ratio: 4/1;
    justify-content: flex-end;
    align-items: flex-start;

    &.without-animation {
        animation: unset;
        inset-block-end: 0;

        ${re.mdUp`
            inset-inline-start: 24px;
            inset-block-end: 24px;
        `};

        @media (width <= 62em) and (orientation: landscape) {
            inset-block-end: 0;
        }
    }

    .popup-banner-close-button {
        position: absolute;
        inset-block-start: var(--salt-spacing-1);
        inset-inline-end: var(--salt-spacing-1);
        inline-size: auto;
    }

    @keyframes slide-in {
        0% {
            opacity: 0;
            inset-block-end: -100%;
        }

        40% {
            opacity: 0;
        }

        100% {
            opacity: 1;
            inset-block-end: 0;
        }
    }

    ${({isPopUpVisible:e})=>e?`
            animation: slide-in 0.3s ease-in-out forwards;
            inset-block-end: 0;
            display: flex;
        `:`
            inset-block-end: -100%;
            display: none;
        `};

    ${re.mdUp`
        height: 360px;
        width: 360px;
        inset-inline-start: -360px;
        inset-block-end: 24px;
        border-radius: var(--salt-radius-default);
        box-shadow: var(--salt-elevation-shadow-3);
        aspect-ratio: 1/1;

        @keyframes slide-in {
            0% {
                opacity: 0;
                transform: translateX(-360px);
            }

            40% {
                opacity: 0;
            }

            100% {
                opacity: 1;
                transform: translateX(384px);
            }
        }
    `};

    @media (width <= 62em) and (orientation: landscape) and (device-width <= 62em) {
        inline-size: 360px;
        block-size: 90px;
        inset-block-end: var(--salt-spacing-2);
        inset-inline-start: 50%;
        transform: translateX(-50%);
        aspect-ratio: 4/1;
        @keyframes slide-in {
            0% {
                opacity: 0;
                inset-block-end: -100%;
            }

            40% {
                opacity: 0;
            }

            100% {
                opacity: 1;
                inset-block-end: 0;
            }
        }
    }
`,r2t=v.img`
    block-size: 100%;
    inline-size: 100%;
    border-start-start-radius: var(--salt-radius-default);
    border-start-end-radius: var(--salt-radius-default);
    overflow: hidden;
    ${re.mdUp`
        border-radius: var(--salt-radius-default);
    `};
`,a2t=e=>{if(!e)return"";const t=Aa.calculateLegacyTargetUrl(e),n=e.linkType==="ABSOLUTE_WEB_ADDRESS"?new URL(t):null;return n?n.href:t},i2t=()=>{const{formatMessage:e}=L(),[t]=Ee(["pop.uid"]),n=VVt(),{reportPopUpBannerClick:o,reportPopUpBannerImpression:r,reportPopupBannerClose:a}=JVt(n),{disableAnimation:i,disableDelay:l}=f(UVt),c=GVt(!!n),d=dr(),u=os({breakpoint:"md-up"}),p=n2t("(width <= 62em) and (orientation: landscape) and (max-device-width: 62em)"),g=h.useMemo(()=>{const P=u||p?"SMALL":"LARGE",[N,k]=s2t[P],{images:M}=c??{images:[]};return M.find(w=>w.width===N&&w.height===k)},[c,d,p]),E=e("popupBanner.accessibility.close"),y=e("popupBanner.accessibility.image",{alt:g?.altText}),I=a2t(c?.target),S=t2t(I),{popUpVisible:C,handleClose:T}=XVt({isRouteWhiteListed:!!n,hasPageCollision:S,disableDelay:l,popUpId:t?c?.campaignId:c?.id}),_=c?.target.openInNewTab?"_blank":void 0;h.useEffect(()=>{c&&C&&r({id:t?c?.campaignId:c?.id,...t&&{advertId:c?.id},name:c.name,altText:y,targetUrl:I,linkType:c.target.linkType,segments:c.segments,imageUrl:g?.url,location:n})},[C]);const A=()=>{c&&(o({id:t?c?.campaignId:c?.id,...t&&{advertId:c?.id},name:c.name,altText:y,targetUrl:I,linkType:c.target.linkType,segments:c.segments,imageUrl:g?.url,location:n}),T())},R=()=>{c&&(a({id:t?c?.campaignId:c?.id,...t&&{advertId:c?.id},name:c.name,linkType:c.target.linkType,targetUrl:I,altText:y}),T())};return g&&n?s.jsxs(o2t,{"data-test":"pop-up-banner",className:i?"without-animation":"",isPopUpVisible:C,role:"status","aria-live":"polite","aria-label":y,children:[s.jsx(tt,{"data-test":"pop-up-banner-link",intent:"ghost",href:I,title:y,target:_,onClick:A,children:s.jsx(r2t,{"data-test":"pop-up-banner-image",src:g.url,alt:y})}),s.jsxs(x,{intent:"tertiary-contrast",onClick:R,"data-test":"popup-banner-close-button",className:"popup-banner-close-button",size:"s",children:[s.jsx(ie,{children:E}),s.jsx(x.Icon,{name:"close_default"})]})]}):null},l2t=D("m.la.h"),c2t={isOpen:m.bool,actions:m.shape({closeModal:m.func.isRequired}).isRequired,modalOptions:m.shape({messages:m.shape({title:m.string,message:m.string,cancel:m.string,confirm:m.string}),redirectUrl:m.string,cancelRedirectUrl:m.string}),modalLeftAlignEnabled:m.bool},d2t={isOpen:!1,modalOptions:{},modalLeftAlignEnabled:!1},oM=({isOpen:e,actions:t,modalOptions:n,modalLeftAlignEnabled:o})=>{if(!e)return null;const r=()=>window.location.assign(n.redirectUrl),a="change-store-modal-header",i=()=>{t.closeModal();const{cancelRedirectUrl:l}=n;l&&window.location.assign(l)};return s.jsxs(B,{isOpen:e,onRequestClose:t.closeModal,aria:{labelledby:a},children:[s.jsx(B.Header,{align:o?"left":"center",children:s.jsx(ee,{as:"h2",id:a,children:s.jsx(b,{id:n.messages&&n.messages.title||"change.store.modal.title","data-test":"change.store.modal.title"})})}),s.jsx(B.Body,{children:s.jsx(b,{id:n.messages&&n.messages.message||"change.store.modal.message","data-test":"change.store.modal.message"})}),s.jsxs(B.Footer,{align:o?"left":"center",className:"salt-gap--2",children:[s.jsx(x,{intent:"secondary",onClick:i,fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:n.messages&&n.messages.cancel||"change.store.modal.cancel","data-test":"change.store.modal.cancel"})})}),s.jsx(x,{intent:"primary",onClick:r,fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:n.messages&&n.messages.confirm||"change.store.modal.confirm","data-test":"change.store.modal.confirm"})})})]})]})};oM.propTypes=c2t;oM.defaultProps=d2t;const WA="changeStore",u2t=e=>({isOpen:$e(WA)(e),modalOptions:Yn(WA)(e),modalLeftAlignEnabled:l2t(e)}),p2t=st({closeModal:J.closeModal}),m2t=we(u2t,p2t)(oM),pl={LAYOUT:"LAYOUT",CHECKOUT_WALK:"CHECKOUT_WALK",CHECKOUT_SUMMARY:"CHECKOUT_SUMMARY",RECIPES:"RECIPES"},h2t={[pl.LAYOUT]:[["#main","skip.main"],["#search","skip.search"],["#footer","skip.footer"]],[pl.CHECKOUT_WALK]:[["#main","skip.main"],["#search","skip.search"],["#checkout-progress","skip.checkout.progress"]],[pl.CHECKOUT_SUMMARY]:[["#main","skip.main"],["#search","skip.search"],["#summary-box","skip.checkout.summary"]],[pl.RECIPES]:[["#main","skip.main"],["#search","skip.search"],["#footer","skip.footer"],["#recipe-assistant-chat","skip.recipe.assistant"]]},uoe=({variant:e=pl.LAYOUT})=>{const t=L();return s.jsx(ae.Fragment,{children:h2t[e].map(([n,o])=>s.jsx(_E,{location:n,text:t.formatMessage(o)},n))})},g2t=D("m.la.h"),E2t={isOpen:m.bool.isRequired,actions:m.shape({closeModal:m.func.isRequired,cancelOrderEditExpired:m.func.isRequired}).isRequired,orderId:m.string.isRequired,modalLeftAlignEnabled:m.bool},f2t={modalLeftAlignEnabled:!1},y2t="CURRENT_PAGE",I2t="SHOW_ORDER_DETAILS",rM=({isOpen:e,actions:t,orderId:n,modalLeftAlignEnabled:o})=>{const r=Ge(),a=()=>{t.cancelOrderEditExpired(y2t,n,r)},i=()=>{t.cancelOrderEditExpired(I2t,n,r)},l="order-edit-expired-modal-header";return s.jsxs(B,{isOpen:e,aria:{labelledby:l},children:[s.jsx(B.Header,{align:o?"left":"center",children:s.jsx(ee,{as:"h2",id:l,children:s.jsx(b,{id:"order.edit.expired.modal.title"})})},"header"),s.jsxs(B.Body,{children:[s.jsx(O,{className:"salt-d--block",children:s.jsx(b,{id:"order.edit.expired.modal.body.sorry"})}),s.jsx(O,{className:"salt-d--block",children:s.jsx(b,{id:"order.edit.expired.modal.body"})})]}),s.jsxs(B.Footer,{align:o?"left":"center",className:"salt-gap--2",children:[s.jsx(x,{intent:"secondary",onClick:a,"data-test":"order-edit-expired-cancel-button",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.edit.expired.modal.close"})})}),s.jsx(x,{intent:"primary",onClick:i,"data-test":"order-edit-expired-view-order",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.edit.expired.modal.view.order"})})})]})]})};rM.propTypes=E2t;rM.defaultProps=f2t;const S2t=(e,t)=>({isOpen:$e(`orderEditExpired${t.orderId}`)(e),modalLeftAlignEnabled:g2t(e)}),C2t=st({closeModal:J.closeModal,cancelOrderEditExpired:ji.cancelOrderEditExpired}),v2t=we(S2t,C2t)(rM),T2t={actions:m.shape({openOrderEditExpiredModal:m.func}).isRequired,isBasketUnderEdit:m.bool.isRequired,orderId:m.string,remainingTimeToEditInMillis:m.number},_2t={orderId:null,remainingTimeToEditInMillis:null},aM=({actions:e,isBasketUnderEdit:t,orderId:n,remainingTimeToEditInMillis:o})=>(h.useEffect(()=>{let r;if(t&&n){const i=Math.max(o,0),l=i<6048e5?i:6048e5;r=setTimeout(()=>e.openOrderEditExpiredModal(n),l)}return()=>clearTimeout(r)},[t,n,o]),s.jsx(v2t,{orderId:n}));aM.propTypes=T2t;aM.defaultProps=_2t;const b2t=e=>({remainingTimeToEditInMillis:$ue(e),isBasketUnderEdit:Ar(e),orderId:Ct(e)}),x2t=st({openOrderEditExpiredModal:e=>J.openModal(`orderEditExpired${e}`)}),A2t=we(b2t,x2t)(aM),poe=()=>s.jsxs(h.Fragment,{children:[s.jsx("div",{id:"StickyCollapsibleSummary"}),s.jsx("div",{id:"StickyCheckoutButton"}),s.jsx("div",{id:"StickyBopButton"}),s.jsx("div",{id:"StickyPromotionOptionsAchieved"})]}),R2t=(e,t)=>t.some(n=>e.includes(n)),D2t=["categories","offers","promotions","products"],O2t=(e,t)=>`${e}?sublocationId=${t}`,P2t=e=>{const t=e.substring(0,e.lastIndexOf("/")+1),n=t.toLowerCase();return e.replace(t,n)},N2t=()=>{const[e]=Ee(["seo.rdbl"]),t=Ne(),{sublocationId:n}=ps.parse(t.search),o=f(At),a=`https://${f(SC)}${o??""}`,i=o&&t.pathname==="/"?"":t.pathname;return{canonicalHrefValue:(()=>{if(n&&typeof n=="string"&&!e)return`${a}${O2t(i,n)}`;if(R2t(i,D2t)&&e){const c=P2t(i);return`${a}${c}`}return`${a}${i}`})()}},L2t=()=>s.jsx(Gn,{children:s.jsx("meta",{name:"robots",content:"noindex,nofollow"})}),moe=v.main`
    margin-block: 0;
    margin-inline: auto;
    max-inline-size: ${$(1920)};
`,k2t=({canonicalHref:e})=>s.jsx(Gn,{children:s.jsx("link",{rel:"canonical",href:e})}),j2t=["basket"],M2t=({outlet:e,isSearchEngineCrawlsBlockedFF:t,isLoggedIn:n,unblockedCrawlerPathNames:o="",fetchError:r})=>{const a=Ne(),l=!new RegExp(o,"g").test(a?.pathname),c=Qe.parse(a.search),d=!!(c.q||c.searchTerm);h.useEffect(()=>{if(!e){const E=new Error(`empty content alert triggered when trying to access ${a.pathname}.`);Ue.api.pushError(E)}},[a]);const u=()=>{if(n||r)return!1;if(t)return!l&&!!o&&!d;const E=j2t.some(y=>a?.pathname.includes(y));return!d&&!E},p=N2t(),g=t&&(!o||l);return s.jsxs(h.Fragment,{children:[g&&s.jsx(L2t,{}),u()&&s.jsx(k2t,{canonicalHref:p?.canonicalHrefValue}),s.jsx(moe,{id:"main",className:"salt-m-b--8",children:e})]})};function w2t(){const e=f(ei),t=f(Gp),n=f(Ude),o=f(Gde),r=F(),a=()=>{if(r(U.analyticsEvent({type:on.REGISTER_SUCCESS_ANALYTICS,retailerCustomerId:e,visitorId:t})),e){const l={event:"event",eventAction:"RegistrationSuccess",eventLabel:"RegistrationSuccess",eventCategory:"Registration",retailerCustomerId:e,visitorId:t};te.sendEvent({GA:l,WA:null})}if(r(U.analyticsEvent({type:on.REGISTER_SUCCESS_ANALYTICS_GA4,retailerCustomerId:e})),e){const l={event:"sign_up",customer_id:e};te.sendEvent({GA:l,WA:null})}},i=()=>{if(r(U.analyticsEvent({type:on.LOGIN_SUCCESS_ANALYTICS,retailerCustomerId:e,visitorId:t})),e){const l={event:"event",eventAction:"LoginSuccess",eventLabel:"LoginSuccess",eventCategory:"Login",retailerCustomerId:e,visitorId:t};te.sendEvent({GA:l,WA:null})}if(r(U.analyticsEvent({type:on.LOGIN_SUCCESS_ANALYTICS_GA4,retailerCustomerId:e})),e){const l={event:"login",customer_id:e};te.sendEvent({GA:l,WA:null})}};return h.useEffect(()=>{n&&(o&&a(),i(),localStorage.removeItem(cg),r(Lde()))},[n]),null}const YA=D("cf.cb.ip"),F2t=D("cf.cb.ip.seg"),hoe=D("cf.cb.hd"),B2t=D("loyalty"),goe=D("co.bl"),Eoe=D("gl.bl"),U2t=D("seo.rdbl"),G2t=D("tp"),$2t=D("ald.m"),H2t=D("seo.bsec"),V2t=D("rec.llm"),W2t=D("mp"),Y2t=D("cmpnb"),q2t=D("cp"),K2t=D("sl.c"),z2t=D("cf.ft.flx"),foe=({children:e})=>s.jsx("div",{className:"site--content",children:e}),yoe=()=>{const e=yH(),t=Ne(),n=lJ(),o=f(aV),r=f(goe),a=f(Eoe),i=f($2t),l=f(YA),c=f(F2t),d=f(hoe),u=f(G2t),p=f(Xe),g=f(H2t),E=es("search-engine-non-blocked-pages"),y=f(iq),I=f(Spt),S=f(noe),C=f(V2t),T=f(W2t),[_]=Ee(["popup"]);p3();const A=y||I||S.fetchError;return s.jsxs(xne,{children:[s.jsx(bt,{}),s.jsx(uoe,{variant:n?pl.RECIPES:pl.LAYOUT}),_&&s.jsx(Et,{type:"PopUpBanner::route",fallback:null,children:s.jsx(i2t,{})}),s.jsxs(foe,{children:[typeof window=="object"&&s.jsx(Ane,{}),r&&a&&d&&s.jsx(uVt,{}),s.jsx(lHt,{}),s.jsx(Pne,{}),r&&l&&s.jsx(Vne,{isSegmentable:c}),s.jsx(UN,{location:t,type:"main",children:s.jsx(M2t,{outlet:e,isSearchEngineCrawlsBlockedFF:g,isLoggedIn:p,unblockedCrawlerPathNames:E,fetchError:!!A})}),s.jsx(Wne,{})]}),s.jsx(V1t,{}),s.jsx(m2t,{}),o&&s.jsx(dHt,{}),i&&s.jsx(kne,{}),s.jsx(XHt,{}),s.jsx(hHt,{}),C&&s.jsx(KHt,{}),T&&s.jsx(PVt,{}),T&&s.jsx(FVt,{}),s.jsx(Gne,{}),s.jsx(poe,{}),s.jsx(A2t,{}),s.jsx(w2t,{}),u&&p&&s.jsx(Une,{}),s.jsx(P4,{})]})},Q2t=async({store:e,cookies:t})=>{if(t.get(an.SSO_LOGIN_COMPLETE)){t.delete(an.SSO_LOGIN_COMPLETE,{secure:!0,httpOnly:!0});const n=!!t.get(an.SSO_REGISTRATION_COMPLETE);e.dispatch(Nde(n)),n&&t.delete(an.SSO_REGISTRATION_COMPLETE,{secure:!0,httpOnly:!0});const{visitorId:o}=e.getState().session.metadata;return await e.dispatch(Ik.mergeCartWithVisitorCart(o)),Promise.all([e.dispatch(Yt.getBasket()),e.dispatch(Oc())])}return e.dispatch(Yt.getBasket())},X2t=async({store:e,cartToken:t})=>t?(await e.dispatch(Ik.mergeBasketViaCartToken({cartToken:t})),Promise.all([e.dispatch(Yt.getBasket()),e.dispatch(Oc())])):Promise.resolve();yoe.fetchData=async({context:e})=>{const{store:t}=e,n=t.getState(),{cartToken:o}=ps.parse(n?.router?.location?.search),r=U2t(n),a=[t.dispatch(M8(At(n),r))];if(a.push(z2t(n)?e.urqlClient.query(Yne,{}):t.dispatch(k8())),Xe(n)){a.push(Q2t(e));const i=xr(n);a.push(t.dispatch(XH(i))),B2t(n)&&a.push(t.dispatch(yd.getCustomerLoyalty())),w5(n)&&a.push(t.dispatch(_T.fetchFailedOrderPayments())),q2t(n)&&a.push(t.dispatch(cI.getCouponsCount())),a.push(CL.fetchInstantShopAvailability()(t.dispatch,t.getState)),K2t(n)&&a.push(t.dispatch($ne())),a.push(t.dispatch(xs.getCurrentCustomer()))}else a.push(t.dispatch(Yt.getBasket()));return a.push(X2t({store:t,cartToken:o})),goe(n)&&(YA(n)&&a.push(t.dispatch(Mp.getContentBlocks(r))),Eoe(n)&&hoe(n)&&!YA(n)&&a.push(t.dispatch(Mp.getContentBlocks(r)))),Y2t(n)&&a.push(t.dispatch(jh.getComposableNavbar())),Promise.all(a)};const Z2t=D("ald.m"),J2t=D("tp"),eWt=D("tp.new"),tWt=D("cmpnb"),sWt=D("sl.c"),Ioe=D("cf.cb.ip"),nWt=D("cf.cb.ip.seg"),oWt=D("seo.rdbl"),Soe=()=>{const e=yH(),t=f(Xe),n=f(J2t),o=f(eWt),r=f(Z2t),a=f(Ioe),i=f(nWt),l=Ne();p3(),h.useEffect(()=>{if(!e){const d=new Error(`empty content alert triggered when trying to access ${l.pathname}.`);Ue.api.pushError(d)}},[l]);const c=l.pathname==="/checkout/summary"?pl.CHECKOUT_SUMMARY:pl.CHECKOUT_WALK;return s.jsxs(xne,{children:[typeof window=="object"&&s.jsx(Ane,{}),s.jsx(bt,{}),s.jsx(uoe,{variant:c}),s.jsxs(foe,{children:[s.jsx(Pne,{}),a&&s.jsx(Vne,{isSegmentable:i}),s.jsx(UN,{location:l,type:"checkout-main",children:s.jsx(rWt,{outlet:e})}),s.jsx(Wne,{}),s.jsx(Gne,{})]}),s.jsx(poe,{}),r&&s.jsx(kne,{}),n&&t&&s.jsx(Une,{}),o&&!n&&t&&s.jsx(_1t,{}),s.jsx(P4,{})]})};Soe.fetchData=({req:e,context:{store:t}})=>{const n=t.getState(),o=oWt(n),r=[t.dispatch(ndt(e)),t.dispatch(wy.getPendingOrders()),CL.fetchInstantShopAvailability()(t.dispatch),t.dispatch(Oc()),t.dispatch(xs.getCurrentCustomer())],a=xr(n);return a&&(r.push(t.dispatch(XH(a))),sWt(n)&&r.push(t.dispatch($ne()))),tWt(n)&&r.push(t.dispatch(jh.getComposableNavbar())),Ioe(n)&&r.push(t.dispatch(Mp.getContentBlocks(o))),Promise.all(r)};const rWt=({outlet:e})=>s.jsx(moe,{id:"main",className:"salt-m-b--8",children:e}),uh={get OneTrust(){return typeof window<"u"&&(window.Optanon||window.OneTrust)}},aWt=()=>{h.useEffect(()=>{uh.OneTrust&&uh.OneTrust.initializeCookiePolicyHtml()},[uh.OneTrust]);const e=()=>uh.OneTrust&&uh.OneTrust.ToggleInfoDisplay();return s.jsx(V,{fixed:!0,className:"salt-m-y--16 salt-p-x--4",children:s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(bt,{title:"cookie.policy.page.title"}),s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"cookie.policy.title"})}),s.jsx("p",{className:"salt-m-t--4",children:s.jsx(b,{id:"cookie.policy.cookie.description"})}),s.jsxs("div",{className:"salt-m-t--4",children:[s.jsx(b,{id:"cookie.policy.purpose.intro"}),s.jsx("br",{}),s.jsx(b,{id:"cookie.policy.purpose"})]}),s.jsxs("p",{className:"salt-m-t--4",children:[s.jsx(b,{id:"cookie.policy.list.intro"}),s.jsx("br",{}),s.jsx(b,{id:"cookie.policy.button.intro"})]}),s.jsx(x,{id:"ot-sdk-btn",intent:"primary",onClick:e,className:"salt-m-t--4",children:s.jsx(x.Text,{children:s.jsx(b,{id:"cookie.policy.button"})})}),s.jsx("div",{className:"salt-m-t--8",children:s.jsx("div",{id:"ot-sdk-cookie-policy"})})]})})},iWt=e=>s.jsx(Et,{type:"CookiePolicy::route",children:s.jsx(aWt,{...e})}),lWt=e=>[{path:"/cookie-policy",Component:e.Main,key:"main",children:[{index:!0,Component:as(t=>vv(t)&&!!t.retailerSettings["cookies-onetrust-domain"],iWt,ot)}]}],cWt=v.div`
    position: absolute;
    inset-inline-end: var(--salt-spacing-2);
    inset-block-start: var(--salt-spacing-2);
`,dWt=v.div`
    position: relative;
`,uWt=v.div`
    background: var(--intent-secondary-100);
    border-radius: var(--salt-radius-default);
    flex: 1;
`,pWt=e=>{const{getCloseRef:t}=e,n=()=>s.jsx(Q,{className:"salt-gap--2",children:e.cards?.map(o=>s.jsxs(uWt,{className:"salt-p--4",children:[s.jsx(O,{size:"l",asChild:!0,className:"salt-d--block salt-p-x-1 salt-m-b--2",bold:!0,children:s.jsx("h3",{children:o.title})}),s.jsx(O,{size:"m",children:o.description})]},o.title))});return s.jsx(dWt,{children:s.jsxs(xe,{id:"onboarding-box","data-test":e["data-test"],className:"salt-m-b--4",children:[s.jsx(cWt,{children:s.jsxs(x,{intent:"tertiary",fill:!1,ref:o=>{t&&t(o)},"data-test":"onboarding-close-icon-desktop",onClick:e.onClose,children:[s.jsx(ie,{children:e.ariaLabels.closeButton}),s.jsx(x.Icon,{name:"close_default"})]})}),s.jsxs(Q,{align:"center",gap:["sm"],children:[s.jsx(pe,{height:24,width:24,name:e.icon,"aria-hidden":"true"}),s.jsx(ee,{as:"h2",children:e.title})]}),s.jsx(O,{className:"salt-m-t--2 salt-m-b--4 salt-d--block",children:e.description}),n()]})})},mWt=v.div`
    background: var(--intent-contrast);
    border-radius: var(--salt-radius-default);
    padding: var(--salt-spacing-4);
`,hWt=v.div`
    position: relative;
`,gWt=v.div`
    position: absolute;
    inset-inline-end: var(--salt-spacing-2);
    inset-block-start: var(--salt-spacing-2);
`,EWt=v.div`
    margin-inline-start: auto;
    inline-size: ${$(30)};
`,fWt=e=>{const{getCloseRef:t}=e,n="tutorialCard",o="launcherCard",r=ft(),a=h.useRef(0),[i,l]=h.useState(!1);let c;const d=E=>{E&&(c=E)},u=()=>s.jsx(Q,{direction:"column",className:"salt-gap--2",children:e.cards?.map(E=>s.jsxs(mWt,{children:[s.jsx(O,{size:"l",asChild:!0,className:"salt-d--block salt-p-x-1 salt-m-b--2",bold:!0,children:s.jsx("h2",{children:E.title})}),s.jsx(O,{size:"m",children:E.description})]},E.title))}),p=()=>s.jsxs(h.Fragment,{children:[s.jsx(pe,{height:24,width:24,name:e.icon,"aria-hidden":"true"}),s.jsx(ee,{as:"h2",children:e.title})]}),g=()=>s.jsx(O,{size:"l",className:"salt-m-t--2 salt-m-b--4 salt-d--block",children:e.description});return h.useEffect(()=>{a.current===0&&e.isOpen&&(r({type:en.LEARN_MORE_BUTTON_IMPRESSION,LOCATION:n}),a.current=1)},[e.isOpen]),h.useEffect(()=>{i&&c&&c.focus()},[i]),s.jsxs(h.Fragment,{children:[e.isOpen&&s.jsx(hWt,{children:s.jsxs(xe,{id:"onboarding-box","data-test":e["data-test"],className:"salt-m-b--4",children:[s.jsx(gWt,{children:s.jsxs(x,{intent:"tertiary",fill:!1,"data-test":"onboarding-close-icon-mobile",onClick:E=>e.onClose(E,o),ref:E=>{t&&t(E)},children:[s.jsx(ie,{children:e.ariaLabels.closeButton}),s.jsx(x.Icon,{name:"close_default"})]})}),s.jsxs(Q,{align:"center",wrap:"nowrap",children:[s.jsx(Q,{gap:["sm"],wrap:"nowrap",children:p()}),s.jsx(EWt,{})]}),g(),s.jsxs(x,{intent:"secondary",fill:!0,className:"salt-p-x--8",onClick:e.onOpen,"data-test":"onboarding-learn-more","aria-expanded":e.isBottomSheetOpen,ref:E=>{d(E)},children:[s.jsx(ie,{children:e.ariaLabels.learnMoreButton}),e.bottomSheetToggleButton]})]})}),s.jsxs(B,{isOpen:e.isBottomSheetOpen,onAfterOpen:()=>{r({type:en.COUPON_ONBOARDING_CARD_IMPRESSION,TYPE:n})},onRequestClose:()=>{l(!0),e.onCloseBottomSheet()},closeMessage:e.ariaLabels.closeButton,asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(Q,{gap:["sm"],wrap:"nowrap",children:p()})}),s.jsxs(B.Body,{"data-test":"onboarding-bottom-sheet-body",className:"salt-p-t--0",children:[g(),u()]})]})]})},yWt=e=>{const t=os({breakpoint:"sm-up"});let n;const o=a=>{a&&(n=a)},r=a=>{a.focus()};return h.useEffect(()=>{e.isLearnMoreClicked&&n&&r(n)},[e.isLearnMoreClicked]),t?s.jsx(fWt,{...e,getCloseRef:o}):e.isOpen&&s.jsx(pWt,{...e,getCloseRef:o})||null},IWt="inset var(--salt-box-box-shadow)",Coe=v.li`
    position: relative;
`,voe=v(Ye)`
    display: flex;
    flex-direction: column;
    gap: var(--salt-spacing-2);
    position: relative;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-4);
    overflow: hidden;
    border-block-start: solid var(--salt-radius-default)
        ${({isSkeleton:e})=>e?"var(--intent-secondary)":"var(--coupon-style, var(--typography-promotion))"};
    block-size: 100%;

    &::before,
    &::after {
        content: '';
        inline-size: ${$(24)};
        block-size: ${$(24)};
        inset-block-start: ${$(30)};
        border-radius: 50%;
        position: absolute;
        box-shadow: ${IWt};
        background-color: var(--background-color);
    }

    &::before {
        inset-inline-start: ${$(-15)};
    }

    &::after {
        inset-inline-end: ${$(-15)};
    }
`,Toe=v.div`
    position: absolute;
    inline-size: ${$(22)};
    block-size: ${$(22)};
    background-color: var(--background-color);
    inset-block-start: calc(${$(31)} + var(--salt-radius-default));
    border-radius: 50%;
    filter: blur(${$(1)});
`,_oe=v(Toe)`
    inset-inline-end: ${$(-15)};
`,boe=v(Toe)`
    inset-inline-start: ${$(-15)};
`,SWt=v(ee).attrs({size:"s",forwardedAs:"span"})`
    color: var(--coupon-style, var(--typography-promotion));
`,CWt=v(O)`
    color: var(--intent-content);
    text-align: end;
`,xoe=v.hr`
    border: none;
    margin: 0;
    border-block-start: ${$(2)} dashed var(--intent-secondary);
`,vWt=v.img`
    inline-size: 100%;
    block-size: 100%;
    border-radius: var(--salt-radius-default);
`,TWt=v(Be)`
    margin-block-start: auto;
`,Aoe=v(Be.Item)`
    inline-size: ${$(50)};
    block-size: ${$(50)};
    margin: 0;

    &:not(:last-child) {
        margin-inline-end: var(--salt-spacing-1);
    }
`,_Wt=({id:e,retailerId:t,href:n,position:o,title:r,couponExpiryDate:a,couponDiscountAmount:i,products:l})=>{const[c,d]=h.useState(4),u=ft(),[p]=Ee(["age.vis"]),g=h.useRef(null);h.useEffect(()=>{const y=()=>{if(g.current){const I=g.current.offsetWidth;if(I>320){c!==5&&d(5);return}if(I<320&&I>256){c!==4&&d(4);return}c!==3&&d(3)}};return y(),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}},[c]),h.useEffect(()=>{if(!g.current)return()=>{};const y=new IntersectionObserver(I=>{I.forEach(S=>{if(S.isIntersecting){u({type:en.GA4_COUPON_IMPRESSION,id:t,name:r,index:o}),u({type:en.COUPON_IMPRESSION,COUPON_NAME:r,COUPON_ID:e,USE_BY_DATE:a,AMOUNT_OFF:i,SEQUENCE:o});const C={event:"view_coupon",id:t,index:o,name:r};te.sendEvent({GA:C,WA:null}),y.unobserve(S.target)}})},{threshold:[.75]});return y.observe(g.current),()=>{y.disconnect()}},[g]);const E=()=>{u({type:en.COUPON_CLICKED,couponId:e}),u({type:en.GA4_COUPON_CLICKED,id:t,name:r,index:o});const y={event:"select_coupon",id:t,index:o,name:r};te.sendEvent({GA:y,WA:null})};return s.jsxs(Coe,{"data-test":"coupon-card",ref:g,children:[s.jsx(xe,{asChild:!0,children:s.jsxs(voe,{isSkeleton:!1,intent:"ghost",href:n,onClick:()=>E(),children:[s.jsxs(Q,{justify:"space-between",align:"center",wrap:"nowrap",gap:["sm"],children:[s.jsx(SWt,{children:s.jsx(b,{id:"coupon.card.title",values:{couponDiscountAmount:i}})}),s.jsx(CWt,{size:"m",children:a&&s.jsx(b,{id:"coupon.card.expiry.date",values:{couponExpiryDate:a}})})]}),s.jsx(xoe,{}),s.jsx(O,{size:"l",asChild:!0,bold:!0,children:s.jsx("h3",{children:r||s.jsx("span",{children:""})})}),s.jsx(TWt,{inline:!0,children:l.slice(0,c).map(y=>{const{image:I,productName:S,restrictedVisibility:C}=y;return s.jsx(Aoe,{children:pp(s.jsx(vWt,{alt:S,src:I.path},I.imageId),p?C:void 0)})})})]})}),s.jsx(_oe,{}),s.jsx(boe,{})]})},bWt=()=>s.jsxs(Coe,{children:[s.jsx(xe,{asChild:!0,children:s.jsxs(voe,{as:"div",isSkeleton:!0,children:[s.jsxs(Q,{justify:"space-between",align:"center",wrap:"nowrap",gap:["sm"],children:[s.jsx(_e,{width:"106px",height:"16px"}),s.jsx(_e,{width:"84px",height:"16px"})]}),s.jsx(xoe,{}),s.jsx(_e,{width:"171px",height:"16px"}),s.jsx(Be,{inline:!0,children:new Array(3).fill(0).map((e,t)=>s.jsx(Aoe,{children:s.jsx(_e,{width:"50px",height:"50px"})},t))})]})}),s.jsx(_oe,{}),s.jsx(boe,{})]}),xWt=v(Be)`
    display: grid;
    grid-auto-rows: max-content;
    max-inline-size: ${$(960)};
    gap: var(--salt-spacing-4);
    inline-size: 100%;

    ${re.smUp`
         grid-template-columns: repeat(2, 1fr);
    `}

    ${re.mdUp`
         grid-template-columns: repeat(3, 1fr);
    `}
`,AWt=v(Q)`
    inline-size: 100%;
    max-inline-size: ${$(960)};
`,RWt=()=>{const e=ft(),t=Ge();return s.jsx(V,{fixed:!0,className:"salt-m-b--16 salt-m-t--16",children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:s.jsx(Os,{title:"coupons.page.no.coupons.found.title",titleIcon:"coupons",description:"coupons.page.no.coupons.found.description",primaryButton:{text:"promotions.button",onClick:()=>{e({type:en.EMPTY_COUPONS_PROMO_BUTTON_CLICKED}),t(di())}}})})})},nx="coupons-onboarding-hidden",DWt=D("seo.ra"),OWt=D("showpromopage"),Roe=D("di"),PWt=()=>{const{formatMessage:e,formatNumber:t}=L(),n=He(),o=F(),r=f(EZe),a=f(yZe),i=f(jN),l=f(fZe),c=f(cr),d=f(Rt),[u,p]=h.useState(!1),[g,E]=h.useState(!1),[y,I]=h.useState(!1),[S,C]=h.useState(!1),T=os({breakpoint:"sm-up"}),_=ft(),A=f(DWt),R=f(OWt),P=f(Roe),N="launcherCard",k="tutorialCard",M=h.useRef(0),w=h.useRef(0);let j;const G=ce=>{ce&&(j=ce)};h.useEffect(()=>{!d&&!l&&o(up.getCouponsPage(P)).catch(ce=>{Ue.api.pushError(ce)})},[]),h.useEffect(()=>{p(!!sessionStorage.getItem(nx)),d||(M.current===0&&!u&&(_({type:en.COUPON_ONBOARDING_CARD_IMPRESSION,TYPE:T?N:k}),M.current=1),w.current===0&&u&&(_({type:en.LEARN_MORE_BUTTON_IMPRESSION,LOCATION:k}),w.current=1)),y&&j&&j.focus()},[u,d,T,y]),h.useEffect(()=>{d||_({type:en.COUPONS_AVAILABLE,COUPONS_AVAILABLE:r.length})},[d]);const W=()=>{T?C(!0):(E(!0),p(!1),sessionStorage.removeItem(nx)),I(!1),_({type:en.LEARN_MORE_BUTTON_CLICKED,LOCATION:k})},H=(ce,me)=>{E(!1),p(!0),sessionStorage.setItem(nx,"true"),_({type:en.ONBOARDING_CARD_CLOSED,TYPE:me||k}),I(!0)},K=()=>{C(!1),I(!0),_({type:en.ONBOARDING_CARD_CLOSED,TYPE:k})},X=ce=>{let me="";return ce.percent&&(me=t(ce.percent,{style:"percent",maximumFractionDigits:2})),ce.cash&&(me=n(ce.cash)),me},q=[{title:e("coupons.page.onboarding.subsection.1.title"),description:e("coupons.page.onboarding.subsection.1.description")},{title:e("coupons.page.onboarding.subsection.2.title"),description:e("coupons.page.onboarding.subsection.2.description")},{title:e("coupons.page.onboarding.subsection.3.title"),description:e("coupons.page.onboarding.subsection.3.description")}],ne=e("coupons.page.onboarding.title"),ue=e("coupons.page.onboarding.description"),oe=e("coupons.page.onboarding.button"),ye=`${e("coupons.page.onboarding.close.button.accessibility")}  ${ne}`,he=e("coupons.page.onboarding.button.accessibility"),Ie={title:ne,description:ue,cards:q,icon:"coupons","data-test":"onboarding-component",ariaLabels:{closeButton:ye,learnMoreButton:he},bottomSheetToggleButton:oe,onClose:H,onOpen:W,isOpen:!u,isLearnMoreClicked:g,isBottomSheetOpen:S,onCloseBottomSheet:K},Fe=ce=>{ce==="PROMOTIONS"&&_({type:en.PROMOTIONS_TAB_CLICKED})},be=()=>r.map((ce,me)=>{const{id:De,retailerPromoId:ge,description:Se,couponName:Ae,products:Ce,reward:We,activePeriod:{activeTo:et}}=ce,ve=A?ge:De,lt=Cn(Se);return s.jsx(_Wt,{id:ve,retailerId:ge,position:me,href:QE(ve,lt??""),couponDiscountAmount:X(We),couponExpiryDate:et?qs(c,et):"",title:Ae??"",products:Ce},ve)});return!l&&a?s.jsx(jn,{showRefreshLink:!0}):s.jsxs(h.Fragment,{children:[R&&s.jsx(kee,{activeTabType:"COUPONS",onTabClick:ce=>Fe(ce)}),s.jsx(bt,{title:"coupons.page.title"}),s.jsx(Q,{direction:"column",align:"center",className:"salt-p-x--2",children:r.length===0?s.jsx(RWt,{}):s.jsxs(h.Fragment,{children:[s.jsxs(AWt,{"data-test":"coupons-header",direction:"column",children:[s.jsx(ie,{asChild:!0,children:s.jsx("h1",{children:s.jsx(b,{id:"coupons.page.title"})})}),s.jsxs(Q,{direction:"column",justify:"space-between",gap:["md"],className:"salt-m-y--4",directionSmUp:"row",children:[s.jsx(ee,{"data-test":"coupons-title",as:"h2",children:s.jsx(b,{id:i>1?"coupons.page.header.plural":"coupons.page.header",values:{numberOfCoupons:i}})}),u&&!d&&s.jsx(x,{ref:ce=>{G(ce)},intent:"secondary",size:"s",onClick:W,"data-test":"onboarding-learn-more","aria-expanded":!u,"aria-controls":"onboarding-box","aria-label":he,children:oe})]}),!d&&s.jsx(yWt,{...Ie})]}),s.jsx(xWt,{children:l&&r.length===0?new Array(6).fill(0).map((ce,me)=>s.jsx(bWt,{},me)):be()})]})})]})},Doe=()=>s.jsx(Et,{type:"CouponsPage::route",children:s.jsx(PWt,{})});Doe.fetchData=async({context:{store:e}})=>{const t=e.getState(),n=Roe(t);return await e.dispatch(up.getCouponsPage(n)),Promise.resolve()};const qA=(e,t,n)=>(o,r)=>{const a=r(),i=D("di"),l=Hn(a);return o(lZe(e,t,i(a),l,n)).then(c=>{const{promotionGroups:d}=c?.payload.responseData||{},u=d.reduce((p,g)=>(g.products.forEach(E=>{p[E.productId]=si(E,l,i(a))}),p),{});Object.keys(u).length>0&&o(xt.setProducts({product:u}))})},NWt=({sortOptions:e,activeOption:t,sortHandler:n})=>s.jsxs(h.Fragment,{children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(kk,{options:e,sortHandler:n,selectedId:t})}),s.jsx(Lt,{breakpoint:"sm-up",children:s.jsx(jk,{options:e,sortHandler:n,selectedId:t})})]}),Ooe=D("seo.ra"),LWt=D("dso"),kWt=()=>{const e=Ne(),t=Ge(),n=nn(),o=L(),r=F(),a=f(jQ),i=f(ts),l=f(pZe),c=f(Rt),d=f(Ooe),u=f(LWt),p=Qe.parse(e.search)?.sortBy;let g=a?.sortOptions.find(I=>I.selected)?.id||"";typeof p=="string"&&(g=p),h.useEffect(()=>{!c&&!l&&r(qA(n.couponId,d,u?p:g)).catch(I=>{Ue.api.pushError(I)})},[]);const E=I=>{if(!I)return;const S=Qe.stringify({sortBy:I.id}),C=`${e.pathname}?${S}`;e.pathname!==C&&(t(C),r(qA(n.couponId,d,I.id)))};return(d?a?.retailerPromotionId:a?.promoId)===n.couponId?s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"coupon.details.page.title",values:{couponDescription:a.description,separator:o.formatMessage("page.title.separator")}}),s.jsxs(Q,{gap:["md"],direction:"column",className:"salt-p--4",align:"flex-start",children:[s.jsx(rm,{trail:[{name:o.formatMessage("coupons.page.title"),url:zE()},{name:a.description}],linkElement:Ye}),s.jsx(O,{children:a.longDescription}),s.jsx(NWt,{sortOptions:a.sortOptions,activeOption:g,sortHandler:E}),s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx(uo,{productsByProductId:i,productGroups:a.promotionGroups,page:"coupon-details",type:"catalogue",isFetching:l,noOfferLink:!0,withoutHeader:!0})]})]}):s.jsx(uo,{productsByProductId:{},productGroups:[],page:"coupon-details",type:"catalogue",isFetching:l,noOfferLink:!0,withoutHeader:!0})},Poe=()=>s.jsx(Et,{type:"CouponDetails::route",children:s.jsx(kWt,{})});Poe.fetchData=async({context:{store:e,url:t},params:n})=>{const o=e.getState(),r=t.searchParams.get("sortBy")??"",a=t.search.replace("?",""),i=n.couponId,l=Ooe(o);if(l){await e.dispatch(async E=>E(cZe(i)));const c=e.getState(),{promoId:d,retailerPromotionId:u,description:p}=jQ(c);if(i===d&&!!u){const E=At(c),y=QE(u,p,{basePath:E,queryString:a});return Promise.resolve({redirectTo:y,statusCode:IH})}}return await e.dispatch(qA(i,l,r)),Promise.resolve()};const B$=D("cp"),jWt=e=>[{path:"/coupons",Component:e.Main,key:"main",children:[{index:!0,Component:$s(Xe,as(B$,Doe,ot))},{path:"/coupons/:couponDescription/:couponId",Component:$s(Xe,as(B$,Poe,ot))}]}],KA=e=>s.jsxs("option",{"data-test":"address-dropdown-element",value:e.deliveryDestinationId,disabled:!Dl(e),children:[e.name," - ",e.formattedAddress]},e.deliveryDestinationId),MWt=(e,t)=>e.find(n=>n.deliveryDestinationId===t?.deliveryDestinationId),wWt=(e,t)=>e.find(n=>n.deliveryDestinationId===t?.deliveryDestinationId),FWt=e=>e.filter(t=>Dl(t)),Noe=e=>e.data?.coordinates,Loe=(e,t)=>t?e.sort((n,o)=>aA(n.coordinates,t)-aA(o.coordinates,t)):e,BWt=se("GET_SLOT_BOOKING_PAGE_ADVERTS"),UWt=()=>({type:"API",payload:{url:"/v1/content?page=SLOT_BOOKING",...BWt}}),koe=({data:e})=>e.delivery.charges.smallOrderChargeThresholds,GWt=D("sl.cut"),iM=({latestUpdateTime:e,className:t})=>{const n=f(Zt),o=f(gm),r=f(Mt);if(!f(GWt))return null;const i=s.jsx(Gl,{dateIso:e,timeZoneId:o,timeFormat:r,dateFormat:n,local:!0});return s.jsx(Te,{intent:"info",showIcon:!1,className:t,text:e?s.jsx(b,{id:"order.details.heading.future.edit.until",values:{editUntilDate:i}}):s.jsx(b,{id:"slotbooking.booked.slot.no.cutoff"})})},$Wt=({slotbookingLocation:e,orderId:t,slotBookedQuery:n})=>{switch(e){case Sn.CHECKOUT_WALK:return na({queryString:n});case Sn.EDIT_ORDER:return cn(t,n);case Sn.BASKET_SPLIT_TRIGGERED:return jt();default:return fn({queryString:n})}},joe=(e,t)=>async(n,o)=>{const{slotbookingLocation:r,slotBookedQuery:a,orderId:i}=e,l=o(),c=Fct(l),d=D("mins")(l),u=PP(l),p=MR(l),g=c?nP:"",E=new URLSearchParams(a||g);if(d&&u&&E.append("min-spend-changed","true"),r===Sn.EDIT_ORDER){if(p){E.append("error","below-minimum-spend");const{shippingGroupType:y}=l.data.basket.checkout;y&&E.append("errorShippingGroupType",y)}return t(cn(i,E.toString()),{state:{fromSlotBooking:!0}})}if(r===Sn.CHECKOUT_WALK){const{canCheckout:y,redirect:I}=await n(lf());if(!y)return t(I)}return t($Wt({...e,slotBookedQuery:E.toString()}),{state:{fromSlotBooking:!0}})},HWt=(e,t,n)=>async(o,r)=>{const a=r(),i=Ct(a),l=Ov(a),c=um(a),d=Po(a),u=vn(a);try{await o(WP.confirmSlot({draftBasketId:l,shippingGroupType:c,deliveryDestinationId:d,regionId:u})),await o(Yt.getBasket()),await o(joe({slotbookingLocation:t,orderId:i,slotBookedQuery:n},e))}catch(p){throw Z.error("request.error.title"),p}},Wd={handleCheckoutRedirect:joe,confirmSlot:HWt},VWt=D("md.sl"),GS="slotbooking-confirm-modal-header";class WWt extends h.Component{formattedMessages;constructor(t){super(t);const{intl:n,basketThresholdForSelectedSlot:o,currencyFormat:r}=t;this.confirm=this.confirm.bind(this);const a=Lv(n);this.formattedMessages={title:n.formatMessage("logged.in.home.page.book.slot.card.title.slot.booked"),onDemandSlotInfo:n.formatMessage("slotbooking.modal.confirm.express.collection.slot.description"),deliveryTimeInMinutes:a(this.props.slotDeliveryTimeInMinutes),collectionTimeInMinutes:a(this.props.slotCollectionTimeInMinutes),changeSlot:n.formatMessage("slotbooking.modal.confirm.change.slot.link"),confirmButton:n.formatMessage("slotbooking.modal.confirm.button"),confirmButtonCompleteText:n.formatMessage("slotbooking.modal.confirm.button.complete.text"),checkoutButton:n.formatMessage("slotbooking.modal.checkout.button"),minimum:n.formatMessage("slotbooking.modal.confirm.reserved.minimum.order",{amount:o?ii(n.formatNumber,o,r):""})}}componentDidMount(){const{actions:t}=this.props;t.performanceMark({name:HY}),t.sendAnalyticsEvent({type:Ve.SLOT_BOOKING_MODAL_DISPLAYED,hasOutOfStock:!1})}confirm(){const{slotbookingLocation:t,actions:n,orderId:o}=this.props;t===Sn.CHECKOUT_WALK&&n.sendAnalyticsEvent({type:Zn.CHECKOUT_WALK}),n.closeModal(),n.handleCheckoutRedirect({slotbookingLocation:t,orderId:o},this.props.navigate)}isOnDemandSlot(){const{isMultidaySlotsEnabled:t,slotType:n,startTime:o,endTime:r,deliveryMethod:a}=this.props;return n==="ON_DEMAND"?!0:su({slotType:n,deliveryMethod:a,start:o,end:r},t)}getIconName(){return this.isOnDemandSlot()?"express_collect":this.props.deliveryType===pt.clickAndCollect.type?"click_collect":"home_delivery"}getStandardSlotTimeInfo(){const{dateFormat:t,startTime:n,endTime:o,timeZoneId:r,timeFormat:a}=this.props;return s.jsx(O,{bold:!0,size:"l",className:"salt-m-b--1",children:s.jsx(qn,{dateIsoFrom:n,dateIsoTo:o,timeZoneId:r,dateFormat:t,timeFormat:a})})}getExpressCollectionSlotTimeInfo(){return s.jsx(O,{bold:!0,size:"l",className:"salt-m-b--1",children:s.jsx(b,{id:"slotbooking.modal.confirm.express.collection.slot.description",values:{readyTimeSpan:this.formattedMessages.deliveryTimeInMinutes,maxTimeSpan:this.formattedMessages.collectionTimeInMinutes}})})}getSlotTimeInfo(){return this.props.slotType==="ON_DEMAND"?this.getExpressCollectionSlotTimeInfo():this.getStandardSlotTimeInfo()}render(){const{onCloseModal:t,timeZoneId:n,slotbookingLocation:o,selectedAddress:r,timeFormat:a,expiryDate:i,latestUpdateTime:l}=this.props,{formattedMessages:c}=this,d=o===Sn.CHECKOUT_WALK,u=s.jsx(Cl,{dateIso:i,timeZoneId:n,timeFormat:a,local:!0});return s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:"left","aria-live":"polite",children:s.jsx(ee,{as:"h1",id:GS,children:c.title})},"header"),s.jsxs(B.Body,{children:[s.jsxs(O,{className:"salt-m-b--4",size:"l","data-pii":"true",children:[s.jsxs(Q,{gap:["sm"],wrap:"nowrap",children:[s.jsx(pe,{name:this.getIconName()}),this.getSlotTimeInfo()]}),r&&s.jsxs(h.Fragment,{children:[r.nickname," - ",r.address,r.additionalInformation&&s.jsx(O,{"data-pii":"true",children:r.additionalInformation})]})]}),s.jsx(Te,{intent:"warning",showIcon:!1,className:"salt-m-t--2",text:s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.booked.alert.text",values:{expiryTime:u}})," ",`(${c.minimum})`]})}),s.jsx(iM,{className:"salt-m-t--2",latestUpdateTime:l})]},"body"),s.jsxs(B.Footer,{align:"left",children:[s.jsx(x,{className:"salt-m-r--1",onClick:t,intent:"secondary",fill:!0,children:s.jsx(x.Text,{children:c.changeSlot})}),s.jsx(x,{className:"salt-m-l--1",onClick:this.confirm,intent:"primary",fill:!0,"data-synthetics":"confirm-slot","aria-label":d?c.checkoutButton:c.confirmButtonCompleteText,children:s.jsx(x.Text,{children:d?c.checkoutButton:c.confirmButton})})]},"footer")]})}}const YWt=e=>({dateFormat:Zt(e),deliveryType:g2e(e),deliveryMethod:U4(e),basketThresholdForSelectedSlot:NE(e),expiryDate:RP(e),selectedAddress:Pv(e),slotType:Rv(e),slotDeliveryTimeInMinutes:G4(e),slotCollectionTimeInMinutes:$4(e),startTime:Av(e),endTime:Dv(e),timeZoneId:gm(e),timeFormat:Mt(e),orderId:Ct(e),latestUpdateTime:DP(e),isMultidaySlotsEnabled:VWt(e),currencyFormat:Bi(e)}),qWt=st({closeModal:J.closeModal,getCheckoutWalk:FL,performanceMark:ds,sendAnalyticsEvent:U.analyticsEvent,handleCheckoutRedirect:Wd.handleCheckoutRedirect}),KWt=Tt(Ht,we(YWt,qWt))(WWt),lM=()=>{const{formatMessage:e}=L();return s.jsx(Te,{showIcon:!1,intent:"warning",text:e("settings.delivery.pass.region.no-delivery-pass-offer"),"data-test":"non-deliverable-alert"})};function zWt(){const e=F();return{customerAddresses:f(cu),fetchCustomerAddresses:()=>e(eo.getCustomerAddresses())}}function QWt(e){return{withCustomerAddresses:t=>{const n=t.filter(o=>o.deliverability==="DELIVERABLE").map(o=>o.addressId);return e.map(o=>({...o,addresses:o.addresses.filter(r=>n.includes(r.addressId))})).filter(o=>o.addresses.length>0)}}}function XWt(e){return{withCustomerAddresses:t=>{const n=t.filter(o=>o.deliverability==="DELIVERABLE").map(o=>o.addressId);return e.filter(o=>o.deliveryAddresses.some(r=>n.includes(r.addressId)))}}}function ZWt(){const{isSubscriptionEnabled:e}=No(),t=Qr.client.useHooks().getComputedState(),n=Qr.client.useHooks().fetch,o=Xr.client.useHooks().getComputedState(),r=Xr.client.useHooks().fetch,{customerAddresses:a,fetchCustomerAddresses:i}=zWt();if(h.useEffect(()=>{e&&(t.lastUpdated===null&&!t.isFetching&&n(),o.lastUpdated===null&&!o.isFetching&&r(),a.lastUpdated===null&&!a.isFetching&&i())},[e,o,a,t]),!(!e||!t.lastUpdated||!a.lastUpdated||!o.lastUpdated||t.fetchError||a.fetchError||o.fetchError||a.isFetching||t.isFetching||o.isFetching))return{customerSubscriptionsInTheCurrentStore:XWt(t.data??[]).withCustomerAddresses(a.data),benefitGroupAddressesInTheCurrentStore:QWt(o.data).withCustomerAddresses(a.data)}}function JWt(e,{selectedDeliveryAddressId:t,selectedDeliveryAddress:n}){return e.find(o=>o.addresses?.find(({addressId:r})=>r===(t??n?.addressId)))}const eYt=()=>{const e=F();return t=>e(uu.getDeliveryPassBenefits({benefitGroupId:t}))};function tYt({benefitGroupAddressesInTheCurrentStore:e,selectedDeliveryAddressInfo:t}){const n=eYt(),o=Ln.client.useHooks().getComputedState(),r=t.selectedDeliveryAddress||t.selectedDeliveryAddressId;return h.useEffect(()=>{if(e&&e.length>0&&!o.data&&!o.isFetching)if(e.length===1)n(e[0].benefitGroupId);else if(r){const a=JWt(e,t);a?.benefitGroupId&&n(a?.benefitGroupId)}else n(e[0].benefitGroupId)},[e,r,o,t,n]),o}const Pf=Y(Ys,ru,Rl,(e,t,n)=>e===pt.clickAndCollect.method?t?.data:n?.data);function sYt(){const t=((o,r)=>{if(r!==void 0)return Object.values(o).find(a=>a.deliveryDestinationId===r)})(f(Pf),f(Po)),n=f(J8);return{selectedDeliveryAddress:t,selectedDeliveryAddressId:n}}function nYt(e){return{filterWithSelectedDeliveryAddress:({selectedDeliveryAddress:t,selectedDeliveryAddressId:n})=>{if(e.length===0)return;const o=e.find(r=>r.deliveryAddresses.find(a=>a.addressId===n||a.addressId===t?.addressId));if(o)return o;if(e.length>0)return e[0]}}}function U$(e){return`${Lc()}?benefitGroupId=${e}`}function oYt(e){return!(e.isFetching||e.fetchError||e.error)}function cM(){const{isSubscriptionEnabled:e,isFreeTrialEnabled:t}=No(),n=ZWt(),{benefitGroupAddressesInTheCurrentStore:o=[],customerSubscriptionsInTheCurrentStore:r=[]}=n??{},a=sYt(),i=tYt({benefitGroupAddressesInTheCurrentStore:o,selectedDeliveryAddressInfo:a});if(!e||!n||!oYt(i))return;const l=r.length>0,c=nYt(r).filterWithSelectedDeliveryAddress(a);return{customerSubscriptionsInTheCurrentStore:r,isUserSubscribedInTheStore:l,youAreEnjoying:c?{...c,path:U$(c.customerSubscription.benefitGroup.benefitGroupId)}:void 0,tryDeliveryPass:i.data?{path:U$(i.data.benefitGroupId),message:i.data.advertisementMessage,benefitGroup:{...i.data,canFreeTrial:t&&i.metadata.isFreeTrial&&!l}}:void 0}}const rYt=e=>t=>e(U.analyticsEvent({type:Xn.DELIVERY_PASS_SUBSCRIBED_PLAN_MODAL_DISPLAYED,userAction:t})),aYt=e=>({pageEventId:t,benefitGroupId:n})=>{e(U.analyticsEvent({type:bs.BENEFIT_GROUP_SELECTED,description:"User selected benefit group to display available subscriptions",pageEventId:t,pageEventAttributes:{type:"benefitGroupId",value:n}}))},iYt=e=>t=>e(U.analyticsEvent({type:bs.SELECTED_DELIVERY_PASS_PLAN_MODAL_DISPLAYED,userAction:t})),lYt=e=>({isFreeTrialEligible:t,isManageDeliveryPass:n})=>e(U.analyticsEvent({type:bs.DELIVERY_PASS_BUTTON_CLICKED,isFreeTrialEligible:t,isManageDeliveryPass:n})),cYt=e=>t=>{e(U.analyticsEvent({type:bs.ADD_DELIVERY_ADDRESS_SELECTED,description:"User clicked add another address",pageEventId:t}))},dYt=e=>({plan:t,benefitGroupId:n})=>e(U.analyticsEvent({type:bs.DELIVERY_PASS_SUBSCRIPTION_STARTED,plan:t,deliveryPassBenefitGroupId:n})),uYt=e=>()=>e(U.analyticsEvent({type:bs.DELIVERY_PASS_TERMS_CONDITIONS_CLICKED})),pYt=e=>({plan:t,deliveryPassBenefitGroupId:n,analyticsEvent:o})=>{const r=o??U.analyticsEvent;e(r({type:bs.DELIVERY_PASS_PLAN_SEEN,plan:t,deliveryPassBenefitGroupId:n}))},mYt=e=>t=>{e({type:bs.DELIVERY_PASS_SIGN_UP,payload:t});const n={event:"delivery_pass_sign_up",id:t.retailerSubscriptionPlanId,price:t.price,currency:t.currency};te.sendEvent({GA:n,WA:null})},hYt=e=>t=>{e({type:bs.DELIVERY_PASS_CANCEL_AUTO_RENEW,payload:t});const n={event:"delivery_pass_cancel_auto_renew",id:t.retailerSubscriptionPlanId,price:t.price,currency:t.currency};te.sendEvent({GA:n,WA:null})},gYt=e=>t=>{e({type:bs.DELIVERY_PASS_ENABLE_AUTO_RENEW,payload:t});const n={event:"delivery_pass_enable_auto_renew",id:t.retailerSubscriptionPlanId,price:t.price,currency:t.currency};te.sendEvent({GA:n,WA:null})},EYt=e=>({subscriptionId:t,retailerSubscriptionPlanId:n,buttonLabel:o})=>e(U.analyticsEvent({type:bs.FREE_TRIAL_BUTTON_CLICKED,buttonName:"Free trial",subscriptionId:t,retailerSubscriptionPlanId:n,buttonLabel:o}));function ja(){const e=F();return h.useMemo(()=>({deliveryPassButtonClicked:lYt(e),addAddressClicked:cYt(e),selectBenefitGroupClicked:aYt(e),deliveryPassSubscriptionStarted:dYt(e),selectedDeliveryPassPlanModalDisplayedEvent:iYt(e),termsAndConditionsClicked:uYt(e),deliveryPassPlanSeen:pYt(e),deliveryPassSignUp:mYt(e),deliveryPassCancelAutoRenew:hYt(e),deliveryPassEnableAutoRenew:gYt(e),freeTrialButtonClicked:EYt(e),deliveryPassSubscribedPlanModalDisplayed:rYt(e)}),[e])}const fYt=({benefit:e,onClick:t,date:n})=>s.jsx(Te,{className:"salt-m-b--2",intent:"success","data-test":"autorenewal-enabled-alert",text:s.jsx(b,{id:"subscription.delivery.pass.auto.renew.on.message",values:{pass:`${e.name} - ${e.description}`,expiryDate:n}}),link:s.jsx(Te.Link,{"data-test":"message-renew-on",onClick:t,to:ar(),children:s.jsx(b,{id:"delivery.pass.settings.link.label"})})}),yYt=({onClick:e,type:t,benefit:n,date:o})=>s.jsx(Te,{className:"salt-m-b--2",intent:t,"data-test":`autorenewal-disabled-alert-${t}`,text:s.jsx(b,{id:"subscription.delivery.pass.auto.renew.off.message",values:{pass:`${n.name} - ${n.description}`,expiryDate:o}}),link:s.jsx(Te.Link,{to:ar(),onClick:e,"data-test":"message-renew-off",children:s.jsx(b,{id:"delivery.pass.settings.link.label"})})}),IYt=({date:e,benefit:t})=>s.jsx(Te,{className:"salt-m-b--2",intent:"warning","data-test":"autorenewal-enabled-alert",text:s.jsx(b,{id:"settings.delivery.pass.auto.switch.on.message",values:{passName:`${t.name} - ${t.description}`,transitioningDate:e}}),link:s.jsx(Te.Link,{to:ar(),children:s.jsx(b,{id:"settings.delivery.pass.auto.switch.on.link.label"})})}),SYt=()=>s.jsx(Te,{className:"salt-m-b--2",intent:"warning",text:s.jsx(b,{id:"subscription.alert.deliverypass.pending.message"})}),CYt="subscription-messages";function vYt({status:e,autoRenewalStatus:t,nextRenewal:n},o){return e==="PENDING"?"PENDING":e==="ACTIVE"?t?o&&n.planIsTransitioning?"SWITCH_ON":"RENEW_ON":"RENEW_OFF":"NA"}function TYt({deliveryPassAnalyticsEvent:e,subscription:t,benefit:n,dateFormat:o,isSubscriptionPlanTransitionEnabled:r}){const{subscriptionId:a}=t,i=()=>gt(t.expiry,o);switch(vYt(t,r)){case"PENDING":return s.jsx(SYt,{},a);case"SWITCH_ON":return s.jsx(IYt,{benefit:n,date:i()},a);case"RENEW_ON":return s.jsx(fYt,{onClick:()=>e({isManageDeliveryPass:!0}),date:i(),benefit:n},a);case"RENEW_OFF":return s.jsx(yYt,{onClick:()=>e({isManageDeliveryPass:!0}),date:i(),benefit:n,type:r?"error":"warning"},a);case"NA":default:return null}}function _Yt({dateFormat:e,isSubscriptionPlanTransitionEnabled:t,deliveryPassAnalyticsEvent:n,subscriptions:o}){const r=o.map(({subscription:a,benefit:i})=>TYt({deliveryPassAnalyticsEvent:n,subscription:a,benefit:i,dateFormat:e,isSubscriptionPlanTransitionEnabled:t})).filter(a=>a!==null);return r.length?s.jsx("div",{"data-test":CYt,children:r}):null}function bYt({subscriptions:e}){const t=f(cr),n=Ln.client.useHooks().getComputedState().metadata.isFreeTrial,{isSubscriptionPlanTransitionEnabled:o}=No(),{deliveryPassButtonClicked:r}=ja(),a=({isManageDeliveryPass:i})=>{r({isFreeTrialEligible:n,isManageDeliveryPass:i})};return s.jsx(_Yt,{deliveryPassAnalyticsEvent:a,dateFormat:t,isSubscriptionPlanTransitionEnabled:o,subscriptions:e})}function Moe(){const e=F(),t=Ln.client.useHooks().getComputedState().metadata.isFreeTrial;return()=>{e(U.analyticsEvent({type:bs.DELIVERY_PASS_BUTTON_CLICKED,isFreeTrialEligible:t,isManageDeliveryPass:!1}))}}const xYt=({message:e,to:t,onClick:n})=>s.jsx(Te,{className:"salt-m-b--2",intent:"action",text:e,link:s.jsx(Te.Link,{"data-test":"subscription-link",to:t,onClick:n,children:s.jsx(b,{id:"subscription.alert.deliverypass.available.link"})})});function AYt(){const e=cM(),t=Moe();if(e){if(e.isUserSubscribedInTheStore)return s.jsx(bYt,{subscriptions:e.customerSubscriptionsInTheCurrentStore.map(n=>n.customerSubscription)});if(e.tryDeliveryPass)return s.jsx(xYt,{onClick:t,message:e.tryDeliveryPass.message,to:e.tryDeliveryPass.path})}return null}function RYt({title:e,description:t,to:n}){const o=Moe();return s.jsx("div",{children:s.jsx(vs,{"data-testid":"delivery_pass_card",onClick:o,className:"salt-m-t--4",icon:"delivery_pass",title:{as:"h3",text:e},description:s.jsx(O,{children:t}),to:n})})}function DYt({isUserSubscribedInTheStore:e,tryDeliveryPassBenefitGroup:t}){return e?"HAS_SUBSCRIPTION_IN_THE_CURRENT_STORE":t?t.canFreeTrial?"ELIGIBLE_FOR_FREE_TRIAL":"NOT_ELIGIBLE_FOR_FREE_TRIAL":"ERROR_NO_DELIVERY_PASS_IN_THE_CURRENT_STORE"}function OYt({subscriptionMessageType:e,youAreEnjoyingBenefit:t,to:n}){const o=r=>s.jsx(RYt,{...r});switch(e){case"HAS_SUBSCRIPTION_IN_THE_CURRENT_STORE":return o({title:s.jsx(b,{id:"delivery.pass.card.title.active",values:{name:t?.name??""}}),description:t?.description??"",to:n});case"ELIGIBLE_FOR_FREE_TRIAL":return o({title:s.jsx(b,{id:"delivery-pass.not-active.card-title"}),description:s.jsx(b,{id:"delivery.pass.card.subtitle.not.active.trial.eligible"}),to:n});case"NOT_ELIGIBLE_FOR_FREE_TRIAL":return o({title:s.jsx(b,{id:"delivery-pass.not-active.card-title"}),description:s.jsx(b,{id:"delivery.pass.card.subtitle.not.active"}),to:n});case"ERROR_NO_DELIVERY_PASS_IN_THE_CURRENT_STORE":default:return null}}const dM=()=>{const e=cM();if(!e)return null;const t=DYt({isUserSubscribedInTheStore:e.isUserSubscribedInTheStore,tryDeliveryPassBenefitGroup:e.tryDeliveryPass?.benefitGroup});return OYt({subscriptionMessageType:t,youAreEnjoyingBenefit:e.youAreEnjoying?.customerSubscription?.benefit,to:t==="HAS_SUBSCRIPTION_IN_THE_CURRENT_STORE"?e.youAreEnjoying?.path:e.tryDeliveryPass?.path})};dM.usePreloadData=cM;const PYt=()=>{const e=f(PP),t=f(NE),n=f(D("misbc")),o=f(D("mins")),r=qk();return e&&n&&o&&t?r(t):null},NYt=()=>{const e=PYt();return e?s.jsx(b,{id:"minimum.order.amount.on.slot.booking",values:{amount:e}}):null},LYt=()=>{const e=f(Av),t=f(Dv),n=f(gm),o=f(Mt),r=f(Zt);return s.jsx(qn,{dateIsoFrom:e,dateIsoTo:t,timeZoneId:n,dateFormat:r,timeFormat:o})},kYt=()=>{const e=f(Pv);return s.jsx(b,{id:"logged.in.home.page.book.slot.card.subtitle.slot.and.address.format",values:{interval:s.jsx(LYt,{}),address:e?.nickname}})},jYt=()=>{const e=f(Rv),t=f(Pv);return e==="ON_DEMAND"?t?.nickname:s.jsx(kYt,{})},MYt=()=>{const e=f(RP),t=f(gm),n=f(Mt);return s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.booked.alert.text",values:{expiryTime:s.jsx(Cl,{dateIso:e,timeZoneId:t,timeFormat:n,local:!0})}})},wYt=()=>{const e=He(),t=f(E2e),o=f(f2e)?s.jsx(pe,{name:"eco_slot",success:!0}):null;return t?s.jsxs(Q,{gap:["sm"],wrap:"nowrap",justify:"space-between",align:"center",children:[s.jsxs(O,{size:"l",children:[" ",e(t)," "]}),o]}):null},FYt=D("sl.cut"),BYt=()=>{const e=f(DP),t=f(Zt),n=f(gm),o=f(Mt);if(!f(FYt))return null;const a=s.jsx(Gl,{dateIso:e,timeZoneId:n,timeFormat:o,dateFormat:t,local:!0});return e?s.jsx(b,{id:"order.details.heading.future.edit.until",values:{editUntilDate:a}}):s.jsx(b,{id:"slotbooking.booked.slot.no.cutoff"})},UYt=()=>{const e=Zi(),t=f(Rv),n=f(G4),o=f($4);return t==="ON_DEMAND"?s.jsx("div",{className:"salt-p-t--4",children:s.jsx(O,{children:s.jsx(b,{id:"slotbooking.modal.confirm.express.collection.slot.description",values:{readyTimeSpan:e(n),maxTimeSpan:e(o)}})})}):null},GYt=({onClose:e,className:t=""})=>s.jsx(x,{className:t,onClick:e,intent:"secondary",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.modal.confirm.change.slot.link"})})}),$Yt=({navigate:e,className:t=""})=>{const n=F(),o=f(OT),r=f(AX),a=f(Ct),i=o===Sn.CHECKOUT_WALK,l=i&&!r,c=l?"slotbooking.modal.checkout.button":"slotbooking.modal.confirm.button",d=l?"action":"primary",u=()=>{i&&n(U.analyticsEvent({type:Zn.CHECKOUT_WALK})),n(J.closeModal()),n(Wd.handleCheckoutRedirect({slotbookingLocation:o,orderId:a},e))};return s.jsx(x,{className:t,onClick:u,intent:d,"data-synthetics":"confirm-slot",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:c})})})},HYt=()=>{const e=F();h.useEffect(()=>{e(ds({name:HY}))},[])},VYt=({className:e=""})=>s.jsxs(Q,{align:"center",className:e,children:[s.jsx(pe,{name:"status_yes",success:!0,width:24,height:24}),s.jsx(ee,{as:"h2",id:GS,className:"salt-m-l--2",children:s.jsx(b,{id:"slot.booking.confirmation-modal.title"})})]}),WYt=()=>{const e=f(koe);return s.jsxs(h.Fragment,{children:[s.jsxs(Q,{gap:["sm"],wrap:"nowrap",justify:"space-between",align:"flex-start",children:[s.jsx(O,{className:"salt-overflow-wrap--anywhere salt-p-b--0.5",bold:!0,size:"l",children:s.jsx(jYt,{})}),s.jsx(wYt,{})]}),s.jsx("div",{children:s.jsx(O,{children:s.jsx(MYt,{})})}),s.jsx("div",{children:s.jsx(O,{children:s.jsx(BYt,{})})}),s.jsx("div",{children:s.jsx(O,{children:s.jsx(NYt,{})})}),s.jsx(UYt,{}),s.jsx(dM,{}),s.jsx($d,{thresholds:e,isWithIcon:!1,isWithLink:!0,className:"salt-m-t--4",page:"slot-booking"})]})},YYt=({onClose:e,navigate:t})=>(HYt(),s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:"left","aria-live":"polite",children:s.jsx(VYt,{})},"header"),s.jsx(B.Body,{children:s.jsx(WYt,{})},"body"),s.jsxs(B.Footer,{align:"left",children:[s.jsx(GYt,{onClose:e,className:"salt-m-r--1"}),s.jsx($Yt,{navigate:t,className:"salt-m-l--1"})]},"footer")]})),zA="slotbooking-error-modal-header",G$=({closeModal:e,slotSelectionHandler:t,errorMessage:n="request.error.message"})=>{const o=F(),r=f(D("m.la.h")),{formatMessage:a}=L();return h.useEffect(()=>{o(ds({name:Wxe}))},[]),s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:r?"left":"center",children:s.jsx(ee,{as:"h2",id:zA,children:a("request.error.title")})}),s.jsx(B.Body,{children:s.jsx(Te,{intent:"warning",showIcon:!1,text:a(n),className:"salt-m-b--4"})}),s.jsxs(B.Footer,{align:r?"left":"center",children:[s.jsx(x,{onClick:e,intent:"secondary",fill:!0,children:a("request.error.cancel.button")}),s.jsx(x,{onClick:t,intent:"action",fill:!0,children:a("request.error.action.button")})]})]})},woe=se("CANCEL_SLOT"),qYt=e=>({type:"API",payload:{pathPrefix:{client:"/api/ecomslots",server:"/core-api"},service:"ecomslots",url:"/v1/slots/cancel",options:{body:e,method:"PUT"},...woe}}),KYt={cancelSlot:qYt,types:{CANCEL_SLOT:woe}},zYt=()=>async(e,t)=>{const n=t(),o=Ov(n),r=um(n),a=Po(n),i=vn(n);await e(KYt.cancelSlot({draftBasketId:o,shippingGroupType:r,deliveryDestinationId:a,regionId:i})),await e(wo.cancelSelectedSlot())},uM={cancelSlot:zYt},QYt=D("m.la.h"),XYt={actions:m.shape({confirmSlot:m.func.isRequired,cancelSlot:m.func.isRequired,performanceMark:m.func.isRequired,sendAnalyticsEvent:m.func.isRequired,closeModal:m.func.isRequired}).isRequired,onCloseModal:m.func.isRequired,intl:m.any.isRequired,invalidVouchers:m.arrayOf(m.shape({voucherId:m.string,validationErrorCode:m.string})),limitedProducts:m.arrayOf(sl),startTime:m.string.isRequired,endTime:m.string.isRequired,hasRegionChanged:m.bool.isRequired,hasPriceChanged:m.bool.isRequired,itemPriceAfterPromos:ze,slotbookingLocation:wct.isRequired,dateFormat:m.string.isRequired,timeFormat:m.string.isRequired,modalLeftAlignEnabled:m.bool,isDefaultShippingGroup:m.bool.isRequired,latestUpdateTime:m.string,navigate:m.func.isRequired,currencyFormat:m.string.isRequired},ZYt={itemPriceAfterPromos:void 0,invalidVouchers:[],limitedProducts:[],modalLeftAlignEnabled:!1,latestUpdateTime:null},Foe="slotbooking-out-of-stock-modal-header";class pM extends h.Component{constructor(t){super();const{intl:n,startTime:o,endTime:r,dateFormat:a,timeFormat:i}=t;this.state={isSubmitting:!1},this.formattedMessages={title:n.formatMessage("slotbooking.modal.oos.title",{expiryTime:`${gt(o,a)} ${Vg(o,r,i)}`}),continueButton:n.formatMessage("slotbooking.modal.oos.continue.button"),checkoutButton:n.formatMessage("slotbooking.modal.oos.checkout.button"),changeSlotButton:n.formatMessage("slotbooking.modal.oos.slot.button"),vouchersGroup:n.formatMessage("slotbooking.modal.oos.vouchers.title"),productsGroup:n.formatMessage("slotbooking.modal.oos.products.title"),action:n.formatMessage("slotbooking.unavailableItems.info.action"),priceChange:n.formatMessage("slotbooking.modal.oos.price.changed"),unavailable:n.formatMessage("slotbooking.modal.oos.items.unavailable"),addVoucherGeneralError:n.formatMessage("voucher.modal.voucher.add.error")},this.confirm=this.confirm.bind(this),this.cancel=this.cancel.bind(this),this.getVoucherErrorMessage=this.getVoucherErrorMessage.bind(this)}componentDidMount(){const{actions:t}=this.props;t.performanceMark({name:Hxe}),t.sendAnalyticsEvent({type:Ve.SLOT_BOOKING_MODAL_DISPLAYED,hasOutOfStock:!0})}confirm(){const{actions:t,slotbookingLocation:n,isDefaultShippingGroup:o}=this.props,r=n===Sn.CHECKOUT_WALK,a=n===Sn.EDIT_ORDER,i=!r&&!a&&o;n===Sn.CHECKOUT_WALK&&t.sendAnalyticsEvent({type:Zn.CHECKOUT_WALK}),this.setState({isSubmitting:!0},()=>t.confirmSlot(this.props.navigate,n,i?nP:"").then(()=>t.closeModal()).catch(()=>this.setState({isSubmitting:!1})))}cancel(){const{actions:t,onCloseModal:n}=this.props;t.cancelSlot().then(()=>n())}getVoucherErrorMessage(t){const{intl:n}=this.props,o=Bh(t);return n.formatMessage(o)||this.formattedMessages.addVoucherGeneralError}render(){const{intl:t,limitedProducts:n,invalidVouchers:o,hasRegionChanged:r,hasPriceChanged:a,itemPriceAfterPromos:i,modalLeftAlignEnabled:l,slotbookingLocation:c,latestUpdateTime:d,currencyFormat:u}=this.props,{isSubmitting:p}=this.state;return s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:l?"left":"center","aria-live":"polite",children:s.jsx(ee,{as:"h2",id:Foe,children:this.formattedMessages.title})},"header"),s.jsxs(B.Body,{children:[s.jsxs("div",{className:"salt-m-b--8",children:[s.jsx(iM,{className:"salt-m-t--2 salt-m-b--2",latestUpdateTime:d}),n.length>0&&s.jsx(Te,{className:"salt-m-b--2",text:this.formattedMessages.unavailable,showIcon:!1}),r&&a&&s.jsx(Te,{className:"salt-m-b--2",text:this.formattedMessages.priceChange,showIcon:!1}),o.length>0&&s.jsx(Be,{className:"salt-m-b--2",children:o.map(g=>s.jsx(Te,{className:"salt-m-b--2",text:s.jsxs(O,{children:[s.jsx(O,{bold:!0,children:`${g.voucherId} `}),this.getVoucherErrorMessage(g.validationErrorCode)]}),showIcon:!1},g.voucherId))}),r&&a&&i&&s.jsx(Te,{intent:"warning",className:"salt-m-b--2",showIcon:!1,text:t.formatMessage("slotbooking.modal.oos.final.price",{amount:ii(t.formatNumber,i,u)})})]}),n.length>0?s.jsx(Be,{children:n.map(g=>s.jsx(Be.Item,{children:s.jsx(xe,{condensed:!0,children:s.jsx(Ef,{product:g,messages:_te(g,t)})})},g.productId))}):null]},"body"),s.jsxs(B.Footer,{align:l?"left":"center",children:[s.jsx(x,{intent:"secondary",className:"salt-m-r--2",onClick:this.cancel,fill:!0,children:s.jsx(x.Text,{children:this.formattedMessages.changeSlotButton})}),s.jsx(x,{fill:!0,intent:"primary",loading:p,onClick:this.confirm,"data-synthetics":"confirm-slot",children:s.jsx(x.Text,{children:c===Sn.CHECKOUT_WALK?this.formattedMessages.checkoutButton:this.formattedMessages.continueButton})})]},"footer")]})}}pM.propTypes=XYt;pM.defaultProps=ZYt;const JYt=e=>({invalidVouchers:H4(e),limitedProducts:OP(e),hasPriceChanged:W4(e),itemPriceAfterPromos:Y4(e),hasRegionChanged:V4(e),startTime:Av(e),endTime:Dv(e),dateFormat:Zt(e),timeFormat:Mt(e),modalLeftAlignEnabled:QYt(e),isDefaultShippingGroup:pm(e),latestUpdateTime:DP(e),currencyFormat:Bi(e)}),eqt=st({confirmSlot:Wd.confirmSlot,closeModal:J.closeModal,confirmChanges:Wd.confirmSlot,cancelSlot:uM.cancelSlot,performanceMark:ds,sendAnalyticsEvent:U.analyticsEvent}),tqt=Ht(we(JYt,eqt,null,{forwardRef:!0})(pM),{forwardRef:!0}),sqt=wS,nqt=e=>{const{closeModal:t}=e,n=f(Po),o=F(),r=Ge(),a=()=>o(uM.cancelSlot()),i=()=>o(Wd.confirmSlot(r,Sn.BASKET_SPLIT_TRIGGERED));return s.jsx(tne,{addressId:n||"",closeModal:t,confirmAction:i,cancelAction:a})},QA="slotbooking-items-unavailable-header",oqt=e=>{const{closeModal:t}=e;return s.jsxs(h.Fragment,{children:[s.jsxs("div",{"aria-live":"polite",id:QA,children:[s.jsx(B.Header,{align:"left","aria-live":"polite",children:s.jsx(ee,{as:"h1",id:QA,children:s.jsx(b,{id:"slotbooking.items.unavailable.title"})})},"header"),s.jsx(B.Body,{children:s.jsx(O,{className:"salt-m-b--2",children:s.jsx(b,{id:"slotbooking.items.unavailable.content"})})},"body")]}),s.jsxs(B.Footer,{align:"left",children:[s.jsx(x,{asChild:!0,className:"salt-m-r--1",intent:"secondary",fill:!0,role:"link",children:s.jsx(Ye,{intent:"ghost",href:jt(),children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.items.unavailable.confirm"})})})}),s.jsx(x,{onClick:t,intent:"primary",fill:!0,className:"salt-m-l--1",children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.items.unavailable.cancel"})})})]},"footer")]})},rqt="72",Boe="21",aqt=D("bt.spl"),iqt=D("sl.rd"),lqt=({hasFetchError:e,closeModal:t,selectedSlot:n,slotSelectionHandler:o})=>{const r=Ge(),a=f(Nv),i=f(q4),l=f(aqt),c=f(iqt),d=f(v2e),u=f(OT),p=os({breakpoint:"sm-up"});return e?i?.code===rqt?[()=>s.jsx(oqt,{closeModal:t}),QA]:i?.code===Boe?[()=>s.jsx(G$,{closeModal:t,slotSelectionHandler:()=>window.location.reload(),errorMessage:"slotbooking.slot.select.expired"}),zA]:[()=>s.jsx(G$,{closeModal:t,slotSelectionHandler:()=>o(n)}),zA]:l&&d?[()=>s.jsx(nqt,{closeModal:t}),sqt]:a?[()=>s.jsx(tqt,{onCloseModal:t,slotbookingLocation:u,navigate:r}),Foe,!1]:c?[()=>s.jsx(YYt,{onClose:t,navigate:r}),GS,p]:[()=>s.jsx(KWt,{onCloseModal:t,navigate:r,slotbookingLocation:u}),GS]},mM="selectSlot",Ad=({selectedSlot:e,slotSelectionHandler:t,fetchSlots:n})=>{const o=F(),r=f($e(mM)),a=f(B4),i=f(NP),l=!a,c=()=>{o(J.closeModal()),o(wo.clearSelectedSlot()),n({isFetchTriggeredBySelectSlotModal:!0}),o(To.invalidateSlots())},[d,u,p]=lqt({hasFetchError:i,closeModal:c,selectedSlot:e,slotSelectionHandler:t});return s.jsx(B,{showCloseIcon:!0,onRequestClose:c,isOpen:r,aria:{labelledby:u},isLoading:l&&!i,asBottomSheet:p,children:s.jsx(d,{})})},hM=e=>e.data.delivery.slotbooking?.data?.deliveryPriceModificationLevels,cqt=e=>{const t=hM(e);return!!(t&&(t.halfPrice||t.free))},$$=e=>e&&e.reached||!1,dqt=e=>{const t=hM(e);if(t){const{halfPrice:n,free:o}=t;return $$(n)||$$(o)}return!1},uqt=()=>{const e=L(),t=He(),n=F(),o=f(dqt),r=f(hM),a=oX(r,t),i=a&&e.formatMessage(a.id,a.substitutions);return h.useEffect(()=>{a&&n(U.analyticsEvent({type:Ve.ALERT_IMPRESSION,alertImpression:{ALERT_TYPE:"deliveryChargeBySpendAlert",ALERT_MESSAGE_ID:a.id,ALERT_MESSAGE:i}}))},[a]),a?s.jsx(Te,{intent:o?"success":"action","data-test":"delivery-price-modification-alert",text:i}):null},pqt=({slot:e})=>{const t=L(),o=Zi()(e.deliveryTimeInMinutes),r=s.jsx(O,{bold:!0,children:t.formatMessage("slotbooking.express.collection.delivery.booked.alert.info",{readyTimeSpan:o})});return s.jsx(Te,{showIcon:!1,intent:"success",text:t.formatMessage("slotbooking.express.collection.delivery.booked.alert",{timeInfo:r})})},mqt=({slot:e})=>{const t=L();return s.jsx(Te,{intent:"success",showIcon:!1,text:t.formatMessage("slotbooking.confirm.alert.for.collection",{dateAndTime:s.jsx(tA,{basketSlot:e}),addressName:e.nickname})})},Uoe=e=>{const[t]=Ee(["md.sl"]),[n,o]=h.useState(!1);return h.useEffect(()=>{o(e?su(e,t):!1)},[e]),n},hqt=({dateFormat:e,intl:t,slot:n,timeFormat:o})=>{const{formatMessage:r}=t,a="success";return s.jsx(Te,{intent:a,showIcon:!1,"data-test":"delivery-booked-alert","data-test-type":a,text:s.jsxs(h.Fragment,{children:[r("delivery.booked.alert")," ",s.jsx(jg,{dateIso:n.start,timeZoneId:n.timeZoneId,dateFormat:e})," ",s.jsx(O,{bold:!0,children:s.jsx(xf,{dateIsoFrom:n.start,dateIsoTo:n.end,timeZoneId:n.timeZoneId,timeFormat:o})})]})})},gqt=()=>{const e=L(),t=f(Zt),n=f(xV),o=f(UR),r=f(Mt),a=Uoe(n);return o?a?s.jsx(mqt,{slot:n}):n?.slotType==="ON_DEMAND"?s.jsx(pqt,{slot:n}):s.jsx(hqt,{intl:e,slot:n,timeFormat:r,dateFormat:t}):null},$S=({isAddressSelectionPage:e=!1,expand:t,slotBooked:n,"data-gtm-target":o})=>{const r=f(D("dcbbs")),a=f(cqt),i=r&&!e&&a;return s.jsxs("div",{...!r&&{"data-gtm-target":o,"data-test":"slot-booking-page-delivery-booked-alerts-wrapper"},...!t&&{className:"salt-p-x--2"},children:[n&&s.jsx("div",{className:r?"salt-m-b--2":"salt-p-b--2",children:s.jsx(gqt,{})}),s.jsx(AYt,{}),i&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx(uqt,{})})]})},Eqt=v(Q)`
    min-inline-size: max-content;
`,fqt=()=>f(Ys)==="HOME_DELIVERY"?"slot.booking.card.fast.delivery.booked.label":"slot.booking.card.reserved.express.collection.booked.label",H$=({slot:e,className:t="",onReserve:n,dateFormat:o,timeFormat:r,isBooked:a=!1})=>{const[i,l]=Ee(["excol.adj","sl.rd"]),c=s.jsx(Goe,{slot:e});return l?s.jsx(xe,{className:`salt-m-b--2 ${t}`,tabIndex:0,children:s.jsxs(Q,{gap:["sm"],justify:"space-between",align:"center",wrap:"nowrap",children:[s.jsxs(Q,{gap:["sm"],wrap:"wrap",align:"center",children:[s.jsx(HS,{slot:e,price:c,isBooked:a}),s.jsx(VS,{slot:e,dateFormat:o,timeFormat:r})]}),s.jsx(Eqt,{align:"center",children:s.jsx(WS,{booked:a,onClick:n,fullWidth:!1})})]})}):s.jsx(xe,{className:`salt-p-y--2 salt-p-x--0 salt-m-b--2 ${t}`,tabIndex:"0",children:s.jsxs(V,{children:[s.jsx(Iqt,{colSpan:{xs:9},children:s.jsxs(Q,{gap:["sm"],wrap:"wrap",align:"center",children:[s.jsx(HS,{slot:e,isBooked:a,...i&&{price:c}}),s.jsx(VS,{slot:e,dateFormat:o,timeFormat:r})]})}),s.jsx(V.Item,{colSpan:{xs:3},children:s.jsxs(Q,{justify:"flex-end",gap:["sm"],align:"center",children:[!i&&s.jsx(O,{size:"s",children:c}),s.jsx(WS,{booked:a,onClick:n,fullWidth:!1})]})})]})})},xy=({slot:e,onReserve:t,dateFormat:n,timeFormat:o,className:r,isBooked:a=!1})=>{const[i,l]=Ee(["excol.adj","sl.rd"]),c=s.jsx(Goe,{slot:e});return l?s.jsxs(xe,{className:`salt-m-b--2 ${r}`,tabIndex:0,children:[s.jsx(HS,{slot:e,price:c,isBooked:a}),s.jsx("div",{className:"salt-m-y--4",children:s.jsx(VS,{slot:e,dateFormat:n,timeFormat:o})}),s.jsx(WS,{booked:a,onClick:t})]}):s.jsxs(Oe.Action,{xs:1,sm:1,md:1,className:`salt-m-y--0 ${r}`,tabIndex:"0",children:[s.jsxs(Sqt,{children:[s.jsx(HS,{asTitle:!0,slot:e,isBooked:a,...i&&{price:c}}),!i&&s.jsx(O,{size:"l",children:c})]}),s.jsx(vqt,{children:s.jsx(VS,{slot:e,dateFormat:n,timeFormat:o})}),s.jsx(Oe.Action.Footer,{children:s.jsx(WS,{booked:a,onClick:t})})]})},HS=({asTitle:e,price:t,slot:n,isBooked:o})=>{const r=L(),a=v4(n)?n.onDemandProperties.deliveryTimeInMinutes:0,i=r.formatNumber(a,{style:"unit",unit:"minute",unitDisplay:"short"}),l=f(Ys),c=s.jsxs(h.Fragment,{children:[l==="HOME_DELIVERY"?s.jsx(b,{id:"slot.confirmation.fast.delivery.title",values:{duration:i}}):s.jsx(b,{id:"slotbooking.express.collection.slot.list.item.title"}),!o&&t&&s.jsxs(h.Fragment,{children:[": ",t]})]});return s.jsxs(Cqt,{children:[l==="CUSTOMER_COLLECTION"&&s.jsx(pe,{name:"express_collect",height:24,width:24}),e?s.jsx(ee,{className:"salt-p-r--2",as:"h2",children:c}):s.jsx(O,{className:l==="CUSTOMER_COLLECTION"?"salt-p-x--2":"",bold:!0,children:c})]})},VS=({slot:e,dateFormat:t,timeFormat:n})=>{const o=Zi(),r=f(Ys);if(v4(e)){const{onDemandProperties:i}=e,{deliveryTimeInMinutes:l,collectionTimeInMinutes:c}=i,d=o(c),u=o(l),p=r==="HOME_DELIVERY"?"slot.booking.card.fast.delivery.static.subtitle":"slotbooking.express.collection.slot.list.item.description",g={readyTimeSpan:u,maxTimeSpan:d};return s.jsx(O,{children:s.jsx(b,{id:p,values:g})})}const a=s.jsx(qn,{dateIsoFrom:e.slotDateTimeISO,dateIsoTo:e.endTimeISO,timeZoneId:e.timeZoneId,dateFormat:t,timeFormat:n});return s.jsx(O,{children:s.jsx(b,{id:"slot.booking.slots.list.item.multidays.subtitle",values:{dateAndTime:a}})})},Goe=({slot:e})=>{const t=He();return parseFloat(e.deliveryPrice.amount)===0?s.jsx(b,{id:"slotbooking.table.price.free"}):t(e.deliveryPrice)},yqt=v(x)`
    ${({bigger:e})=>e?Pe`
                  padding-inline: 32px;
              `:""}
`,WS=({booked:e,onClick:t=Promise.resolve,fullWidth:n=!0})=>{const[o,r]=h.useState(!1),[a=!1,i]=Ee(["excol.adj","sl.rd"]),c=f(Ys)==="HOME_DELIVERY"?"order.slot.bookSlot.reminder.book.link":"slotbooking.express.collection.slot.list.item.reserve",d=a&&!i,u=async()=>{r(!0);try{await t()}catch{r(!1)}},p=fqt();return e?s.jsx(Te,{intent:"success",text:s.jsx(b,{id:p})}):s.jsx(yqt,{size:d?"m":"s",intent:"primary",fill:n,onClick:u,loading:o,bigger:d,children:s.jsx(b,{id:c})})},Iqt=v(V.Item)`
    display: flex;
    align-items: center;
`,Sqt=v(Oe.Action.Header)`
    display: flex;
    justify-content: space-between;
`,Cqt=v.div`
    display: flex;
    align-items: center;
`,vqt=v(Oe.Action.Body)`
    text-align: start;
`,$oe=({onReserve:e=Promise.resolve,sendImpression:t,shouldSendMultiDayImpression:n,classNameForBanner:o="salt-p-b--2",classNameForCard:r="salt-p-y--2",className:a=""})=>{const i=f(Ys),l=f(qi),c=f(EP),d=f(Zt),u=f(Mt),[p,g,E]=Ee(["sl.rd","sl.fd","sl.ec.bs"]),y=i==="CUSTOMER_COLLECTION"&&E||i==="HOME_DELIVERY",I=f(Vi),S=y&&I?.slotType==="ON_DEMAND"&&I.deliveryMethod===i&&I.deliveryDestinationId===l;if(h.useEffect(()=>{c?.length&&c.forEach((_,A)=>{if("onDemandProperties"in _){const{deliveryPrice:{amount:R,currency:P},onDemandProperties:{deliveryTimeInMinutes:N,collectionTimeInMinutes:k}}=_;t({PRICE_DISPLAYED:R,PRICE_CURRENCY:P,DELIVERY_TIME_IN_MINUTES:`${N}`,...k&&{COLLECTION_TIME_IN_MINUTES:`${k}`},SLOT_TYPE:Qa,SEQUENCE:`${A}`})}else n&&t({...f4(_),SEQUENCE:`${A}`})})},[c,t]),i==="HOME_DELIVERY"&&!g||!(c?.length||S))return null;const C=_=>({slot:_,key:_.slotId,onReserve:()=>e(_),dateFormat:d,timeFormat:u}),T=_=>({slot:{slotId:_.slotId,onDemandProperties:{deliveryTimeInMinutes:_?.deliveryTimeInMinutes||0,collectionTimeInMinutes:_?.collectionTimeInMinutes||0},expiryTime:_.expiryTime,attributes:[],deliveryPrice:{currency:"GBP",amount:"0.00"},carrierId:_.carrierId||"",minimumOrder:{currency:"GPB",amount:"0.00"}},key:_.slotId,onReserve:Promise.resolve,dateFormat:d,timeFormat:u,isBooked:!0});return s.jsxs("div",{className:a,children:[s.jsxs(Kt,{breakpoint:"md-up",remainInDom:!1,children:[S&&s.jsx(H$,{...T(I),className:o}),c.map(_=>s.jsx(H$,{...C(_),className:o}))]}),s.jsx(Lt,{breakpoint:"md-up",remainInDom:!1,children:p?s.jsxs(ae.Fragment,{children:[S&&s.jsx(xy,{...T(I),className:r}),c.map(_=>s.jsx(xy,{...C(_),className:r}))]}):s.jsxs(Oe.Collection,{className:"salt-gap-y--2",children:[S&&s.jsx(xy,{...T(I),className:r}),c.map(_=>s.jsx(xy,{...C(_),className:r}))]})})]})},Tqt=({deliveryOptions:e,featureFlags:t})=>{const{dropOff:n,entryInstructions:o,deliveryAsset:r,additionalInformation:a}=e||{},{isDropOffRequired:i,isDeliveryAssetRequired:l,isAdditionalInfoRequired:c}=t,d=n?.selectedId,u=o?.selectedId,p=r?.selectedId,g=d&&n?.options.find(T=>T.id===d)?.entryInstructionsRequired||!1,E=c?u&&o?.options.find(T=>T.id===u)?.additionalInformationRequired:!1,y=i?!!d:!0,I=l?!!p:!0,S=g?!!u:!0,C=E?!!a?.value:!0;return{isDropOffValid:y,isDeliveryAssetValid:I,isEntryInstructionValid:S,isAdditionalInformationValid:C}},Hoe=e=>{const t=Tqt(e);return Object.values(t).every(Boolean)},_qt=(e,t)=>({limitedProducts:t,invalidVouchers:e.invalidVouchers||[],draftBasketId:e.draftBasketId,totalChanged:e.totalChanged,itemPriceAfterPromos:e.itemPriceAfterPromos,regionChanged:e.regionChanged,slotRegionId:e.slotRegionId,otherCheckoutGroupsChanged:e.otherCheckoutGroupsChanged}),bqt=(e,t)=>{const n=e.confirmationData?_qt(e.confirmationData,t):void 0,o=e.slot.latestEditableTime?ad(e.slot.latestEditableTime,e.slot.timeZoneId):void 0;return{slot:{address:e.slot.address,expiryTime:ad(e.slot.expiryTime,e.slot.timeZoneId),latestUpdateTime:o,startTime:ad(e.slot.slotWindow?.startTime,e.slot.timeZoneId),endTime:ad(e.slot.slotWindow?.endTime,e.slot.timeZoneId),timeZoneId:e.slot.timeZoneId,slotId:e.slot.slotId,deliveryMethod:e.slot.deliveryMethod,type:e.slot.type,deliveryTimeInMinutes:e.slot.onDemandProperties?.deliveryTimeInMinutes,collectionTimeInMinutes:e.slot.onDemandProperties?.collectionTimeInMinutes,carrierId:e.slot.carrierId,...e.slot.externalAddress?{externalAddress:e.slot.externalAddress}:{},...typeof e.minimumCheckoutThresholdData?.minimumCheckoutThresholdChanged=="boolean"&&{minimumCheckoutThresholdChanged:e.minimumCheckoutThresholdData?.minimumCheckoutThresholdChanged},...e.minimumCheckoutThresholdData?.minimumCheckoutThreshold&&{minimumCheckoutThreshold:e.minimumCheckoutThresholdData.minimumCheckoutThreshold},...e.minimumCheckoutThresholdData?.originalMinimumCheckoutThreshold&&{originalMinimumCheckoutThreshold:e.minimumCheckoutThresholdData.originalMinimumCheckoutThreshold}},...n&&{confirmationData:n}}},gM=D("oosa"),xqt=D("sl.cut"),Aqt=D("bt.spl"),Voe=D("sl.rd"),Rqt=()=>J.openModal(mM),Dqt=()=>Yt.getBasket(),Oqt=(e,t)=>{const n=gM(e),o=xqt(e),r=A4(e),a=Nv(e),i=Voe(e),l=!r&&t.deliveryMethod==="HOME_DELIVERY"&&t.type==="ON_DEMAND";return!n&&!(r||l)||i&&!a&&!(r||l)||i&&a&&!n||!a&&n&&o&&!(r||l)||a&&(r||l)&&!n},Pqt=async(e,t,n,o)=>{try{return await e(wo.selectSlot({...t,regionId:n}))}catch(r){const a={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventLabel:t.slotId,eventValue:parseFloat(t.deliveryPrice.amount),eventAction:"SelectSlotError",ecommerce:{checkout:{actionField:{step:2,option:t.deliveryType===pt.clickAndCollect.type?"click&collect":"homeDelivery"},products:o}}};throw te.sendEvent({GA:a,WA:null}),r}},Nqt=e=>async(t,n)=>{const o=n(),r=ho(o).map(C=>tn(C)),a=vn(o),i=await Pqt(t,e,a,r),l=i?.payload?.responseData,c=l?.slot?.slotId,d=l?.confirmationData?.slotRegionId,u=l?.confirmationData?.limitedProducts||[];let p=[];c&&d&&u?.length&&(p=(await t(wo.getSlotBookingLimitedProducts({slotId:c,slotRegionId:d,limitedProducts:u})))?.payload?.responseData);const g=bqt(l,p),{type:E,payload:y,...I}=i;await t(wo.setSelectedSlot({selectSlotData:g,params:I}));const S={event:"event",ecommType:"enhanced",eventCategory:"Checkout Funnel",eventLabel:`${g.slot.startTime} - ${g.slot.endTime}`,eventValue:parseFloat(I.deliveryPrice.amount),eventAction:"SlotBooked",ecommerce:{checkout:{actionField:{step:2,option:I.deliveryType===pt.clickAndCollect.type?"click&collect":"homeDelivery"},products:r}}};return te.sendEvent({GA:S,WA:null}),g},Lqt=(e,t)=>async(n,o)=>{const r=o(),a=gM(r),i=Ct(r),l={...e,orderId:i};try{const d=(await n(Nqt(l)))?.confirmationData?.limitedProducts,u=Oqt(o(),e);if(a&&d?.length){const p=d.reduce((g,E)=>({...g,[E.productId]:E}),{});await n(xt.setProducts({product:p}))}u&&n(Rqt()),await n(Dqt()),u||await n(kqt(t))}catch{const d=o();if(q4(d)?.code===Boe)if(e?.isFakeAvailable){const p=new URL(window.location.href);p.searchParams.set(Jx,"true"),window.location.href=p.toString()}else Z.error("slotbooking.slot.select.expired",{button:s.jsx(r1e,{onClick:()=>window.location.reload(),children:s.jsx(b,{id:"common.page.refresh"})})});else Z.error("toast.notification.generic.error")}},kqt=e=>(t,n)=>{const o=n(),r=K4(o),a=OT(o),i=Ct(o),l=T2e(o),c=LE(o),d=Nv(o),u=jqt(o),p=r,g=d;if(p)return a===Sn.CHECKOUT_WALK&&t(U.analyticsEvent({type:Zn.CHECKOUT_WALK})),t(Wd.handleCheckoutRedirect({slotbookingLocation:a,orderId:i,slotBookedQuery:Mqt(o)},e));if(g&&!l&&!c){t(wo.invalidateSlotsConfirmationData());const E=`${Oq()}?${u}`;return e(E)}return null},jqt=e=>{const t=Ys(e),n=BL(e),o=Voe(e),r=Po(e),a=new URLSearchParams;return a.set("deliveryMethod",t),o&&a.set("deliveryDestinationId",r||""),n&&a.set("in-checkout-walk","true"),a.toString()},Mqt=e=>{const t=Aqt(e),n=Zg(e),o=PR(e),r=gM(e),i=!A4(e)&&r;return t&&n===o?nP:i?Iv:""},EM={selectSlot:Lqt},wqt=(e,t)=>{const n=t===pt.vanDelivery.method,o=e.attributes?.includes("GREEN")||!1,r=e.attributes?.includes("AVAILABLE")||!1;return n&&o&&r},Fqt=v(Dr)`
    /* hide long addresses to avoid horizontal scroll */
    overflow-x: hidden;
`,V$=({addresses:e,disabled:t,primaryDeliveryDestination:n,selectedAddress:o,onSelectAddress:r,onChooseDifferentCollectionPoint:a,onClick:i})=>{const l=L(),c="choose-different-collection-point-value",d=C=>C[0],u=l.formatMessage("delivery.collection.select.title",{name:n?.data?.name??d(e)?.name}),p=l.formatMessage("delivery.collection.select.different.collection.point"),g=Noe(n)??d(e)?.coordinates,E=Loe(e,g).slice(0,5),y=wWt(e,o),I=()=>!MWt(E,o)&&y&&KA(y),S=h.useCallback(({target:{value:C}})=>{C===c?a():r(C)},[r,a]);return s.jsxs(Fqt,{id:YS,"data-test":"address-dropdown",onChange:S,value:o?.deliveryDestinationId,disabled:t,onClick:i,children:[I(),s.jsx("optgroup",{"data-test":"closest-collection-points-label",label:u,children:E.map(KA)}),s.jsx("option",{value:c,"data-test":c,children:p})]})},Bqt=v(Dr)`
    /* hide long addresses to avoid horizontal scroll */
    overflow-x: hidden;
`,W$=({addresses:e,disabled:t,selectedAddress:n,onSelectAddress:o,onClick:r})=>{const a=L(),i=Nu(),l=({target:{value:u}})=>{u===c?i.value():o(u)},c="add-address-option-value",d=a.formatMessage("addresses.add.address");return s.jsxs(Bqt,{id:YS,"data-test":"address-dropdown",onChange:l,value:n?.deliveryDestinationId,disabled:t,onClick:r,children:[e.map(KA),i.status==="READY"&&s.jsxs("option",{value:c,children:[" ",d," "]})]})},fM=()=>{const e=F(),t=f(Ys),n=t===pt.vanDelivery.method;return{emitOnDropdownClickEvent:()=>e(U.analyticsEvent({type:Ve.ADDRESS_SELECTION_DROP_DOWN_CLICKED,description:Wr[Ve.ADDRESS_SELECTION_DROP_DOWN_CLICKED],deliveryMethod:t})),emitOnAddressChangeEvent:o=>{const r=n?Ve.ADDRESS_FROM_DROP_DOWN_SELECTED:Ve.COLLECTION_POINT_FROM_DROP_DOWN_SELECTED;e(U.analyticsEvent({type:r,description:Wr[r],deliveryMethod:t,deliveryDestinationId:o})),e(U.analyticsEvent({type:Ve.SELECT_FULFILLMENT_LOCATION,deliveryMethod:t,deliveryDestinationId:o}));const a={event:"select_fulfillment_location",method:lg[t],fulfillment_location_id:o};te.sendEvent({GA:a,WA:null})},emitOnCollectionPointMapOpenEvent:()=>e(U.analyticsEvent({type:Ve.CHOOSE_DIFFERENT_COLLECTION_POINT_BUTTON_CLICKED,description:Wr[Ve.CHOOSE_DIFFERENT_COLLECTION_POINT_BUTTON_CLICKED],deliveryMethod:t}))}},YS="address-dropdown",Uqt=v.div`
    position: relative;
`,Gqt=v.span`
    position: absolute;
    z-index: 1;
    font-size: 16px;
    inset-inline-start: 9px;
    inset-block-start: 9px;
    font-weight: 500;
`,Lu=({disabled:e=!1,deliveryMethod:t,deliveryAddresses:n,selectedAddress:o,onSelectAddress:r,onChooseDifferentCollectionPoint:a})=>{const{emitOnDropdownClickEvent:i,emitOnAddressChangeEvent:l,emitOnCollectionPointMapOpenEvent:c}=fM(),d=f(zs),u=t===pt.vanDelivery.method,p=FWt(n),g=I=>(ds({name:qxe}),l(I),r(I)),E=()=>(c(),a());return f(D("sl.rd"))?s.jsxs(Uqt,{children:[o?.name&&s.jsx(Gqt,{"aria-hidden":!0,children:o?.name}),u?s.jsx(W$,{onClick:i,disabled:e,addresses:p,selectedAddress:o,onSelectAddress:g}):s.jsx(V$,{onClick:i,disabled:e,addresses:p,primaryDeliveryDestination:d,selectedAddress:o,onSelectAddress:g,onChooseDifferentCollectionPoint:E})]}):u?s.jsx(W$,{onClick:i,disabled:e,addresses:p,selectedAddress:o,onSelectAddress:g}):s.jsx(V$,{onClick:i,disabled:e,addresses:p,primaryDeliveryDestination:d,selectedAddress:o,onSelectAddress:g,onChooseDifferentCollectionPoint:E})},$qt=()=>{const t=L().formatMessage("common.address");return f(D("sl.rd"))?s.jsx(ie,{children:s.jsx(Rn,{htmlFor:YS,children:t})}):s.jsx(Rn,{htmlFor:YS,children:t})};Lu.Title=$qt;const{Row:Y$,Item:q$,EmptyButton:ox,HighlightedItem:Woe,ItemColumnTitle:Hqt,Container:Vqt,DatePickerContainer:Wqt,DatePickerTable:Yqt,MonthContainer:qqt,MonthArrow:K$,Month:Kqt,Footer:zqt}=BFe,Qqt=v(Woe)`
    border-start-start-radius: ${({firstSelected:e})=>e?"var(--salt-radius-default)":0};
    border-end-start-radius: ${({firstSelected:e})=>e?"var(--salt-radius-default)":0};
    border-inline-start: ${({firstSelected:e})=>e?`${$(1)} solid var(--intent-primary)`:0};
`,yM=({selected:e,onDaySelect:t,dateTime:n,availableDays:o,controlledSelected:r,messages:a,buttonClassName:i,text:l,isNewButton:c=!1,containerStyle:d={},highlightedEnd:u="",highlightedStart:p="",amountHighlighted:g=3})=>{const E=h.useRef(null),[y,I]=h.useState(e),[S,C]=h.useState(e),[T,_]=h.useState(!1),A=yo();h.useEffect(()=>(X(),window.addEventListener("mousedown",R),()=>window.removeEventListener("mousedown",R)),[]),h.useEffect(()=>{C(e)},[e]);const R=ce=>{j(ce.target)&&_(!1)},P=ce=>{w(),C(ce),t(ce),A({type:Ve.CALENDAR_DATE_SELECTED_EVENT})},N=()=>{const{subtractMonths:ce,DATE_FORMAT_SHORT_ISO:me,formatDateWithFixedTimezone:De}=n,ge=ce(1,y);I(De(ge,me))},k=()=>{const{addMonths:ce,DATE_FORMAT_SHORT_ISO:me,formatDateWithFixedTimezone:De}=n,ge=ce(1,y);I(De(ge,me))},M=()=>{const{addDays:ce,genDayRange:me}=n;if(p&&u)return me(p,u);const De=ce(1,S),ge=ce(g,S);return me(De,ge)},w=()=>{T||A({type:Ve.CALENDAR_CLICKED_EVENT}),_(!T)},j=ce=>E.current&&ce instanceof Node&&!E.current.contains(ce),G=ce=>{const{areDaysTheSame:me}=n;return o&&!o.filter(De=>me(De,ce)).length},W=ce=>{const{areDaysTheSame:me}=n;return me(S,ce)},H=ce=>{const me=M(),{areDaysTheSame:De}=n;return{isHighlighted:!!me.filter(ge=>De(ge,ce)).pop(),isLastHighlight:De(me.pop(),ce),isFirstHighlight:De(me[0],ce)}},K=()=>{const{addDays:ce,DATE_FORMAT_SHORT_ISO:me,getFirstDayOfWeekCrossingBeginningOfMonth:De,getLastDayOfWeekCrossingEndOfMonth:ge,genWeekRange:Se,formatDateWithFixedTimezone:Ae}=n,Ce=De(y),We=ge(y),et=Se(Ce,We);return et==="Invalid date"?[]:et.reduce((ve,lt)=>{const St=Array.from(Array(6)).map((dn,Mo)=>Ae(ce(Mo+1,lt),me)),wt=[Ae(lt,me),...St];return[...ve,wt]},[])},X=()=>{const{DATE_FORMAT_DAY_WITH_LEADING_ZEROS:ce,DATE_FORMAT_LOCALE_DEPENDENT:me,formatDateWithFixedTimezone:De}=n;return K().map(ge=>s.jsx(Y$,{children:ge.map(Se=>{const Ae=W(Se),Ce=G(Se),We=H(Se),et={muted:Ce,selected:Ae,onClick:()=>P(Se)},ve=De(Se,ce),lt=De(Se,me),St=Ce?s.jsx(q$,{"data-test":"date-picker-item","aria-disabled":"true",...et,children:ve},Se):s.jsx(q$,{"data-test":"date-picker-item",...et,children:s.jsxs(ox,{type:"button","aria-pressed":Ae,fillSpace:!0,children:[s.jsx("span",{"aria-hidden":"true",children:ve}),s.jsx(ie,{children:lt})]})},Se),wt=Ce?s.jsx(Woe,{"data-test":"date-picker-highlighted-item",...et,last:We.isLastHighlight,"aria-disabled":"true",children:ve},Se):s.jsx(Qqt,{...et,last:We.isLastHighlight,firstSelected:We.isFirstHighlight&&r,children:s.jsxs(ox,{type:"button","aria-pressed":Ae,fillSpace:!0,children:[s.jsx("span",{"aria-hidden":"true",children:ve}),s.jsx(ie,{children:lt})]})},Se);return We.isHighlighted?wt:St})},ge[0]))},q=ce=>{const{getFirstDayOfWeekIndex:me}=n,De=me();return[...Array(7).keys()].map(ge=>s.jsx(Hqt,{"data-test":"date-picker-item-column-title",scope:"col",children:[...Object.values(a.weekDays)][(De+ge)%7]},`${ce}-${ge}`))},{DATE_FORMAT_MONTH_YEAR_LABEL:ne,DATE_FORMAT_MONTH_INDEX:ue,formatDateWithFixedTimezone:oe,addMonths:ye,subtractMonths:he}=n,Ie=ce=>oe(ce,ne),Fe=Ie(y),be=oe(y,ue);return e&&s.jsxs(Vqt,{ref:E,children:[c?s.jsxs(x,{intent:"tertiary",size:"s",fill:!1,"aria-label":a.datePickerAlternative,"aria-expanded":T,"aria-haspopup":!0,onClick:w,"data-test":"date-picker-button",className:i||"",children:[s.jsx(x.Icon,{name:"calendar",size:"s"}),l?s.jsx(x.Text,{children:l}):void 0]}):s.jsxs(x,{intent:"secondary","data-test":"date-picker-button",fill:!0,"aria-label":a.datePickerAlternative,"aria-expanded":T,"aria-haspopup":!0,onClick:w,children:[s.jsx(x.Icon,{name:"calendar"}),s.jsx(x.Text,{className:"salt-d--none md:salt-d--block",children:a.calendar})]}),T&&s.jsxs(Wqt,{style:d,children:[s.jsxs(qqt,{children:[s.jsxs(K$,{"data-test":"date-picker-arrow-button",type:"button",onClick:()=>N(),onKeyPress:({key:ce})=>ce==="enter"&&N(),children:[s.jsx(ie,{children:a.previousMonth(Ie(he(1,y)))}),s.jsx(pe,{"aria-hidden":"true",height:20,width:20,name:"arrow_left"})]}),s.jsxs(Kqt,{id:"current-month","aria-live":"polite",children:[s.jsx("span",{"aria-hidden":"true",children:Fe}),s.jsx(ie,{children:a.currentMonth(Fe)})]}),s.jsxs(K$,{"data-test":"date-picker-arrow-button",type:"button",onClick:()=>k(),onKeyPress:({key:ce})=>ce==="enter"&&k(),children:[s.jsx(ie,{children:a.nextMonth(Ie(ye(1,y)))}),s.jsx(pe,{"aria-hidden":"true",height:20,width:20,name:"arrow_right"})]})]}),s.jsxs(Yqt,{"aria-labelledby":"current-month","data-test":"date-picker-table",children:[s.jsx("thead",{"data-test":"DatePicker-heading",children:s.jsx(Y$,{children:q(be)})}),s.jsx("tbody",{children:X()})]}),s.jsx(zqt,{children:s.jsx(ox,{type:"button",underline:!0,onClick:w,"data-test":"DatePicker-Cancel",children:a.cancel})})]})]})};yM.displayName="DatePicker";const z$=v(x)`
    flex: 1;
`,Xqt=v.div`
    flex: 1;
`,Zqt=({labels:e,daysOffset:t,dateTime:n,onPrevBtnClick:o,onNextBtnClick:r,days:a,numberOfDisplayedDays:i,firstDisplayedDay:l,onDaySelect:c,dateFormat:d})=>{const p=dr()==="xs",{formatDateWithFixedTimezone:g,DATE_FORMAT_SHORT_ISO:E}=n,y=a.filter(I=>I.hasAnyAvailableSlot).map(I=>I.iso);return s.jsxs(h.Fragment,{children:[s.jsxs(z$,{intent:"secondary",disabled:t===0,onClick:o,"data-synthetics":"select-previous","aria-label":e.previousCompleteText,fill:p,className:"salt-p-x--0",children:[s.jsx(x.Icon,{name:"arrow_left"}),s.jsx(x.Text,{className:"xs:max-sm:salt-vc",children:e.previous})]}),s.jsx(Xqt,{className:"salt-m-x--1",children:s.jsx(yM,{selected:l&&l.iso||g(E,d),onDaySelect:c,amountHighlighted:i-1,availableDays:y,messages:e,"data-synthetics":"date-picker",dateTime:n})}),s.jsxs(z$,{intent:"secondary",disabled:t>=a.length-2*i+1,onClick:r,"data-synthetics":"select-next","aria-label":e.next,fill:p,className:"salt-p-x--0",children:[s.jsx(x.Text,{className:"xs:max-sm:salt-vc",children:e.next}),s.jsx(x.Icon,{name:"arrow_right"})]})]})},Jqt=(e,t)=>{const[,n]=t?.start?.split("T")||[],[,o]=t?.end?.split("T")||[];return{start:`${e?.iso}T${n}`,end:`${e?.iso}T${o}`}},eKt=({displayedGridDays:e,partOfDays:t,activeRawStandardSlotIdsMap:n})=>{const o=[];return e.forEach(({dayId:r})=>{t.forEach(({intervals:a,partId:i})=>{a.forEach(({intervalId:l})=>{const c=n[`${r}|${i}|${l}`];c&&o.push(c)})})}),o},tKt=()=>{const{formatMessage:e}=L(),t=f(aj),n=f(ij);return h.useMemo(()=>{const o=s.jsx(O,{size:"l",bold:!0,children:n?.displayValue});return n?t?.value?{ariaLabel:e("slot.booking.delivery.drop-off-option-with-value.accessibility",{option:n?.displayValue,info:t?.value}),buttonText:s.jsx(b,{id:"slot.booking.delivery.drop-off-option-with-value",values:{label:o,value:s.jsx(O,{size:"l",children:t.value})}})}:{ariaLabel:e("slot.booking.delivery.drop-off-option.accessibility",{option:n?.displayValue}),buttonText:o}:{ariaLabel:e("slot.booking.delivery.select-drop-off-option"),buttonText:s.jsx(O,{size:"l",bold:!0,children:s.jsx(b,{id:"slot.booking.delivery.select-drop-off-option"})})}},[t?.value,n?.displayValue])},Yoe=v(xe)`
    align-items: center;
    cursor: pointer;
    display: flex;
    block-size: ${$(40)};
    gap: var(--salt-spacing-2);

    &:hover {
        box-shadow: var(--salt-elevation-shadow-1);
    }
`,sKt=v.span`
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`,Nf=({onDeliveryDetailsSaved:e,handleModalClose:t,hasUnconfirmedSlot:n})=>{const o=F(),{ariaLabel:r,buttonText:a}=tKt(),i=f(Po),l=f($i),c=i||l,d=n?Vx.DELIVERY_OPTIONS_INCOMPLETE:Vx.DELIVERY_OPTIONS_CLICKED,u=()=>{o(J.openModal(vf))};return s.jsxs(h.Fragment,{children:[s.jsx(Yoe,{asChild:!0,condensed:!0,"data-test":"delivery-details-selector","aria-label":r,onClick:u,children:s.jsxs("button",{type:"button",children:[s.jsx(sKt,{children:a}),s.jsx(pe,{name:"edit"})]})}),s.jsx(Fte,{trigger:d,onDeliveryDetailsSaved:e,handleModalClose:t,deliveryDestinationId:c})]})},nKt=()=>s.jsx(Yoe,{children:null});Nf.Skeleton=nKt;const oKt=v(ln)`
    position: absolute;
    inset-block-start: -10px;
    inset-inline-start: -5px;
`,Q$=e=>e.length>BB?`${e.slice(0,BB)}...`:e,qoe=()=>{const{formatMessage:e}=L(),t=f(D("sv.sl.bdg")),n=e("saver-slots-badge.title"),[o]=Ee(["sl.rd"]);return t?o?s.jsx(ln,{intent:"primary","data-test":"saver-slots-button-badge",text:Q$(n),singleLine:!0}):s.jsx(oKt,{intent:"primary","data-test":"saver-slots-button-badge",text:Q$(n),singleLine:!0}):null},rKt={slotId:m.string,onClick:m.func,dataSynthetics:m.string,children:m.oneOfType([m.string,m.element,m.array]),available:m.bool,highlight:m.bool,select:m.bool,dateTimeMessage:m.string},aKt={slotId:void 0,onClick:void 0,dataSynthetics:void 0,children:void 0,available:!1,highlight:!1,select:!1,dateTimeMessage:""},Koe={available:m.bool,highlight:m.bool,select:m.bool},zoe={available:!1,highlight:!1,select:!1},Qoe={highlight:m.bool,fontSize:m.string,fontWeight:m.number},Xoe={highlight:!1,fontSize:"14px",fontWeight:700},IM=({select:e,highlight:t,available:n})=>{let o="var(--intent-contrast)";return e?o="var(--intent-primary-100)":t?o="var(--intent-primary-50)":n||(o="var(--intent-secondary-100)"),o},wp=v.td.attrs(({colspan:e})=>({colSpan:e||1}))`
    position: relative;
    background-color: ${IM};
    ${({select:e})=>e&&"font-weight: 600"};
    border: var(--salt-border-1) solid var(--intent-secondary-900);
    padding: 0;
    text-align: center;

    &:hover {
        ${({available:e})=>e&&"cursor: pointer"};
        ${({available:e})=>e&&`
            background-color: var(--intent-primary-100);
        `};
    }
`;wp.propTypes=Koe;wp.defaultProps=zoe;wp.displayName="Td";const Lf=v.button`
    position: absolute;
    inset-block-start: 0;
    inset-inline-start: 0;
    inline-size: 100%;
    block-size: 100%;
    background-color: ${IM};
    ${({select:e})=>e&&"font-weight: 600"};
    border: 0;
    padding: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;

    &:hover {
        ${({available:e})=>e&&"cursor: pointer"};
        ${({available:e})=>e&&`
            background-color: var(--intent-primary-100);
        `};
    }
`;Lf.propTypes=Koe;Lf.defaultProps=zoe;Lf.displayName="TdButton";const El=v.th.attrs(({as:e})=>!e&&{scope:"col"})`
    background-color: ${({highlight:e})=>e?"var(--intent-primary)":"var(--intent-contrast)"};
    ${({noBorder:e})=>e?"background: transparent;":""}
    border: ${({noBorder:e})=>e?"0":"var(--salt-border-1) solid var(--intent-secondary-900)"};
    border-block-end: 0;
    color: ${({highlight:e})=>e?"var(--intent-primary-contrast)":"var(--intent-content)"};
    padding-block: var(--salt-spacing-4);
    padding-inline: var(--salt-spacing-1);
`;El.propTypes=Qoe;El.defaultProps=Xoe;El.displayName="HeaderCell";const Qm=v.th.attrs({scope:"row"})`
    background-color: ${({highlight:e})=>e?"var(--intent-primary)":"var(--intent-secondary-100)"};
    border: var(--salt-border-1) solid var(--intent-secondary-900);
    color: ${({highlight:e})=>e?"var(--intent-primary-contrast);":"var(--intent-content)"};
    padding-block: var(--salt-spacing-4);
    padding-inline: var(--salt-spacing-1);
    text-align: center;
    ${re.xs`
        ${({fontWeight:e})=>e&&`font-weight: ${e};`}
        ${({fontSize:e})=>e&&`font-size: ${e};`}
    `}
`;Qm.propTypes=Qoe;Qm.defaultProps=Xoe;Qm.displayName="HeaderRowCell";const Fg=v.th.attrs(({as:e})=>!e&&{scope:"row"})`
    background: var(--intent-secondary);
    border: var(--salt-border-1) solid var(--intent-secondary-900);
    padding-inline: var(--salt-spacing-1);
    padding-block: 0;
    text-align: center;
    white-space: nowrap;
`;Fg.displayName="HeadingCell";const Cr=ae.forwardRef(({dateTimeMessage:e,slotId:t,onClick:n,available:o,highlight:r,select:a,dataSynthetics:i,children:l},c)=>n?s.jsx(wp,{slotId:t,children:s.jsx(Lf,{"aria-label":e,type:"button",onClick:n,available:o,highlight:r,select:a,ref:c,"data-synthetics":i,children:l})}):s.jsx(wp,{slotId:t,available:o,highlight:r,select:a,ref:c,"data-synthetics":i,children:l}));Cr.propTypes=rKt;Cr.defaultProps=aKt;Cr.displayName="Cell";Cr.getBackgroundColor=IM;Cr.Td=wp;Cr.TdButton=Lf;Cr.HeaderCell=El;Cr.HeaderRowCell=Qm;Cr.HeadingCell=Fg;const Zoe=(e,t,n)=>Object.values(e).find(o=>o.deliveryDestinationId===t||o.addressId===n),iKt=(e,t,n)=>{const o=Zoe(e,t,n);return o||{deliveryDestinationId:t}},lKt=()=>{const e=F(),t=f(Pf);return{selectAddress:h.useCallback((o,r)=>{const a=iKt(t,o,r);e(Wa.setSelectedAddress(a))},[e,t])}},cKt=()=>{const e=F(),t=f(Pf),n=f(mm),o=f(Ys),r=f(Po),a=Zoe(t,r),i=h.useCallback(()=>e(J.openModal(Gc)),[e]),{selectAddress:l}=lKt();return{anySlotListingRequestPending:n,deliveryMethod:o,selectedAddress:a,onChangeCollectionPoint:i,selectAddress:l,deliveryAddresses:t}},kf=()=>{const{anySlotListingRequestPending:e,deliveryMethod:t,selectedAddress:n,onChangeCollectionPoint:o,selectAddress:r,deliveryAddresses:a}=cKt();return s.jsx(Lu,{disabled:e,deliveryMethod:t,deliveryAddresses:Object.values(a),selectedAddress:n,onSelectAddress:r,onChooseDifferentCollectionPoint:o})},Joe=m.shape({partId:m.string.isRequired,name:m.string.isRequired,intervals:m.arrayOf(m.shape({intervalId:m.string.isRequired,end:m.string.isRequired,name:m.string.isRequired,order:m.number.isRequired,start:m.string.isRequired}))}),ere=m.shape({slotId:m.string.isRequired,slotDateTimeISO:m.string.isRequired,available:m.bool.isRequired,price:m.string.isRequired,ecoSlot:m.bool.isRequired}),tre=m.shape({slotId:m.string.isRequired,slotDateTimeISO:m.string.isRequired,slotDayId:m.string.isRequired,slotIntervalId:m.string.isRequired,slotPartId:m.string.isRequired,available:m.bool.isRequired,deliveryPrice:m.shape({currency:m.string.isRequired,amount:m.string.isRequired}).isRequired}),sre=m.shape({dayId:m.string.isRequired,dayName:m.string.isRequired,order:m.number.isRequired,iso:m.string,hasAnyAvailableSlot:m.bool}),dKt=m.shape({previous:m.string.isRequired,next:m.string.isRequired,alert:m.shape({title:m.string.isRequired,viewSlot:m.string.isRequired}).isRequired,slotAriaViewSlot:m.string.isRequired,slotAriaDate:m.string.isRequired,slotAriaTime:m.string.isRequired,slotAriaCost:m.string.isRequired,nextMonth:m.func.isRequired,currentMonth:m.func.isRequired,previousMonth:m.func.isRequired,datePickerAlternative:m.string.isRequired,fillerText:m.string.isRequired,previousCompleteText:m.string.isRequired,calendar:m.string.isRequired}),uKt={startDayIso:m.string,dateTime:m.objectOf(m.oneOfType([m.func,m.string])).isRequired,dateFormat:m.string.isRequired,timeFormat:m.string.isRequired,days:m.arrayOf(sre).isRequired,firstSlot:tre.isRequired,labels:dKt.isRequired,numberOfDisplayedDays:m.number,partsOfDay:m.arrayOf(Joe).isRequired,slots:m.objectOf(m.objectOf(m.objectOf(ere).isRequired).isRequired).isRequired,activeRawStandardSlotIdsMap:m.objectOf(m.string).isRequired,slotSelectionHandler:m.func.isRequired,impression:m.func,sendSlotbookingPageAttributes:m.func,sendQueuedImpressions:m.func,slotBookedSuccessfully:m.bool,isSlotFetching:m.bool.isRequired,hasSelectedSlotFetchError:m.bool.isRequired,shouldRenderDeliveryDetailsSelector:m.bool.isRequired,onDemandSlotsAvailable:m.bool.isRequired,onDemandSlotsComponent:m.node,timeZoneId:m.string.isRequired,isSaverSlotsVCEnabled:m.bool.isRequired,selectedSlotGroup:m.string,sendStandardSlotsButtonClickedEvent:m.func.isRequired,sendSaverSlotsButtonClickedEvent:m.func.isRequired,formatMessage:m.func.isRequired,timeRangeStyles:m.objectOf(m.shape({fontWeight:m.number,fontSize:m.string})),sendSeenSlots:m.func,carrierId:m.string,onDeliveryDetailsSaved:m.func.isRequired,cancelSlotSelection:m.func.isRequired,hasUnconfirmedSlot:m.bool.isRequired},pKt={numberOfDisplayedDays:3,impression:()=>{},sendSlotbookingPageAttributes:()=>{},sendQueuedImpressions:()=>{},slotBookedSuccessfully:!1,shouldRenderDeliveryDetailsSelector:!1,startDayIso:null,selectedSlotGroup:"standard",timeRangeStyles:{fontSize:"14px",fontWeight:600},sendSeenSlots:()=>{},carrierId:void 0},mKt=mH`
  html {
    scroll-behavior: smooth;
  }
`,SM=v.table`
    border-collapse: collapse;
    border-spacing: 0;
    table-layout: fixed;
    inline-size: 100%;
`,CM=v.thead``,vM=v.tbody``,Rd=v.tr``,hKt=v.span`
    display: block;
    font-weight: normal;
`,Bg=v.div`
    display: flex;
    justify-content: space-between;
`,XA="23rem",gKt="21rem",nre=v(Bg)`
    gap: var(--salt-spacing-2);
    min-inline-size: ${XA};
    inline-size: 100%;
    order: 1;
    ${re[br["md-up"].mediaQueryKey]`
         width: auto;
         max-width: ${gKt};
         order: unset;
    `}
`,EKt=v(Bg)`
    gap: var(--salt-spacing-2);
    ${re[br["md-up"].mediaQueryKey]`
        width: 23rem;
    `}
`,ore=v.div`
    display: flex;
    justify-content: flex-end;
    flex-wrap: wrap;
    gap: var(--salt-spacing-2);
`,qS=v.div`
    inline-size: 100%;

    ${({shouldUseThreeColumnLayout:e})=>re[br["md-up"].mediaQueryKey]`
        max-width: ${e?`calc(50% - (${XA} / 2) - var(--salt-spacing-2))`:`calc(100% - ${XA} - var(--salt-spacing-2))`};
    `}
`,fKt=v.div`
    inline-size: 100%;
    order: 0;
    ${re[br["md-up"].mediaQueryKey]`
       order: unset;
    `}
`,yKt=v(_s)`
    transform: scale(0.4);
    margin-inline-end: 0;
`,X$=v.span`
    flex-grow: 1;
    flex-basis: 0;
`,IKt=v.div`
    margin-inline-end: var(--salt-spacing-4);
    display: flex;
    place-content: center flex-end;
`,Z$=v(x)`
    && {
        position: relative;
        border: ${$(1)} solid transparent;

        ${({intent:e})=>e==="secondary"&&Pe`
                border-color: var(--intent-primary-100);
            `};
    }
`;let pr=class RI extends h.Component{static getImpressionData({day:t,interval:n,slot:o,slotPartId:r,timeZoneId:a}){const{start:i,end:l}=Jqt(t,n),c=RI.isSlotAvailable(o)&&!t.filler;return{intervalStart:i,intervalEnd:l,intervalStartDate:t.iso,intervalTimeZoneId:a,slotDayId:t.dayId,slotPartId:r,slotIntervalId:n.intervalId,isAvailable:c===void 0?!1:c,slotType:eP}}static isSlotAvailable(t){return t&&t.available&&t.price&&t.slotDateTimeISO}FIRST_AVAILABLE_SLOT_ID="first-available-slot";constructor(t){super(t),this.state={selectedSlot:{},selectedDay:{},selectedInterval:{},daysOffset:0,firstDisplayedDay:t.days[0],firstAvailableSlotAlertVisible:!1,displaySaverSlots:t.selectedSlotGroup==="saver",sendDataFeedOnce:!0},this.handlePreviousDays=this.handlePreviousDays.bind(this),this.handleNextDays=this.handleNextDays.bind(this),this.handleStandardSlotsButtonClick=this.handleStandardSlotsButtonClick.bind(this),this.handleSaverSlotsButtonClick=this.handleSaverSlotsButtonClick.bind(this),this.updateDisplayedDays=this.updateDisplayedDays.bind(this),this.days=this.props.days.slice(0),this.viewFirstAvailableSlot=this.viewFirstAvailableSlot.bind(this),this.shouldSendDataFeedAnalytics=this.shouldSendDataFeedAnalytics.bind(this),this.resetSlotSelection=this.resetSlotSelection.bind(this),this.firstAvailableSlotElement=ae.createRef(),this.getFirstAvailableSlotTime(),this.getFirstAvailableDay(),this.pushFillerDays(),this.impressionSent={},this.pageAttributesSent=!1}componentDidMount(){this.shouldShowFirstAvailableSlotAlertOnRender(),this.sendAnalyticsForPage(),this.shouldSendDataFeedAnalytics()&&this.handleDataFeedAnalytics(),this.props.startDayIso&&this.updateDisplayedDays(this.props.startDayIso)}componentDidUpdate(t,n){this.sendAnalyticsForPage(),this.shouldSendDataFeedAnalytics(n)&&this.handleDataFeedAnalytics(),this.checkForInvalidSlot(t)}isSlotSelected(){return this.state.selectedSlot.slotId}checkForInvalidSlot(t){t?.isSlotFetching&&!this.props.isSlotFetching&&this.props.hasSelectedSlotFetchError&&this.isSlotSelected()&&this.setState({selectedSlot:{},selectedDay:{},selectedInterval:{}})}handleNextDays(){const{daysOffset:t}=this.state;this.setState({daysOffset:Math.min(this.props.days.length-this.props.numberOfDisplayedDays,t+1),firstDisplayedDay:this.updateSelectedDay(1)})}handlePreviousDays(){const{daysOffset:t}=this.state;this.setState({daysOffset:Math.max(0,t-1),firstDisplayedDay:this.updateSelectedDay(-1)})}handleStandardSlotsButtonClick(){this.setState({displaySaverSlots:!1}),this.props.sendStandardSlotsButtonClickedEvent()}handleSaverSlotsButtonClick(){this.setState({displaySaverSlots:!0}),this.props.sendSaverSlotsButtonClickedEvent()}shouldSplitSlots(){if(!this.props.isSaverSlotsVCEnabled)return!1;const{partsOfDay:t}=this.props,n=t.filter(({partId:r})=>r!==$r).some(({intervals:r})=>r.length),o=t.find(({partId:r})=>r===$r)?.intervals.length>0;return n&&o}getPartsOfDay(){const{partsOfDay:t}=this.props;if(!this.shouldSplitSlots())return t;const{displaySaverSlots:n}=this.state;return t.filter(({partId:o})=>o===$r?n:!n)}displayPartsOfDayHeadings(){const{partsOfDay:t,isSaverSlotsVCEnabled:n}=this.props;return t.find(({partId:a})=>a===$r)?n?!this.state.displaySaverSlots:t.filter(({partId:a})=>a!==$r).some(({intervals:a})=>a.length):!0}getDisplayedDays(){const{numberOfDisplayedDays:t}=this.props,{daysOffset:n}=this.state,{days:o}=this;return o.filter((r,a)=>a>=n&&a<n+t)}getFirstAvailableDay(){const t=this.props.firstSlot.slotDayId,{days:n}=this.props;return n.filter(r=>r.dayId===t).pop()}getFirstAvailableSlotTime(){const{partsOfDay:t,firstSlot:n}=this.props,o=n.slotIntervalId,r=n.slotPartId;return t.filter(l=>l.partId===r).pop().intervals.filter(l=>l.intervalId===o).pop()}impressionsForShownSlots(){const{slots:t,timeZoneId:n}=this.props;this.getPartsOfDay().forEach(({partId:o,intervals:r})=>{r.forEach(a=>{this.getDisplayedDays().forEach(i=>{const l=`${i.dayId}-${o}-${a.intervalId}`,c=Vo(t,`${i.dayId}.${o}.${a.intervalId}`);this.impression(RI.getImpressionData({day:i,interval:a,slot:c,slotPartId:o,timeZoneId:n}),l)})})}),this.sendQueuedImpressions()}shouldSendDataFeedAnalytics(t){const n=t&&t?.daysOffset!==this.state.daysOffset,o=t&&t?.displaySaverSlots!==this.state.displaySaverSlots;return n||o||this.state.sendDataFeedOnce}handleDataFeedAnalytics(){const t=eKt({displayedGridDays:this.getDisplayedDays(),partOfDays:this.getPartsOfDay(),activeRawStandardSlotIdsMap:this.props.activeRawStandardSlotIdsMap});this.setState({sendDataFeedOnce:!1}),this.props.sendSeenSlots(t)}sendAnalyticsForPage(){const{partsOfDay:t,numberOfDisplayedDays:n}=this.props,a=t.map(i=>i.intervals.length).reduce((i,l)=>i+l)*n;this.sendSlotbookingPageAttributesIfNotSentYet(a),this.impressionsForShownSlots()}viewFirstAvailableSlot(){const t=this.getFirstAvailableDay().iso;this.updateDisplayedDays(t),requestAnimationFrame(()=>this.firstAvailableSlotElement.current?.focus())}isSelectedSlotDisplayed(){const{selectedDay:t,daysOffset:n}=this.state,{numberOfDisplayedDays:o}=this.props;return t.order>=n&&t.order<n+o}isHighlighted(t,n){const{selectedInterval:o,selectedDay:r}=this.state;return this.isSelectedSlotDisplayed()&&(t===o.order&&n<r.order||t<o.order&&n===r.order)}pushFillerDays(){const{numberOfDisplayedDays:t}=this.props,n=this.days[this.days.length-1],o=Array.from(Array(t-1)).map((r,a)=>({filler:!0,dayId:`filler-${a}`,iso:qs(Ta,uC(a+1,n?.dayId))}));this.days.push(...o)}isHeaderRowCellHighlighted(t){const{selectedInterval:n}=this.state;return this.isSelectedSlotDisplayed()&&n.intervalId===t}updateSelectedDay(t){const n=this.state.firstDisplayedDay.order+t;return this.days.filter(o=>o.order===n).pop()}impression(t,n){n!==void 0&&!this.impressionSent[n]&&(this.props.impression(t),this.impressionSent[n]=!0)}sendQueuedImpressions(){this.props.sendQueuedImpressions()}sendSlotbookingPageAttributesIfNotSentYet(t){this.pageAttributesSent||(this.props.sendSlotbookingPageAttributes(t),this.pageAttributesSent=!0)}selectSlot(t,n,o){this.isSlotSelected()||(this.props.slotSelectionHandler(t),this.setState({selectedSlot:t,selectedDay:n,selectedInterval:o}))}updateDisplayedDays(t){const n=this.days.find(o=>o.iso===t);n&&this.setState({firstDisplayedDay:n,daysOffset:n.order})}shouldShowFirstAvailableSlotAlertOnRender(){const{days:t,numberOfDisplayedDays:n,firstSlot:o}=this.props,r=t.filter(({dayId:a})=>a===o.slotDayId).pop();r&&(l=>l+1)(r.order)>n&&this.setState({firstAvailableSlotAlertVisible:!0})}renderCellIcon(t){const n=t===this.state.selectedSlot.slotId;return n&&this.props.slotBookedSuccessfully?s.jsx(IKt,{children:s.jsx(pe,{name:"status_yes",height:20})}):n&&this.props.isSlotFetching?s.jsx(yKt,{"data-test":"slot-spinner"}):null}renderCells(t,n,o){const{dateFormat:r,labels:a,slots:i,timeFormat:l,firstSlot:c,dateTime:d}=this.props,{formatDateWithFixedTimezone:u}=d,{selectedSlot:p}=this.state,g=Vo(i,`${t.dayId}.${o}.${n.intervalId}`),E=this.isHighlighted(n.order,t.order);if(RI.isSlotAvailable(g)){const y=u(g.slotDateTimeISO,r),I=u(n.start,l),S=u(n.end,l),C=[`${a.slotAriaDate}, ${y}`,`${a.slotAriaTime}, ${I} - ${S}`,`${a.slotAriaCost}, ${g.price}`,...g.ecoSlot?[this.props.formatMessage("accessibility.eco.slot.label")]:[]].join(", "),T=g.slotId===c.slotId;return s.jsxs(Cr,{dateTimeMessage:C,slotId:g.slotId,select:g.slotId===p.slotId,highlight:E,available:g.available,onClick:()=>this.selectSlot(g,t,n),dataSynthetics:"selectable-slot",ref:T?this.firstAvailableSlotElement:null,children:[s.jsx(X$,{children:this.renderCellIcon(g.slotId)}),s.jsx("span",{"data-test":E?"highlighted-slot":"selectable-slot",id:T?this.FIRST_AVAILABLE_SLOT_ID:void 0,children:g.price}),g.ecoSlot&&s.jsx(pe,{"data-test":"eco-slot-icon",className:"salt-m-l--2",name:"eco_slot",success:!0}),s.jsx(X$,{})]},g.slotId)}return t.filler?s.jsx(Cr,{highlight:!1,available:!1},t.dayId):s.jsx(Cr,{highlight:E,available:!1,children:""},`${t.dayId}${o}${n.intervalId}`)}renderButtonRow(t=Bg){const{numberOfDisplayedDays:n,labels:o,dateTime:r,dateFormat:a}=this.props,{daysOffset:i,firstDisplayedDay:l}=this.state,{days:c}=this,u=`salt-m-b--2 ${t===Bg?"salt-m-t--2 md:salt-m-t--0 md:salt-m-b--4":"md:salt-m-b--2"}`;return s.jsx(t,{className:u,children:s.jsx(Zqt,{labels:o,daysOffset:i,dateTime:r,onPrevBtnClick:this.handlePreviousDays,onNextBtnClick:this.handleNextDays,days:c,numberOfDisplayedDays:n,firstDisplayedDay:l,onDaySelect:this.updateDisplayedDays,dateFormat:a})})}renderOnDemandSlots(t=ae.Fragment){return s.jsx(t,{children:this.props.onDemandSlotsComponent})}resetSlotSelection(){this.setState({selectedSlot:{},selectedDay:{},selectedInterval:{}}),this.props.cancelSlotSelection()}renderSelectorsAndButtonRow(t){const{shouldRenderDeliveryDetailsSelector:n,onDeliveryDetailsSaved:o,hasUnconfirmedSlot:r}=this.props,a=!!n;return s.jsxs(h.Fragment,{children:[s.jsx(Lu.Title,{}),s.jsxs(ore,{children:[s.jsx(qS,{shouldUseThreeColumnLayout:a,children:s.jsx(kf,{})}),n&&s.jsx(qS,{shouldUseThreeColumnLayout:a,children:s.jsx(Nf,{onDeliveryDetailsSaved:o,handleModalClose:this.resetSlotSelection,hasUnconfirmedSlot:r})}),this.renderButtonRow(nre),t&&this.renderOnDemandSlots(fKt)]})]})}renderFirstAvailableSlotAlert(){const{labels:t,onDemandSlotsAvailable:n}=this.props;return this.state.firstAvailableSlotAlertVisible&&!n?s.jsx(Te,{intent:"success",className:"salt-m-b--4",showIcon:!1,text:s.jsxs(O,{children:[s.jsx(O,{bold:!0,children:`${t.alert.title} `}),`${this.getFirstAvailableDay().dayName} ${this.getFirstAvailableSlotTime().name} `]}),link:s.jsx(tt,{decorated:!0,onClick:this.viewFirstAvailableSlot,"aria-label":t.slotAriaViewSlot,href:`#${this.FIRST_AVAILABLE_SLOT_ID}`,children:t.alert.viewSlot})}):null}renderSaverSlotButtons(){if(!this.shouldSplitSlots())return null;const{displaySaverSlots:t}=this.state;return s.jsxs(EKt,{className:"salt-m-b--2 sm:salt-m-b--2 md:salt-m-b--4 salt-m-t--2",children:[s.jsx(Z$,{fill:!0,intent:t?"tertiary-contrast":"secondary",onClick:this.handleStandardSlotsButtonClick,"aria-pressed":!t,children:s.jsx(b,{id:"slotbooking.standard.slots.button"})}),s.jsxs(Z$,{fill:!0,intent:t?"secondary":"tertiary-contrast",onClick:this.handleSaverSlotsButtonClick,"aria-pressed":t,"data-test":"saver-slots-button",children:[s.jsx(b,{id:"slotbooking.saver.slots.button"}),s.jsx(qoe,{})]})]})}render(){const{labels:t,timeRangeStyles:n}=this.props,{selectedDay:o}=this.state,r=this.props.onDemandSlotsAvailable,a=this.getPartsOfDay(),i=this.displayPartsOfDayHeadings();return s.jsxs("div",{children:[s.jsx(mKt,{}),this.renderSelectorsAndButtonRow(r),this.renderFirstAvailableSlotAlert(),this.renderSaverSlotButtons(),s.jsxs(SM,{children:[s.jsx(CM,{children:s.jsxs(Rd,{"data-test":"slot-booking-header-row",children:[s.jsx(El,{as:"td",noBorder:!0}),(()=>{let l=!1;return this.getDisplayedDays().map(({filler:c,dayId:d,dayName:u})=>c?l?null:(l=!0,s.jsx(El,{colSpan:this.props.numberOfDisplayedDays-(this.props.days.length-this.state.daysOffset),children:t.fillerText},d)):s.jsx(El,{highlight:o.dayId===d,children:u},d))})()]})}),a.map(({partId:l,name:c,intervals:d})=>s.jsxs(vM,{children:[i&&d.length>0?s.jsxs(Rd,{children:[s.jsx(Fg,{children:c}),s.jsx(Fg,{colSpan:this.props.numberOfDisplayedDays,as:"td"})]}):null,d.map(u=>s.jsxs(Rd,{children:[s.jsx(Qm,{fontWeight:n?.fontWeight,fontSize:n?.fontSize,highlight:this.isHeaderRowCellHighlighted(u.intervalId),children:u.name}),this.getDisplayedDays().map(p=>this.renderCells(p,u,l))]},u.intervalId))]},l))]})]})}};pr.propTypes=uKt;pr.defaultProps=pKt;pr.displayName="Slotbooking";pr.formattedPartOfDayPropType=Joe;pr.formattedSlotPropType=ere;pr.slotPropType=tre;pr.formattedDayPropType=sre;pr.Table=SM;pr.Header=CM;pr.Body=vM;pr.Row=Rd;pr.Day=hKt;pr.ButtonRow=Bg;pr.Cell=Cr;const rx=v(x)`
    ${re.smUp`
        width: auto;
    `}
    flex: 1;
`,SKt=({prevBtnLabel:e,nextBtnLabel:t,calendarBtnLabel:n})=>s.jsxs(h.Fragment,{children:[s.jsxs(rx,{className:"salt-p-x--0",intent:"secondary",disabled:!0,fill:!0,children:[s.jsx(x.Icon,{name:"arrow_left"}),s.jsx(x.Text,{className:"xs:max-sm:salt-vc",children:e})]}),s.jsxs(rx,{className:"salt-p-x--0 salt-m-x--1",intent:"secondary",disabled:!0,children:[s.jsx(x.Icon,{name:"calendar"}),s.jsx(x.Text,{className:"xs:max-sm:salt-vc",children:n})]}),s.jsxs(rx,{className:"salt-p-x--0",intent:"secondary",disabled:!0,fill:!0,children:[s.jsx(x.Text,{className:"xs:max-sm:salt-vc",children:t}),s.jsx(x.Icon,{name:"arrow_right"})]})]}),CKt=({showDeliveryDetailsPlaceholder:e,labels:t})=>{const n=s.jsx(SKt,{prevBtnLabel:t.previous,nextBtnLabel:t.next,calendarBtnLabel:t.calendar}),o=s.jsxs("div",{className:"salt-m-b--2",children:[s.jsx(Lu.Title,{}),s.jsxs(ore,{children:[s.jsx(qS,{shouldUseThreeColumnLayout:e,children:s.jsx(kf,{})}),e&&s.jsx(qS,{shouldUseThreeColumnLayout:!0,children:s.jsx(Nf.Skeleton,{})}),s.jsxs(nre,{children:[" ",n," "]})]})]});return s.jsxs("div",{"data-test":"slot-grid-skeleton",children:[o,s.jsxs(SM,{children:[s.jsx(CM,{children:s.jsxs(Rd,{children:[s.jsx(El,{}),["day1","day2","day3"].map(r=>s.jsxs(El,{children:[s.jsx(_e,{width:"40px",height:"15px",className:"salt-d--inline-block"}),s.jsx("div",{children:s.jsx(_e,{width:"60px",height:"15px",className:"salt-d--inline-block"})})]},r))]})}),["part1","part2","part3"].map(r=>s.jsxs(vM,{children:[s.jsx(Rd,{children:s.jsx(Fg,{colSpan:4,children:s.jsx(_e,{width:"0px",height:"15px"})})}),["time1","time2","time3","time4","time5"].map(a=>s.jsxs(Rd,{children:[s.jsx(Qm,{children:s.jsx(_e,{width:"50px",height:"15px"})}),["slot1","slot2","slot3"].map(i=>s.jsx(Cr,{children:s.jsx(_e,{width:"30px",height:"15px",className:"salt-d--inline-block"})},i))]},a))]},r))]})]})},J$=({className:e="",shouldRenderDeliveryDetailsSelector:t,onDeliveryDetailsSaved:n,cancelSlotSelection:o,hasUnconfirmedSlot:r})=>s.jsx("div",{className:"salt-p-b--2",children:s.jsxs("div",{className:`salt-m-b--2 ${e}`,children:[s.jsx(Lu.Title,{}),s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,lg:t?6:12},children:s.jsx(kf,{})}),t&&s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(Nf,{onDeliveryDetailsSaved:n,handleModalClose:o,hasUnconfirmedSlot:r})})]})]})}),vKt=D("mtz"),TKt=D("mtzsb"),_Kt=D("sv.sl"),bKt=D("sv.sl.vb"),xKt=D("sl.rng.cf"),AKt=v.div`
    display: flex;
    align-items: center;
`,RKt={days:[],isSlotbookingDataPending:!1,slotBookedSuccessfully:!1,partsOfDay:[],slots:[],timeZoneId:null,selectedDeliveryDestinationId:null,isBasketDeliveryDestinationDeliverable:!1};let DKt=class extends h.Component{static defaultProps=RKt;queuedImpressions=[];labels;footerMessage;constructor(t){super(t),this.slotSelectionHandler=this.slotSelectionHandler.bind(this),this.queueImpression=this.queueImpression.bind(this),this.sendStandardSlotsButtonClickedEvent=this.sendStandardSlotsButtonClickedEvent.bind(this),this.sendSaverSlotsButtonClickedEvent=this.sendSaverSlotsButtonClickedEvent.bind(this),this.sendOnDemandSlotsImpression=this.sendOnDemandSlotsImpression.bind(this),this.sendSeenSlots=this.sendSeenSlots.bind(this),this.sendSeenSlotsForOnDemandSlotsOnly=this.sendSeenSlotsForOnDemandSlotsOnly.bind(this),this.sendPerformanceMark=this.sendPerformanceMark.bind(this),this.onDeliveryDetailsSaved=this.onDeliveryDetailsSaved.bind(this),this.cancelSlotSelection=this.cancelSlotSelection.bind(this),this.queuedImpressions=[],this.state={selectedSlot:null,unconfirmedSlot:null},this.labels={alert:{title:t.intl.formatMessage("slotbooking.alert.first.available.slot"),viewSlot:t.intl.formatMessage("slotbooking.alert.first.available.slot.view")},next:t.intl.formatMessage("slotbooking.table.next.days"),previous:t.intl.formatMessage("slotbooking.table.previous.days"),previousCompleteText:t.intl.formatMessage("slotbooking.table.previous.days.complete.text"),fillerText:t.intl.formatMessage("slotbooking.table.filler.text"),weekDays:{sun:t.intl.formatMessage("slotbooking.table.week.days.sun"),mon:t.intl.formatMessage("slotbooking.table.week.days.mon"),tue:t.intl.formatMessage("slotbooking.table.week.days.tue"),wed:t.intl.formatMessage("slotbooking.table.week.days.wed"),thu:t.intl.formatMessage("slotbooking.table.week.days.thu"),fri:t.intl.formatMessage("slotbooking.table.week.days.fri"),sat:t.intl.formatMessage("slotbooking.table.week.days.sat")},calendar:t.intl.formatMessage("slotbooking.table.calendar.header"),cancel:t.intl.formatMessage("slotbooking.table.calendar.cancel.link"),slotAriaViewSlot:t.intl.formatMessage("slotbooking.aria.view.first.slot"),slotAriaDate:t.intl.formatMessage("slotbooking.table.cell.aria.date"),slotAriaTime:t.intl.formatMessage("slotbooking.table.cell.aria.time"),slotAriaCost:t.intl.formatMessage("slotbooking.table.cell.aria.price"),nextMonth:n=>t.intl.formatMessage("calendar.next.month",{month:n}),currentMonth:n=>t.intl.formatMessage("calendar.current.month",{month:n}),previousMonth:n=>t.intl.formatMessage("calendar.previous.month",{month:n}),datePickerAlternative:t.intl.formatMessage("calendar.alternative"),slotsUnavailable:{body:t.intl.formatMessage("slotbooking.slot.unavailable.body")}},this.footerMessage=t.intl.formatMessage("slotbooking.table.footer")}componentDidMount(){this.sendImpressions()}componentDidUpdate(t){const n=t.isSlotbookingDataPending&&!this.props.isSlotbookingDataPending,{actions:o}=this.props;n&&o.performanceMark({name:VY}),this.sendImpressions()}getDeliveryPriceInfo({slotDayId:t,slotPartId:n,slotIntervalId:o}){return this.props.slots.filter(r=>r.slotDayId===t).filter(r=>r.slotPartId===n).filter(r=>r.slotIntervalId===o).map(r=>r&&r.deliveryPrice?{DELIVERY_PRICE_AMOUNT:r.deliveryPrice.amount,DELIVERY_PRICE_CURRENCY:r.deliveryPrice.currency}:{})[0]||{}}getTimeZoneMessage(){const{timeZoneId:t,defaultTimeZoneId:n,multiTimeZoneEnabled:o,multiTimeZoneSlotBookingEnabled:r,serverRendered:a}=this.props,i=this.props.deliveryMethod===pt.clickAndCollect.method?"slotbooking.delivery.cnc.timezone.alert":"slotbooking.delivery.home.timezone.alert";return!a&&o&&r&&t&&t!==sg(n)&&s.jsx(Te,{intent:"info",text:s.jsx(b,{id:i}),className:"salt-m-y--4","data-test":"timezone-message"})||null}findSlot(t){const{slots:n,onDemandSlots:o=[]}=this.props;return[...o,...n].find(a=>a.slotId===t?.slotId)}getTimeRangeStyles(){const{slotTimeRangeConfigurationEnabled:t,timeRangeStyles:n}=this.props;return t?n:null}onDeliveryDetailsSaved(t){this.state.unconfirmedSlot&&(this.slotSelectionHandler(this.state.unconfirmedSlot,()=>{},()=>{},t),this.setState({unconfirmedSlot:null}))}cancelSlotSelection(){this.setState({unconfirmedSlot:null,selectedSlot:null})}slotSelectionHandler(t,n=()=>{},o=()=>{},r){const{actions:a,deliveryType:i,deliveryMethod:l,selectedDeliveryDestinationId:c,isDeliveryAdditionalInfoFeatureEnabled:d,deliveryDetailsOptions:u,isDeliveryDetailsFeatureEnabled:p,isDeliveryAssetsFeatureEnabled:g,shouldPrepareDeliveryDetails:E}=this.props;this.setState({selectedSlot:t},()=>{const y=this.findSlot(t);if(!y)return;if(E&&!Hoe({deliveryOptions:r??u,featureFlags:{isDropOffRequired:p,isDeliveryAssetRequired:g,isAdditionalInfoRequired:d}})){a.openModal(vf),this.setState({unconfirmedSlot:y});return}const{deliveryPrice:I,minimumOrder:S,slotId:C}=y;this.sendPerformanceMark(),a.selectSlot({slotId:C,deliveryPrice:I,minimumOrder:S,deliveryType:i,deliveryMethod:l,deliveryDestinationId:c},this.props.navigate).then(n).catch(o)})}formatDays(){const{dateFormat:t,days:n}=this.props,{formatDateWithFixedTimezone:o}=Ih;return n?.map(r=>({dayId:r.dayId,dayName:o(r.date,t),order:r.order,iso:r.date,hasAnyAvailableSlot:r.hasAnyAvailableSlot}))||[]}formatIntervalFromConfig(t,n){const{slotTimeRangeConfigurationEnabled:o,intl:r,timeFormat:a}=this.props,{formatInterval:i,getFormattedIntervalDates:l}=Ih;if(!o)return i(t,n,a);const{timeRangeFormat:{startFormat:c,endFormat:d}}=this.props,{fromDate:u,toDate:p}=l(t,n,c,d);return r.formatMessage("slotbooking.table.time.range.format",{startTime:u,endTime:p})}formatPartsOfDay(){return this.props.partsOfDay?.map(({partId:t,intervals:n})=>({partId:t,name:this.props.intl.formatMessage(`slotbooking.table.part.of.day.${t}`),intervals:n.map(({intervalId:o,start:r,end:a,order:i})=>({intervalId:o,name:this.formatIntervalFromConfig(r,a),order:i,start:r,end:a}))}),{})||[]}formatDeliveryPrice(t){return t?parseFloat(t.amount)===0?this.props.intl.formatMessage("slotbooking.table.price.free"):ii(this.props.intl.formatNumber,t,this.props.currencyFormat):null}formatSlots(){return this.props.slots?.reduce((t,n)=>{const{slotDateTimeISO:o,slotDayId:r,slotPartId:a,slotIntervalId:i,slotId:l,deliveryPrice:c,minimumOrder:d,attributes:u}=n;if(a){const p=wqt(n,this.props.deliveryMethod);t[r]=t[r]||{},t[r][a]=t[r][a]||{},t[r][a][i]={slotId:l,available:u.includes("AVAILABLE"),price:this.formatDeliveryPrice(c),minimumOrder:d,slotDateTimeISO:o,ecoSlot:p}}return t},{})}sendImpressions(){if(this.queuedImpressions.length>0){const t=this.queuedImpressions;this.props.actions.analyticsEvent({type:Ve.SLOT_IMPRESSION,impressions:t}),this.queuedImpressions=[]}this.sendSeenSlotsForOnDemandSlotsOnly()}queueImpression(t){const n={INTERVAL_START:t.intervalStart,INTERVAL_END:t.intervalEnd,INTERVAL_START_DATE:t.intervalStartDate,INTERVAL_TIME_ZONE_ID:t.intervalTimeZoneId,IS_AVAILABLE:t.isAvailable,SLOT_TYPE:t.slotType,...this.getDeliveryPriceInfo(t)};this.queuedImpressions.push(n)}sendOnDemandSlotsImpression(t){this.props.actions.analyticsEvent({type:Ve.SLOT_IMPRESSION,impressions:[t]})}sendPerformanceMark(){this.props.actions.performanceMark({name:WY,attributes:{deliveryType:this.props.deliveryType,deliveryMethod:this.props.deliveryMethod}})}sendSlotbookingPageAttributes(t){this.props.actions.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{SLOTBOOKING_MAX_SLOTS:t,SLOTBOOKING_ADDRESS_ID:this.props.selectedAddressId,SLOTBOOKING_DELIVERY_DESTINATION_ID:this.props.selectedDeliveryDestinationId,DEFAULT_DELIVERY_DESTINATION_ID_AVAILABLE:this.props.isBasketDeliveryDestinationDeliverable}})}sendStandardSlotsButtonClickedEvent(){this.props.actions.analyticsEvent({type:Ve.STANDARD_SLOTS_BUTTON_CLICKED,description:Wr[Ve.STANDARD_SLOTS_BUTTON_CLICKED]}),this.props.setSearchParams(t=>(t.set("slotGroup","standard"),t))}sendSaverSlotsButtonClickedEvent(){this.props.actions.analyticsEvent({type:Ve.SAVER_SLOTS_BUTTON_CLICKED,description:Wr[Ve.SAVER_SLOTS_BUTTON_CLICKED]}),this.props.setSearchParams(t=>(t.set("slotGroup","saver"),t))}slotSelectionHandlerPromise(){return t=>new Promise((n,o)=>{this.slotSelectionHandler(t,n,o)})}getCarrierIdForAnalytics(){return this.props.slots[0]?.carrierId}sendSeenSlots(t){const{onDemandSlots:n}=this.props,o=n.map(r=>r.slotId);this.props.actions.sendSeenSlots({seenSlots:[...o,...t]})}sendSeenSlotsForOnDemandSlotsOnly(){!this.props.slots.length&&this.props.onDemandSlotsAvailable&&this.sendSeenSlots([])}renderOnDemandSlots(){return s.jsx($oe,{onReserve:this.slotSelectionHandlerPromise(),sendImpression:this.sendOnDemandSlotsImpression,className:"salt-p-y--2 md:salt-m-t--0",classNameForCard:"salt-m-l--2"})}renderSelectSlotModal(){const{selectedSlot:t}=this.state;return s.jsx(Ad,{selectedSlot:t,slotSelectionHandler:()=>this.slotSelectionHandler(t),fetchSlots:this.props.fetchSlots})}render(){const{slots:t,activeRawStandardSlotIdsMap:n,isSlotbookingDataPending:o,shouldPrepareDeliveryDetails:r,selectedDeliveryDestinationId:a,areAddressesFetching:i,dropOffOptions:l,onDemandSlotsAvailable:c}=this.props,d=!t.length&&i,u=!!t.length||c,p=r&&u&&!!l.length;if(o||!a||d)return s.jsxs(h.Fragment,{children:[this.renderSelectSlotModal(),s.jsx(CKt,{showDeliveryDetailsPlaceholder:r,labels:this.labels})]});if(!u)return s.jsxs("div",{className:"salt-p-b--2",children:[s.jsx(J$,{className:"salt-m-y--0",shouldRenderDeliveryDetailsSelector:p,onDeliveryDetailsSaved:this.onDeliveryDetailsSaved,cancelSlotSelection:this.cancelSlotSelection,hasUnconfirmedSlot:!!this.state.unconfirmedSlot}),s.jsx(Te,{className:"salt-m-b--2","data-synthetics":"no-slots-warning",intent:"error",showIcon:!1,text:this.labels.slotsUnavailable.body})]});if(t.length){const g=this.formatSlots(),E=Object.values(g).some(y=>Object.values(y).some(I=>Object.values(I).some(S=>S.ecoSlot)));return s.jsxs(h.Fragment,{children:[this.getTimeZoneMessage(),s.jsx(pr,{startDayIso:this.props.startDayIsoFromUrlParams,shouldRenderDeliveryDetailsSelector:p,onDemandSlotsAvailable:c,onDemandSlotsComponent:this.renderOnDemandSlots(),dateFormat:this.props.dateFormat,days:this.formatDays(),firstSlot:this.props.slots[0],dateTime:Ih,labels:this.labels,partsOfDay:this.formatPartsOfDay(),slots:g,activeRawStandardSlotIdsMap:n,slotSelectionHandler:this.slotSelectionHandler,timeRangeStyles:this.getTimeRangeStyles(),timeFormat:this.props.timeFormat,timeZoneId:this.props.timeZoneId,impression:y=>{this.queueImpression(y)},sendSlotbookingPageAttributes:y=>{this.sendSlotbookingPageAttributes(y)},sendQueuedImpressions:()=>this.sendImpressions(),slotBookedSuccessfully:this.props.slotBookedSuccessfully,isSlotFetching:this.props.isSlotFetching,hasSelectedSlotFetchError:this.props.hasSelectedSlotFetchError,selectedSlotGroup:this.props.selectedSlotGroup,isSaverSlotsVCEnabled:this.props.saverSlotsEnabled&&!this.props.saverSlotsVBEnabled,sendStandardSlotsButtonClickedEvent:this.sendStandardSlotsButtonClickedEvent,sendSaverSlotsButtonClickedEvent:this.sendSaverSlotsButtonClickedEvent,formatMessage:this.props.intl.formatMessage,carrierId:this.getCarrierIdForAnalytics(),sendSeenSlots:this.sendSeenSlots,onDeliveryDetailsSaved:this.onDeliveryDetailsSaved,cancelSlotSelection:this.cancelSlotSelection,hasUnconfirmedSlot:!!this.state.unconfirmedSlot}),this.footerMessage?.length>0&&s.jsx("div",{className:"salt-m-y--4",children:s.jsx(O,{children:this.footerMessage})}),E&&s.jsxs(AKt,{className:"salt-m-y--4",children:[s.jsx(pe,{className:"salt-m-r--2 salt--r--2",name:"eco_slot",success:!0}),s.jsx(O,{children:this.props.intl.formatMessage("slots_grid_green_van_footer_message")})]}),this.renderSelectSlotModal()]})}return s.jsxs("div",{className:"salt-m-b--2",children:[s.jsx(J$,{shouldRenderDeliveryDetailsSelector:p,onDeliveryDetailsSaved:this.onDeliveryDetailsSaved,cancelSlotSelection:this.cancelSlotSelection,hasUnconfirmedSlot:!!this.state.unconfirmedSlot}),this.renderOnDemandSlots(),this.renderSelectSlotModal()]})}};const OKt=e=>({partsOfDay:Eu(e),days:rP(e),slots:mP(e),activeRawStandardSlotIdsMap:R4(e),onDemandSlots:EP(e),selectedAddressId:J8(e)??zs(e).data?.addressId,selectedDeliveryDestinationId:Po(e)??zs(e).data?.deliveryDestinationId,isBasketDeliveryDestinationDeliverable:RC(e),isSlotbookingDataPending:DE(e),hasSelectedSlotFetchError:NP(e),slotBookedSuccessfully:K4(e),dateFormat:Zt(e),timeFormat:Mt(e),timeRangeStyles:fde(e),timeRangeFormat:TR(e),defaultTimeZoneId:Xd(e),timeZoneId:_Ve(e),multiTimeZoneEnabled:vKt(e),multiTimeZoneSlotBookingEnabled:TKt(e),onDemandSlotsAvailable:vVe(e),serverRendered:Rt(e),isSlotFetching:LE(e),startDayIsoFromUrlParams:UL(e),saverSlotsEnabled:_Kt(e),saverSlotsVBEnabled:bKt(e),selectedSlotGroup:dm(e),slotTimeRangeConfigurationEnabled:xKt(e),seasonalSlotPeriods:hP(e),dropOffOptions:n_(e),deliveryDetailsOptions:Hl(e),isDeliveryDetailsFeatureEnabled:D("dede")(e),isDeliveryAssetsFeatureEnabled:D("dass")(e),isDeliveryAdditionalInfoFeatureEnabled:D("daddi")(e),currencyFormat:Bi(e)}),PKt=st({selectSlot:EM.selectSlot,analyticsEvent:U.analyticsEvent,performanceMark:ds,sendSeenSlots:Zx.seenSlots,openModal:J.openModal}),NKt=Tt(Ht,we(OKt,PKt))(DKt),LKt=({data:e})=>e.adverts.slotBookingPage,rre=()=>{const[e]=Ee(["sl.ec.bs"]),{placement:t,isFetching:n,settings:o}=f(LKt),r=f(pP),a="advertising-banner-below-slot-booking",i=t.belowGrid||[],l=!!i.length,c=f(Ys),d=c==="CUSTOMER_COLLECTION"&&e||c==="HOME_DELIVERY",u=f(qi),p=f(Vi),g=d&&p?.slotType==="ON_DEMAND"&&p.deliveryMethod===c&&p.deliveryDestinationId===u,y=l&&(r||g)&&!n;return s.jsx($at,{children:y?s.jsx(Lm,{"data-test":a,adverts:i,advertDimensionsMap:ST,page:"slot-booking",pageKey:void 0,placement:"BELOW_GRID",randomInitialIndex:o.randomizeInitialHorizontalAdvert,sizes:["LARGE","MEDIUM","SMALL"]}):null})},kKt=({onRetry:e=()=>{}})=>s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{title:"carriers-slot-booking.geowidget.empty.title",titleIcon:"status_no",description:"carriers-slot-booking.geowidget.empty.text",primaryButton:{text:"carriers-slot-booking.geowidget.empty.button.text",onClick:e}})})}),e1="geowidget",ax="onSelectInPostPoint",jKt=e=>!!e.detail?.api,MKt=({onPointSelected:e,onApiLoaded:t,onError:n=()=>{},language:o="pl",config:r="parcelCollect"})=>{const a=f(i=>Ze(i,"inpost-geowidget-token"));return h.useEffect(()=>{const i=document.getElementById(e1);i?.addEventListener("inpost.geowidget.init",u=>{jKt(u)&&(t(u.detail.api),i.style.display="initial")});const l=document.createElement("link"),c=document.createElement("script"),d=document.getElementsByTagName("body")[0];return l.id="inpost-stylesheet",l.rel="stylesheet",l.href="https://geowidget.inpost.pl/inpost-geowidget.css",l.type="text/css",c.id="inpost-script",c.defer=!0,c.src="https://geowidget.inpost.pl/inpost-geowidget.js",c.addEventListener("error",()=>n()),d?.appendChild(l),d?.appendChild(c),()=>{d?.removeChild(l),d?.removeChild(c)}},[]),h.useEffect(()=>(window[ax]=e,()=>{delete window[ax]}),[e]),ae.createElement("inpost-geowidget",{style:{display:"none"},id:e1,token:a,onPoint:ax,language:o,config:r,"data-test":"inpost-geowidget-component"})},wKt=v(Q)`
    inline-size: calc(100% - 30px);
    gap: var(--salt-spacing-1);
`,are=({iconName:e,title:t,subTitle:n,bodyText:o,className:r})=>s.jsx(xe,{className:r,children:s.jsxs(Q,{children:[s.jsx(pe,{name:e,className:"salt-m-r--2",height:21,width:21}),s.jsxs(wKt,{direction:"column",children:[s.jsx(O,{size:"l",bold:!0,children:t}),s.jsx(ee,{as:"span",children:n}),s.jsxs(O,{children:[" ",o," "]})]})]})}),ire="560px",FKt=v.div`
    block-size: 70vb;
    min-block-size: ${ire};
`,BKt=(e,t)=>t?.attributes.includes("REPRICEABLE")?e.formatMessage("carriers-slot-booking.slot-info",{info:e.formatMessage("slot.repriceable.text"),additionalInfo:e.formatMessage("carriers-slot-booking.geowidget.additional.info")}):e.formatMessage("carriers-slot-booking.geowidget.additional.info"),lre=({slot:e,carrier:t,onContinueCheckout:n,className:o=""})=>{const r=L(),a=bE(t),[i,l]=h.useState(!1),[c,d]=h.useState(!1),{data:u}=f(zs),{courierSlotImpression:p}=Or(),g=g4(t.slotTimesDisplayMode,e,t.title,r),E=y=>{d(!0),u?.coordinates&&y.changePosition({latitude:u.coordinates.latitude,longitude:u.coordinates.longitude})};return h.useEffect(()=>{p(e)},[e]),s.jsxs("div",{className:o,children:[s.jsx(are,{className:"salt-m-b--4",iconName:"third_party_shipping",title:g,subTitle:a,bodyText:BKt(r,e)}),i?s.jsx(kKt,{onRetry:()=>l(!1)}):s.jsxs(FKt,{className:"salt-m-y--2",children:[!c&&s.jsx(_e,{"data-test":"in-post-map-skeleton",height:ire}),s.jsx(MKt,{onApiLoaded:E,onPointSelected:n,onError:()=>l(!0)})]})]})},UKt=({loading:e=!1,onContinueCheckout:t=()=>{}})=>{const n=L();return s.jsx(x,{intent:"action",onClick:e?void 0:t,className:"salt-m-y--2",loading:e,disabled:e,children:s.jsx(x.Text,{children:n.formatMessage("carriers-slot-booking.continue.checkout-button")})})},cre=v.div`
    display: flex;
    position: relative;
    justify-content: center;
    inline-size: 100%;
    padding-block-end: var(--salt-spacing-4);
`,TM=v(V)`
    inline-size: 100%;
`,GKt=v.table`
    border-collapse: separate;
    border-spacing: 0;
    table-layout: fixed;
    inline-size: calc(100% + var(--salt-spacing-1));

    & tbody:first-of-type tr:first-child td {
        padding-block-start: var(--salt-spacing-2);
    }
`,$Kt=v.thead`
    position: sticky;
    inset-block-start: ${({top:e})=>e};
    z-index: 1;
    background-color: var(--background-color);
`,HKt=v.div`
    position: relative;
    inline-size: 100%;
    block-size: 100%;
    display: flex;
    align-items: center;
`,_M=v.td`
    block-size: 32px;
    text-align: center;
    align-content: center;
    border-radius: var(--salt-radius-default);
    padding: ${({isMobile:e})=>e?"calc(var(--salt-spacing-1) * 0.5)":"var(--salt-spacing-1)"};
`,VKt=v.div`
    inline-size: ${({width:e})=>e||"100%"};
`,WKt=v(_M)`
    text-align: start;
`,YKt=v.div`
    position: absolute;
    block-size: 32px;
    border-end-start-radius: var(--salt-radius-default);
    border-start-start-radius: var(--salt-radius-default);
    background-image: linear-gradient(to right, rgba(255 255 255 / 80%), rgba(255 255 255 / 10%));
    inline-size: 12px;
    inset-inline-end: -14px;
`,qKt=v.th`
    block-size: 100%;
    inset-inline-end: -8px;
    position: absolute;
    background-color: var(--background-color);
    inline-size: 8px;
    inset-block-start: 0;
`,dre=v.th`
    padding-block: var(--salt-spacing-2);
`,KKt=v.th`
    padding: 0;
`,zKt=v(dre)`
    block-size: var(--salt-spacing-4);
    text-align: center;
    font-weight: 600;
`,QKt=v(dre)`
    text-align: start;

    button {
        padding: 0;
    }
`,XKt=v.div`
    display: flex;
    align-items: center;
`,ZKt=v.div`
    display: flex;
    gap: 5px;
    block-size: 32px;
`,t1=v(_M)`
    block-size: 16px;
    font-weight: bold;
    text-align: start;
    z-index: -1; /* TODO refactor z-indexes, -1 fixes overflow with calendar */
`,JKt=Fi`
    0% { opacity: 0; }
    100% { opacity: 1; }
`,ezt=v(_M)`
    animation: ${JKt};
    animation-duration: 1s;
    position: relative;
`,tzt=v(xe)`
    align-items: center;
    cursor: pointer;
    display: flex;
    block-size: ${$(40)};
    gap: var(--salt-spacing-2);

    &:hover {
        box-shadow: var(--salt-elevation-shadow-1);
    }
`,szt=v.span`
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
`,nzt=({onConfirm:e})=>{const t=F(),{status:n,value:o}=Nu(),r=()=>{t(J.closeModal()),setTimeout(o,0)};return s.jsxs(TM,{flush:!0,className:"salt-gap--2",children:[s.jsx(V.Item,{colSpan:{xs:6},children:s.jsx(x,{fill:!0,intent:"secondary",disabled:n!=="READY",onClick:r,children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.address.select.add.new.address"})})})}),s.jsx(V.Item,{colSpan:{xs:6},children:s.jsx(x,{fill:!0,intent:"primary",onClick:e,children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.address.select.confirm"})})})})]})},ozt=v(xe)`
    border-radius: var(--salt-radius-default);
    background-color: var(--intent-contrast) !important;
`,rzt=({onAddressSelect:e,selectedAddress:t,deliveryAddresses:n})=>{const[o]=Ee(["nfslt"]),{formatMessage:r}=L();return n.length===0?null:o?s.jsx(xe,{className:"salt-overflow-wrap--anywhere",children:s.jsx(fs.RadioGroup,{groupLabel:{text:r("slotbooking.address.select.title"),isVisuallyConcealed:!0},name:"addressSelect",value:t?.deliveryDestinationId,onChange:a=>{const i=n.find(l=>l.deliveryDestinationId===a);i&&e(i)},radios:n.map(a=>({value:a.deliveryDestinationId,label:a.name,additionalText:a.formattedAddress})),required:!0})}):s.jsx(ae.Fragment,{children:n.map(a=>s.jsx(ozt,{className:"salt-m-b--0.5 salt-overflow-wrap--anywhere",children:s.jsx(Ao,{checked:t?.deliveryDestinationId===a.deliveryDestinationId,onClick:()=>e(a),label:a.name,value:a.deliveryDestinationId,children:a.formattedAddress})},a.deliveryDestinationId))})},Ug="ADDRESS_SELECT_MODAL",azt=()=>s.jsx("span",{id:Ug,"data-test":Ug,"aria-live":"polite",children:s.jsx(b,{id:"slotbooking.address.select.title"})}),izt=()=>{const e=F(),{emitOnAddressChangeEvent:t}=fM(),n=f(qi),[o,r]=h.useState(void 0),{isOpen:a,close:i}=Wt(Ug),l=f(YR),c=()=>i(),d=()=>{if(o){const{addressId:p,deliveryDestinationId:g}=o;n!==g&&(t(g),e(Wa.setSelectedAddress({addressId:p,deliveryDestinationId:g})))}i()};h.useEffect(()=>{const p=l.find(g=>g.deliveryDestinationId===n);p&&r(p)},[l,n]);const u={onAddressSelect:r,selectedAddress:o,deliveryAddresses:l};return s.jsxs(B,{isOpen:a,onRequestClose:c,aria:{labelledby:Ug},asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h2",children:s.jsx(azt,{})})}),s.jsx(B.Body,{children:s.jsx(rzt,{...u})}),s.jsx(B.Footer,{children:s.jsx(nzt,{onConfirm:d})})]})},ure=(e,t,n)=>Object.values(e).find(o=>o.deliveryDestinationId===t||o.addressId===n),lzt=(e,t,n)=>{const o=ure(e,t,n);return o||{deliveryDestinationId:t}},czt=()=>{const e=F(),t=f(Pf);return{selectAddress:h.useCallback((o,r)=>{const a=lzt(t,o,r);e(Wa.setSelectedAddress(a))},[e,t])}},dzt=()=>{const{formatMessage:e}=L(),{emitOnDropdownClickEvent:t,emitOnCollectionPointMapOpenEvent:n}=fM(),o=f(Pf),r=f(mm),a=f(Ys),i=f(Po),l=f(zs),c=ure(o,i),{open:d}=Wt(Ug),{open:u}=Wt(Gc),{selectAddress:p}=czt();return{anySlotListingRequestPending:r,deliveryMethod:a,selectedAddress:c,onChangeCollectionPoint:u,selectAddress:p,deliveryAddresses:o,getAriaLabel:()=>e("accessibility.delivery.selected.address",{delivery_method:e(a==="HOME_DELIVERY"?"delivery.type.name.van":"delivery.type.name.cnc"),address_name:c?.name,address:c?.formattedAddress}),openAddressSelectionModal:()=>{t(),a==="HOME_DELIVERY"&&d(),a==="CUSTOMER_COLLECTION"&&(n(),u({postalCode:l.data?.postalCode}))}}},bM=({className:e=""})=>{const{getAriaLabel:t,selectedAddress:n,anySlotListingRequestPending:o,openAddressSelectionModal:r}=dzt(),a=n?s.jsxs("button",{onClick:r,type:"button",disabled:o,"aria-label":t(),className:e,"data-test":"address-select-button",children:[s.jsx(szt,{children:s.jsx(b,{id:"delivery.address.select.text",values:{addressName:s.jsx(O,{size:"l",bold:!0,children:n?.name}),address:s.jsx(O,{size:"l",children:n?.formattedAddress})}})}),s.jsx(pe,{name:"edit"})]}):s.jsx(_e.Button,{fill:!0,"data-test":"address-select-skeleton"});return s.jsxs(h.Fragment,{children:[s.jsx(tzt,{asChild:!0,condensed:!0,children:a}),s.jsx(izt,{})]})},uzt=v.div`
    inline-size: 100%;
`,pre=({withDropdown:e=!0,className:t="salt-m-x--2"})=>s.jsxs("div",{className:t,children:[e&&s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx(Lu.Title,{}),s.jsx(kf,{})]}),s.jsxs(xe,{className:"salt-d--flex salt-m-b--2",children:[s.jsx(pe,{name:"calendar",height:21,width:21}),s.jsxs(uzt,{className:"salt-m-l--2",children:[s.jsx(_e,{className:"salt-m-b--2",height:"28px",width:"40%"}),s.jsx(_e,{height:"28px",width:"20%",className:"salt-m-b--2"}),s.jsx(_e,{height:"28px",width:"60%",className:"salt-m-b--2"})]})]})]}),pzt=(e,t)=>t?.attributes.includes("REPRICEABLE")?e.formatMessage("slot.repriceable.text"):"",mre=({slot:e,loading:t=!1,onContinueCheckout:n,carrier:o,className:r=""})=>{const a=L(),[i]=Ee(["sl.rd"]),l=bE(o),c=g4(o.slotTimesDisplayMode,e,o.title,a),{continueCheckoutButtonClicked:d,courierSlotImpression:u}=Or(),p=()=>{n(),d()};return h.useEffect(()=>{u(e)},[e]),s.jsxs("div",{className:r,children:[s.jsx("div",{className:"salt-m-b--4",children:i?s.jsx(bM,{}):s.jsxs(h.Fragment,{children:[s.jsx(Lu.Title,{}),s.jsx(kf,{})]})}),s.jsx(are,{className:"salt-m-b--2",iconName:"calendar",title:c,subTitle:l,bodyText:pzt(a,e)}),s.jsx(UKt,{loading:t,onContinueCheckout:p})]})},mzt=e=>{if(e?.name&&e?.address_details.post_code&&e?.address.line1&&e?.address.line2)return{externalCollectionPointId:e?.name,addressDetails:{postalCode:e?.address_details.post_code,formattedAddress:`${e?.address.line1}, ${e?.address.line2}`,locationDescription:e?.location_description,openingHours:e?.opening_hours}}},hzt=async(e,t,n,o,r,a,i,l)=>{if(n&&r&&a&&o)try{await t(EM.selectSlot({slotId:n.slotId,deliveryPrice:n.deliveryPrice,minimumOrder:n.minimumOrder,deliveryType:r,deliveryMethod:a,deliveryDestinationId:o,externalAddress:i,carrierName:l},e))}catch{}return Promise.resolve()},hre=()=>{const e=F(),t=Ge(),n=f(Po),o=f(yVe),r=f(qR),a=f(Ys),[i,l]=h.useState(!1),c=f(Ml)?.title,d=h.useCallback(async g=>{i||(l(!0),await hzt(t,e,o,n,r,a,g,c),l(!1))},[o,r,a,n,i,e,t]),u=h.useCallback(()=>{d()},[d]),p=h.useCallback(g=>{const E=mzt(g);d(E)},[d]);return{selectSlot:u,selectExternalAddressSlot:p,carrierSlot:o,selectSlotLoading:i}},gre=({openCollectionPointModal:e})=>s.jsx("div",{className:"salt-p-t--8","aria-live":"polite","data-test":"select-cnc-view",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{titleIcon:"info_default",title:"slotbooking.select.cnc.title",description:"slotbooking.select.cnc.description",primaryButton:{text:"slotbooking.select.cnc.button",onClick:()=>e()}})})})}),Ere=({openChangeHomeAddressesModal:e})=>{const{status:t,value:n}=Nu(),o={text:"addresses.add.address",onClick:()=>{t==="READY"&&n()}},r={text:"slotbooking.temporary.delivery.destination.choose.existing.address",onClick:e};return s.jsx("div",{className:"salt-p-t--8","aria-live":"polite","data-test":"temporary-delivery-destination-view",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{titleIcon:"info_default",title:"slotbooking.temporary.delivery.destination.title",titleAs:"h2",description:"slotbooking.temporary.delivery.destination.description",primaryButton:o,secondaryButton:r})})})})},fre=()=>{const{status:e,value:t}=Nu(),n=e==="READY"?{text:"addresses.add.address",onClick:t}:void 0;return s.jsx("div",{className:"salt-p-t--8","aria-live":"polite","data-test":"no-addresses-view",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{titleIcon:"info_default",title:"slotbooking.no.addresses.title",titleAs:"h2",description:"slotbooking.no.addresses.description",primaryButton:n})})})})},xM="CUSTOMER_COLLECTION_SIMPLE",yre={titleId:"slotbooking.unavailable.delivery.title",detailsId:"slotbooking.unavailable.delivery.details"},gzt={[pt.vanDelivery.method]:yre,[pt.clickAndCollect.method]:{titleId:"slotbooking.unavailable.cnc.title",detailsId:"slotbooking.unavailable.delivery.details"},[xM]:{titleId:"slotbooking.unavailable.cnc.simple.title",detailsId:"slotbooking.unavailable.cnc.simple.details"}},KS=({variant:e,primaryButton:t})=>{const n=gzt[e]||yre;return s.jsx("div",{className:"salt-p-t--8","aria-live":"polite","data-test":"unavailable-delivery-view",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{titleIcon:"info_default",title:n.titleId,titleAs:"h2",description:n.detailsId,primaryButton:t})})})})},Ezt=({slotBooked:e,deliveryMethod:t,fetchSlots:n,deliveryType:o,inCheckoutWalk:r,noDefaultCncAddress:a})=>{const[i,l]=h.useState(void 0),c=F(),d=Ge(),[u,p]=Fp(),g=f(D4),E=f(jm),y=f(af),I=f(LX),[S,C,T,_]=Ee(["dcbbs","dds","sl.dds","dede"]),A=f(Xi),R=f(Ml),P=f(DE),{selectPickUpPointButtonClicked:N,selectExternalCollectionPointClicked:k}=Or(),{open:M}=Wt(Gc),w=f(Po),j=f($i),G=w||j,W=f(OX),H=!!(_&&t!==pt.clickAndCollect.method&&!A);h.useEffect(()=>{H&&c(uj({deliveryDestinationId:G}))},[H,G]);const K=()=>{if(C)return{text:"slotbooking.open.dds",onClick:()=>c(J.openModal(fm))}},X=()=>{if(!(!C||!T))return{text:"slotbooking.open.simple.dds",onClick:()=>{c(J.openModal(Em)),N()}}},{selectSlot:q,selectExternalAddressSlot:ne,carrierSlot:ue,selectSlotLoading:oe}=hre(),ye=Ie=>{Ie&&k(Ie),l(Ie),ne(Ie)},he=()=>{ne(i)};return A&&P?s.jsx(pre,{}):A&&R?.type===Il?s.jsx(KS,{variant:xM,primaryButton:X()}):A&&R?.view===c4?s.jsxs(h.Fragment,{children:[s.jsx(mre,{className:"salt-m-x--2",slot:ue,loading:oe,carrier:R,onContinueCheckout:q}),s.jsx(Ad,{selectedSlot:ue,slotSelectionHandler:q,fetchSlots:n})]}):A&&R?.view===l4?s.jsxs(h.Fragment,{children:[s.jsx(lre,{className:"salt-m-x--2",slot:ue,carrier:R,onContinueCheckout:ye}),s.jsx(Ad,{selectedSlot:ue,slotSelectionHandler:he,fetchSlots:n})]}):y?s.jsx(KS,{variant:t,primaryButton:K()}):I?s.jsx(fre,{}):a?s.jsx(gre,{openCollectionPointModal:M}):W?s.jsx(Ere,{openChangeHomeAddressesModal:()=>c(J.openModal(_p))}):s.jsxs(rr,{className:"salt-m-x--2",children:[S&&s.jsx($S,{slotBooked:e,expand:!0}),g?s.jsx(Fc,{titleAs:"h2",action:n}):s.jsxs(rr,{className:"salt-m-t--4",children:[s.jsx(NKt,{goBack:()=>d(-1),deliveryType:o,deliveryMethod:t,inCheckoutWalk:r,fetchSlots:n,shouldPrepareDeliveryDetails:H,areAddressesFetching:E.isFetching,setSearchParams:p,navigate:d}),s.jsx(vu,{targetName:yc.CGVB}),s.jsx(rre,{})]})]})},fzt=({deliveryMethod:e,search:t,orderRoot:n})=>{const o=e===pt.clickAndCollect.method?Jd():bc();return`${n||""}${o}${t}`},AM=(e,t)=>t.filter(Dl).find(n=>n.deliveryDestinationId===e),Ire=e=>{const t=e.filter(Dl);return t.find(({primary:o})=>o)||t[0]},yzt=(e,t)=>t&&t.find(({deliveryDestinationId:n})=>n===e),RM=()=>{const e=h.useRef(!0);return h.useEffect(()=>{e.current=!1},[]),e.current},Izt=(e,t=!1)=>{const n=t2(e),o=D("md.sl")(e),r=D("sv.sl")(e),a=DVe(e),i=O4(e),l=OVe(e),d=r&&n==="HOME_DELIVERY"?[{partId:$r,start:"",end:""},...l]:l,u=(I,S)=>qe(I,Vt.ISO_8601).tz(S).format(),p=I=>{if(!I||!I.length)return[];const{slotDays:S,availableDays:C}=I.reduce((_,A)=>{const R=Vt.parseZone(Fn(A.localizedStartTime)),P=A.attributes.includes(Ig);return _.slotDays.push({day:R,available:P}),P&&_.availableDays.add(ml(R)),_},{slotDays:[],availableDays:new Set}),T=S.sort((_,A)=>_.day.valueOf()-A.day.valueOf());return zHe(T[0]?.day,T[T.length-1]?.day).map((_,A)=>{const R=ml(_);return{date:I4(_),dayId:R,order:A,hasAnyAvailableSlot:C.has(R)}})},g=({pricedSlots:I,partsOfDay:S,timeZoneId:C})=>I.sort(QHe).reduce((T,_)=>{const A=xE(_.localizedStartTime,_.localizedEndTime),R=S4(_.localizedStartTime,_.localizedEndTime,S);return R||eA(_.localizedStartTime,_.localizedEndTime)?T.concat([{slotId:_.slotId,slotDayId:ml(Fn(_.localizedStartTime)),slotDateTimeISO:Fn(_.localizedStartTime),slotEndDateTimeISO:Fn(_.localizedEndTime),slotIntervalId:A,slotPartId:R,deliveryPrice:_.deliveryPrice,minimumOrder:_.minimumOrder,timeZoneId:C,carrierId:_.carrierId,attributes:_.attributes,..._.isFakeAvailable!==void 0&&{isFakeAvailable:_.isFakeAvailable}}]):T},[]),E=({standardSlots:I,minimumOrderValue:S,timeZoneId:C})=>{let T,_;const A=Vt().tz(C).add(i,"minutes"),R=new Map,P=new Set;if(t){T=sVe(I,C),_=I.find(k=>k.deliveryPrice)?.deliveryPrice?.currency??"GBP";for(const k of I){if(!k.attributes.includes("AVAILABLE"))continue;const w=Vt.utc(k.slotWindow.startTime).tz(C).format("YYYY-MM-DD");P.add(w);const j=parseFloat(k.deliveryPrice?.amount)===0;R.has(w)?R.get(w)&&R.set(w,j):R.set(w,j)}}const N=P.size>0&&[...P].every(k=>R.get(k)===!0);return I.map(({slotWindow:k,deliveryPrice:M,attributes:w,...j})=>{const{startTime:G,endTime:W}=k,H=u(G,C),K=u(W,C),X=Vt.utc(G).tz(C),q=X.format("YYYY-MM-DD"),ne=t&&!w.includes("AVAILABLE")&&X.isSameOrAfter(A);let ue,oe;if(ne){ue=[...w,"AVAILABLE"];const ye=Nd(H),he=nVe(X,Vt.utc(W).tz(C),T,C);ye?he?.amount&&parseFloat(he.amount)===0?oe=he:N||R.get(q)?oe={currency:_,amount:"0.00"}:oe={currency:_,amount:oVe(G,W,C,a).toFixed(2)}:oe=he??(N||R.get(q)?{currency:_,amount:"0.00"}:{currency:_,amount:"5.00"})}else ue=w,oe=M;return{startTime:G,endTime:W,localizedStartTime:H,localizedEndTime:K,slotDateTimeISO:Fn(H),endTimeISO:Fn(K),deliveryPrice:oe,minimumOrder:S,timeZoneId:C,attributes:ue,...t&&{isFakeAvailable:ne},...j}})},y=I=>{if(n==="CUSTOMER_COLLECTION"&&o){const[C,T]=I.reduce((_,A)=>(eA(A.localizedStartTime,A.localizedEndTime)?_[0].push(A):_[1].push(A),_),[[],[]]);return{regularSlots:T,multiDaySlots:C}}return{regularSlots:I,multiDaySlots:[]}};return I=>{const{standardSlots:S,onDemandSlots:C,minimumOrderValue:T,checkoutGroupsChanged:_,slotListingId:A,carriers:R,timeZoneId:P,seasonalSlotPeriods:N}=I,k=E({standardSlots:S,minimumOrderValue:T,timeZoneId:P}),{regularSlots:M,multiDaySlots:w}=y(k),j=p(M),G=tVe(M,d,a),W=g({pricedSlots:M,partsOfDay:G,timeZoneId:P});return{days:j,partsOfDay:G,slots:W,onDemandSlots:[...C||[],...w].filter(({attributes:H})=>H?.includes(Ig)).map(H=>({...H,minimumOrder:T})),checkoutGroupsChanged:!!_,carriers:R||[],...A?{slotListingId:A}:{},...N&&{seasonalSlotPeriods:[...N]}}}},Szt=({deliveryDestinationId:e,deliveryMethod:t,shippingGroupType:n})=>async(o,r)=>{const a=r(),i=RX(a),l=D("sl.fsa")(a),c=xr(a),d=E3(a),u=f3(a),p=Nn(a),g=vn(a),E=_c(a),y=`${e}:${t}:${n}`,I=hVe();try{let S=!1;if(l&&c)if(d)S=!u;else try{S=(await o(Zr.getConciergeDelivery(c,!0)))?.payload?.responseData?.isLeftAtConcierge===!1}catch{S=!1}const C=Izt(a,S),_=O4(a)===120?VHe:WHe,A=await o(To.getSlots({deliveryDestinationId:e,shippingGroupType:n,viewingLocation:S?_:i,pageViewId:p,sessionId:E,regionId:g,requestStartTime:I}));o(To.setSlots({data:C(A.payload.responseData),requestStartTime:I,successRequestParams:y}))}catch(S){S?.statusCode===Go.BAD_REQUEST?o(To.setSlots({data:{days:[],partsOfDay:[],slots:[],onDemandSlots:[],checkoutGroupsChanged:!1,carriers:[]},requestStartTime:I,successRequestParams:y})):o(To.setSlotsError(S))}},Czt=/(?<orderRoot>^\/orders\/[^/]*)/,DM=()=>{const e=Ne(),{orderId:t}=nn();if(!t)return"";const n=e.pathname.match(Czt)?.groups;return n?.orderRoot?n.orderRoot:""},Sre=v.span.withConfig({shouldForwardProp:e=>!["isActive","isLoading"].includes(e)})`
    display: flex;
    align-items: center;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
    flex-wrap: nowrap;
    block-size: 48px;
    min-inline-size: 109px;
    align-content: center;
    border: var(--salt-border-1) solid transparent;
    border-radius: var(--salt-radius-default);
    box-shadow: ${e=>e.shadow?"var(--salt-box-box-shadow)":""};

    &:hover {
        ${e=>`
            ${e.isLoading?"":"background-color: var(--intent-secondary-500)"};
        `}
    }

    ${e=>`
        border-color: ${e.isActive?"var(--intent-primary-800)":"transparent"};
    `}

    ${re.mdUp`
        width: 100%;
        max-width: 344px;
    `};
`,vzt=v(O)`
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: block-axis;
    overflow: hidden;
`,Tzt=bc(),ZA=3,_zt=({queryString:e})=>({carrierId:t})=>{const{carrierId:n,...o}=Qe.parse(e||"")||{};return Qe.stringifyUrl({url:Tzt,query:{...o,...t&&{carrierId:t}}})},bzt=({selectedCarrier:e,carriers:t,isMobileLayout:n})=>{if(!n)return t;const o=t.slice(0,ZA);return n&&o.find(r=>r?.id===e?.id)?o:[...e?[e]:[],...t.filter(r=>r?.id!==e?.id)].slice(0,ZA)},OM=()=>{const e=Ne();return _zt({queryString:e.search})},xzt=()=>{const e=Ge(),t=f(hm),n=f(oP),o=f(x4),r=OM(),a=f(DE),i=Bn(a);h.useEffect(()=>{t.length&&!n&&o&&i!==void 0&&i!==a&&!a&&e(r({deliveryMethod:o.type,carrierId:o.id}),{replace:!0})},[i,a])},Azt=()=>{const e=f(hm),t=f(Ml),n=Bn(t)??null,o=h.useRef({}),[r,a]=h.useState(!1),[i,l]=h.useState(t?.id??null);o.current=h.useMemo(()=>e.reduce((u,p)=>({...u,[p.id]:o.current[p.id]??h.createRef()}),o.current),[e]);const c=()=>{!r&&t?.id&&l(t?.id)},d=u=>{const p=e.findIndex(g=>g.id===i);switch(u.key){case"ArrowRight":{a(!0);const g=p+1>=e.length?0:p+1,E=e[g].id;o.current[E]?.current?.focus(),l(E);break}case"ArrowLeft":{a(!0);const g=p-1<0?e.length-1:p-1,E=e[g].id;o.current[E]?.current?.focus(),l(E);break}default:a(!1);break}};return h.useEffect(()=>{const u=t?.id;n?.id&&u&&(o.current[u]?.current?.focus(),l(u))},[t?.id]),{carrierCardsRefs:o,onTablistFocus:c,onTablistKeyDown:d}},Rzt=v(pe).attrs({name:"click_collect",width:28,height:28})`
    vertical-align: middle;

    svg {
        fill: var(--intent-content);
    }
`,Cre=e=>{const{carrier:t}=e,{title:n,iconUrl:o,iconDescription:r,type:a}=t,c=(bE(t)||n)===r?void 0:r;return a===xa?s.jsx(el,{src:o,alt:c,height:28,width:28}):s.jsx(Rzt,{})},Dzt=v(Ye)`
    inline-size: 100%;
`,Ozt=v.button`
    inline-size: 100%;
    background: none;
    color: inherit;
    border: none;
    padding: 0;
`,Pzt=ae.forwardRef(({children:e,isActive:t,carrierId:n,deliveryMethod:o,onClick:r},a)=>{const i=OM();if(t)return s.jsx(Ozt,{role:"tab","aria-selected":!0,ref:a,tabIndex:0,type:"button",children:e});const l=i({carrierId:n,deliveryMethod:o});return s.jsx(Dzt,{role:"tab","aria-selected":!1,intent:"ghost",href:l,ref:a,tabIndex:-1,onClick:r,children:e})}),Nzt=ae.forwardRef(({carrier:e,isActive:t=!1},n)=>{const{id:o,title:r,type:a}=e,l=bE(e)||r,{carrierSelectionClicked:c}=Or(),d=()=>{c({item:e})};return s.jsx(Q,{"data-test":"carrier-card",children:s.jsx(Pzt,{isActive:t,carrierId:o,deliveryMethod:a,ref:n,onClick:d,children:s.jsxs(Sre,{isActive:t,shadow:!t,children:[s.jsx(Q,{as:"span",children:s.jsx(Cre,{carrier:e})}),s.jsx(vzt,{className:"salt-m-l--1",size:"s",bold:!0,children:l})]})})})}),Lzt=()=>s.jsxs(Sre,{as:"div",isActive:!1,isLoading:!0,children:[s.jsx(Q,{className:"salt-m-r--1",children:s.jsx(_e,{height:"28px",width:"28px"})}),s.jsx(rr,{children:s.jsx(_e,{height:"28px",width:"100%"})})]}),kzt="carriers-select-placeholder",jzt=({className:e})=>s.jsx(V,{flush:!0,className:e,"data-test":kzt,children:["carrier1","carrier2"].map(t=>s.jsx(V.Item,{colSpan:{xs:4,lg:2},children:s.jsx(Lzt,{})},t))}),{RadioIconOff:Mzt,RadioIconOn:wzt}=Pa,vre=`
    svg {
        height: 24px;
        width: 24px;
    }
`,Fzt=v(Mzt)`
    ${vre}
`,Bzt=v(wzt)`
    ${vre}
`,Uzt=v.div`
    display: flex;
    align-items: center;
    flex-wrap: nowrap;
    padding-block: var(--salt-spacing-2);
    padding-inline: var(--salt-spacing-2);
    cursor: pointer;
    block-size: 50px;
    min-inline-size: 109px;
    border: ${$(1)} solid var(--intent-secondary-900);
    border-radius: var(--salt-radius-default);

    &:hover {
        background-color: var(--intent-secondary-500);
    }
`,s1=v(O)`
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    inline-size: 100%;
`,Gzt=v(Q)`
    overflow: hidden;
`,$zt=e=>{const t=L(),{carrier:n,isActive:o=!1,onSelect:r}=e,a=n.type==="CUSTOMER_COLLECTION"?t.formatMessage(n.title):n.title,i=bE(n),{carrierSelectionClicked:l}=Or(),c=()=>{r(n),o||l({item:n})};return s.jsx(Be.Item,{id:a,role:"option",onClick:c,"aria-selected":o,tabIndex:0,"data-test":e["data-test"],children:s.jsxs(Uzt,{children:[o?s.jsx(Bzt,{name:"radio_on"}):s.jsx(Fzt,{name:"radio_off"}),s.jsx(Q,{children:s.jsx(Cre,{carrier:n})}),s.jsxs(Gzt,{className:"salt-m-l--4",direction:"column",children:[s.jsx(s1,{size:"s",children:a}),i&&s.jsx(s1,{size:"s",bold:!0,children:i})]})]})})},Hzt=v(Be)`
    inline-size: 100%;
`,Tre="carriers",Vzt=()=>{const e=L(),t=Ge(),n=OM(),o=F(),r=f(hm),a=f(Ml),[i,l]=h.useState(a),c=f($e(Tre)),d=()=>{o(J.closeModal())},u=()=>{i&&t(n({deliveryMethod:i.type,carrierId:i.id})),o(J.closeModal())},p=g=>()=>l(g);return h.useEffect(()=>{l(a)},[a]),s.jsxs(B,{isOpen:c,isLoading:!1,onRequestClose:d,asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(O,{size:"l",bold:!0,children:e.formatMessage("carriers-selection-view.title")})}),s.jsx(B.Body,{children:s.jsxs(Q,{className:"salt-gap--2",children:[s.jsx(Hzt,{inline:!1,"data-test":"carriers-modal-list",children:r.map(g=>s.jsx($zt,{"data-test":`carriers-modal-item-${g.id}`,onSelect:p(g),isActive:g.id===i?.id,carrier:g},g.id))}),s.jsx(x,{intent:"primary",fill:!0,onClick:u,"data-test":"carriers-modal-confirm-button",children:s.jsx(x.Text,{children:e.formatMessage("carriers-selection-view.confirm-button")})}),s.jsx(x,{intent:"secondary",fill:!0,onClick:d,"data-test":"carriers-modal-cancel-button",children:s.jsx(x.Text,{children:e.formatMessage("carriers-selection-view.cancel-button")})})]})})]})},Wzt="carriers-select",_re=({className:e=""})=>{const{formatMessage:t}=L(),n=F(),o=f(hm),r=f(DE),a=f(Ml),i=f(pP),l=os({breakpoint:"lg-up"}),{chooseCarrierModalDisplayed:c,carrierSelectionCardImpression:d}=Or(),u=()=>{n(J.openModal(Tre)),c(),d({items:o})},p=bzt({isMobileLayout:l,carriers:o,selectedCarrier:a}),g=l&&o.length>ZA,{carrierCardsRefs:E,onTablistFocus:y,onTablistKeyDown:I}=Azt();return xzt(),h.useEffect(()=>{a&&d({items:p})},[a?.id]),r?s.jsx(jzt,{className:e}):i?s.jsxs(rr,{className:`salt-p-t--2 salt-m-b--4 ${e}`,"data-test":Wzt,children:[s.jsx(V,{role:"tablist",onFocus:y,onKeyDown:I,className:"salt-m-x--0",children:p.map(S=>s.jsx(V.Item,{colSpan:{xs:4,lg:2},children:s.jsx(Nzt,{ref:E.current[S.id],carrier:S,isActive:S.id===a?.id})},S.id))}),g&&s.jsxs(h.Fragment,{children:[s.jsx(rr,{className:"salt-m-t--2",children:s.jsx(x,{intent:"secondary",fill:!0,onClick:u,children:s.jsx(x.Text,{children:t("carriers-selection.show.all-button")})})}),s.jsx(Vzt,{})]})]}):null},bre=()=>{const[e]=Fp(),t=f(bu),n=e.get("deliveryDestinationId");return AM(n,t)},xre=()=>{const e=f(Ys),t=f(GL),n=Rre(),o=bre();return n&&e==="CUSTOMER_COLLECTION"&&!t&&!o},Are=()=>{const e=F(),t=f(af),n=f(bu);return(o,r)=>{if(!o||t)return;const a=n.find(i=>i.deliveryDestinationId===o||i.addressId===r)||{deliveryDestinationId:o};e(Wa.setSelectedAddress(a))}},Rre=()=>{const e=f(Ys),t=Bn(e),n=f(bu),o=f(Po),r=RM();return(()=>{const i=t&&t!==e,l=AM(o,n);return i||r||!o||!l})()},Yzt=()=>{const e=F(),t=f(Ys),n=f(bu),o=f(GL),r=f(zs),a=Are(),{open:i,isOpen:l}=Wt(Gc),c=Rre(),d=xre(),u=bre(),p=t==="HOME_DELIVERY";return()=>{if(u&&c){a(u.deliveryDestinationId,u.addressId);return}if(o&&c){const{data:g}=r;a(g?.deliveryDestinationId,g?.addressId);return}if(p&&c){const g=Ire(n);if(g){const{deliveryDestinationId:E,addressId:y}=g;a(E,y)}}d&&!l&&(e(U.analyticsEvent({type:Ve.MAP_RENDERED_REASON})),i({postalCode:r.data?.postalCode}))}},qzt=bc(),Kzt=Jd(),zzt=({pathRoot:e="",queryParamsAsString:t,deliveryMethod:n,onHomeDeliveryTabClick:o=()=>{}})=>{const r=pt.vanDelivery.method,a=pt.clickAndCollect.method,i=L(),l=i.formatMessage("delivery.type.name.van"),c=i.formatMessage("delivery.type.name.cnc"),d={homeDeliveryTab:{title:i.formatMessage("delivery.type.name.van"),description:i.formatMessage("delivery.type.message.van"),ariaLabel:i.formatMessage("accessibility.delivery.method.selector",{delivery_method:l})},clickAndCollectTab:{title:i.formatMessage("delivery.type.name.cnc"),description:i.formatMessage("delivery.type.message.cnc"),ariaLabel:i.formatMessage("accessibility.delivery.method.selector",{delivery_method:c})}},u=y=>`${e}${y}`,p=y=>y===r?qzt:Kzt,g=y=>{const I=p(y);return`${u(I)}${t}`},E=y=>n===y;return s.jsxs(Kr,{className:"salt-m-b--2",highlightedId:n,children:[s.jsx(Kr.Link,{"data-test":"HOME_DELIVERY_TAB","aria-label":d.homeDeliveryTab.ariaLabel,id:r,onClick:()=>o(),to:E(r)?void 0:g(r),children:d.homeDeliveryTab.title}),s.jsx(Kr.Link,{"data-test":"CUSTOMER_COLLECTION_TAB","aria-label":d.clickAndCollectTab.ariaLabel,id:a,to:E(a)?void 0:g(a),children:d.clickAndCollectTab.title})]})},Qzt=e=>({deliveryMethod:Ys(e),queryParamsAsString:Vo(e,"router.location.search")}),Xzt=we(Qzt)(zzt),Zzt=D("dcbbs"),gh=({className:e})=>{const t=DM(),n=f(Zzt);return f(rme)>1?s.jsxs(rr,{className:e,children:[s.jsx(Xzt,{pathRoot:t}),!n&&s.jsx(vu,{targetName:yc.FJPY})]}):null},Jzt=({enabled:e=!1})=>{const t=Ne(),n=Ge();h.useEffect(()=>{if(!e)return;const o=new URLSearchParams(t.search);o.get(Jx)==="true"&&(Z.warning("slotbooking.fake.slot.notification.updated"),o.delete(Jx),n({search:o.toString()},{replace:!0}))},[e,t,n])},e4t=D("bt.spl"),t4t=D("sl.dt"),Dre=()=>{const e=L(),t=f(e4t),n=f(pm),o=f(Xi),r=f(JV),a=f(t4t),i=r.length===1&&r[0]===xa;return o?e.formatMessage("slotbooking.slot.select.heading.couriers"):a&&i?e.formatMessage("slot.booking.fast.delivery.screen.title"):t&&n?e.formatMessage("slotbooking.slot.select.heading.grocery"):e.formatMessage("slotbooking.slot.select.heading")},s4t=()=>s.jsxs(ae.Fragment,{children:[s.jsx(bt,{title:"slotbooking.page.title"}),s.jsx(sn,{children:s.jsx(ee,{as:"h1",children:Dre()})})]}),n4t=v.div`
    inline-size: 100%;
`,Ore=()=>{const e=L(),t=F(),[n,o]=h.useState(!1),r=f(_l),{currentBreakpoint:a}=h.useContext(kn),i=ft(),l=()=>{i({type:n?Ve.ITEM_WINDOW_REDUCED:Ve.ITEM_WINDOW_EXPANDED}),o(!n)};if(mJ({items:r}),h.useEffect(()=>{t(Oc())},[r.length]),!r.length)return null;const c=e.formatMessage("checkout.summary.basket.overview.header.main"),u=["md","lg"].includes(a)?s.jsx(Tu,{buttonWidth:120,alertClassName:"salt-m-t--2"}):void 0;return s.jsx(n4t,{className:"salt-m-b--4",children:s.jsxs(Je,{expanded:n,onToggle:l,children:[s.jsx(hf,{name:c,basketItems:r}),s.jsxs(Je.ControlSection,{children:[s.jsx(Gm,{basketItems:r,name:c}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentExpanded,{children:s.jsx(vte,{basketItems:r,blurOverlay:u})})]})})};Ore.displayName="BasketProductsSimpleOverview";const o4t=()=>{const e=f(D("dcbbs")),t=f(D("bt.spl")),n=f(UR),o=f(nu),r=cne(),a=f(Xi),i=t&&(r||o),l=a?!1:n;return s.jsxs(h.Fragment,{children:[i&&s.jsx(Q,{className:"salt-p-x--2 salt-p-b--4",children:s.jsx(Ore,{})}),e?s.jsx(vu,{targetName:yc.FJPY}):s.jsx($S,{slotBooked:l})]})},r4t=v(sn)`
    padding-inline: ${({shrink:e})=>e?"0":"var(--salt-spacing-2)"};
`,a4t=({shrink:e=!1})=>s.jsxs(ae.Fragment,{children:[s.jsx(bt,{title:"slotbooking.page.title"}),s.jsx(r4t,{shrink:e,children:s.jsx(ee,{as:"h1",children:Dre()})})]}),i4t=v(pe)`
    svg {
        inline-size: 14px;
        block-size: 14px;
    }
`,Pre=({size:e="m"})=>s.jsxs(Q,{align:"center",wrap:"nowrap",children:[s.jsx(i4t,{className:"salt-m-r--2",name:"eco_slot",success:!0}),s.jsx(O,{size:e,children:s.jsx(b,{id:"slots.grid.green-van.footer.short-description"})})]}),l4t=({size:e="m"})=>s.jsxs(Q,{gap:["sm"],children:[s.jsx(Pre,{size:e}),s.jsx(O,{size:e,children:s.jsx(b,{id:"green-van.description"})})]}),c4t=({className:e})=>s.jsx(ee,{as:"h2",className:e,children:s.jsx(b,{id:"green-van_title"})}),Nre="ECO_SLOT_MODAL_NAME",d4t="eco-icon-modal",u4t=()=>{const e=F(),t=f($e(Nre)),n=()=>{e(J.closeModal())};return s.jsxs(B,{isOpen:t,onRequestClose:n,asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(c4t,{})}),s.jsx(B.Body,{"data-test":d4t,children:s.jsx(l4t,{size:"l"})})]})},p4t=3,m4t=7,Gg=e=>e?p4t:m4t,h4t=e=>({alert:{title:e.formatMessage("slotbooking.alert.first.available.slot"),viewSlot:e.formatMessage("slotbooking.alert.first.available.slot.view")},next:e.formatMessage("slotbooking.table.next.days"),previous:e.formatMessage("slotbooking.table.previous.days"),previousCompleteText:e.formatMessage("slotbooking.table.previous.days.complete.text"),fillerText:e.formatMessage("slotbooking.table.filler.text"),weekDays:{sun:e.formatMessage("slotbooking.table.week.days.sun"),mon:e.formatMessage("slotbooking.table.week.days.mon"),tue:e.formatMessage("slotbooking.table.week.days.tue"),wed:e.formatMessage("slotbooking.table.week.days.wed"),thu:e.formatMessage("slotbooking.table.week.days.thu"),fri:e.formatMessage("slotbooking.table.week.days.fri"),sat:e.formatMessage("slotbooking.table.week.days.sat")},calendar:e.formatMessage("slotbooking.table.calendar.header"),cancel:e.formatMessage("slotbooking.table.calendar.cancel.link"),slotAriaViewSlot:e.formatMessage("slotbooking.aria.view.first.slot"),slotAriaDate:e.formatMessage("slotbooking.table.cell.aria.date"),slotAriaTime:e.formatMessage("slotbooking.table.cell.aria.time"),slotAriaCost:e.formatMessage("slotbooking.table.cell.aria.price"),nextMonth:t=>e.formatMessage("calendar.next.month",{month:t}),currentMonth:t=>e.formatMessage("calendar.current.month",{month:t}),previousMonth:t=>e.formatMessage("calendar.previous.month",{month:t}),datePickerAlternative:e.formatMessage("calendar.alternative")}),Lre=(e,t,n,o,r,a)=>{const{getFormattedIntervalDates:i}=Ih;if(!a||!r){const{fromDate:p,toDate:g}=i(t,n,o,o);return e.formatMessage("slotbooking.table.time.range.format",{startTime:p,endTime:g})}const{startFormat:l,endFormat:c}=a,{fromDate:d,toDate:u}=i(t,n,l,c);return e.formatMessage("slotbooking.table.time.range.format",{startTime:d,endTime:u})},g4t=(e,t,n,o,r)=>r?.map(({partId:a,intervals:i})=>({partId:a,name:e.formatMessage(`slotbooking.table.part.of.day.${a}`),intervals:i.map(({intervalId:l,start:c,end:d,order:u})=>({intervalId:l,name:Lre(e,c,d,t,n,o),order:u,start:c,end:d}))}),{})||[],kre=(e,t,n)=>t?parseFloat(t.amount)===0?e.formatMessage("slotbooking.table.price.free"):n(t):null,E4t=(e,t,n,o,r,a)=>{if(!t.length)return{};let i=t?.reduce((l,c)=>{const{slotDateTimeISO:d,slotPartId:u,slotIntervalId:p,deliveryPrice:g,slotId:E}=c,y=d.split("T")[0];if(!y||!u)return l;const I=n.includes(E),S=u==="saverslots";return{...l,[y]:{...l[y]||{},[u]:{...l[y]?.[u]||{},[p]:{...c,price:kre(e,g,o),ecoSlot:I,isSaverSlot:S}}}}},{});if(a){const{slotDateTimeISO:l,slotPartId:c,slotIntervalId:d}=a,u=l.split("T")[0];!Vo(i,`${u}.${c}.${d}`)&&u&&c&&d&&(i={...i,[u]:{...i[u]||{},[c]:{...i[u]?.[c]||{},[d]:{...a}}}})}return r?.length&&r.forEach(l=>{const{slotDateTimeISO:c,slotPartId:d,slotIntervalId:u}=l,p=c.split("T")[0];p&&d&&u&&(i={...i,[p]:{...i[p]||{},[d]:{...i[p]?.[d]||{},[u]:{...l}}}})}),i},f4t=(e,t)=>e?.map(n=>({dayId:n.dayId,dayName:gt(n.date,t),order:n.order,iso:n.date,hasAnyAvailableSlot:n.hasAnyAvailableSlot}))||[],y4t=(e,t,n,o="-")=>{const r=f4t(e,t),a=r.length%Gg(n),i=a?Gg(n)-a:0;let l=0;for(;l<i;){const c=r[r.length-1],d=c?.iso?uC(1,c.iso):"",u=UH(d);r.push({dayId:ml(u),dayName:d?gt(d,t):o,order:(c?.order||0)+1,iso:I4(u),hasAnyAvailableSlot:!1}),l+=1}return r},I4t=(e,t)=>{const n=[];for(let o=0;o<e.length;o+=t){const r=e.slice(o,o+t);n.push(r)}return n},S4t=e=>t=>e.findIndex(n=>n.findIndex(({iso:o})=>o===t)!==-1),C4t=e=>({start:e[0]?.iso,end:e[e.length-1]?.iso}),v4t=(e,t,n)=>e.length&&(n||e?.[0]?.iso)||gt(Ta,t),T4t=(e,t,n)=>{const o=ml(e),[,r]=t?.split("T")||[],[,a]=n?.split("T")||[];return{attributes:[],ecoSlot:!1,isFirstAvailableSlot:!1,isUpcomingOrder:!1,slotDateTimeISO:`${e}T${r}`,slotDayId:o,slotEndDateTimeISO:`${e}T${a}`}},_4t=(e,t,n)=>{const o=e?.[0]?.[0]?.iso;if(o)for(const r of t)for(const a of r.intervals){const i=n[o]?.[r.partId]?.[a.intervalId];if(i&&"attributes"in i&&i.attributes.includes(Ig))return i}},ix=(e,t)=>e.some(n=>t.some(({fromDate:o,toDate:r})=>n>=o&&n<=r)),n1=0,b4t=()=>{const[e,t]=h.useState(n1);return h.useEffect(()=>{const n=document.getElementById("main-header");t(n?.offsetHeight||n1)},[]),e},y_=()=>os({breakpoint:"md-up"}),x4t=()=>{const e=L();return h4t(e)},A4t=()=>{const e=y_(),t=e?3:2,n=e?4:6;return s.jsx(cre,{"data-test":"slot-grid-skeleton",children:s.jsx(TM,{fixed:!0,className:"salt-m-x--1 salt-m-t--4",children:s.jsx(V.Item,{colSpan:{xs:12},children:s.jsxs(V,{flush:!0,fixed:!0,className:"salt-m-x--1",children:[s.jsx(V.Item,{colSpan:{xs:10},colStart:{xs:3},children:s.jsx(_e,{height:"25px",width:"100%"})}),Array(10).fill(0).map((r,a)=>Array(n).fill(0).map((i,l)=>s.jsx(V.Item,{colSpan:{xs:t},children:s.jsx(_e,{height:"30px",width:"100%"})},`${a}_${l}`)))]})})})})},R4t=()=>s.jsx(Te,{className:"salt-m-y--2","data-synthetics":"no-slots-warning",intent:"error",showIcon:!1,text:s.jsx(b,{id:"slotbooking.slot.unavailable.body"})}),D4t=()=>{const e=L(),t=F(),n=h.useCallback(()=>{t(J.openModal(Nre))},[]);return s.jsxs(Q,{justify:"flex-start",wrap:"nowrap",gap:["sm"],className:"salt-p-x--1 salt-m-y--4",children:[s.jsx(Pre,{}),s.jsx(Q,{additionalCss:"min-inline-size: fit-content;",children:s.jsx(x,{"aria-label":e.formatMessage("accessibility.green-van.footer.description"),"data-test":"eco-slot-footer-button",intent:"tertiary",onClick:n,fill:!1,size:"s",children:s.jsx(x.Text,{children:s.jsx(b,{id:"slots.grid.green-van.footer.button"})})})})]})},O4t=({onDaySelect:e,pickerSelectedDate:t,datesForCurrentPage:n})=>{const o=f(Zt),r=f(gVe),a=x4t(),i=y_(),l=Gg(i),{start:c,end:d}=C4t(n),u=v4t(n,o,t),p=(r||[]).map(g=>g?.date);return s.jsx(QKt,{scope:"col",children:s.jsx(XKt,{children:s.jsx(yM,{selected:u,onDaySelect:e,amountHighlighted:l-1,availableDays:p,messages:a,"data-synthetics":"date-picker",dateTime:Ih,containerStyle:{left:0,zIndex:5},isNewButton:!0,highlightedStart:c,highlightedEnd:d,controlledSelected:!0,text:qs(RH,u),buttonClassName:"salt-p-l--2 salt-p-r--2"})})})},o1=v(x)`
    position: absolute;
    z-index: 2;
    inset-inline-start: -18px;
`,P4t=({onClick:e})=>s.jsx(o1,{intent:"tertiary",size:"s",fill:!1,onClick:e,"data-synthetics":"select-previous","aria-label":L().formatMessage("slotbooking.table.previous.days.accessibility.text"),tabIndex:0,children:s.jsx(o1.Icon,{name:"arrow_left",size:"s"})}),N4t=v(x)`
    position: absolute;
    z-index: 2;
    inset-inline-end: 0;
`,L4t=({onClick:e})=>s.jsx(N4t,{onClick:e,intent:"tertiary",size:"s",fill:!1,"data-synthetics":"select-next","aria-label":L().formatMessage("slotbooking.table.next.days.accessibility.text"),tabIndex:0,children:s.jsx(x.Icon,{name:"arrow_right",size:"s"})}),k4t=v(HKt)`
    position: ${({isLast:e})=>e?"static":"relative"};
`,j4t=({datesForCurrentPage:e,isFirstPage:t,isLastPage:n,onPrevButtonClick:o,onNextButtonClick:r})=>e.map(({dayId:a,dayName:i,iso:l},c)=>{const d=c===0,u=c===e.length-1,p=!t&&d,g=!n&&u,E=qs(CH,l);return s.jsx(zKt,{scope:"col",children:s.jsxs(k4t,{isLast:u,children:[p&&s.jsx(P4t,{onClick:o}),s.jsx(VKt,{width:u?"80%":"100%",tabIndex:0,"aria-label":E,children:i}),g&&s.jsx(L4t,{onClick:r})]})},`day-${a}`)}),M4t=({pageCount:e,findPageIndex:t})=>{const n=f(UL),o=t(n||""),r=o>0?o:0,[a,i]=h.useState(r),[l,c]=h.useState();h.useEffect(()=>{n&&o===-1&&(Z.warning("seasonal.slots.deeplink.error.message"),Ue.api.pushError(new Error("Slot booking error: deep link date not found"),{context:{date:n}}))},[n,o]),h.useEffect(()=>{r!==a&&i(r)},[r,e]);const d=Bce({onSwipedLeft:()=>{i(E=>E>=e?e:E+1)},onSwipedRight:()=>{i(E=>E<=0?0:E-1)}}),u=h.useCallback(E=>{const y=t(E);c(E),i(y)},[t]),p=h.useCallback(()=>{i(E=>E-1),c(void 0)},[]),g=h.useCallback(()=>{i(E=>E+1),c(void 0)},[]);return{currentPage:a,swipeHandlers:d,onDaySelect:u,onPrevButtonClick:p,onNextButtonClick:g,pickerSelectedDate:l}},r1=e=>["available","orderPlaced"].includes(e),w4t=v.div`
    position: relative;
    inline-size: 100%;
    block-size: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: ${({"data-status":e})=>e==="unavailable"?"var(--intent-secondary);":e==="reserved"?"var(--intent-success-50)":"var(--intent-contrast)"};
    border: none;
    border-radius: var(--salt-radius-default);
    cursor: ${({"data-status":e})=>r1(e)?"pointer":"default"};

    :hover {
        background: ${({"data-status":e})=>r1(e)?"var(--intent-primary-50)":"default"};
    }

    transition: background 0.2s ease-in-out;
`,JA=v(pe)`
    ${({isTabletMobileLayout:e,onSide:t})=>t&&!e?Pe`
                  position: absolute;
                  inset-inline-end: 12px;
              `:""}
`,F4t=v(JA).attrs(({isTabletMobileLayout:e})=>({name:"eco_slot",className:"salt-m-l--2",onSide:!0,success:!0,height:"16px",width:"16px",isTabletMobileLayout:e,"data-test":"eco-slot-icon"}))``,B4t=v(_s)`
    transform: scale(0.4);
`,U4t=({slot:e,booked:t,orderPlaced:n,isSlotBooking:o})=>t?"reserved":o?"reserving":n?"orderPlaced":e?.attributes?.includes("AVAILABLE")?"available":"unavailable",G4t=({booked:e,isSlotBooking:t,interval:n,onClick:o,orderPlaced:r,slot:a})=>{const i=L(),l=He(),c=f(Mt),d=U4t({slot:a,booked:e,orderPlaced:r,isSlotBooking:t}),u=d==="available",p=d==="unavailable",g="deliveryPrice"in a?kre(i,a?.deliveryPrice,l):null,E=os({breakpoint:"lg-up"}),y=()=>{switch(d){case"reserved":return s.jsx(JA,{"data-test":"slot-booked-icon",name:"status_yes",success:!0});case"available":return g;case"unavailable":return"-";case"reserving":return s.jsx(B4t,{"data-test":"grid-cell-spinner"});case"orderPlaced":return s.jsx(JA,{"data-test":"order-placed-icon",name:"orders_placed"});default:return""}},S=(()=>{if(p)return;const A=gt(a.slotDateTimeISO,lC),R=qs(Ja,a.slotDateTimeISO),P=gt(n.start,c),N=gt(n.end,c),k=`${P} - ${N}`;if(d==="orderPlaced")return`${i.formatMessage("accessibility.slot.type.order.placed")}. ${k}. ${R}. ${A}.`;if(d==="reserved")return`${i.formatMessage("accessibility.slot.type.booked")}. ${k}. ${R}. ${A}.`;if(u)return`${a?.ecoSlot&&`${i.formatMessage("accessibility.eco.slot.label")}.`||""} ${g}. ${k}. ${R}. ${A}.`})(),C=u||r||e?"button":void 0,T=u&&!t||r?()=>{o(a)}:void 0,_=u?{"data-synthetics":"selectable-slot","data-test":"selectable-slot"}:{};return s.jsxs(w4t,{"aria-label":S,"aria-hidden":p,as:C,"aria-disabled":t||e,"data-status":d,onClick:T,tabIndex:p?-1:0,type:C,..._,children:[y(),u&&a?.ecoSlot&&s.jsx(F4t,{isTabletMobileLayout:E})]})},Ay=e=>{const t=e.match(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/);return t?t[0]:e},$4t=()=>{const e=f(gP);if(!e)return()=>!1;const t=Ay(e.slotDateTimeISO),n=Ay(e.slotEndDateTimeISO);return o=>t===Ay(o.slotDateTimeISO)&&n===Ay(o.slotEndDateTimeISO)},H4t=v.div`
    padding-block: var(--salt-spacing-2);
`,V4t=v.div`
    display: flex;
    justify-content: space-between;
    gap: var(--salt-spacing-1);
    padding: var(--salt-spacing-1);
    background-color: var(--intent-secondary);
    border-radius: var(--salt-radius-default);
`,a1=v(x)`
    inline-size: 100%;
    border: none;
    border-radius: var(--salt-radius-default);

    && {
        ${({intent:e})=>e==="secondary"&&Pe`
                background-color: var(--intent-contrast) !important;
                color: var(--intent-content);

                &:hover {
                    background-color: var(--intent-secondary-900);
                    color: var(--intent-secondary-900-contrast);
                }
            `};
    }
`,W4t=v.div`
    padding-block: var(--salt-spacing-4);
    font-size: var(--salt-text-s-font-size);
    line-height: var(--salt-text-s-line-height);
    text-align: start;

    @media (max-width: ${Ke.md}em) {
        padding-block-end: 0;
    }
`,i1=e=>e?{fill:!0,intent:"secondary",disabled:!0}:{intent:"tertiary",fill:!1},l1=({bold:e=!1,id:t=""})=>s.jsx(O,{bold:e,size:"m",children:s.jsx(b,{id:t})}),jre=()=>{const{formatMessage:e}=L(),t=F(),n=f(dm),[o,r]=Fp(),a=n===vp,i=h.useCallback(c=>{const d=c===_h?Ve.STANDARD_SLOTS_BUTTON_CLICKED:Ve.SAVER_SLOTS_BUTTON_CLICKED,u=c===_h?Wr[Ve.STANDARD_SLOTS_BUTTON_CLICKED]:Wr[Ve.SAVER_SLOTS_BUTTON_CLICKED];t(U.analyticsEvent({type:d,description:u})),r(p=>(p.set("slotGroup",c),p))},[]);return f(uP)?s.jsxs(H4t,{children:[s.jsxs(V4t,{role:"tablist","aria-label":e("accessibility.slotbooking.saver.slots.section.title"),children:[s.jsx(a1,{...i1(!a),size:"s",onClick:()=>i(_h),"aria-selected":!a,role:"tab","aria-label":e("accessibility.slotbooking.standard.slots.button"),children:s.jsx(l1,{id:"slotbooking.standard.slots.button",bold:!a})}),s.jsxs(a1,{...i1(a),size:"s",onClick:()=>i(vp),"aria-selected":a,role:"tab","data-test":"saver-slots-button","aria-label":e("accessibility.slotbooking.saver.slots.button"),children:[s.jsx(qoe,{}),s.jsx(l1,{id:"slotbooking.saver.slots.button",bold:a})]})]}),a&&s.jsx(W4t,{children:s.jsx(O,{size:"s",children:s.jsx(b,{id:"saver-slots.button.description"})})})]}):null},Y4t=v(x)`
    pointer-events: all;
    box-shadow: var(--salt-elevation-shadow-3);
`,q4t=v.div`
    position: fixed;
    inline-size: 100%;
    z-index: 2;
    inset-inline-start: 0;
    ${re.smUp`
        inset-inline-start: max(0px, 50% - var(--salt-spacing-16) - var(--salt-spacing-4) - ${({gridWidth:e=""})=>e} * 0.5);
    `}
    inset-block-end: 0;
    pointer-events: none;
`,K4t=({nextAvailableSlotRef:e,slot:t})=>{const n=L(),o=f(TR),[r]=Ee(["sl.rng.cf"]),a=dr(),i=`${Ke[a||"xs"]}rem`,[l,c]=h.useState(!1),d=([E])=>{c(!E?.isIntersecting&&Number(E?.boundingClientRect.top)>0)},u=h.useCallback(()=>{e.current?.scrollIntoView({behavior:"smooth",block:"end"}),e.current?.focus()},[e]);if(h.useEffect(()=>{const E=e?.current;if(!!window.IntersectionObserver&&E){const I={threshold:0,root:null,rootMargin:"0%"},S=new IntersectionObserver(d,I);return S.observe(E),()=>S.disconnect()}return()=>{}}),!l)return null;const p=Lre(n,t?.slotDateTimeISO,t?.slotEndDateTimeISO,o.startFormat,r,o),g=n.formatMessage("accessibility.next.available.slot",{slot_time:p});return s.jsx(q4t,{gridWidth:i,className:"salt-m-l--2 salt-m-b--2",children:s.jsx(Y4t,{intent:"tertiary-contrast",onClick:u,"data-synthetics":"next-available-slot","aria-label":g,size:"s",fill:!1,children:s.jsx(x.Text,{children:s.jsx(b,{id:"next.available.slot",values:{slot_time:p}})})})})},z4t=e=>e.filter(t=>!!t.content).map(t=>{const{content:n,...o}=t,{bannerImages:r,...a}=n,i={};return t.content?.bannerImages.forEach(l=>{const{width:c,height:d}=l.resolution;l.id==="ratio81"?(i.xs={url:l.url,width:c,height:d},i.sm={url:l.url,width:c,height:d},i.lg={url:l.url,width:c,height:d}):l.id==="ratio61"&&(i.md={url:l.url,width:c,height:d})}),{...a,...o,imagesBreakpoints:i}}),Q4t=v(xe)`
    inline-size: calc(100% + var(--salt-spacing-1));
    ${re.smUp`
        inline-size: 100%;
    `}
    display: flex;
    flex-flow: column;
    flex-basis: auto;
    justify-content: flex-end;
    align-items: stretch;
    padding: var(--salt-spacing-4);
    gap: var(--salt-spacing-2);
    ${re.mdUp`
        flex-flow: row;
        align-items: center;
        padding: 0 var(--salt-spacing-2);
    `}
`,X4t=(e,t)=>{const n=v(Q)`
        flex-grow: 1;

        ${re.mdUp`
        padding-block: var(--salt-spacing-2);
    `}
    `;return s.jsxs(n,{gap:["xs"],direction:"row",wrap:"nowrap",align:"flex-start",justify:"flex-start",children:[s.jsx("img",{src:e.url,alt:"",height:18,width:18}),s.jsx(O,{className:"salt-p-x--2'",bold:!0,children:t})]})},Z4t=({imagesBreakpoints:e,altText:t})=>{const n=v.img`
        display: block;
        inline-size: 100%;
        block-size: auto;
        border-radius: var(--salt-radius-default);

        @media (min-width: ${Ke.md}em) {
            inline-size: 264px;
            block-size: auto;
        }

        @media (min-width: ${Ke.lg}em) {
            inline-size: 352px;
            block-size: auto;
        }
    `,o=Object.entries(e).filter(([,r])=>r);return s.jsxs("picture",{children:[o.map(([r,a])=>s.jsx("source",{media:fl[r],srcSet:a.url},`${r}-${a.url}`)),s.jsx(n,{src:e.xs?.url,alt:t})]})},J4t=v.div`
    min-inline-size: max-content;

    ${re.mdUp`
        padding-block: var(--salt-spacing-2);
    `}
`,e3t=({onHandlePeriodChange:e,isInSeasonalPeriod:t,className:n=""})=>{const o=f(hP),r=z4t(o),a=L();if(r.length===0)return null;{const{iconImage:i,title:l,imagesBreakpoints:c,bannerAltText:d=a.formatMessage("seasonal.slot.default.banner.description"),defaultButtonTitle:u,alternativeButtonTitle:p}=r[0];return s.jsxs(Q4t,{className:`salt-m-b--2 ${n}`,tabIndex:0,children:[X4t(i,l),s.jsx(Z4t,{imagesBreakpoints:c,altText:d}),s.jsx(J4t,{children:s.jsx(x,{size:"s",intent:t?"secondary":"primary",fill:!0,onClick:e,children:t?p:u})})]})}},c1={SEASONAL_SLOTS:"SEASONAL_SLOTS",STANDARD_SLOTS:"STANDARD_SLOTS"},t3t=(e,t,n,o)=>{const r=e[t]||[],a=e[0]||[],[i]=Ee(["sl.ssb"]),l=C=>C.map(T=>T.iso),c=ix(l(r),n),d=ix(l(a),n),u=f(Vi),p=f(qi),g=F(),E=yo(),y=!!(u&&u.deliveryDestinationId===p&&ix([u.start],n)),I=!!(i&&n.length>0&&!y&&!d);h.useEffect(()=>{I&&n.forEach(({seasonalSlotPeriodId:C})=>{g(E({type:Ve.SEASONAL_SLOTS_BANNER_IMPRESSION,seasonalSlotPeriodId:C}))})},[I]);const S=h.useCallback(()=>{let C;if(c){const T=e[0];C=T&&T[0]&&T[0].iso}else{const _=n[0]?.fromDate;C=e.flat().map(R=>R.iso).includes(_||"")&&_}E({type:Ve.SEASONAL_SLOTS_BANNER_CLICKED,userAction:c?c1.SEASONAL_SLOTS:c1.STANDARD_SLOTS}),C&&o(C)},[c,n,e,o]);return{isSeasonalPeriod:c,shouldShowSeasonalBanner:I,onHandlePeriodChange:S}},d1=(e,t)=>e?s3t(t):[12.5,12.5,12.5,12.5,12.5,12.5,12.5,12.5],s3t=e=>e?[24.5,24.5,24.5,24.5,2]:[25,25,25,25],n3t=(e,t)=>n=>e&&!!t&&"slotId"in n&&t===n.slotId,o3t=({datesChunks:e,partsOfDayFormatted:t,slotsFormatted:n,onSelectSlot:o,firstAvailableSlot:r,activeBookingSlotId:a})=>{const{currentPage:i,onNextButtonClick:l,onDaySelect:c,swipeHandlers:d,pickerSelectedDate:u,onPrevButtonClick:p}=M4t({pageCount:e.length-1,findPageIndex:S4t(e)}),{formatMessage:g}=L(),E=y_(),y=F(),{standardSlotsImpressionForGrid:I,dataFeedForGrid:S,defaultDeliveryDestinationIdAvailable:C}=Or(),T=b4t(),[_,A]=Ee(["sl.prom","sl.fsa"]),R=f(xr),P=f(f3),N=f(E3),k=f(IVe),M=$4t(),w=Gg(E),j=os({breakpoint:"sm-up"}),G=f(LE),W=n3t(G,a),H=f(R4),K=f(dm),X=f(uP),q=f(b4),ne=f(hP),ue=h.useRef(null),oe=e.length-1,ye=e[i]||[],he=i===0,Ie=i===e.length-1,{shouldShowSeasonalBanner:Fe,isSeasonalPeriod:be,onHandlePeriodChange:ce}=t3t(e,i,ne,c),me=[],De=h.useRef([]);return De.current=[],h.useEffect(()=>{C(),A&&N&&!P&&R&&(y(Zr.saveConciergeDelivery({slotId:R,isLeftAtConcierge:!0,orderId:R})),y(Zr.setConciergeDelivery(!0,!0)))},[]),h.useEffect(()=>{I(me),S(De.current)},[i,ye.length,K]),h.useEffect(()=>{be&&_&&Z.info("promotions.seasonal.slot.booked.alert")},[be,_]),s.jsxs("div",{...d,children:[r&&he&&s.jsx(K4t,{nextAvailableSlotRef:ue,slot:r}),Fe&&s.jsx(e3t,{isInSeasonalPeriod:be,onHandlePeriodChange:ce}),s.jsxs(GKt,{"aria-label":g("accessibility.slotbooking.grid.title"),children:[s.jsx("colgroup",{children:d1(E,j).map((ge,Se)=>s.jsx("col",{style:{width:`${ge}%`}},`${Se}_${ge}`))}),s.jsxs($Kt,{top:`${T}px`,children:[X&&q&&s.jsx("tr",{children:s.jsx(KKt,{scope:"colgroup",colSpan:d1(E,j).length,children:s.jsx(jre,{})})}),s.jsxs("tr",{"data-test":"slot-booking-header-row",children:[s.jsx(O4t,{onDaySelect:c,pickerSelectedDate:u,datesForCurrentPage:ye}),s.jsx(j4t,{datesForCurrentPage:ye,isFirstPage:he,isLastPage:Ie,onPrevButtonClick:p,onNextButtonClick:l}),j&&s.jsx(qKt,{})]})]}),t.map(({intervals:ge,partId:Se,name:Ae})=>s.jsxs("tbody",{children:[k&&ge.length>0&&Ae?.trim()&&s.jsxs("tr",{children:[s.jsx(t1,{children:s.jsx("div",{className:"time-period-text",children:Ae})}),s.jsx(t1,{colSpan:w})]}),ge.map(({intervalId:Ce,name:We,start:et,end:ve})=>s.jsxs("tr",{children:[s.jsx(WKt,{className:"cell hour-cell",children:We},`hour-${Ce}`),ye.map(({iso:lt,dayId:St},wt)=>{const dn={start:et,end:ve},Zs=Vo(n,`${lt}.${Se}.${Ce}`,void 0)||T4t(lt,et,ve);me.push(Zs);const Mn=H[`${St}|${Se}|${Ce}`];Mn&&De.current.push(Mn);const Kn=!!Zs?.isUpcomingOrder,Vc=wt===ye.length-1&&i!==oe;return s.jsx(ae.Fragment,{children:s.jsx(ezt,{className:`col${wt}`,ref:"slotId"in Zs&&Zs?.slotId===r?.slotId?ue:null,isMobile:E,children:s.jsxs(ZKt,{children:[s.jsx(G4t,{isSlotBooking:W(Zs),booked:M(Zs),interval:dn,onClick:o,orderPlaced:Kn,slot:Zs}),Vc&&j&&s.jsx(YKt,{})]})})},`${lt}.${Se}.${Ce}`)})]},`${Se}-${Ce}`))]},Se))]})]})},r3t=v.div`
    position: fixed;
    inset: 0;
    ${dR("transform .2s linear opacity")}
    background-color: rgb(0 0 0 / 75%);
    block-size: 100%;
    opacity: 0.5;
    inline-size: 100%;
    z-index: ${$t.overlay};
`,a3t=()=>s.jsx(r3t,{"data-test":"slot-booking-loading-overlay",children:s.jsx(Q,{align:"center",additionalCss:"block-size: 100%;",children:s.jsx(_s,{})})}),i3t=()=>{const e=F(),t=f(D("socsb")),n=f(vn),o=f(Zg),r=f(Ct),a=f(Po),i=f(koe),l=vL(i),{smallOrderChargeSlotImpression:c}=Or();return h.useEffect(()=>{t&&a&&e(lI.getSmallOrderCharge({regionId:n,shippingGroupType:o,deliveryDestinationId:a}))},[]),h.useEffect(()=>{l&&c(l)},[l]),t?s.jsx($d,{thresholds:i,isWithIcon:!1,isWithButton:!0,orderId:r,page:"slot-booking",className:"salt-p-x--1 salt-m-y--4"}):null},l3t=({datesChunks:e,onDemandSlots:t,onDemandSlotSelectionHandler:n,onSelectSlot:o,partsOfDayFormatted:r,activeBookingSlotId:a,slotsFormatted:i,shouldRenderGreenVanBanner:l=!1})=>{const c=_4t(e,r,i),d=os({breakpoint:"sm-up"}),{formatMessage:u}=L(),p=f(LE),[g,E,y]=Ee(["tx.nts","sl.ec.bs","sl.fd"]),I=f(b4),S=f(Ys),C=f(qi),T=S==="CUSTOMER_COLLECTION"&&E||S==="HOME_DELIVERY",_=f(Vi),A=T&&_?.slotType==="ON_DEMAND"&&_.deliveryMethod===S&&_.deliveryDestinationId===C,R=S==="HOME_DELIVERY"&&t?.length>0&&!y,P=Object.keys(i).length>0,N=!A&&!P&&(t?.length===0||R),{expressCollectionSlotImpression:k}=Or(),M=()=>g&&s.jsx("div",{className:"salt-p-x--1 salt-m-y--4",children:s.jsx(O,{children:u("orders.list.tax.inclusion.note")})});return s.jsxs(ae.Fragment,{children:[p&&s.jsx(a3t,{}),!I&&s.jsx(jre,{}),s.jsx(cre,{children:s.jsx(TM,{flush:!0,fixed:!0,children:s.jsxs(V.Item,{colSpan:{xs:12},children:[N&&s.jsx(R4t,{}),s.jsx($oe,{onReserve:n,sendImpression:k,shouldSendMultiDayImpression:!0,classNameForBanner:"salt-p--2",classNameForCard:"salt-p--4",className:"salt-m-t--2"}),P&&s.jsxs("div",{className:d?"salt-m-r--1":"salt-m-r--0",children:[s.jsx(o3t,{datesChunks:e,onSelectSlot:o,partsOfDayFormatted:r,slotsFormatted:i,firstAvailableSlot:c,activeBookingSlotId:a}),M(),l&&s.jsx(D4t,{})]}),!N&&s.jsx(i3t,{}),s.jsxs("div",{className:l?"":"salt-p-t--8",children:[s.jsx(vu,{targetName:yc.CGVB}),s.jsx(rre,{})]})]})})})]})},c3t=({fetchSlots:e,gridView:t})=>{const n=F(),[o,r]=h.useState(void 0),a=f(Ml),{selectPickUpPointButtonClicked:i,selectExternalCollectionPointClicked:l}=Or(),[c]=Ee(["dds"]),{selectSlot:d,selectExternalAddressSlot:u,carrierSlot:p,selectSlotLoading:g}=hre(),E=()=>{if(c)return{text:"slotbooking.open.simple.dds",onClick:()=>{n(J.openModal(Em)),i()}}},y=S=>{S&&l(S),r(S),u(S)},I=()=>{u(o)};return a?.type===Il?s.jsx(KS,{variant:xM,primaryButton:E()}):a?.view===c4?s.jsxs(h.Fragment,{children:[s.jsx(mre,{slot:p,loading:g,carrier:a,onContinueCheckout:d}),s.jsx(Ad,{selectedSlot:p,slotSelectionHandler:d,fetchSlots:e})]}):a?.view===l4?s.jsxs(h.Fragment,{children:[s.jsx(lre,{slot:p,carrier:a,onContinueCheckout:y}),s.jsx(Ad,{selectedSlot:p,slotSelectionHandler:I,fetchSlots:e})]}):s.jsxs(h.Fragment,{children:[s.jsx(Ad,{selectedSlot:p,slotSelectionHandler:d,fetchSlots:e}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(bM,{})}),t]})},d3t=(e,t)=>{const n=f(Ac),o=F(),r=f(Rt),[a]=Ee(["sl.muo"]);h.useEffect(()=>{a&&!r&&!n.lastUpdated&&!n.isFetching&&o(Mi.getPendingOrders())},[o,a,r,n.lastUpdated,n.isFetching]);const i=a?n.orders?.filter(c=>c.status!=="CANCELLED"&&c.status!=="SCRATCHED"):[];return i?.length?i.map(c=>{const d=c?.dates?.deliveryStartDate,u=c?.dates?.deliveryEndDate,p=xE(d,u),g=S4(d,u,e||[]);if(!(t!==c.deliveryDestinationId||!c.slotId||!d||!u||!p||!g))return{slotId:c.slotId,slotDayId:ml(Fn(d)),slotDateTimeISO:Fn(d),slotEndDateTimeISO:Fn(u),slotIntervalId:p,slotPartId:g,timeZoneId:c?.dates?.timeZoneId||"",carrierId:"",attributes:[],ecoSlot:!1,price:"0",deliveryPrice:{amount:"0",currency:""},isUpcomingOrder:!0,referenceOrder:c}}).filter(c=>c!==void 0):void 0},u3t=e=>{const t=f(gP),n=f(rP);if(!n)return[];let o=!1;return n.filter(r=>{const i=!!e?.filter(c=>c.slotDayId===r.dayId)?.length,l=r.dayId===t?.slotDayId&&t?.slotType!=="ON_DEMAND";return o||r.hasAnyAvailableSlot||i||l?(o=!0,!0):!1})},p3t=({standardSlots:e,selectedSlot:t,ecoSlotsIds:n})=>{const o=L(),r=He(),a=es("slot-booking-grid-header-date-format-momentjs"),i=f(qi),l=f(Mt),c=y_(),[d]=Ee(["sl.rng.cf"]),u=f(TR),p=f(SVe),g=d3t(p,i),E=u3t(g),y=a||aC,I=g4t(o,l,d,u,p),S=h.useMemo(()=>E4t(o,e,n,r,g,t),[o,e,n,g?.length,t]),C=h.useMemo(()=>y4t(E||[],y,c),[E,y,c]),T=I4t(C,Gg(c));return{partsOfDayFormatted:I,slotsFormatted:S,datesChunks:T}},m3t=({isLoading:e,onDemandSlots:t,onDemandSlotSelectionHandler:n,onSelectSlot:o,selectedSlot:r,unconfirmedSlot:a,standardSlots:i,ecoSlotsIds:l,fetchSlots:c})=>{const d=f(D4),u=f(Xi),p=r?.slotId||a?.slotId,{partsOfDayFormatted:g,slotsFormatted:E,datesChunks:y}=p3t({standardSlots:i,ecoSlotsIds:l,selectedSlot:r});if(d)return s.jsx("div",{className:"salt-m-x--4","data-test":"slots-error-block",children:s.jsx(Fc,{action:c,titleAs:"h2"})});if(e)return u?s.jsx(pre,{withDropdown:!1,className:"salt-m-t--2"}):s.jsx(A4t,{});const I=s.jsx(l3t,{datesChunks:y,onDemandSlots:t,onDemandSlotSelectionHandler:n,onSelectSlot:o,partsOfDayFormatted:g,activeBookingSlotId:p,slotsFormatted:E,shouldRenderGreenVanBanner:!!l.length});return u?s.jsx("div",{className:"salt-m-t--2",children:s.jsx(c3t,{fetchSlots:c,gridView:I})}):I},h3t=()=>(e,t)=>e(Xye()).then(n=>n&&e(lE(n.payload.responseData.entities))).then(n=>Sk.getDeliveryStatuses(n,e,t())),Mre={getOrders:h3t},g3t=D("seo.rdbl"),E3t=()=>{const e=F(),{formatMessage:t}=L(),[n,o]=h.useState(ct()),r=f(Ct),a=f(g3t),i=la("homepage-card");h.useEffect(()=>{e(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",STATUS:"start shopping"}}))},[]);const l=()=>{e(U.analyticsEvent({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,data:{STATUS:"start shopping",ORDER_ID:r,PAGE_EVENT_ID:n}})),o(ct()),i("start-shopping-card")},c=()=>{l()},d=a?bo():ao();return s.jsx(vs,{"data-test":"start-shopping-card",title:{text:t("logged.in.home.page.order.card.start.shopping.title"),as:"h2"},description:t("logged.in.home.page.order.card.start.shopping.subtitle"),icon:"trolley",to:{...Js(d),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${n}`},onClick:c})},_i={YOUR_UPCOMING_ORDER:"logged.in.home.page.order.card.undelivered.uneditable.title",WE_ARE_ON_THE_WAY:"logged.in.home.page.order.card.title.we.are.on.the.way",YOU_ARE_NEXT:"logged.in.home.page.order.card.title.you.are.next",WE_ARE_HERE:"logged.in.home.page.order.card.title.we.are.here"},ha={PLANNED_DELIVERY_WINDOW:{message:"orders.list.card.status.planned.delivery.window",type:"info"},DELIVERY_ON_THE_WAY:{message:"orders.list.card.status.delivery.on.our.way",type:"info"},DELIVERY_WE_ARE_HERE:{message:"orders.list.card.status.delivery.we.are.here",type:"info"},DELIVERY_ON_THE_WAY_WITH_TIME:{message:"orders.list.card.status.delivery.on.our.way.time",type:"info"},DELIVERY_ON_THE_WAY_WITH_TIME_WINDOW:{message:"orders.list.card.status.delivery.on.our.way.eta.window",type:"info"},DELIVERY_EARLIER:{message:"orders.list.card.status.delivery.earlier",type:"warning"},DELIVERY_EARLIER_WINDOW:{message:"orders.list.card.status.delivery.earlier.eta.window",type:"warning"},DELIVERY_ON_TIME:{message:"orders.list.card.status.delivery.ontime",type:"success"},DELIVERY_ON_TIME_WINDOW:{message:"orders.list.card.status.delivery.ontime.eta.window",type:"success"},DELIVERY_DELAYED:{message:"orders.list.card.status.delivery.delayed",type:"error"},DELIVERY_DELAYED_WINDOW:{message:"orders.list.card.status.delivery.delayed.eta.window",type:"error"},DELIVERY_UNKNOWN:{message:"orders.list.card.status.delivery.unknown",type:"info"}};function lx(e){return ha[e]}const zS=(e,t,n)=>s.jsx(Cl,{dateIso:e,timeZoneId:t,timeFormat:n});function f3t(e){return e&&e.from&&e.to}const wre=(e,t,n,o)=>{switch(e?.deliveryInfo?.currentState){case"PLANNED_DELIVERY":return y3t(e.deliveryInfo,t,e.dates.timeZoneId,o);case"WE_ARE_ON_THE_WAY":return I3t(e.deliveryInfo,t,e.dates.timeZoneId,n);case"WE_ARE_HERE":return S3t();case"YOU_ARE_NEXT":return C3t(e.deliveryInfo,t,e.dates.timeZoneId,n);default:return{type:"info",text:null,icon:"orders_placed",hasEta:!1,orderStatusText:()=>s.jsx(b,{id:_i.YOUR_UPCOMING_ORDER})}}},y3t=(e,t,n,o)=>{const{estimatedTimeWindowOfArrival:r}=e.deliveryState,a=!!r;return{type:ha.PLANNED_DELIVERY_WINDOW.type,text:o&&a?()=>s.jsx(b,{id:ha.PLANNED_DELIVERY_WINDOW.message,values:{from:zS(r.from,n,t),to:zS(r.to,n,t)}}):null,hasEta:a,icon:"orders_placed",orderStatusText:()=>s.jsx(b,{id:_i.YOUR_UPCOMING_ORDER})}},I3t=(e,t,n,o)=>{const{estimatedTimeArrival:r,estimatedTimeWindowOfArrival:a}=e.deliveryState;return e.deliveryState&&r?o&&a?{type:ha.DELIVERY_ON_THE_WAY_WITH_TIME_WINDOW.type,text:()=>s.jsx(b,{id:ha.DELIVERY_ON_THE_WAY_WITH_TIME_WINDOW.message,values:{timeInterval:s.jsx(xf,{dateIsoFrom:Jh(a.from,n),dateIsoTo:Jh(a.to,n),timeZoneId:n,timeFormat:t})}}),hasEta:!0,icon:"home_delivery",orderStatusText:()=>s.jsx(b,{id:_i.WE_ARE_ON_THE_WAY})}:{type:ha.DELIVERY_ON_THE_WAY_WITH_TIME.type,text:()=>s.jsx(b,{id:ha.DELIVERY_ON_THE_WAY_WITH_TIME.message,values:{time:zS(r,n,t)}}),hasEta:!0,icon:"home_delivery",orderStatusText:()=>s.jsx(b,{id:_i.WE_ARE_ON_THE_WAY})}:{type:ha.DELIVERY_ON_THE_WAY.type,text:()=>s.jsx(b,{id:ha.DELIVERY_ON_THE_WAY.message}),hasEta:!1,icon:"home_delivery",orderStatusText:()=>s.jsx(b,{id:_i.WE_ARE_ON_THE_WAY})}},S3t=()=>({type:ha.DELIVERY_WE_ARE_HERE.type,text:()=>s.jsx(b,{id:ha.DELIVERY_WE_ARE_HERE.message}),icon:"orders_placed",hasEta:!1,orderStatusText:()=>s.jsx(b,{id:_i.WE_ARE_HERE})}),C3t=(e,t,n,o)=>{const{estimatedTimeWindowOfArrival:r,estimatedTimeArrival:a,status:i}=e.deliveryState;let l="";if(i==="UNKNOWN"){l="DELIVERY_UNKNOWN";const{type:c,message:d}=lx(l);return{type:c,text:()=>s.jsx(b,{id:d}),icon:"account",hasEta:!1,orderStatusText:()=>s.jsx(b,{id:_i.YOU_ARE_NEXT})}}if(o&&i&&f3t(r)){l=`DELIVERY_${i}_WINDOW`;const{type:c,message:d}=lx(l);return{type:c,text:()=>s.jsx(b,{id:d,values:{timeInterval:s.jsx(xf,{dateIsoFrom:Jh(r.from,n),dateIsoTo:Jh(r.to,n),timeZoneId:n,timeFormat:t})}}),icon:"account",hasEta:!0,orderStatusText:()=>s.jsx(b,{id:_i.YOU_ARE_NEXT})}}if(a&&i){l=`DELIVERY_${i}`;const{type:c,message:d}=lx(l);return{type:c,text:()=>s.jsx(b,{id:d,values:{time:zS(a,n,t)}}),icon:"account",hasEta:!0,orderStatusText:()=>s.jsx(b,{id:_i.YOU_ARE_NEXT})}}return{type:"info",text:()=>s.jsx(b,{id:ha.DELIVERY_UNKNOWN.message}),icon:"account",hasEta:!1,orderStatusText:()=>s.jsx(b,{id:_i.YOU_ARE_NEXT})}},Fre=(e,t,n,o)=>e?.deliveryInfo?wre(e,t,n,o):null,u1=e=>e.status==="FUTURE"||e.status==="PICKED",v3t=e=>e.editStatus==="UNDER_EDIT",T3t=({firstDate:e,secondDate:t,isFirstActive:n,isSecondActive:o})=>n&&!o?-1:!n&&o?1:qg(e,t),_3t=(e,t)=>{const n=e.dates.deliveryStartDate,o=t.dates.deliveryStartDate,r=u1(e),a=u1(t);return Pd(n)&&Pd(o)||r||a?T3t({firstDate:n,secondDate:o,isFirstActive:r,isSecondActive:a}):qg(o,n)},Bre=(e=[],{ignoreEditMode:t=!1}={})=>{const n=e,o=n.find(v3t);if(o&&!t)return[o];const r=n.filter(c=>c.dates.deliveryStartDate!==null&&c.status!=="CANCELLED").sort(_3t);let a=r;const i=r.findIndex(c=>c.status==="DELIVERED");if(i===0)return r.slice(0,i+1);i>0&&(a=r.slice(0,i));const l=a.filter(c=>c.status!=="SCRATCHED");return l.length>0?l:a.length>0?[a[0]]:null},PM=()=>{const[e,t]=h.useState([]),n=f(cN);return h.useEffect(()=>{const r=n?.fetchSuccess&&n?.orderEntitiesLastUpdated?Bre(n.orders,{ignoreEditMode:!0}):[];t(r)},[n]),{relevantOrders:e}},b3t=({dates:e})=>{const{formatMessage:t}=L(),n=e.timeZoneId||"Europe/London",o=t("order.card.reserved.fast.delivery.title",{time:$o(e.deliveryEndDate,n,$n)});return s.jsx(ae.Fragment,{children:o})},jf=({order:e,carrierType:t})=>{const n=He(),o=f(Zt),r=f(Mt),{dates:a,addressNickName:i,externalAddress:l,orderTotals:c}=e,d=f(RE(e.shippingGroupType)),u=e.deliveryMethod==="HOME_DELIVERY"&&e.slotType==="ON_DEMAND",p=d&&l?s.jsx(b,{id:"order.card.locker.name",values:{lockerName:l.externalCollectionPointId}}):i;let g=s.jsx(qn,{dateIsoFrom:a.deliveryStartDate,dateIsoTo:a.deliveryEndDate,timeZoneId:a.timeZoneId||"",dateFormat:o,timeFormat:r});d?g=s.jsx(Hm,{carrierType:t,dates:a,showAsCardTitle:!0}):u&&(g=s.jsx(b3t,{dates:a}));const E=c.totalPrice?n(c.totalPrice):"";return s.jsx(b,{id:"logged.in.home.page.order.card.order.description.format",values:{interval:g,address:p,price:s.jsx("span",{children:E})}})},x3t=({order:e,carrierType:t,noAnalytics:n})=>{const o=L(),r=F(),a=f(Mt),[i,l]=h.useState(ct()),c=f(D("del.win")),d=f(D("pln.win")),u=la("homepage-card"),[p]=Ee(["apo.liuoc"]),{relevantOrders:g}=PM(),E=f(RE(e.shippingGroupType));h.useEffect(()=>{n||r(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",IS_ORDER_EDITABLE:"false",STATUS:"upcoming order",ORDER_ID:e.orderId,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}}))},[]);const y=()=>p&&g&&g.length>1?o.formatMessage("logged.in.home.page.order.card.next.order.title"):o.formatMessage("logged.in.home.page.order.card.undelivered.uneditable.title"),I=()=>s.jsx(jf,{order:e,carrierType:t}),S=()=>{const P=e.deliveryMethod==="HOME_DELIVERY"&&e.slotType==="ON_DEMAND"&&!E?{intent:"info",text:s.jsx(b,{id:"order.card.reserved.fast.delivery.alert"})}:void 0;return A?.hasEta&&A?.text?{intent:A.type,text:A.text()}:P},C=o.formatMessage("logged.in.home.page.order.card.undelivered.uneditable.accessibility.title.label").concat(" "),T=()=>{n||_()},_=()=>{r(U.analyticsEvent({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,data:{STATUS:"upcoming order",IS_ORDER_EDITABLE:"false",ORDER_ID:e.orderId,PAGE_EVENT_ID:i,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}})),l(ct()),u("undelivered-uneditable-order-card")},A=Fre(e,a,c,d);return s.jsx(vs,{"data-test":"undelivered-uneditable-order-card",title:{text:A?.orderStatusText?A?.orderStatusText():y(),as:"h2",a11yText:C},description:I(),icon:A?.icon||"orders_placed",alertBanner:S(),onClick:T,to:{...Js(cn(e.orderId)),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${i}`}})},cx=({noAnalytics:e=!1})=>{const{formatMessage:t}=L(),n=F();return h.useEffect(()=>{e||n(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",STATUS:"order details not available"}}))},[]),s.jsx(hR,{"data-test":"order-error-card-v2",title:{text:t("logged.in.home.page.order.card.error.title"),as:"h2"},description:t("logged.in.home.page.order.card.error.subtitle"),icon:"info_default"})},A3t=({order:e,carrierType:t,noAnalytics:n})=>{const o=L(),r=F(),a=f(Zt),i=f(Mt),[l,c]=h.useState(ct()),d=la("homepage-card"),[u]=Ee(["apo.liuoc"]),{relevantOrders:p}=PM();h.useEffect(()=>{n||r(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",IS_ORDER_EDITABLE:"true",STATUS:"upcoming order",ORDER_ID:e.orderId,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}}))},[]);const g=()=>u&&p&&p.length>1?s.jsx(b,{id:"logged.in.home.page.order.card.next.order.title"}):s.jsx(b,{id:"logged.in.home.page.order.card.undelivered.editable.title"}),E=()=>s.jsx(jf,{order:e,carrierType:t}),y=o.formatMessage("logged.in.home.page.order.card.undelivered.editable.accessibility.title.label").concat(" "),I=()=>s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"logged.in.home.page.order.card.undelivered.editable.alert.text"})," ",s.jsx(Gl,{dateIso:e.dates.confirmOrderChangesBy,timeZoneId:e.dates.timeZoneId,local:!0,dateFormat:a,timeFormat:i})]}),S=()=>{n||C()},C=()=>{r(U.analyticsEvent({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,data:{STATUS:"upcoming order",IS_ORDER_EDITABLE:"true",ORDER_ID:e.orderId,PAGE_EVENT_ID:l,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}})),c(ct()),d("undelivered-editable-order-card")};return s.jsx(vs,{"data-test":"undelivered-editable-order-card",title:{text:g(),as:"h2",a11yText:y},description:E(),icon:"orders_placed",alertBanner:{intent:"action",text:I()},onClick:S,to:{...Js(cn(e.orderId)),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${l}`}})},R3t=({order:e,carrierType:t,noAnalytics:n})=>{const o=L(),r=F(),a=f(Zt),i=f(Mt),[l]=Ee(["csoei"]),[c,d]=h.useState(ct()),u=la("homepage-card");h.useEffect(()=>{n||r(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",STATUS:"editing order",ORDER_ID:e.orderId,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}}))},[]);const p=()=>s.jsx(b,{id:"logged.in.home.page.order.card.under.edit.title"}),g=()=>s.jsx(jf,{order:e,carrierType:t}),E=()=>s.jsxs(h.Fragment,{children:[s.jsx(b,{id:"logged.in.home.page.order.card.under.edit.subtitle"})," ",s.jsx(Gl,{dateIso:e.dates.confirmOrderChangesBy,timeZoneId:e.dates.timeZoneId,local:!0,dateFormat:a,timeFormat:i})]}),y=()=>s.jsx(b,{id:"logged.in.home.page.order.card.under.edit.alert.text"}),I=o.formatMessage("logged.in.home.page.order.card.under.edit.accessibility.title.label").concat(" "),S=()=>{r(U.analyticsEvent({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,data:{STATUS:"editing order",ORDER_ID:e.orderId,PAGE_EVENT_ID:c,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}})),d(ct()),u("order-under-edit-card")},C=()=>{n||S()};return s.jsx(vs,{"data-test":"order-under-edit-card",icon:"orders_edit",title:{text:p(),as:"h2",a11yText:I},description:l?E():g(),additionalInfo:l?null:E(),onClick:C,alertBanner:{intent:"warning",text:y()},to:{...Js(cn(e.orderId)),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${c}`}})},D3t=({order:e,carrierType:t,noAnalytics:n})=>{const o=L(),r=F(),[a,i]=h.useState(ct()),l=la("homepage-card");h.useEffect(()=>{n||r(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",STATUS:"order cancelled",ORDER_ID:e.orderId,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}}))},[]);const c=()=>{r(U.analyticsEvent({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,data:{STATUS:"order cancelled",ORDER_ID:e.orderId,PAGE_EVENT_ID:a,EXTERNAL_COLLECTION_POINT_ID:e.externalAddress?.externalCollectionPointId}})),i(ct()),l("order-scratched-card")},d=()=>{n||c()},u=()=>s.jsx(b,{id:"logged.in.home.page.order.card.order.scratched.title"}),p=()=>s.jsx(jf,{order:e,carrierType:t}),g=o.formatMessage("logged.in.home.page.order.card.order.scratched.accessibility.title.label").concat(" ");return s.jsx(vs,{"data-test":"order-scratched-card",icon:"info_default",title:{text:u(),as:"h2",a11yText:g},description:p(),to:{...Js(cn(e.orderId)),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${a}`},onClick:d})},O3t=({order:e,carrierType:t,noAnalytics:n})=>{const o=L(),r=F(),[a,i]=h.useState(ct()),l=la("homepage-card"),{orderId:c,externalAddress:d}=e;h.useEffect(()=>{n||r(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"upcomingOrderCard",STATUS:"last order",ORDER_ID:c,EXTERNAL_COLLECTION_POINT_ID:d?.externalCollectionPointId}}))},[]);const u=()=>{r(U.analyticsEvent({type:Xt.HOMEPAGE_UPCOMING_ORDER_CARD_CLICKED,data:{STATUS:"last order",ORDER_ID:c,PAGE_EVENT_ID:a,EXTERNAL_COLLECTION_POINT_ID:d?.externalCollectionPointId}})),i(ct()),l("previous-order")},p=()=>{n||u()},g=()=>s.jsx(b,{id:"logged.in.home.page.order.card.previous.order.title"}),E=()=>s.jsx(jf,{order:e,carrierType:t}),y=o.formatMessage("logged.in.home.page.order.card.previous.order.accessibility.title.label").concat(" ");return s.jsx(vs,{"data-test":"order-delivered-card",title:{text:g(),as:"h2",a11yText:y},description:E(),icon:"orders",to:{...Js(cn(e.orderId)),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${a}`},onClick:p})},Ure=({alternativeOrder:e,noAnalytics:t=!1})=>{const n=F(),[o,r]=h.useState(!1),a=f(cN),i=f(Rt);h.useEffect(()=>(!e&&(!i||!a.lastUpdated&&!a.isFetching)&&l(),()=>{r(!1)}),[]);const l=()=>n(Mre.getOrders()).catch(()=>r(!0)),c=(y,I)=>{const S=I?.slotBookingComponent;if(["NOT_EDITABLE","EDIT_EXPIRED","PENDING_PAYMENT","OTHER_UNDER_EDIT"].includes(y.editStatus||""))switch(y.status){case"FUTURE":case"PICKED":return s.jsx(x3t,{order:y,carrierType:S,noAnalytics:t});case"SCRATCHED":return s.jsx(D3t,{order:y,carrierType:S,noAnalytics:t});case"DELIVERED":return s.jsx(O3t,{order:y,carrierType:S,noAnalytics:t});default:return Ue.api.pushError(new Error("WebAnalytics: Failed to load order.status"),{context:{order:JSON.stringify(y)}}),s.jsx(cx,{noAnalytics:t})}return y.editStatus==="EDITABLE"?s.jsx(A3t,{order:y,carrierType:S,noAnalytics:t}):y.editStatus==="UNDER_EDIT"?s.jsx(R3t,{order:y,carrierType:S,noAnalytics:t}):(Ue.api.pushError(new Error("WebAnalytics: Failed to load order"),{context:{order:JSON.stringify(y)}}),s.jsx(cx,{noAnalytics:t}))},d=e||a.fetchSuccess&&a.orderEntitiesLastUpdated,u=!e&&d?Bre(a.orders):[],p=e||(u?.[0]?u[0]:null),{isReady:g,carrierDetails:E}=$m({carrierId:p?.carrierId,shippingGroupType:p?.shippingGroupType});return o?(Ue.api.pushError(new Error("WebAnalytics: Failed to load order"),{context:{errorFetching:o.toString()}}),s.jsx(cx,{noAnalytics:t})):!d||!g?s.jsx(vs.Skeleton,{description:!0,"data-test":"order-card-skeleton"}):p?c(p,E):s.jsx(E3t,{})},P3t=()=>{const e=F(),t=f(Yn(NM));return s.jsx(Q,{gap:["sm"],onClick:()=>e(J.closeModal()),children:s.jsx(Ure,{alternativeOrder:t?.referenceOrder,noAnalytics:!0})})},N3t=({className:e})=>s.jsx(ee,{as:"h2",className:e,children:s.jsx(b,{id:"slots.upcoming.order.card.title"})}),NM="UPCOMING_ORDER_MODAL_NAME",L3t="upcoming-order-modal",k3t=()=>{const e=F(),t=f($e(NM)),n=()=>{e(J.closeModal())};return s.jsxs(B,{isOpen:t,onRequestClose:n,asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(N3t,{})}),s.jsx(B.Body,{"data-test":L3t,children:s.jsx(P3t,{})})]})},j3t=({shouldRenderDeliveryDetailsPlaceholder:e,shouldRenderDeliveryDetailsSelector:t,onDeliveryDetailsSaved:n,cancelSlotSelection:o,hasUnconfirmedSlot:r})=>{const a=e||t?6:12;return s.jsxs(V,{className:"salt-gap--2 salt-p-b--2",flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,lg:a},children:s.jsx(bM,{})}),s.jsx(ae.Fragment,{children:e?s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(_e,{height:"40px"})}):s.jsx(ae.Fragment,{children:t&&s.jsx(V.Item,{colSpan:{xs:12,lg:6},children:s.jsx(Nf,{onDeliveryDetailsSaved:n,handleModalClose:o,hasUnconfirmedSlot:r})})})})]})},M3t=(e,t,n)=>{const o=Ge(),[r,a,i]=Ee(["daddi","dede","dass"]),l=f(gP),[c,d]=h.useState(l),[u,p]=h.useState(null),g=F(),E=f(Po),y=f(Hl);dM.usePreloadData();const I=!!(a&&e!==pt.clickAndCollect.method&&!n);h.useEffect(()=>{I&&g(uj({deliveryDestinationId:E}))},[I,E]),h.useEffect(()=>{!c&&l&&d(l)},[l,c]);const S=()=>{d(void 0),p(null)},C=h.useCallback(async(R,P)=>{if(!R||!t||!E)return Promise.reject();if(I&&!Hoe({deliveryOptions:P??y,featureFlags:{isDropOffRequired:!!a,isDeliveryAssetRequired:!!i,isAdditionalInfoRequired:!!r}}))return g(J.openModal(vf)),p(R),Promise.reject();const{deliveryPrice:N,minimumOrder:k,slotId:M}=R,w="ecoSlot"in R?R.ecoSlot:void 0,j="onDemandProperties"in R;return g(ds({name:WY,attributes:{deliveryType:t,deliveryMethod:e}})),g(EM.selectSlot({slotId:M,deliveryPrice:N,minimumOrder:k,deliveryType:t,deliveryMethod:e,deliveryDestinationId:E,ecoSlot:w,type:j?"ON_DEMAND":"STANDARD",isFakeAvailable:"isFakeAvailable"in R?R?.isFakeAvailable:!1},o))},[t,e,E,y]),T=h.useCallback(async R=>{if(R&&c?.slotId!==R.slotId)if(R.isUpcomingOrder)g(J.openModal(NM,{referenceOrder:R.referenceOrder}));else{d(R);try{await C(R)}catch{d(l)}}},[c?.slotId,e,C]);return{selectedSlot:c,unconfirmedSlot:u,selectSlot:T,slotSelectionHandler:C,onDemandSlotSelectionHandler:R=>C(R,void 0),selectedDestinationDeliveryId:E,shouldPrepareDeliveryDetails:I,cancelSlotSelection:S,onDeliveryDetailsSaved:R=>{u&&C(u,R).finally(()=>p(null))}}},w3t=({fetchSlots:e,noDefaultCncAddress:t})=>{const n=F(),[o]=Ee(["dds"]),{onDemandSlots:r}=f(Cv),a=f(mP),i=f(AVe),l=f(DE),c=f(n_),d=f(af),u=f(Ys),p=f(qR),g=f(LX),E=yo(),y=f(Xi),I=f(dAt),S=f(OX),{open:C}=Wt(Gc),T=os({breakpoint:"sm-up"}),{selectedSlot:_,unconfirmedSlot:A,selectSlot:R,slotSelectionHandler:P,onDemandSlotSelectionHandler:N,selectedDestinationDeliveryId:k,shouldPrepareDeliveryDetails:M,cancelSlotSelection:w,onDeliveryDetailsSaved:j}=M3t(u,p,y),G=l||!k,W=!!(a.length||r.length),H=M&&I,K=M&&W&&!!c.length,X=()=>{if(o)return{text:"slotbooking.open.dds",onClick:()=>n(J.openModal(fm))}};h.useEffect(()=>{G||n(ds({name:VY}))},[G]),h.useEffect(()=>{g&&n(E({type:Ve.SLOTBOOKING_NO_SAVED_ADDRESS_DISPLAYED}))},[g]);const q=!y&&s.jsx(gh,{className:T?"salt-m-b--4 salt-m-x--4":"salt-m-b--4"});if(d)return s.jsxs(h.Fragment,{children:[s.jsx(gh,{className:T?"salt-m-b--4 salt-m-x--4":"salt-m-b--4"}),s.jsx(KS,{variant:u,primaryButton:X()})]});if(S)return s.jsxs(h.Fragment,{children:[q,s.jsx(Ere,{openChangeHomeAddressesModal:()=>n(J.openModal(_p))})]});if(g)return s.jsxs(h.Fragment,{children:[q,s.jsx(fre,{})]});if(t)return s.jsxs(h.Fragment,{children:[s.jsx(gh,{className:T?"salt-m-b--4 salt-m-x--4":"salt-m-b--4"}),s.jsx(gre,{openCollectionPointModal:C})]});const ne=!a.length&&!r.length&&!G;return s.jsx(V,{flush:!0,fixed:!0,className:`salt-m-y--0 ${T?"salt-m-x--2":""}`,children:s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(k3t,{}),s.jsx(u4t,{}),!ne&&!y&&s.jsx(Ad,{selectedSlot:_||null,slotSelectionHandler:()=>P(_||null),fetchSlots:e}),y?s.jsx(_re,{}):s.jsxs(h.Fragment,{children:[s.jsx(gh,{className:"salt-m-b--4"}),s.jsx(j3t,{shouldRenderDeliveryDetailsPlaceholder:H,shouldRenderDeliveryDetailsSelector:K,onDeliveryDetailsSaved:j,cancelSlotSelection:w,hasUnconfirmedSlot:!!A})]}),s.jsx(m3t,{isLoading:G,onDemandSlots:r,onDemandSlotSelectionHandler:N,onSelectSlot:R,selectedSlot:_,unconfirmedSlot:A,standardSlots:a,ecoSlotsIds:i,fetchSlots:e})]})})},p1=({children:e,...t})=>s.jsx(V,{flush:!0,fixed:!0,...t,children:s.jsx(V.Item,{colSpan:{xs:12},children:e})}),F3t=()=>{const e=F(),t=Ne(),n=Ge(),o=f(Xi),r=DM(),a=RM(),[i,l,c]=Ee(["bt.spl","sl.rd","sl.fsa"]),d=Yzt(),u=Are(),p=os({breakpoint:"md-up"}),{open:g,isOpen:E}=Wt(Gc),y=f(At),I=f(jm),S=f(bu),C=f(PX),T=f(NX),_=f(UR),A=f(ur),R=f(qR),P=f(Ys),N=f(Po),k=f($i),M=f(GL),w=f(zs),j=f(ZV),G=f(mm),W=f(TVe),H=f($e(HA)),K=f($e(mM)),X=f(bVe),q=f(xVe),ne=f(um),ue=f(_X),oe=f(bX),ye=f(af),he=f(Bct),Ie=f(DX),Fe=Bn(N),be=Bn(ne),ce=Bn(I.isFetching),me=Bn(P),De=xre(),Se=!!yzt(N,S);Jzt({enabled:c});const Ae=()=>a&&q?(e(To.clearPersistedPreviouslySelectedAddress()),!1):a,We=(()=>{const Io=me&&me!==P,qo=Ae();return Io||qo||!N||!Se})()&&C,et=P===pt.clickAndCollect.method,ve=()=>!!AM(k,S),lt=l?De:We&&et&&!M&&!ve(),St=Io=>{const qo=Ie,hi=l&&De,So=K&&i&&!Io?.isFetchTriggeredBySelectSlotModal;!(ye||So||qo||hi)&&P&&N&&e(Szt({deliveryDestinationId:N,deliveryMethod:P,shippingGroupType:ne}))},wt=h.useMemo(()=>Vr(St,qHe),[N,P,ne,S,i,K]);h.useEffect(()=>(ca(),e(To.invalidateSlots()),wa(),gs(),e(UWt()),(i||he!==X||A.didInvalidate)&&ju(),!j.lastUpdated&&!j.isFetching&&e(_d.getSupportedDeliveryMethods()),()=>{wt.cancel(),e(To.invalidateSlots())}),[]),h.useEffect(()=>{a||(Mo(),dn())},[t.pathname,t.search,W,G,w,S,ne,N,k,P,H]),h.useEffect(()=>{if(!a){!C&&!I.fetchError&&wa(),gs();const Io=N&&Fe!==N,qo=be!==ne,hi=ce&&!I.isFetching;(Io||qo||(l?!1:hi))&&(l&&wt.cancel(),ju())}return()=>{l||wt.cancel()}},[t.pathname,t.search,W,w,S.length,ne,N,k,P,H]);const dn=()=>{const Io=!!w.data?.deliveryMethod,qo=!w.data&&!w.isFetching,hi=Io||qo||w.fetchError,So=t.pathname===Ui(y);if(hi&&So){const mr=fzt({deliveryMethod:P,search:t.search,orderRoot:r});n(mr,{replace:!0})}},Mo=()=>{Mn()&&Zs()&&he===X&&n(jt()),Mn()&&!Zs()&&!H&&e(J.openModal(HA)),Mn()&&ye&&H&&e(J.closeModal())},Zs=()=>N===k,Mn=()=>W&&!G,Kn=()=>{const{data:Io}=w;M&&!N&&u(Io?.deliveryDestinationId,Io?.addressId)},gs=()=>l?d():Vc(),Vc=()=>{Kn();const Io=ue&&oe&&ve();if(We&&Io){const{deliveryDestinationId:So,addressId:mr}=w.data;u(So,mr);return}if(We&&(ue&&!oe&&et)){const{deliveryDestinationId:So,addressId:mr}=Loe(S,Noe(w))[0]||{};u(So,mr);return}if(lt&&!E){e(U.analyticsEvent({type:Ve.MAP_RENDERED_REASON})),g();return}if(We&&(ue&&!oe&&!et||!ue||!ve())){const So=Ire(S);if(So){const{deliveryDestinationId:mr,addressId:ql}=So;u(mr,ql),Ue.api.pushError(new Error("Slot-booking page: Fallback address selected"),{context:{selectedDeliveryDestinationId:mr,deliveryMethod:P,ddsDeliverability:w.data?.deliverability||"",ddsDeliveryDestinationId:w.data?.deliveryDestinationId||"",ddsDeliveryMethod:w.data?.deliveryMethod||""}})}}},wa=()=>{T||I.isFetching||ye||(P===pt.clickAndCollect.method?e(hn.getCustomerCollectionDeliveryDestinations()):e(hn.getHomeDeliveryDestinations()))},ca=()=>{P===pt.clickAndCollect.method?e(hn.invalidateCustomerCollectionDeliveryDestinations()):e(hn.invalidateHomeDeliveryDestinations())},ju=()=>{e(To.requestSlotsDebounced()),wt()},Yl=()=>ps.parse(t.search)["in-checkout-walk"]==="true",Jm=l?ae.Fragment:p1,Wc=l?p1:ae.Fragment;return s.jsxs(h.Fragment,{children:[s.jsx(zBt,{}),s.jsxs(Jm,{children:[s.jsxs(Wc,{children:[l?s.jsx(a4t,{shrink:!p}):s.jsx(s4t,{}),!l&&s.jsxs(h.Fragment,{children:[s.jsx(o4t,{}),o?s.jsx(_re,{className:"salt-p-x--2"}):s.jsx(gh,{className:"salt-m-x--2"})]})]}),l?s.jsx(w3t,{fetchSlots:St,noDefaultCncAddress:lt}):s.jsx(Ezt,{slotBooked:_,deliveryMethod:P,fetchSlots:St,deliveryType:R,inCheckoutWalk:Yl(),noDefaultCncAddress:lt})]})]})},Ha=()=>s.jsx(Et,{type:"SlotBookingPage::route",children:s.jsx(F3t,{})});Ha.fetchData=({context:e})=>{const{dispatch:t}=e.store;return Promise.all([t(Yt.getBasket()).then(n=>n?.deliveryDestinationId?t(hn.getSelectedDeliveryDestinationData(n.deliveryDestinationId)):null),t(hn.getHomeDeliveryDestinations()),t(hn.getCustomerCollectionDeliveryDestinations()),t(_d.getSupportedDeliveryMethods())])};const B3t=()=>{const e=F(),t=f(K2),n=f(iN),o=!!f(Vv),r=f(Wv),a=!!f(lN),[i,l]=Ee(["sb.pop","fppco"]);h.useEffect(()=>{a&&e(_T.fetchFailedOrderPayments()).catch(()=>!1),i||(!t.lastUpdated&&!t.isFetching||t.didInvalidate?e(xs.getRequiresAdditionalDetails()):t.required&&u()),o&&e(J.openModal("failedPayment"))},[]),h.useEffect(()=>{i||t.required&&u()},[t]);const c=()=>l&&r&&r.orderId,d=()=>n.isFetching,u=()=>{e(J.openModal("additionalDetails"))};return c()?d()?null:(e(J.openModal("failedPayment")),s.jsx(fT,{hasRedirect:!0})):s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"delivery.page.title"}),t.required&&!i?s.jsxs(h.Fragment,{children:[s.jsx(V,{className:"salt-m-t--16",children:s.jsx(V.Item,{colSpan:{xs:12,sm:6,md:4},colStart:{xs:0,sm:4,md:5},children:s.jsx(Os,{description:"additional.details.page.message",primaryButton:{text:"additional.details.page.button",onClick:u}})})}),s.jsx(hse,{})]}):s.jsx(pR,{})]})},U3t=e=>{const t=un.isSubscriptionEnabled;return t(e.getState())?e.dispatch(uu.getCustomerSubscriptions()):null},LM=()=>s.jsx(Et,{type:"Delivery::route",children:s.jsx(B3t,{})});LM.fetchData=({context:{store:e}})=>Promise.all([e.dispatch(xs.getRequiresAdditionalDetails()),U3t(e)]);const G3t=({icon:e,title:t,redirectUrl:n,message:o,selectButtonAltText:r,displayName:a,type:i,xs:l,sm:c,md:d,lg:u})=>{const{formatMessage:p}=L(),g=F(),E=Ge(),y=I=>(g(ds({name:Gxe,event:I,attributes:{deliveryType:i}})),E(n));return s.jsxs(Oe.Action,{xs:l,sm:c,md:d,lg:u,chip:void 0,innerRef:void 0,children:[s.jsxs(Oe.Action.Header,{children:[s.jsx(pe,{name:e,height:20}),s.jsx(Oe.Action.HeaderText,{as:"h3",children:t})]}),s.jsx(Oe.Action.Body,{children:o}),s.jsx(Oe.Action.Footer,{children:s.jsx(x,{intent:"secondary","aria-label":r,"data-synthetics":`delivery-method-${a}`,"data-test":`delivery-method-${a}`,onClick:y,children:s.jsx(x.Text,{children:p("delivery.type.select.button")})})})]})},$3t=()=>({homeDelivery:{type:pt.vanDelivery.type,displayName:"van",displayNameKey:"delivery.type.name.van",destination:bc(),icon:"home_delivery",messageKey:"delivery.type.message.van",selectButtonAltTextKey:"delivery.type.select.button.alternative.van"},customerCollection:{type:pt.clickAndCollect.type,displayName:"c&c",displayNameKey:"delivery.type.name.cnc",destination:Jd(),icon:"click_collect",messageKey:"delivery.type.message.cnc",selectButtonAltTextKey:"delivery.type.select.button.alternative.cnc"}}),H3t=()=>{const{formatMessage:e}=L(),t=F(),n=Ne(),o=DM(),[r]=Ee(["dcbbs"]),a=$3t(),i=f(sE),l=f(ZV),c=f($i),d=f(spe),u=f(zs),p=f(e2),g={heading:e("delivery.type.select.breadcrumb"),sectionHeadingText:e("delivery.type.select.heading")};h.useEffect(()=>{!l.lastUpdated&&!l.isFetching&&t(_d.getSupportedDeliveryMethods())},[]);const E=()=>l.data.length>1,y=(N,k="")=>{const M=Qe.parse(n.search);return delete M.sourceEventId,delete M.source,`${o||""}${N}${k}?${Qe.stringify(M)}`},I=()=>p?p===Il?a?.customerCollection?.destination:a?.homeDelivery?.destination:l.data?.some(k=>k===Il)?a?.customerCollection?.destination:a?.homeDelivery?.destination,S=()=>{const N=I();return s.jsx(En,{to:y(N)})},C=()=>Object.values(a).map(({icon:N,displayNameKey:k,messageKey:M,selectButtonAltTextKey:w,displayName:j,type:G,destination:W})=>s.jsx(G3t,{displayName:j,icon:N,title:e(k),message:e(M),selectButtonAltText:e(w),redirectUrl:y(W),type:G},k)),T=()=>{const N=!c||!p;return E()&&N?C():S()},_=()=>s.jsx("div",{className:"salt-m-t--16",children:s.jsx(_s,{size:"l"})}),A=l.lastUpdated,R=d&&(u.lastUpdated||!c),P=!!(A&&R);return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"delivery.type.select.page.title"}),!P&&_(),P&&s.jsxs(h.Fragment,{children:[s.jsx(sn,{children:s.jsx(ee,{as:"h1",children:g.heading})}),s.jsx(V,{flush:!0,fixed:!0,children:s.jsx(V.Item,{colSpan:{xs:12},children:s.jsxs("div",{className:"salt-p-y--4",children:[r?s.jsx("div",{className:"salt-p-b--2",children:s.jsx($S,{slotBooked:i})}):s.jsx($S,{slotBooked:i}),s.jsx("div",{className:"salt-m-x--2",children:s.jsx(js,{title:g.sectionHeadingText,children:s.jsx("div",{className:"salt-m-t--4",children:s.jsx(Oe.Collection,{md:2,lg:2,children:T()})})})})]})})})]})]})},Gre=()=>s.jsx(Et,{type:"DeliveryLandingPage::route",children:s.jsx(H3t,{})});Gre.fetchData=({context:{store:e}})=>e.dispatch(_d.getSupportedDeliveryMethods());const QS=D("homedel"),V3t=D("sl.dms"),XS=D("cncdel"),W3t=[{path:"/delivery",Component:$s(Xe,LM),children:[{index:!0,Component:as(V3t,Gre,Ha)},{path:"collection",Component:as(XS,Ha,ot)},{path:"collection/slots",Component:as(XS,Ha,ot)},{path:"home",Component:as(QS,Ha,ot)},{path:"home/slots",Component:as(QS,Ha,ot)},{path:"*",Component:ot}]}],Y3t=[{path:"/orders/:orderId/delivery",Component:$s(Xe,LM),children:[{index:!0,Component:Ha},{path:"collection",Component:as(XS,Ha,ot)},{path:"collection/slots",Component:as(XS,Ha,ot)},{path:"home",Component:as(QS,Ha,ot)},{path:"home/slots",Component:as(QS,Ha,ot)},{path:"*",Component:ot}]}],q3t=e=>[{path:"/delivery",Component:e.Main,children:W3t},{path:"/orders/:orderId/delivery",Component:e.Main,children:Y3t}],$re=()=>s.jsxs(ae.Fragment,{children:[s.jsx(Oe.Action.Skeleton,{},"skeleton1"),s.jsx(Oe.Action.Skeleton,{},"skeleton2"),s.jsx(Oe.Action.Skeleton,{},"skeleton3")]}),Zc={ERROR:"error",WARNING:"warning",SUCCESS:"success"},K3t=({linkMessage:e,alertMessage:t,selectedPlan:n,subscription:o,alertDataTest:r,values:a,type:i})=>{const l=F(),c=L();return s.jsx(Te,{showIcon:!1,intent:i,"data-test":r,"data-test-type":i,text:s.jsxs(h.Fragment,{children:[s.jsx(b,{id:t,values:a}),"",e&&s.jsx(Ye,{onClick:()=>{(n?.subscription?.subscriptionId||o?.subscriptionId)&&l(U.analyticsEvent({type:bs.MANAGE_CURRENT_PLAN_BUTTON_CLICKED,buttonName:"Manage pass",subscriptionId:n?.subscription?.subscriptionId??o?.subscriptionId,retailerSubscriptionPlanId:n?.planId,buttonLabel:c.formatMessage(e)}))},to:ar(),children:s.jsx(b,{id:e})})]})})};function z3t(e){const{status:t,autoRenewalStatus:n,nextRenewal:o,paymentInformation:r}=e,{isSubscriptionPlanTransitionEnabled:a,is3dsSubscriptionsFlowEnabled:i}=No(),l=a&&o?.planIsTransitioning;return o&&!o.planId?"error":t==="ACTIVE"?i&&r?.authRequired?"3ds-auth-required":l?n?"plan-transition-with-autorenewal":"plan-transition-without-auto-renewal":n?"auto-renewal":"no-auto-renewal":t==="PENDING"?"pending":"none"}function Q3t({benefitGroupSubscription:e,selectedPlan:t}){const n=z3t(e),o=f(cr),{benefitDescription:r,expiry:a,benefitName:i}=e;switch(n){case"error":return s.jsx(Jc,{type:Zc.ERROR,values:{pass:`${i} - ${r}`,expiryDate:gt(a,o)},alertMessage:"delivery.pass.plan.terminated.message",alertDataTest:"renewal-disabled-alert"});case"3ds-auth-required":return s.jsx(Jc,{type:Zc.ERROR,values:{pass:`${i} - ${r}`},alertDataTest:"subscription-reauth-required-alert",alertMessage:"settings.delivery.pass.reauth.message"});case"plan-transition-with-autorenewal":return s.jsx(Jc,{type:Zc.WARNING,selectedPlan:t,subscription:e,values:{passName:`${i} - ${r}`,transitioningDate:gt(a,o)},alertDataTest:"autorenewal-enabled-transitioning-plan-alert",alertMessage:"settings.delivery.pass.auto.switch.on.message",linkMessage:"settings.delivery.pass.auto.switch.on.link.label"});case"plan-transition-without-auto-renewal":return s.jsx(Jc,{type:Zc.ERROR,selectedPlan:t,subscription:e,values:{pass:`${i} - ${r}`,expiryDate:gt(a,o)},alertDataTest:"autorenewal-disabled-transitioning-plan-alert",alertMessage:"subscription.delivery.pass.ends.auto.renew.off.message",linkMessage:"delivery.pass.settings.link.label"});case"auto-renewal":return s.jsx(Jc,{type:Zc.SUCCESS,selectedPlan:t,subscription:e,values:{pass:`${i} - ${r}`},alertDataTest:"autorenewal-enabled-alert",alertMessage:"delivery.pass.auto.renew.on.message",linkMessage:"delivery.pass.settings.link.label"});case"no-auto-renewal":return s.jsx(Jc,{type:Zc.WARNING,selectedPlan:t,subscription:e,values:{pass:`${i} - ${r}`,expiryDate:gt(a,o)},alertDataTest:"autorenewal-disabled-alert",alertMessage:"delivery.pass.auto.renew.off.message",linkMessage:"delivery.pass.settings.link.label"});case"pending":return s.jsx(Jc,{type:Zc.WARNING,alertMessage:"settings.delivery.pass.pending.message"});case"none":default:return null}}function Jc(e){return s.jsx("div",{className:"salt-m-l--2 salt-m-t--2 salt-m-b--2","data-test":"subscription-alert-simple-wrapper",children:s.jsx(K3t,{...e})})}const X3t=({modalTitle:e,headerLabelId:t})=>{const[n]=Ee([KP]);return s.jsx(B.Header,{align:n?"left":"center",children:s.jsx(ee,{as:"h2",id:t,"data-test":"payment-buy-subscription-title",children:e})})},Z3t=e=>f(Yn(e))??{},J3t=({selectedPlan:e})=>{const t=f(D(xqe));return e?.freeTrial?.eligible&&t?s.jsx(Te,{intent:"warning",text:s.jsx(b,{id:"settings.delivery.pass.free.trial.payment.method.selection.alert"}),className:"salt-m-b--2",showIcon:!1}):null},e5t=({buttonText:e,hideModalSubtitle:t,selectedPlan:n,disabled:o,selectedPaymentMethod:r,selectPaymentMethod:a,confirmPayment:i})=>{const{preselectedWalletItem:l}=Z3t(kM),c=f(UE),d=r===void 0||c.items.length===0,u=s.jsx(x,{intent:"primary",fill:!0,disabled:d,loading:o,onClick:i,"data-test":"payment-buy-subscription-button",className:"salt-m-b--4",children:e});return s.jsxs(h.Fragment,{children:[!t&&s.jsx(O,{size:"l",bold:!0,className:"salt-m-b--4",children:s.jsx(b,{id:"payment.choose.payment.method"})}),s.jsx(bf,{initialFundingInstrumentId:l?.fundingInstrumentId,initialWalletItemId:l?.walletItemId,onSelectPaymentMethod:p=>a(p),additionalAlert:s.jsx(J3t,{selectedPlan:n}),selectedPayment:r,primaryButton:u,enablePayByCardOptionWhenNoMetadataAvailable:!0})]})},t5t={modalTitle:void 0},Hre=({modalTitle:e,isTaxGrossDisplayed:t,taxInfo:{taxGroups:n,taxTotal:o},headerLabelId:r,disabled:a,hideModalSubtitle:i,selectedPlan:l,buttonText:c,confirmPayment:d,selectPaymentMethod:u,selectedPaymentMethod:p})=>s.jsxs(h.Fragment,{children:[e&&s.jsx(X3t,{modalTitle:e,headerLabelId:r}),s.jsxs(B.Body,{children:[s.jsx(Af,{isTaxGrossDisplayed:t,taxGroups:n,taxTotal:o}),s.jsx(e5t,{buttonText:c,hideModalSubtitle:i,selectedPlan:l,disabled:a,confirmPayment:d,selectPaymentMethod:u,selectedPaymentMethod:p})]})]});Hre.defaultProps=t5t;const m1="select-payment-method-modal-header",Vre=({disabled:e=!1,isFetching:t=!1,taxInfo:n={taxGroups:[],taxTotal:"",isError:!1},modalTitle:o,buttonText:r,isTaxGrossDisplayed:a=!1,hideModalSubtitle:i=!1,selectedPlan:l,onClose:c=()=>{},onSelectPaymentMethod:d=()=>{},onConfirm:u=()=>Promise.resolve(),onAfterClose:p=()=>{},asBottomSheet:g=!1})=>{const E=f(tm),y=Wt(kM),[I,S]=h.useState(e),[C,T]=h.useState(void 0),_=F();h.useEffect(()=>{_(Km.getWalletItems())},[]);const A=()=>{_(U.analyticsEvent({type:Ot.PAYMENT_METHOD_DETAILS_MODAL_DISPLAYED,userAction:"close"})),_(U.analyticsEvent({type:bs.SELECTED_DELIVERY_PASS_PLAN_MODAL_DISPLAYED,userAction:"close"}))},R=w=>{A(),w.preventDefault(),c?.(),y.close(),T(void 0),p?.()},P=w=>{T(w),_(U.analyticsEvent({type:Ot.SELECT_WALLET_ITEM,description:"User selected payment method",pageEventAttributes:{page:E,walletItemId:w.walletItemId||"NOT_SAVED"}}));const j={event:"event",eventCategory:"Payment",eventAction:"SelectWalletItem",eventLabel:E,walletItemId:w.walletItemId||"NOT_SAVED"};te.sendEvent({GA:j,WA:null}),d?.(w)},N=async()=>{S(!0);try{await u?.(C)}finally{S(!1)}},k=()=>{y.open()},M=!t&&n?.isError;return s.jsxs(h.Fragment,{children:[s.jsx(B,{isOpen:y.isOpen,isLoading:t,onRequestClose:R,aria:{labelledby:m1},data:{test:"select-payment-method-modal"},asBottomSheet:g,children:M?s.jsx(_j,{actions:{onButtonClick:()=>{y.close()}}}):s.jsx(Hre,{modalTitle:o,isTaxGrossDisplayed:a,taxInfo:n,headerLabelId:m1,disabled:I,hideModalSubtitle:i,selectedPlan:l,buttonText:r,confirmPayment:N,selectPaymentMethod:P,selectedPaymentMethod:C})}),s.jsx(vj,{close:k})]})},kM="selectPaymentMethod",jM=({modalsTitle:e="",confirmPaymentMethodText:t="",preselectedWalletItem:n={},onInitiatePayment:o=()=>Promise.resolve(),selectedPlan:r,onAuthNotRequired:a=()=>Promise.resolve(),onAuthFailure:i=()=>{},onAuthCompleted:l=()=>Promise.resolve(),isTaxGrossDisplayed:c,taxInfo:d={taxGroups:[],taxTotal:"",isError:!1},onClosePaymentMethodPicker:u=()=>{},onCloseAuthorization:p=()=>{},asBottomSheet:g=!1})=>{const E=Ne(),y=F(),I=typeof window<"u",S=()=>(I?window.innerHeight:0)<750?450:650,[C,T]=h.useState(void 0),[_,A]=h.useState(void 0),[R,P]=h.useState(!1),[N,k]=h.useState(void 0),[M,w]=h.useState(!1),[j,G]=h.useState(S()),W=f(s5t),H=f(sze);h.useEffect(()=>{if(I){const Ie=()=>{G(S())};return window.addEventListener("resize",Ie),()=>window.removeEventListener("resize",Ie)}},[I]),h.useEffect(()=>()=>{y(Gt.finishPayment())},[]),h.useEffect(()=>{y(Gt.setUnselectedPaymentWarning(!C))},[C]),h.useEffect(()=>{const{openPaymentModal:Ie,recoveryToken:Fe}=ps.parse(E.search);H?W?(y(J.openModal("selectPaymentMethod",{preselectedWalletItem:n})),y(U.analyticsEvent({type:Ot.PAYMENT_METHOD_DETAILS_MODAL_DISPLAYED,userAction:"open"}))):K():Ie!==void 0?y(Gt.initiatePayment()):Fe&&Fe!==N&&k(Fe)},[H]),h.useEffect(()=>{H&&C&&K()},[C]),h.useEffect(()=>{H&&R&&o(C).then(Ie=>{Ie?A(Ie):a(C).then(()=>y(Gt.finishPayment()))}).catch(oe).finally(()=>{P(!1),w(!1)})},[H,R]),h.useEffect(()=>{N&&y(J.openModal("paymentPsp"))},[N]);const K=()=>{y(J.openModal("paymentPsp")),P(!0),w(!0)},X=Ge(),q=()=>{k(void 0);const Ie=new URLSearchParams(E.search);Ie.delete("recoveryToken"),X({search:Ie.toString(),pathname:E.pathname},{replace:!0})},ne=()=>{A(void 0),q(),y(Gt.finishPayment()),p?.()},ue=()=>{u?.(),C||y(Gt.finishPayment())},oe=Ie=>{i(Ie),ne()},ye=({walletItemId:Ie})=>(T(Ie),Promise.resolve()),he=Ie=>{C&&y(V6.updateDefaultWalletItem(C)),l({resultToken:Ie,selectedWalletItemId:C}).then(()=>y(Gt.finishPayment())),q()};return s.jsxs(h.Fragment,{children:[W&&s.jsx(Vre,{selectedPlan:r,modalTitle:e,buttonText:t,disabled:M,onConfirm:ye,onClose:ue,isFetching:R,isTaxGrossDisplayed:c,taxInfo:d,asBottomSheet:g}),s.jsx(l_,{title:e,handleError:oe,handleSuccess:he,isFetching:R,url:_,onClose:ne,taxInfo:d,isTaxGrossDisplayed:c,isRecoveringThreeDs:!!N,location:E,maxWidth:"md",threeDsHeight:j,asBottomSheet:g})]})},s5t=D("pay.ywlt"),n5t=D(IW),o5t=e=>`${window.location.origin}${kd(e)}${Lc()}`,r5t=()=>`${window.location.origin}${Lc()}`;function a5t(){const e=f(n5t),t=f(sa)??"";return()=>e?o5t(t):r5t()}function MM(e){return wSe({basePath:At(e)??"",clientRouteId:Do(e),csrfToken:Na(e)})}function Wre(e){return e.status===401||e.status===403}function Yre(e){const t=window.location.pathname;JP(),window.location.replace(Yo({basePath:e,queryString:`destination=${encodeURIComponent(t)}`}))}const i5t=2*1e3,l5t=async({subscriptionId:e,subscriptionPoller:t,updateSubscriptionStatus:n,setStatus:o,dispatch:r})=>{try{const a=await DW.server.fetch(r,e),{status:i}=a?.payload?.responseData??{};n.current?.(i)}catch(a){o("FAILED"),clearInterval(t.current),a&&Ue.api.pushError(a instanceof Error?a:new Error(`fetchSelectedSubscription error: ${JSON.stringify(a)}`))}};function wM(e){e.subscriptionPoller.current=setInterval(l5t,i5t,e)}function Xm(){const e=f($e(kIe)),t=F();return{open:()=>{t(J.openModal("deliveryPassSubscription"))},isOpen:e,closeModal:()=>t(J.closeModal())}}function I_(){const e=F(),{open:t}=Xm(),n=h.useCallback(()=>{e(J.openModal("paymentPsp"))},[e]),o=h.useCallback(()=>{e(J.closeModal())},[e]);return{openPaymentPsp:n,openDeliveryPassSubscription:t,close:o}}function c5t(){const e=I_();return t=>{t&&Ue.api.pushError(t),e.close(),Z.error("toast.notification.generic.error")}}function d5t({planId:e,subscriptionPoller:t,updateSubscriptionStatus:n,setStatus:o,isFreeTrialEnabled:r,regionId:a}){const i=F(),l=I_();return c=>i((d,u)=>{const p=MM(u());return PW({postFetchOptions:p,isFreeTrialEnabled:r,planId:e,walletItemId:c,regionId:a}).then(g=>{if(g.ok)return g.json();throw Wre(g)&&Yre(p.basePath),new Error(g.statusText)}).then(({status:g,subscriptionId:E})=>{g!=="ACTIVE"&&wM({subscriptionId:E,subscriptionPoller:t,updateSubscriptionStatus:n,setStatus:o,dispatch:i}),l.openDeliveryPassSubscription()})})}function u5t({subscriptionPoller:e,updateSubscriptionStatus:t,setStatus:n,cleanUpCookie:o}){const r=F(),a=a5t(),i=I_();return({planId:l,walletItemId:c,isFreeTrialEnabled:d,regionId:u})=>r((p,g)=>{const E=MM(g());return o(),i.openPaymentPsp(),n("PENDING"),PW({postFetchOptions:E,isFreeTrialEnabled:d,planId:l,walletItemId:c,regionId:u,checkoutUrl:a()}).then(y=>{if(y.ok)return y.json();throw Wre(y)&&Yre(E.basePath),new Error(y.statusText)}).then(({status:y,subscriptionId:I,url:S})=>{if(S)return S;y!=="ACTIVE"&&wM({subscriptionId:I,subscriptionPoller:e,updateSubscriptionStatus:t,setStatus:n,dispatch:r}),i.openDeliveryPassSubscription()})})}function p5t(){const e=F(),t=I_(),{isFreeTrialEnabled:n}=No(),o=c5t();return({resultToken:r,cleanUpCookie:a,setStatus:i,subscriptionPoller:l,updateSubscriptionStatus:c})=>e((d,u)=>r?(a(),i("PENDING"),MSe({postFetchOptions:MM(u()),isFreeTrialEnabled:n,resultToken:r}).then(p=>{if(p.ok)return p.json();throw new Error(p.statusText)}).then(({subscriptionId:p,status:g})=>{g!=="ACTIVE"&&wM({subscriptionId:p,subscriptionPoller:l,updateSubscriptionStatus:c,setStatus:i,dispatch:e}),t.openDeliveryPassSubscription()}).catch(o)):Promise.resolve())}const m5t=e=>!!e?.cost.currency;function S_(){const e=L(),t=He(),n=Ln.client.useHooks().getComputedState().data,o=n?.displayTaxInformationGross??!1,r=n?.displayTaxInformation??!1;return a=>{const i=Number(o?a?.planPricingInformation?.grossPrice:r&&!o?a?.planPricingInformation?.netPrice:a?.cost.amount);return Number.isNaN(i)&&Ue.api.pushError(new Error("Free Trial Subscription Price NaN"),{context:{options:JSON.stringify(a)}}),{toStringWithCurrency:()=>m5t(a)?t({amount:i,currency:a.cost.currency}):e.formatNumber(i),toNumber:()=>i,toCost:()=>({amount:String(i),currency:a?.cost.currency??""})}}}const qre=()=>{const{data:e}=DW.client.useHooks().getComputedState(),{metadata:{plans:t}}=Ln.client.useHooks().getComputedState(),n=e?.nextRenewal?.planId;return h.useMemo(()=>{if(n===void 0)return null;const o=t.find(r=>r.planId===n);return o===void 0?null:{...e,plan:o}},[n])},h5t=v.div`
    display: flex;
    justify-content: space-between;
`,g5t=v.div`
    display: flex;
`,E5t=v.span`
    text-decoration: line-through;
`,f5t=v.div`
    display: flex;
    justify-content: center;
`;function y5t({texts:{title:e,price:t,name:n,expiry:o,offer:r}}){return s.jsxs(h.Fragment,{children:[s.jsx(f5t,{children:s.jsx(pe,{name:"status_yes",height:82,width:82})}),s.jsxs(js,{children:[s.jsxs("div",{className:"salt-m-b--4 salt-m-r--sm",children:[s.jsx(ee,{as:"h4",children:e}),s.jsx(Ts,{}),s.jsxs(h5t,{children:[s.jsx(ee,{as:"h4",children:n}),s.jsxs(g5t,{children:[s.jsx(O,{className:"salt-m-r--2",children:s.jsx(E5t,{children:t})}),s.jsx(ee,{as:"h4",children:r})]})]})]}),s.jsx(O,{className:"salt-m-b--4",children:o})]})]})}const I5t=({title:e})=>s.jsx(ee,{as:"h2",id:"header-title",children:e}),S5t=({primaryButton:{text:e,onClick:t},secondaryButton:{text:n,onClick:o}})=>s.jsxs(Q,{direction:"column",directionLgUp:"row",basis:"100%",gap:["sm"],wrapSmUp:"wrap",children:[s.jsx(rr,{style:{flexBasis:"0"},children:s.jsx(x,{intent:"secondary",fill:!0,onClick:o,children:s.jsx(x.Text,{children:n})})}),s.jsx(rr,{style:{flexBasis:"0"},children:s.jsx(x,{intent:"primary",fill:!0,onClick:t,children:s.jsx(x.Text,{children:e})})})]});function C_({header:e,body:t,footer:n,dataTest:o}){const r=o?{"data-test":o}:{};return s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:mc,...r,children:e},"header"),s.jsx(B.Body,{children:t},"body"),n?s.jsx(B.Footer,{align:mc,children:n},"footer"):null]})}function Kre(){const e=Ge(),{closeModal:t}=Xm(),n=r=>e(r),o=ja();return()=>{o.deliveryPassSubscribedPlanModalDisplayed("close"),t(),n(Ui())}}const C5t="delivery.pass.purchased.info.title",v5t="delivery.pass.subscription.success.modal.button.slot",T5t="delivery.pass.subscription.success.modal.button.close",_5t="delivery.pass.subscription.success.modal.summary.title",b5t="delivery.pass.subscription.expiry",x5t="payment.modal.price.inclusive.tax",A5t="delivery.pass.free_trial.success_modal.title",R5t="delivery.pass.free_trial.success_modal.subtitle",D5t="delivery.pass.free_trial.success.expiry",O5t="delivery.pass.free_trial.success_modal.offer";function P5t({formatMessage:e,dateFormat:t}){return{getTitle:()=>e(C5t),getFreeTrialTitle:()=>e(A5t),getFreeTrialSubTitle:()=>e(R5t),getFreeTrialOfferMessage:()=>e(O5t),getFreeTrialExpiry:n=>e(D5t,{expiryDate:gt(n,t)}),getBookSlot:()=>e(v5t),getClose:()=>e(T5t),getSummaryTitle:()=>e(_5t),getExpiry:n=>e(b5t,{date:gt(n,t)}),getInclusiveTaxPrice:n=>e(x5t,{amount:n})}}function zre(){const{formatMessage:e}=L(),t=f(cr);return P5t({formatMessage:e,dateFormat:t})}function N5t({subscription:e,price:t}){const n=Kre(),{closeModal:o}=Xm(),r=zre(),a=ja(),i=f(ti);h.useEffect(()=>{a.deliveryPassSignUp({retailerSubscriptionPlanId:e.plan.retailerPlanId,price:t.toNumber(),currency:e.plan.cost.currency,bannerId:i})},[]);const l=!!e.plan.freeTrial,{expiry:c}=e;return s.jsx(C_,{header:s.jsx(I5t,{title:r.getFreeTrialTitle()}),body:s.jsx(y5t,{texts:{title:r.getFreeTrialSubTitle(),price:t.toStringWithCurrency(),name:e.plan.name,expiry:l?r.getFreeTrialExpiry(c):r.getExpiry(c),offer:l?r.getFreeTrialOfferMessage():""}}),footer:s.jsx(S5t,{primaryButton:{text:r.getBookSlot(),onClick:n},secondaryButton:{text:r.getClose(),onClick:o}})})}const Qre="delivery-pass-success-modal-header",L5t=({children:e})=>s.jsx(ee,{as:"h2",id:Qre,children:e}),k5t=v.div`
    display: flex;
    justify-content: center;
`,j5t=({title:e,list:{name:t,taxContent:n},taxesBreakdown:o,expiry:r})=>s.jsxs(h.Fragment,{children:[s.jsx(k5t,{className:"salt-m-b--8",children:s.jsx(pe,{success:!0,name:"status_yes",height:82,width:82})}),s.jsxs(js,{title:e,children:[s.jsx(fe,{className:"salt-m-b--8",children:s.jsxs(fe.Group,{children:[s.jsx(fe.Title,{children:t}),s.jsx(fe.Description,{children:n})]})}),o,s.jsx(O,{children:r})]})]}),M5t=({secondary:{onClick:e,text:t,dataTest:n},primary:{onClick:o,text:r,dataTest:a}})=>s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",onClick:e,fill:!0,"data-test":n,className:"salt-m-r--2",children:s.jsx(x.Text,{children:t})}),s.jsx(x,{intent:"primary",onClick:o,fill:!0,"data-test":a,children:s.jsx(x.Text,{children:r})})]}),w5t="close-button",F5t="book-delivery-button",B5t="subscription-success-modal";function U5t({taxInfo:e,isTaxGrossDisplayed:t}){const{taxGroups:n,taxTotal:o}=e;return!n.length||!o?null:s.jsx(Af,{isTaxGrossDisplayed:t,taxGroups:n,taxTotal:o})}const G5t=({price:e,subscription:t,taxInfo:n})=>{const o=zre(),r=He(),{data:a}=Ln.client.useHooks().getComputedState(),i=a?.displayTaxInformationGross??!1,l=Kre(),{closeModal:c}=Xm(),d=ja();h.useEffect(()=>{d.deliveryPassSubscribedPlanModalDisplayed("open"),d.deliveryPassSignUp({retailerSubscriptionPlanId:t.plan.retailerPlanId,price:e,currency:t.plan.cost.currency})},[]);const u=r({amount:e,currency:t.plan.cost.currency}),p=E=>i?s.jsx(O,{children:o.getInclusiveTaxPrice(s.jsx(O,{bold:!0,className:"salt-d--inline-block",children:E}))}):E,g=()=>{c(),d.deliveryPassSubscribedPlanModalDisplayed("close")};return s.jsx(C_,{dataTest:B5t,header:s.jsxs(L5t,{children:[o.getTitle(),s.jsx("br",{}),t.plan.name," - ",u]}),body:s.jsx(j5t,{title:String(o.getSummaryTitle()),list:{name:t.plan.name,taxContent:p(String(u))},taxesBreakdown:U5t({taxInfo:n,isTaxGrossDisplayed:i}),expiry:String(o.getExpiry(t.expiry))}),footer:s.jsx(M5t,{secondary:{onClick:g,dataTest:w5t,text:o.getClose()},primary:{onClick:l,dataTest:F5t,text:o.getBookSlot()}})})},Xre="delivery-pass-pending-modal-header",$5t=()=>{const e=L();return{title:e.formatMessage("delivery.pass.subscription.pending.modal.title"),description:e.formatMessage("delivery.pass.subscription.pending.modal.description")}},H5t=()=>{const{title:e,description:t}=$5t();return s.jsx(C_,{dataTest:"subscription-pending-modal",header:s.jsxs(h.Fragment,{children:[s.jsx(ee,{as:"h1",id:Xre,children:e}),s.jsx("br",{}),s.jsx(O,{asChild:!0,bold:!0,children:s.jsx("h4",{children:t})})]}),body:s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-t--8 salt-m-b--8",children:s.jsx(_s,{"data-test":"payment-psp-modal-spinner"})}),s.jsx("div",{className:"salt-m-b--8",children:""})]})})},h1=v.div`
    text-align: center;
`,Zre="failure-modal-header",V5t=({onClick:e})=>s.jsx(C_,{header:s.jsx(ee,{as:"h2",id:Zre,children:s.jsx(b,{id:"failure.modal.title"})}),body:s.jsxs(h.Fragment,{children:[s.jsx(h1,{className:"salt-m-b--8",children:s.jsx(pe,{error:!0,name:"status_no",height:100,width:100})}),s.jsx(h1,{children:s.jsx(Te,{showIcon:!1,text:s.jsx(b,{id:"failure.modal.body"})})})]}),footer:s.jsx(x,{fill:!0,intent:"primary","data-test":"failure-modal-button",onClick:e,children:s.jsx(x.Text,{children:s.jsx(b,{id:"failure.modal.button"})})}),dataTest:"failure-modal-header"}),W5t=({status:e,modalCloseTimeout:t,onClose:n})=>{const{isOpen:o}=Xm(),r=es("delivery-pass-subscription-modal-timeout"),a=(Number(r)||0)*1e3;h.useEffect(()=>(o&&e==="PENDING"&&(t.current=setTimeout(()=>{n()},a)),()=>{t.current&&clearTimeout(t.current)}),[o,e,t,a,n])};function Y5t({isOpen:e,status:t}){if(e)return{};let n=Zre;return t==="PENDING"&&(n=Xre),(t==="ACTIVE"||t==="ACTIVE-FREE-TRIAL")&&(n=Qre),{labelledby:n}}function q5t(e){const t=qre(),{isFreeTrialEnabled:n}=No();return e==="PENDING"?"PENDING":t?.status==="ACTIVE"?n&&t?.plan.freeTrial?.eligible?"ACTIVE-FREE-TRIAL":"ACTIVE":"FAILED"}const K5t=({onClose:e,transactionStatus:t,taxInfo:n,modalCloseTimeout:o})=>{const{isOpen:r,closeModal:a}=Xm(),i=q5t(t),l=()=>{e(),a()};W5t({status:t,modalCloseTimeout:o,onClose:l});const c=S_(),d=qre(),u=()=>{const p=c(d?.plan);switch(i){case"PENDING":return s.jsx(H5t,{});case"ACTIVE-FREE-TRIAL":return s.jsx(N5t,{subscription:d,price:p});case"ACTIVE":return s.jsx(G5t,{taxInfo:n,subscription:d,price:p.toNumber()});case"FAILED":default:return s.jsx(V5t,{onClick:l})}};return s.jsx(B,{isOpen:r,onRequestClose:l,aria:Y5t({isOpen:r,status:i}),children:r?u():null})},z5t=()=>{const e=es("delivery-pass-icon-payment-height"),t=es("delivery-pass-icon-payment-width");return e&&t?{height:e,width:t}:{height:"18",width:"20"}},Q5t=({header:e,body:t})=>{const{height:n,width:o}=z5t();return s.jsxs(h.Fragment,{children:[e,s.jsxs("div",{className:"salt-m-t--4",children:[s.jsx(Q,{justify:"center",children:s.jsx("div",{children:s.jsx(pe,{name:"delivery_pass",height:n,width:o})})}),s.jsx(Q,{justify:"start",children:s.jsx(O,{size:"l",children:t})})]})]})};function X5t(e,t){return t?.find(n=>!!n.plans.find(o=>o.planId===e))}function Z5t({selectedPlan:e}){const t=L(),{isFreeTrialEnabled:n}=No(),o=S_(),{data:r}=Ln.client.useHooks().getComputedState(),{name:a}=e,i=n&&!!e?.freeTrial?.eligible,l=X5t(e.planId,r?.benefits)?.name??"";return s.jsx(Q5t,{header:s.jsxs(ae.Fragment,{children:[t.formatMessage("delivery.pass.payment.pass.info.title"),s.jsx("br",{})," ",l,s.jsx("br",{})," "]}),body:s.jsxs(ae.Fragment,{children:[a," - ",o(e).toStringWithCurrency(),s.jsx("br",{}),i&&s.jsx(Nt,{id:"settings.delivery.pass.plan.name.with.free.trial",values:{planName:a}})]})})}const J5t=({isError:e})=>({taxGroups:[],taxTotal:"",isError:e}),e6t=()=>{const e=He(),{fetchError:t}=Ln.client.useHooks().getComputedState();return n=>{if(!n)return J5t({isError:t});const o=n?.planPricingInformation?.grossPrice;return{taxGroups:(n?.planPricingInformation?.taxes??[]).map(a=>({...a,taxRate:n?.planPricingInformation?.rates[a.taxCode]})).map(a=>({...a,valueAndCurrency:e({amount:a.value,currency:n.cost.currency})})),taxTotal:o?e({amount:o,currency:n.cost.currency}):"",isError:t}}},t6t=Y(cu,Xr.server.getComputedState,Ln.server.getComputedState,(e,t,{data:n})=>{if(!e?.data&&!t.data&&!n)return;const o=t.data?.find(a=>a.benefitGroupId===n?.benefitGroupId);return e.data?.find(a=>o?.addresses?.[0]?.addressId===a.id)?.regionId});function Jre({cleanUpCookie:e,selectedPlan:t}){const n=F(),o=L(),r=Ne(),a=t?.planId??"",[i,l]=h.useState(),c=e6t(),{fetch:d,getComputedState:u}=Ln.client.useHooks(),{data:p}=u(),g=p?.displayTaxInformationGross??!1,{is3dsSubscriptionsFlowEnabled:E,isFreeTrialEnabled:y}=No(),I=f(t6t),S=p5t(),C=h.useRef(),T=h.useRef(),_=h.useRef(),A=f(D("pay.ywlt")),R=d5t({planId:a,subscriptionPoller:_,updateSubscriptionStatus:T,setStatus:l,isFreeTrialEnabled:y,regionId:I}),P=u5t({subscriptionPoller:_,updateSubscriptionStatus:T,setStatus:l,cleanUpCookie:e});h.useEffect(()=>()=>{clearTimeout(C.current),clearInterval(_.current)},[]);const N=()=>{n(J.closeModal()),A&&Z.error("toast.notification.generic.error")};T.current=j=>{i==="PENDING"&&!j&&(l("FAILED"),N(),clearInterval(_.current)),j==="ACTIVE"&&l("ACTIVE"),j!=="PENDING"&&(clearInterval(_.current),(()=>{const W=ps.parse(r.search);d({benefitGroupId:W.benefitGroupId})})())};const k=j=>E?P({planId:a,walletItemId:j,isFreeTrialEnabled:y,regionId:I}):(e(),l("PENDING"),R(j)),M=({resultToken:j})=>S({resultToken:j,cleanUpCookie:e,setStatus:l,subscriptionPoller:_,updateSubscriptionStatus:T}),w=c(t);return s.jsxs(h.Fragment,{children:[s.jsx(jM,{modalsTitle:t&&s.jsx(Z5t,{selectedPlan:t}),selectedPlan:t,taxInfo:w,isTaxGrossDisplayed:g,confirmPaymentMethodText:o.formatMessage("delivery.pass.subscription.modal.button"),onInitiatePayment:k,onClosePaymentMethodPicker:e,onAuthFailure:N,onAuthCompleted:M}),s.jsx(K5t,{transactionStatus:i,modalCloseTimeout:C,taxInfo:w,onClose:e})]})}Jre.fetchData=({store:e})=>Ln.server.fetch(e.dispatch);const s6t=v(ln)`
    position: absolute;

    ${({position:e})=>e==="inside"?`
      inset-block-start: var(--salt-spacing-4);
      inset-inline-end: var(--salt-spacing-4);
      margin-top: var(--salt-spacing-1);
    `:`
      inset-block-start: calc(var(--salt-spacing-2) * -1);
      inset-inline-start: calc(var(--salt-spacing-2) * -1);
    `}
`,FM=({message:e,position:t})=>s.jsx(s6t,{position:t,intent:t==="inside"?"secondary":"primary",text:t==="inside"?e:s.jsx(b,{id:e})}),n6t=({isSubscriptionPlanTransitioning:e})=>e?s.jsx(FM,{position:"outside",message:"settings.delivery.pass.current.pass.label"}):null,o6t=()=>s.jsx(FM,{position:"outside",message:"settings.delivery.pass.new.pass.label"}),r6t=({message:e})=>s.jsx(FM,{position:"inside",message:e}),eR={createCurrentPlan:n6t,createNextPlan:o6t,createFreeTrial:r6t},g1=({price:e,plan:{name:t,planId:n,subscriptionId:o},onClick:r,isDisabled:a})=>{const i=L(),l=F();return s.jsx(x,{intent:"secondary",fill:!0,"aria-label":i.formatMessage("delivery.pass.subscription.button.aria.label",{name:t,price:e}),"data-test":"subscription-buy-plan",onClick:()=>(l(U.analyticsEvent({type:bs.BUY_PLAN_BUTTON_CLICKED,buttonName:"Buy plan",subscriptionId:o,retailerSubscriptionPlanId:n,buttonLabel:i.formatMessage("delivery.pass.subscription.button")})),r()),disabled:a,children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.pass.subscription.button"})})})},a6t=({subscriptionId:e,retailerSubscriptionPlanId:t,onClick:n})=>{const o=L(),r=ja();return s.jsx(x,{intent:"primary",fill:!0,"aria-label":o.formatMessage("settings.delivery.pass.free.trial.plan.start"),"data-test":"subscription-buy-plan",onClick:()=>(r.freeTrialButtonClicked({subscriptionId:e,retailerSubscriptionPlanId:t,buttonLabel:o.formatMessage("settings.delivery.pass.free.trial.plan.start")}),n()),children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.free.trial.plan.start"})})})},Zm=(e,t,n)=>s.jsx(Te,{"data-test-type":t.type,intent:t.type,size:"s","data-test":n,text:e}),i6t=({expiryDate:e,calendarDateFormat:t})=>Zm(s.jsx(b,{id:"delivery.pass.expires.on",values:{expiryDate:gt(e,t)}}),{type:"warning"},"expiryMessage"),l6t=()=>Zm(s.jsx(b,{id:"delivery.pass.pending"}),{type:"warning"},"pendingMessage"),c6t=({expiryDate:e,calendarDateFormat:t})=>Zm(s.jsx(b,{id:"delivery.pass.expires.on",values:{expiryDate:gt(e,t)}}),{type:"warning"},"expiryMessage"),d6t=({expiryDate:e,calendarDateFormat:t})=>Zm(s.jsx(b,{id:"delivery.pass.expires.off",values:{renewalDate:gt(e,t)}}),{type:"success"},"renewMessage"),u6t=({expiryDate:e,calendarDateFormat:t})=>s.jsxs(ae.Fragment,{children:[Zm(s.jsx(b,{id:"delivery.pass.expires.on",values:{expiryDate:gt(e,t)}}),{type:"error"},"endsMessage"),s.jsx("br",{}),eae()]}),eae=()=>Zm(s.jsxs(ae.Fragment,{children:[s.jsx(b,{id:"delivery.pass.plan.transitioning.message"}),"",s.jsx(Ye,{to:ar(),children:s.jsx(b,{id:"delivery.pass.see.details.link.label"})})]}),{type:"warning"},"transitioningMessage");function p6t(){const e=f(cr);return{createExpiryNotRenewableMessage:t=>i6t({expiryDate:t,calendarDateFormat:e}),createPendingMessage:l6t,createExpiryMessage:t=>c6t({expiryDate:t,calendarDateFormat:e}),createAutoRenewalActiveMessage:t=>d6t({expiryDate:t,calendarDateFormat:e}),createTransitioningMessage:()=>eae(),createExpiringTransitioningMessage:t=>u6t({expiryDate:t,calendarDateFormat:e})}}const m6t=e=>({name:e.name,planId:e.planId,subscriptionId:e.subscription?.subscriptionId}),h6t=({plan:e,price:t,onClick:n,status:o})=>{const r=p6t(),a=e?.subscription?.expiry??"",i=()=>({onClick:n,plan:m6t(e),price:t});switch(o){case"transitioning":return r.createTransitioningMessage();case"expiring-transitioning":return r.createExpiringTransitioningMessage(a);case"not-renewable-expiring":return r.createExpiryNotRenewableMessage(a);case"pending":return r.createPendingMessage();case"auto-renewing":return r.createAutoRenewalActiveMessage(a);case"expiring":return r.createExpiryMessage(a);case"free-trial":return s.jsx(a6t,{onClick:n,subscriptionId:e.subscription?.subscriptionId,retailerSubscriptionPlanId:e.planId});case"cannot-buy":return s.jsx(g1,{...i(),isDisabled:!0});case"can-buy":default:return s.jsx(g1,{...i(),isDisabled:!1})}};function g6t({isSubscriptionPurchaseDisabled:e,isPlanEligible:t,customerHasSubscriptionInThisBenefitGroup:n,isSuperuser:o}){return!e&&t&&!n&&!o}function E6t({plan:e,isFreeTrialEnabled:t,isSubscriptionPlanRenewing:n,isPlanTransitioning:o,isSubscriptionPlanTransitionEnabled:r,canBuy:a}){return e.subscription?o&&r?e.subscription.autoRenewalStatus?"transitioning":"expiring-transitioning":n?e.subscription.status==="PENDING"?"pending":e.subscription.autoRenewalStatus?"auto-renewing":"expiring":"not-renewable-expiring":a?t&&e.freeTrial?.eligible?"free-trial":"can-buy":"cannot-buy"}function f6t(e){const t=f(un.isSubscriptionPlanTransitionEnabled),n=f(un.isFreeTrialEnabled),o=f(un.isSubscriptionPurchaseDisabled),r=f(c=>c.session.isSuperuser),{nextRenewal:a}=e??{},i=!!a?.planIsTransitioning,l=a?.planId!=null;return c=>E6t({plan:c,isFreeTrialEnabled:n,isSubscriptionPlanRenewing:l,isPlanTransitioning:i,isSubscriptionPlanTransitionEnabled:t,canBuy:g6t({isSuperuser:r,isSubscriptionPurchaseDisabled:o,customerHasSubscriptionInThisBenefitGroup:!!e,isPlanEligible:!!c.eligible})})}const y6t=v(Oe.Action.Header)`
    justify-content: start;
`,I6t=({headerText:e,body:t,footer:n,extra:o})=>s.jsxs(Oe.Action,{"data-test":"subscription-card",...o,children:[s.jsxs(y6t,{children:[s.jsx(pe,{name:"delivery_pass",height:24,width:24}),s.jsx(Oe.Action.HeaderText,{"data-test":"subscription-plan-price",as:"h3",children:e})]}),s.jsx(Oe.Action.Body,{align:"left",children:t}),s.jsx(Oe.Action.Footer,{align:"left",children:n})]}),S6t=({text:e})=>e?s.jsxs(h.Fragment,{children:[s.jsx("br",{}),e]}):null;function C6t({plan:e,onSelectPlan:t,price:n,benefitGroupSubscription:o,...r}){const a=f6t(o),i=f(un.isFreeTrialEnabled),l=f(un.isFlexibleFreeTrialEnabled),c=a(e)==="free-trial";return s.jsx(I6t,{extra:r,headerText:`${e.name} - ${n}`,body:s.jsxs(ae.Fragment,{children:[l&&c&&eR.createFreeTrial({message:"7 days free trial"}),e.description,i&&s.jsx(S6t,{text:e?.freeTrial?.text}),s.jsx("br",{}),s.jsx(b,{id:"delivery.pass.subscription.card"})]}),footer:s.jsx(h6t,{plan:e,price:n,onClick:t,status:a(e)})})}function v6t({dataTest:e,name:t,isTaxGrossDisplayed:n,description:o,renderedPlans:r}){return s.jsxs("div",{className:"salt-m-b--8","data-test":e,children:[s.jsxs("div",{className:"salt-m-b--4",children:[s.jsxs("div",{children:[s.jsx(ee,{as:"h2",children:t}),n&&s.jsx(O,{className:"salt-m-b--2 salt-m-t--2",asChild:!0,children:s.jsx("h2",{children:s.jsx(Nt,{id:"delivery.pass.prices.tax.inclusive"})})})]}),s.jsx(O,{children:o})]}),s.jsx(Oe.Collection,{"data-test":"benefits-plans-cards",md:2,children:r})]})}const T6t=({addCardRef:e,benefitGroupSubscription:t,benefits:n,selectPlan:o,isTaxGrossDisplayed:r,createPlanPrice:a})=>s.jsx(h.Fragment,{children:n.map(i=>{const{name:l,description:c,marketingMessage:d,plans:u,benefitId:p}=i;return s.jsx(v6t,{dataTest:p,name:l,isTaxGrossDisplayed:r,description:`${c} ${d}`,renderedPlans:u.map(g=>s.jsx(C6t,{benefitGroupSubscription:t,innerRef:E=>e(E,i,g),plan:g,onSelectPlan:()=>o(g.planId,i),price:a(g).toStringWithCurrency()},g.planId))},p)})});function tae({benefitGroupName:e}){const t=ja(),n=es("delivery-pass-tac-url");return s.jsxs(O,{"data-test":"terms-and-condition-message",children:[s.jsx(b,{id:"delivery.pass.subscription.termsAndConditions.message",values:{pass:e??s.jsx(_e,{height:"15px"}),link:s.jsx(tt,{href:n,target:"_blank",onClick:()=>t.termsAndConditionsClicked(),"data-test":"subscription-tcs-link",className:"salt-d--block lg:salt-d--inline",children:s.jsx(b,{id:"delivery.pass.subscription.termsAndConditions.link.label"})})}}),s.jsx(O,{className:"salt-d--block salt-m-t--2",children:s.jsx(b,{id:"delivery.pass.subscription.terms.and.conditions.message.disclaimer"})})]})}function v_({texts:e}){return e?s.jsxs(O,{"data-test":v_.dataTestId,children:[e.terms,s.jsx("br",{}),e.cancellation]}):s.jsx(_e,{height:"15px"})}v_.dataTestId="terms-and-cancellation";const _6t=v.div`
    display: flex;
    flex-direction: column;
    gap: 8px;
`;function b6t({benefitGroupSubscription:e,benefitGroup:t}){const n=!e||e?.autoRenewalStatus;return s.jsxs(_6t,{children:[n&&s.jsx(v_,{texts:t?{terms:t.terms,cancellation:t.cancellation}:void 0}),t&&s.jsx(tae,{benefitGroupName:t.name})]})}const x6t=({top:e,bottom:t})=>s.jsxs("div",{"data-test":"subscription-page",className:"salt-m-t--4 salt-m-l--2 salt-m-r--2",children:[s.jsx("div",{className:"salt-m-t--4 salt-m-b--4 salt-m-r--sm",children:e}),s.jsx("div",{className:"salt-m-t--8 salt-m-b--4 salt-m-r--sm",children:t})]});function sae(){const e=F();return h.useCallback(()=>e(Gt.initiatePayment()),[])}const A6t=({addCardRef:e,selectPlan:t,benefitGroup:n,benefitGroupSubscription:o})=>{const r=S_(),a=n?.displayTaxInformationGross??!1,i=n?.benefits??[];return s.jsx(x6t,{top:n?s.jsx(T6t,{addCardRef:e,benefits:i,createPlanPrice:r,isTaxGrossDisplayed:a,selectPlan:t,benefitGroupSubscription:o}):s.jsx($re,{}),bottom:s.jsx(b6t,{benefitGroupSubscription:o,benefitGroup:n})})};function R6t(e,t=window){const{top:n,bottom:o,left:r,right:a}=e,{innerWidth:i,innerHeight:l}=t;return n>=0&&r>=0&&a<=i&&o<=l}function D6t(e){const t=[],n=[];return e.forEach(o=>{R6t(o.ref.getBoundingClientRect())?t.push(o):n.push(o)}),{seenCards:t,nonSeenCards:n}}function O6t(){const e=h.useRef([]);function t(n,o,r){n&&!e.current.map(a=>a.ref).includes(n)&&e.current.push({ref:n,benefit:o,plan:r})}return[e,t]}function P6t(e,t=U.analyticsEvent){const[n,o]=O6t(),r=ja();return h.useEffect(()=>{function a(){const{seenCards:i,nonSeenCards:l}=D6t(n.current);i.forEach(c=>r.deliveryPassPlanSeen({plan:`${c.benefit.name}-${c.plan.name}`,deliveryPassBenefitGroupId:e,analyticsEvent:t})),n.current=l}return a(),window.addEventListener("scroll",a),()=>{window.removeEventListener("scroll",a)}},[]),{addCardRef:o}}function N6t({benefitGroup:e}){return s.jsx(sn,{children:e?s.jsxs(h.Fragment,{children:[s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"settings.delivery.pass.page.title"})}),s.jsx(O,{children:s.jsx(b,{id:"settings.delivery.pass.page.subtitle"})})]}):s.jsx(_e.Typography,{})})}const L6t=()=>pC(wH(1)),k6t=()=>pC(uC(1));function j6t(){const e=h.useRef(new qd),t=f(At);return{deleteSelectedPlanId:()=>e.current.remove(an.SELECTED_PLAN_ID,{expires:L6t(),path:fn({basePath:t})}),setSelectedPlanId:n=>{e.current.set(an.SELECTED_PLAN_ID,n,{expires:k6t(),path:fn({basePath:t})})},getSelectedPlanId:()=>e.current.get(an.SELECTED_PLAN_ID)}}function M6t({benefit:e,newPlanId:t,benefits:n}){return e?e.name:n.find(o=>o.plans.find(r=>r.planId===t))?.name}function w6t(){const e=ja();return{subscriptionStarted:({benefit:t,newPlan:n,benefitGroup:o})=>{const r=M6t({benefit:t,newPlanId:n.planId,benefits:o?.benefits??[]});e.deliveryPassSubscriptionStarted({plan:`${r}-${n.name}`,benefitGroupId:o?.benefitGroupId}),e.selectedDeliveryPassPlanModalDisplayedEvent("open")}}}const F6t=({onlyMarks:e=!1})=>{const t={[bn.BLOCKS.HEADING_1]:(n,o)=>s.jsx(ee,{as:"h2",children:o}),[bn.BLOCKS.HEADING_2]:(n,o)=>s.jsx(ee,{as:"h2",children:o}),[bn.BLOCKS.HEADING_3]:(n,o)=>s.jsx(O,{size:"l",bold:!0,className:"salt-m-b--2",children:o}),[bn.BLOCKS.PARAGRAPH]:(n,o)=>!o||Array.isArray(o)&&o.every(a=>typeof a=="string"&&a.trim()==="")?s.jsx("br",{}):s.jsx(O,{size:"m",className:"salt-m-b--4",children:o}),[bn.BLOCKS.UL_LIST]:(n,o)=>s.jsx("ul",{children:o}),[bn.BLOCKS.OL_LIST]:(n,o)=>s.jsx("ol",{children:o}),[bn.BLOCKS.LIST_ITEM]:(n,o)=>s.jsx("li",{className:"salt-m-b--2",children:o})};return e?{renderNode:{[bn.BLOCKS.PARAGRAPH]:(n,o)=>!o||Array.isArray(o)&&o.every(a=>typeof a=="string"&&a.trim()==="")?s.jsx("br",{}):s.jsxs(ae.Fragment,{children:[s.jsx("br",{}),s.jsxs(O,{size:"s",className:"salt-m-b--4",children:[o,s.jsx("br",{})]})]})}}:{renderNode:t}},B6t=v.div`
    margin-block: 20px;
    margin-inline: 8px;
`,dx=({contentfulData:e,onlyMarks:t=!1,testId:n})=>{const o=h.useMemo(()=>F6t({onlyMarks:t}),[]),r=e?rC.documentToReactComponents(e,o):null;return s.jsx(B6t,{"data-test":n,children:r})},E1=({bannerImages:e,testId:t})=>{if(!e)return null;const{imageUrl41webp:n,imageUrl21webp:o}=e,r=v.div`
        margin-inline: 8px;
    `;return s.jsx(r,{"data-test":t,children:s.jsxs("picture",{children:[s.jsx("source",{media:"(min-width: 600px)",srcSet:n}),s.jsx("source",{media:"(max-width: 600px)",srcSet:o}),s.jsx("img",{src:n,alt:"description",style:{maxWidth:"960px",width:"100%",height:"auto",objectFit:"cover",borderRadius:"var(--salt-radius-default)"}})]})})},U6t=()=>{const{data:e}=f(OW),t=e?.items[0],n=c=>{if(!c)return null;const d=c?.ratio41?.url,u=c?.ratio21?.url;return{imageUrl41webp:`${d}?fm=webp`,imageUrl21webp:`${u}?fm=webp`}},o=n(t?.bottomHorizontalHeroCollection?.items[0]),r=n(t?.topHorizontalHeroCollection?.items[0]),a=t?.topTextArea?.json,i=t?.bottomTextArea?.json,l=t?.termsAndConditions?.json;return{bottomBannerData:o,topBannerData:r,topTextAreaData:a,bottomTextAreaData:i,termsAndConditionsData:l}},G6t=v.div`
    max-inline-size: 960px;
    margin-block: auto;
    margin-inline: auto;
`,$6t=({children:e})=>{const{bottomBannerData:t,topBannerData:n,topTextAreaData:o,bottomTextAreaData:r,termsAndConditionsData:a}=U6t();return s.jsxs(G6t,{"data-test":"contentful-wrapper",children:[s.jsx(E1,{bannerImages:n,testId:"top-horizontal-banner"}),s.jsx(dx,{contentfulData:o,testId:"top-text-area"}),e,s.jsx(dx,{contentfulData:r,testId:"bottom-text-area"}),s.jsx(E1,{bannerImages:t,testId:"bottom-horizontal-banner"}),s.jsx(dx,{contentfulData:a,onlyMarks:!0,testId:"terms-and-conditions"})]})},H6t=v.div`
    max-inline-size: 960px;
    margin-block: auto;
    margin-inline: auto;
`,nae=({children:e})=>s.jsx(H6t,{children:e});function V6t({selectedPlan:e,selectPlan:t,addCardRef:n,cleanUpCookie:o,allBenefitGroupData:r}){const a=r.metadata.benefitGroupSubscription,i=r.data,l=!!a,c=d=>l&&["ACTIVE","PENDING"].includes(d??"");return s.jsxs(h.Fragment,{children:[s.jsxs(nae,{children:[s.jsx(bt,{title:"delivery.pass.page.title"}),s.jsx(N6t,{benefitGroup:i})]}),s.jsxs($6t,{children:[c(a?.status)?s.jsx(Q3t,{selectedPlan:e,benefitGroupSubscription:a}):null,s.jsx(A6t,{addCardRef:n,selectPlan:t,benefitGroup:i,benefitGroupSubscription:a})]}),s.jsx(Jre,{cleanUpCookie:o,selectedPlan:e})]})}const W6t=()=>{const[e,t]=h.useState(),n=sae(),o=w6t(),r=F(),a=Ln.client.useHooks().getComputedState(),{data:i,metadata:{plans:l}}=a,c=j6t(),{addCardRef:d}=P6t(i?.benefitGroupId||""),u=h.useCallback(g=>l.find(E=>E.planId===g),[i?.benefits]),p=(g,E)=>{const y=u(g);y&&(c.setSelectedPlanId(g),t(y),n(),o.subscriptionStarted({benefit:E,newPlan:y,benefitGroup:i}))};return h.useEffect(()=>{const g=c.getSelectedPlanId();g&&(p(g),c.deleteSelectedPlanId()),r(eo.getCustomerAddresses())},[]),s.jsx(V6t,{selectedPlan:e,selectPlan:p,addCardRef:d,cleanUpCookie:c.deleteSelectedPlanId,allBenefitGroupData:a})};function oae(){const{search:e}=Ne();return{isBenefitGroupIdInQuerystring:!!e.match(/.*benefitGroupId=([0-9a-z-]+).*/),recoveryToken:ps.parse(e).recoveryToken}}function Y6t(){const{isRegionAwareEnabled:e,isDeliveryPassByStoreEnabled:t}=No(),n=f(wde);return{isDeliveryPassByStoreEnabled:t,isRegionAwarenessEnabled:n&&e}}function q6t(){const e=oae(),{isFetching:t,fetchError:n,data:o}=Xr.client.useHooks().getComputedState(),r=f(bD),{isFetching:a,error:i}=kSe(),{isFetching:l,fetchError:c,error:d}=Ln.client.useHooks().getComputedState(),{isRegionAwarenessEnabled:u,isDeliveryPassByStoreEnabled:p}=Y6t(),g=E=>E.length<=1?!1:E.filter(I=>I.addresses.length>0).length>1;return p&&!e.isBenefitGroupIdInQuerystring?"ADD_BENEFIT_GROUP_ID_TO_QUERY_STRING_AND_REDIRECT_TO_DELIVERY_PASS_SUBSCRIPTION":!u||e.isBenefitGroupIdInQuerystring?d?.statusCode===404?"DELIVERY_PASS_SUBSCRIPTION_HAS_NO_PLANS":"DELIVERY_PASS_SUBSCRIPTION":t||l||a||r?"LOADING":n||c||i?"ERROR":o.length?g(o)?"BENEFIT_GROUP_ADDRESS_SELECTION":"ADD_BENEFIT_GROUP_ID_TO_QUERY_STRING_AND_REDIRECT_TO_DELIVERY_PASS_SUBSCRIPTION":"ADD_ADDRESS"}function K6t(){const{search:e}=Ne(),t=f(Rt),n=F(),{getState:o}=Yd();h.useEffect(()=>{if(!t){const r=ps.parse(e),a=Xr.server.getComputedState(o()).metadata.benefitGroupIdFromDefaultAddress,i=r.benefitGroupId??a;aae(i,{dispatch:n,getState:o})}},[])}const z6t=()=>{K6t();const e=oae(),t=q6t(),{metadata:{benefitGroupIdFromDefaultAddress:n}}=Xr.client.useHooks().getComputedState();switch(t){case"DELIVERY_PASS_SUBSCRIPTION":return s.jsx(W6t,{});case"DELIVERY_PASS_SUBSCRIPTION_HAS_NO_PLANS":return s.jsx("div",{className:"salt-m-y--2 salt-m-x--2",children:s.jsx(lM,{})});case"LOADING":return s.jsx($re,{});case"ADD_ADDRESS":return s.jsx(En,{to:ar(),unstable__customRedirectImplementation:!0});case"BENEFIT_GROUP_ADDRESS_SELECTION":return s.jsx(En,{to:Cqe()});case"ADD_BENEFIT_GROUP_ID_TO_QUERY_STRING_AND_REDIRECT_TO_DELIVERY_PASS_SUBSCRIPTION":return s.jsx(En,{to:`${Lc()}?${ps.stringify({benefitGroupId:n??"",recoveryToken:e.recoveryToken})}`});case"ERROR":default:return s.jsx(jn,{})}},rae=()=>s.jsx(Et,{type:"SubscriptionSelection::route",children:s.jsx(z6t,{})});function aae(e,t){const n=un.isContentfulEnabled(t.getState());return Promise.all([Xr.server.fetch(t.dispatch),Ln.server.fetch(t.dispatch,{benefitGroupId:e}),n?t.dispatch(BSe.getDeliveryPassContentfulPage()):null,t.dispatch(eo.getCustomerAddresses())])}rae.fetchData=({context:{store:e,url:t}})=>{const n=t.searchParams.get("benefitGroupId")??"",o=_at(n);return aae(o,e)};const iae="#d6d6d6",Q6t=v(pe)`
    svg {
        fill: ${iae};
    }
`,X6t=({addresses:e,isDisabled:t})=>s.jsxs(ae.Fragment,{children:[s.jsx("div",{className:"salt-m-t--sm salt-m-b--4 salt-m-r--sm salt-m-l--sm",children:s.jsx(b,{id:"delivery.pass.region.select.address.scope.text"})}),s.jsx("div",{className:"salt-m-b--2 salt-m-r--sm",children:s.jsx(Be,{children:e.map(n=>s.jsx(Be.Item,{"data-test":"addresses-list-item",children:s.jsxs(Q,{align:"flex-start",justify:"flex-start",children:[s.jsx("div",{className:"salt-m-r--2 salt-m-l--sm",children:t?s.jsx(Q6t,{success:!0,name:"status_yes"}):s.jsx(pe,{success:!0,name:"status_yes"})}),s.jsxs("div",{className:"salt-m-r--sm salt-m-l--sm",children:[s.jsxs(O,{bold:!0,children:[n.nickname,":"]}),s.jsx(O,{children:n.address})]})]})},n.addressId))})})]}),Z6t=v(x)`
    pointer-events: ${({disabled:e})=>e?"none":"auto"};
`,J6t=v(Oe.Action)`
    color: ${({isDisabled:e})=>e?iae:"inherit"};
`,e8t=({benefitGroupId:e,benefitGroupNumber:t,addresses:n,isDisabled:o,...r})=>{const{formatMessage:a}=L(),i=h.useRef(ct()),l=ja();return s.jsxs(J6t,{isDisabled:o,...r,children:[s.jsx(Oe.Action.Header,{children:s.jsx(Oe.Action.HeaderText,{as:"h3",singleLine:!0,children:s.jsx(ee,{as:"span",children:s.jsx(b,{id:"delivery.pass.benefit.group.select.region.title",values:{counter:t}})})})}),s.jsxs(Oe.Action.Body,{align:"left",children:[s.jsx(X6t,{addresses:n,isDisabled:o??!1}),o&&s.jsx(Te,{showIcon:!1,intent:"warning",text:a("settings.delivery.pass.region.address.undeliverable"),"data-test":"non-deliverable-alert"})]}),s.jsx(Oe.Action.Footer,{children:s.jsx(Z6t,{asChild:!0,intent:"secondary",fill:!0,disabled:o??!1,"data-test":"benefit-group-selection-button",onClick:()=>l.selectBenefitGroupClicked({pageEventId:i.current,benefitGroupId:e}),children:s.jsx(tt,{intent:"ghost",href:`${Lc()}?source=select%20benefit%20group%20button&sourceEventId=${i.current}&benefitGroupId=${e}`,children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.pass.region.see.passes.button.text"})})})})})]},e)},t8t=(e,t)=>e.length>0&&e.some(n=>t[n.addressId]);function s8t(){const{isDeliveryPassByStoreEnabled:e}=No(),t=f(yW);return n=>e&&!t8t(n,t)}const f1=3,n8t=({benefitGroupsAddresses:e})=>{const t=s8t(),n=e.length>f1?f1:e.length,o=!t(e.flatMap(({addresses:r})=>r));return s.jsx(ae.Fragment,{children:o?s.jsx(Oe.Collection,{md:n,lg:n,children:e.map(({benefitGroupId:r,addresses:a},i)=>s.jsx(e8t,{benefitGroupId:r,benefitGroupNumber:i+1,addresses:a,isDisabled:t(a)},r))}):s.jsx(lM,{})})},o8t=v.div`
    max-inline-size: 960px;
    margin-block: auto;
    margin-inline: auto;
    padding-inline: 8px;
`;function r8t({body:e,footer:t}){const n=s.jsxs(h.Fragment,{children:[s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"delivery.pass.region.select.subtitle"})}),s.jsx(O,{className:"salt-d--inline",children:s.jsx(b,{id:"delivery.pass.region.select.validity.text"})})]});return s.jsxs("div",{"data-test":"benefit-group-selection",children:[s.jsxs(nae,{children:[s.jsx(bt,{title:"delivery.pass.page.title"}),s.jsxs(sn,{children:[s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"settings.delivery.pass.page.title"})}),s.jsx(O,{children:s.jsx(b,{id:"settings.delivery.pass.page.subtitle"})})]})]}),s.jsx(o8t,{children:s.jsxs("div",{className:"salt-m-t--8 salt-m-b--8",children:[s.jsx("div",{className:"salt-m-t--8 salt-m-b--4",children:n}),e,s.jsx("div",{className:"salt-m-t--4 salt-m-b--4",children:t})]})})]})}const a8t="add-address-button",lae=async({context:{store:e}})=>await Promise.all([e.dispatch(eo.getCustomerAddresses()),Xr.server.fetch(e.dispatch)]);function i8t(){const e=ja(),t=h.useRef(ct());return s.jsx(x,{asChild:!0,intent:"secondary",fill:!1,"data-test":a8t,onClick:()=>e.addAddressClicked(t.current),children:s.jsx(tt,{intent:"ghost",href:`${Xa()}?source=add%address%20button&sourceEventId=${t.current}`,children:s.jsx(x.Text,{children:s.jsx(b,{id:"delivery.pass.region.add.address.button.text"})})})})}const l8t=()=>{const e=F(),t=f(Rt),n=Xr.client.useHooks().getComputedState().data??[];return h.useEffect(()=>{t||lae({context:{store:{dispatch:e}}})},[]),n.length?s.jsx(r8t,{body:s.jsx(n8t,{benefitGroupsAddresses:n}),footer:s.jsx(i8t,{})}):null},cae=()=>s.jsx(Et,{type:"BenefitGroupSelection::route",children:s.jsx(l8t,{})});cae.fetchData=lae;const c8t=e=>[{path:"/delivery-pass",Component:$s(Xe,e.Main),children:[{path:"subscription",Component:as(un.isSubscriptionEnabled,rae,ot)},{path:"benefit-group-selection",Component:as(un.canLoadBenefitGroupSelectionScene,cae,ot)}]}],BM=()=>e=>e(zy.getHomePageComponents()).catch(()=>{}),d8t=["logged-in-homepage","logged-out-homepage","favorites","regulars"],u8t=e=>{switch(e){case"logged-in-homepage":case"logged-out-homepage":return"homepage-banner";case"regulars":case"favorites":return"favorites-banner";default:return""}},p8t=e=>{switch(e){case"favorites":case"regulars":return uat;default:return dat}},m8t=({advertisingBanner:e,page:t,className:n})=>{const{id:o,name:r,images:a,isExternalLink:i,contentSource:l,target:{linkType:c},placement:d,segments:u,format:p}=e,g=p8t(t),{altText:E}=a[0]||{},y=u8t(t),I=hL(e),S=h.useRef(void 0),{reportStaticAdvertImpression:C,reportStaticAdvertClick:T}=nf(t,d),[_]=CT(),A=ek(e.target);h.useEffect(()=>{S.current=_&&xg(e.images,g[_])},[_]);const R=h.useCallback(()=>{S.current?.url&&C({id:o,name:r,altText:E,contentSource:l,targetUrl:A,linkType:c,segments:u,format:p,imageUrl:S.current?.url})},[S.current]),P=UT(R);if(!d8t.includes(t))return null;const N=()=>{S.current?.url&&T({id:o,name:r,altText:E,contentSource:l,targetUrl:A,linkType:c,segments:u,format:p,imageUrl:S.current?.url})},k=M=>K7(M.target);return s.jsx(YC,{className:n,"data-test":y,images:a,as:TT,ref:P,isExternalLink:i,href:A,...I!==void 0?{target:I}:{},...E?{title:E}:{},onClick:N,onFocus:k,children:s.jsx(ie,{children:E})})},h8t=["logged-in-homepage","logged-out-homepage"],dae=({page:e})=>{const t=h8t.includes(e),n=f(zpt),[o,r]=f(Jpt),a=f(Qpt("hero"));if(t&&!n){if(o.length!==0)return s.jsx(Lm,{adverts:o,advertDimensionsMap:pat,page:e,pageKey:void 0,placement:"ABOVE_GRID",randomInitialIndex:r.randomizeInitialHorizontalAdvert,className:"salt-p-x--2",sizes:["LARGE","MEDIUM","SMALL"],lazyLoad:!1,fetchPriority:"high"});if(a)return s.jsx(m8t,{advertisingBanner:a,page:e,className:"salt-m-b--0"})}return null},g8t=se("GET_HOMEPAGE_ADVERTS"),T_=()=>({type:"API",payload:{url:"/v1/content?page=HOMEPAGE",...g8t}}),uae=()=>{const e=L(),t=ws(),n=Me(Nn),o=Me(Rt),{isFetching:r,fetchError:a,data:i}=Me(b8e),[l]=Ee(["rec"]);return h.useEffect(()=>{l&&!i?.homePageComponents?.length&&!r&&!o&&t(BM())},[]),!l||!i?.homePageComponents?.length||r||a?null:s.jsx(to,{spacing:4,title:s.jsx(to.Title,{children:i.title}),headerButton:s.jsx(to.HeaderButton,{to:u8(),children:e.formatMessage("recipes.homepage.carousel.link")}),"data-test":"homepage-recipes",a11y:{labels:{"next-button":e.formatMessage("scroller.accessibility.viewNextIn",{title:i.title}),"previous-button":e.formatMessage("scroller.accessibility.viewPreviousIn",{title:i.title})}},flush:!0,children:i.homePageComponents.map((c,d)=>s.jsx(f8t,{card:c,index:d,pageViewId:n},c.id))})},E8t=e=>{const{slug:t,id:n}=e;switch(e.type){case ap.RECIPE:return t&&n?ki(t,n):"";case ap.RECIPE_COLLECTION:return t&&n?Li(t,n):"";case ap.RECIPE_HOME_PAGE:return La();default:return""}},f8t=({card:e,pageViewId:t,index:n})=>{const o=ft(),{id:r,title:a,image:i,description:l,homePageEntity:c}=e,d=E8t(c),u=ct(),g=Um(([y],I)=>{if(!y?.isIntersecting)return;o({type:FD,recipeCardImpression:{RECIPE_CARD_ID:e.id,RECIPE_CARD_TITLE:e.title,SEQUENCE:n,LINK_TYPE:e.homePageEntity.type,...e.homePageEntity.id&&{ENTITY_ID:e.homePageEntity.id}},pageViewId:t});const S={event:"view_recipe_homepage_card",type:GI[e.homePageEntity.type],id:e.id,name:e.title,index:n,...e.homePageEntity.id&&{target:e.homePageEntity.id}};te.sendEvent({GA:S,WA:null}),I.unobserve(y.target)},{root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5}),E=()=>{o({pageEventId:u,type:wD,LINK_TYPE:e.homePageEntity.type,LINK_PATH:d,RECIPE_CARD_ID:r,ENTITY_ID:e.homePageEntity.id,RECIPE_CARD_TITLE:a,SEQUENCE:n});const y={event:"select_recipe_homepage_card",type:GI[e.homePageEntity.type],id:r,name:a,target:e.homePageEntity.id??null,index:n};te.sendEvent({GA:y,WA:null})};return s.jsx(Oe.MediaNavigationCard,{ref:g,variant:"fullImage",title:a,fallbackSrc:i.fallbackUrl??i.url,typeSrcSet:{"image/avif":i.url},alt:i.altText,content:l,to:{pathname:d},navigationState:{sourceEventId:u},onClick:E},r)},y8t=()=>{const e=f(o=>Ze(o,"structured-data-logo-url")),t=f(o=>Ze(o,"structured-data-home-url")),n={"@context":"https://schema.org","@type":"Organization",url:t,logo:e};return e&&t?s.jsx(Gn,{children:s.jsx("script",{"data-test":"org-structured-data",type:"application/ld+json",children:JSON.stringify(n)})}):null},I8t=(e,t)=>{const n="search_term_string";return{"@context":"https://schema.org","@type":"WebSite",url:e,potentialAction:{"@type":"SearchAction",target:{"@type":"EntryPoint",urlTemplate:`${t}{${n}}`},"query-input":`required name=${n}`}}},S8t=()=>{const e=f(n=>Ze(n,"structured-data-search-url")),t=f(n=>Ze(n,"structured-data-home-url"));return e&&t?s.jsx(Gn,{children:s.jsx("script",{"data-test":"website-structured-data",type:"application/ld+json",children:JSON.stringify(I8t(t,e))})}):null},C8t=()=>{const{formatMessage:e}=L(),t=F(),n=la("homepage-card"),o={loginCardTitle:e("logged.out.home.page.card.log.in.title"),loginCardSubtitle:e("logged.out.home.page.card.log.in.subtitle")};return{dataTest:"login-button",cardTitle:o.loginCardTitle,cardSubtitle:o.loginCardSubtitle,icon:"account",onClick:()=>{t(U.analyticsEvent({type:on.LOGIN_CLICKED,source:"loggedOutHomepageCards"})),n("login")},href:Yo()}},v8t=()=>{const{formatMessage:e}=L(),t=F(),n=la("homepage-card"),o={registerCardTitle:e("logged.out.home.page.card.register.title"),registerCardSubtitle:e("logged.out.home.page.card.register.subtitle")};return{dataTest:"register-button",cardTitle:o.registerCardTitle,cardSubtitle:o.registerCardSubtitle,icon:"account_new",onClick:()=>{t(U.analyticsEvent({type:on.REGISTER_CLICKED,source:"loggedOutHomepageCards"})),n("register")},href:xv()}},T8t="check-if-we-deliver-homepage-button",_8t=()=>{const{formatMessage:e}=L(),t=f(zs),{regionId:n}=YE(),o=f(Hp),{openDDS:r}=g_(),a=KFt(),i=()=>{a(t.data),r({userAction:"HOMEPAGE_CARD_CLICKED"})},l=()=>t.data?e("delivery.destination.homepage.change.card.title"):e("delivery.destination.homepage.check.card.title"),c=()=>{const d=e("delivery.destination.homepage.check.card.subtitle");if(!!!t.data)return d;const p=t.data?.deliveryMethod,g=t.data?.addressId===void 0;if(p==="CUSTOMER_COLLECTION")return e("delivery.destination.homepage.change.customerCollection.card.subtitle",{name:t.data?.name});if(p==="HOME_DELIVERY"){let E=t.data?.formattedAddress,y="delivery.destination.homepage.change.homeDelivery.card.subtitle";g&&(E=t.data?.postalCode);const I=t.data?.propositions;if(!I||I.length===0)return e(y,{formattedAddress:E});const S=I.find(T=>T.regionId==n);return S?(S.propositionType==="FAST"&&(y="delivery.destination.homepage.change.fastDelivery.card.subtitle"),e(y,{formattedAddress:E})):e(y,{formattedAddress:E})}return d};return{cardTitle:l(),cardSubtitle:c(),onClick:i,icon:"map_marker_hollow",dataTest:T8t,showCard:o}},b8t=()=>{const e=C8t(),t=v8t(),n=_8t();return{cardsData:[e,t,...n.showCard?[n]:[]]}},x8t=()=>{const{cardsData:e}=b8t(),t=12,n=e.length,o=({dataTest:r,cardTitle:a,cardSubtitle:i,icon:l,onClick:c,href:d})=>s.jsx(V.Item,{colSpan:{xs:12,sm:Math.ceil(t/n)},children:s.jsx(vs,{"data-test":r,title:{text:a,as:"h2"},description:i,icon:l,onClick:u=>c(u),...d?{to:d}:{as:"button"}})});return s.jsx(V,{className:"salt-p-y--4",children:e.map(o)})},A8t=v(Q)`
    &:empty {
        display: none;
    }
`,pae=({children:e})=>s.jsx(A8t,{gap:["md"],direction:"column",wrap:"nowrap",className:"salt-m-b--4",children:e}),R8t=()=>{const e=F();return{reportComponentizedAreaImpression:h.useCallback(n=>{e({type:Xt.HOMEPAGE_COMPONENTIZED_AREA_IMPRESSION,payload:n});const o={event:"view_componentized_homepage",id:n.ENTRY_ID,name:n.ENTRY_NAME,type:n.TYPE};te.sendEvent({GA:o,WA:null})},[e])}},D8t=(e,t={})=>{const n=h.useRef(null);return h.useEffect(()=>{const o=new IntersectionObserver(e,t);return n.current&&o.observe(n.current),()=>{n.current&&o.unobserve(n.current)}},[n]),n},O8t=v.div`
    inline-size: 100%;
    padding-block: 0;
    padding-inline: var(--salt-spacing-2);
`;function mae(e){const{componentized:t,type:n}=e,o=R8t(),r=Uc(()=>o.reportComponentizedAreaImpression({ENTRY_ID:t.id,ENTRY_NAME:t.name,TYPE:n}),{rootMargin:"0px 0px 0px 0px"});return t?s.jsx(O8t,{"data-test":"componentized-area",ref:r,children:s.jsx(Hk,{items:t.items,id:t.id,name:t.name,meta:{PAGE_TYPE:"curated",PAGE_NAME:"homepage",ENTRY_PUBLISHED_TIMESTAMP:`${t.publishedAt}`}})}):null}const P8t=D("cf.ca.lohp"),N8t=()=>{const e=ws(),t=f(P8t),n=f(wQ);return h.useEffect(()=>{t&&!n?.isFetching&&!n?.lastUpdated&&!n?.fetchError&&e(hl.fetchLoggedOutComponentizedHomepage())?.catch(()=>{})},[t,n]),!t||!n?.data?.length?null:n.data.map(o=>s.jsx(mae,{componentized:o,type:"loggedOutHomePage"},o.id))},L8t=D("seo.rdbl"),k8t=D("di"),j8t=({tag:e,offset:t,limit:n,decoratedOnly:o})=>(r,a)=>{const i=a(),l={imageFormats:Hn(i)??[],isSEOReadableURLEnabled:L8t(i),isDynamicImagesEnabled:k8t(i)};return r(hl.getPPWSHomepagePage({tag:e,offset:t,limit:n,decoratedOnly:o,transformerConfig:l})).then(c=>{if(!c)return;let{payload:{responseData:d}}=c;d=yp(d,l.imageFormats,l.isSEOReadableURLEnabled,l.isDynamicImagesEnabled);const{entities:u,result:{productGroups:p,missedPromotions:g}}=d;for(const E in u.product)u.product[E]===void 0&&delete u.product[E];return r(xt.setProducts(u)),g?.length&&r(fo.addMissedPromotions(g)),{products:Kp()(d),productGroups:p}}).catch(c=>{console.error("Error fetching catalogue page",c)})},hae=({page:e,cataloguePageOptions:t,getTargetUrl:n,categories:o,onInitialFopLoad:r,enableRegionAgnosticCategoriesPerSection:a,withoutHeader:i=!1})=>{const l=ws(),c=Ne(),d=Ge(),u=f(tmt);return s.jsx(Vm,{navigate:d,fetchPage:()=>l(j8t(t)),page:e,getTargetUrl:n,location:c,categories:o,hideFilterBar:!0,hideBreadcrumb:!0,enableRegionAgnosticCategoriesPerSection:a,withinGridProductCards:u||[],onInitialFopLoad:r,withoutHeader:i})},M8t=()=>s.jsx(hae,{page:"logged-out-homepage",cataloguePageOptions:{limit:"27",decoratedOnly:"true",tag:["web","lohp"]},getTargetUrl:()=>"",categories:[]}),w8t=D("rec"),F8t=D("cf.ca.lohp"),B8t=()=>{const e=F(),t=L(),n=f(NZ),o=f(Zd);return h.useEffect(()=>{const{isFetching:r,lastUpdated:a,fetchError:i}=n;!r&&!a&&!i&&e(T_())},[n]),s.jsxs(h.Fragment,{children:[s.jsx(y8t,{}),s.jsx(S8t,{}),s.jsxs(h.Fragment,{children:[s.jsx(bt,{tagline:"homepage.title.tagline",pattern:"homepage.title",title:"logged.out.home.page.heading",seoFriendlyMeta:{pageDescription:t.formatMessage("logged.out.home.page.heading"),metaDescriptionTagline:"homepage.meta.descriptionTagline"}}),s.jsx(ee,{as:"h1",className:"salt-p-y--4 salt-p-x--2",children:t.formatMessage("page.seo.heading",{separator:" ",name:o,tagline:t.formatMessage("logged.out.home.page.seo.header.tagline")})})]}),s.jsx(x8t,{}),s.jsxs(pae,{children:[s.jsx(dae,{page:"logged-out-homepage"}),s.jsx(N8t,{}),s.jsx(uae,{})]}),s.jsx(M8t,{}),s.jsx(t_,{})]})},gae=()=>s.jsx(Et,{type:"LoggedOutHomepage::route",children:s.jsx(B8t,{})});gae.fetchData=({context:{store:e}})=>{const t=e.getState(),n=w8t(t),o=F8t(t),r=[e.dispatch(T_())];return o&&r.push(e.dispatch(hl.fetchLoggedOutComponentizedHomepage())),n&&r.push(e.dispatch(BM())),Promise.all(r)};const U8t=Pe`
    inline-size: ${({displayLandscapeLayout:e})=>$(e?wN:GQ)};
`,G8t=({products:e,titleElement:t,a11yTitleText:n,seeMorePath:o,loading:r,overrideConfig:a,featuredProducts:i,page:l="logged-in-homepage",type:c="cluster",displayLandscapeLayout:d=!0,hfssRestriction:u=!1})=>{const p=L(),g=F(),{formatMessage:E}=L(),y=f(ts);h.useEffect(()=>{r||g(ai({products:e.map(({productId:_})=>({id:_})),featuredProductsData:i}))},[e]);const I=e.every(_=>Object.prototype.hasOwnProperty.call(y,_.productId)),S=typeof t=="string"?s.jsx(to.Title,{children:t}):t,C={labels:{"next-button":E("scroller.accessibility.viewNextIn",{a11yTitleText:n}),"previous-button":E("scroller.accessibility.viewPreviousIn",{a11yTitleText:n})}},T=u?e.filter(_=>!y[_.productId]?.hfssDisplayRestrictionGroup):e;return s.jsx(to,{flush:!0,title:S,"data-test":"fop-carousel",a11y:C,headerButton:o?s.jsx(to.HeaderButton,{to:o,children:p.formatMessage("bop.large.image.see.more")}):void 0,children:T.map(({productId:_,group:A,customAnalyticsData:R},P)=>s.jsx("div",{"data-test":"carousel-fop-wrapper",children:s.jsx(ea,{productId:_,group:A,position:P,page:l,subPage:null,noOfferLink:!1,type:c,withoutHeader:!0,customStyling:U8t,displayLandscapeLayout:d,fopPositionOnPage:P,sendFopImpression:!0,loading:r||!I,overrideConfig:a,customAnalyticsData:R})},_))})},$8t=()=>{const e=L(),t=ws(),n=f(kZe),o=os({breakpoint:"lg-up"}),r=f(LZe);h.useEffect(()=>{t(pI.getHomepageFavOnOffer())},[]);const a=()=>{if(n){const{products:g,group:E}=qT("favorite");return gl(g,E)}let u=r?.find(g=>g.type==="favorite")?.products??[];u.length>20&&(u=u.slice(0,20));const p=kp({productIds:u,title:e.formatMessage("home.page.favourites.on_offer.title"),productType:"favorite"});return gl(u,p)};if(!n&&!r?.length)return null;const i=e.formatMessage("home.page.favourites.on_offer.title"),l=Qe.stringify({boolean:"favoritesOnly",sortBy:"favorite"}),c=di(void 0,{queryString:l}),d={portrait:{promotion:{numberOfLines:1,numberOfPromotions:1},topAttributes:{favorite:!1,featured:!0,list:!0,regulars:!0},unitPrice:null,packSize:null},landscape:{promotion:{numberOfLines:1,numberOfPromotions:1},topAttributes:{favorite:!1,featured:!0,list:!0,regulars:!0},unitPrice:null,packSize:null}};return s.jsx(G8t,{products:a(),titleElement:i,a11yTitleText:i,seeMorePath:c,loading:n,displayLandscapeLayout:!o,overrideConfig:d})},Hh=({title:e,subtitleId:t,icon:n,path:o,status:r,isSSRNavigation:a,cardName:i,target:l,...c})=>{const[d,u]=h.useState(ct()),p=F(),g=la("homepage-card");h.useEffect(()=>{p(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"addFunctionCard",STATUS:r}}))},[]);const E=()=>typeof e=="object"?s.jsx(b,{id:e.id,values:e.values}):s.jsx(b,{id:e}),y=()=>s.jsx(b,{id:t}),I=()=>{p(U.analyticsEvent({type:Xt.HOMEPAGE_ADD_FUNCTION_CARD_CLICKED,data:{status:r,pageEventId:d}})),u(ct()),g(i)},S=()=>{I()};return o?a?s.jsx(vs,{...c,"data-test":i,title:{text:E(),as:"h2"},description:y(),icon:n,onClick:S,isSSRNavigation:!0,href:o,target:l}):s.jsx(vs,{...c,"data-test":i,title:{text:E(),as:"h2"},description:y(),icon:n,onClick:S,to:{...Js(o),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${d}`}}):s.jsx(vs,{...c,"data-test":i,title:{text:E(),as:"h2"},description:y(),icon:n,onClick:S,as:"button"})},Eae=({...e})=>{const t=F(),{formatMessage:n}=L();return h.useEffect(()=>{t(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"addFunctionCard",STATUS:"add function not available"}}))},[]),s.jsx(hR,{...e,"data-test":"services-down-error-card",title:{text:n("logged.in.home.page.configurable.card.error.title"),as:"h2"},description:n("logged.in.home.page.configurable.card.error.subtitle"),icon:"info_default"})},H8t=ia(`
    query GetShoppingListsOnLoggedInHomePage {
        shoppingLists {
            shoppingListId
        }
    }
`),V8t={additionalTypenames:["ShoppingList"]},W8t=e=>{const[{data:t,fetching:n,error:o}]=Kd({query:H8t,context:V8t}),r=F(),a=f(vn),i=f(l4e);h.useEffect(()=>(i.isFetching||r(id.fetchFavorites(a)).catch(()=>!1),()=>{r(id.clearFavorites())}),[]);const l=!!i.isFetching||n,c=!l&&!!t,d=!!t&&t.shoppingLists.length>0,u=!i.hasFavorites&&!d;return l?s.jsx(vs.Skeleton,{description:!0,"data-test":"configurable-card-skeleton",...e}):o||i.fetchError?s.jsx(Eae,{...e}):c&&u?s.jsx(Hh,{title:"logged.in.home.page.lists.card.title",subtitleId:"logged.in.home.page.lists.card.subtitle",icon:"list",path:jp(),status:"lists",cardName:"lists-begin-card",...e}):c?s.jsx(Hh,{title:"logged.in.home.page.favourites.and.lists.card.title",subtitleId:"logged.in.home.page.favourites.and.lists.card.subtitle",icon:"favourites",path:_m(),status:"favourites and lists",cardName:"favourites-and-lists-card",...e}):s.jsx(vs.Skeleton,{description:!0,"data-test":"configurable-card-skeleton",...e})},Y8t=({orders:e})=>{const t=L(),n=F(),[o,r]=h.useState(ct()),a=la("homepage-card");h.useEffect(()=>{n(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"multipleUpcomingOrdersCard",STATUS:"upcoming multiple orders",ORDER_ID:c}}))},[]);const i=()=>{l()},l=()=>{n(U.analyticsEvent({type:Xt.MULTIPLE_UPCOMING_ORDERS_CARD_CLICKED,data:{status:"upcoming multiple orders",orderId:c,pageEventId:o}})),r(ct()),a("multiple-upcoming-orders")},c=e.reduce((d,u)=>d.concat(u.orderId),[]);return s.jsx(vs,{"data-test":"multiple-upcoming-orders-card",title:{text:t.formatMessage("logged.in.home.page.order.card.multiple.orders.title",{numberOfOrders:t.formatNumber(e.length)}),as:"h2"},description:t.formatMessage("logged.in.home.page.order.card.multiple.orders.subtitle"),icon:"orders",to:{...Js(lo()),search:`?source=${encodeURIComponent("homepage card")}&sourceEventId=${o}`},onClick:i})},q8t=()=>{const e=F(),[t,n]=h.useState(!1),[o,r,a,i,l]=Ee(["loyalty","loyc.p","r.glorc","apo.liuoc","apo.liuoc.exp"]),c=f(v6),d=f(FE),u=f(wE),p=f(cN),g=es("loyalty-scheme-url"),{relevantOrders:E}=PM(),y=!o&&!u;h.useEffect(()=>{!a&&o&&!d.isFetching&&!d.lastUpdated&&e(yd.getCustomerLoyalty()).catch(()=>!1)},[]),h.useEffect(()=>(l&&i&&!p.lastUpdated&&!p.isFetching&&I(),()=>{n(!1)}),[]);const I=()=>e(Mre.getOrders()).catch(()=>n(!0)),S=o&&d.lastUpdated,C=S&&!r&&u;if(d.fetchError)return s.jsx(Eae,{});if(t&&Ue.api.pushError(new Error("WebAnalytics: Failed to load order"),{context:{errorFetching:t.toString()}}),p.fetchSuccess&&i&&l&&E&&E.length>1)return s.jsx(Y8t,{orders:E??[]});if(C)return s.jsx(Hh,{title:"logged.in.home.page.instant.shop.card.title",subtitleId:"logged.in.home.page.instant.shop.card.subtitle",icon:"smart_cart",path:Og(),status:"instant shop",cardName:"instant-shop-card"});if(!d.isFetching&&S){const T={id:"logged.in.home.page.loyalty.card.title",values:{amount:s.jsx(bd,{getQuantity:()=>d.balance})}};return s.jsx(Hh,{title:c?T:"logged.in.home.page.loyalty.card.customer.not.registered.title",subtitleId:c?"logged.in.home.page.loyalty.card.subtitle":"logged.in.home.page.loyalty.card.customer.not.registered.subtitle",icon:"loyalty",status:"loyalty",isSSRNavigation:!0,path:g,cardName:"loyalty-card",target:"_blank"})}return u?s.jsx(Hh,{title:"logged.in.home.page.instant.shop.card.title",subtitleId:"logged.in.home.page.instant.shop.card.subtitle",icon:"smart_cart",path:Og(),status:"instant shop",cardName:"instant-shop-card"}):y?s.jsx(W8t,{}):s.jsx(vs.Skeleton,{description:!0,"data-test":"configurable-card-skeleton"})},K8t=e=>{const t=Ki(e,Ct(e));return t?{start:t.dates.deliveryStartDate,end:t.dates.deliveryEndDate,timeZoneId:t.dates.timeZoneId,nickname:t.addressNickName,slotId:t.slotId}:null},z8t=()=>{const e=L(),t=ci(),[n,o]=h.useState(ct()),r=Zi(),[a]=Ee(["sl.fd"]),i=f(Zt),l=f(Mt),c=f(Ct),d=f(Ar),u=f(Vi),p=f(K8t),g=la("homepage-card"),E=F(),y=new URLSearchParams([["source","homepage card"],["sourceEventId",n]]),I=rf({searchParams:y}),S=f(Oo);if(h.useEffect(()=>{E(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"slot booking",STATUS:"slot reserved"}}))},[]),!u)return null;const C=u&&u.deliveryType===pt.clickAndCollect.type,T=u.slotType==="ON_DEMAND"&&u.deliveryMethod==="CUSTOMER_COLLECTION",_=u.slotType==="ON_DEMAND"&&u.deliveryMethod==="HOME_DELIVERY"&&a,A=()=>T?"express_collect":C?"click_collect":_?"on_demand":"home_delivery",R=()=>{const q=u.nickname?"logged.in.home.page.book.fast.delivery.card.subtitle":"logged.in.home.page.book.fast.delivery.card.subtitle.no.address.nickname",ue={duration:e.formatNumber(u.deliveryTimeInMinutes||0,{style:"unit",unit:"minute",unitDisplay:"short"}),...u.nickname&&{address:u.nickname}};return s.jsx(b,{id:q,values:ue})},P=()=>{let q="logged.in.home.page.book.slot.card.title.slot.booked";return T&&(q="logged.in.home.page.book.slot.card.title.express.collection.slot.booked"),_&&(q="home.page.slot.card.reserved.fast.delivery.title"),s.jsx(b,{id:q})},N=q=>s.jsx(qn,{dateIsoFrom:q.start,dateIsoTo:q.end,timeZoneId:q.timeZoneId,local:!0,dateFormat:i,timeFormat:l}),k=()=>{if(T){const q=r(u.deliveryTimeInMinutes),ne=r(u.collectionTimeInMinutes);return s.jsx(b,{id:"logged.in.home.page.book.express.collection.slot.card.subtitle.slot.and.address.format",values:{readyTimeSpan:q,maxTimeSpan:ne,address:u.nickname}})}return _?R():s.jsx(b,{id:"logged.in.home.page.book.slot.card.subtitle.slot.and.address.format",values:{interval:N(u),address:u.nickname}})},M=s.jsx(Cl,{dateIso:u.expiryTime,timeZoneId:u.timeZoneId,local:!0,timeFormat:l}),w=()=>d?s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.booked.alert.text.with.hint",values:{expiryTime:M}}):s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.booked.alert.text",values:{expiryTime:M}}),j=()=>{if(_)return R();if(T){const q=r(u.collectionTimeInMinutes),ne=r(u.deliveryTimeInMinutes);return s.jsx(b,{id:"logged.in.home.page.book.express.collection.slot.card.slot.new",values:{readyTimeSpan:q,maxTimeSpan:ne,address:u.nickname}})}return s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.new",values:{newSlotDeliveryInterval:N(u),address:u.nickname}})},G=()=>p?s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.old",values:{oldSlotDeliveryInterval:N(p),address:p.nickname}}):null,W=()=>p&&p.slotId!==u.slotId,H=q=>{E(ds({name:sm,event:q}))},K=async()=>{E(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Body",componentType:"Card",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),E(U.analyticsEvent({type:Xt.HOMEPAGE_SLOT_BOOKING_CARD_CLICKED,status:"slot reserved",orderId:c,pageEventId:n}));const q=await ko.fetchAnalyticsMetadataByActiveCart(S);E(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:q})),t(q),o(ct()),g("slot-booked-card")},X=q=>{H(q),K()};return u?s.jsx(vs,{"data-test":"slot-booked-card-v2",title:{text:P(),as:"h2"},description:W()?j():k(),additionalInfo:W()?G():null,icon:A(),alertBanner:u.expiryTime?{intent:"warning",text:w()}:void 0,onClick:X,to:I}):null},Q8t=()=>{const e=ci(),[t,n]=h.useState(ct()),o=Zi(),r=la("homepage-card"),[a]=Ee(["sl.fd"]),i=f(Vi),l=f(Zt),c=f(Mt),d=f(Ct),u=F(),p=new URLSearchParams([["source","homepage card"],["sourceEventId",t]]),g=rf({searchParams:p}),E=f(Oo),y=i&&i.deliveryType===pt.clickAndCollect.type;if(h.useEffect(()=>{u(U.analyticsEvent({type:Xt.HOME_CARD_IMPRESSION,data:{CARD_TYPE:"slot booking",STATUS:"slot reserved"}}))},[]),!i)return null;const I=i.slotType==="ON_DEMAND"&&i.deliveryMethod==="CUSTOMER_COLLECTION",S=i.slotType==="ON_DEMAND"&&i.deliveryMethod==="HOME_DELIVERY"&&a,C=()=>I?"express_collect":y?"click_collect":S?"on_demand":"home_delivery",T=()=>{let M="logged.in.home.page.book.slot.card.title.slot.booked";return I&&(M="logged.in.home.page.book.slot.card.title.express.collection.slot.booked"),S&&(M="home.page.slot.card.reserved.fast.delivery.title"),s.jsx(b,{id:M})},_=()=>{if(I){const w=o(i.deliveryTimeInMinutes),j=o(i.collectionTimeInMinutes);return s.jsx(b,{id:"logged.in.home.page.book.express.collection.slot.card.subtitle.slot.and.address.format",values:{readyTimeSpan:w,maxTimeSpan:j,address:i.nickname}})}if(S){const w=i.nickname?"logged.in.home.page.book.fast.delivery.card.subtitle":"logged.in.home.page.book.fast.delivery.card.subtitle.no.address.nickname",j={duration:i.deliveryTimeInMinutes,...i.nickname&&{address:i.nickname}};return s.jsx(b,{id:w,values:j})}const M=s.jsx(qn,{dateIsoFrom:i.start,dateIsoTo:i.end,timeZoneId:i.timeZoneId,local:!0,dateFormat:l,timeFormat:c});return s.jsx(b,{id:"logged.in.home.page.book.slot.card.subtitle.slot.and.address.format",values:{interval:M,address:i.nickname}})},A=s.jsx(Cl,{dateIso:i.expiryTime,timeZoneId:i.timeZoneId,local:!0,timeFormat:c}),R=()=>s.jsx(b,{id:"logged.in.home.page.book.slot.card.slot.booked.alert.text",values:{expiryTime:A}}),P=M=>{u(ds({name:sm,event:M}))},N=async()=>{u(U.analyticsEvent({type:Re.REDIRECT_TO_SLOT_BOOKING,description:"User clicked link to be redirected to slot booking",pageEventAttributes:{componentLocation:"Body",componentType:"Card",linkType:"Button",userInteraction:"BUTTON_CLICKED"}})),u(U.analyticsEvent({type:Xt.HOMEPAGE_SLOT_BOOKING_CARD_CLICKED,status:"slot reserved",orderId:d,pageEventId:t}));const M=await ko.fetchAnalyticsMetadataByActiveCart(E);u(U.analyticsEvent({type:Le.BEGIN_CHECKOUT,meta:M})),e(M),n(ct()),r("slot-booked-card")},k=M=>{P(M),N()};return s.jsx(vs,{"data-test":"slot-booked-card",title:{text:T(),as:"h2"},description:_(),icon:C(),alertBanner:i.expiryTime?{intent:"warning",text:R()}:void 0,onClick:k,to:g})},X8t=D("csoei"),Z8t=()=>{const e=f(i=>is(i)),t=f(BR),n=f(Que),o=f(X8t),r=f(Xue),a=F();return h.useEffect(()=>{(!e?.lastUpdated&&!e?.isFetching||r)&&a(Yt.getBasket())},[r]),!n&&e?.isFetching?s.jsx(vs.Skeleton,{description:!0,"data-test":"slot-card-skeleton"}):n?o?s.jsx(z8t,{}):s.jsx(Q8t,{}):t||e?.fetchError?s.jsx(LJ,{}):s.jsx(NJ,{})},J8t=v(O)`
    flex: 1;
    word-break: break-word;
`,eQt=v(x)`
    max-inline-size: min-content;
`,tQt={COLLECTION:{cardMessage:"delivery.destination.homepage.selector.collection.address.selected",deliveryMethodMessage:"delivery.destination.selector.plus.scheduled.collection.option.title"},DELIVERY:{cardMessage:"delivery.destination.homepage.selector.home.address.selected",deliveryMethodMessage:"delivery.destination.selector.plus.scheduled.delivery.option.title"},FAST_DELIVERY:{cardMessage:"delivery.destination.homepage.selector.ondemand.address.selected",deliveryMethodMessage:"delivery.destination.selector.plus.ondemand.delivery.option.title"},NONE:{cardMessage:"delivery.destination.homepage.selector.homepage.choose.location",deliveryMethodMessage:""}};function sQt(e,t){switch(e){case"CUSTOMER_COLLECTION":return"COLLECTION";case"HOME_DELIVERY":return t==="FAST"?"FAST_DELIVERY":"DELIVERY";default:return"NONE"}}const nQt=()=>{const e=F(),{formatMessage:t}=L(),n=YE(),o=f(zs),r=f(Rt),{openDDS:a}=g_(),{deliveryMethod:i,name:l,propositions:c}=o.data??{},d=c?.find(({regionId:I})=>I===n.regionId),u=sQt(i,d?.propositionType),p=h.useCallback(()=>e(EFt({DELIVERY_OPTION:u,IS_TEMPORARY:u==="NONE"?!1:!o.data?.addressId})),[e,u,o]),g=TE(p);if(r||!o.data&&o.isFetching)return s.jsx(vs.Skeleton,{"data-test":"delivery-destination-card-skeleton"});const{cardMessage:E,deliveryMethodMessage:y}=tQt[u];return s.jsx(xe,{ref:g,condensed:!0,children:s.jsxs(Q,{align:"center",justify:"space-between",wrap:"nowrap",children:[s.jsx(J8t,{className:"salt-m-r--2",children:t(E,{bold:I=>s.jsx(O,{bold:!0,children:I}),deliveryMethod:i,addressName:l,collectionLocationName:l})}),s.jsx(eQt,{intent:"secondary",size:"s",fill:!1,onClick:()=>a({userAction:"HOMEPAGE_BOX_CLICKED"}),"aria-label":t(i?"delivery.destination.homepage.selector.button.accessibility.text":"delivery.destination.homepage.selector.homepage.choose.location",{bold:I=>I,deliveryMethod:y?t(y):void 0,addressName:l}),children:t(i?"delivery.destination.homepage.box.action.change":"delivery.destination.homepage.box.action.choose")})]})})},oQt=({customerMoniker:e="",intl:t})=>{const n={welcomeText:t.formatMessage("logged.in.home.page.welcome.text",{moniker:e})};return s.jsx(ee,{as:"h1","data-pii":"true",className:"salt-m-b--4",children:n.welcomeText})},rQt=Ro(["dds.hp","dds.plus"]),aQt=({customerMoniker:e,intl:t})=>{const n=f(rQt);return s.jsxs("div",{className:"salt-p-y--4 salt-p-x--2","data-test":"logged-in-homepage-cards",children:[oQt({customerMoniker:e,intl:t}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx(B7,{})}),n&&s.jsx("div",{className:"salt-m-b--4 sm:salt-d--none",children:s.jsx(nQt,{})}),s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12,sm:4,md:4,lg:4},children:s.jsx(Z8t,{})}),s.jsx(V.Item,{colSpan:{xs:12,sm:4,md:4,lg:4},children:s.jsx(Ure,{})}),s.jsx(V.Item,{colSpan:{xs:12,sm:4,md:4,lg:4},children:s.jsx(q8t,{})})]})]})},iQt=Ht(aQt),lQt=D("cf.ca.lihp"),cQt=()=>{const e=ws(),t=f(lQt),n=f(wQ);return h.useEffect(()=>{t&&!n?.isFetching&&!n?.lastUpdated&&!n?.fetchError&&e(hl.fetchLoggedInComponentizedHomepage())?.catch(()=>{})},[t,n]),!t||!n?.data?.length?null:n.data.map(o=>s.jsx(mae,{componentized:o,type:"loggedInHomePage"},o.id))},dQt=v(x)`
    white-space: nowrap;
    ${e=>e.intent==="tertiary"&&"background-color: white;"};
`,uQt=({id:e,selected:t,label:n,setAppliedFilters:o})=>{const{formatMessage:r}=L(),a=ws(),i=l=>{o(c=>{const d=c.find(E=>E.id===l)?.selected;let u,p;d?(u=c.map(E=>({...E,selected:!1})),u.find(E=>E.id==="all").selected=!0,p=void 0):(u=c.map(E=>E.id===l?{...E,selected:!0}:{...E,selected:!1}),p=l==="all"?void 0:l),a(hl.filterCatalogue(p));const g=l==="all"?!0:!d;return a(U.analyticsEvent({type:Xt.PRODUCT_CLUSTERS_FILTER_CLICKED,data:{action:g?"select":"deselect",button:l}})),u})};return s.jsx(dQt,{intent:t?"secondary":"tertiary",onClick:()=>i(e),"data-test":`product-filter-${e}`,children:s.jsx(x.Text,{children:r(n)})},`${e}-btn`)},pQt=v.div`
    --scrollbar-width: ${({scrollbarWidth:e})=>$(e)};
    --background-color: ${({isSticky:e})=>e?"var(--intent-secondary-200)":"var(--background-color)"};

    z-index: 4;
    background-color: var(--background-color);
    inset-block-start: ${({headerSize:e})=>e}px;
    position: sticky;
    overflow: visible;
    inline-size: calc(100vi - var(--scrollbar-width));
    margin-inline-start: calc(50% - (50vi - var(--scrollbar-width) / 2));
`,mQt=v.div`
    margin-block: 0;
    margin-inline: auto;
    max-inline-size: ${$(1920)};
`,hQt=v(to)`
    --salt-horizontal-scroll-content-padding: 0;
    --salt-horizontal-scroll-background-color: var(--background-color);
`,gQt=({appliedFilters:e,setAppliedFilters:t,productGroups:n})=>{const{formatMessage:o}=L(),r=ws(),a=h.useRef(0),i=h.useRef(null),[l,c]=h.useState(!1),[d,u]=h.useState(0),[p,g]=h.useState(!1),[E,y]=h.useState(0);h.useEffect(()=>{const T=i.current?.offsetHeight??0,A=`-${d+T+1}px 0px 0px 0px`,R=new IntersectionObserver(([P])=>{if(P){if(!P.isIntersecting){c(!0);return}c(!1)}},{rootMargin:A,threshold:0});return i.current&&R.observe(i.current),()=>R.disconnect()},[d]),h.useEffect(()=>{const T=document.getElementById("product-page"),_=Vr(()=>{if(!T)return;const A=T.getBoundingClientRect().top;A&&A<0&&(g(!0),u(a.current),window.removeEventListener("scroll",_))},50);return window.addEventListener("scroll",_),()=>{window.removeEventListener("scroll",_)}},[]),h.useEffect(()=>{const T=document.getElementById("main-header"),_=new ResizeObserver(([A])=>{const[{blockSize:R}]=A.borderBoxSize;a.current!==R&&(a.current=R,p&&u(R))});if(T){const{innerWidth:A}=window,{clientWidth:R}=document.documentElement,P=A-R;E!==P&&y(P),_.observe(T)}return()=>{_.disconnect()}},[p]),h.useEffect(()=>{const T=document.getElementById("product-page"),_=document.getElementById("main-header");if(T&&_){const A=_.offsetHeight||0,R=T.getBoundingClientRect().top+window.scrollY,P=i.current?.offsetHeight||0;T.getBoundingClientRect().top-P<0&&window.scrollTo({top:R-A-P,behavior:"smooth"})}},[e]),h.useEffect(()=>{if(n){const T=e.find(A=>A.selected),_=n.find(A=>A.type===T?.id)?.products;_&&r(iv(_))}},[e,n]);const I=()=>!n||!Array.isArray(n)?null:e.map(T=>{const _=n?.find(A=>A.type===T.id);return T.id!=="all"&&(!_||!Array.isArray(_.products)||_.products.length===0)?null:s.jsx(uQt,{id:T.id,selected:T.selected,label:T.label,setAppliedFilters:t},`${T.id}-chip`)}),C=D8t(([T],_)=>{if(!T?.isIntersecting)return;const A=e.filter(R=>R.id==="all"||n.some(P=>P.type===R.id&&P.products.length>0)).map(R=>R.id);r(U.analyticsEvent({type:Xt.PRODUCT_CLUSTERS_FILTERS_IMPRESSION,data:{BUTTON_TYPE:JSON.stringify(A)}})),_.unobserve(T.target)},{root:null,rootMargin:"-80px 0px 0px 0px",threshold:.5});return s.jsx(pQt,{headerSize:d,ref:i,isSticky:l,scrollbarWidth:E,shouldDisplay:p,className:"salt-p-y--2",children:s.jsx(mQt,{ref:C,children:s.jsx(hQt,{a11y:{labels:{"next-button":o("scroller.accessibility.viewNext"),"previous-button":o("scroller.accessibility.viewPrevious")}},className:"salt-m-x--2",navigationButtonPosition:"side",title:s.jsx(h.Fragment,{children:" "}),flush:!0,"data-test":"homepage-product-filters",children:I()})})})},EQt=D("seo.rdbl"),fQt=D("apo.pf.exp"),yQt=()=>{const e=ws(),[t,n]=h.useState([{id:"all",label:"navigation.all",selected:!0},{id:"on_offer",label:"fop.group.title.on_offer",selected:!1},{id:"favorite",label:"fop.group.title.favorite",selected:!1},{id:"featured",label:"fop.group.title.featured",selected:!1}]),o=f(EQt),r=f(fQt),a=f(gC),i=f(Aq),l=f(NZ),c=f(Xhe);h.useEffect(()=>{!l.isFetching&&!l.lastUpdated&&!l.fetchError&&e(T_())?.catch(()=>{})},[l]);const d=({category:u=void 0,fullURLPath:p=""}={})=>{const g=`sublocationId=${u}`;if(o){if(p.trim()==="")return Sa(u,void 0);const E=p.toLowerCase();return Sa(u,E)}return ao({queryString:g})};return s.jsxs(h.Fragment,{children:[r&&c&&s.jsx(gQt,{appliedFilters:t,setAppliedFilters:n,productGroups:c}),s.jsx(hae,{page:"logged-in-homepage",cataloguePageOptions:{offset:0,limit:a,tag:["web","lihp"]},getTargetUrl:u=>d(u),categories:r?[]:i,onInitialFopLoad:()=>e(ds({name:Qxe})),enableRegionAgnosticCategoriesPerSection:!0,withoutHeader:r})]})},IQt=D("rec"),SQt=D("cf.ca.lihp"),CQt=D("exp.fv.ofr"),vQt=()=>{const e=F(),t=L(),n=f(Ol),o=f(lN),r=f(CQt);return h.useEffect(()=>{!n.isFetching&&!n.lastUpdated&&!n.fetchError&&e(xs.getCurrentCustomer())?.catch(()=>{})},[n]),h.useEffect(()=>{o&&e(_T.fetchFailedOrderPayments())?.catch(()=>{})},[]),s.jsxs("div",{"data-synthetics":"homepage",children:[s.jsx(bt,{title:"logged.out.home.page.heading",tagline:"homepage.title.tagline",pattern:"homepage.title",seoFriendlyMeta:{pageDescription:t.formatMessage("logged.out.home.page.heading"),metaDescriptionTagline:"homepage.meta.descriptionTagline"}}),s.jsx(iQt,{customerMoniker:n.data.moniker}),s.jsxs(pae,{children:[s.jsx(dae,{page:"logged-in-homepage"}),r&&s.jsx($8t,{}),s.jsx(cQt,{}),s.jsx(uae,{})]}),s.jsx(yQt,{}),s.jsx(t_,{})]})},fae=()=>s.jsx(Et,{type:"LoggedInHomepage::route",children:s.jsx(vQt,{})});fae.fetchData=({context:{store:e}})=>{const t=e.getState(),n=IQt(t),o=SQt(t),r=[e.dispatch(xs.getCurrentCustomer()),e.dispatch(T_())];return o&&r.push(e.dispatch(hl.fetchLoggedInComponentizedHomepage())),n&&r.push(e.dispatch(BM())),Promise.all(r)};const TQt=e=>[{path:"/",Component:e.Main,key:"main",children:[{index:!0,Component:Ic([{condition:Xe,failComponent:gae}],fae)}]}],_Qt=({onAddToBasket:e})=>s.jsxs(h.Fragment,{children:[s.jsx(xe,{condensed:!0,className:"salt-m-t--8",children:s.jsxs(Q,{align:"center",wrap:"nowrap",className:"salt-p-y--2 salt-p-x--4 .sm:salt-p-x--8",children:[s.jsx(kl,{className:"salt-m-r--4",children:s.jsx(pe,{name:"orders_placed",width:24,height:24})}),s.jsx(O,{size:"l","data-test":"instant-shop-box-message",children:s.jsx(b,{id:"instant.shop.modal.box.message"})})]})}),s.jsx(x,{intent:"action",fill:!0,"data-test":"instant-shop-add-to-basket",onClick:e,className:"salt-m-t--2",children:s.jsx(b,{id:"instant.shop.modal.add.to.cart"})})]}),bQt=()=>{const e=F(),t=()=>{e(U.analyticsEvent({type:dc.INSTANT_SHOP_ADD_TO_CART_CLICKED,description:yA.INSTANT_SHOP_ADD_TO_CART_CLICKED})),e(J.openModal("instantShop"))};return s.jsxs(zT,{activeTab:pa.INSTANT_SHOP,children:[s.jsx(bt,{title:"instant.shop.page.title"}),s.jsxs(V,{fixed:!0,className:"salt-m-t--4",children:[s.jsx(V.Item,{colSpan:{xs:1,sm:2,md:3,lg:4},children:void 0}),s.jsxs(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},children:[s.jsx(Os,{titleIcon:"smart_cart",title:"instant.shop.page.heading",titleAs:"h1",description:"instant.shop.page.description"}),s.jsx(_Qt,{onAddToBasket:t}),s.jsx(hX,{showOnlyProgressIndicator:!0})]})]})]})},yae=()=>s.jsx(Et,{type:"InstantShop::route",children:s.jsx(bQt,{})});yae.fetchData=async({context:e})=>{await e.store.dispatch(QT())};const xQt=e=>[{path:"/smart-shop",Component:e.Main,key:"main",children:[{index:!0,Component:Ic([{condition:t=>wE(t),failComponent:ot}],$s(Xe,yae))}]}],AQt=()=>{const e=Ge(),[t,n]=h.useState(!1);h.useEffect(()=>{n(document?.referrer.startsWith(window.location.origin))},[]);const o={text:"navigation.back",onClick:()=>e(-1)};return s.jsx("div",{"data-test":"lister-page-products-not-found",className:"salt-m-y--16",children:s.jsx(V,{fixed:!0,children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:"search",titleAs:"h2",title:"catalogue.no.results.title",primaryButton:t?o:void 0})})})})},UM=se("GET_LISTER_PAGE"),RQt=(e,t)=>({type:"API",advertId:e,payload:{url:`/v5/products/lister-page?retailerProductIds=${t.join(",")}`,...UM}}),DQt=(e,t)=>({type:UM.SUCCESS,advertId:e,payload:{responseData:{productIds:t}}}),OQt=e=>({type:UM.ERROR,advertId:e}),PQt=e=>t=>e?t.data.listerPage[e]:void 0,NQt=D("li.by"),Iae=(e,t,n)=>async(o,r)=>{if(e)await iv(r)(t,n).then(()=>{t(DQt(o,r))}).catch(()=>{t(OQt(o))});else{const a=await t(RQt(o,r)),{productEntities:i={}}=a.payload.responseData;await t(xt.setProducts({product:i}))}},LQt=()=>{const e=Yd(),t=F(),n=Ne(),[o=!1]=Ee(["li.by"]),r=new URLSearchParams(n.search),a=r.get("ids"),i=r.get("advertId"),d=typeof a=="string"&&a?.length&&(typeof i=="string"&&i),u=f(PQt(i)),{isFetching:p,productIds:g,fetchError:E}=u||{},y=f(ts);h.useEffect(()=>{if(!d||u)return;const C=a.split(",");(async()=>{try{await Iae(o,t,e.getState)(i,C)}catch{}})()},[e,t,a,i,u,o,d]);const I=h.useCallback(()=>{const C=g?.every(T=>y[T]);return!u||p||!C},[u,p,g,y]),S=()=>E?s.jsx(jn,{showRefreshLink:!0}):!d||u&&!p&&!g?.length?s.jsx(AQt,{}):s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx(uo,{type:"catalogue",page:"product-range",productGroups:[{products:g,type:""}],productsByProductId:y,isFetching:I(),"data-test":"lister-page-products-grid"})]});return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"lister-page.title"}),s.jsx(sn,{children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"lister-page.heading"})})}),s.jsx("div",{className:"salt-p-x--2",children:S()})]})},Sae=()=>s.jsx(Et,{type:"ListerPage::route",children:s.jsx(LQt,{})});Sae.fetchData=async({context:{store:e,url:t}})=>{const n=t.searchParams.get("ids"),o=t.searchParams.get("advertId"),r=typeof n=="string"&&n?.length,a=typeof o=="string"&&o,i=NQt(e.getState());if(!(r&&a))return;const l=n.split(",");await Iae(i,e.dispatch,e.getState)(o,l)};const kQt=e=>[{path:"/product-range",Component:e.Main,key:"main",children:[{index:!0,Component:Sae}]}],jQt={MEAL_PLAN:{path:$T(),titleKey:"mealplan.tab"},MEALS:{path:FZ(),titleKey:"yourmeals.tab"}},Cae=({tabs:e=jQt,activeTabType:t,onTabClick:n})=>{const o=L();return s.jsx(Kr,{highlightedId:t,className:"salt-m-t--8",children:Object.entries(e).map(([r,a])=>{const i=r===t;return s.jsx(Kr.Link,{id:r,to:i?void 0:MQt(a.path),onClick:()=>n&&n(r),children:o.formatMessage(a.titleKey)},r)})})},MQt=e=>({...Js(e)}),wQt=()=>e=>e(p9e()).catch(()=>{}),FQt=v.span`
    inline-size: ${$(28)};
    block-size: ${$(28)};
    display: flex;
    align-items: center;
    justify-content: center;

    ${({highlighted:e})=>e&&`
            background: var(--intent-primary);
            color: var(--intent-contrast);
            border-radius: var(--salt-radius-default);
    `}
`,BQt=v(x)`
    margin-inline-start: auto;
`,UQt=v(pe)`
    color: var(--intent-secondary-900);
`,GQt=({relativeNameTranslationId:e,dayNameString:t,dayStatus:n,date:o,currentDayRef:r})=>{const{formatMessage:a}=L(),i=e?a(e):t;return s.jsxs("div",{...n==="CURRENT"&&{ref:r,"data-test":"current-day-header"},children:[s.jsxs(Q,{gap:["xs"],align:"center",className:"salt-p-y--4",children:[s.jsx(O,{size:"l",bold:!0,asChild:!0,children:s.jsx(FQt,{highlighted:n==="CURRENT",children:o})}),s.jsx(O,{size:"l",asChild:!0,children:s.jsx("h3",{children:i})}),n==="FUTURE"&&s.jsxs(BQt,{intent:"secondary",size:"s",children:[s.jsx("span",{className:"salt-vc",children:a("mealplanning.meal-plan.add-meal-button.accessible-text",{day:i})}),s.jsx("span",{"aria-hidden":!0,children:s.jsx(b,{id:"mealplanning.meal-plan.add-meal-button"})})]})]}),s.jsx(Q,{justify:"center",children:s.jsx(UQt,{name:"empty_day",height:70,width:"auto",className:"salt-m-y--8"})})]})},$Qt=v.div`
    overflow-y: scroll;
    padding-block: var(--salt-spacing-2) 0;
    padding-inline: var(--salt-spacing-4);
    scrollbar-width: none;
    max-block-size: ${`calc(100vb - ${$(co.v2.sm)} + var(--salt-spacing-4) * 5)`};
    ${re.lgUp`
        max-block-size: ${`calc(100vb - ${$(co.v2.lgUp)} + var(--salt-spacing-4) * 5
        )`};
    `};
`,HQt=v(xe)`
    position: sticky;
    inset-block-start: 0;
    box-shadow: var(--salt-elevation-shadow-3);
    z-index: ${$t["sticky-add-button"]};
`,VQt=()=>{const e=Hg(),t=ws(),n=Me(g9e),{formatMessage:o}=L(),r=h.useRef(null),a=h.useRef(null),i=h.useRef(null);return h.useEffect(()=>{t(wQt())},[]),h.useEffect(()=>{if(!n.weeks.length||!r.current||!a.current||!i.current||e!=="PUSH")return;const l=a.current.getBoundingClientRect().top-i.current.getBoundingClientRect().bottom;r.current.scrollTo(0,l)},[n.weeks.length,e]),n.weeks.length?s.jsxs(ae.Fragment,{children:[s.jsx(Cae,{activeTabType:"MEAL_PLAN"}),s.jsxs(V,{fixed:!0,className:"salt-m-b--16 salt-gap--0",children:[s.jsx(V.Item,{asChild:!0,colSpan:{xs:12,md:8},children:s.jsx($Qt,{ref:r,children:n?.weeks.map((l,c)=>s.jsxs("div",{children:[s.jsxs(HQt,{condensed:!0,"data-test":"week-header",...c===0&&{ref:i,"data-test":"first-week-header"},children:[s.jsx(O,{size:"l",bold:!0,asChild:!0,children:s.jsxs(ee,{as:"h2",children:[s.jsx("span",{"aria-hidden":!0,children:o(l.weekString)}),s.jsx("span",{className:"salt-vc",children:o("mealplanning.meal-plan.weekly-header.accessible-text",{title:o(l.weekString),startDate:l.weekStart,endDate:l.weekEnd})})]})}),s.jsx(O,{"aria-hidden":!0,size:"s",children:l.weekIntervalString})]}),l.days.map(d=>s.jsx(GQt,{...d,currentDayRef:a},d.date))]},l.start))})}),s.jsx(V.Item,{colSpan:{md:4},className:"salt-d--flex",children:s.jsx(Ts,{orientation:"vertical"})})]})]}):null};function WQt(){return s.jsx(Et,{type:"MealPlan::route",children:s.jsx(VQt,{})})}const vae=v(df)`
    cursor: pointer;
    display: flex;
    flex-direction: column;
    block-size: 100%;
`,Tae=v.img`
    flex: 1;
    object-fit: cover;
    object-position: 50% 50%;
    inline-size: 100%;
    min-block-size: 0;
`,_ae=v.div`
    block-size: ${$(40)};
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    word-break: break-word;
    @supports (-webkit-line-clamp: 2) {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: initial;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: block-axis;
    }
`,YQt=v(Ye)`
    display: flex;
    flex-direction: column;
    inline-size: 100%;
    text-decoration: none;

    &:hover {
        text-decoration: none;
    }

    &:active {
        text-decoration: none;
    }
`,qQt=v(ln)`
    position: absolute;
`,KQt=({image:e,title:t,slug:n,id:o,index:r})=>{const{formatMessage:a}=L(),i=ft(),c=TE(()=>{i({type:UD,RECIPE_ID:o,INDEX:r,LIST:"your-meals: other"});const u={event:"view_recipe_card",id:o,index:r,list:"your-meals: other"};te.sendEvent({GA:u,WA:null})});if(!n)return null;const d=()=>{i({type:BD,RECIPE_ID:o,INDEX:r,LIST:"your-meals: other"});const u={event:"select_recipe_card",id:o,index:r,list:"your-meals: other"};te.sendEvent({GA:u,WA:null})};return s.jsx(vae,{tabIndex:0,children:s.jsxs(YQt,{ref:c,to:{pathname:ki(n,o)},"data-test":"recipe-card",onClick:d,children:[s.jsx(qQt,{intent:"secondary",icon:"save_on",text:a("meals.savedRecipe.badge"),className:"salt-m--1"}),s.jsx(Tae,{alt:e.altText,src:e.url}),s.jsx("div",{className:"salt-p--2",children:s.jsx(_ae,{children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h2",{children:t})})})})]})})},zQt=({image:e,title:t,onSelectMeal:n})=>s.jsxs(vae,{as:"a",tabIndex:0,onClick:n,onKeyDown:o=>{o.code==="Enter"&&n()},"data-test":"meal-card",children:[s.jsx(Tae,{alt:e.altText,src:e.url}),s.jsx("div",{className:"salt-p--2",children:s.jsx(_ae,{children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h2",{children:t})})})})]}),QQt=v.div`
    inline-size: 100%;
`,XQt=v(df)`
    display: flex;
    flex-direction: column;
    block-size: 100%;
`,ZQt=v.div`
    inline-size: 100%;
    block-size: ${$(160)};
    ${re.smUp`
        height: ${$(200)};
    `};
`,JQt=()=>s.jsx(QQt,{"data-test":"meal-card-skeleton",children:s.jsxs(XQt,{children:[s.jsx(ZQt,{children:s.jsx(_e,{"data-test":"meal-card-skeleton-image",height:"100%",width:"100%"})}),s.jsxs("div",{className:"salt-p--2",children:[s.jsx(_e,{"data-test":"meal-card-skeleton-title-1",height:"23px"}),s.jsx(_e,{"data-test":"meal-card-skeleton-title-2",height:"23px",width:"140px",className:"salt-m-t--1"})]})]})}),e9t=({meals:e,isFetching:t})=>{const n=F(),o=r=>{n(J.openModal("mealDetails",r)),n(U.analyticsEvent({type:QD,MEAL_ID:r.id}));const a={event:"meal_plan_view_meal_details",id:r.id};te.sendEvent({GA:a,WA:null})};return t?s.jsx(t9t,{}):e&&e.length>0?s.jsxs("div",{className:"salt-m-y--2",children:[s.jsx(ie,{children:"List of meals"}),s.jsx(V,{asChild:!0,flush:!0,children:s.jsx("ul",{children:e.map((r,a)=>s.jsx(V.Item,{asChild:!0,colSpan:{xs:6,md:4,lg:3},children:s.jsx("li",{children:r.type==="RECIPE"?s.jsx(KQt,{...r,index:a}):s.jsx(zQt,{onSelectMeal:()=>o(r),...r})})},r.id))})})]}):s.jsx("p",{children:" TODO: Show Empty state here "})},t9t=()=>s.jsx(V,{children:[...Array(12).keys()].map(e=>s.jsx(V.Item,{colSpan:{xs:6,md:4,lg:3},children:s.jsx(JQt,{})},`meal-card-skeleton-${e}`))}),GM=(e="")=>t=>t(Jv(e)).catch(()=>{}),s9t=()=>{const e=ws(),{formatMessage:t}=L(),[n,o]=h.useState(!1),r=Me(D8),a=Me(Tm),[i,l]=h.useState(a),c=()=>{o(!1),a!==i&&e(GM(i))};return r?s.jsxs(h.Fragment,{children:[s.jsx(x,{style:{width:"auto"},size:"s",intent:"secondary",fill:!0,onClick:()=>{l(a),o(!0)},"data-test":"sort-mobile-button","aria-label":"open sort button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"meals.sort.button"})})}),s.jsxs(B,{isOpen:n,onRequestClose:()=>o(!1),asBottomSheet:!0,children:[s.jsx(B.Header,{onRequestClose:()=>o(!1),align:"left",children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"meals.sort.title"})})}),s.jsx(B.Body,{children:s.jsx(xe,{children:s.jsx(fs.RadioGroup,{value:i,groupLabel:{text:t("meals.sort.title"),isVisuallyConcealed:!0},name:"mealsSort",onChange:l,radios:r.map(({key:d,sortOptionId:u})=>({value:u,label:s.jsx(b,{id:d})}))})})}),s.jsx(B.Footer,{align:"center",children:s.jsx(x,{intent:"primary",onClick:c,fill:!0,"data-test":"sort-modal-confirm-button",children:s.jsx(x.Text,{children:t("meals.sort.confirm")})})})]})]}):null},{RadioIconOff:n9t,RadioIconOn:o9t,RadioText:r9t}=Pa,a9t=()=>{const e=Ge(),{formatMessage:t}=L(),n=Me(D8),o=Me(Tm),[r,a]=h.useState(o),[i,l]=h.useState(!1);h.useEffect(()=>{a(o)},[o]);const c=u=>{l(!1),u!==r&&(a(u),e(`/meals?sortBy=${u}`))},d=u=>n?.find(g=>g.sortOptionId===u)?.key||"";return n?s.jsxs(rt.Container,{children:[s.jsx(rt.TriggerDefaultButton,{isOpen:i,size:"s",fill:!0,text:r&&t(d(r)),"aria-controls":"meals-sort",onClick:()=>l(!i),"data-test":"sort-drop-down","aria-expanded":i,"aria-haspopup":"true"}),s.jsx(rt.Body,{isOpen:i,children:s.jsx(rt.Content,{children:s.jsx(Be,{"data-test":"sort-drop-down-list",children:n.map(({key:u,sortOptionId:p})=>s.jsx(Be.Item,{onClick:()=>c(p),children:s.jsx(xe,{className:"salt-p--2",children:s.jsxs(Rn,{className:"salt-m-b--0",children:[p===r?s.jsx(o9t,{name:"radio_on"}):s.jsx(n9t,{name:"radio_off"}),s.jsx(O,{children:s.jsx(r9t,{as:"strong",children:s.jsx(b,{id:u})})})]})})},p))})})})]}):null},i9t=()=>{const e=F(),t=()=>{e(U.analyticsEvent({type:tY})),e(J.openModal("newMealModal"))};return s.jsx("div",{children:s.jsxs(x,{size:"s",intent:"primary",fill:!0,onClick:t,"data-test":"new-meal-button","aria-label":"open new meal options",children:[s.jsx(x.Icon,{name:"new_meal"}),s.jsx(x.Text,{children:s.jsx(b,{id:"meals.newMeal.button"})})]})})},l9t=v(B.Footer)`
    flex-flow: column-reverse;

    ${re.smUp`
        flex-flow: row;
    `}
`,c9t=()=>{const e=ws(),t=Me($e("deleteMeal")),[n,o]=h.useState(!1),r=Me(Yn("deleteMeal"));if(!r?.meal)return null;const{meal:{id:a,title:i},onCancel:l}=r,c=()=>{o(!0),e(nM.deleteMeal(a)).then(()=>{o(!1),r.onConfirm()})};return s.jsx(B,{isOpen:t,onRequestClose:l,maxWidth:"lg",children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"meals.deleteMeal.title"})})}),s.jsx(B.Body,{children:s.jsx(b,{id:"meals.deleteMeal.confirmation",values:{meal_name:i}})}),s.jsxs(l9t,{className:"salt-gap--2",children:[s.jsx(x,{fill:!0,intent:"secondary",onClick:l,"data-test":"delete-meal-cancel-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"meals.deleteMeal.cancelButton"})})}),s.jsx(x,{fill:!0,intent:"primary",onClick:c,loading:n,"data-test":"delete-meal-submit-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"meals.editMeal.deleteButton"})})})]})]})})},d9t=()=>{const e=F(),t=()=>{e(U.analyticsEvent({type:aY})),e(J.openModal("newMealModal"))};return s.jsx("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"no-meals-page",children:s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:10,sm:8,md:6,lg:4},colStart:{xs:2,sm:3,md:4,lg:5},children:s.jsx(Os,{image:"no_meals",description:"meals.empty.instructions",primaryButton:{text:"meals.empty.createFirstMealButton",onClick:t}})})})})},u9t=v(B.Footer)`
    flex-flow: column-reverse;

    ${re.smUp`
        flex-flow: row;
    `}
`,p9t=()=>{const e=Me($e("cancelEditMealModal")),t=Me(Yn("cancelEditMealModal"));return s.jsx(B,{isOpen:e,onRequestClose:t?.onCancel,maxWidth:"lg",children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"mealplanning.cancel-edit.title"})})}),s.jsx(B.Body,{children:s.jsx(b,{id:"mealplanning.cancel-edit.message"})}),s.jsxs(u9t,{className:"salt-gap--2",children:[s.jsx(x,{intent:"secondary",onClick:t?.onCancel,"data-test":"cancel-edit-meal-cancel-button",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"mealplanning.cancel-edit.cancel-button"})})}),s.jsx(x,{intent:"primary",onClick:t?.onConfirm,"data-test":"cancel-edit-meal-confirm-button",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"mealplanning.cancel-edit.confirm-button"})})})]})]})})},m9t=()=>{const e=Ne(),t=ws(),n=Me(Rt),o=Me(l9e),r=Me(c9e),a=Me(d9e),i=Me(u9e),l=Me(Tm),{sortBy:c}=ps.parse(e.search),d=c&&typeof c=="string"?c:"";return h.useEffect(()=>{n||t(GM(d))},[d]),h.useEffect(()=>{r&&t(U.analyticsEvent({type:zD,TOTAL_MEALS:a,TOTAL_SAVED_RECIPES:i,SORT:l}))},[r]),r?.length===0?s.jsx(d9t,{}):s.jsxs(ae.Fragment,{children:[s.jsx(Cae,{activeTabType:"MEALS"}),s.jsxs("div",{className:"salt-m-x--4 salt-p-t--4","data-test":"meals-page",children:[s.jsxs(V,{fixed:!0,flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsxs(Q,{justify:"space-between",children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(a9t,{})}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(s9t,{})}),s.jsx(i9t,{})]})}),s.jsx(V.Item,{colSpan:{xs:12},children:r&&s.jsx(e9t,{isFetching:o,meals:r})})]}),s.jsx(c9t,{}),s.jsx(p9t,{})]})]})};function bae(){return s.jsx(Et,{type:"Meals::route",children:s.jsx(m9t,{})})}bae.fetchData=async({context:{store:e,url:t}})=>{const n=t.searchParams.get("sortBy")??"";return await e.dispatch(GM(n)),Promise.resolve()};const y1=D(ok),h9t=e=>[{path:$T(),Component:$s(Xe,e.Main),children:[{index:!0,Component:as(y1,WQt,ot)}]},{path:FZ(),Component:$s(Xe,e.Main),children:[{index:!0,Component:as(y1,bae,ot)}]}],xae=({data:e})=>e.adverts.promotionDetailsPage,g9t=Y(xae,({isFetching:e,settings:t,placement:n})=>[n.aboveGrid||[],t,e]),E9t=()=>{const[e,t,n]=f(g9t);return!n&&e.length!==0?s.jsx(V,{children:s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:8,lg:9},children:s.jsx(Lm,{className:"salt-p-x--2 salt-p-t--4",adverts:e,advertDimensionsMap:ST,page:"promotion-details",pageKey:void 0,placement:"ABOVE_GRID",randomInitialIndex:t.randomizeInitialHorizontalAdvert,sizes:["LARGE","MEDIUM","SMALL"]})})}):null},f9t=se("GET_PROMOTION_DETAILS_PAGE_ADVERTS"),Aae=()=>({type:"API",payload:{url:"/v1/content?page=PROMOTION_DETAILS",...f9t}}),Rae=(e,t)=>{if(e.length===0||e[0]?.products.length===0)return{numberPromotionsAchieved:0,progressFractionString:"0/1",numberPromotionGroupProductsInBasket:[]};const n=e.reduce((c,d)=>c+d.quantity,0),o=e.map(c=>t.filter(d=>c.products.includes(d.productId)).reduce((d,u)=>d+u.quantity.quantityInBasket,0)),r=o.map((c,d)=>Math.floor(c/e[d].quantity)),a=Math.min(...r),l=o.map((c,d)=>c-a*e[d].quantity).map((c,d)=>Math.min(c,e[d].quantity)).reduce((c,d)=>c+d,0);return{numberPromotionsAchieved:a,progressFractionString:`${l}/${n}`,numberPromotionGroupProductsInBasket:o}},Ii={UNACHIEVABLE:"UNACHIEVABLE",ZERO:"ZERO",PROGRESS:"PROGRESS",COMPLETED:"COMPLETED"},y9t=(e,t,n)=>n?Ii.UNACHIEVABLE:t.startsWith("0/")?e===0?Ii.ZERO:Ii.COMPLETED:Ii.PROGRESS,I9t=(e,t,n,o)=>o?n.unachievable:e===0?n.unachieved:t.startsWith("0/")?n.achievedExact:n.unachieved,S9t=(e,t)=>e===0||e===1&&t===Ii.COMPLETED,C9t=({achievedNumber:e,progressFraction:t,promotionItems:n,productsByProductId:o,unachievable:r,isBundlePromotion:a,stickyBottom:i=!1})=>{const l=L(),c=F(),d={unachieved:l.formatMessage("promotion.details.status.unachieved"),achievedExact:l.formatMessage("promotion.details.status.achieved"),achievedStatus:l.formatMessage("promotion.details.number.of.promotions.achieved",{number:e}),unachievable:l.formatMessage("promotion.details.status.unavailable")},u=y9t(e,t,r),p=S9t(e,u)?"":d.achievedStatus,g=I9t(e,t,d,r),E=()=>{const S=Object.values(o).map((C,T)=>({product:C,position:T+1,page:"OFFERS"}));c(U.analyticsEvent({type:ls.ADD_ALL_TO_TROLLEY_BUTTON_CLICKED})),c(ir.addMultipleItemsToBasketAtOnce(n,S))},y=()=>{switch(u){case Ii.UNACHIEVABLE:return s.jsx(pe,{name:"close_default",height:24,width:24});case Ii.ZERO:return s.jsx(pe,{name:"trolley",height:24,width:24});case Ii.COMPLETED:return null;case Ii.PROGRESS:return s.jsx(O,{bold:!0,size:"l","data-test":"progress-status",children:t});default:return s.jsx(pe,{name:"trolley",height:24,width:24})}},I=u===Ii.COMPLETED;return s.jsxs(Q,{direction:"column","data-test":"promotion-options",children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"offer.details.bundle.status.accessibility.heading"})})}),s.jsx("div",{role:"status","aria-atomic":"true","aria-live":"polite",children:I?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:g}),s.jsx(ie,{children:p})]}):s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:t}),s.jsx(ie,{children:g}),s.jsx(ie,{children:p})]})}),s.jsxs(xe,{condensed:i,children:[s.jsx(ra,{status:g,achievedStatus:p,progressFraction:t,completed:I,ringContent:y()}),!r&&a&&s.jsx(x,{className:"salt-m-t--4",fill:!0,intent:"action",onClick:E,"data-test":"add-bundle-items",children:s.jsx(x.Text,{children:s.jsx(b,{id:"promotion.details.bundle.button.addAll"})})})]})]})},v9t=v("div")`
    ${re.mdUp`
    position: sticky;
    top: ${({stickyTopGap:e=0})=>e}px;
`}
`,I1=({stickyBottom:e=!1})=>{const t=Ne(),n=F(),[o]=Ee(["w.bp"]),r=f(_l),a=f(Ec),i=f(ts),[l,c]=h.useState(0),[d,u]=h.useState("0/1"),p=Bn(l),g=a.promotionPageType==="COMBINATION",E=a.promotionPageType==="BUNDLE"&&o,y=()=>a.promotionGroups.every(C=>C.products.some(T=>{const _=i[T];return _&&_.available}));h.useEffect(()=>{const C=Rae(a.promotionGroups,r);c(C.numberPromotionsAchieved),u(C.progressFractionString)},[t.search,a,r]),h.useEffect(()=>{a.promotionPageType==="COMBINATION"&&l>0&&l>p&&n(U.analyticsEvent({type:Va.COMBO_PROMO_COMPLETED,promoPageId:a.promoId}))},[l]);const[I,S]=h.useState(void 0);if(h.useEffect(()=>{const C=()=>{const T=document.getElementById("main-header")?.offsetHeight||0;S(T+20)};return C(),window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C)}},[]),E||g){const T=y()&&a.promotionGroups.length>0,_=a.promotionGroups.map(A=>({productId:A.products[0],quantity:A.quantity}));return s.jsx(v9t,{stickyTopGap:I,className:e?"":"salt-p-x--2 salt-m-b--4",children:s.jsx(C9t,{achievedNumber:l,progressFraction:d,productsByProductId:i,unachievable:!T,isBundlePromotion:E??!1,promotionItems:_,stickyBottom:e})})}return null},tR=({group:e,onInitialFopLoad:t})=>{const n=f(SN),o=f(Ec),r=f(ts),[a]=Ee(["w.bp"]),i=()=>o.promotionGroups.length>1,l=()=>o.promotionPageType==="BUNDLE"&&a;return e?s.jsxs("div",{className:"salt-m-x--2",children:[(!i()||l())&&s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"offer.details.page.products.list.title"})})}),s.jsx(uo,{productsByProductId:r,productGroups:Array.isArray(e)?e:[e],page:"promotion-details",type:"catalogue",isFetching:n,onInitialFopLoad:t,noOfferLink:!0,withoutHeader:!0})]}):null},T9t=({group:e,index:t,onInitialFopLoad:n})=>{const o=F(),r=f(Ec),a=f(ts),i=f(_l),l=f(SN),c=(g,E,y)=>{const{quantity:I}=g,S=g.displayDetails&&g.displayDetails.displayName?g.displayDetails.displayName:void 0,C=I>E?I-E:0,T=R=>s.jsx(h.Fragment,{children:s.jsx(b,{id:R,values:{quantity:I,groupName:S,count:C}})}),_=R=>s.jsxs(Q,{align:"center",gap:["sm"],as:"span",children:[s.jsx(pe,{name:"tick",verticalAlign:"middle",success:!0}),s.jsx(b,{id:R,values:{groupName:S,count:I}})]});return C===0?_(y?"promotion.details.group.title.with.name.all.items.added":"promotion.details.group.title.all.items.added"):T(y?"promotion.details.group.title.with.name":"promotion.details.group.title")},d=g=>g.every(E=>E.displayDetails&&E.displayDetails.displayName&&E.displayDetails.displayName!==""),u=c(e,Rae(r.promotionGroups,i).numberPromotionGroupProductsInBasket[t],d(r.promotionGroups)),p=(g,E)=>{o(g?U.analyticsEvent({type:Va.COMBO_PROMO_ACCORDION_COLLAPSED,productGroupSequence:E}):U.analyticsEvent({type:Va.COMBO_PROMO_ACCORDION_EXPANDED,productGroupSequence:E}))};return s.jsx(V,{className:"salt-m-t--0",children:s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:u})}),s.jsxs(rs,{children:[s.jsx(rs.Title,{active:!0,"data-test":"offer-details-group-description",onActiveToggle:g=>p(g,t),children:u}),s.jsx(rs.Content,{active:!0,children:s.jsx(uo,{productsByProductId:a,productGroups:Array.isArray(e)?e:[e],page:"promotion-details",type:"catalogue",isFetching:l,onInitialFopLoad:n,noOfferLink:!0,withoutHeader:!0})})]})]})})},S1=({group:e,numberOfGroups:t,onInitialFopLoad:n})=>{const r=e.reward&&e.reward.type==="free"&&t>1?s.jsx(b,{id:"offer.details.group.free",values:{count:e.quantity}}):s.jsx(b,{id:"offer.details.group.any",values:{count:e.quantity}});return s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-y--2","data-test":"offer-details-group",children:s.jsx(V,{children:s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:r})}),s.jsx(Te,{intent:"info","data-test":"offer-details-group-description","data-test-type":"info",text:r,showIcon:!1})]})})}),s.jsx(tR,{group:e,onInitialFopLoad:n})]})},_9t=({onInitialFopLoad:e})=>{const{promotionGroups:t,promotionPageType:n}=f(Ec),[o]=Ee(["w.bp"]),r=n==="BUNDLE"&&o,a=n==="COMBINATION",i=t.length>1,l=()=>t.length===1&&t[0]?.quantity===1,c=(d,u)=>`${d.products.reduce((g,E)=>g.concat(E),"")}-${u}`;return r?s.jsx(tR,{group:t,onInitialFopLoad:e}):a?s.jsx(ae.Fragment,{children:t.map((d,u)=>s.jsx(T9t,{group:d,index:u,onInitialFopLoad:e},c(d,u)))}):i?s.jsx(ae.Fragment,{children:t.map((d,u)=>s.jsx(S1,{group:d,numberOfGroups:t.length,onInitialFopLoad:e},c(d,u)))}):l()?s.jsx(tR,{group:t[0],onInitialFopLoad:e}):s.jsx(ae.Fragment,{children:t.map((d,u)=>s.jsx(S1,{group:d,numberOfGroups:t.length,onInitialFopLoad:e},c(d,u)))})},b9t=({sortOption:e,category:t})=>{const n=Ne(),o=Ge(),[r]=Ee(["w.bp"]),a=f(Ec),i=()=>a.promotionPageType==="BUNDLE"&&r,l=({paramCategory:d=t,paramSortOption:u=e})=>{const p=Qe.stringify({sublocationId:d,sortBy:u}),g=`${n.pathname}?${p}`;return o(g)},c=d=>{l({paramSortOption:d?.id})};return i()?null:s.jsxs(h.Fragment,{children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx("div",{className:"salt-d--inline-block salt-m-b--4 salt-m-l--2",children:s.jsx(kk,{options:a.sortOptions,sortHandler:c,selectedId:e})})}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx("div",{className:"salt-d--inline-block salt-m-b--4 salt-m-l--2",children:s.jsx(jk,{options:a.sortOptions,sortHandler:c,selectedId:e})})})]})},C1=D("seo.rdbl"),x9t=D("seo.ra"),A9t=D("bt.top"),R9t=({result:e,entities:t})=>e.promotionGroups.every(n=>n.products.some(o=>{const r=t[o];return r&&r.available})),v1=e=>e.find(t=>t.selected)?.id,D9t=()=>{const e=L(),t=F(),n=Ne(),o=nn(),r=gH(qa(":offerId",":offerName")),[a,i,l,c]=Ee(["seo.rdbl","dso","seo.ra","w.bp"]),d=f(SN),u=f(Rt),p=f(J6),g=f(ts),E=f(Ec),y=f(xae),I=f(A9t),S=h.useRef(!1),[C,T]=h.useState(void 0),[_,A]=h.useState(void 0),R=Bn(n.search),P=Bn(o.offerId);h.useEffect(()=>{const{sortBy:K}=Qe.parse(n.search);!d&&(typeof K=="string"||typeof K>"u")&&(u&&!p?(M(),w()):j(i?K:C),N())},[]),h.useEffect(()=>{const K=Qe.parse(n.search),{sublocationId:X,sortBy:q}=K,ne=q||v1(E.sortOptions)||void 0,ue=typeof ne=="string"||typeof ne>"u",oe=typeof X=="string"||typeof X>"u";ue&&ne!==C&&T(ne),oe&&X!==_&&A(X);const ye=n.search!==R&&R!==void 0,he=o.offerId!==P&&P!==void 0;(ye||he)&&ue&&j(ne)},[n.search,o.offerId,E]);const N=()=>{const{lastUpdated:K}=y;!d&&!K&&t(Aae())},k=()=>{S.current||(t(ds({name:oAe})),S.current=!0)},M=(K=E)=>{t(U.analyticsEvent({type:Va.VIEW_PROMOTION_DETAILS,name:K.description,promotionType:K.promotionPageType,retailerPromotionId:K.retailerPromotionId}));const X={event:"view_promotion_details",id:K.retailerPromotionId,type:K.promotionPageType,name:K.description};te.sendEvent({GA:X,WA:null})},w=(K=E,X=g)=>{const q=K.promotionGroups.filter(ue=>ue.quantity>0).length,ne=K.promotionGroups.reduce((ue,oe)=>oe.quantity+ue,0);t(U.analyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{PROMO_PAGE_ID:K.promoId,PROMO_PRODUCT_GROUP_REQUIRED:q,PROMO_PRODUCT_REQUIRED:ne,PROMO_PAGE_TEXT:K.description,PROMO_PAGE_SORT:v1(K.sortOptions),PROMO_AVAILABLE:R9t({result:K,entities:X}),PROMO_TYPE:K.promotionPageType,PRESENTATION_MODE:K.presentationMode}}))},j=K=>{if(!o.offerId)return;const X=!!l;t(Mee.getPromotionDetails(o.offerId,X,K,_)).then(q=>{M(q.result),w(q.result,q.entities.product)}).catch(q=>{Ue.api.pushError(q instanceof Error?q:new Error(`getPromotionDetails error: ${JSON.stringify(q)}`))})},G=()=>(l?E.retailerPromotionId:E.promoId)===o.offerId,W=()=>E.description&&o.offerName&&Cn(E.description).toLowerCase()===o.offerName.toLowerCase();if(!a&&r)return s.jsx(ot,{});if(!d&&p)return p.statusCode===404?s.jsx(ot,{}):s.jsx(jn,{statusCode:p.statusCode});if(!G())return s.jsx("div",{className:"salt-m-x--2",children:s.jsx(uo,{productsByProductId:{},productGroups:[],page:"promotion-details",type:"catalogue",isFetching:!0,noOfferLink:!0,withoutHeader:!0})});if(a&&(!W()||!r)){const{description:K,promoId:X,retailerPromotionId:q}=E;return s.jsx(En,{to:qa(l?q:X,Cn(K.toLowerCase()))})}const H=E.promotionPageType==="COMBINATION"||E.promotionPageType==="BUNDLE"&&c;return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"offer.details.page.title",values:{offerDescription:E.description,separator:e.formatMessage("page.title.separator")},seoFriendlyMeta:{pageDescription:E.description,metaDescriptionTagline:"promotion.details.meta.descriptionTagline"}}),s.jsx(E9t,{}),s.jsx(sn,{children:s.jsx(V,{children:s.jsxs(V.Item,{colSpan:{xs:12},children:[s.jsx(ee,{as:"h1",children:s.jsxs(Q,{as:O,gap:["sm"],align:"center","data-test":"offer-details-description",children:[s.jsx(pe,{name:"promotion","data-test":"icon__promotion-heading",height:21,width:21,verticalAlign:"middle"}),s.jsx(ee,{as:"span",children:E.description})]})}),s.jsx(O,{size:"m",children:E.longDescription})]})})}),s.jsxs(V,{className:"salt-m-t--0",children:[s.jsxs(V.Item,{colSpan:H?{xs:12,sm:12,md:8,lg:9}:{xs:12},children:[s.jsx(b9t,{sortOption:C,category:_}),s.jsx(_9t,{onInitialFopLoad:k})]}),s.jsxs(V.Item,{colSpan:{xs:12,sm:12,md:4,lg:3},children:[H&&s.jsx(vE,{renderTo:"#StickyPromotionOptionsAchieved",children:s.jsx(Lt,{breakpoint:"md-up",remainInDom:!1,children:s.jsx(SE,{light:!0,children:s.jsx(I1,{stickyBottom:!0})})})}),s.jsx(Kt,{breakpoint:"md-up",remainInDom:!1,children:s.jsx(I1,{})})]})]}),I&&s.jsx(Du,{})]})},Dae=()=>s.jsx(Et,{type:"PromotionDetails::route",children:s.jsx(D9t,{})});Dae.fetchData=async({store:e,req:t,params:n})=>{const o=e.getState(),r=n.offerId,[a,i]=t.url.split("?"),l=decodeURIComponent(a),c=i?.length?l.concat("?",i):l,d=x9t(o);if(d){await e.dispatch(async P=>P(yi.getPromotionIds(r)));const S=e.getState(),{promoId:C,description:T,retailerPromotionId:_}=Ec(S),A=r===C&&!!_,R=C1(o)?T.toLowerCase():void 0;if(A){const P=At(S),N=qa(_,R,{basePath:P,queryString:i});return Promise.resolve({redirectTo:N,statusCode:Go.MOVED_PERMANENTLY})}}const{sublocationId:u,sortBy:p}=t.query,g=typeof p=="string"?p:void 0,E=typeof u=="string"?u:void 0;await Promise.all([e.dispatch(Mee.getPromotionDetails(r,d,g,E)),e.dispatch(Aae())]);const y=e.getState(),I=J6(y);if(C1(y)&&!I){const{description:S}=Ec(y),C=Cn(S.toLocaleLowerCase()),T=qa(r,C,{queryString:i});if(c.toLowerCase()!==T.toLowerCase()){const _=At(y),A=qa(r,C,{basePath:_,queryString:i});return Promise.resolve({redirectTo:A,statusCode:Go.MOVED_PERMANENTLY})}}return Promise.resolve()};const O9t=e=>[{path:"/offers/:offerName?/:offerId",Component:e.Main,key:"main",children:[{index:!0,Component:Dae}]}],Oae={cancelable:!0,appliedVouchers:[]},lr=m.shape({orderId:m.string,bannerId:m.string,orderReference:m.string,slotId:m.string,primarySellerId:m.string,primarySellerName:m.string,orderTotals:m.shape({retailPrice:ze,finalPrice:ze,promoSavings:ze,totalSavings:ze}),totalItems:m.number,items:m.array,dates:m.shape({deliveryStartDate:m.string.isRequired,deliveryEndDate:m.string.isRequired,confirmOrderChangesBy:m.string.isRequired,timeZoneId:m.string.isRequired}),charges:m.shape({delivery:ze,carrierBag:ze}),orderLevelPromotions:m.arrayOf(m.shape()),addressId:m.string,address:m.string,addressNickName:m.string,additionalInformation:m.string,status:m.string,cancelable:m.bool,editStatus:m.string,appliedVouchers:m.arrayOf(m.shape({id:m.string.isRequired,savings:ze})),paymentInfo:m.shape({paymentMethod:m.string,cardType:m.string,lastFourDigits:m.string,nonSavedFundingInstrument:m.bool}),hasReceipt:m.bool,external:m.bool.isRequired,recurringShoppingDefinition:m.shape({name:m.string.isRequired,frequency:m.shape({unit:m.string.isRequired,value:m.number.isRequired}).isRequired,deliveryWindow:m.shape({to:m.string.isRequired,from:m.string.isRequired,day:m.string.isRequired,dayOfWeekIso:m.number.isRequired}).isRequired}),deliveryInfo:m.shape({currentState:m.string,deliveryState:m.shape({status:m.string,estimatedTimeArrival:m.string})}),billingAddressDetails:m.shape({billingAddressId:m.string,customerId:m.string,bannerId:m.string,status:m.string,customerDetails:m.shape({fullName:m.string,taxNumber:m.string}),addressDetails:m.shape({addressLine1:m.string,addressLine2:m.string,city:m.string,administrativeArea:m.string,postalCode:m.string}),createdTimestamp:m.string})}),Pae=se("CART_BUY_AGAIN"),P9t=({orderId:e,emptyCart:t})=>({type:"API",payload:{url:Qe.stringifyUrl({url:"/v1/carts/active/buy-again",query:{...t&&{emptyCart:t}}}),pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",options:{body:{orderId:e},method:"POST"},...Pae}}),N9t={buyAgain:P9t,types:{CART_BUY_AGAIN:Pae}},L9t=({buyAgainResult:e,emptyCart:t})=>async(n,o)=>{if(!e)return;const r=o(),a=Qs(r),i=r?.data?.basket,l=t?i?.items:[];let c=[],d=[];const u=e?.addedItems||[],p=[...new Set([...l?.map(E=>({id:E?.productId}))||[],...u?.map(E=>({id:E?.productId}))||[]])];if(!p?.length)return;let g=null;try{g=(await n(ai({products:p,ignoreProductCache:!0})))?.payload?.product??null}catch{g=null}if(g&&(c=l?.map(E=>({...g?.[E.productId],...E})),d=u?.map(E=>({...g?.[E.productId],...E})),d?.length||c?.length)){n(U.analyticsEvent({type:Gs.BUY_ALL_PRODUCTS,product:d,productsRemoved:c,basketFinalPrice:e?.cartFinalPrice,addedByFunction:"ORDERS_ADD_ALL",page:"order-details"}));const E=wv({products:d,addedByFunction:"ORDERS_ADD_ALL",page:"order-details",basket:i});te.sendEvent({GA:E,WA:null}),n(U.analyticsEvent({type:Re.ADD_TO_CART_GA4,basket:i,page:"ORDER_DETAILS",addedByFunction:"ORDERS_ADD_ALL",product:d,productListName:"order-details: other"})),Fv({basket:i,page:"ORDER_DETAILS",addedByFunction:"ORDERS_ADD_ALL",products:d,productListName:"order-details: other",featuredProductCampaigns:a}).forEach(I=>{te.sendEvent({GA:I,WA:null})})}},k9t=({orderId:e,emptyCart:t,navigate:n})=>async o=>{let r=null;try{r=(await o(N9t.buyAgain({orderId:e,emptyCart:t})))?.payload?.responseData}catch(i){throw Z.error("toast.notification.generic.error"),i}await o(L9t({buyAgainResult:r,emptyCart:t}));const a=r?.limitedItems||[];return a?.length?(await o(Yt.getBasket()),o(yr.setMergeResult({limitedItems:a,destination:jt()})),o(J.closeModal()),o(J.openModal(gf))):(o(J.closeModal()),n(jt())),r},Nae={buyAgain:k9t},$M="buyAgain",j9t=D("m.la.h"),M9t={isOpen:m.bool.isRequired,isBasketUnderEdit:m.bool.isRequired,buyAgainAction:m.func.isRequired,order:lr.isRequired,actions:m.shape({prepareCheckout:m.func.isRequired,closeModal:m.func.isRequired}).isRequired,modalLeftAlignEnabled:m.bool},w9t={modalLeftAlignEnabled:!1},T1={basketUnderEdit:{header:"order.buy.again.under.edit.modal.title",body:"order.buy.again.under.edit.modal.text",cancelChanges:"order.buy.again.under.edit.modal.cancel",saveChanges:"order.buy.again.under.edit.modal.ok"},basketHasItems:{header:"order.buy.again.modal.title",body:"order.buy.again.modal.text",cancelChanges:"order.buy.again.modal.empty",saveChanges:"order.buy.again.modal.keep"}},HM=({actions:e,isBasketUnderEdit:t,isOpen:n,order:o,buyAgainAction:r,modalLeftAlignEnabled:a})=>{const[i,l]=h.useState(!1),{orderId:c}=o,d="buy-again-modal-header",u=t?T1.basketUnderEdit:T1.basketHasItems,p=()=>(l(!0),r({orderId:c,emptyCart:!1}));return s.jsxs(B,{isOpen:n,onRequestClose:e.closeModal,aria:{labelledby:d},children:[s.jsx(B.Header,{align:a?"left":"center",children:s.jsx(ee,{as:"h2",id:d,children:s.jsx(Nt,{id:u.header})})}),s.jsx(B.Body,{children:s.jsx(Nt,{id:u.body})}),s.jsx(B.Footer,{className:"salt-d--block",align:a?"left":"center",children:s.jsxs(V,{flush:!0,children:[t&&s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{className:"salt-m-t--4",fill:!0,intent:"secondary",onClick:e.closeModal,"data-test":"buy-again-modal-under-edit-dismiss",children:s.jsx(x.Text,{children:s.jsx(Nt,{id:u.cancelChanges})})})}),!t&&s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{className:"salt-m-t--4",fill:!0,intent:"secondary",onClick:()=>r({orderId:c,emptyCart:!0}),"data-test":"buy-again-modal-dismiss",children:s.jsx(x.Text,{children:s.jsx(Nt,{id:u.cancelChanges})})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx(x,{className:"salt-m-t--4",fill:!0,intent:"primary",onClick:p,"data-test":"buy-again-modal-confirm",loading:i,children:s.jsx(x.Text,{children:s.jsx(Nt,{id:u.saveChanges})})})})]})})]})};HM.propTypes=M9t;HM.defaultProps=w9t;const F9t=e=>({isOpen:$e($M)(e),isBasketUnderEdit:Ar(e),modalLeftAlignEnabled:j9t(e)}),B9t=st({prepareCheckout:lf,closeModal:J.closeModal}),Lae=we(F9t,B9t)(HM),U9t={order:lr.isRequired,itemsCount:m.number.isRequired},{openModal:G9t}=J,kae=({order:e,itemsCount:t})=>{const n=Ge(),{formatMessage:o}=L(),r=F(),a=f(Hi),i=f(Tl),l=f(sa),c=f(bP),d=()=>{r(G9t($M))},u=({orderId:y,emptyCart:I})=>{r(Nae.buyAgain({orderId:y,emptyCart:I,navigate:n}))},p=()=>a?d():u({orderId:e.orderId}),g=()=>i==="STORE"&&e.retailerRegionId!==l,E=()=>c?"order.details.rebook":"order.again.repeat.order.button.text";return s.jsx("div",{children:!g()&&s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"action",fill:!0,onClick:p,"data-test":"buy-again-button","aria-label":o("order.again.repeat.order.button.accessibility.text",{itemsCount:t}),children:s.jsx(x.Text,{children:s.jsx(Nt,{id:E()})})}),s.jsx(Lae,{order:e,buyAgainAction:u})]})})};kae.propTypes=U9t;const $9t=(e,t,n,o)=>{const r=new Map(t.filter(g=>g!==void 0).map(g=>[g.sellerId,g.sellerName])),a=g=>g.sellerId,i=e.products&&Eh(e.products,a,r,n)||new Map,l=e.substitutes&&Eh(e.substitutes,a,r,n)||new Map,c=e.missings&&Eh(e.missings,a,r,n)||new Map,d=e.returns&&Eh(e.returns,a,r,n)||new Map,u=[...new Set([Array.from(i.keys()),Array.from(l.keys()),Array.from(c.keys()),Array.from(d.keys())].flat())],p=new Map(u.map(g=>[g,{products:i.get(g)||[],substitutes:l.get(g)||[],missings:c.get(g)||[],returns:d.get(g)||[]}]));return Cte(p,n,o)},H9t=(e,t,n)=>{const o=i=>i.product.seller?.id,r=new Map(e.map(i=>i.product.seller).filter(i=>i!==void 0).map(i=>[i.id,i.name])),a=Eh(e,o,r,t);return Cte(a,t,n)},Eh=function(t,n,o,r){const a=new Map;return t.forEach(i=>{const[l,c]=V9t(i,n,o,r);let d=a.get(c.sellerName);d||(d=[]),d.push(l),a.set(c.sellerName,d)}),a},V9t=function(t,n,o,r){const a=n(t),i=a&&o.get(a);return!a||!i?[t,r]:[t,{sellerId:a,sellerName:i}]},W9t=v.div`
    inline-size: 100%;
    border: none;
    display: flex;
    align-items: flex-start;
    flex-direction: column;
    margin-block: 0 var(--salt-spacing-8);
    margin-inline: 0;
`,Y9t=v.div`
    inline-size: 100%;
`,jae=({sellerName:e,children:t})=>s.jsxs(W9t,{"data-test":`seller-group-${Pi(e)}`,children:[s.jsx(tl,{groupName:e,className:"salt-d--block salt-m-y--2"}),s.jsx(Y9t,{children:t})]}),q9t={order:m.shape({lastUpdated:m.number,isFetching:m.bool,error:m.shape({statusCode:m.number}),order:lr}).isRequired,items:m.arrayOf(m.shape({product:sl,sample:m.bool,quantity:m.number,isInCurrentCatalog:m.bool})),loading:m.bool,locale:m.string.isRequired},K9t={items:[],loading:!1},VM=e=>{const{order:t,items:n,loading:o,locale:r}=e,[a]=Ee(["or.sg"]);f(D("ubd"));const i=()=>n?n.reduce((u,p)=>u+p.quantity,0):0,l=()=>{const u=i();return s.jsx(cs,{children:s.jsxs("div",{children:[s.jsx(Q,{align:"left",children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"order.again.repeat.order.title",values:{itemsCount:u}})})}),s.jsx(le.Buttons,{loading:o,children:s.jsx("div",{className:"salt-p-t--4",children:s.jsx(kae,{order:t.order,itemsCount:u})})})]})})},c=u=>{const p=u&&u.length>0&&u.every(I=>I.product),g=()=>u.reduce((I,S)=>(S?.sample===!0?I.sampleProducts.push(S.product.productId):I.normalProducts.push(S.product.productId),I),{sampleProducts:[],normalProducts:[]}),E=()=>{const{sampleProducts:I,normalProducts:S}=g();return[...I,...S]},y=p?u.reduce((I,S)=>(S.product&&(I[S.product.productId]={...S.product,quantityInOrder:S.quantity,isInCurrentCatalog:S.isInCurrentCatalog}),I),{}):{};return s.jsx(uo,{productGroups:[{products:E()}],productsByProductId:y,page:"order-again",type:"order",isFetching:t.isFetching,"data-test":"order-again-products-container"},p)},d=(u,p)=>H9t(u,p,r).map(({sellerName:E,products:y})=>s.jsx(jae,{sellerName:E,children:c(y)}));if(!t.error&&t.lastUpdated&&!t.isFetching){const u=t.order.dates.confirmOrderChangesBy,p=!u||Pd(Ni(),u);return s.jsxs(V,{className:"md:salt-m-x--4 md:salt-p-x--2 salt-m-x--0",children:[s.jsx(V.Item,{colSpan:{xs:12,md:8},children:s.jsxs("div",{className:"salt-m-y--4",children:[p&&s.jsx(Te,{className:"salt-m-b--4",intent:"info",text:s.jsx(b,{id:"order.again.prices.info.alert"})}),s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),a&&t.order&&t.order.primarySellerId&&t.order.primarySellerName?d(n,{sellerId:t.order.primarySellerId,sellerName:t.order.primarySellerName}):c(n)]})}),s.jsx(V.Item,{colSpan:{xs:12,md:4},children:s.jsx("div",{className:"salt-m-y--4",children:l()})})]})}return null},z9t=e=>({locale:Ms(e),order:As(e),items:r2e(e)});VM.propTypes=q9t;VM.defaultProps=K9t;const Q9t=Tt(Ht,we(z9t))(VM),sR={DELIVERED:"DELIVERED",PICKED:"PICKED"},X9t=Y(e=>e.data.orders.current,e=>e.refunds),__=Y(X9t,e=>e.createdRefundRequest),Z9t=Y(__,e=>e.fetchError),WM=Y(__,e=>e.requestedItems),J9t=Y(__,e=>e.newRefundRequestCreationCutoff),e7t=Y(__,e=>e.anyItemAvailableForRefund),t7t=e=>`${lo()}/${e}/refund-request`,s7t=({creationCutoffInformation:e,refundButton:t,orderId:n})=>s.jsxs(ae.Fragment,{children:[s.jsx(O,{className:"salt-m-b--4 salt-d--inline-block","data-test":"refund-request-creation-cutoff",children:e}),s.jsx(x,{asChild:!0,intent:"secondary",fill:!0,children:s.jsx(tt,{"data-test":"refund-request-button",intent:"ghost",href:t7t(n),children:s.jsx(x.Text,{children:t})})})]}),n7t=e=>e.orderParams.isCutoffTimeExceeded?o7t(e):r7t(e),o7t=e=>s.jsx(Te,{text:e.messages.cutoffTimeExceeded,intent:"info","data-test":"cutoff-time-exceeded"}),r7t=e=>e.orderParams.anyItemAvailableForRefund?s.jsx(s7t,{creationCutoffInformation:e.messages.creationCutoffInformation,refundButton:e.messages.refundButton,orderId:e.orderParams.orderId}):s.jsx(Te,{"data-test":"refund-request-no-refundables-available",text:e.messages.noMoreRefundablesAvailable,intent:"info"}),a7t=({cutoffTime:e,orderTimeZone:t})=>{const n=f(Zt),o=f(Mt);return s.jsx(Gl,{dateIso:ad(e,t),dateFormat:n,timeFormat:o,timeZoneId:t,local:!0})},i7t=(e,t,n)=>({creationCutoffInformation:e.formatMessage("order.details.refund-request-card.cutoff-information",{date:a7t({cutoffTime:t,orderTimeZone:n})}),refundButton:e.formatMessage("order.details.refund-request-card.button"),refundRequestNotYetAvailable:e.formatMessage("order.details.requested-for-refund.not-yet-available"),noMoreRefundablesAvailable:e.formatMessage("order.details.refund-request-card.all-products-refunded-or-requested"),cutoffTimeExceeded:e.formatMessage("order.details.refund-request-card.cutoff-expired"),refundRequestUnavailable:e.formatMessage("order.details.refund-request-card.refund-request-unavailable")});m.string.isRequired,m.bool.isRequired,m.bool.isRequired,m.any.isRequired,m.string.isRequired,m.string.isRequired,m.string.isRequired,m.bool.isRequired;const l7t=({intl:e,refundRequestCreationCutoff:t,orderTimeZone:n,orderId:o,anyItemAvailableForRefund:r,isCutoffTimeExceeded:a,isFetchingRefundStatusFailed:i,orderStatus:l})=>{const c=i7t(e,t,n);return{refundRequestOnDeliveredParams:c7t(c,o,r,a),cardInformationParams:{isFetchingRefundStatusFailed:i,orderStatus:l,messages:c}}},c7t=(e,t,n,o)=>({messages:e,orderParams:{orderId:t,anyItemAvailableForRefund:n,isCutoffTimeExceeded:o}}),d7t=({isCutoffTimeExceeded:e,orderStatus:t,anyItemAvailableForRefund:n,intl:o,refundRequestCreationCutoff:r,orderTimeZone:a,orderId:i,isFetchingRefundStatusFailed:l})=>{const{refundRequestOnDeliveredParams:c,cardInformationParams:d}=l7t({intl:o,refundRequestCreationCutoff:r,orderTimeZone:a,orderId:i,anyItemAvailableForRefund:n,isCutoffTimeExceeded:e,isFetchingRefundStatusFailed:l,orderStatus:t});return u7t(d,c)},u7t=(e,t)=>e.isFetchingRefundStatusFailed?s.jsx(Te,{text:e.messages.refundRequestUnavailable,intent:"info","data-test":"refund-request-unavailable"}):e.orderStatus===sR.DELIVERED?n7t(t):s.jsx(Te,{className:"salt-m-t--2",intent:"info",text:e.messages.refundRequestNotYetAvailable,"data-test":"refund-request-creation-not-available-yet"}),p7t=()=>{const{formatMessage:e}=L();return s.jsxs(xe,{"data-test":"refund-request-card",className:"salt-m-b--4",children:[s.jsx(ee,{"data-test":"refund-request-card-header",as:"h2",children:e("order.details.refund-request-card.title")}),s.jsx(Te,{text:e("order.details.refund-request-card.refund-request-unavailable"),intent:"info","data-test":"refund-request-unavailable"})]})},m7t={intl:m.any.isRequired,refundRequestCreationCutoff:m.string.isRequired,orderDeliveryStartDate:m.string.isRequired,orderId:m.string.isRequired,orderStatus:m.string.isRequired,isExternal:m.bool.isRequired,isFetchingRefundStatusFailed:m.bool.isRequired,orderTimeZone:m.string.isRequired,formattedMessages:m.shape({cardHeader:m.string,refundButton:m.string,cutoffTimeExceeded:m.string}),isAnyItemAvailableForRefund:m.bool.isRequired},h7t={formattedMessages:{}},YM=e=>{const{refundRequestCreationCutoff:t,orderDeliveryStartDate:n,orderId:o,orderStatus:r,isExternal:a,isFetchingRefundStatusFailed:i,formattedMessages:l,intl:c,isAnyItemAvailableForRefund:d,orderTimeZone:u}=e,p=Vt().isAfter(t),g={...l,cardHeader:c.formatMessage("order.details.refund-request-card.title"),refundButton:c.formatMessage("order.details.refund-request-card.button"),refundRequestNotYetAvailable:c.formatMessage("order.details.requested-for-refund.not-yet-available"),noMoreRefundablesAvailable:c.formatMessage("order.details.refund-request-card.all-products-refunded-or-requested")};return!(r===sR.DELIVERED||r===sR.PICKED&&Vt().isSameOrAfter(n))||a?null:s.jsxs(xe,{"data-test":"refund-request-card",className:"salt-m-y--4",children:[s.jsx(ee,{"data-test":"refund-request-card-header",as:"h2",children:g.cardHeader}),s.jsx(d7t,{orderStatus:r,anyItemAvailableForRefund:d,isFetchingRefundStatusFailed:i,intl:c,isCutoffTimeExceeded:p,refundRequestCreationCutoff:t,orderId:o,orderTimeZone:u})]})},g7t=e=>({refundRequestCreationCutoff:J9t(e),isFetchingRefundStatusFailed:Z9t(e),isExternal:PE(e),isAnyItemAvailableForRefund:e7t(e)});YM.propTypes=m7t;YM.defaultProps=h7t;const Mae=Tt(we(g7t),uv("refunds:refund-request-card",s.jsx(p7t,{})))(YM),wae=m.shape({itemId:m.string,productId:m.string,displayPrice:m.shape({amount:ze,averageHint:m.bool}),availableQuantity:m.number,availableRefundables:m.arrayOf(m.shape({refundableId:m.string,refundableAmount:ze}))}),Fae=m.shape({itemId:m.string,productId:m.string,displayPrice:m.shape({amount:ze,averageHint:m.bool}),requestedQuantity:m.number,requestedRefundableIds:m.arrayOf(m.string),refundReason:m.shape({categoryDescription:m.string,reasonDescription:m.string,reasonNote:m.string}),status:m.string,rejectionReasonNote:m.string}),E7t=D("seo.rdbl"),f7t=D("refunds.netgross"),y7t={intl:m.any.isRequired,type:m.string.isRequired,orderId:m.number,actions:m.shape({analyticsEvent:m.func.isRequired,openRefundItemModal:m.func.isRequired,openRefundRequestItemDetailsModal:m.func.isRequired,setActiveBop:m.func.isRequired}).isRequired,product:sl,refundable:m.oneOfType([wae,Fae]),selectedItemData:m.shape({itemId:m.string,selectedQuantity:m.number}),tileEnabled:m.bool,position:m.number,messages:m.shape({detailsButton:m.string,requestRefundButton:m.string,selectedButton:m.string,averagePriceMessage:m.string,acceptedRefund:m.string,rejectedRefund:m.string,pendingRefund:m.string}),isSEOReadableURLEnabled:m.bool,isRefundsNetGrossEnabled:m.bool,fopProps:m.shape({name:m.string,productId:m.string,active:m.bool,linkAction:m.func,linkElement:m.oneOfType([m.string,m.func,m.elementType]),bopLink:m.string,innerRef:m.func,controls:m.shape({type:m.string,navigation:m.shape({text:m.string})}),image:m.shape({description:m.string,src:m.string}),price:m.shape({original:m.string,current:m.string,gross:m.string,type:m.string}),isFavorite:m.boolean,topAttributes:m.arrayOf(m.shape({type:m.string,value:m.oneOf([m.string,m.shape({text:m.string,accessibility:m.string})])})),size:m.shape({subtext:m.string}),status:m.shape({alert:m.bool,type:m.string,message:m.string}),hideMoreOptions:m.bool,grossPriceEnabled:m.bool}),currencyFormat:m.string},I7t={orderId:void 0,product:void 0,refundable:void 0,selectedItemData:{},position:0,tileEnabled:!1,isSEOReadableURLEnabled:!1,isRefundsNetGrossEnabled:!1,fopProps:{active:!1},messages:{}};class qM extends h.Component{formatPrice(t){return t?ii(this.props.intl.formatNumber,t,this.props.currencyFormat):""}formatMessages(){const{messages:t,selectedItemData:n,intl:o}=this.props;t.detailsButton=o.formatMessage("order.details.refund-request-items.fop.button.details"),t.requestRefundButton=o.formatMessage("refunds.fop.non-selected.button"),t.selectedButton=o.formatMessage("refunds.fop.selected.button",{selectedQuantity:n?n.selectedQuantity:0}),t.averagePriceMessage=o.formatMessage("refunds.fop.label.average"),t.acceptedRefund=o.formatMessage("order.details.refund-request-items.status.approved"),t.rejectedRefund=o.formatMessage("order.details.refund-request-items.status.rejected"),t.pendingRefund=o.formatMessage("order.details.refund-request-items.status.pending")}formatStatusMessage(t,n){return`${t} ${n}`}prepareFopProps(){const{type:t,product:n,fopProps:o,isRefundsNetGrossEnabled:r}=this.props;o.name=n.name,o.productId=n.productId,o.image={alt:n.image.description,description:n.image.description,src:n.image.src},o.hideMoreOptions=!0,o.grossPriceEnabled=r,this.prepareProductLink(),this.prepareFopPriceProps(),this.prepareSizeProps(),t==="requested"?this.prepareRefundedProps():t==="new-request"&&this.prepareNewRequestRefundProps()}prepareSizeProps(){const{fopProps:t,refundable:n,messages:o,isRefundsNetGrossEnabled:r}=this.props,a=r?!1:n.displayPrice.averageHint;t.size=a?{subtext:o.averagePriceMessage}:null}prepareFopPriceProps(){const{fopProps:t,refundable:n,isRefundsNetGrossEnabled:o}=this.props;t.price=o?{original:"",current:this.formatPrice(n.price.net),gross:this.formatPrice(n.price.gross),type:"standard"}:{original:"",current:this.formatPrice(n.displayPrice.amount,n.displayPrice.averageHint),type:"standard"}}prepareRefundedProps(){const{fopProps:t,refundable:n,messages:o}=this.props,r=()=>{const a=ct();this.props.actions.openRefundRequestItemDetailsModal({sourceEventId:a,source:"REFUNDED_ITEM_BUTTON_CLICK",itemId:n.itemId})};t.controls={type:"action",action:{text:o.detailsButton,onClick:r,appearance:"secondary"}},n.status==="APPROVED"?t.status=o.acceptedRefund&&{message:this.formatStatusMessage(o.acceptedRefund,n.requestedQuantity),type:"success",alert:!0}:n.status==="PENDING"?t.status=o.pendingRefund&&{message:this.formatStatusMessage(o.pendingRefund,n.requestedQuantity),type:"warning",alert:!0}:n.status==="REJECTED"&&(t.status=o.rejectedRefund&&{message:this.formatStatusMessage(o.rejectedRefund,n.requestedQuantity),type:"error",alert:!0})}prepareNewRequestRefundProps(){const{actions:t,orderId:n,product:o,fopProps:r,refundable:a,messages:i}=this.props,l=()=>{t.analyticsEvent({type:vi.REQUEST_REFUND_BUTTON_CLICKED,orderId:n,productId:o.productId}),t.openRefundItemModal({itemId:a.itemId})};this.isSelected()?r.controls={type:"action",action:{text:i.selectedButton,onClick:l,appearance:"primary"}}:r.controls={type:"action",action:{text:i.requestRefundButton,onClick:l,appearance:"primary"}},r.status=null}isSelected(){const{selectedItemData:t}=this.props;return t&&t.selectedQuantity>0}prepareProductLink(){const{fopProps:t,product:n,isSEOReadableURLEnabled:o}=this.props;t.linkAction=this.fopLinkAction,t.linkElement=n&&n.isInCurrentCatalog===!1?void 0:Ye,t.bopLink=n&&Uo(n.retailerProductId,kc(n.name,{isSEOReadableURLEnabled:o}))}fopLinkAction=()=>{const{product:t,actions:{setActiveBop:n}}=this.props;t&&(t.isInCurrentCatalog===!1?Z.info("fop.not.in.current.catalog"):t.productId&&n(t.productId))};render(){const{tileEnabled:t,fopProps:n,refundable:o,selectedItemData:r}=this.props;return this.formatMessages(),this.prepareFopProps(),t?h.createElement(Mm,{...n,ref:this.updateRef,key:r?r.selectedQuantity:0}):h.createElement(zo,{...n,ref:this.updateRef,key:r?r.selectedQuantity:0,"data-test":`refund-fop-${o.itemId}`})}}const S7t=e=>({orderId:Ct(e),isSEOReadableURLEnabled:E7t(e),isRefundsNetGrossEnabled:f7t(e),currencyFormat:Bi(e)}),C7t=st({analyticsEvent:U.analyticsEvent,openRefundItemModal:e=>J.openModal("refundItemRequestModal",e),openRefundRequestItemDetailsModal:e=>J.openModal("refundRequestItemDetailsModal",e),setActiveBop:Ti.setActiveBop});qM.propTypes=y7t;qM.defaultProps=I7t;const v7t=we(S7t,C7t)(qM),T7t={intl:m.any.isRequired,type:m.oneOf(["requested","new-request"]).isRequired,tileEnabled:m.bool,refundables:m.arrayOf(m.oneOfType([wae,Fae])),selectedItems:m.arrayOf(m.shape({itemId:m.string,selectedQuantity:m.number})),productsByProductId:m.objectOf(sl).isRequired,actions:m.shape({batchAddToBasket:m.func,batchRemoveFromBasket:m.func,fetchFopData:m.func}).isRequired,hideTopBorder:m.bool,isFetching:m.bool.isRequired,"data-test":m.string},_7t={refundables:[],selectedItems:[],hideTopBorder:!1,tileEnabled:!1,"data-test":void 0},KM=({intl:e,type:t,refundables:n,selectedItems:o,productsByProductId:r,tileEnabled:a,hideTopBorder:i,isFetching:l,"data-test":c})=>{const d=a?Fm:wm,u=()=>[...Array(25).keys()].map(E=>s.jsx(d,{"data-test":"fetching-skeleton"},`sk-${E}`)),p=E=>{const y=o?o.find(I=>I.itemId===E):null;return y?{itemId:y.itemId,selectedQuantity:y.selectedRefundables.length}:null},g=()=>s.jsx(h.Fragment,{children:n.map(E=>{const y=r[E.productId],I=p(E.itemId);return y?s.jsx(v7t,{intl:e,type:t,product:y,refundable:E,tileEnabled:a,selectedItemData:I},E.itemId):null})});return s.jsxs(vo.Container,{hideTopBorder:i,"data-synthetics":"product-list","data-test":c,children:[l?u():s.jsx(h.Fragment,{children:g()}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(vo.Placeholder,{}),s.jsx(wT,{})]})};KM.propTypes=T7t;KM.defaultProps=_7t;const b7t=e=>({orderId:Ct(e)}),x7t=st({batchAddToBasket:ir.createBatchAddToBasket(),batchRemoveFromBasket:ir.createBatchRemoveFromBasket()}),zM=Tt(Ht,we(b7t,x7t))(KM),Bae=({name:e,image:t,className:n})=>!e&&!t?null:s.jsx(xe,{condensed:!0,"data-test":"refund-item-info-card",className:n,children:s.jsxs(Q,{align:"center",wrap:"nowrap",children:[s.jsx("picture",{children:s.jsx("img",{height:"30",width:"30",src:t.src,alt:""})}),s.jsx(O,{size:"l",className:"salt-d--inline-block salt-m-l--2",children:e})]})}),_1="refundRequestItemDetailsModal",A7t=D("m.la.h"),R7t=e=>e.categoryDescription&&e.reasonDescription&&e.categoryDescription.trim().toLowerCase()===e.reasonDescription.trim().toLowerCase(),Ry=v(O)`
    word-break: break-word;
`,Uae=()=>{const{formatMessage:e}=L(),t=ws(),n=Me($e(_1)),o=Me(Yn(_1)),r=Me(WM),a=Me(ts),i=Me(A7t),l=()=>t(J.closeModal()),c=o?.itemId&&r.find(g=>g.itemId===o.itemId),d=c&&a[c.productId],u=g=>{switch(g){case"REJECTED":return"error";case"APPROVED":return"success";default:return"warning"}},p=g=>{switch(g){case"REJECTED":return e("order.details.refund.request-items.details-modal.status.rejected");case"APPROVED":return e("order.details.refund.request-items.details-modal.status.approved");default:return e("order.details.refund.request-items.details-modal.status.pending")}};return!c||!d?null:s.jsxs(B,{isOpen:n,onRequestClose:l,"data-test":"refund-request-item-details-modal",children:[s.jsx(B.Header,{align:i?"left":"center",children:s.jsx(ee,{as:"h2",id:"refund-request-item-details-modal-header","data-test":"refund-request-item-details-modal-header",children:e("order.details.refund.request-items.details-modal.header")})}),s.jsx(B.Body,{children:s.jsxs(Q,{gap:["md"],direction:"column",children:[s.jsx(Bae,{"data-test":"item-info",name:d.name,image:d.image}),s.jsxs("div",{children:[s.jsx(O,{"data-test":"quantity-label",asChild:!0,size:"l",bold:!0,className:"salt-m-b--1",children:s.jsx("h3",{children:e("order.details.refund.request-items.details-modal.quantity")})}),s.jsx(O,{"data-test":"quantity",children:c.requestedQuantity})]}),s.jsxs("div",{children:[s.jsx(O,{"data-test":"category-label",asChild:!0,size:"l",bold:!0,className:"salt-m-b--1",children:s.jsx("h3",{children:e("order.details.refund.request-items.details-modal.reason")})}),s.jsx(Ry,{"data-test":"category",children:c.refundReason.categoryDescription})]}),!R7t(c.refundReason)&&s.jsxs("div",{className:"salt-m-b--2",children:[s.jsx(O,{"data-test":"reason-label",asChild:!0,size:"l",bold:!0,className:"salt-m-b--1",children:s.jsx("h3",{children:e("order.details.refund.request-items.details-modal.sub-reason.label")})}),s.jsx(Ry,{"data-test":"reason",children:c.refundReason.reasonDescription})]}),c.refundReason.reasonNote&&s.jsxs("div",{children:[s.jsx(O,{"data-test":"category-label",asChild:!0,size:"l",bold:!0,className:"salt-m-b--1",children:s.jsx("h3",{children:e("refunds.item-selection-modal.optional-comment.header")})}),s.jsx(Ry,{"data-test":"reason-note",children:c.refundReason.reasonNote})]}),s.jsxs("div",{children:[s.jsx(O,{"data-test":"status-label",asChild:!0,size:"l",bold:!0,className:"salt-m-b--1",children:s.jsx("h3",{children:e("order.details.refund.request-items.details-modal.status.label")})}),s.jsx("div",{className:"salt-m-b--1",children:s.jsx(Te,{"data-test":"status",showIcon:!1,text:p(c.status),intent:u(c.status)})}),c.rejectionReasonNote&&s.jsx(Ry,{"data-test":"rejection-reason-note",children:c.rejectionReasonNote})]})]})}),s.jsx(B.Footer,{children:s.jsx(x,{intent:"primary",onClick:l,fill:!0,children:s.jsx(x.Text,{children:e("order.details.refund.request-items.details-modal.confirm")})})})]})},D7t=({orderBillingAddress:e,isFetching:t})=>{const[n,o]=h.useState(!1),{formatMessage:r}=L(),a=r("invoice.billing.address.management.box.title");return s.jsxs(Je,{expanded:n,onToggle:()=>o(!n),aria:{expandedLabel:a,collapsedLabel:a},"data-test":"readonly-invoice-collapsible-box",name:"invoice-collapsible-box",children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{"data-test":"invoice-billing-address-title",as:"h2",children:a}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentExpanded,{children:t?s.jsx(_s,{}):s.jsx(yj,{orderBillingAddress:e,isReadOnly:!0,editOrderMode:!1,billingAddressRef:null,className:"salt-m-t--4"})})]})},O7t=()=>{const{formatMessage:e}=L(),t=f(hte),n=os({breakpoint:"lg-up"}),[o]=Ee(["ord.def.col"]),[r,a]=h.useState(!0);return h.useEffect(()=>{o&&n&&a(!1)},[n,o]),t.length?s.jsx("div",{className:"salt-m-y--4",children:s.jsxs(Je,{expanded:r,onToggle:()=>{a(!r)},aria:{expandedLabel:e("order.online.receipt.payment.title"),collapsedLabel:e("order.online.receipt.payment.title")},name:"order-payment-card-collapsible-box",children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{as:"h2",children:e("order.online.receipt.payment.title")}),s.jsx(Je.ToggleSwitch,{})]}),s.jsxs(Je.ContentExpanded,{children:[s.jsx(Ase,{className:"salt-m-y--4"}),s.jsx(xse,{className:"salt-m-y--4"})]})]})}):null},P7t=({orderId:e})=>{const t=F(),n=f($e("orderFiscalInvoiceForm")),o=f(hC),r=f(ei),a=()=>{t(J.closeModal())},i=new URL(o);return i.searchParams.set("orderId",e),i.searchParams.set("customerId",r),s.jsx(B,{"data-test":"order-fiscal-invoice-request-modal",isOpen:n,onRequestClose:a,aria:{labelledby:YT},maxWidth:"md",children:s.jsx(B.Body,{children:s.jsx("iframe",{title:"order-fiscal-invoice-request-iframe","data-test":"order-fiscal-invoice-request-iframe",src:i.href,height:"700px",width:"100%"})})})},Gae=({orderStatus:e,orderId:t})=>{const n=f(hC),o=f(ei),r=()=>e==="DELIVERED",a=()=>s.jsxs(Q,{align:"flex-start","data-test":"fiscal-invoice-informational-text",children:[s.jsx(pe,{className:"salt-m-r--2",name:"info_default",height:20,width:20}),s.jsx(b,{id:"order.online.receipt.invoice.not.generated.yet"})]}),i=()=>{const l=new URL(n);return l.searchParams.set("orderId",t),l.searchParams.set("customerId",o),s.jsxs(h.Fragment,{children:[s.jsx(x,{asChild:!0,size:"m",intent:"secondary",fill:!0,"data-test":"request-fiscal-invoice-button",children:s.jsx(tt,{intent:"ghost",href:l.toString(),target:"_blank",children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.online.receipt.invoice.request.button"})})})}),s.jsx(P7t,{orderId:t})]})};return s.jsx("div",{className:"salt-m-y--4",children:s.jsx(xe,{"data-test":"order-fiscal-invoice-card",condensed:!0,children:s.jsx("div",{className:"salt-p--2",children:r()?i():a()})})})},QM=({order:{orderId:e},handleEditOrderButtonClick:t=()=>{}})=>{const n=F(),o=Ge(),r=Ck(),a=f(yse),i=f(GY),l=()=>{n(J.openModal("editOrder",{orderId:e}))},c=()=>{n(U.analyticsEvent({type:Gs.EDIT_ORDER_BUTTON_CLICKED,orderId:e}));const g={event:"event",ecommType:"enhanced",eventCategory:"E-commerce",eventLabel:"edit-order-clicked",eventAction:"EditOrderButtonClicked",ecommerce:{transactionId:e}};te.sendEvent({GA:g,WA:null})},d=Ise(e),u=async()=>{c(),t(),a?d():(await n(Mi.getPendingOrders()),await n(ji.editOrder(e,o,{redirectToDetails:!1}))),r()},p=()=>{i?u():l()};return s.jsx(x,{intent:"primary",fill:!0,onClick:p,"data-test":"edit-order-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.edit"})})})},Vh="PENDING",Wh="ACCEPTED",Yh="REJECTED",N7t=m.shape({retailPrice:ze,itemPriceAfterPromos:ze,finalPrice:ze,depositsPrice:ze,environmentalHandlingPrice:ze,promoSavings:ze,totalSavings:ze,totalPrice:ze,vouchersSavingsPrice:ze,taxesTotals:m.shape({taxes:m.shape({components:m.arrayOf(m.shape({displayName:m.string,taxRate:m.string,taxAmount:ze}))})})}),$ae=m.shape({productId:m.string.isRequired,retailerProductId:m.string.isRequired,name:m.string.isRequired,type:m.string.isRequired,isInCurrentCatalog:m.bool.isRequired,image:m.shape({src:m.string.isRequired,title:m.string.isRequired}),status:m.oneOf([Wh,Yh,Vh]),quantity:m.number.isRequired,prices:m.shape({retail:ze,offered:ze,pricePerItem:ze,pricePerUnit:m.shape({value:ze,unit:m.string}),grossOffered:ze,netOffered:ze}),packInfo:m.shape({packSizeDescription:m.string,weight:m.string,typicalWeight:m.string}),promotions:m.arrayOf(m.shape({id:m.string,name:m.string,presentationMode:m.string})),isAlcohol:m.bool.isRequired,sellerId:m.string}),op=m.shape({productId:m.string.isRequired,retailerProductId:m.string.isRequired,name:m.string.isRequired,type:m.string.isRequired,isInCurrentCatalog:m.bool.isRequired,image:m.shape({src:m.string.isRequired,title:m.string.isRequired}),quantity:m.number.isRequired,prices:m.shape({retail:ze,offered:ze,pricePerItem:ze,pricePerUnit:m.shape({value:ze,unit:m.string}),grossOffered:ze,netOffered:ze}),packInfo:m.shape({packSizeDescription:m.string,weight:m.string,typicalWeight:m.string}),promotions:m.arrayOf(m.shape({id:m.string,name:m.string,presentationMode:m.string})),substitutes:m.arrayOf($ae),isAlcohol:m.bool.isRequired,sellerId:m.string,expirationDate:m.string,storageType:m.string}),Ga={LIST_TYPE_REGULAR:"regular",LIST_TYPE_MISSING:"missing",LIST_TYPE_RETURNED:"returned",LIST_TYPE_SUBSTITUTE:"substitute"},L7t=Ro(["loyalty","loyear"]),k7t=Ro(["loyalty","loyred"]),j7t=Wn(["sumsub","bt.spl"]),M7t=D("loy.waon"),w7t={actions:m.shape({sendAnalyticsEvent:m.func.isRequired}).isRequired,order:m.shape({lastUpdated:m.number,isFetching:m.bool,error:m.shape({statusCode:m.number}),order:lr}).isRequired,getLoyaltySpent:m.func.isRequired,getLoyaltyEarned:m.func.isRequired,loading:m.bool,paymentSummary:m.shape({bags:m.shape({quantity:m.number,price:ze}),carrierBag:ze,delivery:ze,deliveryPromotions:m.arrayOf(m.shape({promoDescription:m.string,promoSaving:ze,promoId:m.string})),depositsPrice:ze,environmentalHandlingPrice:ze,finalPrice:ze,itemsRetailPrice:ze,invoice:ze,retailPrice:ze,orderLevelPromotions:m.arrayOf(m.shape({saving:ze.isRequired,description:m.string.isRequired,promoId:m.string.isRequired})),paymentInfo:m.shape({paymentMethod:m.string,fundingInstrumentId:m.string,isFundingInstrumentUpdatable:m.bool,nonSavedFundingInstrument:m.bool,emailAddress:m.string,paymentAmountSplitPerMethods:m.shape({paymentMethod:m.string,total:ze}),cardType:m.string,lastFourDigits:m.string,expiryMonth:m.string,expiryYear:m.string}).isRequired,preparation:ze,smallOrder:ze,savings:ze,taxComponents:m.arrayOf(m.shape({displayName:m.string.isRequired,taxRate:m.string.isRequired,taxAmount:ze.isRequired})),totalPrice:ze,appliedVouchers:m.arrayOf(m.shape({id:m.string.isRequired,savings:ze})),vouchersSavingsPrice:ze,itemPriceAfterPromos:ze}).isRequired,sellers:m.arrayOf(m.shape({sellerId:m.string,sellerName:m.string,totalItems:m.number,orderTotals:N7t})),quantity:m.number.isRequired,rebookable:m.bool.isRequired,isExternal:m.bool.isRequired,isLoyaltyRedeemEnabled:m.bool.isRequired,isLoyaltyEarningEnabled:m.bool.isRequired,isLoyaltyPaymentEnabled:m.bool.isRequired,isSummarySubtotalEnabled:m.bool.isRequired,intl:m.any.isRequired,handleEditOrderButtonClick:m.func,isOrderMultiPaymentsEnabled:m.bool.isRequired},F7t={loading:!1,handleEditOrderButtonClick:()=>{}},XM=e=>{const{actions:t,order:n,getLoyaltySpent:o,getLoyaltyEarned:r,loading:a,paymentSummary:i,sellers:l,quantity:c,rebookable:d,isExternal:u,isLoyaltyRedeemEnabled:p,isLoyaltyEarningEnabled:g,isSummarySubtotalEnabled:E,isLoyaltyPaymentEnabled:y,intl:I,handleEditOrderButtonClick:S,isOrderMultiPaymentsEnabled:C}=e,[T,_,A,R,P]=Ee(["or.sg","pay.check.show","tx.nts","or.ph","ord.def.col"]),N=He(),{formatMessage:k}=L(),{primarySellerId:M,primarySellerName:w}=n.order,{currentBreakpoint:j}=h.useContext(kn),G=j==="xs",W=os({breakpoint:"lg-up"}),[H,K]=h.useState(!G),{paymentInfo:X}=i||{},{paymentAmountSplitPerMethods:q}=X||{},ne=ve=>(q.find(lt=>lt.paymentMethod===ve)||{}).total,ue=()=>(q||[]).some(ve=>Number(ve?.total?.amount)),oe=ve=>{const lt=ve?Fo.SUMMARY_COMPONENT_COLLAPSED:Fo.SUMMARY_COMPONENT_EXPANDED,St=ve?"User collapsed the summary component":"User expanded the summary component";t.sendAnalyticsEvent({type:lt,description:St})},[ye]=f(Zk)||[],he=f(gte);h.useEffect(()=>{j&&P&&W&&K(!1)},[W,P,j]);const Ie=ve=>{oe(H),ve.preventDefault(),K(lt=>!lt)},Fe=()=>n.order&&n.order.status==="FUTURE"&&n.order.editStatus==="EDITABLE"?s.jsx("div",{className:"salt-p-t--4 salt-m-y--2",children:s.jsx(QM,{order:n.order,handleEditOrderButtonClick:S})}):null,be=(ve,lt)=>{const St=lt?`-${lt}`:"";return s.jsx(le.Items,{"data-test":`summary-items${St}`,itemsRetailPrice:ve.itemPriceAfterPromos,quantity:ve.totalItems,withTaxNote:A})},ce=(ve,lt)=>{const St=lt?`-${lt}`:"";return s.jsxs(h.Fragment,{children:[s.jsx(le.Items,{"data-test":`summary-items${St}`,itemsRetailPrice:ve.itemsRetailPrice||ve.retailPrice,quantity:ve.totalItems,withTaxNote:A}),s.jsx(le.Savings,{"data-test":`summary-savings${St}`,savings:ve.savings}),s.jsx(le.SavingsWithPaymentMethod,{savings:ve.paymentMethodSavingsPrice}),E&&!!Number(ve.savings?.amount)&&!!ve.itemPriceAfterPromos&&ve.itemPriceAfterPromos?.amount!==ve.finalPrice?.amount&&s.jsx(le.Subtotal,{"data-test":`summary-subtotal${St}`,value:ve.itemPriceAfterPromos})]})},me=()=>g&&n&&n.order&&n.order.loyalty&&n.order.loyalty.earned&&n.order.loyalty.earned.units>0,De=()=>y&&n?.order?.loyalty?.spent?.units>0&&!C,ge=()=>{const ve=tj(l,w);return l?.length>0&&s.jsx(h.Fragment,{children:ve.map(lt=>Ae(lt,lt.sellerId===M))})},Se=(ve,lt,St)=>({...St?{isPrimarySeller:!0,paymentInfo:i.paymentInfo,appliedVouchers:i.appliedVouchers,bags:i.bags}:{appliedVouchers:[],isPrimarySeller:!1},sellerName:ve.sellerName,totalItems:ve.totalItems,savings:ve.orderTotals?.promoSavings,itemsRetailPrice:ve.orderTotals?.retailPrice,depositsPrice:ve.orderTotals?.depositsPrice,environmentalHandlingPrice:ve.orderTotals?.environmentalHandlingPrice,finalPrice:ve.orderTotals?.finalPrice,totalPrice:ve.orderTotals?.totalPrice,retailPrice:ve.orderTotals?.retailPrice,vouchersSavingsPrice:ve.orderTotals?.vouchersSavingsPrice,taxComponents:ve.orderTotals?.taxesTotals?.taxes?.components,itemPriceAfterPromos:ve.orderTotals?.itemPriceAfterPromos,carrierBag:ve.charges?.carrierBag,delivery:ve.charges?.delivery,deliveryPromotions:ve.charges?.deliveryPromotions||[],invoice:ve.charges?.invoice,orderLevelPromotions:ve.orderLevelPromotions,preparation:ve.charges?.preparation,smallOrder:ve.charges?.smallOrder,loyalty:ve.loyalty,paymentMethodSavingsPrice:ve.orderTotals?.paymentMethodPromoSavings}),Ae=(ve,lt)=>{const St=ve.sellerName.toLowerCase().replaceAll("_","-"),wt=Se(ve,i,lt);return!Number(C?he:wt.totalPrice?.amount)&&!wt.totalItems?null:s.jsxs(h.Fragment,{children:[s.jsx(tl,{groupName:wt.sellerName,className:"salt-d--block salt-m-y--2"}),We(wt,lt,St)]})},Ce=ve=>()=>ve.loyalty?.spent,We=(ve,lt,St)=>{const wt=St?`-${St}`:"";return s.jsxs(h.Fragment,{children:[s.jsxs(fe,{"data-test":`summary-content-description-list${wt}`,children:[R?be(ve,St):ce(ve,St),s.jsx(le.Promotions,{orderLevelPromotions:ve.orderLevelPromotions,"data-test":`summary-promotions${wt}`}),s.jsx(le.Vouchers,{"data-test":`summary-vouchers${wt}`,appliedVouchers:ve.appliedVouchers,vouchersSavingsPrice:ve.vouchersSavingsPrice}),s.jsx(le.Delivery,{"data-test":`summary-delivery${wt}`,delivery:ve.delivery,withTaxNote:A}),s.jsx(le.DeliveryPromotions,{"data-test":`summary-delivery-pass${wt}`,isDeliveryPromotion:!!i?.deliveryPromotions?.[0]?.promoId,hideDeliveryPassInfo:!lt,deliveryPromotions:ve.deliveryPromotions}),s.jsx(le.BagCharge,{"data-test":`summary-bag-charge${wt}`,carrierBag:ve.carrierBag,withTaxNote:A}),s.jsx(le.PreparationCost,{"data-test":`summary-preparation-cost${wt}`,preparationCost:ve.preparation,withTaxNote:A}),s.jsx(le.Invoice,{"data-test":`summary-invoice${wt}`,invoice:ve.invoice,withTaxNote:A}),s.jsx(le.EnvironmentalHandlingCharge,{"data-test":`summary-environmental-handling-charge${wt}`,environmentalHandlingPrice:ve.environmentalHandlingPrice,withTaxNote:A}),ve.bags&&s.jsx(le.Separator,{}),s.jsx(le.BuyBacks,{bags:ve.bags,"data-test":`summary-buy-backs${wt}`}),s.jsx(le.Loyalty,{"data-test":`summary-loyalty${wt}`,isLoyaltyRedeemEnabled:p,getLoyaltySpent:T?Ce(ve):o}),s.jsx(le.Deposit,{"data-test":`summary-deposit${wt}`,depositsPrice:ve.depositsPrice,withTaxNote:A}),s.jsx(le.SmallOrderCharge,{smallOrderPrice:ve.smallOrder,orderId:n.order.orderId,thresholds:ve.smallOrderChargeThresholds,withTaxNote:A,page:"order-details"})]}),s.jsxs(h.Fragment,{children:[s.jsx(le.Taxes,{"data-test":`summary-taxes${wt}`,finalPrice:ve.finalPrice,components:ve.taxComponents,withTaxNote:A}),lt&&_&&ue()&&s.jsxs(h.Fragment,{children:[s.jsx(le.Separator,{}),s.jsx("div",{className:"salt-m-t--2",children:s.jsx(fe,{"data-test":`summary-payment-list${wt}`,children:s.jsx(le.PaymentChecks,{"data-test":`summary-payment-checks${wt}`,paidByCheck:ne("PAYMENT_CHECK"),paidByCard:ne("CARDS"),paidByInvoice:ne("INVOICE")})})})]})]}),De()&&s.jsx(le.WaonPoints,{withTaxNote:A,getLoyaltySpent:T?Ce(ve):o,finalPrice:ve.finalPrice}),s.jsx(le.Separator,{})]})},et=C?he:i.totalPrice;return s.jsxs(cs,{expanded:H,onToggle:Ie,breakpoint:"sm-up",aria:{contentLabel:I.formatMessage("order.details.summary.title"),totalPrice:et&&N(et)},children:[s.jsxs(cs.ControlSection,{children:[H?s.jsx(ee,{as:"h2",children:k("order.details.summary.title")}):s.jsx(le.TotalInline,{loading:!i,totalPrice:et,"data-test":"summary-control-section-total",withTaxNote:A}),s.jsx(cs.ToggleSwitch,{})]}),s.jsxs(cs.Content,{children:[!u&&(T&&M&&w?ge():We({...i,totalItems:c},!0)),s.jsx(le.TotalSpaceBetween,{loading:!i,totalPrice:C?he:i.totalPrice,withTaxNote:A})]}),me()&&s.jsx("div",{className:"salt-p-t--2","data-test":"loyalty-earnings-summary",children:s.jsx(xu,{getQuantity:r,allowZero:!0})}),C&&ye&&s.jsx(fe,{children:s.jsx(OL,{amount:ye.total.amount,currency:ye.total.currency})}),s.jsx(le.Buttons,{loading:a,children:Fe()}),s.jsx(le.RebookableDisclaimer,{rebookable:d})]})},B7t=e=>({order:As(e),getLoyaltySpent:_P,getLoyaltyEarned:wd,paymentSummary:Nc(e),sellers:bv(e),quantity:TP(e),rebookable:bP(e),isExternal:PE(e),isLoyaltyRedeemEnabled:k7t(e),isLoyaltyEarningEnabled:L7t(e),isSummarySubtotalEnabled:j7t(e),isLoyaltyPaymentEnabled:M7t(e)}),U7t=st({sendAnalyticsEvent:U.analyticsEvent});XM.propTypes=w7t;XM.defaultProps=F7t;const G7t=Tt(Ht,we(B7t,U7t))(XM),b1=({isExpanded:e=!1})=>{const{order:t}=f(As),[n,o]=h.useState(e),{formatMessage:r}=L(),a=He(),i=f(D("loy.waon"));if(!t?.paymentInfo)return null;const{paymentInfo:l,loyalty:c}=t,d=()=>i&&c&&c?.spent?.units>0,u=()=>s.jsx(xe,{className:"salt-d--flex",children:s.jsx(zm,{paymentInfo:l})}),p=()=>s.jsx(xe,{"data-test":"order-payment-waon-points-box",children:s.jsx(O,{className:"salt-d--flex",asChild:!0,"data-test":"order-payment-waon-points-label",children:s.jsx("strong",{children:`${r("summary.loyalty.units.name")}${` (${c&&a(c.spent?.money)})`}`})})});return s.jsx("div",{className:"salt-m-y--4",children:s.jsxs(Je,{expanded:n,onToggle:()=>{o(!n)},aria:{expandedLabel:r("order.online.receipt.payment.title"),collapsedLabel:r("order.online.receipt.payment.title")},name:"order-payment-card-collapsible-box",children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{as:"span",children:r("order.online.receipt.payment.title")}),s.jsx(Je.ToggleSwitch,{})]}),d()&&s.jsx(Je.ContentExpanded,{children:s.jsx("div",{className:"salt-p-t--4",children:p()})}),s.jsx(Je.ContentExpanded,{children:s.jsx("div",{className:"salt-p-t--4",children:u()})})]})})},$7t={order:lr.isRequired},Hae=({order:e})=>{const[t]=Ee(["onre"]),n=oV(e.orderId),o=()=>t?"order.online.receipt.download.receipt.button":"order.details.receipt";return s.jsx(x,{intent:"secondary",fill:!0,"data-test":"order-receipt-button",asChild:!0,children:s.jsxs(tt,{href:n,target:"_blank",standalone:!0,bold:!0,children:[s.jsx(x.Icon,{name:"pdf","data-test":"icon__pdf"}),s.jsx(x.Text,{children:s.jsx(Nt,{id:o()})})]})})};Hae.propTypes=$7t;const H7t={order:m.shape({orderId:m.string}).isRequired,actions:m.shape({openCancelChangesModal:m.func.isRequired}).isRequired},Vae=({order:e,actions:t})=>{const{orderId:n}=e;return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",fill:!0,onClick:()=>t.openCancelChangesModal(n),"data-test":"cancel-changes-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.undo.changes"})})}),s.jsx(vk,{orderId:n,page:"order-details"})]})},V7t=st({openCancelChangesModal:e=>J.openModal(`cancelChanges${e}`)});Vae.propTypes=H7t;const W7t=we(null,V7t)(Vae),Y7t={order:m.shape({orderId:m.string}).isRequired},DI=({order:{orderId:e}})=>{const t=F(),n=()=>{t(J.openModal(`cancelOrder${e}`))};return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",fill:!0,onClick:n,"data-test":"cancel-order-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.cancel"})})}),s.jsx(Tk,{orderId:e,page:"order-details"})]})};DI.propTypes=Y7t;const Dy={UNDER_EDIT:{buttons:[{key:1,component:W7t},{key:2,component:DI}]},EDITABLE:{buttons:[{key:3,component:DI}]},OTHER_UNDER_EDIT:{buttons:[{key:4,component:DI}]},EDIT_EXPIRED:{buttons:[]},PENDING_PAYMENT:{buttons:[]},DELIVERED:{buttons:[]},PICKED:{buttons:[]},CANCELLED:{buttons:[]},SCRATCHED:{buttons:[]},DEFAULT:{buttons:[]},DELIVERED_WITH_RECEIPT:{buttons:[{key:5,component:Hae}]}},q7t=e=>{const{status:t,editStatus:n,hasReceipt:o}=e;let r;return t==="FUTURE"?r=Dy[n]:o&&t==="DELIVERED"?r=Dy.DELIVERED_WITH_RECEIPT:r=Dy[t],r||Dy.DEFAULT},Wae=({loading:e=!1})=>{const t=f(As);if(!t.order||!t.order.status||!t.order.editStatus)return null;const n=q7t(t.order);if(!n)return null;if(e)return s.jsx(x,{intent:"action",fill:!0,loading:!0,children:s.jsx(x.Text,{children:e})});let o=[];return n.buttons.length&&(o=n.buttons.map((r,a)=>{const i=r.component;return s.jsxs(h.Fragment,{children:[s.jsx(i,{order:t.order}),a<n.buttons.length-1&&s.jsx("div",{className:"salt-m-y--4"})]},r.key)})),o.length?s.jsx(xe,{className:"salt-m-y--4",children:o}):null};function ux(e){return!!e.length&&e.length<13}function K7t(e,t,n,o){const r=ya(e),a=ya(),i=r.isSame(a,"day"),l=ya().add(7,"days").startOf("day"),c=!r.isBefore(a,"day")&&r.isBefore(l,"day"),d=r.isBefore(a,"day"),u={text:"",accessibilityText:""};return i&&(u.text=t("use.by.date.text.today"),u.accessibilityText=t("a11y.use.by.date.text.today")),!ux(u.text)&&c&&(u.text=t("use.by.date.text.weekday",{shortDay:r.format(n)}),u.accessibilityText=t("a11y.use.by.date.text.weekday",{weekday:r.format(Ja)})),ux(u.text)||(u.text=t("use.by.date.short.text.expiration.date",{date:r.format(o)}),u.accessibilityText=t("a11y.use.by.date.expiration.date",{date:r.format(Rx)})),d&&(u.text=t("use.by.date.text.expired"),u.accessibilityText=t("a11y.use.by.date.text.expired")),ux(u.text)||(u.text=r.format(o),u.accessibilityText=t("a11y.use.by.date.text",{date:r.format(Rx)})),u}const z7t=({expirationDate:e})=>{const{formatMessage:t}=L(),n=f(Sde),o=f(Ide);if(!e||!ya(e,ya.ISO_8601,!0).isValid())return null;const r=K7t(e,t,n,o);return r.text.length?s.jsx(ln,{intent:"tertiary-contrast",singleLine:!0,text:r.text,accessibilityText:r.accessibilityText,"data-test":"order-receipt-list-element-card-use-by-date-badge"}):null},Q7t=({productIndex:e,product:t})=>{const n=F(),o=f(Qs),r=f(l=>t?.productId?Da(l,t.productId):null),a=()=>{Z.info("fop.not.in.current.catalog")},i=()=>{if(t&&r){const l=r.price,{productId:c,retailerProductId:d,name:u,prices:p}=t,g={currency:p.offered?.currency||"",amount:p.offered?.amount||""},E={current:g,unit:{current:g,label:l?.unit?.label||""}},y=e+1;n(Rp.productClickGAEvent({productName:u,productId:d,productPrice:g.amount,productListName:"order-details: other",productPosition:y,currencyCode:g.currency}));const I={eventLabel:d,ecommType:"enhanced",eventCategory:"E-commerce",eventAction:"product_click",event:"productClick",ecommerce:{currencyCode:g.currency,click:{actionField:{list:"order-details: other"},products:[{name:u,id:d,price:g.amount,position:y}]}}};te.sendEvent({GA:I,WA:null});const S={...r,price:E},C=Vn(S,o);n(Rp.productClickGa4Event({product:S,position:y,productListName:"order-details: other",page:"order-details"}));const T={event:"select_item",ecommerce:{currency:g.currency,items:[Zp({product:S,position:y,productListName:"order-details: other",page:"order-details",featuredProductCampaign:C})]}};te.sendEvent({GA:T,WA:null}),n(Ti.setActiveBop(c))}};return h.useCallback(()=>{if(t&&!t.isInCurrentCatalog){a();return}i()},[t])},X7t=v(ee).attrs({size:"s",forwardedAs:"span"})`
    color: ${({promotional:e,presentationMode:t})=>e&&t!=="MUTE_STYLE"?"var(--typography-promotion, var(--intent-promotion))":"black"};
`,Z7t=({shouldShowProductNetGrossPrices:e,shouldHideOnlineReceiptPromotions:t,isItemNotDelivered:n,isProductDiscounted:o,promotions:r,prices:a,formatPrice:i})=>{const{formatMessage:l}=L(),c=Number(a?.retail?.amount)===0&&Number(a?.offered?.amount)===0&&r.length>0,d=!t&&(o||c),u=()=>r?.length>0&&!r.some(E=>E.presentationMode!=="MUTE_STYLE")?"MUTE_STYLE":"DEFAULT",p=()=>a?l(o&&!t?"order.online.receipt.accessibility.item.price.discounted":"order.online.receipt.accessibility.item.price"):"",g=()=>a?i(e?a.netOffered:n?a.retail:a.offered):"";return s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:p()}),s.jsx(X7t,{"data-test":"receipt-element-total-product-price",promotional:d,presentationMode:u(),children:g()})]})},J7t=v.s`
    font-size: var(--salt-text-m-font-size);
    font-weight: 400;
    margin-inline-start: var(--salt-spacing-1);
    line-height: 1em;
`,eXt=({shouldShowProductNetGrossPrices:e,shouldHideOnlineReceiptPromotions:t,isProductDiscounted:n,prices:o,formatPrice:r})=>{const{formatMessage:a}=L(),i=r(o?.grossOffered);return e?s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:a("order.details.product.gross.price.accessibility.label",{price:i})}),s.jsx(O,{"data-test":"receipt-element-original-total-product-price",className:"salt-m-l--1",children:a("order.details.product.gross.price",{price:i})})]}):s.jsx(h.Fragment,{children:!t&&o&&n&&s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:a("order.online.receipt.accessibility.item.price.original")}),s.jsx(J7t,{"data-test":"receipt-element-original-total-product-price",children:r(o.retail)})]})})},tXt=v.div`
    display: flex;
    flex-grow: 1;
    flex-direction: column;
    align-items: flex-end;
    justify-content: flex-end;
`,sXt=v.div`
    display: flex;
    block-size: 100%;
    flex-direction: column;
    flex-grow: 1;
`,nXt=({isItemNotDelivered:e,product:t})=>{const[n]=Ee(["or.ph"]),o=He(),{prices:r,promotions:a}=t,i=!!(r?.grossOffered&&r?.netOffered),l=d=>d?o(d):"",c=!!(r?.retail&&r?.offered&&r.retail.amount!==r.offered.amount&&!e);return s.jsx(sXt,{children:s.jsxs(tXt,{children:[s.jsx(eXt,{shouldShowProductNetGrossPrices:i,shouldHideOnlineReceiptPromotions:!!n,isProductDiscounted:c,prices:r,formatPrice:l}),s.jsx(Z7t,{shouldShowProductNetGrossPrices:i,shouldHideOnlineReceiptPromotions:!!n,isItemNotDelivered:e,isProductDiscounted:c,promotions:a,prices:r,formatPrice:l})]})})},$g="regular",qh="missing",Kh="returned",zh="substituted",ZS="substitute",JS="substitute-accepted",Qh="substitute-rejected",oXt={itemType:m.oneOf([$g,qh,Kh,zh,ZS,JS,Qh]),product:m.oneOfType([op,$ae]).isRequired,catchWeightSubtextPosition:m.string,messages:m.shape({catchWeight:m.string}),headingLevelOverride:m.oneOf(["h3","h4","h5"]),productIndex:m.number},rXt={itemType:$g,catchWeightSubtextPosition:"post",messages:{},headingLevelOverride:null},aXt=v.div`
    display: flex;
    inline-size: 100%;
    flex-direction: column;
    margin-block-end: var(--salt-spacing-2);
`,iXt=v.div`
    inline-size: 100%;
    margin-block: var(--salt-spacing-2) var(--salt-spacing-1);
`,lXt=v.div`
    display: flex;
    inline-size: 100%;
    min-block-size: ${$(94)};
    flex-direction: row;
`,cXt=v.img`
    block-size: ${$(94)};
    inline-size: ${$(94)};
    align-self: center;
`,dXt=v.div`
    display: flex;
    max-block-size: 100%;
    inline-size: ${$(94)};
    margin-inline-end: var(--salt-spacing-2);
    flex: 0 0 auto;
    align-items: flex-end;
`,uXt=v.div`
    display: flex;
    max-block-size: 100%;
    flex: 1 1 auto;
    flex-direction: column;
    align-items: flex-start;
`,pXt=v.div`
    display: flex;
    inline-size: 100%;
    margin-inline-end: var(--salt-spacing-2);
    flex: 1 0 auto;
    flex-direction: column;
    align-items: flex-start;
`,mXt=v.div`
    display: flex;
    inline-size: 100%;
    margin-inline-end: var(--salt-spacing-2);
    flex: 1 1 auto;
    flex-direction: row;
    align-items: flex-start;
    color: var(--salt-text-color);
`,hXt=v.div`
    display: flex;
    flex-grow: 1;
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-end;
`,gXt=v.div`
    display: flex;
    block-size: 100%;
    flex-direction: column;
`,EXt=v.div`
    display: flex;
    flex-direction: row;
    flex: 0 0 auto;
    margin-block-start: var(--salt-spacing-2);
`,fXt=v(O)`
    font-size: var(--salt-text-m-font-size);
    font-weight: 400;
    display: flex;
    flex: 0 0 auto;
    cursor: pointer;
    text-decoration: unset;

    &:hover {
        text-decoration: underline;
    }
`,yXt=v.div`
    display: flex;
    align-items: flex-start;
    flex-direction: column;
    flex: 1 0 auto;
    margin-block-start: var(--salt-spacing-1);
`,IXt=v.div`
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    color: ${({presentationMode:e})=>e==="MUTE_STYLE"?"black":"var(--typography-promotion, var(--intent-promotion))"};
    overflow: hidden;
`,SXt=v(O)`
    font-size: var(--salt-text-m-font-size);
    font-weight: 400;
`,CXt=v.div`
    display: flex;
    flex-direction: row;
    color: ${({presentationMode:e})=>e==="MUTE_STYLE"?"black":"var(--typography-promotion, var(--intent-promotion))"};
`,px=v(O)`
    color: ${({theme:e,branded:t})=>t?"var(--intent-primary)":"currentColor"};
    margin-inline-end: var(--salt-spacing-1);
    font-size: var(--salt-text-s-font-size);
`,x1=v.span`
    margin-inline: ${({post:e})=>e&&"var(--salt-spacing-1)"}
        ${({pre:e})=>e&&"var(--salt-spacing-1)"};
`,vXt=v.div`
    display: flex;
    flex-direction: row;
    flex: 0 0 auto;
`,TXt=v(O)`
    font-weight: 400;
    font-size: var(--salt-text-m-font-size);
`,_Xt=v(gn)`
    z-index: 1;
    min-block-size: ${$(20)};
    overflow: hidden;

    &:empty {
        display: none;
    }

    position: absolute;
`,Qn=({itemType:e,product:t,catchWeightSubtextPosition:n,messages:o,headingLevelOverride:r,productIndex:a})=>{const i=L(),l=He(),[c,d]=Ee(["seo.rdbl","or.ph"]),u=f(D("ubd")),p=f(u2e(t.productId)),g=Q7t({product:t,productIndex:a}),E=H=>H?l(H):"",y=()=>{const K=(X=>{switch(X){case qh:return{type:"error",message:"order.online.receipt.list.element.status.missing"};case Kh:return{type:"success",message:"order.online.receipt.list.element.status.returned"};case zh:return{type:"error",message:"order.online.receipt.list.element.status.missing"};case ZS:return{type:"success",message:"order.online.receipt.list.element.status.substitute"};case JS:return{type:"success",message:"order.online.receipt.list.element.status.substitute.accepted"};case Qh:return{type:"error",message:"order.online.receipt.list.element.status.substitute.rejected"};default:return{type:"info",message:""}}})(e);return s.jsx(Te,{intent:K.type,size:"s","data-test":"receipt-element-alert","data-test-type":K.type,"aria-hidden":!0,text:s.jsx(b,{id:K.message,values:{quantity:t.quantity}})})},I=()=>e===qh||e===zh||e===Kh||e===Qh,S=()=>s.jsxs(h.Fragment,{children:[s.jsx(gXt,{children:C()}),s.jsx(nXt,{isItemNotDelivered:I(),product:t})]}),C=()=>s.jsxs(hXt,{children:[s.jsx(EXt,{children:A()}),s.jsx(vXt,{children:!d&&t.prices&&t.prices.pricePerItem&&t.type!=="CATCHWEIGHT"?s.jsx(TXt,{"data-test":"receipt-element-price-per-item-text",children:s.jsx(b,{id:"order.online.receipt.price.per.item",values:{price:E(t.prices.pricePerItem)}})}):null})]}),T=()=>{const H=t&&t.packInfo&&t.packInfo.typicalWeight&&o&&o.catchWeight;return t.packInfo.weight?s.jsx(h.Fragment,{children:t.packInfo.weight}):s.jsxs(h.Fragment,{children:[H&&n==="pre"&&s.jsx(x1,{pre:!0,children:H}),t.packInfo.typicalWeight,H&&n!=="pre"&&s.jsx(x1,{post:!0,children:H})]})},_=()=>{const H=i.formatMessage(p.label,{price:E(p.current)});return H?` (${H})`:""},A=()=>t.packInfo&&(t.packInfo.weight||t.packInfo.typicalWeight)?t.type==="CATCHWEIGHT"?s.jsxs(px,{className:"salt-d--inline-block","data-test":"receipt-element-product-size-details",children:[T(),p&&_()]}):s.jsx(h.Fragment,{children:t.packInfo.packSizeDescription&&s.jsx(px,{className:"salt-d--inline-block","data-test":"receipt-element-product-size-details",children:t.packInfo.packSizeDescription})}):s.jsxs(px,{className:"salt-d--inline-block","data-test":"receipt-element-product-size-details",children:[t?.size?.value,p&&_()]}),R=()=>t&&t.isInCurrentCatalog,P=()=>t&&t.isInCurrentCatalog?Uo(t.retailerProductId,kc(t.name,{isSEOReadableURLEnabled:c})):null,N=()=>{switch(e){case $g:return i.formatMessage("order.online.receipt.accessibility.item.title",{productName:t.name,productQuantity:t.quantity});case Kh:return i.formatMessage("order.online.receipt.accessibility.item.returned.title",{productName:t.name,productQuantity:t.quantity});case qh:return i.formatMessage("order.online.receipt.accessibility.item.missing.title",{productName:t.name,productQuantity:t.quantity});case zh:return i.formatMessage("order.online.receipt.accessibility.item.missing.title",{productName:t.name,productQuantity:t.quantity});case ZS:return i.formatMessage("order.online.receipt.accessibility.item.substitute.title",{productName:t.name,productQuantity:t.quantity});case JS:return i.formatMessage("order.online.receipt.accessibility.item.substitute.accepted.title",{productName:t.name,productQuantity:t.quantity});case Qh:return i.formatMessage("order.online.receipt.accessibility.item.substitute.rejected.title",{productName:t.name,productQuantity:t.quantity});default:return i.formatMessage("order.online.receipt.accessibility.item.title",{productName:t.name,productQuantity:t.quantity})}},k=r||"h3",M=()=>s.jsx(yXt,{children:s.jsx(h.Fragment,{children:s.jsx(IXt,{"data-test":"receipt-element-promotions-box",children:t.promotions.map((H,K)=>s.jsxs(CXt,{"data-test":`receipt-element-promotion-line-${K}-${H.presentationMode}`,presentationMode:H.presentationMode,children:[s.jsx(ie,{children:i.formatMessage("order.online.receipt.accessibility.item.promotion.title")}),s.jsx(SXt,{intent:"promotion",children:H.name})]},`${H&&H.id||K}-promotion`))})})}),w=()=>s.jsxs(h.Fragment,{children:[s.jsx(O,{asChild:!0,children:s.jsx(k,{children:s.jsxs(fXt,{"data-test":"receipt-element-product-name",children:[t.quantity,"x ",t.name]})})}),!d&&t.promotions?M():null]}),j=()=>s.jsxs(lXt,{children:[s.jsxs(dXt,{children:[t.image?s.jsx(cXt,{src:t.image.src,alt:t.image.title||t.name,title:t.image.title,"data-test":"receipt-element-product-image","aria-label":N()}):null,u&&s.jsx(_Xt,{wrap:"nowrap",align:"center",gap:["xs"],direction:"column",children:s.jsx(z7t,{expirationDate:t.expirationDate})})]}),s.jsxs(uXt,{"aria-hidden":!0,children:[s.jsx(pXt,{children:w()}),s.jsx(mXt,{children:S()})]})]}),G=()=>s.jsx(xe,{condensed:!0,className:"salt-p-l--1",children:s.jsx(Ji,{isActive:t.isAlcohol,overlay:s.jsx(Tu,{buttonWidth:120}),children:j()})}),W=()=>s.jsxs(aXt,{"data-test":`receipt-element-product-wrapper:${t.productId}`,children:[e&&e!==$g?s.jsx(iXt,{"aria-hidden":!0,children:y()}):null,R()?s.jsx(Ye,{intent:"ghost",to:P(),"data-test":"receipt-element-product-link",onClick:g,children:G()}):G()]});return s.jsx(h.Fragment,{children:t?W():null})};Qn.propTypes=oXt;Qn.defaultProps=rXt;Qn.ITEM_TYPE_REGULAR=$g;Qn.ITEM_TYPE_MISSING=qh;Qn.ITEM_TYPE_RETURNED=Kh;Qn.ITEM_TYPE_SUBSTITUTED=zh;Qn.ITEM_TYPE_SUBSTITUTE=ZS;Qn.ITEM_TYPE_SUBSTITUTE_ACCEPTED=JS;Qn.ITEM_TYPE_SUBSTITUTE_REJECTED=Qh;const eC=({listType:e=Ga.LIST_TYPE_REGULAR,products:t,catchWeightSubtextPosition:n="post",elementsHeadingLevelOverride:o=null})=>{const r=L(),a=f(D("ubd")),i=e===Ga.LIST_TYPE_SUBSTITUTE,l=u=>u?{catchWeight:r.formatMessage("fop.catchweight.unit")}:{},c=(u,p)=>{const g=y=>{switch(y){case Vh:return Qn.ITEM_TYPE_SUBSTITUTE;case Wh:return Qn.ITEM_TYPE_SUBSTITUTE_ACCEPTED;case Yh:return Qn.ITEM_TYPE_SUBSTITUTE_REJECTED;default:return Qn.ITEM_TYPE_SUBSTITUTE}},E=(y,I)=>{switch(y){case Ga.LIST_TYPE_REGULAR:return Qn.ITEM_TYPE_REGULAR;case Ga.LIST_TYPE_MISSING:return Qn.ITEM_TYPE_MISSING;case Ga.LIST_TYPE_RETURNED:return Qn.ITEM_TYPE_RETURNED;case Ga.LIST_TYPE_SUBSTITUTE:return"substitutes"in I?Qn.ITEM_TYPE_SUBSTITUTED:g(I.status);default:return Qn.ITEM_TYPE_REGULAR}};return s.jsx(Qn,{product:u,catchWeightSubtextPosition:n,messages:l(u),itemType:E(e,u),headingLevelOverride:o,productIndex:p})},d=a?R0(t):t;return s.jsx("div",{"data-test":"receipt-list-box",children:d?.map((u,p)=>c(u,p))})},bXt={substitutions:m.arrayOf(op).isRequired,elementsHeadingLevelOverride:m.oneOf(["h4","h5"])},xXt={elementsHeadingLevelOverride:null},tC=({substitutions:e,elementsHeadingLevelOverride:t})=>{const n=L(),o=()=>{switch(t){case"h3":return"h4";case"h4":return"h5";case"h5":return"h6";default:return"h4"}},r=(a,i)=>{const l=d=>{switch(d){case Vh:return n.formatMessage("order.online.receipt.list.substitution.heading.substitute");case Wh:return n.formatMessage("order.online.receipt.list.substitution.heading.substitute.accepted");case Yh:return n.formatMessage("order.online.receipt.list.substitution.heading.substitute.rejected");default:return null}},c=t||"h3";return s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(c,{children:l(i)})}),s.jsx(eC,{products:a,listType:Ga.LIST_TYPE_SUBSTITUTE,elementsHeadingLevelOverride:o()})]})};return s.jsx("div",{"data-test":"receipt-substitutions-list-wrapper",children:e.map((a,i)=>{const l={status:Vh,list:a.substitutes.filter(u=>Vh===u.status)},c={status:Wh,list:a.substitutes.filter(u=>Wh===u.status)},d={status:Yh,list:a.substitutes.filter(u=>Yh===u.status)};return s.jsxs("div",{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h3",{children:n.formatMessage("order.online.receipt.list.substitution.heading.substituted")})}),s.jsx(eC,{products:[a],listType:Ga.LIST_TYPE_SUBSTITUTE,elementsHeadingLevelOverride:"h4"}),[l,c,d].map(u=>u.list.length>0?r(u.list,u.status):null),i!==e.length-1?s.jsx("div",{className:"salt-m-y--4",children:s.jsx(Ts,{})}):null]},`${a&&a.productId||i}-substitution`)})})};tC.propTypes=bXt;tC.defaultProps=xXt;const AXt="HH:mm",Yae=({className:e,order:t,timeFormat:n,isDeliveryWindowEnabled:o,isPlannedDeliveryWindowEnabled:r})=>{const a=Fre(t,n,o,r);return a&&a.text?s.jsx(Te,{className:e,intent:a.type,text:a.text(),showIcon:!1}):null},nR=({orderId:e,carrierDetails:t,delivery:n,isExpanded:o})=>{const r=f(D("daddi")),[a,i]=h.useState(o),{externalAddress:l}=n||{},{name:c,iconUrl:d,iconDescription:u}=t,p=l?s.jsx(oj,{externalAddress:l}):s.jsx(s_,{delivery:n});return s.jsx("div",{className:"salt-m-t--sm salt-p-m--sm",children:s.jsxs(Je,{expanded:a,onToggle:()=>{i(!a)},aria:{expandedLabel:c,collapsedLabel:c},"data-test":"order-delivery-card",name:"order-delivery-card-collapsible-box",children:[s.jsxs(Je.ControlSection,{children:[s.jsxs(Q,{align:"center",wrap:"nowrap",as:"span",className:"salt-m-b--2",children:[s.jsx(el,{className:"salt-m-r--2",src:d,alt:c!==u?u:void 0,height:24,width:24}),s.jsx(ee,{as:O,children:c})]}),s.jsx(Je.ToggleSwitch,{})]}),s.jsxs(Je.ContentExpanded,{children:[s.jsxs(Q,{direction:"column",className:"salt-m-b--2",gap:["sm"],children:[s.jsx(O,{size:"l",bold:!0,children:s.jsx(Hm,{dates:{deliveryStartDate:n?.deliveryStartDate,deliveryEndDate:n?.deliveryEndDate,deliveryTimeInMinutes:n?.deliveryTimeInMinutes,collectionTimeInMinutes:n?.collectionTimeInMinutes,timeZoneId:n?.timeZoneId},carrierType:t.slotBookingComponent})}),p]}),r?s.jsx(Tf,{orderId:e}):s.jsx(nj,{delivery:n})]})]})})},RXt=()=>s.jsx(_e,{"data-test":"order-delivery-card-placeholder",height:"18px",className:"salt-m-y--8"});nR.Skeleton=RXt;const DXt=e=>({start:e.dates.deliveryStartDate,end:e.dates.deliveryEndDate,timeZoneId:e.dates.timeZoneId,nickname:e.addressNickName,formattedAddress:e.address,externalAddress:e.externalAddress,additionalInformation:e.additionalInformation,deliveryMethod:e.deliveryMethod,slotType:e.slotType,carrierId:e.carrierId,shippingGroupType:e.shippingGroupType,addressNotes:e.addressNotes}),A1=({isExpanded:e=!1})=>{const[t,n]=h.useState(e),{order:o}=f(As),r=f(D("daddi")),a=f(D("del.win")),i=f(D("pln.win")),l=f(D("sl.fd")),c=L(),d=f(Zt),u=f(Mt),{isReady:p,carrierDetails:g}=$m({carrierId:o?.carrierId,shippingGroupType:o?.shippingGroupType});if(!o?.dates)return null;const E=DXt(o),y=E.deliveryMethod==="CUSTOMER_COLLECTION",I=E.deliveryMethod==="HOME_DELIVERY",S=E.slotType==="ON_DEMAND",C=E.slotType==="STANDARD",T=E.start.slice(0,10)!==E.end.slice(0,10),_=y&&C&&T,A=W=>`${W.nickname} - ${W.formattedAddress}`;if(!p)return s.jsx(nR.Skeleton,{});if(g)return s.jsx(nR,{isExpanded:e,orderId:o.orderId,carrierDetails:g,delivery:{deliveryStartDate:E.start,deliveryEndDate:E.end,externalAddress:E.externalAddress,addressNotes:E.addressNotes,address:E.formattedAddress,addressNickName:E.nickname,timeZoneId:E.timeZoneId}});const R=W=>s.jsx(qn,{dateIsoFrom:W.start,dateIsoTo:W.end,timeZoneId:W.timeZoneId,local:!0,dateFormat:d,timeFormat:u}),P=W=>I&&S&&l?o.status==="DELIVERED"||o.status==="CANCELLED"||o.status==="SCRATCHED"?R(W):null:R(W),N=W=>W.additionalInformation?s.jsxs("div",{className:"salt-m-t--2",children:[s.jsx(O,{asChild:!0,size:"l",bold:!0,children:s.jsx("h3",{children:s.jsx(b,{id:"order.online.receipt.slot.delivery.instructions.title"})})}),s.jsx("div",{className:"salt-m-t--1","data-test":"order-delivery-card-special-delivery-instructions",children:s.jsx(O,{children:W.additionalInformation})})]}):null,k=W=>W.additionalInformation?s.jsx(Te,{intent:"warning",size:"s",text:`${c.formatMessage("checkout.delivery.collection.point.label")} ${W.additionalInformation}`,"data-test":"order-delivery-card-special-collection-instructions",className:"salt-p-t--2"}):null,M=()=>o.status==="DELIVERED"||o.status==="SCRATCHED"||o.status==="CANCELLED"?null:s.jsx(Te,{intent:"info",size:"s",text:c.formatMessage("order.card.reserved.fast.delivery.alert"),"data-test":"order-fast-delivery-card-special-instructions",className:"salt-p-t--2 salt-m-t--2"}),w=W=>{const H=I&&S&&l&&(!o?.deliveryInfo||o?.deliveryInfo?.currentState==="NOT_APPLICABLE");return y?k(W):r?s.jsxs(ae.Fragment,{children:[s.jsx(Tf,{orderId:o.orderId}),H&&M()]}):s.jsxs(ae.Fragment,{children:[N(W),H&&M()]})},j=()=>s.jsx(b,{id:"express.collection.delivery.card.title"}),G=()=>y?s.jsx(b,{id:"order.online.receipt.slot.collection.title"}):I&&S&&l?o.status==="DELIVERED"||o.status==="CANCELLED"||o.status==="SCRATCHED"?c.formatMessage("order.details.fast.delivery.title"):c.formatMessage("order.card.reserved.fast.delivery.title",{time:$o(o.dates.deliveryEndDate,o.dates.timeZoneId,AXt)}):s.jsx(b,{id:"order.online.receipt.slot.delivery.title"});return s.jsx("div",{className:"salt-m-y--4",children:s.jsxs(Je,{expanded:t,onToggle:()=>{n(!t)},aria:{expandedLabel:c.formatMessage("order.online.receipt.slot.delivery.title"),collapsedLabel:c.formatMessage("order.online.receipt.slot.delivery.title")},"data-test":"order-delivery-card",name:"order-delivery-card-collapsible-box",children:[s.jsxs(Je.ControlSection,{children:[s.jsx(ee,{"data-test":"delivery-type-title",as:"span",children:S&&!I||_?j():G()}),s.jsx(Je.ToggleSwitch,{})]}),s.jsx(Je.ContentExpanded,{children:s.jsxs("div",{className:"salt-p-t--4",children:[s.jsx(O,{size:"l",bold:!0,"data-test":"order-delivery-slot-info",children:P(E)}),s.jsx("div",{className:"salt-m-t--1",children:s.jsx(O,{"data-test":"order-delivery-address-info",children:A(E)})}),w(E),s.jsx(Yae,{className:"salt-m-t--2",order:o,timeFormat:u,isDeliveryWindowEnabled:a,isPlannedDeliveryWindowEnabled:i})]})})]})})},OXt=e=>D("invoifram")(e)&&hC(e),PXt=(e,t)=>{switch(e){case"PENDING_PAYMENT":return{type:"warning",message:"order.details.pending.payment"};case"FAILED_PENDING_PAYMENT":return{type:"error",message:"order.details.pending.payment.failed"};case"EDIT_EXPIRED":return{type:"info",message:t?"order.online.receipt.alert.after.cut.off":"order.online.receipt.alert.after.cut.off.pdf.receipt.disabled"};case"PICKED":return{type:"info",message:t?"order.online.receipt.alert.after.cut.off":"order.online.receipt.alert.after.cut.off.pdf.receipt.disabled"};default:return null}},NXt=D("mpv"),LXt={intl:m.any.isRequired,actions:m.shape({sendAnalyticsEvent:m.func.isRequired,openChangeStoreModal:m.func.isRequired,fetchCreatedRefundRequest:m.func.isRequired}).isRequired,orderId:m.string,order:m.shape({lastUpdated:m.number,isFetching:m.bool,error:m.shape({statusCode:m.number}),order:lr}).isRequired,groupedProducts:m.shape({products:m.arrayOf(op),missings:m.arrayOf(op),returns:m.arrayOf(op),substitutes:m.arrayOf(op)}),sellers:m.arrayOf(m.shape({sellerId:m.string,sellerName:m.string})),requestedForRefundItems:m.arrayOf(m.shape({})),productsByProductId:m.objectOf(sl).isRequired,loading:m.bool,locale:m.string.isRequired,isExternal:m.bool.isRequired,isInvoiceRequestFormEnabled:m.bool.isRequired,failedPaymentsData:m.shape({orderId:m.string}),isOrderMultiPaymentsEnabled:m.bool.isRequired},kXt={orderId:void 0,loading:!1,groupedProducts:{products:[],missings:[],returns:[],substitutes:[]},sellers:[],requestedForRefundItems:[],failedPaymentsData:null,isOrderMultiPaymentsEnabled:!1},ZM=e=>{const{intl:t,actions:n,orderId:o,order:r,groupedProducts:a,sellers:i,requestedForRefundItems:l,productsByProductId:c,locale:d,isExternal:u,isInvoiceRequestFormEnabled:p,failedPaymentsData:g,isOrderMultiPaymentsEnabled:E}=e,[y,I,S,C,T]=Ee(["or.sg","slfsrv.refunds","rec.o","ord.pdf","bam"]);h.useEffect(()=>{I&&!u&&n.fetchCreatedRefundRequest(o,d)},[]);const[_,A]=h.useState(!1),R=()=>{A(!0)},P=()=>{const ce=["EDITABLE","EDIT_EXPIRED","PENDING_PAYMENT"].filter(Ae=>Ae===r.order.editStatus).length>0?r.order.editStatus:null,me=g?"FAILED_PENDING_PAYMENT":ce||r.order.status,De=PXt(me,!!C),ge=r.order.dates.confirmOrderChangesBy,Se=!ge||Pd(Ni(),ge);return!De&&!Se?null:s.jsxs(ae.Fragment,{children:[Se&&s.jsx(Te,{className:"salt-m-t--2 salt-m-b--2 md:salt-m-t--4 md:salt-m-b--4",intent:"info","data-test":"cutoff-alert",text:s.jsx(b,{id:"order.online.receipt.alert.delivered"})}),De&&s.jsx(Te,{className:"salt-m-t--2 salt-m-b--2 md:salt-m-t--4 md:salt-m-b--4",intent:De.type,"data-test":"order-informative-alert",text:s.jsx(b,{id:De.message})})]})},N=(ce,me)=>{const De=!!me?.length,ge=!!ce?.products?.length,Se=!!ce?.substitutes?.length,Ae=!!ce?.missings?.length,Ce=!!ce?.returns?.length,We=[De,ge,Se,Ae,Ce].filter(Boolean).length>1;return{hasRefundRequests:De,hasReceivedItems:ge,hasSubstitutedItems:Se,hasMissingItems:Ae,hasReturnedItems:Ce,hasMoreThanOneGroup:We}},k=()=>{if(r?.order&&a){const{primarySellerId:ce,primarySellerName:me}=r.order,ge=$9t(a,i,{sellerId:ce,sellerName:me},d),Se=N(a,l).hasMoreThanOneGroup;return s.jsxs(h.Fragment,{children:[l?.length>0&&W(l),ge.map(({sellerName:Ae,products:Ce})=>s.jsx(jae,{sellerName:Ae,children:w(Ce,[],Se)}))]})}return null},M=(ce,me)=>{const De={};for(const ge in me){const Se=me[ge];Se&&Se.productId!==void 0&&(De[Se.productId]=Se)}return ce.map(ge=>{const Se=De[ge.productId],Ae=Se?{...ge,...Se}:ge;return ge.substitutes&&(Ae.substitutes=ge.substitutes.map(Ce=>{const We=De[Ce.productId];return We?{...Ce,...We}:Ce})),Ae})},w=(ce,me,De=!1)=>{if(!r.order)return null;const{hasMoreThanOneGroup:ge,hasRefundRequests:Se,hasMissingItems:Ae,hasSubstitutedItems:Ce,hasReceivedItems:We,hasReturnedItems:et}=N(ce,me);if(ge||De){const ve=[Se&&W(me),Ae&&X(M(ce.missings,c)),Ce&&K(M(ce.substitutes,c)),We&&H(M(ce.products,c)),et&&q(M(ce.returns,c))].filter(Boolean);return s.jsx(h.Fragment,{children:ve})}else{if(We)return j(M(ce.products,c),"products");if(Ce)return G(M(ce.substitutes,c));if(Ae)return j(M(ce.missings,c),"missing");if(et)return j(M(ce.returns,c),"returns")}return null},j=(ce,me)=>s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:t.formatMessage(`order.online.receipt.accessibility.list.${me}`)})}),s.jsx(eC,{products:ce})]}),G=ce=>s.jsx(tC,{substitutions:ce}),W=ce=>I&&!u?s.jsxs(rs,{"data-test":"refund-request-items-accordion",children:[s.jsx(rs.Title,{active:!0,"aria-label":t.formatMessage("order.online.receipt.accessibility.list.refunds"),children:s.jsx(O,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"order.details.requested-for-refund.items.title"})})})}),s.jsx(rs.Content,{active:!0,className:"salt-p-l--0 salt-p-r--0",children:s.jsx(zM,{type:"requested",isFetching:r.isFetching,refundables:ce,productsByProductId:c})})]}):null,H=ce=>ne(ce,Ga.LIST_TYPE_REGULAR,"order.details.products.title","received-items","products"),K=ce=>s.jsxs(rs,{"data-test":"substituted-items-accordion",children:[s.jsx(rs.Title,{active:!0,"aria-label":t.formatMessage("order.online.receipt.accessibility.list.substitutions"),children:s.jsx(O,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"order.details.substituted.items.title","data-test":"order-online-receipt-substituted-items-accordion-title"})})})}),s.jsx(rs.Content,{active:!0,className:"salt-p-l--0 salt-p-r--0",children:s.jsx(tC,{substitutions:ce})})]}),X=ce=>ne(ce,Ga.LIST_TYPE_MISSING,"order.details.missing.items.title","missing-items","missing"),q=ce=>ne(ce,Ga.LIST_TYPE_RETURNED,"order.details.returned.items.title","returned-items","returns"),ne=(ce,me,De,ge,Se)=>s.jsxs(rs,{"data-test":`${ge}-accordion`,children:[s.jsx(rs.Title,{active:!0,"aria-label":t.formatMessage(`order.online.receipt.accessibility.list.${Se}`),children:s.jsx(O,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:De,"data-test":`order-online-receipt-${ge}-accordion-title`})})})}),s.jsx(rs.Content,{active:!0,className:"salt-p-l--0 salt-p-r--0",children:s.jsx(eC,{products:ce,listType:me})})]}),ue=()=>S&&r?.order?.recurringShoppingDefinition&&s.jsx(Rf,{className:"salt-m-y--4",orderId:r.order.orderId,recurringShoppingDefinition:r.order.recurringShoppingDefinition}),oe=()=>s.jsx("div",{className:"salt-m-y--4",children:s.jsx(G7t,{orderId:o,handleEditOrderButtonClick:R,isOrderMultiPaymentsEnabled:E})}),ye=()=>s.jsx(Wae,{loading:e.loading}),he=()=>{if(I&&r&&r.order){const{order:{status:ce,dates:me}}=r;return s.jsx(Mae,{orderStatus:ce,orderDeliveryStartDate:me.deliveryStartDate,orderTimeZone:me.timeZoneId,orderId:o,intl:t})}return null},Ie=()=>T?s.jsx(D7t,{orderBillingAddress:{...r?.order?.billingAddressDetails?.addressDetails,...r?.order?.billingAddressDetails?.customerDetails},isFetching:_}):null,Fe=()=>s.jsx(O7t,{}),be=()=>r&&r.order&&r.order.status&&r.order.status!=="CANCELLED"&&r.order.status!=="SCRATCHED"?s.jsx(Gae,{orderId:r.order.orderId,orderStatus:r.order.status}):null;if(!r.error&&r.lastUpdated&&!r.isFetching){const{primarySellerId:ce,primarySellerName:me}=r.order;return s.jsxs(h.Fragment,{children:[s.jsxs(V,{"data-test":"order-online-receipt",className:"md:salt-m-x--4 md:salt-p-x--2 salt-m-x--0",children:[s.jsx(Lt,{remainInDom:!1,breakpoint:"sm-up",children:s.jsxs(V.Item,{colSpan:{xs:12,md:0},children:[ue(),oe(),s.jsx(A1,{}),Ie(),E?Fe():s.jsx(b1,{}),ye(),he(),p?be():null]})}),s.jsxs(V.Item,{colSpan:{xs:12,md:8},children:[r.order&&P(),s.jsx("div",{"data-test":"products-container",className:"salt-m-t--4",children:y&&ce&&me?k():w(a,l)})]}),s.jsx(Kt,{remainInDom:!1,breakpoint:"sm-up",children:s.jsxs(V.Item,{colSpan:{sm:12,md:4},children:[ue(),oe(),s.jsx(A1,{}),Ie(),E?Fe():s.jsx(b1,{}),ye(),he(),p?be():null]})})]}),r?.order?.orderId&&s.jsxs(h.Fragment,{children:[s.jsx(Fj,{orderId:r.order.orderId,sendPageView:!0}),s.jsx(wj,{})]}),c&&s.jsx(Uae,{})]})}return null},jXt=(e,t)=>{const n=_v(e,t.orderId);return{order:As(e),groupedProducts:AP(e),sellers:bv(e),requestedForRefundItems:WM(e),productsByProductId:mo(e),paymentSummary:Nc(e),locale:Ms(e),isExternal:PE(e),isOrderUnderEdit:n,isInvoiceRequestFormEnabled:OXt(e),failedPaymentsData:F5(e,t.orderId),isOrderMultiPaymentsEnabled:NXt(e)}},MXt=st({sendAnalyticsEvent:U.analyticsEvent,openChangeStoreModal:e=>J.openModal("changeStore",e),fetchCreatedRefundRequest:Ah.fetchCreatedRefundRequest});ZM.propTypes=LXt;ZM.defaultProps=kXt;const wXt=Tt(Ht,we(jXt,MXt))(ZM),FXt=D("rec.o"),BXt=D("roid"),UXt=D("mpv"),GXt=e=>e&&e.isBefore(qe().utcOffset(e.format("Z")).add(2,"days").startOf("day")),mx={EDITABLE:{heading:"order.details.heading.future.edit.until"},OTHER_UNDER_EDIT:{heading:"order.details.heading.future.edit.until"},UNDER_EDIT:{heading:"order.details.heading.future.edit.until"},EDIT_EXPIRED:{heading:"orders.list.card.status.future.edit.expired"},PENDING_PAYMENT:{heading:"order.details.heading.future.edit.pending.payment"},DELIVERED:{heading:"order.details.heading.delivered"},PICKED:{heading:"order.details.heading.picked"},CANCELLED:{heading:"order.details.heading.canceled"},SCRATCHED:{heading:"order.details.heading.scratched"},DEFAULT:{heading:"order.details.heading.future"}},$Xt=(e,t,n)=>{if(e){const o=qe(e).tz(n);return GXt(o)?o.calendar():o.format(t)}return null},R1=(e,t)=>{switch(e){case"YOU_ARE_NEXT":return{heading:"logged.in.home.page.order.card.title.you.are.next"};case"WE_ARE_ON_THE_WAY":return{heading:"logged.in.home.page.order.card.title.we.are.on.the.way"};case"WE_ARE_HERE":return{heading:"logged.in.home.page.order.card.title.we.are.here"};default:return{heading:t}}},HXt=(e,t,n)=>{if(!e)return null;const{status:o,editStatus:r,dates:a}=e;let i=mx.DEFAULT;switch(o){case"FUTURE":i=r==="EDIT_EXPIRED"?R1(e?.deliveryInfo?.currentState,"orders.list.card.status.future.edit.expired"):mx[r];break;case"PICKED":i=R1(e?.deliveryInfo?.currentState,"order.details.heading.picked");break;default:i=mx[o]}return i?.heading?n.formatMessage(i.heading,{editUntilDate:$Xt(a.confirmOrderChangesBy,t,a.timeZoneId)}):null},Yu=v(pe)`
    margin-inline-end: var(--salt-spacing-1);
`,D1="order-summary",O1="order-again",VXt=({match:e,initialTab:t})=>{const n=L(),o=F(),r=f(WH),a=f(As),{order:i}=a,l=f(Rt),c=f(ude),d=f(FXt),u=f(Tl),p=f(sa),g=f(BXt),E=f(UXt),y={getOrder:P=>o(jo.getDecoratedOrderCall(P)),getRecurringShoppingDefinitions:()=>o(mi.getRecurringShoppingDefinitions()),openChangeStoreModal:P=>o(J.openModal(WA,P)),getOrderMultiPayments:P=>o(qr.getOrderMultiPayments(P))};h.useEffect(()=>{(T()||!l)&&(a.isFetching||(y.getOrder(e.params.orderId),d&&y.getRecurringShoppingDefinitions(),i&&!I()&&S(),E&&y.getOrderMultiPayments(e.params.orderId)))},[]);const I=()=>!(u==="STORE"&&i?.retailerRegionId!==p),S=()=>{const P=`${window.location.origin}${kd(i?.retailerRegionId)}${cn(i?.orderId)}`,N=`${window.location.origin}${kd(i?.retailerRegionId)}${lo()}`,k={title:"orders.list.change.store.modal.title",message:"orders.list.change.store.modal.message",cancel:"orders.list.change.store.modal.cancel",confirm:"orders.list.change.store.modal.confirm"};y.openChangeStoreModal({redirectUrl:P,cancelRedirectUrl:N,messages:k})},C=()=>!r,T=()=>i&&e.params.orderId===i.orderId,_=()=>{const P=i?.orderId??"",N=i?.orderReference;return g&&N&&N!==P?`${P} (${N})`:P},A=()=>{if(!i)return null;const{status:P,editStatus:N}=i;return P==="FUTURE"?N==="PENDING_PAYMENT"?null:N==="EDIT_EXPIRED"&&i?.deliveryInfo?.currentState?s.jsx(Yu,{name:"home_delivery",height:30,width:30,"data-test":"order-details-heading-icon-home_delivery"}):s.jsx(Yu,{name:"orders_placed",height:30,width:30,"data-test":"order-details-heading-icon-orders-placed"}):P==="CANCELLED"||P==="SCRATCHED"?s.jsx(Yu,{error:!0,name:"status_no",height:30,width:30,"data-test":"order-details-heading-icon-cross"}):P==="PICKED"?s.jsx(Yu,{name:"home_delivery",height:30,width:30,"data-test":"order-details-heading-icon-home-delivery"}):P==="DELIVERED"?s.jsx(Yu,{success:!0,name:"status_yes",height:30,width:30,"data-test":"order-details-heading-icon-tick"}):s.jsx(Yu,{name:"orders_placed",height:30,width:30,"data-test":"order-details-heading-icon-orders-placed"})},R=()=>s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"order.details.page.title",values:{orderId:i?.orderId??""}}),s.jsxs(sn,{"data-test":"order-view-switch-bar",className:"md:salt-p-x--8",children:[s.jsxs("div",{className:"salt-d--flex",children:[A(),s.jsx(ee,{as:"h1","data-test":"order-details-heading-title",children:HXt(i,c,n)})]}),s.jsxs(O,{"data-test":"order-details-order-reference",children:[s.jsx(b,{id:"order.details.subheading.orderId"}),":"," ",_()]})]}),i?.external&&C()&&s.jsx(Te,{className:"md:salt-m-x--8 salt-m-x--2",intent:"warning","data-test":"external-order-alert",showIcon:!1,text:s.jsx(b,{id:"order.details.external.message"})})]});return!a.error&&a.lastUpdated&&!a.isFetching&&I()?s.jsxs(h.Fragment,{children:[i&&R(),s.jsxs(il,{selectedId:t,children:[s.jsxs(il.TabList,{children:[s.jsx(il.Tab,{id:D1,"data-test":"order-summary-tab-button",children:n.formatMessage("order.details.tab.order.summary.title")}),s.jsx(il.Tab,{id:O1,"data-test":"order-again-tab-button",children:n.formatMessage("order.details.tab.order.again.title")})]}),s.jsx(il.TabPanel,{id:D1,children:s.jsx(wXt,{orderId:e.params.orderId})}),s.jsx(il.TabPanel,{id:O1,children:s.jsx(Q9t,{})})]})]}):a.error?a.error.statusCode===404?s.jsx(ot,{}):s.jsx(jn,{}):null},hx={EDITABLE:{heading:"order.details.heading.future",headingMessage:"order.details.heading.message.editable"},OTHER_UNDER_EDIT:{heading:"order.details.heading.future"},UNDER_EDIT:{heading:"order.details.heading.future"},EDIT_EXPIRED:{heading:"order.details.heading.future",headingMessage:"order.details.heading.message.edit.expired"},DELIVERED:{heading:"order.details.heading.delivered"},PICKED:{heading:"order.details.heading.picked",headingMessage:"order.details.heading.message.edit.expired"},CANCELLED:{heading:"order.details.heading.canceled"},SCRATCHED:{heading:"order.details.heading.scratched"},DEFAULT:{heading:"order.details.heading.future"}},WXt=({order:e})=>{const t=f(Zt),n=f(Mt),o=L(),[r,a]=Ee(["csoei","roid"]);if(!e)return null;const{dates:i,status:l,editStatus:c}=e,d=(l==="FUTURE"?hx[c]:hx[l])||hx.DEFAULT,u={heading:d.heading&&o.formatMessage(d.heading),headingMessage:d.headingMessage&&o.formatMessage(d.headingMessage)},p=()=>{const E=e?.orderId??"",y=e?.orderReference;return a&&y&&y!==E?`${E} (${y})`:E},g=()=>i?.deliveryStartDate&&i?.deliveryEndDate?s.jsxs(ee,{as:"h1",children:[u.heading,":"," ",s.jsx(qn,{dateIsoFrom:i.deliveryStartDate,dateIsoTo:i.deliveryEndDate,timeZoneId:i.timeZoneId,dateFormat:t,timeFormat:n})]}):s.jsx(ee,{as:"h1",children:u.heading});return s.jsxs(h.Fragment,{children:[r&&e.editStatus==="UNDER_EDIT"?s.jsx(ee,{as:"h1",children:u.heading}):g(),s.jsxs(O,{"data-test":"order-details-heading-subheading",children:[s.jsx(b,{id:"order.details.subheading.orderId"}),": ",p()]}),u.headingMessage&&s.jsx(O,{"data-test":"order-details-heading-message",className:"salt-p-y--4 salt-p-x--1",children:u.headingMessage})]})},Zl=({items:e=[],missing:t,substitute:n,returned:o,isFetching:r,"data-test":a,shouldRenderHeader:i=!0})=>{const l=f(mo),c=e?.length&&e.every(({product:g})=>g),d=e.flatMap(({product:g})=>g?.productId?[g.productId]:[]),u=c?e.reduce((g,E,y)=>{const I=E.product?.productId,S=I&&l&&l[I];return I&&(g[I]={...S,quantityInOrder:E.quantity,substitute:!!n,rejected:E.accepted===!1,accepted:!!E.accepted,missing:t||n&&y===0,returned:!!o,isInCurrentCatalog:E.isInCurrentCatalog}),g},{}):{},p=()=>t?Ut.MISSING:n?Ut.SUBSTITUTED:o?Ut.RETURNED:Ut.DELIVERED;return s.jsxs(h.Fragment,{children:[i&&s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"order.details.products.title"})})}),s.jsx(uo,{productGroups:[{products:d,groupTitle:p(),section:p()}],productsByProductId:u,page:"order-details",type:"order",isFetching:r,"data-test":a},`${c}`)]})},qae=se("CART_REBOOK"),YXt=e=>({type:"API",payload:{url:"/v1/carts/active/rebook",pathPrefix:{client:"/api/cart",server:"/core-api"},service:"web_basket_ws",options:{body:{orderId:e},method:"PUT"},...qae}}),qXt={rebook:YXt,types:{CART_REBOOK:qae}},KXt=(e,t)=>async n=>{let o=null;try{o=(await n(qXt.rebook(e)))?.payload?.responseData}catch(r){throw Z.error("toast.notification.generic.error"),r}return n(J.closeModal()),t(jt()),o},zXt={rebook:KXt},QXt=D("m.la.h"),XXt={isOpen:m.bool.isRequired,isBasketUnderEdit:m.bool.isRequired,order:lr.isRequired,rebookAction:m.func.isRequired,actions:m.shape({prepareCheckout:m.func.isRequired,closeModal:m.func.isRequired}).isRequired,modalLeftAlignEnabled:m.bool},ZXt={modalLeftAlignEnabled:!1},P1={basketUnderEdit:{header:"order.rebook.order.under.edit.modal.title",body:"order.rebook.order.under.edit.modal.text",saveChanges:"order.rebook.order.under.edit.saveChanges"},basketHasItems:{header:"order.rebook.modal.basket.has.items.modal.title",body:"order.rebook.basket.has.items.modal.text",cancelChanges:"order.rebook.basket.has.items.cancel",saveChanges:"order.rebook.basket.has.items.ok"}},JM=({actions:e,isBasketUnderEdit:t,isOpen:n,order:o,rebookAction:r,modalLeftAlignEnabled:a})=>{const i=Ge(),[l,c]=h.useState(!1),{orderId:d}=o,u="rebook-modal-header",p=t?P1.basketUnderEdit:P1.basketHasItems,g=()=>t?(c(!0),e.prepareCheckout().then(({canCheckout:E,redirect:y})=>(c(!1),i(E?na():y))).catch(()=>{c(!1)})):r({orderId:d});return s.jsxs(B,{isOpen:n,onRequestClose:e.closeModal,aria:{labelledby:u},children:[s.jsx(B.Header,{align:a?"left":"center",children:s.jsx(ee,{as:"h2",id:u,"data-test":"rebook-modal",children:s.jsx(Nt,{id:p.header})})}),s.jsx(B.Body,{children:s.jsx(Nt,{id:p.body})}),s.jsx(B.Footer,{className:"salt-d--block",align:a?"left":"center",children:s.jsxs(V,{flush:!0,children:[!t&&s.jsx(V.Item,{colSpan:{xs:12,md:6},xs:12,md:6,children:s.jsx(x,{className:"salt-m-t--2 md:salt-m-t--4",fill:!0,intent:"secondary",onClick:e.closeModal,"data-test":"rebook-modal-under-edit-dismiss",children:s.jsx(x.Text,{children:s.jsx(Nt,{id:p.cancelChanges})})})}),s.jsx(V.Item,{colSpan:{xs:12,md:t?12:6},children:s.jsx(x,{className:"salt-m-t--2 md:salt-m-t--4",fill:!0,intent:"primary",onClick:g,"data-test":"rebook-modal-confirm",loading:l,children:s.jsx(x.Text,{children:s.jsx(Nt,{id:p.saveChanges})})})})]})})]})};JM.propTypes=XXt;JM.defaultProps=ZXt;const JXt=e=>({isOpen:$e("rebook")(e),isBasketUnderEdit:Ar(e),modalLeftAlignEnabled:QXt(e)}),eZt=st({prepareCheckout:lf,closeModal:J.closeModal}),tZt=we(JXt,eZt)(JM),sZt={order:lr.isRequired},{openModal:nZt}=J,ew=({order:e})=>{const t=Ge(),n=f(Hi),o=F(),r=()=>{o(nZt("rebook"))},a=({orderId:l})=>o(zXt.rebook(l,t)),i=()=>n?r():a({orderId:e.orderId});return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"action",fill:!0,onClick:i,"data-test":"rebook-button",children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"order.details.rebook"})})}),s.jsx(tZt,{order:e,rebookAction:a})]})};ew.propTypes=sZt;const oZt=D("csoei");class rZt extends h.Component{constructor(t){super(t),this.state={isCheckoutLoading:!1},this.confirmCheckout=this.confirmCheckout.bind(this)}handleBasketBelowThreshold(){const{basketThreshold:t,intl:n,currencyFormat:o}=this.props,r=ii(n.formatNumber,t,o);return Z.info({key:"basket.below.threshold.error",substitutions:{threshold:r}})}confirmCheckout(){const{actions:t,isBasketBelowThreshold:n,order:o}=this.props;t.analyticsEvent({type:Re.CHECKOUT_ORDER_BUTTON_CLICKED,orderId:o.orderId,minSpendReached:!n});const r={event:"cart_checkout",order_id:o.orderId};return te.sendEvent({GA:r,WA:null}),n?this.handleBasketBelowThreshold():(this.setState({isCheckoutLoading:!0}),t.prepareCheckout().then(({canCheckout:a,redirect:i})=>a?(t.extendSlot(),t.analyticsEvent({type:Zn.CHECKOUT_WALK}),this.props.navigate(na())):this.props.navigate(i)).catch(()=>{this.setState({isCheckoutLoading:!1})}))}render(){const{isNewCheckoutButtonMessageEnabled:t}=this.props;return s.jsx(x,{intent:"action",fill:!0,onClick:this.confirmCheckout,"data-test":"save-edit-button","data-synthetics":"save-edit-button",loading:this.state.isCheckoutLoading,children:s.jsx(x.Text,{children:s.jsx(b,{id:t?"order.continue.checkout.to.save.changes":"order.continue.checkout"})})})}}const aZt=e=>({isBasketBelowThreshold:MR(e),dateFormat:Zt(e),timeFormat:Mt(e),basketThreshold:Jg(e),isNewCheckoutButtonMessageEnabled:oZt(e),currencyFormat:Bi(e)}),iZt=st({analyticsEvent:U.analyticsEvent,prepareCheckout:lf,extendSlot:UX.extendSlot}),Kae=Tt(Ht,we(aZt,iZt))(rZt),lZt={order:lr.isRequired,actions:m.shape({openCancelChangesModal:m.func.isRequired}).isRequired},zae=({order:e,actions:t})=>{const{orderId:n}=e;return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",fill:!0,onClick:()=>t.openCancelChangesModal(n),"data-test":"cancel-changes-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.undo.changes"})})}),s.jsx(vk,{orderId:n,page:"order-details"})]})},cZt=st({openCancelChangesModal:e=>J.openModal(`cancelChanges${e}`)});zae.propTypes=lZt;const dZt=we(null,cZt)(zae),uZt={order:lr.isRequired},OI=({order:{orderId:e}})=>{const t=F(),n=()=>{t(J.openModal(`cancelOrder${e}`))};return s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"secondary",fill:!0,onClick:n,"data-test":"cancel-order-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"order.cancel"})})}),s.jsx(Tk,{orderId:e,page:"order-details"})]})};OI.propTypes=uZt;const pZt={order:lr.isRequired},Zo=({order:e})=>{const t=F(),n=Ge(),o=f(Hi),r=f(Tl),a=f(sa),i=()=>{t(J.openModal($M))},l=({orderId:u,emptyCart:p})=>{t(Nae.buyAgain({orderId:u,emptyCart:p,navigate:n}))},c=()=>o?i():l({orderId:e.orderId}),d=()=>r==="STORE"&&e.retailerRegionId!==a;return s.jsx("div",{children:!d()&&s.jsxs(h.Fragment,{children:[s.jsx(x,{intent:"action",fill:!0,onClick:c,"data-test":"buy-again-button",children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"order.buy.again"})})}),s.jsx(Lae,{order:e,buyAgainAction:l})]})})};Zo.propTypes=pZt;const mZt={order:lr.isRequired},Qae=({order:e})=>{const t=oV(e.orderId);return s.jsxs(x,{intent:"secondary",fill:!0,"data-test":"order-receipt-button",children:[s.jsx(x.Icon,{name:"pdf"}),s.jsx(tt,{href:t,target:"_blank",standalone:!0,bold:!0,children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"order.details.receipt"})})})]})};Qae.propTypes=mZt;const ph={UNDER_EDIT:{buttons:[Kae,dZt,OI]},EDITABLE:{buttons:[QM,OI]},OTHER_UNDER_EDIT:{buttons:[OI,Zo]},EDIT_EXPIRED:{buttons:[Zo]},DELIVERED:{buttons:[Zo]},PICKED:{buttons:[Zo]},CANCELLED:{buttons:[Zo]},SCRATCHED:{buttons:[Zo]},DEFAULT:{buttons:[Zo]}},hZt=e=>{const{status:t,editStatus:n,hasReceipt:o}=e;let r;return t==="FUTURE"?r=ph[n]:o&&t==="DELIVERED"?r={...ph[t],buttons:[Qae,...ph[t].buttons]}:t==="SCRATCHED"&&e.rebookable?r={buttons:[ew]}:r=ph[t],r||ph.DEFAULT},gZt=()=>{const e=f(As);if(!e.order||!e.order.status||!e.order.editStatus)return null;const t=hZt(e.order);if(!t)return null;const n=t.buttons.map(o=>s.jsxs(h.Fragment,{children:[s.jsx(o,{order:e.order}),s.jsx("div",{className:"salt-m-y--4"})]}));return s.jsx(h.Fragment,{children:n})},gx={UNDER_EDIT:Kae,EDITABLE:QM,OTHER_UNDER_EDIT:Zo,EDIT_EXPIRED:Zo,DELIVERED:Zo,PICKED:Zo,CANCELLED:Zo,SCRATCHED:Zo,DEFAULT:Zo},EZt=e=>{let t=gx[e.status];return e.status==="FUTURE"?t=gx[e.editStatus]:e.status==="SCRATCHED"&&e.rebookable&&(t=ew),t||gx.DEFAULT},fZt=({order:e})=>{const t=EZt(e.order);return s.jsx(t,{order:e.order})},yZt=Ro(["loyalty","loyear"]),IZt=D("loyear.csm"),SZt=Ro(["loyalty","loyred"]),CZt=D("tp"),vZt=D("pay.check.show"),TZt=D("tx.nts"),_Zt=Wn(["sumsub","bt.spl"]),bZt=D("cs.ps"),xZt=D("prp"),AZt=D("sib"),RZt={...Oae,missing:[],products:[],requestedForRefund:[],returned:[],substituted:[],loyaltyEarnings:null,externalWalletManagement:!1,locale:"",isTaxInclusionNoteEnabled:!1};class DZt extends h.Component{formattedMessages;static defaultProps=RZt;constructor(t){super(t),this.formattedMessages={summaryTitle:t.intl.formatMessage("order.details.summary.title")},this.hasOrderIdInUrlChanged=this.hasOrderIdInUrlChanged.bind(this),this.state={expanded:!1,loadedViewPortSize:!1},this.sendSummaryToggledAnalyticsEvent=this.sendSummaryToggledAnalyticsEvent.bind(this),this.setCollapsibleSummaryExpanded=this.setCollapsibleSummaryExpanded.bind(this),this.isMobileLayout=this.isMobileLayout.bind(this),this.getTotalPrice=this.getTotalPrice.bind(this)}componentDidMount(){this.setState({loadedViewPortSize:!0}),this.setCollapsibleSummaryExpanded()}setCollapsibleSummaryExpanded(){const t=typeof window<"u"&&window.matchMedia(`(min-width: ${Ke.sm}em)`).matches;t!==this.state.expanded&&this.setState({expanded:t})}componentDidUpdate(t){const{isOrderUnderEdit:n}=this.props;n!==t.isOrderUnderEdit&&this.setCollapsibleSummaryExpanded()}hasOrderIdInUrlChanged(t){const{orderEntity:n,match:o}=this.props;return!n.isFetching&&!!t.match.params.orderId&&!!o.params.orderId&&t.match.params.orderId!==o.params.orderId}isCurrentOrderTheActiveOne(){const{order:t}=this.props.orderEntity;return!!(t&&this.props.match.params.orderId===t.orderId)}isMobileLayout(){return!(typeof window<"u"&&window.matchMedia(`(min-width: ${Ke.lg}em)`).matches)}sendSummaryToggledAnalyticsEvent(t){const n=t?Fo.SUMMARY_COMPONENT_COLLAPSED:Fo.SUMMARY_COMPONENT_EXPANDED,o=t?"User collapsed the summary component":"User expanded the summary component";this.props.actions.sendAnalyticsEvent({type:n,description:o})}getTotalPrice(){const{paymentSummary:t,isOrderUnderEdit:n,isSummarySubtotalEnabled:o}=this.props;return n?o?t?.totals?.display?.itemPriceAfterPromos:t?.totals?.totalPrice:t?.totalPrice}render(){const{quantity:t,paymentSummary:n,getLoyaltySpent:o,getLoyaltyEarned:r,isLoyaltyRedeemEnabled:a,isLoyaltyEarningEnabled:i,loading:l,rebookable:c,orderEntity:d,isOrderUnderEdit:u,isShowPaymentChecksEnabled:p,isExternal:g,isTaxInclusionNoteEnabled:E,isSummarySubtotalEnabled:y,isPlusSignEnabled:I,isLoyaltyEarningMovedToSummaryEnabled:S,isToggleablePromotionsEnabled:C,intl:T,isReferencePrice:_,isSavingsBanner:A}=this.props,{expanded:R}=this.state,{paymentInfo:P}=n,{paymentAmountSplitPerMethods:N}=P||{},k=q=>(N?.find(ne=>ne.paymentMethod===q)||{})?.total,M=q=>{this.sendSummaryToggledAnalyticsEvent(R),q.preventDefault(),this.setState(ne=>({expanded:!ne.expanded}))};if(!this.isCurrentOrderTheActiveOne()||!this.state.loadedViewPortSize)return s.jsxs(Kt,{breakpoint:"sm-up","data-test":"summary",children:[s.jsx(js,{title:this.formattedMessages.summaryTitle,children:s.jsx(js.Skeleton,{})}),s.jsx(le.Buttons,{loading:!0,children:s.jsx(gZt,{})})]});const w=I?"always":"auto",j=T.formatMessage(y&&u?"summary.subtotal":"summary.total"),G=y&&u?T.formatMessage("summary.subtotal.price.note"):void 0,W=this.getTotalPrice(),H=u?n?.totals?.itemsRetailPrice:n?.itemsRetailPrice,K=u?n?.totals?.display?.itemPriceAfterPromos:n.itemPriceAfterPromos,X=!!Number(n?.savings?.amount);return s.jsxs("div",{className:"salt-m-y--4",children:[s.jsxs(cs,{expanded:R,onToggle:M,breakpoint:"sm-up",sticky:!0,aria:{contentLabel:T.formatMessage("order.details.summary.title"),totalPrice:W&&ii(T.formatNumber,W,"")},children:[s.jsxs(cs.ControlSection,{children:[R?s.jsx(ee,{as:"span",children:s.jsx(b,{id:"order.details.summary.title"})}):s.jsx(le.TotalInline,{loading:!n,totalPrice:W,withTaxNote:E,title:j,note:G}),s.jsx(cs.ToggleSwitch,{})]}),s.jsxs(cs.Content,{children:[!g&&s.jsxs(h.Fragment,{children:[s.jsxs(fe,{children:[s.jsx(le.Items,{itemsRetailPrice:H,quantity:t,withTaxNote:E}),s.jsx(le.Savings,{savings:n?.savings}),A&&_&&X&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"}),s.jsx(le.SavingsWithPaymentMethod,{savings:n?.paymentMethodSavingsPrice}),y&&!u&&X&&!!K&&K?.amount!==n?.finalPrice?.amount&&s.jsx(le.Subtotal,{withTaxNote:E,value:K}),!(y&&u)&&s.jsxs(h.Fragment,{children:[s.jsx(le.Promotions,{orderLevelPromotions:n?.orderLevelPromotions}),s.jsx(le.Vouchers,{appliedVouchers:n?.appliedVouchers||[],vouchersSavingsPrice:n?.vouchersSavingsPrice}),s.jsx(le.Delivery,{delivery:n?.delivery,withTaxNote:E,signDisplay:w}),s.jsx(le.DeliveryPromotions,{deliveryPromotions:n?.deliveryPromotions}),s.jsx(le.BagCharge,{carrierBag:n?.carrierBag,withTaxNote:E,signDisplay:w}),s.jsx(le.PreparationCost,{preparationCost:n.preparation,withTaxNote:E,signDisplay:w}),s.jsx(le.Invoice,{invoice:n?.invoice,withTaxNote:E,signDisplay:w}),s.jsx(le.EnvironmentalHandlingCharge,{environmentalHandlingPrice:n?.environmentalHandlingPrice,withTaxNote:E,signDisplay:w}),s.jsx(le.Loyalty,{isLoyaltyRedeemEnabled:a,getLoyaltySpent:o}),s.jsx(le.Deposit,{depositsPrice:n?.depositsPrice,withTaxNote:E,signDisplay:w}),s.jsx(le.SmallOrderCharge,{smallOrderPrice:n.smallOrder,orderId:d.order?.orderId||"",thresholds:n?.smallOrderChargeThresholds,withTaxNote:E,signDisplay:w,page:"order-details"})]})]}),!u&&s.jsxs(h.Fragment,{children:[s.jsx(le.Taxes,{"data-test":"summary-taxes",finalPrice:n?.finalPrice,components:n?.taxComponents,withTaxNote:E}),s.jsx(le.Separator,{}),s.jsxs(fe,{"data-test":"summary-payment-list",children:[p&&N&&N.length>=1&&s.jsx(le.PaymentChecks,{"data-test":"summary-payment-checks",paidByCheck:k("PAYMENT_CHECK"),paidByCard:k("CARDS"),paidByInvoice:k("INVOICE")}),s.jsx(le.PaymentMethod,{paymentInfo:n?.paymentInfo})]})]}),s.jsx(le.Separator,{})]}),s.jsx(le.TotalSpaceBetween,{loading:!n,totalPrice:W,withTaxNote:E,title:j,note:G})]}),s.jsxs("div",{children:[i&&S&&s.jsx("div",{className:"salt-p-t--4","data-test":"loyalty-earnings-summary",children:s.jsx(xu,{getQuantity:r,allowZero:!0})}),s.jsx(le.Buttons,{loading:l,children:d.order&&s.jsx("div",{className:"salt-p-t--4",children:s.jsx(fZt,{order:{order:d.order}})})}),s.jsx(le.RebookableDisclaimer,{rebookable:c})]})]}),u&&C&&s.jsx(TA,{})]})}}const OZt=(e,t)=>{const n=_v(e,t.match.params.orderId);return{orderEntity:As(e),paymentSummary:n?o2e(e):Nc(e),quantity:n?$p(e):TP(e),getLoyaltySpent:n?bl:_P,getLoyaltyEarned:n?eE:wd,isLoyaltyRedeemEnabled:SZt(e),isLoyaltyEarningEnabled:yZt(e),isLoyaltyEarningMovedToSummaryEnabled:IZt(e),isToggleablePromotionsEnabled:CZt(e),isShowPaymentChecksEnabled:vZt(e),delivery:OE(e),rebookable:bP(e),isOrderUnderEdit:n,isExternal:PE(e),isTaxInclusionNoteEnabled:TZt(e),isSummarySubtotalEnabled:_Zt(e),isPlusSignEnabled:bZt(e),isReferencePrice:xZt(e),isSavingsBanner:AZt(e)}},PZt=st({getOrder:jo.getDecoratedOrderCall,sendAnalyticsEvent:U.analyticsEvent}),NZt=Tt(Ht,we(OZt,PZt))(DZt),LZt=Ro(["loyalty","loyear"]),kZt=D("loyear.csm"),jZt=D("rec.o"),MZt=D("slfsrv.refunds"),wZt=D("csoei"),FZt=Wn(["sumsub","bt.spl"]),BZt=Wn(["bt.view.dd","bt.spl"]),UZt=e=>D("invoifram")(e)&&hC(e),GZt=D("mpv"),$Zt=D("del.win"),HZt=D("pln.win"),VZt={...Oae,missing:[],products:[],requestedForRefund:[],returned:[],substituted:[],loyaltyEarnings:null,externalWalletManagement:!1,locale:"",isTaxInclusionNoteEnabled:!1};class WZt extends h.Component{formattedMessages;dataTestValues;static defaultProps=VZt;constructor(t){super(t),this.formattedMessages={productsTitle:t.intl.formatMessage("order.details.products.title"),missingItemsTitle:t.intl.formatMessage("order.details.missing.items.title"),substitutedItemsTitle:t.intl.formatMessage("order.details.substituted.items.title"),refundRequestsTitle:t.intl.formatMessage("order.details.requested-for-refund.items.title"),progressTitle:t.intl.formatMessage("edit.order.progress.title"),returnedItemsTitle:t.intl.formatMessage("order.details.returned.items.title")},this.dataTestValues={receivedItems:"received-items",substitutedItems:"substituted-items",missingItems:"missing-items",returnedItems:"returned-items",refundRequestItems:"refund-request-items"},this.hasOrderIdInUrlChanged=this.hasOrderIdInUrlChanged.bind(this),this.renderLoyaltyEarnings=this.renderLoyaltyEarnings.bind(this),this.renderOrderDetailsActionsBox=this.renderOrderDetailsActionsBox.bind(this),this.sendPageAttributesEvent=this.sendPageAttributesEvent.bind(this),this.shouldShowChangeStoreModal=this.shouldShowChangeStoreModal.bind(this),this.showChangeStoreModal=this.showChangeStoreModal.bind(this)}componentDidMount(){const{isServerRendered:t,order:n,actions:o,match:r,locale:a,isExternal:i,isOrderMultiPaymentsEnabled:l,isRecurringOrdersEnabled:c}=this.props;c&&o.getRecurringShoppingDefinitions(),this.props.isSelfServiceRefundEnabled&&!i&&this.props.actions.fetchCreatedRefundRequest(r.params.orderId,a),(this.isCurrentOrderTheActiveOne()||!t)&&(n.isFetching||(o.getOrder(r.params.orderId).then(()=>this.sendPageAttributesEvent()),l&&o.getOrderMultiPayments(r.params.orderId)))}componentDidUpdate(t){const{actions:n,match:o,isServerRendered:r,bannerBusinessModel:a,retailerRegionId:i,isOrderMultiPaymentsEnabled:l}=this.props,c=this.props.order&&this.props.order.order;c&&this.shouldShowChangeStoreModal(c,a,i)&&this.showChangeStoreModal(c,n.openChangeStoreModal),this.hasOrderIdInUrlChanged(t)&&!r&&(n.getOrder(o.params.orderId),l&&n.getOrderMultiPayments(o.params.orderId))}shouldShowChangeStoreModal(t,n,o){return n==="STORE"&&t.retailerRegionId!==o&&t.editStatus==="EDITABLE"}showChangeStoreModal(t,n){const o=`${window.location.origin}${kd(t.retailerRegionId)}${cn(t.orderId)}`,r=`${window.location.origin}${kd(t.retailerRegionId)}${lo()}`;n({redirectUrl:o,cancelRedirectUrl:r,messages:{title:"orders.list.change.store.modal.title",message:"orders.list.change.store.modal.message",cancel:"orders.list.change.store.modal.cancel",confirm:"orders.list.change.store.modal.confirm"}})}getData(){return this.isCurrentOrderTheActiveOne()?{orderData:this.props.order.order,productData:this.props.products,substituted:this.props.substituted,missing:this.props.missing,returned:this.props.returned,requestedForRefund:this.props.requestedForRefund}:{orderData:void 0,productData:void 0,substituted:void 0,missing:void 0,returned:void 0,requestedForRefund:void 0}}hasOrderIdInUrlChanged(t){const{order:n,match:o}=this.props;return!n.isFetching&&!!t.match.params.orderId&&!!o.params.orderId&&t.match.params.orderId!==o.params.orderId}isCurrentOrderTheActiveOne(){return!!(this.props.order.order&&this.props.match.params.orderId===this.props.order.order.orderId)}sendPageAttributesEvent(){const{actions:t,order:n}=this.props;t.sendAnalyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{ORDER_ORDER_ID:n&&n.order&&n.order.orderId,ORDER_ORDER_STATUS:n&&n.order&&n.order.status}})}renderSubstitutionProducts(t){const{order:n}=this.props;return t.map((o=[])=>{const{productId:r}=o[0]&&o[0].product||{};return s.jsx("div",{className:"salt-m-b--4",children:s.jsx(Zl,{items:o,isFetching:!!n.isFetching,substitute:!0,"data-test":this.dataTestValues.substitutedItems,shouldRenderHeader:!1})},r)})}renderProductsAccordion(t){const{order:n}=this.props;return s.jsxs(ae.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:this.formattedMessages.productsTitle})}),s.jsxs(rs,{"data-test":`${this.dataTestValues.receivedItems}-accordion`,children:[s.jsx(rs.Title,{active:!0,children:s.jsx(O,{size:"l",bold:!0,children:this.formattedMessages.productsTitle})}),s.jsx(rs.Content,{active:!0,children:s.jsx(Zl,{items:t,isFetching:!!n.isFetching,"data-test":this.dataTestValues.receivedItems,shouldRenderHeader:!1})})]})]})}renderSubstitutionAccordion(t){return s.jsxs(ae.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:this.formattedMessages.substitutedItemsTitle})}),s.jsxs(rs,{"data-test":`${this.dataTestValues.substitutedItems}-accordion`,children:[s.jsx(rs.Title,{active:!0,children:s.jsx(O,{size:"l",bold:!0,children:this.formattedMessages.substitutedItemsTitle})}),s.jsx(rs.Content,{active:!0,children:this.renderSubstitutionProducts(t)})]})]})}renderMissingAccordion(t){const{order:n}=this.props;return s.jsxs(ae.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:this.formattedMessages.missingItemsTitle})}),s.jsxs(rs,{"data-test":`${this.dataTestValues.missingItems}-accordion`,children:[s.jsx(rs.Title,{active:!0,children:s.jsx(O,{size:"l",bold:!0,children:this.formattedMessages.missingItemsTitle})}),s.jsx(rs.Content,{active:!0,children:s.jsx(Zl,{items:t,isFetching:!!n.isFetching,missing:!0,"data-test":this.dataTestValues.missingItems,shouldRenderHeader:!1})})]})]})}renderReturnedAccordion(t){const{order:n}=this.props;return s.jsxs(rs,{"data-test":`${this.dataTestValues.returnedItems}-accordion`,children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:this.formattedMessages.returnedItemsTitle})}),s.jsx(rs.Title,{active:!0,children:s.jsx(O,{size:"l",bold:!0,children:this.formattedMessages.returnedItemsTitle})}),s.jsx(rs.Content,{active:!0,children:s.jsx(Zl,{items:t,isFetching:!!n.isFetching,returned:!0,"data-test":this.dataTestValues.returnedItems,shouldRenderHeader:!1})})]})}renderRefundRequestsAccordion(t){const{productsByProductId:n,order:{isFetching:o},isExternal:r}=this.props;return this.props.isSelfServiceRefundEnabled&&!r?s.jsxs(rs,{"data-test":`${this.dataTestValues.refundRequestItems}-accordion`,children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:this.formattedMessages.refundRequestsTitle})}),s.jsx(rs.Title,{active:!0,children:s.jsx(O,{size:"l",bold:!0,children:this.formattedMessages.refundRequestsTitle})}),s.jsx(rs.Content,{active:!0,children:s.jsx(zM,{type:"requested",isFetching:o,refundables:t,productsByProductId:n})})]}):null}renderProducts(t,n,o,r,a){const{order:i}=this.props,l=a&&!!a.length,c=t&&!!t.length,d=n&&!!n.length,u=o&&!!o.length,p=r&&!!r.length;return[l,c,d,u,p].filter(E=>E===!0).length>1?s.jsxs(h.Fragment,{children:[l&&this.renderRefundRequestsAccordion(a),c&&this.renderProductsAccordion(t),p&&this.renderReturnedAccordion(r),d&&this.renderSubstitutionAccordion(n),u&&this.renderMissingAccordion(o)]}):c?s.jsx(Zl,{"data-test":this.dataTestValues.receivedItems,items:t,isFetching:!!i.isFetching}):d?this.renderSubstitutionProducts(n):u?s.jsx(Zl,{"data-test":this.dataTestValues.missingItems,items:o,missing:!0,isFetching:!!i.isFetching}):p?s.jsx(Zl,{"data-test":this.dataTestValues.returnedItems,items:r,returned:!0,isFetching:!!i.isFetching}):s.jsx(Zl,{isFetching:!!i.isFetching})}renderOrderDetailsActionsBox(){return s.jsx(Wae,{loading:this.props.loading})}renderRefundRequestCard(){if(this.props.isSelfServiceRefundEnabled&&this.props.order&&this.props.order.order){const{order:{order:{orderId:t,status:n,dates:o}}}=this.props;return s.jsx(Mae,{orderStatus:n,orderDeliveryStartDate:o.deliveryStartDate,orderTimeZone:o.timeZoneId,orderId:t,intl:this.props.intl})}return null}renderLoyaltyEarnings(){return!this.props.isLoyaltyEarningMovedToSummaryEnabled&&this.props.isLoyaltyEarningEnabled&&this.props.loyaltyEarnings&&Number(this.props.loyaltyEarnings.units)!==0?s.jsx("div",{className:"salt-m-y--2",children:s.jsx(xj,{getQuantity:this.props.getLoyaltyEarned})}):null}isExternalOrderAlertEnabled(){const{hideExternalOrdersAlert:t}=this.props;return!t}renderFiscalInvoiceCard(){const{order:t}=this.props;if(t&&t.order&&t.order.status&&t.order.status!=="CANCELLED"&&t.order.status!=="SCRATCHED"){const{orderId:n,status:o}=t.order;return s.jsx(Gae,{orderId:n,orderStatus:o})}return null}render(){const{order:t,productsByProductId:n,isInvoiceRequestFormEnabled:o,isRecurringOrdersEnabled:r,isDeliveryWindowEnabled:a,isPlannedDeliveryWindowEnabled:i,timeFormat:l,match:c,loading:d}=this.props;if(!t.error&&t.lastUpdated&&!t.isFetching){const{orderData:u,productData:p,substituted:g,missing:E,returned:y,requestedForRefund:I}=this.getData();return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"order.details.page.title",values:{orderId:t?.order?.orderId??""}}),s.jsx(sn,{"data-test":"order-details-bar",children:s.jsx(WXt,{order:u})}),s.jsx(Yae,{className:"salt-m--2",order:t.order,timeFormat:l,isDeliveryWindowEnabled:a,isPlannedDeliveryWindowEnabled:i}),u&&u.external&&this.isExternalOrderAlertEnabled()&&s.jsx("div",{className:"salt-m-t--2 salt-m-x--2",children:s.jsx(Te,{intent:"warning","data-test":"external-order-alert",showIcon:!1,text:s.jsx(b,{id:"order.details.external.message"})})}),s.jsxs(V,{children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(V.Item,{colSpan:{xs:12,md:8},children:s.jsx("div",{className:"salt-m-t--4",children:this.renderProducts(p,g,E,y,I)})})}),s.jsxs(V.Item,{colSpan:{xs:12,md:4},children:[r&&t?.order?.recurringShoppingDefinition&&s.jsx(Rf,{className:"salt-m-t--4",orderId:t.order.orderId,recurringShoppingDefinition:t.order.recurringShoppingDefinition}),s.jsx(NZt,{match:c,loading:d}),this.renderOrderDetailsActionsBox(),this.renderRefundRequestCard(),this.renderLoyaltyEarnings(),o?this.renderFiscalInvoiceCard():null]}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(V.Item,{colSpan:{xs:12,md:8},children:s.jsx("div",{className:"salt-m-t--4",children:this.renderProducts(p,g,E,y,I)})})})]}),t.order&&t.order.orderId&&s.jsxs(h.Fragment,{children:[s.jsx(Fj,{orderId:t.order.orderId,sendPageView:!0}),s.jsx(wj,{})]}),n&&s.jsx(Uae,{})]})}else if(t.error)return t.error.statusCode===404?s.jsx(ot,{}):s.jsx(jn,{});return null}}const YZt=e=>({basketProducts:ho(e),areBasketProductsFetching:TD(e),cartAdverts:e.data.adverts.cartPage,productsByProductId:mo(e),isServerRendered:Rt(e),order:As(e),products:xP(e),substituted:c2e(e),missing:a2e(e),returned:i2e(e),requestedForRefund:WM(e),paymentSummary:Nc(e),getLoyaltyEarned:wd,isLoyaltyEarningEnabled:LZt(e),isLoyaltyEarningMovedToSummaryEnabled:kZt(e),isSelfServiceRefundEnabled:MZt(e),isRecurringOrdersEnabled:jZt(e),loyaltyEarnings:wd(e),bannerBusinessModel:Tl(e),retailerRegionId:sa(e),locale:Ms(e),showChangeSlotWhileEditing:wZt(e),isExternal:PE(e),hideExternalOrdersAlert:WH(e),isSummarySubtotalEnabled:FZt(e),isInvoiceRequestFormEnabled:UZt(e),isBasketViewDropdownEnabled:BZt(e),timeFormat:Mt(e),isOrderMultiPaymentsEnabled:GZt(e),isDeliveryWindowEnabled:$Zt(e),isPlannedDeliveryWindowEnabled:HZt(e)}),qZt=st({getBasketProducts:Oc,getCartAdverts:nX,getOrder:jo.getDecoratedOrderCall,fetchCreatedRefundRequest:Ah.fetchCreatedRefundRequest,sendAnalyticsEvent:U.analyticsEvent,openChangeStoreModal:e=>J.openModal("changeStore",e),getRecurringShoppingDefinitions:mi.getRecurringShoppingDefinitions,getOrderMultiPayments:qr.getOrderMultiPayments}),KZt=Tt(Ht,we(YZt,qZt))(WZt),zZt="order-summary",N1="order-again",QZt=e=>e.tab===N1?N1:zZt,XZt=()=>{const e=nn(),t=f(As),[n,o]=Ee(["mpv","rec.o"]),r=F(),a=Ne(),i=f(u=>_v(u,e.orderId)),[l]=Ee(["onre"]);if(h.useEffect(()=>{t.order||r(jo.getDecoratedOrderCall(e.orderId)),n&&r(qr.getOrderMultiPayments(e.orderId)),o&&r(mi.getRecurringShoppingDefinitions())},[]),i)return s.jsx(KJ,{});if(!l)return s.jsx(KZt,{match:{params:e}});const c=Qe.parse(a.search),d=QZt(c);return s.jsx(VXt,{match:{params:e},initialTab:d})},ZZt=e=>s.jsx(Et,{type:"OrderDetails::route",children:s.jsx(XZt,{...e})}),JZt=e=>[{path:"/orders/:orderId/details",Component:$s(Xe,e.Main),children:[{index:!0,Component:ZZt}]}],eJt=()=>async e=>{try{await e(Sd.getRecurringShoppingPlaceholders())}catch{}},tJt=(e,t)=>n=>n(Sd.cancelRecurringOrderPlaceholder(e,t)),Vl={cancelRecurringOrderPlaceholder:tJt,fetchRecurringShoppingPlaceholders:eJt},sJt=v(Q)`
    flex-grow: 1;
`,nJt=v(x)`
    flex: 1 1 0;
`,oJt=({children:e})=>{const t=os({breakpoint:"sm-up"}),n=h.useMemo(()=>{const o=ae.Children.toArray(e);return t?o.reverse():o},[e,t]);return s.jsx(sJt,{direction:"column",directionSmUp:"row",gap:["sm"],children:n})},va=Object.assign(oJt,{Button:nJt}),Xae="cancelPlaceholderRecurringOrder",L1="cancel-recurring-order-placeholder-modal-header",rJt=()=>{const e=Ge(),t=F(),n=Wt(Xae),{definitionId:o,referenceId:r,orderName:a}=n.options||{},[i,l]=h.useState(!1),c=async()=>{if(!(!o||!r)){l(!0);try{await t(Sd.cancelRecurringOrderPlaceholder(o,r)),await t(Vl.fetchRecurringShoppingPlaceholders()),t(U.analyticsEvent({type:mt.PLACEHOLDER_RECURRING_ORDER_DETAILS_CANCEL_MODAL_EVENT,userAction:"Cancel",definitionID:o,referenceID:r})),n.close(),e(lo())}catch{Z.error("orders.placeholder.recurring.order.cancel.error"),n.close()}l(!1)}},d=()=>{n.close(),t(U.analyticsEvent({type:mt.PLACEHOLDER_RECURRING_ORDER_DETAILS_CANCEL_MODAL_EVENT,userAction:"Close",definitionID:o,referenceID:r}))};return s.jsxs(B,{isOpen:n.isOpen,onRequestClose:d,aria:{labelledby:L1},asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",id:L1,children:s.jsx(Nt,{id:"orders.placeholder.recurring.order.cancel.modal.title"})})}),s.jsx(B.Body,{children:s.jsx(pi,{isLoading:i,children:a&&s.jsx(Te,{intent:"info",text:s.jsx(b,{id:"orders.placeholder.recurring.order.cancel.modal.info",values:{orderName:a}})})})}),!i&&s.jsx(B.Footer,{children:s.jsxs(va,{children:[s.jsx(va.Button,{intent:"secondary",fill:!0,onClick:d,"data-test":"cancel-placeholder-recurring-order-modal-dismiss-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"orders.placeholder.recurring.order.cancel.modal.dismiss.button"})})}),s.jsx(va.Button,{fill:!0,intent:"primary","data-test":"cancel-placeholder-recurring-order-modal-confirm-button",onClick:c,children:s.jsx(x.Text,{children:s.jsx(b,{id:"orders.placeholder.recurring.order.cancel.modal.confirm.button"})})})]})})]})},aJt=()=>{const e=F(),t=nn(),n=f(u=>Zt(u)),o=f(u=>Mt(u)),r=f(u=>A4e(u,t.referenceId)),a=f(dN(t.definitionId));h.useEffect(()=>{r.isFetching||(e(Vl.fetchRecurringShoppingPlaceholders()),e(mi.getRecurringShoppingDefinitions()))},[]);const i=u=>{const{orderAvailableAfter:p,timeZoneId:g}=u;return s.jsx(Nt,{id:"order.details.upcoming.page.heading",values:{orderAvailableAfter:s.jsx(jg,{dateIso:p,timeZoneId:g,dateFormat:n,timeFormat:o})}})},l=()=>r?s.jsxs(ee,{as:"h1",children:[s.jsx(pe,{className:"salt-d--inline-block salt-m-r--2 salt-m-b--1 salt-m-l--1",name:"recurring_order",verticalAlign:"middle",width:38,height:38}),i(r.order?.dates)]}):null,c=()=>s.jsx(V,{fixed:!0,children:s.jsx(V.Item,{colStart:{md:4},colSpan:{xs:12,md:6},children:s.jsx(Os,{titleIcon:"orders",title:"order.details.upcoming.page.order.not.created.heading",description:"order.details.upcoming.page.order.not.created.body"})})}),d=r.order&&r.order.cancelable;return!r.error&&r.lastUpdated&&!r.isFetching?s.jsxs(h.Fragment,{children:[s.jsx(sn,{children:l()}),s.jsxs(V,{children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(V.Item,{className:"salt-m-t--16",colSpan:{xs:12,md:8},children:c()})}),s.jsx(V.Item,{colSpan:{xs:12,md:4},children:s.jsxs("div",{children:[a&&s.jsx(Rf,{className:"salt-m-t--4",orderId:a.definitionId,recurringShoppingDefinition:a}),s.jsx("div",{className:"salt-m-t--4",children:d&&s.jsx(xe,{children:s.jsx(x,{fill:!0,intent:"secondary","data-test":"recurring-order-placeholder-cancel-button",onClick:()=>e(J.openModal(Xae,{definitionId:r.order?.definitionId,referenceId:r.order?.referenceId,orderName:r.order?.definitionName})),children:s.jsx(x.Text,{children:s.jsx(b,{id:"recurring.order.cancel"})})})})})]})}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsx(V.Item,{className:"salt-m-t--16",colSpan:{xs:12,md:8},children:c()})})]}),d&&s.jsx(rJt,{})]}):r.error?r.error.statusCode===404?s.jsx(ot,{}):s.jsx(jn,{}):null},Zae=e=>s.jsx(Et,{type:"PlaceholderRecurringOrderDetails::route",children:s.jsx(aJt,{...e})});Zae.fetchData=({store:e})=>{const t=e.getState();return Xe(t)?Promise.all([Vl.fetchRecurringShoppingPlaceholders(),mi.getRecurringShoppingDefinitions()]):Promise.resolve()};const Jae=m.shape({definitionId:m.string,name:m.string,addressName:m.string,dates:m.shape({deliveryStartDate:m.string.isRequired,deliveryEndDate:m.string.isRequired,timeZoneId:m.string.isRequired}),referenceId:m.string,cancelable:m.bool}),eie=e=>(t,n,o)=>{if(t[n]==null){if(e)throw new Error(`Prop ${n} supplied to ${o} is required.`)}else if(!/\d\d:\d\d/.test(t[n]))return new Error(`Invalid prop ${n} supplied to ${o}. Validation failed.`);return null},oR=eie(!1);oR.isRequired=eie(!0);const iJt=m.shape({isFetching:m.bool,lastUpdated:m.number,definitions:m.arrayOf(m.shape({definitionId:m.string.isRequired,name:m.string.isRequired,frequency:m.shape({unit:m.oneOf(wKe).isRequired,value:m.number.isRequired}).isRequired,deliveryWindow:m.shape({day:m.string.isRequired,dayOfWeekIso:m.number.isRequired,from:oR.isRequired,to:oR.isRequired}),addressName:m.string,cancelable:m.bool}))}),lJt=()=>e=>e(Jye()).then(t=>t&&e(aW(t.payload.responseData.entities))),cJt=e=>t=>t(eIe(e)).then(n=>n&&t(aW(n.payload.responseData.entities))),tw={getPastOrders:lJt,getPastOrdersPage:cJt},dJt={retentionPeriod:m.string},uJt={retentionPeriod:void 0},sw=({retentionPeriod:e})=>e?s.jsx(b,{id:`orders.list.past.retention.${e}`}):null;sw.propTypes=dJt;sw.defaultProps=uJt;const pJt=(e,t)=>({retentionPeriod:t.retentionPeriod||g4e(e)}),tie=Tt(Ht,we(pJt))(sw),mJt=({order:e,type:t,alertBanner:n,additionalInfo:o,onClick:r,carrierType:a})=>{const i=He(),l=e.externalAddress?s.jsx(b,{id:"order.card.locker.name",values:{lockerName:e.externalAddress.externalCollectionPointId}}):e.addressNickName,c=()=>s.jsx(Hm,{carrierType:a,dates:e.dates,showAsCardTitle:!0}),d=()=>s.jsx(b,{id:"order.card.contentLine1",values:{addressDetails:l,price:i(e.orderTotals.totalPrice)}});return s.jsx(vs,{"data-test":`order-card-${t}`,title:{text:c(),as:"h3",a11yText:s.jsx(b,{id:"orders.list.card.accessibility.title.label"})},description:d(),additionalInfo:o,icon:"third_party_shipping",alertBanner:n,onClick:r,to:cn(e.orderId)},e.orderId)},gr={EDITABLE:{message:"orders.list.card.status.future.editable",type:"action"},EDITABLE_NO_DATE:{message:"orders.list.card.status.future.editable.no.date",type:"action"},UNDER_EDIT:{message:"orders.list.card.status.future.under.edit",type:"action"},OTHER_UNDER_EDIT:{message:"orders.list.card.status.future.other.under.edit",type:"action"},EDIT_EXPIRED:{message:"orders.list.card.status.future.edit.expired",type:"info"},PICKED:{message:"orders.list.card.status.picked",type:"info"},PENDING_PAYMENT:{message:"orders.list.card.status.future.pending.payment",type:"info"},UNDELIVERED_FAST_DELIVERED:{message:"order.card.reserved.fast.delivery.alert",type:"info"},FAILED_PENDING_PAYMENT:{message:"orders.list.card.status.future.pending.payment.failed",type:"error"},CANCELLED:{message:"orders.list.status.cancelled",type:"error"},DELIVERED:{message:"orders.list.status.delivered",type:"success"},COLLECTED:{message:"orders.list.status.collected",type:"success"},SCRATCHED:{message:"orders.list.status.scratched",type:"error"}},hJt=(e,t)=>t?`${e.recurringShoppingDefinition?.name}, ${e.addressNickName}, `:`${e.addressNickName}, `,gJt=e=>e.status==="DELIVERED",EJt=e=>e.deliveryMethod===pt.clickAndCollect.method?gr.COLLECTED.message:gr.DELIVERED.message,fJt=({order:e,isRecurring:t,isMultidaySlotIcon:n,isFastDeliverySlotBooking:o=!1})=>e.slotType===Qa&&e.deliveryMethod===pt.vanDelivery.method&&o?"on_demand":e.slotType===Qa&&e.deliveryMethod===pt.clickAndCollect.method||n?"express_collect":e.deliveryMethod===pt.clickAndCollect.method?"click_collect":t?"recurring_order":"home_delivery",yJt=(e,t,n,o,r=!1,a=!1,i=!1)=>{const l=e.status==="UNKNOWN",c=e.status==="FUTURE",d=e.deliveryInfo!==void 0,u=e.status==="DELIVERED",p=e.status==="CANCELLED",g=e.status==="SCRATCHED";if(!(l||u)){if(!u&&!p&&!g&&i&&e.deliveryMethod==="HOME_DELIVERY"&&e.slotType===Qa&&(!e?.deliveryInfo||e?.deliveryInfo?.currentState==="NOT_APPLICABLE"))return{type:gr.UNDELIVERED_FAST_DELIVERED.type,text:()=>s.jsx(b,{id:gr.UNDELIVERED_FAST_DELIVERED.message})};if(d&&e.deliveryInfo.currentState!=="NOT_APPLICABLE"){const E=wre(e,n,r,a);if(E?.text)return E}if(c){const E=e.editStatus==="EDITABLE"||e.editStatus==="OTHER_UNDER_EDIT",y=!!e.dates.confirmOrderChangesBy;return o(e.orderId)?{type:gr.FAILED_PENDING_PAYMENT.type,text:()=>s.jsx(b,{id:gr.FAILED_PENDING_PAYMENT.message})}:E&&y?{type:gr[e.editStatus].type,text:()=>s.jsx(b,{id:gr[e.editStatus].message,values:{editUntil:s.jsx(Gl,{dateIso:e.dates.confirmOrderChangesBy,timeZoneId:e.dates.timeZoneId,local:!0,dateFormat:t,timeFormat:n})}})}:E&&!y?{type:gr.EDITABLE_NO_DATE.type,text:()=>s.jsx(b,{id:gr.EDITABLE_NO_DATE.message})}:{type:gr[e.editStatus].type,text:()=>s.jsx(b,{id:gr[e.editStatus].message})}}return{type:gr[e.status].type,text:()=>s.jsx(b,{id:gr[e.status].message})}}},IJt=(e,t,n,o=!1)=>n==="STORE"&&e.retailerRegionId!==t&&(e.editStatus==="EDITABLE"||o),SJt=(e,t,n)=>{t.preventDefault();const o=`${window.location.origin}${kd(e.retailerRegionId)}${cn(e.orderId)}`;n({redirectUrl:o,messages:{title:"orders.list.change.store.modal.title",message:"orders.list.change.store.modal.message",cancel:"orders.list.change.store.modal.cancel",confirm:"orders.list.change.store.modal.confirm"}})},nw=e=>{const{order:t,dateFormat:n,timeFormat:o,type:r,bannerBusinessModel:a,retailerRegionId:i,isOnlineReceiptEnabled:l,isMultidaySlotIcon:c,isDeliveryWindowEnabled:d,isPlannedDeliveryWindowEnabled:u,getFailedOrderPaymentsForOrder:p=()=>{}}=e,{formatMessage:g}=L(),E=F(),[y]=Ee(["sl.fd"]),I=j=>E(J.openModal("changeStore",j)),S=He(),C=!!t.recurringShoppingDefinition,T=yJt(t,n,o,p,d,u,y),_=gJt(t)?()=>s.jsx(b,{id:EJt(t)}):void 0,A=j=>IJt(t,i,a,l)?SJt(t,j,I):void 0,R=f(RE(t.shippingGroupType)),{isReady:P,carrierDetails:N}=$m({carrierId:t.carrierId,shippingGroupType:t.shippingGroupType});if(R)return P?s.jsx(mJt,{order:t,type:r,alertBanner:T?{intent:T.type,text:T.text?T.text():""}:void 0,additionalInfo:_?_():void 0,onClick:A,carrierType:N?.slotBookingComponent}):s.jsx(vs.Skeleton,{alertBanner:!!T,"data-test":"order-card-skeleton"});const k=()=>s.jsx(qn,{dateIsoFrom:t.dates.deliveryStartDate,dateIsoTo:t.dates.deliveryEndDate,timeZoneId:t.dates.timeZoneId,dateFormat:n,timeFormat:o}),M=()=>s.jsxs(h.Fragment,{children:[hJt(t,C),S(t.orderTotals.totalPrice)]}),w=()=>{if(t.slotType===Qa&&t.deliveryMethod===pt.vanDelivery.method&&y){let j=g("order.card.reserved.fast.delivery.title",{time:$o(t.dates.deliveryEndDate,t.dates.timeZoneId,$n)});return["DELIVERED","CANCELLED","SCRATCHED"].some(G=>G===t.status)&&(j=SR(t.dates.deliveryEndDate,t.dates.timeZoneId,Sr,$n,!0)),{text:j,as:r==="past"?"h4":"h3",a11yText:j}}return{text:k(),as:r==="past"?"h4":"h3",a11yText:g("order.list.card.accessibility.title.label")}};return s.jsx(vs,{"data-test":`order-card-${r}`,title:w(),description:M(),additionalInfo:_?_():void 0,icon:fJt({order:t,isRecurring:C,isMultidaySlotIcon:c,isFastDeliverySlotBooking:y}),alertBanner:T?{intent:T.type,text:T.text?T.text():""}:void 0,onClick:A,to:cn(t.orderId)})},CJt={action:m.func.isRequired};function ow(e){const{action:t}=e,n=h.useRef(null),o=r=>{r[0].isIntersecting&&t()};return h.useEffect(()=>{const r={root:null,rootMargin:"20px",threshold:0},a=new IntersectionObserver(o,r);return n.current&&a.observe(n.current),()=>n.current&&a.unobserve(n.current)}),s.jsx(h.Fragment,{children:s.jsx("div",{ref:n,"data-test":"order-list-infinite-scroll-hook-marker"})})}ow.propTypes=CJt;const vJt=D("tx.nts"),TJt=D("onre"),_Jt=D("md.sl"),bJt={actions:m.shape({getPastOrdersPage:m.func.isRequired}).isRequired,pastOrders:m.shape({isFetching:m.bool,lastUpdated:m.number,nextPageToken:m.string,orders:m.arrayOf(m.oneOfType([lr,Jae]))}),isTaxInclusionNoteEnabled:m.bool.isRequired,isOnlineReceiptEnabled:m.bool.isRequired,isMultidaySlotEnabled:m.bool.isRequired,monthOfYearFormat:m.string.isRequired},xJt={pastOrders:{orders:[],isFetching:!1,nextPageToken:null}};function rw(e){const{monthOfYearFormat:t,pastOrders:n,isOnlineReceiptEnabled:o,isMultidaySlotEnabled:r}=e,a=f(sa),i=f(Tl),l=f(Mt),c=_=>_.map(A=>({monthOfYear:$o(A.dates.deliveryEndDate,A.dates.timeZoneId,t,null),order:A})).reduce((A,R)=>{const P=A.find(N=>N.monthOfYear===R.monthOfYear);return P?P.orders.push(R.order):A.push({monthOfYear:R.monthOfYear,orders:[R.order]}),A},[]).sort((A,R)=>de(R.orders[0].dates.deliveryEndDate)-de(A.orders[0].dates.deliveryEndDate)),d=(_,A,R)=>{const P=su({deliveryMethod:_.deliveryMethod,slotType:_.slotType,start:_.dates.deliveryStartDate,end:_.dates.deliveryEndDate},r),N={order:_,dateFormat:A,timeFormat:l,type:R,bannerBusinessModel:i,retailerRegionId:a,isOnlineReceiptEnabled:o,isMultidaySlotIcon:P};return s.jsx(nw,{...N})},u=(_,A)=>s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-y--4",children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{children:A})})}),s.jsx(V,{flush:!0,children:_.map(R=>s.jsx(V.Item,{colSpan:{xs:12,sm:6,md:4,lg:3},children:d(R,lC,"past")},R.orderId||R.definitionId))})]},A),p=_=>s.jsx("div",{className:"salt-m-y--2","data-test":"past-orders-container",children:c(_).map(A=>u(A.orders,A.monthOfYear))}),g=()=>s.jsx("div",{className:"salt-m-t--4",children:s.jsx(_s,{"data-test":"order-list-spinner"})}),E=()=>s.jsx("div",{className:"salt-m-t--8",children:s.jsx(O,{asChild:!0,bold:!0,"data-test":"order-list-no-more-orders-label",children:s.jsx("h2",{children:s.jsx(b,{id:"orders.list.past.no.more.orders"})})})}),y=()=>!!n.nextPageToken&&n.nextPageToken!=="null",I=()=>!n.isFetching&&y(),S=()=>s.jsxs(h.Fragment,{children:[n.isFetching?g():null,y()?null:E()]}),C=()=>{e.actions.getPastOrdersPage({nextPageToken:n.nextPageToken})},T=()=>e.isTaxInclusionNoteEnabled&&s.jsx("div",{className:"salt-m-t--1 salt-d--block",children:s.jsx(O,{asChild:!0,children:s.jsx("h3",{children:s.jsx(b,{id:"orders.list.tax.inclusion.note"})})})});return n.orders.length?s.jsxs(h.Fragment,{children:[s.jsxs(Q,{align:"baseline",className:"salt-m-y--4",children:[s.jsx("div",{className:"salt-m-r--4",children:s.jsxs(ee,{as:"h2",children:[s.jsx(b,{id:"orders.list.past.title"})," ",s.jsx(tie,{})]})}),T()]}),p(n.orders),S(),I()?s.jsx(ow,{action:C}):null]}):null}rw.propTypes=bJt;rw.defaultProps=xJt;const AJt=e=>({pastOrders:G5(e),isTaxInclusionNoteEnabled:vJt(e),isOnlineReceiptEnabled:TJt(e),isMultidaySlotEnabled:_Jt(e),monthOfYearFormat:VH(e)}),RJt=st({getPastOrdersPage:tw.getPastOrdersPage}),DJt=we(AJt,RJt)(rw),b_=({onClick:e,children:t})=>s.jsx(x,{intent:"primary",onClick:e,fill:!0,children:s.jsx(x.Text,{children:t})}),Mf=e=>e.data.recurringOrdersSignUp.form,$c=Y(Mf,e=>e.dialogType),sie=Y(Mf,e=>lA.indexOf(e.dialogType)+1),Ma=Y(Mf,e=>e.data),OJt=Y(Mf,e=>e.orderComplete),PJt=Y(Mf,e=>e.paymentAuthUrl),NJt=e=>t=>{t(xm.setState({dialogType:e}))},LJt=(e,t)=>{const n=t(),o=$c(n),a=lA.indexOf(o)-1;if(a<0)return;const i=lA[a];e(xm.setState({dialogType:i}))},kJt=e=>t=>{t(xm.setState({data:e}))},jJt=e=>t=>{t(xm.setState({orderComplete:e}))},MJt=e=>t=>{t(xm.setState({paymentAuthUrl:e}))},Qt={setDialogType:NJt,onPrevStep:LJt,setFormData:kJt,setOrderCompleteData:jJt,setPaymentAuthUrl:MJt},k1={1:"WEEK",2:"WEEKS",3:"WEEKS",4:"WEEKS"},x_=()=>{const{formatMessage:e}=L();return t=>t.unit==="WEEKS"&&Object.keys(k1).includes(t.value.toString())?e(`orders.list.recurring.order.frequency.every.${t.value}.${t.unit.toLowerCase()}`):`${t.value} ${k1[t.value]}`},wJt=e=>f(WR).find(o=>o.deliveryDestinationId===e)?.name||"",FJt=e=>{const t=f(ase),n=x_(),o=t.frequencies.find(({value:r})=>r===e.value);return o?n(o):""},BJt=e=>{const{slots:t}=f(Pj),n=t.find(r=>r.slotId===e);return n?`${n.dayOfWeek[0]+n.dayOfWeek.substring(1).toLowerCase()} ${n.from} - ${n.to}`:""},UJt=({children:e,step:t})=>s.jsxs(ee,{as:"h2",children:[s.jsx("span",{"data-test":"ro-sign-up-progress-indicator-header",children:e}),s.jsx(ie,{children:s.jsx(b,{id:"recurring.orders.sign.up.progress.indicator",values:{step:t,numberOfSteps:OQ}})})]}),{getPercentageFromFractionString:GJt}=ra,$Jt={[it.ADDRESS]:"recurring.orders.sign.up.step.title.address",[it.FREQUENCY]:"recurring.orders.sign.up.step.title.frequency",[it.SLOT_BOOKING]:"recurring.orders.sign.up.step.title.daytime",[it.SUMMARY]:"recurring.orders.sign.up.step.title.summary"},HJt=v.div`
    display: flex;
    align-items: center;
    gap: var(--salt-spacing-2);
`,A_=()=>{const e=f(sie),t=f($c),n=`${e} / ${OQ}`,o=$Jt[t];return s.jsxs(HJt,{className:"salt-m-b--4",children:[s.jsx("div",{"aria-hidden":"true",children:s.jsx(kl,{progressValue:GJt(n),autoProgress:!1,size:44,children:s.jsx(O,{bold:!0,children:n})})}),s.jsx(UJt,{step:e,children:s.jsx(Nt,{id:o})})]})},VJt=v.ul`
    display: block;
    margin: 0;
    margin-block-end: 15px;
    padding: 0;
    list-style: none;
`,WJt=v.li`
    margin-block-end: 8px;
`,YJt=()=>{const{formatMessage:e}=L(),t=F(),n=f(Ma),o=wJt(n.deliveryDestinationId),r=FJt(n.frequency),a=BJt(n.slotId),i=[{label:"recurring.orders.sign.up.summary.address",value:o},{label:"recurring.orders.sign.up.summary.frequency",value:r},{label:"recurring.orders.sign.up.summary.daytime",value:a}],l=c=>{const d=c?.target?.value;t(Qt.setFormData({...n,name:d}))};return s.jsxs(h.Fragment,{children:[s.jsxs(B.Body,{children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(A_,{})}),s.jsx(VJt,{children:i.map(({label:c,value:d})=>s.jsx(WJt,{children:s.jsxs(O,{size:"l",children:[s.jsxs("span",{children:[s.jsx(b,{id:c}),":"]}),"",s.jsx("b",{children:d})]})},c))}),s.jsx(Te,{intent:"info",text:s.jsx(b,{id:"recurring.orders.sign.up.summary.info"})}),s.jsx(Ts,{className:"salt-m-y--4"}),s.jsx("form",{children:s.jsx(Wo,{type:"text",label:e("recurring.orders.sign.up.summary.name.field.label"),placeholder:e("recurring.orders.sign.up.summary.name.field.placeholder"),input:{onChange:l},onChange:l,meta:{invalid:!1,touched:!1}})})]}),s.jsx(B.Footer,{children:s.jsx(b_,{onClick:()=>t(Qt.setDialogType(it.PAYMENT)),children:s.jsx(b,{id:"recurring.orders.sign.up.summary.payment.button"})})})]})},wf=({children:e})=>s.jsx(B.Header,{align:"left",children:e}),qJt=v.span`
    vertical-align: middle;
`,KJt=({slotId:e})=>{const t=L(),n=F(),o=f($c),a=f(sie)>1,i=async()=>{o===it.SUMMARY&&e&&await n(xo.releaseSlot(e)),n(Qt.onPrevStep)},l=t.formatMessage("recurring.orders.sign.up.show.previous.step.aria.label");return s.jsxs(ee,{as:"h1",id:Mc,children:[a&&s.jsx(x,{size:"s",fill:!1,intent:"tertiary","data-test":"icon__arrow_left",onClick:i,"aria-label":l,className:"salt-m-r--2",children:s.jsx(x.Icon,{name:"arrow_left"})}),s.jsx(qJt,{children:s.jsx(b,{id:"recurring.orders.sign.up.create.recurring.order"})})]})},j1=({children:e})=>{const t=f(Ma);return s.jsxs(h.Fragment,{children:[s.jsx(wf,{children:s.jsx(KJt,{slotId:t?.slotId})}),e]})},zJt=v.div`
    display: flex;
    text-align: start;
`,QJt=()=>s.jsx(zJt,{children:s.jsx(ee,{as:"h1",id:Mc,children:s.jsx(b,{id:"recurring.orders.sign.up.payment.header"})})}),XJt=({details:e})=>(t,n)=>{const o=n(),r=At(o),a={"client-route-id":Do(o),"X-CSRF-TOKEN":Na(o),"content-Type":"application/json"};return fetch(go({basePath:r,target:"/recurringshopping/v1/web/signup/complete"}),{credentials:"same-origin",method:"POST",headers:a,body:JSON.stringify({details:e})}).then(i=>i.json().then(l=>({response:i,data:l}))).then(({response:i,data:l})=>{if(i&&!i.ok){const c=new Error;return c.message=l.message,Promise.reject(c)}return l}).catch(i=>{const l=i.message&&AC(i.message)?i.message:"order.cow.3ds.error";Z.error(l)})},nie={complete3ds:XJt},ZJt=()=>{const e=F(),t=L(),n=f(Ma),o=f(PJt),{paymentOption:r,paymentType:a}=f(Im),i=f(ME),{deliveryDestinationId:l,name:c,slotId:d,frequency:{unit:u,value:p},dayOfWeek:g}=n,E=new Nj,y={deliveryDestinationId:l,redirectUrl:lo(),frequency:{unit:u,value:p},name:c||t.formatMessage("recurring.orders.definition.default.name",{dayOfWeek:g}),slotId:d,group:r,type:a||"UNKNOWN",toSave:[dt.PAY_NOW,dt.UNKNOWN].includes(r)&&i,walletItemId:null},I=()=>{Z.error("toast.notification.generic.error"),e(Qt.setDialogType(void 0))},S=async A=>{try{const R=await e(xo.checkout(A)),{url:P}=R.payload.responseData;return E.initiatePaymentAuthentication({authenticationUrl:P})}catch{return I(),null}},C=A=>{switch(A.eventType){case In.PAYMENT_REQUESTED:e(Qt.setPaymentAuthUrl(void 0));break;case In.PAYMENT_CANCELLED:I();break;case In.INITIATE_AUTHENTICATION:e(Qt.setPaymentAuthUrl(A.payload.authenticationUrl));break}};h.useEffect(()=>(o||(S(y),E.subscribe(C)),()=>E.unsubscribe(C)),[]);const T=o&&{state:{pspweb:{url:o}}},_=async A=>{try{const R=await e(nie.complete3ds({details:A}));return e(Qt.setOrderCompleteData(R)),e(Qt.setDialogType(it.ORDER_CONFIRMATION)),R}catch(R){throw Z.error("toast.notification.generic.error"),R}};return s.jsx(pi,{isLoading:!T,children:s.jsx(i_,{messageCallback:_,errorCallback:I,redirectUrlConfig:{url:lo(),text:t.formatMessage("recurring.orders.sign.up.payment.return.to.your.orders")},location:T,inModal:!0})})},JJt=()=>s.jsxs(h.Fragment,{children:[s.jsx(wf,{children:s.jsx(QJt,{})}),s.jsx(B.Body,{children:s.jsx(ZJt,{})})]}),ees=({date:e,address:t,price:n})=>s.jsxs(xe,{children:[s.jsx(O,{size:"l",bold:!0,children:e}),s.jsx("div",{className:"salt-m-t--4 salt-m-b--4",children:s.jsx(O,{size:"l",children:t})}),s.jsx(O,{size:"l",bold:!0,children:n}),s.jsxs(O,{size:"l",children:["(",s.jsx(b,{id:"recurring.orders.sign.up.created.charge.info"}),")"]}),s.jsx(Te,{intent:"warning",className:"salt-m-t--4",text:s.jsx(b,{id:"recurring.orders.sign.up.created.info"})})]}),R_=(e,t)=>{const n=t();switch($c(n)){case it.ADDRESS:e(Qt.setDialogType(it.ADDRESS_CLOSE));return;case it.ADDRESS_CLOSE:e(Qt.setDialogType(it.ADDRESS));break;case it.FREQUENCY:e(Qt.setDialogType(it.FREQUENCY_CLOSE));return;case it.FREQUENCY_CLOSE:e(Qt.setDialogType(it.FREQUENCY));break;case it.SLOT_BOOKING:e(Qt.setDialogType(it.SLOT_BOOKING_CLOSE));return;case it.SLOT_BOOKING_CLOSE:e(Qt.setDialogType(it.SLOT_BOOKING));break;case it.SUMMARY:e(Qt.setDialogType(it.SUMMARY_CLOSE));return;case it.SUMMARY_CLOSE:e(Qt.setDialogType(it.SUMMARY));break;case it.PAYMENT:e(Qt.setDialogType(it.PAYMENT_CLOSE));return;case it.PAYMENT_CLOSE:e(Qt.setDialogType(it.PAYMENT));break;case it.ORDER_CONFIRMATION:window.location.reload();break;default:e(Qt.setDialogType(void 0))}},tes=v(vs)`
    block-size: unset !important;
`,ses=({data:e})=>{const t=F(),n=He(),o=x_(),r=f(WR),{definition:{name:a,frequency:i,deliveryWindow:l},order:{deliveryAddress:c,deliveryWindow:d,price:u}}=e,p=o(i),g=zXe[l.day],E=Qd(g,Ja),y=`${l.from} - ${l.to}`,I=`${p}, ${E} ${y}`,S=r.find(P=>P.addressId===c.addressId),C=`${c.nickname} - ${S?.formattedAddress}`,T=$o(d.startDateTime||Ni(),d.timezone||"UTC",iC),_=IR(d.endDateTime||Ni(),d.timezone||"UTC",$n),A=`${T} - ${_}`,R=n(u.final);return s.jsxs(h.Fragment,{children:[s.jsx(tes,{icon:"recurring_order",title:{text:a,as:"h3"},description:I,to:lo(),onClick:()=>t(R_),className:"salt-m-b--2"}),s.jsx(O,{bold:!0,size:"l",children:s.jsx(b,{id:"recurring.orders.sign.up.created.upcoming.order"})}),s.jsx(ees,{date:A,address:C,price:R})]})},nes=({data:e})=>{const t=!!e?.definition?.name;return s.jsx(B.Body,{children:s.jsxs(Q,{gap:["sm"],additionalCss:"inline-size: 100%;",children:[s.jsx(O,{bold:!0,size:"l",children:s.jsx(b,{id:"recurring.orders.sign.up.created.ro.header"})}),t?s.jsx(ses,{data:e}):s.jsx(xe,{children:s.jsx(b,{id:"recurring.order.currently.not.visible"})})]})})},oes=v.span`
    vertical-align: middle;
`,res=()=>s.jsx(wf,{children:s.jsxs(ee,{as:"h1",id:Mc,children:[s.jsx(pe,{name:"status_yes",height:24,width:24,success:!0,verticalAlign:"middle",className:"salt-m-r--2"}),s.jsx(oes,{children:s.jsx(Nt,{id:"recurring.orders.sign.up.created.title"})})]})}),aes=()=>{const e=f(OJt),{definition:t}=e,n=F(),{isGA4EventSent:o,setIsGA4EventSent:r}=_se();return h.useEffect(()=>{if(t&&!o){n(U.analyticsEvent({type:mt.RECURRING_ORDER_CREATED_GA4_EVENT,recurringShoppingDefinition:e.definition,recurringOrderType:lc.SMART_SHOP}));const a={event:"recurring_order_creation",type:lc.SMART_SHOP,frequency:wC(e.definition.frequency)??"",slot_day:FC(e.definition.deliveryWindow)??0,slot_start_time:e.definition.deliveryWindow?.from,slot_end_time:e.definition.deliveryWindow?.to};te.sendEvent({GA:a,WA:null}),r()}},[t,n,o,r]),s.jsxs(h.Fragment,{children:[s.jsx(res,{}),s.jsx(nes,{data:e})]})},ies=()=>s.jsx(x,{asChild:!0,intent:"secondary",fill:!0,className:"salt-m-t--2",children:s.jsx(Ye,{intent:"ghost",href:Xa(),children:s.jsx(x.Text,{children:s.jsx(b,{id:"recurring.orders.sign.up.add.new.address"})})})}),les=v.fieldset`
    border: none;
    padding: 0;
    margin: 0;
    min-inline-size: inherit;
    white-space: normal;
    overflow-wrap: anywhere;
    inline-size: 100%;
`,oie=({legend:e,children:t})=>s.jsxs(les,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("legend",{children:s.jsx(ee,{as:"h3",children:s.jsx(b,{id:e})})})}),t]}),ces=({addresses:e})=>{const t=F(),n=f(Ma),o=r=>{t(Qt.setFormData({...n,deliveryDestinationId:r?.target?.value}))};return h.useEffect(()=>{const r=e?.[0]?.deliveryDestinationId;!n.deliveryDestinationId&&r&&t(Qt.setFormData({...n,deliveryDestinationId:r}))},[e]),e?.length?s.jsx(oie,{legend:"recurring.orders.sign.up.step.title.address",children:s.jsx(Q,{gap:["sm"],additionalCss:"inline-size: 100%;",children:e.filter(Dl).map(r=>s.jsx(xe,{condensed:!0,"data-test":"box-current-breakpoint",children:s.jsx(Ao,{onChange:o,value:r.deliveryDestinationId,checked:n?.deliveryDestinationId===r.deliveryDestinationId,label:r.name,disabled:!1,error:"","data-test":"address-radio",bold:!0,last:!0,role:void 0,children:r.formattedAddress})},r.deliveryDestinationId))})}):null},des=()=>{const e=f(Rl),t=e.data?Object.values(e.data):[],n=a_(hn.getHomeDeliveryDestinations());return[t,n]},ues=()=>{const e=F(),[t,n]=des();return s.jsxs(h.Fragment,{children:[s.jsxs(B.Body,{children:[s.jsx(A_,{}),s.jsx(pi,{isLoading:n,children:s.jsxs(Q,{gap:["sm"],additionalCss:"inline-size: 100%;",children:[s.jsx(ces,{addresses:t}),s.jsx(ies,{})]})})]}),!n&&s.jsx(B.Footer,{children:s.jsx(b_,{onClick:()=>e(Qt.setDialogType(it.FREQUENCY)),children:s.jsx(b,{id:"recurring.orders.sign.up.next.button"})})})]})},pes=({recurringSlots:e,error:t,setFieldTouched:n})=>{const o=F(),r=L(),{signUpDays:a,slots:i}=e,l=f(Ms),c=f(Ma),d=r.formatMessage("recurring.orders.sign.up.slotbooking.day.label"),u=r.formatMessage("recurring.orders.sign.up.slotbooking.day.placeholder"),p=I=>{const S=I?.target?.value;o(Qt.setFormData({...c,dayOfWeek:S,slotId:""})),n(C=>({...C,slotId:!1}))},g=I=>I[0]+I.substring(1).toLowerCase(),E=I=>a.includes(I)&&i.filter(S=>S.dayOfWeek===I).length,y=[...Array(7).keys()].map(I=>ya().locale(l||"en-GB").weekday(I).format("dddd").toUpperCase());return s.jsx(Dr,{size:"md",error:t,label:d,placeholder:u,value:c.dayOfWeek,id:"slot-day",onChange:p,onFocus:()=>n(I=>({...I,dayOfWeek:!0})),"data-test":"day-selector",children:y.map(I=>s.jsxs("option",{value:I,disabled:!E(I),children:[`${g(I)} `,E(I)?null:r.formatMessage("recurring.orders.sign.up.slotbooking.no.available.slots")]},I))})},mes=["part1","part2","part3"],hes=({slots:e,error:t,setFieldTouched:n})=>{const o=F(),r=f(Ma),{signUpDays:a}=f(Pj),i=a.includes(r.dayOfWeek),l=L(),c=l.formatMessage("recurring.orders.sign.up.slotbooking.time.label"),d=l.formatMessage("recurring.orders.sign.up.slotbooking.time.placeholder"),u=g=>{const E=e.find(({slotId:y})=>y===g?.target?.value);E&&o(Qt.setFormData({...r,slotId:E.slotId,from:E.from,to:E.to}))};h.useEffect(()=>{if(r.dayOfWeek&&r.from&&r.to){const g=e.find(({from:E,to:y,dayOfWeek:I})=>I===r.dayOfWeek&&E===r.from&&y===r.to);if(g){o(Qt.setFormData({...r,slotId:g.slotId}));return}}o(Qt.setFormData({...r,slotId:"",from:"",to:""}))},[]);const p=e?.filter(({dayOfWeek:g})=>g===r.dayOfWeek).reduce((g,E)=>({...g,[E.partOfDayId]:[...g[E.partOfDayId],E]}),{part1:[],part2:[],part3:[]});return i?s.jsx(Dr,{size:"md",error:t,label:c,placeholder:d,value:r.slotId,id:"slot-time",onChange:u,onFocus:()=>n(g=>({...g,slotId:!0})),"data-test":"slot-selector",children:mes.map(g=>s.jsx("optgroup",{label:l.formatMessage(`slotbooking.table.part.of.day.${g}`),children:p[g].map(({slotId:E,from:y,to:I})=>s.jsxs("option",{value:E,children:[y," - ",I]},E))},g))}):null},ges=e=>{const t=f(Pj),n=a_(xo.getSlots(e));return[t,n]},Ees=({recurringSlots:e})=>{const t=L(),n=f(Ma),{slots:o}=e,r=o?.find(({slotId:c})=>n.slotId===c),a=h.useMemo(()=>{if(!r)return{intent:"info",message:t.formatMessage("recurring.orders.sign.up.slotbooking.order.info")};const c=s.jsx("strong",{children:$o(r.slotStartDateTime,r.timeZoneId,iC)});return{intent:"info",message:t.formatMessage("recurring.orders.sign.up.slotbooking.delivery.date",{deliveryDate:c})}},[n.slotId,n.dayOfWeek,r]),{intent:i,message:l}=a;return i?s.jsx(Te,{intent:i,text:l}):null},fes=()=>{const e=f(Ma),[t,n]=ges(e.deliveryDestinationId),o=F(),[r,a]=h.useState(!1),[i,l]=h.useState(()=>({dayOfWeek:"",slotId:""})),[c,d]=h.useState({dayOfWeek:!1,slotId:!1}),u=L();h.useEffect(()=>{a(!1),l(I=>({...I,dayOfWeek:"",slotId:""}))},[c,e]);const p=()=>l(I=>({...I,[e.dayOfWeek?"slotId":"dayOfWeek"]:u.formatMessage(`recurring.orders.sign.up.slotbooking.${e.dayOfWeek?"time":"day"}.selector.error`)})),g=()=>(p(),!!e.dayOfWeek&&!!e.slotId),E=async()=>{if(g()){a(!0);try{await o(xo.reserveSlot(e.deliveryDestinationId,e.slotId)),o(Qt.setDialogType(it.SUMMARY))}catch{Z.error("toast.notification.generic.error")}a(!1)}},y=n||r;return s.jsxs(h.Fragment,{children:[s.jsxs(B.Body,{children:[s.jsx(A_,{}),s.jsxs(pi,{isLoading:y,children:[s.jsx(pes,{recurringSlots:t,error:i.dayOfWeek,setFieldTouched:d}),s.jsx(hes,{error:i.slotId,setFieldTouched:d,slots:t.slots}),s.jsx(Ees,{recurringSlots:t})]})]}),!y&&s.jsx(B.Footer,{children:s.jsx(b_,{onClick:E,children:s.jsx(b,{id:"recurring.orders.sign.up.next.button"})})})]})},yes=({deliveryFrequency:e})=>{const t=F(),n=f(Ma),o=x_(),r=a=>{t(Qt.setFormData({...n,frequency:JSON.parse(a.target?.value)}))};return h.useEffect(()=>{n.frequency.value==="-1"&&t(Qt.setFormData({...n,frequency:{value:e[0]?.value??"-1",unit:e[0]?.unit??""}}))},[e]),e.length?s.jsx(oie,{legend:"recurring.orders.sign.up.step.title.frequency",children:s.jsx(Q,{gap:["sm"],additionalCss:"inline-size: 100%;",children:e.map(a=>s.jsx(xe,{condensed:!0,"data-test":"box-current-breakpoint",children:s.jsx(Ao,{onChange:r,value:JSON.stringify({value:a.value,unit:a.unit}),checked:n.frequency.value===a.value,label:"",disabled:!1,error:"","data-test":"frequency-radio",bold:!0,last:!0,role:void 0,children:o(a)})},a.name))})}):null},Ies=()=>{const e=F(),[t,n]=ise();return s.jsxs(h.Fragment,{children:[s.jsxs(B.Body,{children:[s.jsx(A_,{}),s.jsx(pi,{isLoading:n,children:s.jsx(Q,{gap:["sm"],additionalCss:"inline-size: 100%;",children:s.jsx(yes,{deliveryFrequency:t?.frequencies})})})]}),!n&&s.jsx(B.Footer,{children:s.jsx(b_,{onClick:()=>e(Qt.setDialogType(it.SLOT_BOOKING)),children:s.jsx(Nt,{id:"recurring.orders.sign.up.next.button"})})})]})},Ses=()=>{const e=f($c);return s.jsxs(h.Fragment,{children:[e===it.ADDRESS&&s.jsx(ues,{}),e===it.FREQUENCY&&s.jsx(Ies,{}),e===it.SLOT_BOOKING&&s.jsx(fes,{})]})},Ces=()=>{const e=h.useRef(null);return h.useEffect(()=>{e.current&&e?.current?.nextSibling?.remove()},[e.current]),s.jsx(ee,{as:"h1",id:Mc,ref:e,children:s.jsx(Nt,{id:"recurring.orders.sign.up.closing.confirmation.title"})})},ves=()=>s.jsx(O,{children:s.jsx(Nt,{id:"recurring.orders.sign.up.closing.confirmation.content"})}),Tes=({onConfirm:e})=>{const t=F();return s.jsxs(va,{children:[s.jsx(va.Button,{intent:"secondary",fill:!0,onClick:()=>t(R_),children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"recurring.orders.sign.up.close.cancel"})})}),s.jsx(va.Button,{intent:"primary",fill:!0,onClick:()=>e(),children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"recurring.orders.sign.up.close.confirm"})})})]})},_es=({type:e,closeConfirmed:t,slotId:n})=>{const o=F(),r=()=>{e===it.SUMMARY_CLOSE&&o(xo.releaseSlot(n)),t()};return s.jsxs(ae.Fragment,{children:[s.jsx(wf,{children:s.jsx(Ces,{})}),s.jsx(B.Body,{children:s.jsx(ves,{})}),s.jsx(B.Footer,{children:s.jsx(Tes,{onConfirm:r})})]})},bes=v.span`
    vertical-align: middle;
`,xes=()=>s.jsxs(ee,{as:"h1",id:Mc,children:[s.jsx(pe,{height:24,width:24,name:"recurring_order",verticalAlign:"middle",className:"salt-m-r--2"}),s.jsx(bes,{children:s.jsx(Nt,{id:"recurring.orders.sign.up.learn.more.header"})})]}),Aes=()=>s.jsxs(gn,{gap:["xs"],additionalCss:"inline-size: 100%;",children:[s.jsx(O,{bold:!0,children:s.jsx(b,{id:"recurring.orders.sign.up.learn.more.slot.header"})}),s.jsx(O,{className:"salt-m-b--2",children:s.jsx(b,{id:"recurring.orders.sign.up.learn.more.slot.content"})}),s.jsx(O,{bold:!0,children:s.jsx(b,{id:"recurring.orders.sign.up.learn.more.smart.header"})}),s.jsx(O,{className:"salt-m-b--2",children:s.jsx(b,{id:"recurring.orders.sign.up.learn.more.smart.content"})}),s.jsx(O,{bold:!0,children:s.jsx(b,{id:"recurring.orders.sign.up.learn.more.control.header"})}),s.jsx(O,{children:s.jsx(b,{id:"recurring.orders.sign.up.learn.more.control.content"})})]}),Res=()=>{const e=F();return f(rse)?.smart?.eligible?s.jsx(B.Footer,{children:s.jsx(x,{intent:"primary",fill:!0,onClick:()=>e(Qt.setDialogType(it.ADDRESS)),children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"recurring.orders.sign.up.create.recurring.order"})})})}):null},Des=()=>s.jsxs(h.Fragment,{children:[s.jsx(wf,{children:s.jsx(xes,{})}),s.jsx(B.Body,{children:s.jsx(Aes,{})}),s.jsx(Res,{})]}),Oes=[it.ADDRESS_CLOSE,it.FREQUENCY_CLOSE,it.SLOT_BOOKING_CLOSE,it.SUMMARY_CLOSE,it.PAYMENT_CLOSE],Pes=()=>{const e=f($c),t=F(),n=f(Ma),o=f(D("pay.ywlt"));return e===it.PAYMENT&&o||!e?null:Oes.includes(e)?s.jsx(_es,{type:e,closeConfirmed:()=>{t(Qt.setDialogType(void 0)),t(Qt.setFormData(PQ)),t(Qt.setPaymentAuthUrl(void 0))},slotId:n.slotId}):e===it.LEARN_MORE?s.jsx(Des,{}):e===it.SUMMARY?s.jsx(j1,{children:s.jsx(YJt,{})}):e===it.PAYMENT?s.jsx(JJt,{}):e===it.ORDER_CONFIRMATION?s.jsx(aes,{}):s.jsx(j1,{children:s.jsx(Ses,{})})},rie=()=>{const e=Ne(),t=Ge();return h.useCallback(n=>{const o=new URLSearchParams(e.search);o.has(n)&&(o.delete(n),t({search:o.toString()},{replace:!0}))},[e,t])},Nes=()=>{const e=L(),t=F(),n=f(Ma),{paymentOption:o,paymentType:r}=f(Im),a=f(ME),i=rie(),l=()=>{i("recoveryToken"),t(J.closeModal()),t(Qt.setDialogType(void 0)),setTimeout(()=>t(Qt.setDialogType(it.PAYMENT)),0)},c=C=>{t(Qt.setOrderCompleteData(C)),t(J.closeModal()),t(Qt.setDialogType(it.ORDER_CONFIRMATION))},{deliveryDestinationId:d,name:u,slotId:p,frequency:{unit:g,value:E},dayOfWeek:y}=n,I=async C=>{const T={deliveryDestinationId:d,redirectUrl:`${window.location.origin}${lo()}`,frequency:{unit:g,value:E},name:u||e.formatMessage("recurring.orders.definition.default.name",{dayOfWeek:y}),slotId:p,group:o,type:r||"UNKNOWN",toSave:[dt.PAY_NOW,dt.UNKNOWN].includes(o)&&a,walletItemId:C};try{const A=(await t(xo.checkout(T))).payload.responseData;if("url"in A)return A.url;c(A);return}catch(_){throw Z.error("toast.notification.generic.error"),_}},S=async C=>t(nie.complete3ds({details:C})).then(c).catch(T=>{throw Z.error("toast.notification.generic.error"),T});return s.jsx(jM,{modalsTitle:e.formatMessage("recurring.orders.sign.up.payment.header"),confirmPaymentMethodText:e.formatMessage("recurring.orders.sign.up.payment.confirm"),onInitiatePayment:I,onAuthFailure:l,onAuthCompleted:S,isTaxGrossDisplayed:!1,onClosePaymentMethodPicker:()=>t(R_),asBottomSheet:!0})},Les=()=>{const e=f($c),t=f(D("pay.ywlt")),n=F(),o=!!e&&(!t||e!==it.PAYMENT);return h.useEffect(()=>{t&&e===it.PAYMENT&&n(Gt.initiatePayment())},[e]),s.jsxs(h.Fragment,{children:[s.jsx(B,{asBottomSheet:!0,isOpen:o,onRequestClose:()=>n(R_),aria:{labelledby:Mc},children:s.jsx(Pes,{})}),t&&e===it.PAYMENT&&s.jsx(Nes,{})]})},kes=({hasRecurringShoppingDefinitions:e,isEligible:t})=>{const n=F(),o=L(),i=dr()==="xs"&&e;return s.jsxs("div",{className:i?"salt-d--flex":"",children:[t&&s.jsx(x,{fill:!0,intent:"primary",onClick:()=>n(Qt.setDialogType(it.ADDRESS)),className:"salt-m-y--1",children:s.jsx(x.Text,{children:o.formatMessage("recurring.orders.sign.up.create.recurring.order")})}),s.jsxs(x,{intent:"secondary",fill:!i,onClick:()=>n(Qt.setDialogType(it.LEARN_MORE)),className:`${i?"salt-m-l--2":""} salt-m-y--1`,children:[e&&s.jsx(x.Icon,{name:"info_default"}),s.jsxs(x.Text,{className:e?"xs:max-sm:salt-vc":"",children:[s.jsx(b,{id:"recurring.orders.sign.up.learn.more"}),s.jsx(ie,{children:o.formatMessage("recurring.orders.sign.up.learn.more.about.recurring.orders")})]})]})]})},jes=v(Oe.Action.Footer)`
    margin-block-start: ${({hasRecurringShoppingDefinitions:e})=>e&&0};
`,Mes=({isEligible:e,hasRecurringShoppingDefinitions:t,children:n})=>s.jsxs(Oe.Action,{xs:1,sm:2,md:3,lg:4,children:[n,s.jsx(jes,{hasRecurringShoppingDefinitions:t,children:s.jsx(kes,{hasRecurringShoppingDefinitions:t,isEligible:e})})]}),wes=({hasRecurringShoppingDefinitions:e})=>s.jsx(Te,{size:"s",text:s.jsx(b,{id:e?"recurring.orders.sign.up.unavailable.at.the.moment":"recurring.orders.sign.up.feature.unavailable"})}),Fes=(e,t,n,o)=>{const r=L();return h.useMemo(()=>e?t?{title:"",description:""}:{title:r.formatMessage("recurring.orders.sign.up.title"),description:s.jsx("p",{children:s.jsx(b,{id:"recurring.orders.sign.up.description"})})}:o?n?{title:r.formatMessage("recurring.orders.sign.up.title"),description:s.jsx("p",{children:s.jsx(b,{id:"recurring.orders.sign.up.after.next.order.description"})})}:{title:r.formatMessage("recurring.orders.sign.up.title"),description:s.jsx("p",{children:s.jsx(b,{id:"recurring.orders.sign.up.after.first.order.description"})})}:{title:r.formatMessage("recurring.orders.sign.up.title"),description:""},[e,o,t,n])},Bes=()=>{const e=f(rse),t=a_(xo.getEligibility());return[e,t]},Ues=v(Oe.Action.Header)`
    justify-content: flex-start;
    text-align: initial;
`,Ges=v(Oe.Action.Body)`
    text-align: initial;
`,$es=({headerSection:e})=>s.jsxs(ae.Fragment,{children:[e.title&&s.jsx(Ues,{singleLine:!0,children:s.jsx(Oe.Action.HeaderText,{as:"h2",children:s.jsx(ee,{as:"span",children:e.title})})}),e.description&&s.jsx(Ges,{children:s.jsx(O,{className:"salt-m-y--4",asChild:!0,size:"l",children:e.description})})]}),Hes=v(Oe.Action.Header)`
    justify-content: flex-start;
    text-align: initial;
`,Ves=v(Oe.Action)`
    justify-content: flex-start;
`,Wes=({hasRecurringShoppingDefinitions:e,hasPastOrders:t})=>{const[n,o]=Bes(),r=f(u=>u.session.isSuperuser),a=n?.smart?.eligible,i=n?.smart?.reason,l=i==="NO_ORDER_HISTORY",c=Fes(a,e,t,l);return o?s.jsx(Oe.Action.Skeleton,{xs:1,sm:2,md:3,lg:4}):!a&&l&&e||r?null:a||i==="NO_ORDER_HISTORY"?s.jsx(Mes,{isEligible:a,hasRecurringShoppingDefinitions:e,children:s.jsx($es,{headerSection:c})}):s.jsxs(Ves,{xs:1,sm:2,md:3,lg:4,children:[!e&&s.jsx("div",{className:"salt-m-b--4",children:s.jsx(Hes,{singleLine:!0,children:s.jsx(Oe.Action.HeaderText,{as:"h2",children:s.jsx(ee,{as:"span",children:c.title})})})}),s.jsx(Oe.Action.Body,{children:s.jsx(wes,{hasRecurringShoppingDefinitions:e})})]})},Ex="RO_SIGN_UP_FORM_STATE",M1="recoveryToken",Yes=({hasRecurringShoppingDefinitions:e,hasPastOrders:t})=>{const n=F(),o=f($c),r=Bn(o),a=f(Ma),i=d=>{n(Qt.setFormData(d))},l=Ne(),c=rie();return h.useEffect(()=>{if(r!==o){if(o===it.PAYMENT){localStorage.setItem(Ex,JSON.stringify(a));return}r===it.PAYMENT&&(localStorage.removeItem(Ex),c(M1))}},[r,o]),h.useEffect(()=>{const d=localStorage.getItem(Ex),u=Qe.parse(l.search)?.[M1];if(d&&u){try{const p=JSON.parse(d);i(p)}catch{}n(Qt.setDialogType(it.PAYMENT))}},[]),s.jsxs(ae.Fragment,{children:[s.jsx(Wes,{hasRecurringShoppingDefinitions:e,hasPastOrders:t}),s.jsx(Les,{})]})},qes=(e,t,n,o)=>{const r=`${e.definitionName||""}, ${e.addressName||""}`,a=()=>s.jsx(qn,{dateIsoFrom:e.dates.deliveryStartDate,dateIsoTo:e.dates.deliveryEndDate,timeZoneId:e.dates.timeZoneId,dateFormat:o,timeFormat:n});return s.jsx(vs,{"data-test":"order-card-recurring-placeholder",title:{text:a(),as:"h3",a11yText:t.formatMessage("orders.list.card.accessibility.title.label")},description:r,icon:"recurring_order",to:sue(e.definitionId,e.referenceId)},e.referenceId)},aw=async(e,t,n)=>{const o=go({basePath:e.basePath,target:t}),r={"client-route-id":e.clientRouteId,"content-type":"application/json; charset=utf-8","X-CSRF-TOKEN":e.csrfToken},a=await fetch(o,{method:n.method,credentials:"same-origin",headers:r,...n.body?{body:JSON.stringify(n.body)}:{}});if(!a.ok)throw new Error(a.statusText);return a},aie=async(e,t,n,o,r)=>{const i={method:"POST",body:{checkoutUrl:n&&o?`${window.location.origin}${kd(o)}${lo()}`:`${window.location.origin}${lo()}`,...r?{walletItemId:r}:{}}};return await(await aw(e,`/${Sl}/v1/web/definitions/${t}/reauth`,i)).json()},Kes=async(e,t,n,o)=>{const r={method:"POST",body:{token:n,...o?{walletItemId:o}:{}}};await aw(e,`/${Sl}/v1/web/definitions/${t}/reauth/validate`,r)},w1=({definitionName:e})=>s.jsxs(h.Fragment,{children:[s.jsx("div",{children:s.jsx(b,{id:"payment.choose.payment.method"})}),s.jsx("div",{className:"salt-m-t--2",children:s.jsxs(Q,{align:"center",children:[s.jsx(pe,{name:"recurring_order",height:24,width:24}),s.jsx(O,{size:"l",className:"salt-m-l--2",children:e})]})})]}),zes=async(e,t,n,o)=>{const r={method:"PUT",body:{paymentId:n,walletItemId:o}};await aw(e,`/recurringshopping/v1/web/definitions/${t}/payment`,r)},Qes=({isFetchingPspWebUrl:e,definitionName:t,pspUrl:n,openChangePaymentModalForInternalWalletWithPsp:o,closePaymentsModal:r,showMessage:a,definitionId:i,recoveryToken:l,onAfterClose:c})=>{const d=f(At),u=f(Do),p=f(Na),[g,E]=h.useState(!1),[y,I]=h.useState(null),S=L(),C=Ne(),T={basePath:d,csrfToken:p,clientRouteId:u},_=k=>{Ue.api.pushError(k),a("orders.list.recurring.order.editPayment.error","error")},A=async k=>{try{await Kes(T,i,k,y),a("orders.list.recurring.order.editPayment.success","success")}catch(M){_(M)}r()},R=async k=>{if(!("paymentId"in k)||!k.paymentId)throw new Error("PaymentId is not available for selected wallet item");await zes(T,i,k.paymentId,y),r(),a("orders.list.recurring.order.editPayment.success","success")},P=async()=>{E(!0);try{const k=await aie(T,i,void 0,void 0,y);"pspWebSessionUrl"in k&&k.pspWebSessionUrl?o(k.pspWebSessionUrl):await R(k)}catch(k){r(),_(k)}E(!1)},N=()=>{a("orders.list.recurring.order.editPayment.error","error"),r()};return s.jsxs(h.Fragment,{children:[s.jsx(l_,{isFetching:e,title:s.jsx(w1,{definitionName:t}),handleError:N,handleSuccess:A,url:n,onClose:r,onAfterClose:c,location:C,isRecoveringThreeDs:!!l,asBottomSheet:!0}),s.jsx(Vre,{modalTitle:s.jsx(w1,{definitionName:t}),hideModalSubtitle:!0,buttonText:S.formatMessage("orders.list.recurring.order.editPayment.modal.confirm"),disabled:g,onConfirm:P,onSelectPaymentMethod:({walletItemId:k})=>I(k),onClose:r,onAfterClose:c,asBottomSheet:!0})]})},rR=(e,t)=>de(e?.dates?.deliveryStartDate)-de(t?.dates?.deliveryStartDate),D_=e=>e.data.orders.recurring?.editDefinition,Hc=Y(D_,e=>e?.data),iw=e=>{const t=Hc(e);return dN(t?.definitionId)(e)??null},nl=Y(Hc,e=>e?.definitionDetails),Xes=Y(D_,e=>e?.data?.addressDetails??null),iie=Y(Hc,e=>e?.selectedOrders||[]),Zes=Y(Hc,Ac,(e,t)=>(t?.orders??[])?.filter(o=>o?.recurringShoppingDefinition?.definitionId===e?.definitionId&&o.cancelable&&o.status!=="CANCELLED")??[]),Jes=Y(Hc,e=>e?.definitionDetails?.upcomingOrders??[]),ets=Y(Zes,Jes,(e,t)=>[...e,...t].sort(rR)),lw=Y(Hc,e=>e?.slotsOffering),ku=Y(Hc,e=>e?.nextSlot),Ff=Y(lw,ku,(e,t)=>t?!!e?.slots?.find(n=>Number(n?.dayOfWeekIso)===Number(t?.dayOfWeekIso)&&n?.from===t?.from&&n?.to===t?.to):!0),lie=Y(lw,Ff,ku,(e,t,n)=>{const o=t?e?.slots??[]:[...e?.slots??[],n];return e?.signUpDays?.sort((r,a)=>Number(r.dayOfWeekIso)-Number(a.dayOfWeekIso))?.map(r=>{const a=o?.filter(l=>Number(l.dayOfWeekIso)===Number(r.dayOfWeekIso))?.sort((l,c)=>l.from.localeCompare(c.from))??[];return{...r,slots:a}})??[]}),tts=Y(nl,ku,(e,t)=>{const n=e?.deliveryWindow;return!n||!t?!1:Number(n?.dayOfWeekIso)!==Number(t?.dayOfWeekIso)||n?.from!==t?.from||n?.to!==t?.to}),sts=()=>s.jsx(ee,{as:"h1",children:s.jsx(Nt,{id:"orders.list.recurring.order.editOrder.button"})}),nts=({deliveryStartDate:e,deliveryEndDate:t,timeZoneId:n})=>{const o=$o(e,n,Sr),r=$o(e,n,$n),a=$o(t,n,$n);return`${o} ${r} - ${a}`},ots=({orders:e})=>{const t=F(),n=f(iw),o=f(iie),r=L(),a=u=>o?.some(p=>qu(p)===qu(u)),i=(u,p)=>de(u.dates.deliveryStartDate)-de(p.dates.deliveryStartDate),l=u=>{t(U.analyticsEvent({type:mt.CHECKBOX_FOR_UPCOMING_RECURRING_ORDERS_CLICKED,description:"User selects several orders to cancel",definitionId:n?.definitionId}));const p=u.group.filter(g=>g.checked).map(g=>e.find(E=>qu(E)===g.value)).filter(g=>g!==void 0);t(Vs.setEditRecurringDefinitionData({selectedOrders:p}))},c=()=>{t(U.analyticsEvent({type:mt.CLEAR_SELECTED_BUTTON_CLICKED,description:"User clicks clear selected",pageEventAttributes:{definitionID:n?.definitionId}})),t(Vs.setEditRecurringDefinitionData({selectedOrders:[]}))},d=e.sort(i).map(u=>{const p=nts(u.dates);return{label:p,value:qu(u),name:p,checked:a(u),id:qu(u)}});return s.jsxs(h.Fragment,{children:[s.jsx(xe,{children:s.jsx(fs.CheckboxList,{"data-test":"recurring-order-definition-orders-list",options:d,onChange:l,groupLabel:r.formatMessage("orders.list.future.title")})}),!!o?.length&&s.jsx(x,{intent:"secondary",onClick:c,fill:!0,className:"salt-m-t--2","data-test":"recurring-order-definition-clear-selected-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"filter.button.clear.selected"})})})]})},rts=({text:e})=>s.jsx(Te,{className:"salt-m-t--4",showIcon:!1,intent:"warning",text:e,"data-test":"manually-cancel-confirmed-recurring-order",size:"s"}),ats=({recurringOrderDefinition:e})=>{const t=L();if(!e)return null;const{name:n,frequency:o,deliveryWindow:r}=e,a={recurringOrderCardTitleAccessibility:t.formatMessage("order.details.recurring.order.card.accessibility.title.label")},i=Qd(r.dayOfWeekIso,Ja),l=r.from&&r.to?`${r.from} - ${r.to}`:"";return s.jsx(xe,{children:s.jsxs(Q,{direction:"column",gap:["xs"],children:[s.jsxs(Q,{direction:"row",align:"center",children:[s.jsx(pe,{name:"recurring_order"}),s.jsx(O,{asChild:!0,size:"l",bold:!0,className:"salt-m-l--2",children:s.jsxs("h3",{children:[n,s.jsx(ie,{children:a.recurringOrderCardTitleAccessibility})]})})]}),s.jsx(O,{children:`${i} ${l}`}),s.jsx(O,{children:s.jsx(b,{id:`order.details.recurring.order.frequency.every.${o.value}.${o.unit.toLowerCase()}`})})]})})},cie="cancelRecurringShoppingDefinition",F1="cancel-recurring-shopping-definition-modal-header",its=()=>{const e=f(iw),t=F(),[n]=Ee(["ro.su"]),[o,r]=h.useState(!1),a=Wt(cie),i=Wt(Wl),l=o||!e,c=async()=>{if(e?.definitionId){r(!0);try{await t(xh.cancelRecurringShoppingDefinition(e?.definitionId)),await Promise.all([t(mi.getRecurringShoppingDefinitions()),t(Vl.fetchRecurringShoppingPlaceholders())]),t(U.analyticsEvent({type:mt.RECURRING_ORDER_CANCEL_MODAL_EVENT,userAction:"Cancel",definitionID:e?.definitionId})),t(U.analyticsEvent({type:mt.RECURRING_ORDER_CANCELED_GA4_EVENT,recurringShoppingDefinition:e,recurringOrderType:n?lc.SMART_SHOP:lc.CUSTOMER_DEFINED}));const u={event:"recurring_order_cancellation",type:n?lc.SMART_SHOP:lc.CUSTOMER_DEFINED,frequency:wC(e.frequency)??"",slot_day:FC(e.deliveryWindow)??0,slot_start_time:e.deliveryWindow?.from,slot_end_time:e.deliveryWindow?.to};te.sendEvent({GA:u,WA:null}),a.close(),Z.success("orders.list.recurring.order.cancel.success.notification")}catch{a.close(),Z.error("orders.list.recurring.order.cancel.error")}r(!1)}},d=()=>{a.close(),t(U.analyticsEvent({type:mt.RECURRING_ORDER_CANCEL_MODAL_EVENT,userAction:"Close",definitionID:e?.definitionId})),i.open()};return s.jsxs(B,{isOpen:a.isOpen,onRequestClose:d,aria:{labelledby:F1},asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",id:F1,children:s.jsx(Nt,{id:"orders.list.recurring.order.modal.text.cancel.definition.confirmation"})})}),s.jsx(B.Body,{children:s.jsxs(pi,{isLoading:l,children:[s.jsx(ats,{recurringOrderDefinition:e}),s.jsx(rts,{text:s.jsx(Nt,{id:"orders.list.recurring.order.modal.text.cancel.ro.definition.info"})})]})}),!l&&s.jsx(B.Footer,{children:s.jsxs(va,{children:[s.jsx(va.Button,{fill:!0,"data-test":"cancel-recurring-shopping-definition-dismiss-button",onClick:d,intent:"secondary",children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"orders.list.recurring.order.modal.text.cancel.selected.orders.rejection"})})}),s.jsx(va.Button,{fill:!0,"data-test":"cancel-recurring-shopping-definition-confirm-button",intent:"primary",disabled:o,onClick:c,children:s.jsx(x.Text,{children:s.jsx(Nt,{id:"orders.list.recurring.order.modal.text.cancel.selected.orders.acceptance"})})})]})})]})},lts=v.button`
    cursor: pointer;
`,cts=({onClickEditPaymentButton:e})=>{const t=f(D("rocpm")),n=f(D("rocpm.d")),o=f(nl);if(!o)return null;const r=o?.paymentInfo;return t&&n&&r&&r?.paymentMethodV2!==at.INVOICE?s.jsx(xe,{asChild:!0,className:"salt-m-b--2",children:s.jsx(lts,{type:"button",onClick:e,"data-test":"recurring-order-change-payment-method-button",children:s.jsxs(Q,{justify:"space-between",align:"center",additionalCss:"inline-size: 100%;",as:"span",wrap:"nowrap",gap:["sm"],children:[s.jsxs(Q,{direction:"column",gap:["xs"],as:"span",additionalCss:"min-inline-size: 0;",children:[s.jsx(O,{size:"l",bold:!0,children:s.jsx(Nt,{id:"orders.list.recurring.order.edit.payment"})}),s.jsx(zm,{paymentInfo:r,inline:!0})]}),s.jsx(pe,{name:"edit",verticalAlign:"middle"})]})})}):null},dts=e=>async t=>{if(await t(Vs.setEditRecurringDefinitionData(null)),!!e){t(Vs.setEditRecurringDefinitionData({definitionId:e})),t(Vs.setEditRecurringDefinitionState({isFetching:!0})),t(J.openModal(Wl));try{const o=(await t(die(e)))?.deliveryDestinationId;await t(uie(o))}catch{t(J.closeModal()),Z.error("toast.notification.generic.error")}t(Vs.setEditRecurringDefinitionState({isFetching:!1}))}},die=e=>async t=>{if(!e)return null;const o=(await t(Vs.fetchEditRecurringDefinitionDetails(e))).payload.responseData;return t(Vs.setEditRecurringDefinitionData({definitionDetails:o})),o},uie=e=>async t=>{if(!e)return null;const o=(await t(Vs.fetchEditRecurringDefinitionAddressDetails(e)))?.payload?.responseData;return t(Vs.setEditRecurringDefinitionData({addressDetails:o})),o},uts=e=>async t=>{if(e){t(Vs.setEditRecurringDefinitionState({isFetching:!0}));try{const o=(await t(Vs.fetchEditRecurringDefinitionSlotsOffering(e))).payload.responseData;t(Vs.setEditRecurringDefinitionData({slotsOffering:o,nextSlot:o?.currentSlot}))}catch{t(J.openModal(Wl)),Z.error("toast.notification.generic.error")}t(Vs.setEditRecurringDefinitionState({isFetching:!1}))}},O_={editRecurringDefinition:dts,fetchEditRecurringDefinitionDetails:die,fetchEditRecurringDefinitionAddressDetails:uie,fetchSlotsOffering:uts},pie=(e,t)=>!e||!t?!1:Number(e?.dayOfWeekIso)===Number(t?.dayOfWeekIso)&&e?.from===t?.from&&e?.to===t?.to,fx=e=>{if(!(!e?.from||!e?.to))return`${e.from}-${e.to}`},pts=e=>{if(!e)return;const[t,n]=e.split("-");if(!(!t||!n))return{from:t,to:n}},mts=()=>{const e=F(),t=f(nl),n=t?.deliveryWindow,o=f(ku),r=f(Ff),a=Wt(Wl),i=()=>{e(Vs.setEditRecurringDefinitionData({nextSlot:void 0}))},l=async()=>{const c=t?.definitionId;if(!c||!o?.dayOfWeekIso||!o?.from||!o?.to||!o?.partOfDayId||!r)return;if(pie(n,o)){a.open(),i();return}e(Vs.setEditRecurringDefinitionState({isFetching:!0}));const d=o?.dayOfWeekIso,u=o?.from,p=o?.to,g=o?.partOfDayId;try{const E=await e(Vs.updateRecurringDefinitionSlot({definitionId:c,dayOfWeekIso:d?.toString(),startTime:u,endTime:p}));await Promise.all([e(mi.getRecurringShoppingDefinitions()),e(Vl.fetchRecurringShoppingPlaceholders()),e(O_.fetchEditRecurringDefinitionDetails(c))]);const y=E?.payload?.responseData;a.open({effectiveFrom:{value:y?.effectiveFrom,timeZoneId:y?.timeZoneId}}),i(),e(U.analyticsEvent({type:mt.RECURRING_ORDER_DAY_AND_TIME_SAVED,definitionId:c,dayOfWeekIso:Number(d),partOfDayId:g,startTime:u,endTime:p})),e(Vs.setEditRecurringDefinitionData({isFetchPlaceholdersOnClose:!0}))}catch{Z.error("toast.notification.generic.error")}e(Vs.setEditRecurringDefinitionState({isFetching:!1}))};return s.jsx(x,{intent:"primary",onClick:l,fill:!0,"data-test":"ro-edit-slot-confirm-button",children:s.jsx(b,{id:"orders.list.recurring.order.edit.slot.button.save"})})},hts=v.span`
    vertical-align: middle;
`,gts=({onClick:e})=>{const{formatMessage:t}=L();return s.jsxs(ee,{as:"h1","data-test":"ro-edit-slot-header",children:[s.jsx(x,{size:"s",fill:!1,intent:"tertiary","aria-label":t("modal.close"),onClick:e,className:"salt-m-r--2",children:s.jsx(x.Icon,{name:"arrow_left",height:24,width:24})}),s.jsx(hts,{children:s.jsx(Nt,{id:"orders.list.recurring.order.edit.header.edit"})})]})},mie=()=>{const e=f(Xes);return e?`${e?.name} - ${e?.formattedAddress}`:""},hie=()=>{const e=f(nl),t=x_(),n=e?.frequency;return n?t({value:n.value.toString(),unit:n.unit}):""},Ets=()=>{const e=f(nl);return Qd(e?.deliveryWindow?.dayOfWeekIso,Ja)},fts=()=>{const t=f(nl)?.deliveryWindow;return!t?.from||!t?.to?"":`${t.from} - ${t.to}`},yts=({unavailabilityReason:e,intl:t})=>{switch(e){case eU.RECURRING_ALREADY_EXISTS:return t.formatMessage("orders.list.recurring.order.edit.slot.option.existing.order");case eU.NO_SLOTS:return t.formatMessage("orders.list.recurring.order.edit.slot.option.no.slots.available");default:return}},Its=({displayDay:e})=>{const t=L(),n=Qd(e.dayOfWeekIso,Ja),o=yts({unavailabilityReason:e?.unavailabilityReason,intl:t});return o?`${n} ${o}`:n},Sts=()=>{const e=L(),t=F(),n=f(nl),o=f(lie),r=f(ku),i=o?.find(u=>u.dayOfWeekIso===r?.dayOfWeekIso)?.available??!1,c=!f(Ff)&&!i?e.formatMessage("orders.list.recurring.order.edit.error"):void 0,d=u=>{const p=o?.find(E=>Number(E?.dayOfWeekIso)===Number(u.target.value));let g=p?.slots?.find(E=>E?.from===r?.from&&E?.to===r?.to);g||(g={...r,dayOfWeekIso:p?.dayOfWeekIso},t(U.analyticsEvent({type:mt.RECURRING_ORDER_TIME_REJECTED_FROM_DROPDOWN,definitionId:n?.definitionId,dayOfWeekIso:Number(p?.dayOfWeekIso),partOfDayId:g?.partOfDayId,startTime:g?.from,endTime:g?.to}))),t(Vs.setEditRecurringDefinitionData({nextSlot:g}))};return s.jsx(Dr,{size:"md",error:c,label:e.formatMessage("orders.list.recurring.order.edit.slot.day"),placeholder:"",value:r?.dayOfWeekIso,id:"ro-edit-slot-day-selector",onChange:d,"data-test":"ro-edit-slot-day-selector",children:o?.map(u=>s.jsx("option",{value:u.dayOfWeekIso,disabled:!(u.available??!1),children:s.jsx(Its,{displayDay:u})},u.dayOfWeekIso))})},Cts={MORNING:"part1",AFTERNOON:"part2",EVENING:"part3"},vts=()=>{const e=L(),t=F(),n=f(lie),o=f(ku),r=f(lw),a=f(Ff),i=n?.find(E=>E.dayOfWeekIso===o?.dayOfWeekIso),l=i?.slots??[],c=i?.available??!1,d=E=>{const y=o?.dayOfWeekIso,I=pts(E.target.value),S=l?.find(A=>A?.from===I?.from&&A?.to===I?.to),C=S?.from,T=S?.to;if(!y||!C||!T)return;const _=r?.slots?.find(A=>pie(A,{dayOfWeekIso:y,from:C,to:T}));_&&t(Vs.setEditRecurringDefinitionData({nextSlot:_}))},u=!a&&c?e.formatMessage("orders.list.recurring.order.edit.error"):void 0,p=({from:E,to:y})=>!a&&o?.from===E&&o?.to===y,g=({from:E,to:y})=>!a&&c&&p({from:E,to:y})?`${E} - ${y} ${e.formatMessage("orders.list.recurring.order.edit.slot.option.unavailable")}`:`${E} - ${y}`;return c?s.jsx(Dr,{size:"md",error:u,label:e.formatMessage("orders.list.recurring.order.edit.slot.time"),placeholder:"",value:fx(o),id:"ro-edit-slot-time-selector",onChange:d,"data-test":"ro-edit-slot-time-selector",disabled:!c,children:Object.values(Cts).filter(E=>l?.some(y=>y?.partOfDayId===E))?.map(E=>s.jsx("optgroup",{label:e.formatMessage(`slotbooking.table.part.of.day.${E}`),children:l?.filter(y=>y.partOfDayId===E)?.map(y=>s.jsx("option",{value:fx(y),disabled:p(y),children:g(y)},fx(y)))},E))}):null},Tts=()=>{const e=f(tts),t=f(ku),n=f(Ff);if(!t?.effectiveFrom||!t?.timeZoneId||!e||!n)return null;const o=$o(t?.effectiveFrom,t?.timeZoneId,Sr);return s.jsxs("span",{className:"salt-d--inline-block",children:[s.jsx(O,{children:s.jsx(Nt,{id:"orders.list.recurring.order.edit.slot.changes.applied.info",values:{date:o}})}),s.jsx(O,{className:"salt-m-l--1",children:s.jsx(Nt,{id:"orders.list.recurring.order.edit.slot.processed.info"})})]})},_ts=()=>{const e=f(nl),t=mie(),n=hie();return s.jsxs(h.Fragment,{children:[s.jsxs(Q,{direction:"column",className:"salt-p-b--2",children:[s.jsx("div",{className:"salt-p-y--1 salt-overflow-wrap--anywhere",children:s.jsxs(O,{bold:!0,children:[s.jsx(Nt,{id:"orders.list.recurring.order.edit.header.name"}),s.jsx(O,{className:"salt-p-l--1",children:e?.name})]})}),s.jsx("div",{className:"salt-p-y--1 salt-overflow-wrap--anywhere",children:s.jsxs(O,{bold:!0,children:[s.jsx(Nt,{id:"orders.list.recurring.order.edit.header.address"}),s.jsx(O,{className:"salt-p-l--1",children:t})]})}),s.jsx("div",{className:"salt-p-y--1 salt-overflow-wrap--anywhere",children:s.jsxs(O,{bold:!0,children:[s.jsx(Nt,{id:"orders.list.recurring.order.edit.header.frequency"}),s.jsx(O,{className:"salt-p-l--1",children:n})]})})]}),s.jsx(Sts,{}),s.jsx(vts,{}),s.jsx(Tts,{})]})},bts="edit-recurring-order-modal-header",xts=({isOpen:e,onClose:t,isLoading:n})=>s.jsx(B,{isOpen:e,onRequestClose:t,aria:{labelledby:bts},asBottomSheet:!0,children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:"left",children:s.jsx(gts,{onClick:t})}),s.jsx(B.Body,{children:s.jsx(pi,{isLoading:n,children:s.jsx(_ts,{})})}),!n&&s.jsx(B.Footer,{children:s.jsx(mts,{})})]})}),gie="editRecurringSlotModal",Ats=()=>{const e=F(),t=Wt(gie),n=Wt(Wl),{isFetching:o}=f(D_),r=f(nl),a=()=>{const i=r?.definitionId;i&&(n.open(),e(Vs.setEditRecurringDefinitionData({nextSlot:void 0})),e(U.analyticsEvent({type:mt.RECURRING_ORDER_DAY_AND_TIME_MODAL_CLOSED,definitionId:i})))};return s.jsx(xts,{isOpen:t.isOpen,isLoading:o,onClose:a})},Rts=()=>{const t=Wt(Wl).options?.effectiveFrom;return t?s.jsx(Te,{"data-test":"ro-effective-from-alert-banner",size:"s",intent:"success",text:s.jsx(Nt,{id:"orders.list.recurring.order.edit.slot.effective.from",values:{date:$o(t?.value,t?.timeZoneId,Sr)}})}):null},Dts=v.button`
    cursor: pointer;
`,yx=v(O)`
    display: block;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    max-inline-size: 100%;
`,Ots=()=>{const e=F(),t=f(nl),n=Wt(gie),o=mie(),r=hie(),a=Ets(),i=fts();if(!t)return null;const l=()=>{const c=t?.definitionId;c&&(n.open(),e(O_.fetchSlotsOffering(c)),e(U.analyticsEvent({type:mt.RECURRING_ORDER_DAY_AND_TIME_MODAL_DISPLAYED,definitionId:c})))};return s.jsx(xe,{asChild:!0,className:"salt-m-b--2",children:s.jsx(Dts,{type:"button",onClick:l,"data-test":"ro-edit-slot-button",children:s.jsxs(Q,{justify:"space-between",align:"center",additionalCss:"inline-size: 100%;",as:"span",wrap:"nowrap",gap:["sm"],children:[s.jsxs(Q,{direction:"column",gap:["xs"],as:"span",additionalCss:"min-inline-size: 0;",children:[s.jsx(yx,{size:"l",bold:!0,children:t.name}),s.jsx(yx,{size:"m",children:o}),s.jsxs(yx,{size:"m",children:[r,", ",a," ",i]}),s.jsx(Rts,{})]}),s.jsx(pe,{name:"edit",verticalAlign:"middle"})]})})})},Pts=({onClickEditPaymentButton:e,orders:t,recurringDefinition:n})=>{const o=F();if(!n)return null;const r=!!t.length,a=()=>{o(U.analyticsEvent({type:mt.CANCEL_RECURRING_ORDER_BUTTON_CLICKED,description:"User clicks cancel recurring order in order page",definitionId:n.definitionId})),o(J.openModal(cie))};return s.jsxs("div",{"data-test":"recurring-order-definition-edit-modal-body",children:[s.jsxs("div",{children:[s.jsx(Ots,{}),s.jsx(cts,{onClickEditPaymentButton:e}),s.jsx(x,{intent:"secondary",onClick:a,fill:!0,"data-test":"recurring-shopping-definition-card-cancel-button",children:s.jsx(b,{id:"orders.list.recurring.order.definition.cancel.button.ro.definition"})})]}),r&&s.jsxs(h.Fragment,{children:[s.jsx(Ts,{className:"salt-m-y--4"}),s.jsx(O,{bold:!0,size:"l",className:"salt-m-b--2 salt-d--block",children:s.jsx(b,{id:"orders.list.future.title"})})]}),r&&s.jsx(ots,{orders:t})]})},Nts=({orders:e})=>{const t=n=>$o(n.dates.deliveryStartDate,n.dates.timeZoneId,Sr);return s.jsx(Be,{children:e?.map(n=>s.jsx(Be.Item,{className:"salt-m-b--1",children:s.jsx(O,{children:t(n)})},qu(n)))})},Lts=({onCancel:e,onConfirm:t})=>{const{formatMessage:n}=L();return s.jsxs(va,{children:[s.jsx(va.Button,{intent:"secondary",onClick:e,fill:!0,"data-test":"recurring-order-definition-cancel-selected-cancel-button",children:s.jsx(x.Text,{children:n("orders.list.recurring.order.modal.text.cancel.selected.orders.rejection")})}),s.jsx(va.Button,{intent:"primary",onClick:t,fill:!0,"data-test":"recurring-order-definition-cancel-selected-confirm-button",children:s.jsx(x.Text,{children:n("orders.list.recurring.order.modal.text.cancel.selected.orders.acceptance")})})]})},Eie="cancelSelectedRecurringOrdersConfirmation",kts=({recurringOrderDefinition:e,selectedOrders:t})=>{const{formatMessage:n}=L(),o=F(),r=Ge(),a="selected-orders-confirmation-modal-header",[i,l]=h.useState(!1),c=f($e(Eie));h.useEffect(()=>{c&&o(U.analyticsEvent({type:mt.CONFIRM_RECURRING_ORDER_CANCELLATION_MODAL_DISPLAYED,description:"A modal for confirm order cancellation or not",definitionId:e?.definitionId}))},[c]);const d=()=>{o(J.openModal(Wl))},u=async()=>{const y=e?.definitionId;if(!(!y||!t.length)){l(!0),o(U.analyticsEvent({type:mt.CONFIRMED_RECURRING_ORDER_CANCEL_MODAL,description:"User clicks yes in confirm order cancellation modal",definitionId:e?.definitionId,referenceIds:t.map(I=>"orderId"in I?I.orderId:I.referenceId.split("_")[0])}));try{const I=t.filter(_=>"orderId"in _),S=t.filter(_=>!("orderId"in _)),[C,T]=await Promise.all([p(I),g(S)]);(C||T)&&Z.error("toast.notification.generic.error"),await Promise.all([o(Vl.fetchRecurringShoppingPlaceholders()),o(Mi.getPendingOrders()),o(O_.fetchEditRecurringDefinitionDetails(y))])}catch{Z.error("toast.notification.generic.error"),d()}o(Vs.setEditRecurringDefinitionData({selectedOrders:void 0})),l(!1),Z.success("shopping.lists.modal.notification.future.orders.removed"),d()}},p=async y=>{let I=!1;for(const S of y)try{await o(ji.cancelOrder(S.orderId,r,!1))}catch{I=!0}return I},g=async y=>{let I=!1;for(const S of y)try{await o(Sd.cancelRecurringOrderPlaceholder(S.definitionId,S.referenceId))}catch{I=!0}return y.length&&o(Vs.setEditRecurringDefinitionData({isFetchPlaceholdersOnClose:!0})),I},E=()=>{o(U.analyticsEvent({type:mt.NO_BUTTON_CLICKED,description:"User clicks no in confirm order cancellation modal",definitionID:e?.definitionId})),d()};return s.jsx(B,{isOpen:c,onRequestClose:d,aria:{labelledby:a},asBottomSheet:!0,children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:"left",children:s.jsx(ee,{as:"h1",id:Mc,children:n("orders.list.recurring.order.modal.text.cancel.selected.orders.confirmation.question")})}),s.jsx(B.Body,{children:s.jsx(pi,{isLoading:i,children:s.jsx(Nts,{orders:t})})}),!i&&s.jsx(B.Footer,{children:s.jsx(Lts,{onCancel:E,onConfirm:u})})]})})},jts="edit-recurring-order-modal-header",Wl="editRecurringOrder",Mts=({onClickEditPaymentButton:e})=>{const t=F(),o=f(Hc)?.isFetchPlaceholdersOnClose??!1,r=f(iw),a=f(iie)||[],i=f(ets)||[],l=!!i.length,c=Wt(Wl),d=Wt(Eie),u=f(D_),{isFetching:p}=u,g=p||!r,E=()=>{a.length===0?Z.error("orders.list.recurring.order.no.orders.selected.notification"):(t(U.analyticsEvent({type:mt.CANCEL_SELECTED_RECURRING_ORDERS_BUTTON_CLICKED,description:"User clicks cancel selected orders in order page",definitionId:r?.definitionId})),d.open())},y=()=>{c.close(),t(Vs.setEditRecurringDefinitionData(null)),o&&t(Vl.fetchRecurringShoppingPlaceholders())},I=()=>s.jsx(x,{intent:"secondary",onClick:E,fill:!0,"data-test":"recurring-order-definition-cancel-selected-button",children:s.jsx(b,{id:"orders.list.recurring.order.definition.cancel.selected.button"})});return s.jsxs(h.Fragment,{children:[s.jsx(B,{isOpen:c.isOpen,onRequestClose:y,showCloseIcon:!0,aria:{labelledby:jts},asBottomSheet:!0,children:s.jsxs(B.ModalForm,{children:[s.jsx(B.Header,{align:"left",children:s.jsx(sts,{})}),s.jsx(B.Body,{children:s.jsx(pi,{isLoading:g,children:s.jsx(Pts,{recurringDefinition:r,onClickEditPaymentButton:()=>{r&&e(r)},orders:i})})}),!g&&l&&!!a?.length&&s.jsx(B.Footer,{children:I()})]})}),s.jsx(kts,{recurringOrderDefinition:r,selectedOrders:a})]})},wts=({recurringShoppingDefinition:e})=>{const t=F(),n=f(Mt),o=e.frequency&&e.frequency.unit&&e.frequency.value&&s.jsx(b,{id:`orders.list.recurring.order.frequency.every.${e.frequency.value}.${e.frequency.unit.toLowerCase()}`}),r=Qd(e.deliveryWindow.dayOfWeekIso,Ja),a=(c,d)=>{const u=Vt(c,"HH:mm"),p=Vt(d,"HH:mm");return Vg(u.toISOString(!0),p.toISOString(!0),n)},i=()=>{const c=e?.definitionId;t(U.analyticsEvent({type:mt.MANAGE_RECURRING_ORDER_BUTTON_CLICKED,description:"User clicks manage recurring order button",definitionId:c})),t(O_.editRecurringDefinition(c))},l=a(e.deliveryWindow.from,e.deliveryWindow.to);return s.jsxs(Oe.Action,{"data-test":"recurring-shopping-definition-card",xs:1,sm:2,md:3,lg:4,children:[s.jsxs(Oe.Action.Header,{children:[s.jsx(pe,{name:"recurring_order",height:24,width:24}),s.jsx(Oe.Action.HeaderText,{singleLine:!0,children:e.name})]}),s.jsx(Oe.Action.Body,{align:"left",children:s.jsxs(O,{children:[o,", ",r," ",l]})}),s.jsx(Oe.Action.Footer,{children:s.jsx(x,{intent:"secondary",onClick:i,fill:!0,"data-test":"recurring-shopping-definition-card-edit-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"orders.list.recurring.order.editOrder.button"})})})})]},e.definitionId)},Fts=D("pay.ew"),Bts=D("rocpm"),Uts=D("pay.ywlt"),Ix="lsEditedPaymentDefinitionId",Gts=({recurringShoppingDefinitions:e})=>{const t=f(At),n=f(Na),o=f(Do),r=f(Fts),a=f(Bts),i=f(Uts),[l,c]=h.useState(!1),[d,u]=h.useState(null),p=F(),g=Ne(),E=Ge(),[y,I]=h.useState(null),S=f(Fde),C=f(sa),{recoveryToken:T}=Qe.parse(g.search||"");h.useEffect(()=>{T&&p(Lj())},[T]),h.useEffect(()=>{if(!a)return;const w=localStorage.getItem(Ix);if(w){const j=e.data.find(G=>G.definitionId===w);j&&(T?(I(j),p(J.openModal(AI))):k(j))}},[e,T]);const _=(w,j)=>{Z[j](w)},A=()=>{if(localStorage.removeItem(Ix),u(null),I(null),T){const w=new URLSearchParams(g.search);w.delete("recoveryToken"),E({search:w.toString()},{replace:!0})}p(J.closeModal())},R=()=>{p(J.openModal(Wl))},P=w=>{Ue.api.pushError(w),A(),_("orders.list.recurring.order.editPayment.error","error"),R()},N=async w=>{c(!0),p(J.openModal(AI));try{const j=await aie({basePath:t,csrfToken:n,clientRouteId:o},w.definitionId,S,C);"pspWebSessionUrl"in j&&j.pspWebSessionUrl?u(j.pspWebSessionUrl):P(new Error("Response does not contain pspWebSessionUrl"))}catch(j){P(j)}c(!1)},k=async w=>{p(U.analyticsEvent({type:mt.EDIT_PAYMENT_BUTTON_CLICKED,description:"User clicks edit payment in order page",pageEventAttributes:{definitionID:w.definitionId}})),I(w),localStorage.setItem(Ix,w.definitionId),r&&!i?await N(w):p(J.openModal(kM,{...w.paymentInfo?.walletItemId?{initialWalletItemId:w.paymentInfo.walletItemId}:{}}))},M=w=>{u(w),p(J.openModal(AI))};return s.jsxs(h.Fragment,{children:[e.data.map(w=>s.jsx(wts,{recurringShoppingDefinition:w},w.definitionId)),s.jsx("div",{className:"salt-m-b--8"}),s.jsx(its,{}),y&&s.jsx(Qes,{definitionId:y.definitionId,definitionName:y.name,recoveryToken:T,isFetchingPspWebUrl:l,pspUrl:d,openChangePaymentModalForInternalWalletWithPsp:M,closePaymentsModal:A,onAfterClose:R,showMessage:_}),s.jsx(Mts,{onClickEditPaymentButton:k}),s.jsx(Ats,{})]})},$ts=(e,t)=>{const[n,o]=h.useState(void 0),[r,a]=h.useState(!1),[i,l]=h.useState([]),[c,d]=h.useState(),[{data:u,fetching:p}]=Kd({query:e,requestPolicy:"network-only",variables:{first:20,after:n}});h.useEffect(()=>{u&&g(u)},[u]);const g=y=>{const I=t(y);if(I){const S=I.edges.filter(C=>C!=null).map(C=>({...C.node}))||[];l(C=>[...C,...S]),a(I.pageInfo.hasNextPage||!1),d((({edges:C,pageInfo:T,..._})=>_)(I))}};return{data:i,fetching:p,hasNext:r,attrs:c,fetchMore:()=>{if(u&&r){const y=t(u);o(y?.pageInfo.endCursor||void 0)}}}},Hts=e=>{const t=f(sa),n=f(Tl),o=f(Mt),[r,a]=Ee(["onre","md.sl"]),i=(l,c,d)=>{const u=su({deliveryMethod:l.deliveryMethod,slotType:l.slotType,start:l.dates.deliveryStartDate,end:l.dates.deliveryEndDate},a||!1),p={order:l,dateFormat:c,timeFormat:o,type:d,bannerBusinessModel:n,retailerRegionId:t,isOnlineReceiptEnabled:r,isMultidaySlotIcon:u};return s.jsx(nw,{...p})};return s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-y--4",children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsx("h3",{children:e.sectionTitle})})}),s.jsx(V,{flush:!0,children:e.ordersFromMonth.map(l=>s.jsx(V.Item,{colSpan:{xs:12,sm:6,md:4,lg:3},children:i(l,lC,"past")},l.orderId))})]},e.sectionTitle)},Vts=e=>{const t=f(VH),n=o=>o.reduce((r,a)=>{const i=$o(a.dates.deliveryEndDate,a.dates.timeZoneId,t,void 0),l=r.find(c=>c.monthOfYear===i);return l?l.orders.push(a):r.push({monthOfYear:i,orders:[a]}),r},[]).sort((r,a)=>de(a.orders[0]?.dates.deliveryEndDate)-de(r.orders[0]?.dates.deliveryEndDate));return s.jsx("div",{className:"salt-m-y--2","data-test":"completed-orders-container",children:n(e.orders).map((o,r)=>s.jsx(Hts,{ordersFromMonth:o.orders,sectionTitle:o.monthOfYear},`completed-orders-month-key-${r}`))})},Wts=ia(`
    query GetCompletedOrders($first: Int!, $after: String) {
        completedOrders(first: $first, after: $after) {
            retentionPeriod
            pageInfo {
                endCursor
                hasNextPage
            }
            edges {
                node {
                    orderId
                    status
                    region {
                        retailerRegionId
                    }
                    prices {
                        total {
                            currency
                            amount
                        }
                    }
                    recurringOrderDefinition {
                        name
                    }
                    slot {
                        __typename
                        ... on InternalOrderSlot {
                            start
                            end
                            type
                            shippingGroupType
                            carrier {
                                carrierId
                            }
                            externalLocker {
                                externalLockerId
                            }
                            deliveryDestination {
                                deliveryMethod
                                name
                                address {
                                    timeZone
                                }
                            }
                        }
                        ... on ImportedOrderSlot {
                            start
                            end
                            name
                            timeZone
                        }
                    }
                }
            }
        }
    }
`),Yts=e=>{const t=n=>{const{__typename:o}=n.slot;if(o==="ImportedOrderSlot"){const r=n.slot;return{deliveryMethod:hU.HomeDelivery,addressNickname:r.name,slotType:vet.Standard,timeZoneId:r.timeZone,start:r.start,end:r.end}}else{const r=n.slot;return{deliveryMethod:r.deliveryDestination.deliveryMethod===hU.Collection?Il:xa,addressNickname:r.deliveryDestination.name,slotType:r.type,timeZoneId:r.deliveryDestination.address.timeZone,start:r.start,end:r.end,shippingGroupType:r.shippingGroupType,carrierId:r.carrier?.carrierId,externalLockerId:r.externalLocker?.externalLockerId}}};return e.map(n=>{const o=t(n);return{orderId:n.orderId,status:n.status,retailerRegionId:n.region.retailerRegionId,orderTotals:{totalPrice:{amount:n.prices.total.amount,currency:n.prices.total.currency}},dates:{deliveryStartDate:n.slot.start,deliveryEndDate:n.slot.end,timeZoneId:o.timeZoneId},addressNickName:o.addressNickname,deliveryMethod:o.deliveryMethod,slotType:o.slotType,shippingGroupType:o.shippingGroupType,carrierId:o.carrierId,externalAddress:o.externalLockerId&&{externalCollectionPointId:o.externalLockerId},recurringShoppingDefinition:n.recurringOrderDefinition&&{name:n.recurringOrderDefinition.name}}})},qts=()=>{const[e]=Ee(["tx.nts"]),{setCompletedOrdersCount:t}=h.useContext(Iie),{data:n,fetching:o,hasNext:r,attrs:a,fetchMore:i}=$ts(Wts,g=>g.completedOrders);h.useEffect(()=>{n&&!o&&t(n.length)},[n]);const l=()=>s.jsx("div",{className:"salt-m-t--4",children:s.jsx(_s,{"data-test":"order-list-spinner"})}),c=()=>s.jsx("div",{className:"salt-m-t--8",children:s.jsx(O,{asChild:!0,bold:!0,"data-test":"order-list-no-more-orders-label",children:s.jsx("h2",{children:s.jsx(b,{id:"orders.list.past.no.more.orders"})})})}),d=()=>!o&&r,u=()=>s.jsxs(h.Fragment,{children:[o?l():null,r?null:c()]}),p=()=>e&&s.jsx("div",{className:"salt-m-t--1 salt-d--block",children:s.jsx(O,{asChild:!0,children:s.jsx("h3",{children:s.jsx(b,{id:"orders.list.tax.inclusion.note"})})})});return s.jsxs(h.Fragment,{children:[s.jsxs(Q,{align:"baseline",className:"salt-m-y--4",children:[s.jsx("div",{className:"salt-m-r--4",children:s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsxs("h2",{children:[s.jsx(b,{id:"orders.list.past.title"})," ",s.jsx(tie,{retentionPeriod:a?.retentionPeriod})]})})}),p()]}),s.jsx(Vts,{orders:Yts(n)}),u(),d()?s.jsx(ow,{action:i}):null]})},Kts=D("rec.o"),zts=D("tx.nts"),Qts=D("onre"),Xts=D("ro.su"),Zts=D("md.sl"),Jts=D("del.win"),ess=D("pln.win"),tss=D("cmpl.ords.graphql"),sss=e=>"status"in e;class nss extends h.Component{renderFutureOrderCard(t,n){const{timeFormat:o,intl:r,bannerBusinessModel:a,retailerRegionId:i,isOnlineReceiptEnabled:l,isMultidaySlotEnabled:c,isDeliveryWindowEnabled:d,isPlannedDeliveryWindowEnabled:u,getFailedOrderPaymentsForOrder:p}=this.props;if(sss(t)){const g=su({deliveryMethod:t.deliveryMethod,slotType:t.slotType,start:t.dates.deliveryStartDate,end:t.dates.deliveryEndDate},c),E={order:t,dateFormat:n,timeFormat:o,type:"upcoming",bannerBusinessModel:a,retailerRegionId:i,isOnlineReceiptEnabled:l,isMultidaySlotIcon:g,isDeliveryWindowEnabled:d,isPlannedDeliveryWindowEnabled:u,getFailedOrderPaymentsForOrder:p};return s.jsx(nw,{...E})}return qes(t,r,o,n)}renderFutureOrders(){const{dateFormat:t,futureOrders:n,isTaxInclusionNoteEnabled:o}=this.props,r=()=>o&&s.jsx("div",{className:"salt-m-t--1 salt-d--block",children:s.jsx(O,{asChild:!0,children:s.jsx("h3",{children:s.jsx(b,{id:"orders.list.tax.inclusion.note"})})})});return s.jsxs(h.Fragment,{children:[s.jsxs(Q,{align:"baseline",className:"salt-m-y--4",children:[s.jsx("div",{className:"salt-m-r--4",children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"orders.list.future.title"})})}),r()]}),s.jsx(V,{flush:!0,children:n.map(a=>s.jsx(V.Item,{colSpan:{xs:12,sm:6,md:4,lg:3},children:this.renderFutureOrderCard(a,t)},this.isOrder(a)?a.orderId:a.definitionId))}),s.jsx("div",{className:"salt-m-b--8"})]})}renderPastOrders(){return this.props.isCompletedOrdersFromGraphqlEnabled?s.jsx(qts,{}):s.jsx(DJt,{})}renderRecurringShoppingDefinitions(){const{isRecurringOrdersEnabled:t,recurringShoppingDefinitions:n}=this.props;return t&&n&&n.data&&n.data.length>0?s.jsx(Gts,{recurringShoppingDefinitions:n}):null}renderRecurringOrderSignUp(){const{recurringShoppingDefinitions:t,pastOrders:n,isROSignUpEnabled:o}=this.props;return o?s.jsx(Yes,{hasRecurringShoppingDefinitions:!!t?.data.length,hasPastOrders:!!n?.orders.length}):null}renderScrollTopRow(){return s.jsx("div",{className:"salt-m-y--4",children:s.jsx(See,{focusElement:"#orders-list-page-title"})})}isOrder(t){return t.orderId!==void 0}render(){const{futureOrders:t,isOrderListPageEmpty:n}=this.props;return s.jsx(V,{"data-test":"orders-list-page",children:s.jsxs(V.Item,{colSpan:{xs:12},children:[!!this.props.recurringShoppingDefinitions?.data.length&&s.jsx("div",{className:"salt-m-y--4",children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"orders.list.recurring.orders.section.title"})})}),s.jsxs(Oe.Collection,{children:[this.renderRecurringOrderSignUp(),this.renderRecurringShoppingDefinitions()]}),!!t.length&&this.renderFutureOrders(),this.renderPastOrders(),!n&&this.renderScrollTopRow()]})})}}const oss=e=>({bannerBusinessModel:Tl(e),isRecurringOrdersEnabled:Kts(e),isTaxInclusionNoteEnabled:zts(e),isOnlineReceiptEnabled:Qts(e),retailerRegionId:sa(e),isROSignUpEnabled:Xts(e),isMultidaySlotEnabled:Zts(e),isDeliveryWindowEnabled:Jts(e),isPlannedDeliveryWindowEnabled:ess(e),isCompletedOrdersFromGraphqlEnabled:tss(e),getFailedOrderPaymentsForOrder:t=>F5(e,t)}),rss=Tt(Ht,we(oss))(nss),ass=({icon:e="orders"})=>{const t=Ge(),n=ft(),[o]=Ee(["seo.rdbl"]),r=()=>{n({type:yq.CONTINUE_SHOPPING_BUTTON_CLICKED});const a="source=navigation",i=o?bo(void 0,{queryString:a}):ao({queryString:a});t(i)};return s.jsx(V,{fixed:!0,className:"salt-m-y--16",children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:e,title:"orders.list.no.results.title",titleAs:"h2",description:"orders.list.no.results.subtext",primaryButton:{text:"orders.list.no.results.browse",onClick:r}})})})},fie=D("rec.o"),yie=D("cmpl.ords.graphql"),iss={actions:m.shape({getPendingOrders:m.func.isRequired,getPastOrders:m.func.isRequired,getRecurringOrderPlaceholders:m.func.isRequired,getRecurringShoppingDefinitions:m.func.isRequired,sendAnalyticsEvent:m.func.isRequired}).isRequired,dateFormat:m.string.isRequired,isRecurringOrdersEnabled:m.bool.isRequired,timeFormat:m.string.isRequired,pendingOrders:m.shape({isFetching:m.bool,lastUpdated:m.number,orders:m.arrayOf(lr)}),pastOrders:m.shape({isFetching:m.bool,lastUpdated:m.number,nextPageToken:m.string,orders:m.arrayOf(lr)}),recurringOrderPlaceholders:m.shape({isFetching:m.bool,lastUpdated:m.number,data:m.arrayOf(Jae)}),recurringShoppingDefinitions:iJt,isServerRendered:m.bool.isRequired},lss={pendingOrders:{orders:[],isFetching:!1},pastOrders:{orders:[],isFetching:!1,nextPageToken:null},recurringOrderPlaceholders:null,recurringShoppingDefinitions:void 0},Iie=h.createContext(),cw=({actions:e,isRecurringOrdersEnabled:t,isCompletedOrdersFromGraphqlEnabled:n,isServerRendered:o,pastOrders:r,pendingOrders:a,recurringShoppingDefinitions:i,recurringOrderPlaceholders:l,dateFormat:c,timeFormat:d})=>{const[u,p]=h.useState(-1),g=()=>{e.sendAnalyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{PENDING_ORDERS_TOTAL_COUNT:r?.orders?.length}})},E=()=>{e.sendAnalyticsEvent({type:Ds.PAGE_ATTRIBUTES_MULTIPLE,attributes:{PAST_ORDERS_TOTAL_COUNT:a?.orders?.length}})};h.useEffect(()=>{(!o||!r.lastUpdated&&!a.lastUpdated&&!r.isFetching&&!a.isFetching)&&(t&&e.getRecurringOrderPlaceholders(),e.getPendingOrders().then(()=>E()),n||e.getPastOrders().then(()=>g())),!o&&!i.isFetching&&t&&e.getRecurringShoppingDefinitions()},[]);const y=()=>t?[...a.orders,...l.data].sort(rR):a.orders.sort(rR),I=()=>r,S=()=>{const A=n?u===0:r.orders.length===0;return a.orders.length===0&&l.data.length===0&&A},C=()=>s.jsx("div",{className:"salt-m-t--16",children:s.jsx(_s,{size:"l"})}),T=()=>s.jsxs(h.Fragment,{children:[S()&&s.jsx(ass,{}),s.jsx(rss,{futureOrders:y(),recurringShoppingDefinitions:i,pastOrders:I(),dateFormat:c,timeFormat:d,isOrderListPageEmpty:S()})]}),_=()=>a&&a.isFetching;return s.jsx(Iie.Provider,{value:{completedOrdersCount:u,setCompletedOrdersCount:p},children:s.jsxs("div",{"data-synthetics":"orders-summary-view",children:[s.jsx(bt,{title:"orders.list.page.title"}),s.jsx(sn,{id:"orders-list-page-title",children:s.jsxs(Q,{justify:"start",align:"center",children:[s.jsx("div",{className:"salt-d--inline-block salt-p-r--4 sm:salt-p-r--8",children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"orders.list.page.title"})})}),s.jsx(vu,{targetName:yc.FKSN})]})}),_()?C():T()]})})},css=e=>({pendingOrders:Ac(e),pastOrders:G5(e),dateFormat:Zt(e),timeFormat:Mt(e),isServerRendered:Rt(e),isRecurringOrdersEnabled:fie(e),isCompletedOrdersFromGraphqlEnabled:yie(e),recurringShoppingDefinitions:qv(e),recurringOrderPlaceholders:V5(e)}),dss=st({getPendingOrders:Mi.getPendingOrders,getPastOrders:tw.getPastOrders,getRecurringOrderPlaceholders:Vl.fetchRecurringShoppingPlaceholders,getRecurringShoppingDefinitions:mi.getRecurringShoppingDefinitions,sendAnalyticsEvent:U.analyticsEvent});cw.propTypes=iss;cw.defaultProps=lss;const Sie=e=>s.jsx(Et,{type:"OrderListWrapper::route",children:s.jsx(cw,{...e})});Sie.fetchData=({context:{store:e}})=>{const t=e.getState(),n=Xe(t),o=[];return n?(o.push(e.dispatch(Mi.getPendingOrders())),yie(t)||o.push(e.dispatch(tw.getPastOrders())),fie(t)&&(o.push(e.dispatch(Vl.fetchRecurringShoppingPlaceholders())),o.push(e.dispatch(mi.getRecurringShoppingDefinitions()))),Promise.all(o)):Promise.resolve()};const uss=we(css,dss)(Sie),pss=D("rec.o"),mss=e=>[{path:"/orders/recurring-shopping/definitions/:definitionId/scheduled/:referenceId",Component:$s(Xe,e.Main),children:[{index:!0,Component:as(pss,Zae,ot)}]},{path:"/orders",Component:$s(Xe,e.Main),children:[{index:!0,Component:uss}]}],hss=({deliveryMethod:e,slotType:t,deliveryType:n,isCourierSlot:o,isMultidaySlot:r,isFastDeliverySlot:a})=>o?"third_party_shipping":e==="CUSTOMER_COLLECTION"&&t==="ON_DEMAND"||r?"express_collect":n==="C_N_C"?"click_collect":a?"on_demand":"home_delivery",gss=({carrierType:e,isExpressCollectionSlot:t,isFastDeliverySlot:n,deliveryTimeInMinutes:o,collectionTimeInMinutes:r,start:a,end:i,timeZoneId:l})=>{const c=L(),d=f(Zt),u=f(Mt),p=Zi();if(e)return s.jsx(Hm,{carrierType:e,dates:{deliveryStartDate:a,deliveryEndDate:i,timeZoneId:l},showAsCardTitle:!0});if(t){const g=p(o),E=p(r);return s.jsx(b,{id:"checkout.out.of.stock.slot.card.express.collection.title",values:{readyTimeSpan:g,maxTimeSpan:E}})}if(n){const g=c.formatNumber(o||0,{style:"unit",unit:"minute",unitDisplay:"short"});return s.jsx(b,{id:"slot.confirmation.fast.delivery.title",values:{duration:g}})}return s.jsx(qn,{dateIsoFrom:a,dateIsoTo:i,timeZoneId:l,dateFormat:d,timeFormat:u})},Cie=v.div`
    block-size: 100%;
    display: flex;
    flex-direction: column;
    gap: var(--salt-spacing-2);
    position: relative;
`,Ess=v(ln)`
    position: absolute;
    inset-block-start: calc(var(--salt-spacing-2) * -1);
    inset-inline-start: calc(var(--salt-spacing-2) * -1);
`,fss=v.div`
    display: flex;
    gap: var(--salt-spacing-2);
`,yss=()=>s.jsx(xe,{asChild:!0,children:s.jsxs(Cie,{children:[s.jsxs(fss,{children:[s.jsx(_e.Icon,{size:"l"}),s.jsx(_e.Typography,{variant:"textL"})]}),s.jsx(_e.Typography,{})]})}),B1=({addressId:e,externalAddress:t,nickname:n,carrierId:o,displayAddress:r,latestUpdateTime:a,limitedProducts:i,deliveryTimeInMinutes:l,collectionTimeInMinutes:c,start:d,end:u,timeZoneId:p,deliveryMethod:g,slotType:E,deliveryType:y,chipText:I,alertText:S,isBasketSlot:C,minimumOrder:T})=>{const{formatMessage:_}=L(),A=He(),R=f(Zg),{isReady:P,carrierDetails:N}=$m({carrierId:o,shippingGroupType:R}),k=Uoe({deliveryMethod:g,slotType:E,start:d,end:u});if(!P)return s.jsx(yss,{});const M=g==="CUSTOMER_COLLECTION"&&E==="ON_DEMAND",w=g==="HOME_DELIVERY"&&E==="ON_DEMAND",j=()=>s.jsx(gss,{carrierType:N?.slotBookingComponent,isExpressCollectionSlot:M,isFastDeliverySlot:w,deliveryTimeInMinutes:l,collectionTimeInMinutes:c,start:d,end:u,timeZoneId:p||""}),G=t?s.jsx(oj,{externalAddress:t}):`${n} - ${r}`,W=hss({deliveryMethod:g,deliveryType:y,slotType:E,isCourierSlot:!!N,isMultidaySlot:k,isFastDeliverySlot:w});return s.jsx(xe,{asChild:!0,"data-test":`oos-${C?"basket-":""}slot-card`,children:s.jsxs(Cie,{children:[I?s.jsx(Ess,{intent:"primary",text:I}):null,s.jsx(O,{asChild:!0,bold:!0,size:"l",children:s.jsxs("h2",{children:[W?s.jsx(pe,{name:W,verticalAlign:"top",className:"salt-m-r--2"}):null,j()]})}),s.jsx(O,{className:"salt-overflow-wrap--anywhere",children:G}),T&&s.jsx(O,{"data-test":`oos-${C?"basket":"slot"}-minimum-order`,children:_("slot.card.minimum.order.text",{amount:A(T)})}),s.jsx(iM,{latestUpdateTime:a}),i&&i.length>0&&S?s.jsx(Te,{intent:"error",size:"s",text:S}):void 0]})},e)},Iss=v(V)`
    ${re.xs`
        gap: var(--salt-spacing-4);
    `}
`,Sss=()=>{const e=L(),t=f(S2e),n=f(xn),o=f(OP),r=f(y2e),a=f(NE),i=f(D("mins")),l=t?.minimumCheckoutThresholdChanged&&i;return s.jsxs(Iss,{flush:!0,className:"salt-m-y--4",children:[n&&s.jsx(V.Item,{colSpan:{xs:12,md:6,lg:6},children:s.jsx(B1,{addressId:n.addressId,nickname:n.nickname,carrierId:n.carrierId,displayAddress:n.displayAddress,externalAddress:n.externalAddress,latestUpdateTime:n.latestUpdateTime,deliveryTimeInMinutes:n.deliveryTimeInMinutes,collectionTimeInMinutes:n.collectionTimeInMinutes,start:n.start,end:n.end,timeZoneId:n.timeZoneId,deliveryMethod:n.deliveryMethod,slotType:n.slotType,deliveryType:n.deliveryType,chipText:e.formatMessage("slotbooking.oos.current.slot.chip"),isBasketSlot:!0,minimumOrder:l?r:null})}),t&&s.jsx(V.Item,{colSpan:{xs:12,md:6,lg:6},children:s.jsx(B1,{addressId:t.address.addressId,nickname:t.address.nickname,carrierId:t.carrierId,displayAddress:t.address.address,externalAddress:t.externalAddress,latestUpdateTime:t.latestUpdateTime,limitedProducts:o,deliveryTimeInMinutes:t.deliveryTimeInMinutes,collectionTimeInMinutes:t.collectionTimeInMinutes,start:t.startTime,end:t.endTime,timeZoneId:t.timeZoneId,deliveryMethod:t.deliveryMethod,slotType:t.type,deliveryType:t.deliveryType,chipText:n?e.formatMessage("slotbooking.oos.new.slot.chip"):"",alertText:i?void 0:e.formatMessage("slotbooking.oos.items.unavailable"),minimumOrder:l?a:null})})]})},Css="slotbooking-out-of-stock-page-header",vss=()=>{const[e,t]=Ee(["mins","sl.rd"]),n=F(),o=Ge(),{formatMessage:r}=L(),a=He(),[i,l]=h.useState(!1),c=Ne(),d=f(H4),u=f(OP)||[],p=f(LE),g=f(Pv),E=f(W4),y=f(Y4),I=f(V4),S=f(Ov),C=f(x7),T=f(mo),_=f(RP),A=f(sE),R=f(_2e),P=f(Jg),N=f(gm),k=f(Mt),M=f(OT),w=f(BL),j=u.map(oe=>oe.productId),G=A?"slotbooking.oos.title.change.slot":"slotbooking.oos.title";h.useEffect(()=>{n(ds({name:Vxe})),S&&n(Pp.getDraftBasket(S))},[]);const W=()=>w?`?${Qe.stringify({"in-checkout-walk":!0})}`:"",H=()=>{const oe=["deliveryDestinationId","in-checkout-walk"],ye=new URLSearchParams(c.search),he=new URLSearchParams;for(const Fe of oe){const be=ye.get(Fe);be&&he.set(Fe,be)}const Ie=he.toString();return Ie?`?${Ie}`:""},K=()=>t?H():W(),X=()=>{const{deliveryMethod:oe}=Qe.parse(c.search);return`${oe===pt.clickAndCollect.method?Jd():bc()}${K()}`},q=async()=>{M===Sn.CHECKOUT_WALK&&n(U.analyticsEvent({type:Zn.CHECKOUT_WALK})),l(!0);try{await n(Wd.confirmSlot(o,M,Iv))}catch{l(!1)}},ne=()=>{t||n(To.persistPreviouslySelectedAddress()),n(uM.cancelSlot()).then(()=>{o(t?X():-1)})},ue=oe=>{const ye=Bh(oe);return s.jsx(b,{id:`${ye}`||"slotbooking.oos.voucher.add.error"})};return!p&&!g||R?s.jsx(En,{to:X()}):C.fetchError?s.jsx(jn,{showRefreshLink:!0}):g?s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:G}),s.jsxs(sn,{children:[s.jsx(ee,{as:"h1",id:Css,children:s.jsx(b,{id:G})}),!e&&s.jsx("div",{className:"salt-m-t--2",children:s.jsx(O,{size:"l",children:s.jsx(b,{id:"slotbooking.oos.slot.expires.by",values:{timeSlotExpires:s.jsx(Cl,{dateIso:_,timeZoneId:N,timeFormat:k}),minimumSpend:a(P)}})})})]}),s.jsxs(V,{flush:!0,fixed:!0,className:"salt-p-t--4",children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsxs("div",{className:"salt-p-b--2 md:salt-p-b--0 salt-p-x--2",children:[s.jsxs("div",{className:"salt-m-y--8",children:[I&&E&&s.jsx(Te,{className:"salt-m-b--2",text:s.jsx(b,{id:"slotbooking.oos.price.changed"}),showIcon:!1}),d?.length>0&&s.jsx("div",{className:"salt-m-b--2",children:s.jsx(Be,{children:d.map(oe=>s.jsx(Te,{className:"salt-m-b--2",showIcon:!1,text:s.jsxs(O,{children:[s.jsx(O,{bold:!0,children:`${oe.voucherId} `}),ue(oe.validationErrorCode)]})},oe.voucherId))})}),I&&E&&y&&s.jsx(Te,{intent:"warning",showIcon:!1,className:"salt-m-b--2",text:r("slotbooking.oos.final.price",{amount:a(y)})})]}),g&&s.jsx(Sss,{}),u.length>0&&s.jsxs(h.Fragment,{children:[s.jsx(O,{size:"l",asChild:!0,bold:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"slotbooking.oos.products.title"})})}),s.jsx("div",{className:"salt-m-y--4",children:s.jsx(uo,{productGroups:[{products:j,section:"out-of-stock"}],productsByProductId:T,page:"slot-booking",type:"slotbooking",isFetching:p})})]}),e&&s.jsx(Te,{className:"salt-m-y--4",intent:"warning",text:r("slotbooking.oos.slot.expires.by.time",{timeSlotExpires:s.jsx(Cl,{dateIso:_,timeZoneId:N,timeFormat:k})}),showIcon:!1})]})}),s.jsx(V.Item,{colSpan:{xs:12,md:3},children:s.jsx("div",{className:"salt-p-x--2 md:salt-p--0",children:s.jsx(x,{intent:"secondary",fill:!0,onClick:ne,children:s.jsx(x.Text,{children:s.jsx(b,{id:"slotbooking.oos.change.slot.button"})})})})}),s.jsx(V.Item,{colSpan:{xs:12,md:3},children:s.jsx("div",{className:"salt-p-x--2 md:salt-p--0",children:s.jsx(x,{intent:"primary",fill:!0,loading:i,onClick:q,"data-synthetics":"confirm-slot",children:s.jsx(x.Text,{children:M===Sn.CHECKOUT_WALK?s.jsx(b,{id:"slotbooking.oos.checkout.button"}):s.jsx(b,{id:"slotbooking.oos.continue.button"})})})})})]})]}):s.jsx("div",{className:"salt-m-t--32",children:s.jsx(_s,{size:"m"})})},Tss=()=>s.jsx(Et,{type:"OutOfStockPage::route",children:s.jsx(vss,{})}),_ss=D("oosa"),bss=e=>[{path:"/out-of-stock",Component:e.Main,key:"main",children:[{index:!0,Component:as(_ss,Tss,ot)}]}],xss=()=>s.jsx(V,{fixed:!0,className:"salt-p--2",children:s.jsx(V.Item,{colSpan:{xs:12},className:"salt-p-y--4",children:s.jsxs(Q,{align:"center",direction:"column",children:[s.jsx(pe,{success:!0,name:"status_yes",height:42,width:42}),s.jsx(ee,{as:"h1","data-test":"add-card-complete-message",className:"salt-m-y--2",children:"Card was successfully added"})]})})}),Ass=()=>{Z.error("settings.wallet.create.item.error")},Rss=e=>{const t={event:"event",eventCategory:"Payment",eventAction:"AddWalletItemError"};return te.sendEvent({GA:t,WA:null}),e({type:Ot.ADD_WALLET_ITEM,event:"ERROR"})},Dss=(e,t)=>{const n={event:"event",eventCategory:"Payment",eventAction:"AddWalletItemSuccess",walletItemId:t?.responseData?.walletItemId};return te.sendEvent({GA:n,WA:null}),e({type:Ot.ADD_WALLET_ITEM,event:"COMPLETE",walletItemId:t?.responseData?.walletItemId})},Oss=(e,t)=>e({type:Ot.ADD_WALLET_ITEM_REQUEST,event:Ot.ADD_WALLET_ITEM_REQUEST,resultToken:t}),Pss=({analyticsEvent:e})=>()=>{Rss(e),Ass()},Nss=({data:e,iframeRef:t})=>{try{const n=t.current?.contentWindow;if(n)n.postMessage(e,"*");else throw new Error}catch{throw new Error("Wrong iframeRef object shape")}},Lss=({iframeRef:e,tokenErrorHandler:t,resultTokenHandler:n,analyticsEvent:o,isSkipXssCheckEnabled:r})=>({data:a,origin:i})=>{if(!r&&!zP(i)){o({type:Ot.UNAUTHORIZED_POST_MESSAGE_ATTEMPT,origin:i});return}Nss({data:a,iframeRef:e});const{type:l,resultToken:c}=a;switch(l){case"TOKENIZATION_ERROR":t();break;case"TOKENIZATION_RESULT_TOKEN":if(c===void 0)throw new Error("resultToken is undefined");n(c);break}};function kss({analyticsEvent:e,createWalletItem:t,iframeRef:n,isCardRecoveredEventEnabled:o,isSkipXssCheckEnabled:r},{createErrorMessageHandler:a=Pss,createMessageHandler:i=Lss,completeAnalyticsEvent:l=Dss,addWalletItemRequestAnalyticsEvent:c=Oss}={}){const[d,u]=h.useState(null),[p,g]=h.useState(!1);return h.useEffect(()=>{const E=a({analyticsEvent:e}),y=()=>{window.removeEventListener("message",I),E()},I=i({iframeRef:n,isSkipXssCheckEnabled:r,analyticsEvent:e,tokenErrorHandler:()=>{y(),g(!0)},resultTokenHandler:S=>(window.removeEventListener("message",I),o&&c(e,S),t(S).then(({payload:C})=>{l(e,C),u(S)}).catch(y).finally(()=>g(!0)))});return window.addEventListener("message",I),()=>{window.removeEventListener("message",I)}},[]),{resultToken:d,hasTokenActivity:p}}const jss=(e,t)=>{const n=e.pspweb?.url;return!n||!t?"":`${n}?${ps.stringify({recoveryToken:t})}`},Mss=e=>{const t=Ne(),{originLocation:n,recoveryToken:o}=ps.parse(t.search),r=Array.isArray(n)?n[0]||"":n||"",a=Array.isArray(o)?o[0]||"":o,i=jss(e,a);return{redirectUrl:r,pspWebRecoveryUrl:i}},wss=3e3;function Fss(e,t=wss){const[n,o]=h.useState(!1),r=h.useRef(null);return h.useEffect(()=>(e&&(r.current=setTimeout(()=>{o(!0)},t)),()=>{clearTimeout(r.current)}),[e]),{hasToRedirect:n}}const Bss=D("pay.cre"),Uss=()=>{const e=h.useRef(null),t=F(),n=f(JQ),o=f(Bss),r=f(D("pay.skpxss"));h.useEffect(()=>{t(Lj())},[]);const{redirectUrl:a,pspWebRecoveryUrl:i}=Mss(n),{resultToken:l,hasTokenActivity:c}=kss({createWalletItem:p=>t(_f.createWalletItem(p)),analyticsEvent:p=>t(U.analyticsEvent(p)),iframeRef:e,isCardRecoveredEventEnabled:o,isSkipXssCheckEnabled:r}),{hasToRedirect:d}=Fss(c),u=!c||!i;return d&&a?(window.location.replace(a),null):l?s.jsx(xss,{}):s.jsxs(ae.Fragment,{children:[u&&s.jsx(_s.WithContainer,{}),s.jsx("iframe",{sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox",src:i,title:"pspweb-add-card-recovered","data-synthetics":"psp-iframe","data-test":"psp-iframe",height:"100%",width:"100%",ref:e})]})},vie=({orderId:e})=>{const t=F(),n=Ge();return{completeFailedPaymentAuthentication:({resultToken:a})=>t(tit(a,e,n)),handleAuthenticationError:({errorParam:a})=>n(Dc({orderId:e,queryString:a}))}},Gss=()=>{const e=Ne(),{orderId:t}=nn();if(!t)throw new Error("Failed to retrieve orderId from URL parameters");const{handleAuthenticationError:n,completeFailedPaymentAuthentication:o}=vie({orderId:t}),r=a=>o(a);return c_(),s.jsx(i_,{messageCallback:r,errorCallback:n,location:e})},Tie=e=>s.jsx(Et,{type:"FailedPayment3ds::route",children:s.jsx(Gss,{...e})});Tie.fetchData=({context:{store:e},params:t})=>e.dispatch(jo.getOrderWithRecurringNotification(t.orderId));const $ss=D("ag"),Hss=D("cdm"),Vss=({actions:e,dateFormat:t,intl:n,timeFormat:o,canChangeDelivery:r=!0,delivery:a=null,showDeliveryPass:i=!1,ageConfirmed:l=!1,isAgeConfirmationError:c=!1,onClickAgeConfirmation:d=()=>{},isAgeConfirmationEnabled:u=!1,isConciergeDeliveryMethodEnabled:p=!1,conciergeDelivery:g=!1,onChangeDeliveryButtonClick:E,deliveryCardImpression:y})=>{const I=ci(),{isCollection:S,standardTitle:C,expressCollectionTitle:T,expressCollectionDescription:_,shouldShowStandardDateForExpressCollection:A}=Dte(a),R=Ge(),P=f(Oo),[N]=Ee(["nfchk"]);if(h.useEffect(()=>{a?.addressId&&y&&y(a?.addressId,a?.deliveryDestinationId)},[a?.addressId,a?.deliveryDestinationId,y]),!a)return s.jsx(js.Skeleton,{});const k={ageConfirmationError:n.formatMessage("checkout.summary.age.confirmation.error"),conciergeTermsAndConditionsLink:n.formatMessage("checkout.summary.concierge.termsandconditions.link.url")},M=S?"checkout.summary.collection.change.button":"checkout.summary.delivery.change.button",w=!!a.addressNotes;let j=null;a.ageRestriction||i&&a.hasDeliveryPass?j="2":r&&(j="4");const G=async()=>{E&&E();const K=await ko.fetchAnalyticsMetadataByActiveCart(P);e.sendAnalyticsEvent({type:Le.BEGIN_CHECKOUT,meta:K}),I(K),R(Tr({inCheckoutWalk:!0}))},W=s.jsx(O,{"data-test":"delivery-date",size:"l",bold:!0,children:s.jsx(qn,{dateIsoFrom:a.deliveryStartDate,dateIsoTo:a.deliveryEndDate,dateFormat:t,timeZoneId:a.timeZoneId,timeFormat:o})}),H=C?s.jsxs(ae.Fragment,{children:[s.jsx(ee,{as:"h2",className:"salt-m-b--2",children:C}),W]}):s.jsx(ee,{as:"h2",className:"salt-p-b--2",children:T});return s.jsxs(xe,{children:[H,s.jsxs("div",{className:`salt-m-b--${j}`,children:[_&&s.jsx(O,{bold:!0,className:"salt-d--block",children:_}),A&&s.jsx(O,{bold:!0,className:"salt-d--block",children:W}),s.jsxs(O,{"data-pii":"true","data-test":"delivery-address-body",className:"salt-d--block",children:[a.addressNickName&&`${a.addressNickName} - `,a.address&&a.address]}),a.additionalInformation&&S&&s.jsx("div",{className:"salt-m-t--2",children:s.jsx(Ote,{message:a.additionalInformation})}),a.additionalInformation&&!S&&s.jsx(O,{"data-test":"delivery-address-additional-information","data-pii":"true",className:"salt-d--block",children:a.additionalInformation}),w&&s.jsxs("div",{className:"salt-m-t--2",children:[s.jsx(O,{size:"l",bold:!0,className:"salt-d--block",children:s.jsx(b,{id:"settings.address.book.add.modal.notes.label"})}),s.jsx(O,{"data-test":"delivery-address-notes",children:a.addressNotes})]})]}),i&&a.hasDeliveryPass?s.jsx(Te,{intent:"success",showIcon:!1,text:s.jsx(b,{id:"checkout.complete.delivery.pass"}),link:s.jsx(Te.Link,{to:LP(),children:s.jsx(b,{id:"checkout.complete.manage.delivery.pass"})})}):null,a.ageRestriction&&!u&&s.jsx(Te,{className:r?"salt-m-b--2":"",intent:"warning","data-test":"summary-age-restriction-warning",text:s.jsx(b,{id:"checkout.summary.age.restriction.warning",values:{age:a.ageRestriction}}),showIcon:!1}),p&&r&&!S&&s.jsx(Ej,{}),p&&!r&&g&&s.jsx(Te,{className:"salt-m-t--4","data-test":"concierge-info",intent:"info",text:s.jsx(b,{id:"checkout.complete.concierge.info"})}),r?s.jsx(x,{intent:"secondary",fill:!0,onClick:G,"data-test":"change-delivery-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:M})})}):null,a.ageRestriction&&u&&s.jsxs("div",{className:"salt-m-t--2",children:[s.jsx(Te,{intent:"warning",showIcon:!1,text:s.jsx(b,{id:"checkout.summary.age.confirmation.warning"})}),N?s.jsx(fs.Checkbox,{name:"summary-age-confirmation-checkbox",value:"summary-age-confirmation-checkbox",checked:l,onChange:d,error:c?k.ageConfirmationError:"",required:!0,label:s.jsx(b,{id:"checkout.summary.age.confirmation.label",values:{age:a.ageRestriction}}),"data-test":"summary-age-confirmation-checkbox",className:"salt-m-t--4"}):s.jsx(Lo,{last:!0,input:{checked:l,onChange:d},bold:!1,meta:{error:c?k.ageConfirmationError:"",invalid:c,touched:c},label:s.jsx(b,{id:"checkout.summary.age.confirmation.label",values:{age:a.ageRestriction}}),"data-test":"summary-age-confirmation-checkbox",className:"salt-m-t--4"})]})]})},Wss=e=>({dateFormat:Zt(e),timeFormat:Mt(e),isAgeConfirmationEnabled:$ss(e),isConciergeDeliveryMethodEnabled:Hss(e),conciergeDelivery:kE(e)}),Yss=st({onClickConciergeDelivery:Zr.setConciergeDelivery,sendAnalyticsEvent:U.analyticsEvent}),_ie=Tt(Ht,we(Wss,Yss))(Vss),qss=({paymentTitle:e,onSelectPaymentMethod:t,fundingInstrumentId:n,updatePayerForRecurringOrder:o,showRecurringOrderCheckbox:r,payerForRecurringOrder:a,paymentSectionRef:i,showSavePaymentDetailsCheckbox:l,isYourWalletEnabled:c})=>s.jsx(V.Item,{colSpan:{xs:12,md:4},children:s.jsxs(xe,{className:"salt-m-b--4",children:[s.jsx(ee,{as:"h2",ref:i,className:"salt-m-b--2",children:e}),c&&s.jsx(bf,{isFailedPayment:!0,showRecurringOrderCheckbox:r,updatePayerForRecurringOrder:o,payerForRecurringOrder:a,"data-test":"payment-method-wallet",onSelectPaymentMethod:t,failedPaymentFundingInstrumentId:n,enablePayByCardOptionWhenNoMetadataAvailable:!0}),l&&s.jsx(Tj,{})]})}),Kss=({buttonActions:e})=>s.jsx(x,{intent:"action",fill:!0,onClick:e[0],"data-test":"update-payment-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"payment.failed.update.payment.button"})})}),zss=({cardWidth:e,basketSummary:t,confirmPayment:n})=>{const o=!t;return s.jsx(V.Item,{colSpan:{xs:12,md:e},children:s.jsx("div",{className:"salt-m-b--4",children:s.jsx(cs,{children:o&&s.jsx(js.Skeleton,{})||s.jsxs(h.Fragment,{children:[s.jsx(Q,{align:"left",children:s.jsx(le.TotalInline,{loading:o,totalPrice:t.finalPrice})}),s.jsx(le.Buttons,{children:s.jsx("div",{className:"salt-p-t--4",children:s.jsx(Kss,{buttonActions:[n]})})})]})})})})},Qss=404,Xss=({statusCode:e})=>e===Qss?s.jsx(ot,{}):s.jsx(jn,{showRefreshLink:!0}),Zss=({actions:e,paymentSession:t,orderId:n})=>{const[o,r]=h.useState(void 0),{completeFailedPaymentAuthentication:a}=vie({orderId:n});h.useEffect(()=>{const d=({eventType:u,payload:p})=>{switch(u){case In.PAYMENT_REQUESTED:r(void 0),e.openPaymentAuthenticationModal();break;case In.PAYMENT_CANCELLED:e.closeModal();break;case In.INITIATE_AUTHENTICATION:r(p.authenticationUrl);break}};return t.subscribe(d),()=>{e.closeModal(),t.unsubscribe(d)}},[t]);const i=d=>a({resultToken:d}),l=()=>e.closeModal(),c=o&&{state:{pspweb:{url:o}}};return s.jsx(l_,{handleError:l,handleSuccess:i,url:o,location:c||{}})},Jss=st({closeModal:J.closeModal,openPaymentAuthenticationModal:()=>J.openModal("paymentPsp")}),ens=we(null,Jss)(Zss),tns=D("pay.ew"),sns=D("pay.ywlt"),nns=D("rocpm"),ons=D("rocpm.fpf"),rns=D("pay.pam"),ans=()=>{const e=F(),t=L(),{orderId:n}=nn(),{pathname:o}=Ne(),r=Ge(),a=f(Nc),i=f(OE),l=f(Rt),c=f(As),d=f(UE),u=f(tns),p=f(sns),g=f(nns),E=f(ons),y=f(rns),[I,S]=h.useState(void 0),C=!u&&g&&E&&!!c.order?.recurringShoppingDefinition,T=Ij();Vte();const[_,A]=h.useState(void 0),[R,P]=h.useState(!1),N=h.useRef(null),k=new Nj,M=!!c.order?.recurringShoppingDefinition,w=f(ME),{paymentOption:j,paymentType:G}=f(Im),W=f(be=>be.session.isSuperuser);h.useEffect(()=>{M&&(A(C?!1:void 0),e(Gt.setToSavePaymentMethod(!0)))},[M]),h.useEffect(()=>(k.subscribeToEvent(In.PAYMENT_REQUESTED,oe),k.subscribeToEvent(In.INITIATE_AUTHENTICATION,Ie),()=>{k.unsubscribeToEvent(In.PAYMENT_REQUESTED,oe),k.unsubscribeToEvent(In.INITIATE_AUTHENTICATION,Ie)}),[k]),h.useEffect(()=>{!l&&!c.isFetching&&n&&e(jo.getOrderWithRecurringNotification(n)).catch(be=>{Ue.api.pushError(new Error(`getOrder() call in FailedPaymentSummary component. ${be.message}`))}),H(),Fe()},[]),c_();const H=()=>{R||(P(!0),e(U.analyticsEvent({type:Ot.FAILED_PAYMENT,orderId:n})))},K=({walletItemId:be})=>{S(be),e(U.analyticsEvent({type:Ot.SELECT_WALLET_ITEM,description:"User selected payment method",pageEventAttributes:{page:o,walletItemId:be||"NOT_SAVED"}}));const ce={event:"event",eventCategory:"Payment",eventAction:"SelectWalletItem",eventLabel:o,walletItemId:be||"NOT_SAVED"};te.sendEvent({GA:ce,WA:null}),X(!1)},X=(be=!1)=>e(Gt.setUnselectedPaymentWarning(be)),q=()=>{const be=a?.paymentInfo?.fundingInstrumentId;return be&&d.items.some(({fundingInstrumentId:ce,expired:me})=>ce!==be&&!me)},ne=()=>{const be=!!I;return u||q()&&be},ue=()=>{!q()&&!W?e(_f.startAddWalletItem()):X(!0)},oe=()=>{ne()?ye():ue()},ye=()=>{e(eit({orderId:n,paymentSession:k,payerForRecurringOrder:_,paymentMethod:he(),navigate:r}))},he=()=>({group:j,type:G||"UNKNOWN",toSave:w,walletItemId:I}),Ie=be=>{const{authenticationUrl:ce}=be.payload;y||r($Y(n),{state:{psp:null,datacash:null,braintree:null,pspweb:ce&&{url:ce}}})},Fe=()=>{N.current?.scrollIntoView({block:"center",behavior:"smooth"})};if(h.useEffect(()=>{p||e(Gt.setPaymentOptionAndType({paymentOption:dt.PAY_NOW,paymentType:at.UNKNOWN}))},[e,p]),c.error)return s.jsx(Xss,{statusCode:c.error.statusCode});if(a?.paymentInfo?.isFundingInstrumentUpdatable===!1)return s.jsx(En,{to:"/?notification=failed-payment-not-updatable"});if(a?.paymentInfo?.isFundingInstrumentUpdatable){const be=p?4:6,ce=T&&!M,me=p||ce;return s.jsxs(h.Fragment,{children:[s.jsxs(sn,{children:[s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"payment.failed.heading"})}),s.jsxs(O,{"data-test":"order-reference",children:[s.jsx(b,{id:"payment.failed.order.reference"}),": ",n]})]}),s.jsx("div",{className:"salt-m-x--2 salt-m-b--2",children:s.jsxs(V,{fixed:!0,flush:!0,"data-test":"summary-grid",children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Te,{"data-test":"payment-method-warning",className:"salt-m-b--2 md:salt-m-b--0",text:s.jsx(b,{id:"payment.failed.declined.intro"}),showIcon:!1})}),s.jsx(V.Item,{colSpan:{xs:12,md:be},children:s.jsx("div",{className:"salt-m-b--2 md:salt-m-b--4",children:s.jsx(_ie,{delivery:i,canChangeDelivery:!1})})}),me&&s.jsx(qss,{paymentTitle:t.formatMessage("checkout.summary.payment.method.title"),fundingInstrumentId:a?.paymentInfo?.fundingInstrumentId,onSelectPaymentMethod:K,updatePayerForRecurringOrder:A,showRecurringOrderCheckbox:C,payerForRecurringOrder:!!_,paymentSectionRef:N,showSavePaymentDetailsCheckbox:ce,isYourWalletEnabled:p}),s.jsx(zss,{cardWidth:be,confirmPayment:()=>k.requestPayment(),basketSummary:a})]})}),s.jsx(t_,{}),y&&n&&s.jsx(ens,{orderId:n,paymentSession:k})]})}return null},bie=e=>s.jsx(Et,{type:"FailedPaymentSummary::route",children:s.jsx(ans,{...e})});bie.fetchData=({context:{store:e},params:t})=>e.dispatch(jo.getOrderWithRecurringNotification(t.orderId));const ins=({buttonAction:e})=>s.jsx(x,{intent:"action",fill:!0,onClick:e,"data-test":"back-to-shop-button",children:s.jsx(b,{id:"payment.failed.back.to.shop.button"})}),lns=({paymentSummary:e,buttonAction:t})=>e?s.jsxs(h.Fragment,{children:[s.jsx(Q,{align:"left",children:s.jsx(le.TotalInline,{loading:!e,totalPrice:e.finalPrice})}),s.jsx(le.Buttons,{children:s.jsx("div",{className:"salt-p-t--4",children:s.jsx(ins,{buttonAction:t})})})]}):s.jsx(js.Skeleton,{}),cns=({recurringOrderPaymentUpdateResult:e})=>{if(!e)return null;const{paymentMethodUpdated:t}=e;return t?s.jsx(Te,{intent:"success",text:s.jsx(b,{id:"payment.failed.payment.method.updated"}),className:"salt-m--4",showIcon:!1}):s.jsx(Te,{intent:"warning",text:s.jsx(b,{id:"payment.failed.payment.method.not.updated"}),className:"salt-m--4",showIcon:!1})},dns=()=>{const e=F(),t=Ge(),{orderId:n}=nn(),o=f(As),r=f(Nc),a=f(Rt),i=f(OE),[{recurringOrderPaymentUpdateResult:l},c]=h.useState({}),d=()=>t(fn());return h.useEffect(()=>{!a&&!o.isFetching&&n&&e(jo.getOrderWithRecurringNotification(n));const u=sessionStorage.getItem("paymentUpdate");c(u&&JSON.parse(u)||{})},[]),c_(),s.jsxs(h.Fragment,{children:[s.jsxs(sn,{children:[s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"payment.failed.thanks"})}),s.jsxs(O,{"data-test":"order-reference",children:[s.jsx(b,{id:"payment.failed.order.reference"}),": ",n]})]}),s.jsx(cns,{recurringOrderPaymentUpdateResult:l}),s.jsx("div",{className:"salt-m-b--2 salt-m-x--2",children:s.jsxs(V,{fixed:!0,flush:!0,"data-test":"complete-grid",children:[s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx("div",{className:"salt-m-b--4",children:s.jsx(_ie,{delivery:i,canChangeDelivery:!1})})}),s.jsx(V.Item,{colSpan:{xs:12,md:6},children:s.jsx("div",{className:"salt-m-b--2",children:s.jsx(cs,{children:s.jsx(lns,{buttonAction:d,paymentSummary:r})})})})]})})]})},xie=e=>s.jsx(Et,{type:"FailedPaymentComplete::route",children:s.jsx(dns,{...e})});xie.fetchData=({context:{store:e},params:t})=>e.dispatch(jo.getOrderWithRecurringNotification(t.orderId));const uns=e=>[{path:"/failed-payment/:orderId",Component:$s(Xe,e.Main),children:[{index:!0,Component:bie},{path:"3ds",Component:Tie},{path:"complete",Component:xie}]},{path:"/complete-tokenization/continue",Component:$s(Xe,e.Main),children:[{index:!0,Component:Uss}]}],pns=(e,t)=>n=>n(rc.fetchNewRefundRequestView(e,t)).then(()=>{n(oc.clearSelectedItems())}),mns=({orderId:e})=>s.jsx(rm,{className:"salt-m-y--4 salt-m-x--2",trail:[{id:"order.details.page.title",url:cn(e),name:s.jsx(b,{id:"order.details.page.title",values:{orderId:e}})},{id:"refunds.refund-request-header.title",name:s.jsx(b,{id:"refunds.refund-request-header.title"})}],linkElement:Ye}),hns=Y(e=>e.data.orders.current,e=>e.refunds),P_=Y(hns,e=>e.newRefundRequest),dw=Y(P_,e=>e.availableItems),uw=Y(dw,e=>e&&e.reduce((t,n)=>(t[n.itemId]=n)&&t,{})||{}),Aie=Y(P_,e=>e.refundReasonsPerCategory),gns=Y(P_,e=>e.regionId),Ens=e=>e!=null,fns=Y(e=>e.data.orders.current,e=>e.refunds),yns=Y(As,e=>e.order&&e.order.orderTotals&&e.order.orderTotals.totalPrice&&e.order.orderTotals.totalPrice.currency),Bf=Y(fns,e=>e.summary),N_=Y(Bf,e=>e.selectedItems&&!e.isFetching?e.selectedItems:[]),Ins=Y(N_,uw,ts,(e,t,n)=>{if(!e)return[];const o=e.map(r=>{const a=t[r.itemId];return a?{productName:n[a.productId].name,prices:r.selectedRefundables.map(l=>({refundableAmount:l.refundableAmount,price:l.price}))}:null}).filter(Ens).map(r=>r.prices.map(a=>({productName:r.productName,refundableAmount:a.refundableAmount,price:a.price})));return[].concat.apply([],o)}),Sns=Y(Bf,e=>({gross:e.refundValueBreakdown.gross,net:e.refundValueBreakdown.net})),Rie=Y(Bf,e=>e.refundValueBreakdown.displayAmount),U1="failed-refund-request-created-modal-id",Cns=({orderId:e})=>{const t=L(),n=Ge(),o=Pm("refundRequestPlacedError"),r=Om(),a=uX(),i=()=>{n(cn(e)),a()};return s.jsxs(B,{isOpen:o,onRequestClose:i,aria:{labelledby:U1},children:[s.jsx(B.Header,{align:r?"left":"center",children:s.jsx(ee,{as:"h2",id:U1,children:s.jsx(x.Text,{children:t.formatMessage("order.details.refund-request-card.button")})})}),s.jsx(B.Body,{children:t.formatMessage("order.details.refund-request-card.refund-request-unavailable")}),s.jsx(B.Footer,{align:r?"left":"center",children:s.jsx(x,{fill:!0,intent:"primary",onClick:i,"data-test":"refund-request-create-failed-ok-button",children:s.jsx(x.Text,{children:t.formatMessage("order.details.refund-request-creation-failed.modal.close")})})},"footer")]})},Die=Y(e=>e.data.orders.current,e=>e.order.order),vns=(e,t)=>{const{categoryId:n,reasonId:o}=t,r=e.find(i=>i.categoryId===n),a=r?.categoryDescription||"";if(n!==o){const l=r?.reasons?.find(c=>c.reasonId===o)?.reasonDescription||"";return l?`${a?`${a}: `:""}${l}`:a}return a},Tns=Y(N_,uw,ts,Aie,Rie,(e,t,n,o,r)=>({requestedItems:e.map(a=>{const{productId:i}=t[a.itemId],l=t[a.itemId].selectedRefundReason;return{productId:i,requestedQuantity:a.selectedRefundables.length,requestedRefundableIds:a.selectedRefundables.map(c=>c.refundableId),refundReason:l,refundReasonDescription:vns(o,l),productName:n[i]?.name,sellerId:n[i]?.seller?.id,retailerProductId:n[i]?.retailerProductId}}),refundTotal:r})),Oie=()=>{const e=f(Die);return s.jsx(h.Fragment,{children:e&&s.jsx("div",{className:"salt-m-x--2 salt-m-b--4",children:s.jsxs(xe,{"data-test":"order-reference",children:[s.jsx(b,{id:"order.details.subheading.orderId"}),": ",e]})})})},_ns=()=>{const e=L();return{headerTitle:{ariaLabel:e.formatMessage("refunds.item-selection-modal.header"),label:e.formatMessage("refunds.item-selection-modal.header")},quantitySelect:{ariaLabel:e.formatMessage("refunds.item-selection-modal.quantity.accessibility"),label:e.formatMessage("refunds.item-selection-modal.quantity"),placeholder:e.formatMessage("refunds.item-selection-modal.select-quantity.placeholder")},continueButton:{ariaLabel:e.formatMessage("refunds.item-selection-modal.continue.accessibility"),label:e.formatMessage("refunds.item-selection-modal.continue")},cancelRequestButton:{ariaLabel:e.formatMessage("refunds.item-selection-modal.cancel-request.accessibility"),label:e.formatMessage("refunds.item-selection-modal.cancel-request")}}},bns=e=>{const{categoryDescription:t}=e;return e.reasons.length===1&&e.reasons[0].reasonDescription===t},xns=(e,t)=>e.find(n=>n.categoryId===t),G1=(e,t,n)=>{if(t){const o=xns(e,t);return!!o&&!bns(o)}else return!1};function Ans(e){return e.length!==1}const Rns=e=>!e||Ans(e)?null:e[0];function $1(e,t){const n=e.map(r=>r.reasonId),o=Rns(n);return o!=null?{categoryId:t,reasonId:o}:{categoryId:t,reasonId:t==="OTHER"?"OTHER":null}}const fh=(e,t)=>{const n=t.find(o=>o.categoryId===e);return n?n.reasons:[]},Dns=({reasonId:e,reasonDescription:t})=>s.jsx("option",{"data-test":"select-reason-option",value:e,children:t},`refund-reason-${e}`),Ons=(e,t)=>fh(e,t).map(n=>Dns(n)),Pns=({formattedMessages:e,reasonNote:t,maxLength:n,onReasonNoteChange:o})=>s.jsx("div",{"data-test":"optional-comment-wrapper",children:s.jsx(Wo,{id:"optional-comment",label:e.optionalComment.label,"data-test":"optional-comment-input",name:"optional-comment",maxLength:n,"aria-label":e.optionalComment.ariaLabel,placeholder:e.optionalComment.placeholder,input:{onChange:r=>o(r.target.value)},value:t,meta:{invalid:!1,touched:!1}})}),Nns=(e,t)=>e.substring(0,t),Sx=200,H1=({onChange:e,error:t,...n})=>{const[o,r]=h.useState(!1);return s.jsx(Dr,{error:o?t:void 0,onInvalid:a=>{a.preventDefault(),r(!0)},onChange:a=>{r(!1),e?.(a)},...n})},V1=({onOptionChange:e,error:t,...n})=>{const[o,r]=h.useState(!1);return s.jsx(fs.DropdownSelect,{error:o?t:void 0,onInvalid:a=>{a.preventDefault(),r(!0)},onOptionChange:a=>{r(!1),e?.(a)},...n})},Lns=({reason:e,setReason:t})=>{const n=L(),[o]=Ee(["nfrfs"]),[r,a]=h.useState(""),i=f(Up),l=f(Aie),c={selectReasonCategory:{ariaLabel:n.formatMessage("refunds.item-selection-modal.reason.category.accessibility"),placeholder:n.formatMessage("refunds.item-selection-modal.category-placeholder"),label:n.formatMessage("refunds.item-selection-modal.reason")},selectReasonDetails:{ariaLabel:n.formatMessage("refunds.item-selection-modal.reason.details.accessibility"),placeholder:n.formatMessage("refunds.item-selection-modal.reason-placeholder"),label:n.formatMessage("refunds.item-selection-modal.reason-label")},optionalComment:{ariaLabel:n.formatMessage("refunds.item-selection-modal.optional-comment.accessibility"),label:n.formatMessage("refunds.item-selection-modal.optional-comment.label"),placeholder:n.formatMessage("refunds.item-selection-modal.optional-comment.placeholder"),clearButton:n.formatMessage("salt.form.text-field.clear-button.a11y.label")}},d=k=>s.jsx("option",{"data-test":"select-category-option",value:k.categoryId,children:k.categoryDescription},`refund-reason-category-${k.categoryId}`),u=k=>k.map(M=>d(M)),p=k=>{const M=k.target.value,w=$1(fh(M,l),M);t({...e,...w})},g=k=>{const M=$1(fh(k,l),k);t({...e,...M})},E=k=>{t({...e,reasonId:k.target.value})},y=k=>{t({...e,reasonId:k})},I=k=>{a(""),t({...e,reasonNote:Nns(k,Sx)??""})},S=k=>{k.preventDefault();const M=k.target;M instanceof HTMLInputElement&&M.validity.patternMismatch&&a(n.formatMessage("validation.form.restricted.chars"))},{categoryId:C,reasonId:T,reasonNote:_}=e,A=fh(e?.categoryId??"",l).map(k=>({name:k.reasonDescription,value:k.reasonId})),R=l.map(k=>({name:k.categoryDescription,value:k?.categoryId})),P={value:C??"",name:R?.find(k=>k.value===C)?.name??""},N={value:T??"",name:fh(C??"",l).find(k=>k.reasonId===T)?.reasonDescription??""};return s.jsxs(h.Fragment,{children:[o?s.jsx(V1,{required:!0,className:"salt-m-b--4",id:"refund-reason-category-selector",options:R,name:"refund-reason-category-selector",value:P,"data-test":"refund-reason-category-selector","aria-label":c.selectReasonCategory.ariaLabel,label:{text:c.selectReasonCategory.label},placeholder:c.selectReasonCategory.placeholder,onOptionChange:({value:k})=>g(k),error:n.formatMessage("order.details.refund.request-items.details-modal.reason.error")}):s.jsx(H1,{required:!0,className:"salt-m-b--4",value:C||"",onChange:p,id:"refund-reason-category-selector",name:"refund-reason-category-selector","data-test":"refund-reason-category-selector",label:c.selectReasonCategory.label,"aria-label":c.selectReasonCategory.ariaLabel,placeholder:c.selectReasonCategory.placeholder,error:n.formatMessage("order.details.refund.request-items.details-modal.reason.error"),children:l&&u(l)}),!o&&G1(l,C)&&s.jsx(H1,{required:!0,disabled:!C,value:T||"",id:"refund-reason-selector",onChange:E,"data-test":"refund-reason-selector",label:c.selectReasonDetails.label,"aria-label":c.selectReasonDetails.ariaLabel,placeholder:c.selectReasonDetails.placeholder,error:n.formatMessage("order.details.refund.request-items.details-modal.sub-reason.error"),children:C&&Ons(C,l)}),o&&G1(l,C)&&s.jsx(V1,{required:!0,disabled:!C,className:"salt-m-b--4",id:"refund-reason-selector",name:"refund-reason-selector",options:A,value:N,"data-test":"refund-reason-selector",label:{text:c.selectReasonDetails.label},placeholder:c.selectReasonDetails.placeholder,onOptionChange:({value:k})=>y(k),error:n.formatMessage("order.details.refund.request-items.details-modal.sub-reason.error")}),o?s.jsx(fs.TextField,{value:_,id:"optional-comment",name:"optional-comment","data-test":"optional-comment-input",maxLength:Sx,label:{text:c.optionalComment.label},onClear:()=>I(""),placeholder:c.optionalComment.placeholder,clearButton:{ariaLabel:c.optionalComment.clearButton},onChange:k=>I(k.target.value),onInvalid:S,errorMessage:r,pattern:i}):s.jsx(Pns,{reasonNote:_,maxLength:Sx,formattedMessages:c,onReasonNoteChange:I})]})},kns=(e,t,n,o,r)=>(a,i)=>{const l=i(),c=F4(l),d=dw(l),u=N_(l)||[],p=Object.fromEntries(u.map(E=>[E.itemId,E])),g=d.map(E=>({itemId:E.itemId,productId:E.productId,selectedQuantity:E.itemId===e?t:p[E.itemId]?.selectedRefundables.length||0,availableRefundables:E.availableRefundables})).filter(E=>E.selectedQuantity>0);g&&g.length&&a(oc.calculateSelectedItems({selectedItems:g,regionId:o,deliveryDateTime:c},r)).then(()=>{a(rc.updateItem(e,t,n)),a(J.closeModal())})},jns=(e,t,n)=>(o,r)=>{const a=r(),i=F4(a),l=dw(a),c=N_(a)||[],d=Object.fromEntries(c.map(p=>[p.itemId,p])),u=l.map(p=>({itemId:p.itemId,productId:p.productId,selectedQuantity:p.itemId===e?0:d[p.itemId]?.selectedRefundables.length||0,availableRefundables:p.availableRefundables})).filter(p=>p.selectedQuantity>0);u&&u.length?o(oc.calculateSelectedItems({selectedItems:u,regionId:t,deliveryDateTime:i},n)).then(()=>{o(rc.updateItem(e,0,void 0)),o(J.closeModal())}):u&&(o(oc.clearSelectedItems()),o(rc.updateItem(e,0,void 0)),o(J.closeModal()))},W1={addItemToRequest:kns,removeItemFromRequest:jns},Mns=D("m.la.h"),wns={isOpen:m.bool,actions:m.shape({analyticsEvent:m.func.isRequired,closeModal:m.func.isRequired,addItemToRequest:m.func.isRequired,removeItemFromRequest:m.func.isRequired}).isRequired,modalOptions:m.shape({itemId:m.string}),productsByProductId:m.objectOf(sl).isRequired,availableItemsByItemId:m.shape({itemId:m.string}).isRequired,orderId:m.string.isRequired,modalLeftAlignEnabled:m.bool,regionId:m.string.isRequired,locale:m.string.isRequired},Fns={modalOptions:{itemId:null},isOpen:!1,modalLeftAlignEnabled:!1},Uf=e=>{const{isOpen:t,actions:n,modalOptions:{itemId:o},productsByProductId:r,availableItemsByItemId:a,orderId:i,modalLeftAlignEnabled:l,regionId:c,locale:d}=e,[u]=Ee(["nfrfs"]),p=o&&a[o],g=p&&r[p.productId],[E,y]=h.useState(1),[I,S]=h.useState({reasonNote:""}),[C,T]=h.useState(!1),_=_ns(),A=os({breakpoint:"sm-up"});h.useEffect(()=>{p&&!C&&(y(p.selectedQuantity||1),S(p.selectedRefundReason||{reasonNote:""}),T(!0)),t||T(!1)});const R=H=>({...H,reasonNote:H.reasonNote&&H.reasonNote.trim()}),P=H=>{n.analyticsEvent({type:vi.REFUND_REQUEST_ITEM_SELECTED,orderId:i,productId:p.productId,quantity:E,refundReasonCategory:H.categoryId,refundReason:H.reasonId,comment:H.reasonNote})},N=()=>{n.analyticsEvent({type:vi.REFUND_REQUEST_ITEM_CANCELLED,orderId:i,productId:p.productId})},k=()=>{const H=R(I);P(H),n.addItemToRequest(o,E,H,c,d)},M=()=>{N(),n.removeItemFromRequest(o,c,d)},w=()=>l?"left":"center",j=H=>{H.preventDefault(),k()},G=({value:H})=>{y(parseInt(H,10))},W=Array(p?.availableQuantity).fill().map((H,K)=>({name:String(K+1),value:String(K+1)}));return g?s.jsx(B,{isOpen:t,onRequestClose:n.closeModal,"data-test":"refund-item-request-modal",children:s.jsxs(B.ModalForm,{"data-test":Uf.dataTestId,onSubmit:j,children:[s.jsx(B.Header,{align:w(),children:s.jsxs(ee,{as:"h2",id:"refund-item-request-modal-header","data-test":"refund-item-request-modal-header",size:"s",children:[_.headerTitle.label,s.jsx(ie,{children:g.name})]})}),s.jsxs(B.Body,{align:w(),children:[s.jsx(Bae,{className:"salt-m-b--4",name:g.name,image:g.image,fullWidth:!0}),u?s.jsx(fs.DropdownSelect,{required:!0,id:"refund-quantity",name:"refund-quantity",className:"salt-m-b--4",options:W,"data-test":"refund-quantity",label:{text:_.quantitySelect.label},placeholder:_.quantitySelect.placeholder,value:{value:String(E),name:String(E)},onOptionChange:({value:H})=>G({value:H})}):s.jsx(Dr,{required:!0,type:"number",value:E,id:"refund-quantity",name:"refund-quantity","data-test":"refund-quantity",label:_.quantitySelect.label,"aria-label":_.quantitySelect.ariaLabel,placeholder:_.quantitySelect.placeholder,onChange:H=>{y(parseInt(H.target.value,10))},children:Array(p.availableQuantity).fill().map((H,K)=>K+1).map(H=>s.jsx("option",{value:H,children:H},`itemQuantity-${H}`))}),s.jsx(Lns,{reason:I,setReason:S,fullWidth:!0})]}),s.jsxs(B.Footer,{align:w(),flow:A&&"column-reverse",className:"salt-gap--2",children:[s.jsx(x,{fill:!0,intent:"secondary",onClick:M,"data-test":"request-item-refund-cancel-button","aria-label":_.cancelRequestButton.ariaLabel,children:s.jsx(x.Text,{children:_.cancelRequestButton.label})}),s.jsx(x,{fill:!0,type:"submit",intent:"primary","data-test":"request-item-refund-continue-button","aria-label":_.continueButton.ariaLabel,children:s.jsx(x.Text,{children:_.continueButton.label})})]})]})}):null},Y1="refundItemRequestModal";Uf.dataTestId="refund-item-request-form";const Bns=e=>({isOpen:$e(Y1)(e),modalOptions:Yn(Y1)(e),productsByProductId:ts(e),availableItemsByItemId:uw(e),modalLeftAlignEnabled:Mns(e),regionId:gns(e),locale:Ms(e)}),Uns=st({analyticsEvent:U.analyticsEvent,closeModal:J.closeModal,addItemToRequest:W1.addItemToRequest,removeItemFromRequest:W1.removeItemFromRequest});Uf.propTypes=wns;Uf.defaultProps=Fns;const Gns=we(Bns,Uns)(Uf),q1=({orderRefundTipAlert:e,renderProducts:t,orderId:n})=>s.jsxs(V.Item,{colSpan:{xs:12,sm:12,lg:8,md:8},children:[s.jsx(Te,{text:e,intent:"info",className:"salt-m-x--2"}),s.jsx(Lt,{breakpoint:"md-up",children:s.jsx("div",{className:"salt-m-t--2 salt-m-b--8",children:s.jsx(Oie,{})})}),s.jsxs("div",{className:"salt-m--4",children:[s.jsx(Oe.Collection,{children:t()}),s.jsx(Gns,{orderId:n})]})]}),$ns=(e,t)=>async(n,o)=>{const r=o(),a=Tns(r),i=(c,d)=>{switch(c){case"HOURS":return{key:"refunds.place-refund-request.notification.success.hours",substitutions:{hours:d}};case"DAYS":return{key:"refunds.place-refund-request.notification.success.calendar-days",substitutions:{days:d}};case"WORKING_DAYS":return{key:"refunds.place-refund-request.notification.success.working-days",substitutions:{days:d}};default:return{key:"refunds.place-refund-request.notification.success",substitutions:{days:"{days}",hours:"{hours}"}}}},l=a.requestedItems.map(({retailerProductId:c,...d})=>d);return n(Hy.placeRefundRequest(e,{requestedItems:l})).then(c=>{const{unit:d,value:u}=c.payload.responseData.expectedRequestReviewTime;return Z.success(i(d,u)),n(U.analyticsEvent({type:vi.REQUEST_REFUND_GA4,orderId:e,...a})),te.sendEvent({GA:pY({payload:{orderId:e,requestedItems:a.requestedItems,refundTotal:a.refundTotal}}),WA:null}),t(cn(e))}).catch(()=>{Z.error("refunds.place-refund-request.notification.error")})},Hns={placeRefundRequest:$ns},Vns=e=>{const t=He(),{productName:n,price:o,withTaxNote:r}=e;return n?s.jsxs(fe.Group,{children:[s.jsxs(fe.Title,{"data-test":"refundable-summary-item-name",children:[n,"",r&&s.jsxs(h.Fragment,{children:["",s.jsx(O,{size:"s",className:"salt-d--inline-block","data-test":"summary-items-note",children:s.jsx(b,{id:"order.details.tax.exclusive.price"})})]})]}),s.jsx(fe.Description,{nowrap:!0,"data-test":"summary-invoice-amount",children:t(o)})]}):s.jsx("div",{})};function Wns(e,t){return e.refundsNetGrossEnabled?e.refundsTaxesSubtotal?t.price.net:t.price.gross:t.refundableAmount}const Yns=e=>s.jsx(fe,{children:e.decoratedSelectedItems.map(t=>s.jsx(Vns,{productName:t.productName,price:Wns(e,t),withTaxNote:e.refundsNetGrossEnabled&&e.refundsTaxesSubtotal},`product-refund=summary-${t.productName}`))}),qns=e=>e.refundsNetGrossEnabled&&e.refundsTaxesSubtotal,Kns=({summary:e,featureFlags:t})=>qns(t)?zns(e):Qns(),zns=e=>s.jsxs(h.Fragment,{children:[s.jsx(le.Taxes,{withTaxNote:!0,finalPrice:e.refundValueBreakdown.net,components:Xns(e.refundValueBreakdown.taxComponents)}),s.jsx(le.Separator,{})]}),Qns=()=>s.jsx(le.Separator,{"data-test":"subtotal-taxes-separator"}),Xns=e=>e.map(t=>({displayName:t.displayName,taxRate:t.taxRate,taxAmount:t.taxAmount})),Zns=e=>({summary:Bf(e)}),Jns=we(Zns)(Kns),eos=D("refunds.netgross"),tos=D("refunds.subtotal"),sos={intl:m.any.isRequired,actions:m.shape({analyticsEvent:m.func.isRequired,createRefundRequest:m.func.isRequired}).isRequired,decoratedSelectedItems:m.arrayOf(m.shape({productName:m.string.isRequired,prices:m.arrayOf(m.shape({amount:m.string.isRequired,currency:m.string.isRequired}))})).isRequired,totalRefundableAmount:m.shape({amount:m.string.isRequired,currency:m.string.isRequired}),totalPrice:m.shape({net:m.shape({amount:m.string.isRequired,currency:m.string.isRequired}),gross:m.shape({amount:m.string.isRequired,currency:m.string.isRequired})}),orderId:m.string.isRequired,orderCurrency:m.string.isRequired,formattedMessages:m.shape({summaryTitle:m.string,summaryRequestButton:m.string}),refundsNetGrossEnabled:m.bool,refundsTaxesSubtotal:m.bool},nos={formattedMessages:{},refundsNetGrossEnabled:!1,refundsTaxesSubtotal:!1},pw=e=>{const{intl:t,formattedMessages:n,refundsNetGrossEnabled:o,refundsTaxesSubtotal:r}=e,a=Ge(),i=He();n.summaryTitle=t.formatMessage("refunds.summary.non-empty.collapsed.header"),n.summaryRequestButton=t.formatMessage("refunds.summary.confirm-request.button");const[l,c]=h.useState(typeof window<"u"&&window.matchMedia(`(min-width: ${Ke.sm}em)`).matches),{actions:d,orderId:u,decoratedSelectedItems:p,totalRefundableAmount:g,orderCurrency:E,totalPrice:y}=e,I=o?y.gross:g,S=()=>{d.analyticsEvent({type:vi.CONFIRM_REQUEST_BUTTON_CLICKED,orderId:u}),d.createRefundRequest(e.orderId,a)},C=()=>{const _={amount:"0",currency:E};return s.jsx(cs,{children:s.jsx(le.TotalInline,{totalPrice:I||_})})},T=()=>s.jsxs(cs,{expanded:l,onToggle:()=>c(!l),"data-test":"summary-refund-request",aria:{contentLabel:n.summaryTitle,totalPrice:i(I)},children:[s.jsxs(cs.ControlSection,{children:[l?s.jsx(ee,{"data-test":"control-section-text",as:"h2",children:n.summaryTitle}):s.jsx(le.TotalInline,{totalPrice:I}),s.jsx(cs.ToggleSwitch,{"data-test":"toggle"})]}),s.jsxs(cs.Content,{children:[s.jsx(Yns,{decoratedSelectedItems:p,refundsNetGrossEnabled:o,refundsTaxesSubtotal:r}),s.jsx(Jns,{featureFlags:{refundsNetGrossEnabled:o,refundsTaxesSubtotal:r}}),s.jsx(le.TotalSpaceBetween,{withTaxNote:o,totalPrice:I})]}),s.jsx(le.Buttons,{loading:!1,children:p&&p.length>0&&s.jsx(x,{role:"link",intent:"primary",fill:!0,"data-test":"confirm-request-button",onClick:S,className:"salt-m-t--4",children:s.jsx(x.Text,{children:n.summaryRequestButton})})})]});return p&&p.length>0?T():C()},oos=e=>({decoratedSelectedItems:Ins(e),totalRefundableAmount:Rie(e),totalPrice:Sns(e),orderId:Die(e),orderCurrency:yns(e),refundsNetGrossEnabled:eos(e),refundsTaxesSubtotal:tos(e)}),ros=st({analyticsEvent:U.analyticsEvent,createRefundRequest:Hns.placeRefundRequest});pw.propTypes=sos;pw.defaultProps=nos;const aos=we(oos,ros)(pw),K1=({intl:e})=>s.jsxs(V.Item,{colSpan:{xs:12,sm:12,lg:4,md:4},children:[s.jsx("div",{className:"salt-m-x--2 salt-m-b--4",children:s.jsx(aos,{intl:e})}),s.jsx(Kt,{breakpoint:"md-up",children:s.jsx(Oie,{})})]}),ios=()=>{const e=L(),t=F(),{orderId:n}=nn(),o=f(As),{availableItems:r,isFetching:a}=f(P_),i=f(Bf),l=f(mo),c=f(Ms),d=dr(),u=e.formatMessage("refunds.refund-request-header.text");h.useEffect(()=>{n&&(t(pns(n,c)).catch(()=>{t(()=>J.openModal("refundRequestPlacedError"))}),(!o||!o.order)&&t(jo.getDecoratedOrderCall(n)))},[]);const p=()=>r&&r.length&&!a&&!i.isFetching?s.jsxs(ae.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx(zM,{type:"new-request",refundables:r,productsByProductId:l,isFetching:a&&i.isFetching,selectedItems:i.selectedItems})]}):null;return n?s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"refunds.refund-request-page.title",values:{orderId:n}}),s.jsx(Cns,{orderId:n}),s.jsx(mns,{"data-test":"refund-request-header",orderId:n}),s.jsx(V,{flush:!0,"data-test":"refund-request-page-body",children:d==="xs"||d==="sm"?s.jsxs(ae.Fragment,{children:[s.jsx(K1,{intl:e}),s.jsx(q1,{orderRefundTipAlert:u,renderProducts:p,orderId:n})]}):s.jsxs(ae.Fragment,{children:[s.jsx(q1,{orderRefundTipAlert:u,renderProducts:p,orderId:n}),s.jsx(K1,{intl:e})]})})]}):null},Pie=()=>s.jsx(Et,{type:"RefundRequestPage::route",children:s.jsx(ios,{})});Pie.fetchData=({store:e,params:t})=>e.dispatch(jo.getDecoratedOrderCall(t.orderId));const los=D("slfsrv.refunds"),cos=e=>[{path:"/orders/:orderId/refund-request",Component:$s(Xe,e.Main),children:[{index:!0,Component:as(los,Pie,ot)}]}],dos=v.div`
    ${re.smUp`
        min-inline-size: ${$(344)};
        max-inline-size: ${$(344)};
    `}
`,uos={"aria-haspopup":"true"},pos=({onLearnMoreButtonClick:e})=>s.jsx(Q,{className:"salt-p-t--8 salt-p-b--4 md:salt-p-b--8",align:"center",justify:"center",children:s.jsx(dos,{className:"sm:salt-p-x--0 salt-p-x--2",children:s.jsx(Os,{titleAs:"h1",title:"regular.onboarding.noRegulars.header",titleIcon:"regulars",description:"regular.onboarding.noRegulars.body",primaryButton:{text:"regular.onboarding.noRegulars.learn-more.button",onClick:e,aria:uos}})})}),mos=[{headerId:"regular.onboarding.noRegulars.modal.explanationCards.1.header",bodyId:"regular.onboarding.noRegulars.modal.explanationCards.1.body"},{headerId:"regular.onboarding.noRegulars.modal.explanationCards.2.header",bodyId:"regular.onboarding.noRegulars.modal.explanationCards.2.body.text"},{headerId:"regular.onboarding.noRegulars.modal.explanationCards.3.header",bodyId:"regular.onboarding.noRegulars.modal.explanationCards.3.body"}],hos="onboarding-description-list-item",gos="onboarding-description-list-item-separator",Eos=({headerId:e,bodyId:t,isLastCard:n,showSeparator:o})=>s.jsxs(h.Fragment,{children:[s.jsxs(Be.Item,{"data-test":hos,className:"salt-p-y--2 salt-p-r--2 salt-m-b--0",children:[s.jsx(ee,{as:"span",className:"salt-d--block salt-p-b--2",children:s.jsx(b,{id:e})}),s.jsx(O,{size:"l",children:s.jsx(b,{id:t})})]}),o&&!n?s.jsx(Ts,{"data-test":gos,className:"salt-m-y--2"}):null]}),fos="onboarding-description-list",yos=({cards:e,showSeparator:t=!0})=>s.jsx(Be,{inline:!0,"data-test":fos,className:"salt-p-t--2 salt-p-b--4",children:e.map(({headerId:n,bodyId:o},r)=>{const a=r===e.length-1;return s.jsx(Eos,{bodyId:o,headerId:n,isLastCard:a,showSeparator:t},n)})}),Nie=({showCardsSeparator:e=!1})=>s.jsxs(h.Fragment,{children:[s.jsx(O,{size:"l",className:"salt-p-b--4",children:s.jsx(b,{id:"regular.onboarding.noRegulars.body"})}),s.jsx(yos,{cards:mos,showSeparator:e})]});Nie.dataTestId="onboarding-modal-content-body";function mw(){return s.jsxs(ee,{as:"h1","data-test":mw.dataTestId,id:"regulars-onboarding-header",children:[s.jsx("span",{className:"salt-m-r--2",children:s.jsx(pe,{name:"regulars",verticalAlign:"middle",width:25,height:25})}),s.jsx(b,{id:"regular.onboarding.noRegulars.modal.header"})]})}mw.dataTestId="onboarding-modal-content-title";const Ios={labelledby:"regulars-onboarding-header",modal:"true"},Sos=({isOpen:e,onRequestClose:t})=>s.jsxs(B,{isOpen:e,onRequestClose:t,aria:Ios,asBottomSheet:!0,children:[s.jsx(B.Header,{align:"left",children:s.jsx(mw,{})}),s.jsx(B.Body,{className:"salt-p-y--4","data-test":"no-regulars-yet-onboarding-modal-content",children:s.jsx(Nie,{showCardsSeparator:!0})})]}),Cos="onboarding",vos=()=>{const[e,t]=h.useState(!1),n=()=>{t(!0)},o=()=>{t(!1)};return s.jsxs("div",{"data-test":Cos,children:[s.jsx(pos,{onLearnMoreButtonClick:n}),s.jsx(Sos,{isOpen:e,onRequestClose:o}),s.jsx(Ts,{className:"salt-m-x--2 salt-m-y--2"})]})};function Lie(){const{search:e}=Ne(),t=F(),n=f(Cu),o=f($e(uT)),r=hT(),{productRemovedFromRegulars:a,removeAllRegularsModalDisplayed:i,toastNotificationDisplayed:l}=ef(),c=Qe.parse(e)?.sublocationId;h.useEffect(()=>{o&&i()},[o]);const d=()=>{t(J.closeModal())},u=async()=>{const g=typeof c=="string"?c:void 0;try{await t(Y6e()),await t(mT.getRegularsCataloguePageCall({category:g})),Z.success("regular.removeAllRegularsModal.success"),l("allRegularsRemoved"),a({productId:"",retailerProductId:"",removeAll:!0}),r.removeAllRegularsGaEvent({count:n.length}),d()}catch(E){Ue.api.pushError(E instanceof Error?E:new Error(`RemoveAllRegularsModal-onConfirmClick error: ${JSON.stringify(E)}`))}},p=h.useCallback(u,[n?.length]);return s.jsx(xT,{translations:{header:"regular.removeAllModal.header",body:"regular.removeAllModal.body",cancel:"regular.removeAllModal.cancel",confirm:"regular.removeAllModal.okay"},isOpen:o,onConfirm:p,onCancel:d})}Lie.dataTestId="remove-all-regulars-modal";const Tos=v.div`
    margin-block-start: ${({isLargeScreen:e})=>e?$(28):0};
    margin-inline: ${$(8)} ${({isLargeScreen:e})=>e?0:$(8)};
`,hw=()=>{const e=F(),{currentBreakpoint:t}=h.useContext(kn),n=Ke[t||""]||0,o=n<Ke.sm,r=n>=Ke.lg,a=()=>{e(J.openModal(uT))};return s.jsxs(Tos,{isLargeScreen:r,children:[s.jsx(x,{intent:"secondary","data-test":hw.dataTestId,onClick:a,fill:o||r,children:s.jsx(x.Text,{children:s.jsx(b,{id:"regular.removeRegulars.button"})})}),s.jsx(Lie,{})]})};hw.dataTestId="remove-regulars-button";const _os=({productId:e,productIndex:t,page:n,section:o,productName:r})=>s.jsx(N7,{productId:e,page:n,productIndex:t,section:o,productName:r}),bos=({showRemoveRegularsButton:e})=>{if(e)return s.jsx(hw,{})},xos=({term:e})=>s.jsx(Fk,{page:"regulars",term:e}),Aos=({term:e,clearFilters:t})=>s.jsx(yf,{clearFilters:t,page:"regulars",term:e}),z1=({category:e,sortOption:t,filters:n={}}={})=>`${Ok()}?${nE({category:e,filters:n,sortOption:t})}`,Ros=()=>{const e=L(),t=F(),n=Ne(),o=Ge(),r=f(Cu),a=f(a8),i=f(Aq),c=f(oD)===0,d=r.length===0;h.useEffect(()=>{!a&&r&&t(U.analyticsEvent({type:Is.REGULARS_TOTAL_COUNT,count:r.length}))},[r?.length,a]);const u=()=>{if(!c)return{name:e.formatMessage({id:"navigation.regulars"}),url:z1()}},p=g=>{const{category:E}=g;return mT.fetchRegularsCatalogueAndUpdateProducts({category:E})(t)};return s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h1",{children:e.formatMessage({id:"navigation.regulars"})})}),d&&s.jsx(vos,{}),s.jsx(Vm,{navigate:o,page:"regulars",fetchPage:p,rootBreadcrumb:u(),hideBreadcrumb:c,getTargetUrl:g=>z1(g),location:n,categories:i,hideGtmTarget:!0,fopControlsFactory:_os,additionalNavigableContentFactory:()=>bos({showRemoveRegularsButton:!!r.length}),noProductsPage:({term:g})=>xos({term:g}),noProductsFilteredPage:({clearFilters:g,term:E})=>Aos({term:E,clearFilters:g})})]})},Dos=()=>s.jsxs(zT,{activeTab:pa.REGULARS,"data-test":L_.dataTestId,children:[s.jsx(bt,{title:"regular.title"}),s.jsx(Ros,{})]}),L_=()=>s.jsx(Et,{type:"Regulars::route",children:s.jsx(Dos,{})});L_.dataTestId="regulars-section";L_.fetchData=async({context:e})=>{const{store:t,url:n}=e,o=n.searchParams.get("sublocationId"),r=At(t.getState()),a=typeof o=="string"?o:void 0,[i]=await Promise.allSettled([t.dispatch(mT.getRegularsCataloguePageCall({category:a})),t.dispatch(CN())]);if(i.status==="fulfilled"){const l=`${n.pathname}${n.search}`,c=r?.length?l.replace(r,""):l;t.dispatch(o8(i.value?.productGroups??[])),t.dispatch(yt.setLastFetchedCatalogueLocation(c))}};const Oos=D(_u),Pos=(e,{isUserLoggedIn:t=Xe}={})=>[{path:"/regulars",Component:e.Main,children:[{index:!0,Component:$s(t,as(Oos,L_,ot))}]}],kie=D("seo.rdbl"),Nos=D("rec"),Los=D("bt.top"),kos=()=>{const e=ws(),t=L(),n=Ne(),o=Ge(),r=Hg(),a=f(Qp,rp),i=f(Ms),l=f(oge),c=f(aD),d=f(cD),u=JSON.stringify(f(D2)),p=f(iD),g=f(zp),E=f(kpt,rp),y=f(BQe,rp),I=f(rE),S=f(kie),C=f(Los),T=ff(),_=Qe.parse(n.search).sublocationId||void 0,A={breadcrumbPreface:t.formatMessage("search.breadcrumb.preface"),noResultsSubtext:t.formatMessage("search.no.results.title.subtext")},R=Qe.parse(n.search).q||void 0,{fetchSearchResultsPage:P}=XT(),N=()=>{const{searchTerm:X,correctedSearchTerm:q}=a;return q||X||R},k=()=>{e(ds({name:Yxe,attributes:{searchTerm:R}}))},M=()=>{const X=c.find(ne=>ne.selected)?.id,{correctedSearchTerm:q}=a;e(U.analyticsEvent({type:Cs.SEARCH_PAGE_VIEWED,searchTerm:R,correctedSearchTerm:q,locale:i,mlModelIds:l,sort:X,searchSuggestionType:n.state?.source}))},w=()=>{const{correctedSearchTerm:X,searchTerm:q}=a;if(p){e(U.analyticsEvent({type:Cs.SEARCH_EVENT,searchTerm:q,correctedSearchTerm:X,locale:i,searchSuggestionType:n.state?.source}));const ne={event:"search",corrected_search_term:X,locale:i,search_term:q};te.sendEvent({GA:ne,WA:null}),e(U.analyticsEvent({type:Cs.GA_SHOW_SEARCH_PAGE,searchTerm:q,correctedSearchTerm:X,locale:i}));const ue={event:"event",eventCategory:"Search",pagePartType:"SEARCH",eventAction:"GA_SHOW_SEARCH_PAGE",eventLabel:q,searchTerm:q,correctedSearchTerm:X,locale:i};te.sendEvent({GA:ue,WA:null})}};h.useEffect(()=>()=>{e(Ur.updateItemAddedToBasket(!1))},[]),h.useEffect(()=>{a.searchTerm&&(M(),w())},[a,d,u,_]);const j=({category:X=void 0,sortOption:q=void 0,filters:ne={}}={})=>Za(S,{queryString:nE({category:X,filters:ne,sortOption:q,additional:{q:R}})}),G=X=>s.jsx(O,{bold:!0,className:"salt-d--inline",children:X}),W=()=>{const{searchTerm:X,correctedSearchTerm:q}=a;return q&&X!==q?s.jsx(b,{id:"search.breadcrumb.subtitle",values:{searchTerm:G(X),correctedSearchTerm:G(q)}}):null},H=({category:X,nextPageToken:q})=>e(Nk({category:X,pageToken:q,additional:{term:R},isRetailerCategoryId:!1})).then(ne=>{!I&&ne&&ne.nextPageToken&&ne.productCount===0&&H({category:X,nextPageToken:ne.nextPageToken})}),K=N();return!R||typeof R!="string"||R.trim()===""?S?s.jsx(En,{to:bo()}):s.jsx(En,{to:ao()}):s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"search.page.title",values:{searchTerm:K}}),s.jsx(Vm,{navigate:o,fetchPage:P,fetchNextPage:H,page:"search",getTargetUrl:X=>j(X),breadcrumbPreface:A.breadcrumbPreface,rootBreadcrumb:{name:K,url:j()},breadcrumbSubtitle:W(),location:n,navigationType:r,noProductsFilteredPage:({clearFilters:X})=>s.jsx(yf,{clearFilters:X,page:"search",term:K}),noProductsPage:()=>s.jsx(Fk,{icon:"search",page:"search",subtext:A.noResultsSubtext,term:K}),onInitialFopLoad:k,pageError:g,showSortAndFilters:!0,withinGridProductCards:[...E,...y],shouldShowScrollToTopButton:C?!1:T}),C&&s.jsx(Du,{})]})},aR=()=>s.jsx(Et,{type:"Search::route",children:s.jsx(kos,{})});aR.fetchData=async({store:e,req:t})=>{const n=e.getState(),o=kie(n),{q:r="",sublocationId:a,sortBy:i}=t.query,l=t.url,c=l.split("?")[1];if(typeof r=="string"&&r.length){const d=Yp(t.query),u=Nk({category:a,filters:d,sortOption:i,additional:{term:r},isRetailerCategoryId:!1}),p=[e.dispatch(u).then(()=>{e.dispatch(yt.setLastFetchedCatalogueLocation(t.originalUrl))}),e.dispatch(Tee(r)),...Nos(n)?[e.dispatch(vee(r))]:[]];await Promise.all(p)}if(o){const d=Za(o,{queryString:c});if(l.toLowerCase()!==d.toLowerCase()){const u=At(n);return{redirectTo:Za(o,{queryString:c,basePath:u}),statusCode:IH}}}};const jos=e=>[{path:"/products/search",Component:e.Main,key:"main",children:[{path:"/products/search",Component:aR,key:"/products/search"}]},{path:"/search",Component:e.Main,key:"main",children:[{path:"/search",Component:aR,key:"/search"}]}],Mos=()=>{const{formatMessage:e}=L(),t=f(Cg),n=es("loyalty-scheme-url"),o=km({getQuantity:Cg});return s.jsxs(h.Fragment,{children:[t&&t.units!==void 0?s.jsxs("div",{children:[s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"settings.loyalty.heading"})}),s.jsx(ie,{children:s.jsx(O,{children:e("settings.loyalty.amount.description",{amount:o})})}),s.jsx(O,{size:"l","aria-hidden":!0,className:"salt-m-t--2 salt-m-b--8 salt-d--block",children:o})]}):null,s.jsx(x,{asChild:!0,intent:"primary","data-test":"loyalty-manage-button","aria-label":e("settings.loyalty.manage.alternative"),children:s.jsx(tt,{intent:"ghost",href:n,target:"_blank",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.loyalty.manage"})})})})]})},wos=()=>s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.loyalty.page.title"}),s.jsx(Mos,{})]}),Fos={accountDetailsSeparationEnabled:m.bool,availableLanguages:m.arrayOf(m.string).isRequired,customerLanguage:m.string,registerField:m.func.isRequired,intl:m.any.isRequired},Bos={customerLanguage:""},k_=e=>{const t={label:e.intl.formatMessage("accountSettings.language.selection.label"),language:{...Qj(e.availableLanguages,e.intl)}},n=o=>e.customerLanguage?e.customerLanguage===o:e.availableLanguages[0]===o;return e.accountDetailsSeparationEnabled?s.jsx(h.Fragment,{children:e.availableLanguages.map(o=>h.createElement(Ao,{...e.registerField({name:"language",checked:n(o),type:"radio",value:o}),key:o,label:t.language[o],"aria-label":o,"data-synthetics":"language-select"}))}):s.jsx(Dr,{label:t.label,...e.registerField({name:"language",type:"select",value:e.customerLanguage||e.availableLanguages[0]}),"data-synthetics":"language-select",children:e.availableLanguages.map(o=>s.jsx("option",{value:o,children:t.language[o]},o))})};k_.propTypes=Fos;k_.defaultProps=Bos;const Uos=D("ads"),Gos=({getFieldValues:e,isValid:t,registerField:n})=>{const o=F(),r=L(),a=f(Ol),i=f(Wp),l=f(q2),c=f(Rt),d=f(Uos);ae.useEffect(()=>{(!c||!a?.lastUpdated)&&o(xs.getCurrentCustomer())},[]);const u=E=>o(xs.updateCustomerLanguage(E))?.then(()=>{o(U.analyticsEvent({type:_r.LOCALE_CHANGED,locale:E}));const y={event:"event",eventAction:"LOCALE_CHANGED",eventCategory:"Locale",eventLabel:E};te.sendEvent({GA:y,WA:null}),o(U.analyticsEvent({type:_r.LOCALE_CHANGED_GA4,locale:E}));const I={event:"locale_changed",locale:E};te.sendEvent({GA:I,WA:null})}),p=E=>l!==E,g=E=>{if(E.preventDefault(),t()){const y=e().language.value;return p(y)?u(y).then(()=>o(xs.getCurrentCustomer())).then(()=>{Z.success("settings.account.details.update.success"),Of(y)}).catch(()=>{Z.error("settings.account.details.update.error")}):!1}return!1};return s.jsxs("form",{onSubmit:g,"data-test":"language-form",children:[s.jsx(k_,{accountDetailsSeparationEnabled:d,registerField:n,availableLanguages:i,customerLanguage:l,intl:r}),s.jsx(x,{intent:"primary",type:"submit","data-test":"language-submit-button",children:s.jsx(x.Text,{children:r.formatMessage("settings.language.save")})})]})},$os=qO(Gos),jie=()=>s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.language.page.title"}),s.jsx(ie,{children:s.jsx(b,{id:"settings.language.heading"})}),s.jsx("div",{className:"salt-m-b--4",children:s.jsx($os,{})})]});jie.fetchData=({context:{store:e}})=>e.dispatch(xs.getCurrentCustomer());const Hos={message:m.oneOfType([m.string,m.object]).isRequired,testAttribute:m.string,type:m.string.isRequired},Vos={testAttribute:void 0},Wos=v.div`
    inline-size: 100%;

    ${re.smUp`
        width: 100%;
    `}

    ${re.mdUp`
        width: 33%;
    `};

    ${re.lgUp`
        width: 33%;
    `}
`,gw=({message:e,testAttribute:t,type:n})=>s.jsx(Wos,{children:s.jsx(Te,{intent:n,"data-test":t,text:e,className:"salt-p--2",showIcon:!1})});gw.defaultProps=Vos;gw.propTypes=Hos;const Yos=e=>async(t,n)=>{const o=xr(n());try{await t(ag.removeCustomerWalletItem(e,o));const r={event:"event",eventAction:"REMOVE_WALLET_ITEM_SUCCESS",eventCategory:"Settings",eventLabel:"Not Set"};te.sendEvent({GA:r,WA:null}),Z.success("settings.wallet.remove.item.success"),t(J.closeModal())}catch{const r={event:"event",eventAction:"REMOVE_WALLET_ITEM_ERROR",eventCategory:"Settings",eventLabel:"Not Set"};te.sendEvent({GA:r,WA:null}),Z.error("settings.address.book.remove.modal.error")}},qos={removeWalletItem:Yos},Kos=D("m.la.h"),zos={actions:m.shape({closeModal:m.func.isRequired,removeWalletItem:m.func.isRequired}).isRequired,isOpen:m.bool,intl:m.any.isRequired,walletItem:m.shape({walletItemId:m.string,fundingInstrumentId:m.string,isDefault:m.bool,paymentMethod:m.string,details:m.shape()}),modalLeftAlignEnabled:m.bool},Qos={walletItem:{},isOpen:!1,modalLeftAlignEnabled:!1},Ew=({actions:e,isOpen:t,intl:n,walletItem:o,modalLeftAlignEnabled:r})=>{const a={removeWalletItemModalTitle:n.formatMessage("settings.wallet.remove.item.modal.title"),cancelButtonModal:n.formatMessage("settings.wallet.remove.item.modal.cancel"),cancelButtonAriaLabel:n.formatMessage("settings.wallet.remove.item.modal.cancel.ariaLabel"),removeWalletItemModalSubmitButton:n.formatMessage("settings.wallet.remove.item.modal.submit"),removeWalletItemModalSubmitAriaLabel:n.formatMessage("settings.wallet.remove.item.modal.submit.ariaLabel")},i=()=>{e.closeModal()},l=()=>{i()},c=Dd(()=>{e.removeWalletItem(o.walletItemId)},200),d="remove-wallet-item-modal-header",u=o.paymentMethod===at.CARDS||o.paymentMethod===at.PAYPAL;return s.jsxs(B,{isOpen:t,onRequestClose:i,aria:{labelledby:d},children:[s.jsx(B.Header,{align:r?"left":"center",children:s.jsx(ee,{as:"h2",id:d,"data-test":d,children:a.removeWalletItemModalTitle})}),u&&s.jsx(B.Body,{children:s.jsx(xe,{"data-test":"wallet-item-remove-modal-card-details",children:s.jsx(zm,{paymentInfo:{paymentMethodV2:o.paymentMethod,...o.details}})})}),s.jsxs(B.Footer,{align:r?"left":"center",className:"salt-gap--2",children:[s.jsx(x,{onClick:l,intent:"secondary",fill:!0,"aria-label":a.cancelButtonAriaLabel,children:s.jsx(x.Text,{children:a.cancelButtonModal})}),s.jsx(x,{intent:"primary",fill:!0,onClick:c,"data-test":"wallet-item-remove-confirm-button","data-synthetics":"wallet-item-remove-confirm-button","aria-label":a.removeWalletItemModalSubmitAriaLabel,children:s.jsx(x.Text,{children:a.removeWalletItemModalSubmitButton})})]})]})};Ew.defaultProps=Qos;Ew.propTypes=zos;const Xos=e=>({isOpen:$e("removeWalletItem")(e),modalLeftAlignEnabled:Kos(e)}),Zos=st({closeModal:J.closeModal,removeWalletItem:qos.removeWalletItem}),Jos=Tt(Ht,we(Xos,Zos))(Ew),ers="PAYPAL",trs="CARDS",srs=D("pay.surm");class nrs extends h.Component{formattedMessages;impressionSent;queuedImpressions;constructor(t){super(t),this.remove=this.remove.bind(this),this.formattedMessages={addItem:this.props.intl.formatMessage("settings.wallet.item.add"),addItemEmpty:this.props.intl.formatMessage("settings.wallet.item.add.empty.wallet"),makePrimary:this.props.intl.formatMessage("settings.wallet.item.button.make.primary"),removeItem:this.props.intl.formatMessage("settings.wallet.item.button.remove")},this.state={item:{}},this.impressionSent={},this.queuedImpressions=[]}componentDidMount(){(!this.props.isServerRendered||!this.props.wallet.lastUpdated)&&this.props.actions.getWalletItems(),this.sendImpressions()}componentDidUpdate(){this.sendImpressions()}getCardHeader(t){return s.jsx(kg,{paymentInfo:{paymentMethodV2:t.paymentMethod,...t.details}})}getCardBody(t){return s.jsx(Ag,{paymentInfo:{paymentMethodV2:t.paymentMethod,...t.details}})}getCardButtons(t){return s.jsx(x,{onClick:()=>this.remove(t),intent:"secondary","aria-label":this.generateRemoveAriaLabel(t),"data-synthetics":"wallet-item-remove-button","data-test":"wallet-item-remove-button",fill:!0,children:s.jsx(x.Text,{children:this.formattedMessages.removeItem})})}generateRemoveAriaLabel(t){const{paymentMethod:n,details:o}=t;if(n===ers)return this.props.intl.formatMessage("settings.wallet.item.button.remove.aria.paypal",{emailAddress:o.emailAddress});if(n===trs){const r=`${o.expiryMonth}/${o.expiryYear}`;return this.props.intl.formatMessage("settings.wallet.item.button.remove.aria.card",{cardType:o.cardTypeDisplayName,last4Digits:o.lastFourDigits,cardExpiryDate:r})}}remove(t){this.setState({item:t},()=>{this.props.actions.openRemoveItemModal()})}impression(t,n){n!==void 0&&!this.impressionSent[n]&&(this.queuedImpressions.push(t),this.impressionSent[n]=!0)}sendImpressions(){this.queuedImpressions.length>0&&(this.props.actions.analyticsEvent({type:Ot.WALLET_ITEM_IMPRESSION,walletItemImpressions:this.queuedImpressions}),this.queuedImpressions=[])}buildItem(t){this.impression({IS_DEFAULT:t.isDefault,WALLET_ITEM_ID:t.walletItemId},t.walletItemId);const n=!this.props.isSuperuser||this.props.isSuperUserRemoveWalletItemEnabled;return s.jsxs(Oe.Action,{"data-test":"wallet-item-card","data-synthetics":"wallet-item-card",children:[s.jsx(Oe.Action.Header,{"data-pii":"true",children:this.getCardHeader(t)}),s.jsx(Oe.Action.Body,{"data-pii":"true","data-test":"wallet-item-id",children:this.getCardBody(t)}),n&&s.jsx(Oe.Action.Footer,{children:this.getCardButtons(t)})]},t.walletItemId)}buildAddItem(t){return s.jsx(Oe.Action,{"data-synthetics":"wallet-item-add-card",children:s.jsx(x,{onClick:this.props.actions.startAddWalletItem,intent:"secondary","data-test":"wallet-item-add-button","data-synthetics":"wallet-item-add-button",children:s.jsx(x.Text,{children:this.props.isTextButtonWalletItemAware&&this.props.wallet.items.length===0?this.formattedMessages.addItemEmpty:this.formattedMessages.addItem})})},t.walletItemId)}buildCard(t){return t.type==="PLACEHOLDER"?s.jsx(Oe.Action.Skeleton,{},t.walletItemId):t.type==="ADD_WALLET_ITEM"?this.props.isSuperuser?null:this.buildAddItem(t):this.buildItem(t)}getWalletTextBoxIndication(){return s.jsx(gw,{message:s.jsx(b,{id:"settings.wallet.page.textbox.indication"}),type:"info",testAttribute:"textIndication"})}render(){const{wallet:t,isTextboxWalletIndicationAllowed:n}=this.props,o=t.lastUpdated?[...t.items,{walletItemId:"99",type:"ADD_WALLET_ITEM"}]:Array.from(Array(3),(r,a)=>({walletItemId:`${a}`,type:"PLACEHOLDER"}));return t.fetchError?s.jsx(Fc,{action:this.props.actions.getWalletItems}):s.jsxs(h.Fragment,{children:[s.jsx(ie,{children:s.jsx(b,{id:"settings.wallet.heading"})}),s.jsx(Oe.Collection,{children:o.map(r=>this.buildCard(r))}),s.jsx(vj,{}),n&&this.getWalletTextBoxIndication(),s.jsx(Jos,{walletItem:this.state.item})]})}}const ors=e=>({wallet:UE(e),isSuperuser:e.session.isSuperuser,isServerRendered:Rt(e),isTextButtonWalletItemAware:Ze(e,"textbox-visibility-management-add-wallet-item-button-text-is-wallet-items-aware")==="true",isTextboxWalletIndicationAllowed:Ze(e,"textbox-visibility-management-wallet-textbox-message")==="true",isSuperUserRemoveWalletItemEnabled:srs(e)}),rrs=st({getWalletItems:Km.getWalletItems,startAddWalletItem:_f.startAddWalletItem,openRemoveItemModal:()=>J.openModal("removeWalletItem"),analyticsEvent:U.analyticsEvent}),ars=Tt(Ht,we(ors,rrs))(nrs),Mie=()=>{const e=Ne();return h.useEffect(()=>{const t=Qe.parse(e.search).error;if(t){const n=`add.wallet.item.failure.${t}`;Object.prototype.hasOwnProperty.call(n)&&Z.error(n)}},[e]),s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.wallet.page.title"}),s.jsx(ars,{})]})};Mie.fetchData=({context:{store:e}})=>e.dispatch(Km.getWalletItems());function irs({subscription:e}){const t=f(cr),{expiry:n,paymentInformation:o}=e.customerSubscription.subscription;if(!o)return null;const r=e.metadata.isPlanAutoRenewing?s.jsx(O,{"data-test":"renewalMessage",children:s.jsx(b,{id:"delivery.pass.expires.off",values:{renewalDate:gt(n,t)}})}):null;return s.jsxs(xe,{className:"salt-m-b--4",children:[s.jsx(zm,{paymentInfo:{nonSavedFundingInstrument:!1,paymentMethodV2:o.paymentMethodTypeV2,...o.details}}),r]})}const lrs=({addresses:e=[]})=>s.jsx(ae.Fragment,{children:e.length>0&&s.jsxs("div",{className:"salt-m-b--4",children:[s.jsx("div",{className:"salt-p-b--2",children:s.jsxs(O,{bold:!0,size:"l",children:[s.jsx(b,{id:"delivery.pass.list.valid.addresses.text"}),":"]})}),s.jsx(Be,{children:e.map(t=>s.jsx(Be.Item,{children:s.jsxs(Q,{align:"flex-start",justify:"flex-start",wrap:"nowrap",children:[s.jsx("div",{className:"salt-p-r--2",children:s.jsx(pe,{success:!0,name:"status_yes"})}),s.jsxs("div",{"data-test":"address-item",children:[s.jsxs(O,{bold:!0,children:[t.nickname,":"]}),s.jsx(O,{children:t.address})]})]})},t.addressId))})]})}),wie="BLANK_SPACE";function crs(e){return Array.isArray(e)?s.jsx(h.Fragment,{children:e.map(t=>t.id===wie?s.jsx("span",{children:""}):s.jsx(b,{...t},t.id))}):s.jsx(b,{...e})}const drs=v.div`
    text-align: start;
`;function urs({message:e,testAttribute:t,type:n}){return s.jsx(drs,{className:"salt-p-b--2",children:s.jsx(Te,{intent:n,showIcon:!1,"data-test-type":n,"data-test":t,text:crs(e)})})}function Cx(e,t){return s.jsx(urs,{...e,type:t})}const Mr={success:e=>Cx(e,"success"),error:e=>Cx(e,"error"),warning:e=>Cx(e,"warning")},wr={createTransitioningNewPlanMessage:e=>Mr.success({message:{id:"settings.delivery.pass.auto.switch.new.plan.message",values:e},testAttribute:"renewalMessage"}),createExpiryMessage:e=>Mr.warning({message:{id:"delivery.pass.expires.on",values:e},testAttribute:"expiryMessage"}),createPendingMessage:()=>Mr.warning({message:{id:"subscription.alert.deliverypass.pending.message"},testAttribute:"pendingMessage"}),createTransitioningCurrentPlanMessage:e=>Mr.warning({testAttribute:"renewalMessage",message:{id:"settings.delivery.pass.auto.switch.current.plan.message",values:e}}),createPlanWillTransitionMessage:({expiry:e,planDescription:t,planName:n})=>Mr.warning({testAttribute:"autorenewal-enabled-transitioning-plan-alert",message:[{id:"settings.delivery.pass.auto.switch.on.message",values:{passName:`${n} - ${t}`,transitioningDate:e.expiryDate}},{id:wie},{id:"settings.delivery.pass.auto.switch.on.link.label"}]}),createPlanTerminatedMessage:({expiry:e,planDescription:t,planName:n})=>Mr.error({testAttribute:"renewal-disabled-alert",message:{id:"delivery.pass.plan.terminated.message",values:{pass:`${n} - ${t}`,...e}}}),createAutoRenewOffMessage:({expiry:e,planName:t,planDescription:n})=>Mr.warning({testAttribute:"renewal-off-alert",message:{id:"settings.delivery.pass.auto.renew.off.message",values:{pass:`${t} - ${n}`,...e}}}),createAutoRenewOnMessage:({benefitName:e,expiry:t})=>Mr.success({message:{id:"settings.delivery.pass.auto.renew.on.message",values:{pass:e,...t}},testAttribute:"autorenewal-enabled-alert"}),createFreeTrialAutoRenewOnMessage:({benefitName:e,expiry:t})=>Mr.success({message:{id:"settings.delivery.pass.free.trial.auto.renew.on.message",values:{pass:e,...t}},testAttribute:"autorenewal-enabled-alert"}),createReauthRequiredMessage:({benefitName:e,benefitDescription:t})=>Mr.error({message:{id:"settings.delivery.pass.reauth.message",values:{pass:`${e} - ${t}`}},testAttribute:"subscription-reauth-required-alert"}),createAutoRenewalHasNoWalletItemAlert:({expiry:e,planName:t,planDescription:n})=>Mr.warning({message:{id:"settings.delivery.pass.auto.renew.no.wallet.item.message",values:{pass:`${t} - ${n}`,...e}},testAttribute:"autorenewal-no-wallet-item-alert"}),createAutoSwitchNewPlan:e=>Mr.success({message:{id:"settings.delivery.pass.auto.switch.new.plan.message",values:e},testAttribute:"renewalMessage"}),createFreeTrialAutorenewOffMessage:({benefitName:e,expiry:t})=>Mr.warning({message:{id:"settings.delivery.pass.free.trial.cancelled.auto.renew",values:{planName:e,...t}},testAttribute:"freetrial-autorenewal-disabled-alert"})},Fie=e=>{function t(r){return{expiryDate:gt(r,e)}}function n({expiry:r,planDescription:a,planName:i}){return{expiry:t(r),planDescription:a,planName:i}}function o({benefitName:r,expiry:a}){return{expiry:t(a),benefitName:r}}return{createTransitioningNewPlanMessage:r=>wr.createTransitioningNewPlanMessage(t(r)),createExpiryMessage:r=>wr.createExpiryMessage(t(r)),createPendingMessage:()=>wr.createPendingMessage(),createTransitioningCurrentPlanMessage:r=>wr.createTransitioningCurrentPlanMessage(t(r)),createPlanWillTransitionMessage:r=>wr.createPlanWillTransitionMessage(n(r)),createPlanTerminatedMessage:r=>wr.createPlanTerminatedMessage(n(r)),createAutoRenewOffMessage:r=>wr.createAutoRenewOffMessage(n(r)),createAutoRenewOnMessage:r=>wr.createAutoRenewOnMessage(o(r)),createFreeTrialAutoRenewOnMessage:r=>wr.createFreeTrialAutoRenewOnMessage(o(r)),createFreeTrialAutorenewOffMessage:r=>wr.createFreeTrialAutorenewOffMessage(o(r)),createReauthRequiredMessage:r=>wr.createReauthRequiredMessage(r),createAutoRenewalHasNoWalletItemAlert:r=>wr.createAutoRenewalHasNoWalletItemAlert(n(r)),createAutoSwitchNewPlan:r=>wr.createAutoSwitchNewPlan(t(r))}},prs=({calendarDateFormat:e,status:t,info:{expiry:n,benefit:{name:o,description:r},plan:{name:a,description:i}}})=>{const l=Fie(e);switch(t){case"Free trial auto renew on":return l.createFreeTrialAutoRenewOnMessage({expiry:n,benefitName:o});case"Free trial auto renew off":return l.createFreeTrialAutorenewOffMessage({expiry:n,benefitName:o});case"Plan will transition":return l.createPlanWillTransitionMessage({expiry:n,planName:a,planDescription:i});case"Auto switch current plan":return l.createTransitioningCurrentPlanMessage(n);case"ReAuth required":return l.createReauthRequiredMessage({benefitDescription:r,benefitName:o});case"Plan terminated":return l.createPlanTerminatedMessage({expiry:n,planName:a,planDescription:i});case"Pending":return l.createPendingMessage();case"Auto renewal has no wallet item":return l.createAutoRenewalHasNoWalletItemAlert({expiry:n,planName:a,planDescription:i});case"Auto renewal off":return l.createAutoRenewOffMessage({expiry:n,planName:a,planDescription:i});case"Auto renewal on":return l.createAutoRenewOnMessage({expiry:n,benefitName:o});case"Expires":return l.createExpiryMessage(n);case"Error: non defined status":default:return null}},mrs=e=>{const{customerSubscription:{subscription:t},metadata:{isPlanRenewable:n,isPlanAutoRenewing:o,isPaymentMethodLinkedToPlan:r,isSubscriptionPlanTransitioning:a,isFreeTrialAvailable:i,isReauthRequired:l}}=e;return i?o?"Free trial auto renew on":"Free trial auto renew off":a?o?"Plan will transition":"Auto switch current plan":l?"ReAuth required":t.nextRenewal&&!t.nextRenewal.planId?"Plan terminated":t.status!=="ACTIVE"?"Pending":o&&!r?"Auto renewal has no wallet item":n?o?"Auto renewal on":"Auto renewal off":t.expiry?"Expires":"Error: non defined status"};function hrs(){return f(cr)}function grs(e){return{expiry:e.customerSubscription.subscription.expiry,benefit:{name:e.customerSubscription.benefit.name,description:e.customerSubscription.benefit.description},plan:{name:e.customerSubscription.plan.name,description:e.customerSubscription.plan.description}}}function Ers(){const e=hrs();return{messages:Fie(e),getStatusMesssage:t=>prs({calendarDateFormat:e,status:mrs(t),info:grs(t)})}}function frs({subscription:e,strategy:t}){const{customerSubscription:{subscription:{nextRenewal:n}},metadata:{isFreeTrialAvailable:o}}=e,{messages:r,getStatusMesssage:a}=Ers();switch(t){case"TRANSITION":return{description:n.description,status:r.createAutoSwitchNewPlan(e.customerSubscription.subscription.expiry)};case"DEFAULT":default:return{description:o?e.customerSubscription.plan?.freeTrial?.text??"":e.customerSubscription.plan.description,status:a(e)}}}function Q1({subscription:e,showTransitioningInfo:t}){const{description:n,status:o}=frs({subscription:e,strategy:t?"TRANSITION":"DEFAULT"});return s.jsxs(h.Fragment,{children:[s.jsx("div",{"data-test":"transitionPlanDescription",className:"salt-m-b--2",children:n}),s.jsx("div",{className:"salt-m-b--2",children:s.jsx(b,{id:"settings.delivery.pass.subscription.card"})}),s.jsx(irs,{subscription:e}),e.metadata.filteredAddresses.length>0&&s.jsx(lrs,{addresses:e.metadata.filteredAddresses}),o]})}const iR=v.div`
    color: #ddd;
`;function yrs({name:e,description:t,grey:n}){return s.jsxs("div",{className:"salt-m-b--2",children:[s.jsx(O,{size:"l",bold:!0,children:n?s.jsx(iR,{children:e}):e}),s.jsx(O,{className:"salt-d--block",children:n?s.jsx(iR,{children:t}):t})]})}const Irs=e=>{const t=Vt(),n=Vt(e).diff(t,"d");return String(n)};function Bie({date:e,name:t,translationKey:n}){return s.jsx(b,{id:n,values:{name:t,days:Irs(e)}})}function Uie({benefit:e,planName:t,disabled:n}){const o=()=>s.jsxs(Oe.Action.Header,{children:[s.jsx(pe,{name:"delivery_pass",height:24,width:24}),s.jsx(Oe.Action.HeaderText,{as:"h3",singleLine:!0,children:t})]});return s.jsxs(h.Fragment,{children:[s.jsx(yrs,{name:e.name,description:e.description,grey:n??!1}),n?s.jsx(iR,{children:o()}):o()]})}function Srs({subscription:{customerSubscription:{benefit:e,plan:t,subscription:n},metadata:{isFreeTrialAvailable:o,filteredAddresses:r}},getPlanName:a}){return s.jsx(Uie,{disabled:r.length===0,benefit:{name:o?s.jsx(Bie,{name:e.name,translationKey:"delivery.pass.plan.free.trial.name",date:n.expiry}):e.name,description:e.description},planName:a(t)})}const Crs=({subscription:{customerSubscription:{benefit:e},metadata:{filteredAddresses:t}},subscriptionTransitioningPlan:n,getPlanName:o})=>s.jsx(Uie,{disabled:t.length===0,benefit:{name:e.name,description:e.description},planName:o(n)}),vrs=({getPlanNameStrategy:e})=>({createCurrentPlan:t=>Srs({...t,getPlanName:e}),createNextPlan:t=>Crs({...t,getPlanName:e})});function Trs({name:e,amount:t,currency:n}){const o=He();return s.jsxs(h.Fragment,{children:[e," -","",o({amount:t,currency:n})]})}function _rs(e){return t=>s.jsx(Trs,{...e(t),name:t.name})}function brs({onClick:e,subscriptionId:t}){return s.jsx(x,{className:"salt-m-b--2",asChild:!0,onClick:e,intent:"secondary",fill:!0,size:"m","data-test":"view-receipt-button",children:s.jsx(tt,{intent:"ghost",href:vqe(t),target:"_blank",children:s.jsxs(x.Text,{children:[s.jsx(pe,{className:"salt-d--inline-block salt-m-r--1",height:14,width:14,verticalAlign:"middle",name:"pdf"}),s.jsx(b,{id:"settings.delivery.pass.subscription.view.receipt.button"})]})})})}function xrs({subscription:e}){const t=F(),n=()=>{t(U.analyticsEvent({type:Xn.DELIVERY_PASS_RECEIPT_BUTTON_CLICKED}))},{hasReceipt:o,subscriptionId:r}=e.customerSubscription.subscription;return o?s.jsx(brs,{subscriptionId:r,onClick:n}):null}function Ars({onClick:e,isDisabled:t}){return s.jsx("div",{className:"salt-m-b--2",children:s.jsx(x,{intent:"secondary",fill:!0,onClick:e,...t?{disabled:!0}:{},"data-test":"change-payment-method-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.subscription.change.payment.method.open.button"})})})})}const Rrs=()=>{const e=F();return()=>{e(U.analyticsEvent({type:Xn.EDIT_PAYMENT_DETAILS_BUTTON_CLICKED}))}};function Drs({subscription:e,onReEnableSubscription:t}){const n=Rrs(),o=e.metadata.filteredAddresses.length===0;return e.metadata.canChangePaymentMethod?s.jsx(Ars,{isDisabled:o,onClick:()=>(n(),t())}):null}function j_(){const e=F(),t=f(n=>n.control.modal);return{isOpen:n=>t[n]?.isOpen??!1,getOptions:n=>t[n]?.options??void 0,closeModal:()=>e(J.closeModal()),openFailureModal:()=>e(J.openModal("deliveryPassSubscriptionFailure")),openPaymentPspModal:()=>e(J.openModal("paymentPsp")),openSubscriptionEnableModal:n=>e(J.openModal("deliveryPassSubscriptionEnable",n)),openModal:(n,o)=>e(J.openModal(n,o))}}function Ors(){const e=ja();return t=>e.deliveryPassEnableAutoRenew(t)}function Gie(){const e=F(),t=Ors();return{logAutoRenewalButtonClicked:()=>{e(U.analyticsEvent({type:Xn.AUTO_RENEWAL_BUTTON_CLICKED,autoRenewalStatus:"enable"}))},logAutoRenewalModalDisplayed:()=>e(U.analyticsEvent({type:Xn.ENABLE_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED,userAction:"open"})),logEnableAutoRenewAnalytics:t}}function Prs({onClick:e}){return s.jsx("div",{className:"salt-m-b--2",children:s.jsx(x,{intent:"secondary",fill:!0,onClick:e,"data-test":"autorenewal-enable-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.enable"})})})})}function Nrs({before:e,success:t}){const{logEnableAutoRenewAnalytics:n}=Gie(),{openFailureModal:o}=j_(),{enableAutoRenewal:r}=Qr.client.useHooks();return a=>(e(a.retailerSubscriptionPlanId),r(a.retailerSubscriptionPlanId).then(()=>{n(a),t(a.retailerSubscriptionPlanId)}).catch(o))}function Lrs({subscription:e,onReEnableSubscription:t}){const n=Gie(),o=j_(),{customerSubscription:{subscription:{subscriptionId:r,expiry:a},benefit:{name:i,description:l},plan:{cost:c}},metadata:{isPlanRenewable:d,isPlanAutoRenewing:u,isFreeTrialAvailable:p}}=e,g=Nrs(t);if(!(d&&!u))return null;const y={expireTime:a,benefitName:i,benefitDescription:l,isFreeTrialAvailable:p},I={retailerSubscriptionPlanId:r,price:Number(c.amount),currency:c.currency};return s.jsx(Prs,{onClick:()=>{n.logAutoRenewalButtonClicked(),p?(n.logAutoRenewalModalDisplayed(),o.openSubscriptionEnableModal({...y,reEnableSubscription:()=>g(I)})):(o.openSubscriptionEnableModal(y),g(I))}})}function krs(e){const t=F();return()=>{t(U.analyticsEvent({type:Xn.AUTO_RENEWAL_BUTTON_CLICKED,autoRenewalStatus:"cancel"})),t(U.analyticsEvent({type:Xn.CANCEL_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED,userAction:"open"})),t(J.openModal("deliveryPassSubscriptionCancel",e))}}function jrs({onClick:e}){return s.jsx("div",{className:"salt-m-b--2",children:s.jsx(x,{intent:"secondary",fill:!0,onClick:e,"data-test":"autorenewal-disable-link",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.disable"})})})})}function X1({subscription:e}){const{customerSubscription:{subscription:{expiry:t,subscriptionId:n},benefit:{name:o},plan:{name:r,freeTrial:a}},metadata:{canCancelAutoRenewal:i}}=e,l=krs({expiry:t,subscriptionId:n,planName:`${r} - ${o}`,isFreeTrial:!!a,retailerPlanId:e.customerSubscription.plan.retailerPlanId,cost:e.customerSubscription.plan.cost});return i?s.jsx(jrs,{onClick:l}):null}function Z1({chip:e,options:t,header:n,body:o,footer:r}){return s.jsxs(Oe.Action,{chip:e,...t,children:[n,s.jsx(Oe.Action.Body,{align:"left",children:o}),s.jsx(Oe.Action.Footer,{align:"left",children:r})]})}const Mrs=({onChangePaymentMethod:e,onReEnableSubscription:t,subscription:n,createPlanAmount:o,...r})=>{const{customerSubscription:{subscription:{nextRenewal:a}},metadata:{isSubscriptionPlanTransitioning:i}}=n,l=vrs({getPlanNameStrategy:_rs(o)});return s.jsxs(h.Fragment,{children:[s.jsx(Z1,{chip:eR.createCurrentPlan({isSubscriptionPlanTransitioning:i}),options:r,header:l.createCurrentPlan({subscription:n}),body:s.jsx(Q1,{subscription:n}),footer:s.jsxs(h.Fragment,{children:[s.jsx(xrs,{subscription:n}),s.jsx(Drs,{subscription:n,onReEnableSubscription:e}),s.jsx(Lrs,{subscription:n,onReEnableSubscription:t}),i?null:s.jsx(X1,{subscription:n})]})}),i&&s.jsx(Z1,{chip:eR.createNextPlan(),options:r,header:l.createNextPlan({subscription:n,subscriptionTransitioningPlan:a}),body:s.jsx(Q1,{subscription:n,showTransitioningInfo:!0}),footer:s.jsx(X1,{subscription:n})})]})},{Header:wrs,Body:Frs,Footer:Brs}=B;function Urs({isOpen:e,onRequestClose:t,header:n=s.jsx("span",{}),footer:o=s.jsx("span",{}),body:r=s.jsx("span",{})}){return s.jsxs(B,{isOpen:e,showCloseIcon:!0,onRequestClose:t,aria:{labelledby:"subscription-cancel-modal-header"},children:[s.jsx(wrs,{align:mc,children:n},"header"),s.jsx(Frs,{children:r},"body"),s.jsx(Brs,{align:mc,children:o},"footer")]})}function $ie({closeTestId:e,confirmTestId:t,onClose:n,onConfirm:o}){return s.jsxs(Q,{direction:"column-reverse",directionLgUp:"row",basis:"100%",gap:["sm"],wrapSmUp:"wrap",children:[s.jsx(rr,{children:s.jsx(x,{fill:!0,onClick:n,intent:"secondary","data-test":e,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.modal.close.button"})})})}),s.jsx(rr,{children:s.jsx(x,{fill:!0,onClick:o,intent:"primary","data-test":t,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.cancel.modal.button"})})})})]})}function Grs(){return s.jsx(ee,{as:"h2",id:"subscription-cancel-modal-header",children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.cancel.modal.title"})})}function $rs({expiry:e,dateFormat:t}){return s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},className:"salt-m-b--8",children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.cancel.modal.info"})}),s.jsx(V.Item,{colSpan:{xs:12},className:"salt-m-b--8",children:s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.cancel.modal.expiry",values:{expireTime:gt(e,t)}})})]})}function Hrs(){const e=h.useRef(null),[t,n]=h.useState(!1);return h.useLayoutEffect(()=>{const o=e.current?.textContent?.trim()??"";n(o.length>0)},[]),{hasText:t,ref:e}}function Vrs({expiry:e,dateFormat:t,planName:n}){const{hasText:o,ref:r}=Hrs(),a=s.jsx("div",{ref:r,children:s.jsx(Bie,{name:n,translationKey:"settings.delivery.pass.free.trial.cancel.auto.renew.alert",date:e})});return s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colSpan:{xs:12},className:"salt-m-b--8",children:s.jsx(b,{id:"settings.delivery.pass.free.trial.cancel.auto.renew",values:{expiryDate:gt(e,t)}})}),s.jsx(V.Item,{colSpan:{xs:12},className:"salt-m-b--4",children:s.jsx(b,{id:"settings.delivery.pass.free.trial.cancel.auto.renew.reminder"})}),o&&s.jsx(V.Item,{colSpan:{xs:12},className:"salt-m-b--4",children:s.jsx(Te,{intent:"success","data-test-type":"success","data-test":"cancelation-free-trial-alert",text:a})})]})}function Wrs(){return s.jsx(V,{className:"salt-m-b--8",flush:!0,children:s.jsx(V.Item,{colStart:{sm:2,md:3,lg:5},colSpan:{xs:12,sm:10,md:8,lg:4},children:s.jsx(Q,{justify:"center",children:s.jsx(pe,{name:"delivery_pass",height:40,width:60})})})})}function Yrs({bodyTemplate:e}){return s.jsxs(ae.Fragment,{children:[s.jsx(Wrs,{}),e]})}function qrs(e){const{actions:t,dateFormat:n,isOpen:o,modalOptions:r,isFreeTrialPlan:a}=e,i=ja(),l=()=>a?s.jsx(Vrs,{expiry:r?.expiry??"",dateFormat:n,planName:r?.planName??""}):s.jsx($rs,{expiry:r?.expiry??"",dateFormat:n}),c=()=>{const{closeModal:u,analyticsCloseModal:p}=t;u(),p()},d=()=>{const{disableAutoRenewal:u,closeModal:p,openFailureModal:g}=t,{retailerPlanId:E,cost:y}=r;u(r?.subscriptionId).then(()=>{p(),Z.success("settings.delivery.pass.subscription.auto.renew.cancel.success.toast"),i.deliveryPassCancelAutoRenew({retailerSubscriptionPlanId:E,price:Number(y.amount),currency:y.currency})}).catch(g)};return s.jsx(Urs,{isOpen:o,onRequestClose:c,header:s.jsx(Grs,{}),body:s.jsx(Yrs,{bodyTemplate:l()}),footer:s.jsx($ie,{closeTestId:"close-button",confirmTestId:"cancel-delivery-pass-button",onClose:c,onConfirm:d})})}function Krs(){const e="deliveryPassSubscriptionCancel",t=f(cr),n=f($e(e)),o=f(Yn(e)),{isFreeTrialEnabled:r}=No(),a=F(),i=()=>a(J.closeModal()),{disableAutoRenewal:l}=Qr.client.useHooks(),c=u=>a(J.openModal("deliveryPassSubscriptionFailure",u)),d=()=>a(U.analyticsEvent({type:Xn.CANCEL_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED,userAction:"close"}));return s.jsx(qrs,{actions:{openFailureModal:c,analyticsCloseModal:d,closeModal:i,disableAutoRenewal:l},dateFormat:t,isOpen:n,modalOptions:o,isFreeTrialPlan:o?.isFreeTrial&&r})}function Hie(){const e=f(cr);return{confirmationTitle:()=>s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.modal.confirmation.title"}),freeTrialEnableAutoRenew:t=>s.jsx(Mg,{id:"settings.delivery.pass.free.trial.enable.auto.renew",values:{expiryDate:gt(t,e)}}),renewalConfirmationMessage:({expireTime:t,benefitName:n,benefitDescription:o})=>s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.modal.confirmation.info",values:{expireTime:gt(t,e),planName:`${n} - ${o}`}}),modalClose:()=>s.jsx(b,{id:"settings.delivery.pass.subscription.auto.renew.modal.close.button"})}}const zrs="subscription-enable-modal-header";function Vie({title:e,topBody:t,bottomBody:n,footer:o,dataTestId:r=zrs}){return s.jsxs(h.Fragment,{children:[s.jsx(B.Header,{align:mc,children:s.jsx(ee,{as:"h2","data-test":r,id:r,children:e})},"header"),s.jsxs(B.Body,{children:[t,s.jsx(V,{flush:!0,className:"salt-m-b--4",children:s.jsx(V.Item,{colSpan:{xs:12},children:n})})]},"body"),s.jsx(B.Footer,{align:mc,children:o},"footer")]})}function Qrs({expireTime:e,onConfirm:t,onClose:n}){const o=Hie();return s.jsx(Vie,{dataTestId:"free-trial-layout",title:o.confirmationTitle(),topBody:null,bottomBody:o.freeTrialEnableAutoRenew(e),footer:s.jsx($ie,{onConfirm:t,onClose:n,closeTestId:"close-button",confirmTestId:"confirm-enable-auto-renew-button"})})}function Xrs({onClose:e,confirmationData:t}){const n=Hie();return s.jsx(Vie,{dataTestId:"default-layout",title:n.confirmationTitle(),topBody:s.jsx("div",{className:"salt-m-b--8",children:s.jsx(V,{flush:!0,children:s.jsx(V.Item,{colStart:{md:3,lg:4},colSpan:{xs:12,md:8,lg:6},children:s.jsx(Q,{justify:"center",children:s.jsx(pe,{success:!0,name:"status_yes",height:82,width:82})})})})}),bottomBody:n.renewalConfirmationMessage(t),footer:s.jsx(x,{onClick:e,intent:"primary","data-test":"close-button",children:s.jsx(x.Text,{children:n.modalClose()})})})}const Zrs="subscription-enable-modal-header",J1="deliveryPassSubscriptionEnable",Jrs=({subscriptionData:e,closeModal:t,onConfirm:n})=>e?s.jsx(ae.Fragment,{children:e.isFreeTrialAvailable?s.jsx(Qrs,{expireTime:e.expireTime,onConfirm:()=>{n?.(),t()},onClose:t}):s.jsx(Xrs,{confirmationData:e,onClose:t})}):null,eas=({closeModal:e,isFetching:t,isOpen:n=!1,subscriptionData:o,onConfirm:r})=>{const a=()=>{e()};return s.jsx(B,{isOpen:n,showCloseIcon:!0,onRequestClose:a,isLoading:t,aria:{labelledby:Zrs},children:s.jsx(Jrs,{onConfirm:r,closeModal:e,subscriptionData:o})})};function tas(){const e=F(),{isFetching:t}=Qr.client.useHooks().getComputedState(),{closeModal:n,isOpen:o,getOptions:r}=j_(),a=r(J1),i=()=>e({type:Xn.ENABLE_DELIVERY_PASS_AUTO_RENEWAL_MODAL_DISPLAYED,payload:{userAction:"close"}});return s.jsx(eas,{closeModal:()=>{n(),i()},isFetching:t,isOpen:o(J1),onConfirm:a?.reEnableSubscription,subscriptionData:a})}const eH="subscription-failure-modal-header",sas=({actions:e,isOpen:t=!1})=>s.jsxs(B,{isOpen:t,aria:{labelledby:eH},children:[s.jsx(B.Header,{align:mc,"data-test":"cancel-delivery-pass-failure-header",children:s.jsx(ee,{as:"h2",id:eH,children:s.jsx(b,{id:"settings.delivery.pass.subscription.failure.modal.title"})})},"header"),s.jsx(B.Body,{children:s.jsxs(V,{flush:!0,children:[s.jsx(V.Item,{colStart:{xs:2,md:3,lg:4},colSpan:{xs:10,md:8,lg:6},className:"salt-m-b--8",children:s.jsx(Q,{justify:"center",children:s.jsx(pe,{error:!0,name:"status_no",height:100,width:100})})}),s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(Te,{showIcon:!1,text:s.jsx(b,{id:"settings.delivery.pass.subscription.failure.modal.body"})})})]})},"body"),s.jsx(B.Footer,{align:mc,children:s.jsx(x,{onClick:e.closeModal,intent:"primary","data-test":"close-button",fill:!0,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.subscription.failure.modal.close"})})})},"footer")]}),nas=e=>({isOpen:$e("deliveryPassSubscriptionFailure")(e)}),oas=e=>({actions:vl({closeModal:J.closeModal},e)}),ras=we(nas,oas)(sas),aas=()=>{const e=f(Gd),t=f(D("mfm")),n=F(),o=Ge();return()=>n(e&&!t?mne.redirectToAddAddressForm(o,window.location.pathname):J.openModal("addAddress"))};function Wie(){f(t=>t);const e={dispatch:F()};return()=>Yie({context:{store:e}})}function ias(){const e=f(Rt),t=Wie();h.useEffect(()=>{e||t()},[])}function las(){const e=f(bD),{isFetching:t}=Xr.client.useHooks().getComputedState(),{isFetching:n}=Ln.client.useHooks().getComputedState(),{isFetching:o}=Qr.client.useHooks().getComputedState();return t||n||o||e}async function Yie({context:{store:{dispatch:e}}}){return Promise.all([Xr.server.fetch(e).then(t=>Ln.server.fetch(e,{benefitGroupId:t?.payload?.responseData?.[0]?.benefitGroupId})),e(eo.getCustomerAddresses()),Qr.server.fetch(e)])}const cas="add-address-button",vx={NO_ADDRESS_LABEL:"settings.delivery.pass.free.trial.no.address",NEW_ADDRESS_LABEL:"settings.delivery.pass.new.address.label",NEW_ADDRESS_BUTTON:"settings.delivery.pass.new.address.button.label"},das=()=>{const e=Wie(),{isFreeTrialEnabled:t}=No(),{isFreeTrial:n}=Ln.client.useHooks().getComputedState().metadata,o=t&&n,r=Bs(),a=aas();return s.jsxs(h.Fragment,{children:[s.jsx(p_,{submitAddAddress:e}),s.jsx("div",{className:"salt-m-b--2",children:o?s.jsx(O,{bold:!0,children:s.jsx(b,{id:vx.NO_ADDRESS_LABEL})}):s.jsx(O,{children:s.jsx(b,{id:vx.NEW_ADDRESS_LABEL})})}),s.jsx(x,{"data-test":cas,onClick:()=>{r.addAddressButtonClicked(),a()},intent:"primary",children:s.jsx(x.Text,{children:s.jsx(b,{id:vx.NEW_ADDRESS_BUTTON})})})]})};function uas(){const e=F(),t=Ge();return()=>{e(U.analyticsEvent({type:bs.VIEW_ALL_PLANS_BUTTON_CLICKED})),t(Lc())}}const pas="subscription-link-button";function mas(){const e=uas();return s.jsx(x,{onClick:e,intent:"primary","data-test":pas,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.pass.see.more"})})})}const has=()=>{const{isFetching:e,data:t}=Ln.client.useHooks().getComputedState(),{data:n,isFetching:o}=Xr.client.useHooks().getComputedState(),{isDeliveryPassByStoreEnabled:r}=No(),a=!!n.length,i=n.length>0&&(t?.benefits?.length??0)>0,l=(f(cu)?.data??[]).some(c=>c.deliverable);return o||e?"loading":r&&!l&&!i?"no-passes":a?i?"buy-passes":"no-passes":"add-address"};function gas(){switch(has()){case"loading":return null;case"add-address":return s.jsx(das,{});case"buy-passes":return s.jsx(mas,{});case"no-passes":default:return s.jsx(lM,{})}}function Eas(){const{hasCustomerSubscriptions:e,isSubscriptionAutoRenewalEnabled:t}=Qr.client.useHooks().getComputedState().metadata,{data:n}=Ln.client.useHooks().getComputedState();return s.jsxs(ae.Fragment,{children:[t&&s.jsx(v_,{texts:n?{terms:n?.terms,cancellation:n?.cancellation}:void 0}),t&&e&&n&&s.jsx("br",{}),e&&n&&s.jsx(tae,{benefitGroupName:n.name})]})}const fas=()=>s.jsxs(h.Fragment,{children:[s.jsx("div",{children:s.jsx(Nt,{id:"settings.delivery.pass.free.trial.subtitle.text.first.part"})}),s.jsx("br",{}),s.jsx("div",{children:s.jsx(Nt,{id:"settings.delivery.pass.free.trial.subtitle.text.second.part"})})]});function yas({isTaxGrossDisplayed:e,freeTrialMessage:t}){return s.jsxs(ae.Fragment,{children:[s.jsxs(V,{flush:!0,className:"salt-m-b--2",children:[s.jsx(V.Item,{colSpan:{xs:12},children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"settings.delivery.pass.page.title"})})}),e&&s.jsx(V.Item,{colSpan:{xs:12,sm:8},children:s.jsx(Q,{align:"center",children:s.jsx(O,{size:"m",asChild:!0,children:s.jsx("h2",{children:s.jsx(Nt,{id:"delivery.pass.prices.tax.inclusive"})})})})})]}),s.jsxs("div",{className:"salt-m-b--8",children:[!t&&s.jsx(b,{id:"settings.delivery.pass.page.subtitle"}),t]})]})}function Ias(){const{isFreeTrialEnabled:e}=No(),{data:t,metadata:{isFreeTrial:n,benefitGroupSubscription:o}}=Ln.client.useHooks().getComputedState(),r=!!t?.displayTaxInformationGross,a=n&&e&&!o;return s.jsx(yas,{isTaxGrossDisplayed:r,freeTrialMessage:a?s.jsx(fas,{}):null})}const Sas=({onChangePaymentMethod:e,onReEnableSubscription:t})=>{const{data:n,metadata:{hasCustomerSubscriptions:o}}=Qr.client.useHooks().getComputedState(),r=S_();return s.jsxs(h.Fragment,{children:[s.jsx(Ias,{}),s.jsx("div",{className:"salt-m-b--8",children:o&&s.jsx(Oe.Collection,{xs:1,sm:1,md:2,lg:3,children:(n??[]).map(a=>s.jsx(Mrs,{createPlanAmount:i=>r(i).toCost(),subscription:a,onChangePaymentMethod:()=>e(a.customerSubscription.subscription),onReEnableSubscription:t},a.customerSubscription.subscription.subscriptionId))})}),s.jsx(gas,{}),s.jsx("div",{className:"salt-m-y--8",children:s.jsx(Eas,{})}),o&&s.jsxs(h.Fragment,{children:[s.jsx(tas,{}),s.jsx(Krs,{}),s.jsx(ras,{})]})]})};function Cas(){const e=L(),{formatMessage:t}=e;return{updatePaymentMethodTitle:t("checkout.summary.payment.method.title"),updatePaymentMethodButton:t("settings.delivery.pass.subscription.change.payment.method.modal.update.button")}}function fw(){const e=f(At),t=f(Do),n=f(Na);return{basePath:e??"",clientRouteId:t,csrfToken:n}}function vas({basePath:e,subscriptionId:t}){return go({basePath:e,target:`/customer/v1/benefit-groups/delivery-pass/subscription/${t}/walletItemId`})}function Tas({walletItemId:e,subscriptionId:t,onFetchError:n,onFetchSuccess:o,onFetchFinally:r,fetchOptions:{basePath:a,clientRouteId:i,csrfToken:l}}){return fetch(vas({basePath:a,subscriptionId:t}),Jr({method:"PUT",body:JSON.stringify({walletItemId:e}),clientRouteId:i,csrfToken:l,contentType:"application/json; charset=utf-8"})).then(c=>{c.ok?o():n()}).catch(()=>{n()}).finally(()=>{r()})}function _as(){const e=fw();return t=>Tas({...t,fetchOptions:e})}function bas({resultToken:e,onSuccess:t,onError:n,fetchOptions:o}){const{basePath:r,clientRouteId:a,csrfToken:i}=o,l=go({basePath:r,target:"/customer/v2/benefit-groups/delivery-pass/subscription/re-auth/validate"});return fetch(l,Jr({method:"POST",body:JSON.stringify({resultToken:e}),clientRouteId:a,csrfToken:i,contentType:"application/json; charset=utf-8"})).then(c=>{if(c.ok)t();else throw new Error(c.statusText)}).catch(n)}function xas(){const e=fw();return t=>bas({...t,fetchOptions:e})}function Aas(e){return go({basePath:e,target:"/customer/v2/benefit-groups/delivery-pass/subscription/reauth"})}function Ras({subscriptionId:e,walletItemId:t,fetchOptions:{basePath:n,clientRouteId:o,csrfToken:r}}){return fetch(Aas(n),Jr({method:"POST",body:JSON.stringify({saleId:e,checkoutUrl:`${window.location.origin}${n}${ar()}`,walletItemId:t,source:"web"}),clientRouteId:o,csrfToken:r,contentType:"application/json; charset=utf-8"})).then(a=>{if(a.ok)return a.json();throw new Error(a.statusText)})}function Das(){const e=fw();return t=>Ras({...t,fetchOptions:e})}function Oas(){const{is3dsSubscriptionsFlowEnabled:e}=No(),t=Das(),n=_as(),o=xas(),{walletItemUpdated:r,fetch:a}=Qr.client.useHooks(),{closeModal:i}=j_(),l=c=>{Z.success("settings.delivery.pass.update.payment.method.success.notification"),r(c),a()};return{updatePaymentMethod:c=>d=>e?t({subscriptionId:c,walletItemId:d}).then(({url:u,walletItemId:p})=>u||(l(p),i())):n({walletItemId:d,subscriptionId:c,onFetchSuccess:()=>l(d),onFetchError:()=>Z.error("settings.delivery.pass.update.payment.method.failure.notification"),onFetchFinally:i}),onAuth:{completed:({onSuccess:c,onError:d})=>({resultToken:u})=>(i(),u?o({resultToken:u,onSuccess:()=>{c(),Z.success("settings.delivery.pass.update.payment.method.success.notification"),a()},onError:()=>{d(),Z.error("settings.delivery.pass.update.payment.method.failure.notification")}}):(Z.error("settings.delivery.pass.update.payment.method.failure.notification"),Promise.resolve())),failure:c=>{c&&Ue.api.pushError(c),i(),Z.error("toast.notification.generic.error")}}}}const Pas=no.Item;function qie(){const e=F();return()=>{e(U.analyticsEvent({type:Xn.DELIVERY_PASS_SETTINGS_TAB_CLICKED}))}}function Kie(){return L().formatMessage("settings.delivery.pass.heading")}function Nas({path:e}){const{isSubscriptionEnabled:t}=No(),n=Kie(),o=qie();return t?s.jsx(Pas,{children:s.jsx(Ye,{bold:e===ar(),onClick:o,to:ar(),"data-test":"delivery-pass-link",children:n})}):null}function Las(){const{isSubscriptionEnabled:e}=No(),t=Kie(),n=qie();return{createOption:()=>e?s.jsx("option",{value:ar(),children:t}):null,handleDeliveryPassChange:o=>{o.target.value===ar()&&n()}}}function kas(e){const{fundingInstrumentId:t,walletItem:n,walletItemId:o}=e;return{walletItemId:n?.walletItemId||o,fundingInstrumentId:t}}function zie(){const{setSelectedSubscriptionCard:e,getComputedState:t}=Qr.client.useHooks(),{metadata:{hasCustomerSubscriptions:n}}=t(),{data:o}=Xr.client.useHooks().getComputedState(),r=!!o.length,a=RM(),i=sae();ias();const l=las(),{updatePaymentMethod:c,onAuth:{completed:d,failure:u}}=Oas(),[p,g]=h.useState(!1),[E,y]=h.useState(!1),[I,S]=h.useState(void 0),[C,T]=h.useState({}),{data:_}=Ln.client.useHooks().getComputedState(),A=!!_?.displayTaxInformationGross,R=Cas(),P=l||E||p;return!P&&!n&&r&&!a?s.jsx(En,{to:Lc()}):s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.delivery.pass.page.title"}),P?s.jsx(Oe.Action.Skeleton,{"data-test":"settings-delivery-pass-skeleton"}):s.jsx(Sas,{onChangePaymentMethod:N=>{const{subscriptionId:k,paymentInformation:M}=N;S(k),T(kas(N)),e(M),i()},onReEnableSubscription:{before:()=>g(!0),success:()=>g(!1)}}),s.jsx(jM,{modalsTitle:R.updatePaymentMethodTitle,isTaxGrossDisplayed:A,confirmPaymentMethodText:R.updatePaymentMethodButton,onInitiatePayment:c(I),onAuthCompleted:d({onSuccess:()=>y(!1),onError:()=>y(!1)}),onAuthFailure:u,preselectedWalletItem:C})]})}zie.fetchData=Yie;const jas="web_customer_preference_ws",Qie="/v1/customer-preferences",Xie={service:jas,pathPrefix:{client:"/api/customer-preferences",server:"/core-api"}},Zie=({actionType:e,url:t,options:n,service:o,pathPrefix:r})=>({type:"API",payload:{url:t,...!!n&&{options:n},...se(e),...!!o&&{service:o},...!!r&&{pathPrefix:r}}}),Mas=({actionType:e,preferenceKey:t})=>n=>Zie({actionType:e,url:Qie,...Xie,options:{body:{preferenceKey:t,preferenceValue:n},method:"PUT"}}),was=({actionType:e,preferenceKey:t})=>()=>Zie({actionType:e,url:`${Qie}/${t}`,...Xie}),Fas=was({actionType:"GET_DELIVERY_PREFERENCES",preferenceKey:"raw-produce-segregation"}),Bas=Mas({actionType:"UPDATE_DELIVERY_PREFERENCES",preferenceKey:"raw-produce-segregation"}),Jie={getDeliveryPreferences:Fas,updateDeliveryPreferences:Bas},Uas=async({context:{store:e}})=>e.dispatch(yw()),yw=()=>async e=>{try{await e(Jie.getDeliveryPreferences())}catch(t){Ue.api.pushError(t instanceof Error?t:new Error(`fetchDeliveryPreferencesService error: ${JSON.stringify(t)}`))}},Gas=()=>{const e=f(P5e),t=F();return{deliveryPreferences:e,onFetchDeliveryPreferences:h.useCallback(()=>t(yw()),[t])}},$as=()=>{const e=F();return h.useCallback(t=>e(n=>n(Jie.updateDeliveryPreferences(t["raw-produce-segregation"])).then(()=>{n(yw()),Promise.resolve()})),[e])},ele=()=>{const e=Dn(),t=f(Rt),{formatMessage:n}=L(),o=h.useMemo(()=>n("customer-preference.delivery.raw-produce-segregation.description").replace(/\n/g,"<br />"),[]),{deliveryPreferences:r,onFetchDeliveryPreferences:a}=Gas(),i=$as(),{preferences:l,fetchError:c,lastUpdated:d}=r;h.useEffect(()=>{(!t||!d)&&a()},[]);const u=g=>{Z[g](`settings.update.delivery.preferences.${g}`)},p=async g=>{try{await i(g),u(oU.SUCCESS)}catch{u(oU.ERROR)}};return s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.delivery.preferences.page.title"}),c?s.jsx(Fc,{action:a}):s.jsxs(ae.Fragment,{children:[s.jsx(ee,{as:"h2",className:"salt-m-b--4",children:s.jsx(b,{id:"settings.delivery.heading"})}),l&&Object.keys(l).length>0&&s.jsx(On,{...e,children:s.jsxs("form",{"data-test":"section-preferences",onSubmit:e.handleSubmit(p),children:[s.jsx(h_,{html:`<p>${o}</p>`}),Object.keys(l).map(g=>{const{preferenceKey:E,preferenceValue:y}=l[g];return s.jsx(zd,{control:e.control,name:E,defaultValue:y,render:({field:I})=>s.jsx(Lo,{...I,"data-test":E,name:E,value:E,input:{checked:I.value},label:n("customer-preference.delivery.raw-produce-segregation.text"),bold:!0,last:!1,whiteSpace:"pre-wrap"})},E)}),s.jsx("div",{className:"salt-m-b--8",children:s.jsx(x,{intent:"primary",type:"submit","data-test":"preferences-save-button",fill:!1,disabled:!d,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.delivery.preferences.save"})})})})]})})]})]})};ele.fetchData=Uas;const tH=()=>async e=>{try{await e(gd.getAccessibilitySettings())}catch(t){Ue.api.pushError(t instanceof Error?t:new Error(JSON.stringify(t)))}},Has=({defaultNotificationDuration:e})=>{const{formatMessage:t}=L(),n=F(),o=({string:d,duration:u,displayAsNumberOfSeconds:p})=>t(d,p?{notificationDuration:u}:void 0),a={name:(()=>{const d=xB.find(u=>u.duration===e);return d?o(d):""})(),value:e},i=xB.map(d=>({name:o(d),value:d.duration})),l=d=>{Z[d](`settings.accessibility.notification.update.${d}`)},c=async d=>{d.preventDefault();const u=d.currentTarget,p=new FormData(u),g=[{preferenceKey:pv,preferenceValue:p.get("notification")?.toString()??null}];try{await n(gd.updateAccessibilitySettings(g)),await n(gd.getAccessibilitySettings()),l("success")}catch{l("error")}};return s.jsxs(fs,{"data-test":"accessibility-settings-form",onSubmit:c,children:[s.jsx(fs.DropdownSelect,{options:i,name:"notification",label:{text:t("settings.accessibility.notification.heading"),isVisuallyConcealed:!0},defaultValue:a,"data-test":"notification-duration-select-test"}),s.jsx(x,{intent:"primary",type:"submit",fill:!1,className:"salt-m-t--2",children:s.jsx(x.Text,{children:t("settings.accessibility.update-details")})})]})},Vas=()=>{const e=f(Rt),t=F(),n=f(Vz),{data:o,lastUpdated:r,fetchError:a}=n,i=o[pv]?.preferenceValue??JI;return h.useEffect(()=>{(!e||!r)&&t(tH())},[]),s.jsx(V,{children:s.jsxs(V.Item,{colSpan:{xs:12,sm:11,md:8,lg:4},children:[s.jsx(bt,{title:"settings.accessibility.title"}),a?s.jsx(Fc,{action:()=>t(tH())}):s.jsxs(ae.Fragment,{children:[s.jsx(O,{size:"l",bold:!0,className:"salt-m-b--2 salt-d--block",children:s.jsx(b,{id:"settings.accessibility.notification.heading"})}),s.jsx(O,{className:"salt-m-b--2 salt-d--block",children:s.jsx(b,{id:"settings.accessibility.notification.description"})}),s.jsx(Has,{defaultNotificationDuration:i})]})]})})},Was=()=>{const{launchChat:e,loading:t}=Xj();return s.jsx(V,{flush:!0,className:"salt-m-y--4",children:s.jsx(V.Item,{colStart:{sm:2,md:3,lg:4},colSpan:{xs:12,sm:8,md:6,lg:4},children:s.jsx(Os,{title:"settings.chat.title",description:"settings.chat.description",titleIcon:"chat",primaryButton:{text:"settings.chat.button",onClick:e,loading:t}})})})},{Header:Yas,Body:qas,Footer:Kas}=B,zas=({address:e,onClose:t,headerLabelId:n,onSubmit:o,modalLeftAlignEnabled:r})=>{const a=Dn({mode:"onChange",defaultValues:e}),i=c=>{c.preventDefault();const d=a.getValues();d.nickname.trim()&&o(d)},l=!f(D("daddi"));return s.jsx(On,{...a,children:s.jsxs("form",{"data-test":"edit-address-modal-form",onSubmit:i,children:[s.jsx(Yas,{align:r?"left":"center",children:s.jsx(ee,{as:"h2",id:n,"data-test":n,children:s.jsx(b,{id:"settings.address.book.edit.modal.title"})})}),s.jsxs(qas,{children:[s.jsx(zN,{}),l&&s.jsx(iT,{})]}),s.jsxs(Kas,{align:r?"left":"center",children:[s.jsx(x,{fill:!0,intent:"secondary",onClick:t,"data-test":"edit-address-cancel-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.edit.modal.cancel"})})}),s.jsx(x,{className:"salt-m-l--2",fill:!0,type:"submit",intent:"primary","data-test":"edit-address-submit-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.edit.modal.complete"})})})]})]})})},Qas=({id:e,nickname:t,notes:n})=>async(o,r)=>{const i=cu(r()).data.find(c=>c.id===e);if(i?.notes!==n||i?.nickname!==t)try{try{await o(wI.updateCustomerAddress({id:e,nickname:t,notes:n}));const c={event:"event",eventCategory:"Settings",eventAction:"UPDATE_CUSTOMER_ADDRESS_SUCCESS",eventLabel:"Not Set"};return te.sendEvent({GA:c,WA:null}),Z.success("settings.address.book.edit.modal.update.success"),await o(eo.getCustomerAddresses())}catch{const c={event:"event",eventCategory:"Settings",eventAction:"UPDATE_CUSTOMER_ADDRESS_ERROR",eventLabel:"Not Set"};te.sendEvent({GA:c,WA:null}),Z.error("settings.address.book.edit.modal.notes.error")}}finally{return await o(J.closeModal())}return o(J.closeModal())},Xas={updateCustomerAddress:Qas},Zas=D("m.la.h"),sH="edit-address-modal-header",Jas=({address:e})=>{const t=Bs(),n=F(),o=f($e("editAddress")),r=f(Zas),a=h.useCallback(l=>{t.updateAddress(),n(Xas.updateCustomerAddress(l))},[]),i=h.useCallback(()=>{n(J.closeModal())},[]);return s.jsx(B,{isOpen:o,onRequestClose:i,aria:{labelledby:sH},children:s.jsx(zas,{address:e,onClose:i,onSubmit:a,headerLabelId:sH,modalLeftAlignEnabled:r})})},eis=e=>t=>t(FI.removeCustomerAddress(e)).then(()=>{Z.success("settings.address.book.remove.modal.success");const n={event:"event",eventCategory:"Settings",eventAction:"REMOVE_CUSTOMER_ADDRESS_SUCCESS",eventLabel:"Not Set"};te.sendEvent({GA:n,WA:null})}).catch(n=>{const o=n.message&&AC(n.message)?n.message:"settings.address.book.remove.modal.error";Z.error(o);const r={event:"event",eventCategory:"Settings",eventAction:"REMOVE_CUSTOMER_ADDRESS_ERROR",eventLabel:"Not Set"};te.sendEvent({GA:r,WA:null})}),tis={removeCustomerAddress:eis},sis=v.strong`
    display: flex;
    align-items: center;
    margin-block-end: 6px;
`,nis=v.span`
    display: block;
    margin-inline-start: 6px;
`,ois=v.div`
    margin-block-end: 16px;
`,tle=({slot:e})=>{const t=f(Mt);return s.jsxs("div",{"data-test":"basket-slot-warning",children:[s.jsxs(sis,{children:[s.jsx(pe,{name:"info_default"}),s.jsx(nis,{children:s.jsx(b,{id:"settings.address.book.remove.modal.slot.warning.title"})})]}),s.jsxs(ois,{children:[s.jsx(b,{id:"settings.address.book.remove.modal.slot.warning.description"})," ",s.jsx("span",{"data-test":"zone-date-time-interval",children:s.jsx(qn,{dateIsoFrom:e.start,dateIsoTo:e.end,timeZoneId:e.timeZoneId,dateFormat:Sr,timeFormat:t})})]})]})};tle.propTypes={slot:m.shape({start:m.string.isRequired,end:m.string.isRequired,timeZoneId:m.string.isRequired}).isRequired};const ris=(e,t)=>{const n=e?.id,o=t?.addressId,r=a=>typeof a=="string"&&a.length>0;return r(n)&&r(o)?n===o:!1},ais=D("m.la.h"),iis={isOpen:m.bool,actions:m.shape({closeModal:m.func.isRequired,removeCustomerAddress:m.func.isRequired}).isRequired,slot:m.shape({addressId:m.string.isRequired,displayAddress:m.string.isRequired,start:m.string.isRequired,end:m.string.isRequired,deliveryType:m.string.isRequired,nickname:m.string.isRequired,timeZoneId:m.string.isRequired,notes:m.string.isRequired,expiryTime:m.string.isRequired}),address:m.shape({id:m.string,addressLine:m.string,nickname:m.string,additionalInformation:m.string}),modalLeftAlignEnabled:m.bool,sendAnalytics:m.shape({removeAddress:m.func.isRequired}).isRequired},lis={address:{},isOpen:!1,modalLeftAlignEnabled:!1,slot:{addressId:"",displayAddress:"",start:"",end:"",deliveryType:"",nickname:"",timeZoneId:"",notes:"",expiryTime:""}},Iw=({actions:{removeCustomerAddress:e,closeModal:t},isOpen:n,address:o,modalLeftAlignEnabled:r,slot:a,sendAnalytics:i})=>{const l=Dd(()=>{e(o.id).then(()=>{i.removeAddress(),t()})},200),c="remove-address-modal-header",d=ris(o,a);return s.jsxs(B,{isOpen:n,onRequestClose:t,aria:{labelledby:c},children:[s.jsx(B.Header,{align:r?"left":"center",children:s.jsx(ee,{as:"h2",id:c,"data-test":c,children:s.jsx(b,{id:"settings.address.book.remove.modal.title"})})}),s.jsxs(B.Body,{children:[d?s.jsx(tle,{slot:a}):null,s.jsxs(Q,{direction:"column",gap:["sm"],children:[s.jsx(O,{"data-pii":"true",as:"strong",bold:!0,children:o.nickname}),s.jsx(O,{"data-pii":"true",children:o.addressLine}),o.additionalInformation&&s.jsx(O,{"data-pii":"true",children:o.additionalInformation})]})]}),s.jsx(B.Footer,{className:"salt-d--block",align:r?"left":"center",children:s.jsxs(Q,{direction:"column-reverse",directionSmUp:"row",wrap:"nowrap",gap:["sm"],children:[s.jsx(x,{fill:!0,intent:"secondary",onClick:l,"data-test":"remove-address-remove-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.remove.modal.confirm"})})}),s.jsx(x,{fill:!0,intent:"primary",onClick:t,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.button.cancel"})})})]})})]})};Iw.defaultProps=lis;Iw.propTypes=iis;const cis=e=>({isOpen:$e("removeAddress")(e),modalLeftAlignEnabled:ais(e),slot:xn(e)}),dis=st({closeModal:J.closeModal,removeCustomerAddress:tis.removeCustomerAddress}),uis=we(cis,dis)(Iw);function sle({onClick:e}){return s.jsx(x,{intent:"secondary","data-test":"addresses-add-button",onClick:e,children:s.jsx(x.Text,{children:s.jsx(b,{id:"addresses.add.address"})})})}sle.propTypes={onClick:m.func.isRequired};function pis(){const{status:e,value:t}=Nu();return e==="NOT_READY"?null:s.jsx(sle,{onClick:t})}nle.propTypes={address:m.shape({deliverable:m.bool,nickname:m.string,addressLine:m.string,additionalInformation:m.string}).isRequired,removable:m.bool.isRequired,handlers:m.shape({removeAddress:m.func,editAddress:m.func}).isRequired};const mis=v.div`
    display: grid;
    align-items: center;
    grid-template-columns: 1fr;
    gap: var(--salt-spacing-2);

    ${re.smUp`
    grid-template-columns: repeat(auto-fit, minmax(${$(100)}, 1fr));
    `}
`,his=v(Oe.Action.HeaderText)`
    overflow: hidden;
    text-overflow: ellipsis;
`;function nle({address:e,handlers:{removeAddress:t,editAddress:n},removable:o}){const r=L();return s.jsxs(ae.Fragment,{children:[s.jsx(Oe.Action.Header,{"data-pii":"true","data-test":"addresses-nickname-title",children:s.jsx(his,{as:"h3",children:e.nickname})}),s.jsxs(Oe.Action.Body,{children:[s.jsx(O,{"data-pii":"true",children:e.addressLine}),e.additionalInformation&&s.jsx(O,{"data-pii":"true",className:"salt-d--block",children:e.additionalInformation}),e.deliverable===!1&&s.jsx("div",{className:"salt-p-t--2",children:s.jsx(Te,{intent:"warning",size:"s",text:s.jsx(b,{id:"settings.addresses.alert.nondeliverable"})})})]}),s.jsx(Oe.Action.Footer,{children:s.jsxs(mis,{children:[o?s.jsxs(x,{intent:"secondary","aria-labelledby":r.formatMessage("settings.address.book.remove.address.alternative",{addressNickName:e.nickname}),onClick:()=>t(e),"data-test":"addresses-remove-button",children:[s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.remove.address"})}),s.jsx(ie,{children:s.jsx(b,{id:"settings.address.book.remove.address.a11y",values:{addressNickName:e.nickname}})})]}):null,s.jsxs(x,{intent:"secondary","aria-labelledby":r.formatMessage("settings.address.book.edit.address.alternative",{addressNickName:e.nickname}),onClick:()=>n(e),"data-test":"addresses-edit-button",children:[s.jsx(x.Text,{children:s.jsx(b,{id:"settings.address.book.edit.address"})}),s.jsx(ie,{children:s.jsx(b,{id:"settings.address.book.edit.address.a11y",values:{addressNickName:e.nickname}})})]})]})})]})}const gis=({editAddress:e,removeAddress:t,address:n,removable:o,...r})=>{const a=()=>{switch(n.type){case"ADD_ADDRESS":return s.jsx(Oe.Action,{"data-test":"address-item-add-address",...r,children:s.jsx(pis,{})});case"PLACEHOLDER":return s.jsx(Oe.Action.Skeleton,{"data-test":"address-item-placeholder"});default:return s.jsx(Oe.Action,{muted:n.deliverable===!1,"data-test":"addresses-address-card",...r,children:s.jsx(nle,{removable:o,address:n,handlers:{editAddress:e,removeAddress:t}})})}};return s.jsx(ae.Fragment,{children:a()})},Eis=(e=3)=>Array.from(Array(e),(t,n)=>({id:`${n}`,type:"PLACEHOLDER"})),fis=()=>({id:"99",type:"ADD_ADDRESS"}),yis=({editAddress:e,removeAddress:t,addresses:n,getCustomerAddresses:o,addressToEdit:r,addressToRemove:a,selectedDeliveryDestination:i,submitAddAddress:l})=>{const c=Bs(),d=n.lastUpdated?[...n.data,fis()]:Eis();if(n.fetchError)return s.jsx(Fc,{action:o});const u=p=>i?.data?.addressId!==p.id;return s.jsxs(Oe.Collection,{children:[s.jsx(bt,{title:"settings.addresses.page.title"}),d.map(p=>s.jsx(gis,{removable:u(p),editAddress:e,removeAddress:t,address:p},p.id)),s.jsx(p_,{submitAddAddress:l}),s.jsx(Jas,{address:r}),s.jsx(uis,{address:a,sendAnalytics:c})]})},ole=({addresses:e,actions:{getCustomerAddresses:t,openRemoveAddressModal:n,openEditAddressModal:o,getDeliveryDestination:r},isServerRendered:a,isManualFormFlow:i})=>{const l=Ge(),c=Bs(),[d,u]=h.useState({}),[p,g]=h.useState({}),E=Rm();Sst(e.data||[]),h.useEffect(()=>{(!a||!e.lastUpdated)&&t()},[]);const y=nT(),T={editAddress:_=>{i?l(M9.routes.createEditUrl(_.id)):(u(_),o()),c.editAddressButtonClicked(_.id)},removeAddress:_=>{const A=e.data.length===1;A?Z.warning("addresses.remove.last.toast.message"):(g(_),n()),c.removeAddressButtonClicked(_.id,A)},addresses:e,getCustomerAddresses:t,addressToEdit:d,addressToRemove:p,selectedDeliveryDestination:y,submitAddAddress:(_,A)=>{t(),A&&r(A).then(R=>{E({addressId:_,deliveryDestinationId:R.payload.responseData.deliveryDestinationId,regionId:R.payload.responseData.resolvedRegionId})})}};return s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"settings.addresses.heading"})})}),s.jsx(yis,{...T})]})},Iis=e=>({addresses:cu(e),isServerRendered:Rt(e),isManualFormFlow:Gd(e)});ole.fetchData=({context:{store:e}})=>e.dispatch(eo.getCustomerAddresses());const Sis=st({getCustomerAddresses:eo.getCustomerAddresses,openEditAddressModal:()=>J.openModal("editAddress"),openRemoveAddressModal:()=>J.openModal("removeAddress"),getDeliveryDestination:hn.getSelectedDeliveryDestinationData}),Cis=we(Iis,Sis)(ole),nH=()=>{const t=f(D("ads"))?jd():Md();return s.jsx(En,{to:t})},vis=({children:e,isAccountDetailsSplit:t})=>t?s.jsx(x,{intent:"primary",type:"submit","data-test":"change-credentials-open-button",children:s.jsx(x.Text,{children:e})}):s.jsx(x,{intent:"secondary",type:"submit","data-test":"change-credentials-open-button",children:s.jsx(x.Text,{children:e})}),Tis=D("ads"),rle=()=>{const e=f(Tis),t=e?"settings.login.details.edit":"settings.user.details.change.credentials";return s.jsx("div",{"data-test":"change-credentials",children:s.jsx(vis,{isAccountDetailsSplit:e,children:s.jsx(b,{id:t})})})},ale=()=>{const e=f(At),t=jSe({basePath:e});return n=>{n.preventDefault(),window.location.assign(`${t}`)}},_is=({registerField:e})=>{const t=L(),n=ale(),o=f(IEe),r=f(l=>l.session.isSuperuser),a=l=>{const{name:c,label:d,placeholder:u,readOnly:p,required:g,type:E}=l,y={key:c,label:d,type:E,placeholder:u,readOnly:p,required:g,...e(l,!0)};return s.jsx(Wo,{...y,"data-pii":"true"})},i=[{name:"email",label:t.formatMessage("user.contactDetails.email.title"),placeholder:t.formatMessage("user.contactDetails.email.placeholder"),value:o||"",readOnly:!0,required:!0,type:"text"},{name:"password",label:t.formatMessage("user.contactDetails.password.title"),placeholder:t.formatMessage("user.contactDetails.password.placeholder"),value:t.formatMessage("settings.login.details.password")||"",readOnly:!0,required:!0,type:"text"}];return s.jsxs("form",{onSubmit:n,"data-test":"login-details-form",children:[s.jsx("div",{className:"salt-m-b--4",children:i.map(a)}),r?null:s.jsx(rle,{})]})},bis=Tt(Ht,qO)(_is),xis=D("ads"),Ais=e=>{const{comp:t}=e;return s.jsx(t,{})},ile=()=>s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.login.details.page.title"}),s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"settings.login.details.heading"})})}),s.jsx(Ais,{comp:bis})]});ile.fetchData=({context:{store:e}})=>xis(e.getState())?Promise.resolve():e.dispatch(xs.getCurrentCustomer());const Ris=D("homedel"),Dis=D("loyalty"),Ois=D("ads"),Pis=D("pay.ywlt"),Nis=D("hmpv"),Lis=D("dlvr.pref"),kis=D("ccai"),jis={messages:m.shape({loginDetails:m.string.isRequired,details:m.string.isRequired,language:m.string.isRequired,addresses:m.string.isRequired,wallet:m.string.isRequired,marketing:m.string.isRequired,deliveryPreferences:m.string.isRequired,accessibilitySettings:m.string.isRequired,loyalty:m.string.isRequired,helpCentre:m.string.isRequired}).isRequired,displayLoyalty:m.bool.isRequired,displayDeliveryPass:m.bool.isRequired,displayAddresses:m.bool.isRequired,displayLanguage:m.bool.isRequired,displayLoginDetails:m.bool.isRequired,displayWallet:m.bool.isRequired,displayAccessibilitySettings:m.bool.isRequired,displayMarketingPreferences:m.bool.isRequired,displayDeliveryPreferences:m.bool.isRequired,displayHelpCentre:m.bool.isRequired,intl:m.any.isRequired},lle=({messages:e,displayLoyalty:t,displayAddresses:n,displayLanguage:o,displayLoginDetails:r,displayWallet:a,displayMarketingPreferences:i,displayDeliveryPreferences:l,displayHelpCentre:c,intl:d})=>{const{pathname:u}=Ne();return s.jsx("nav",{id:"navigation-list","aria-label":d.formatMessage("settings.sidebar.title"),children:s.jsxs(no,{children:[r&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===jd(),unstyled:!0,to:jd(),"data-test":"login-details-link",children:e.loginDetails})}),s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===Md(),unstyled:!0,to:Md(),"data-test":"user-details-link",children:e.details})}),o&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===tS(),unstyled:!0,to:tS(),"data-test":"language-link",children:e.language})}),t&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===Tp(),unstyled:!0,to:Tp(),"data-test":"loyalty-link",children:e.loyalty})}),n&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===Xa(),unstyled:!0,to:Xa(),"data-test":"addresses-link",children:e.addresses})}),s.jsx(Nas,{path:u}),a&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===Sg(),unstyled:!0,to:Sg(),"data-synthetics":"settings-navigation-wallet",children:e.wallet})}),s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===sS(),unstyled:!0,to:sS(),"data-test":"accessibility-settings-link",children:e.accessibilitySettings})}),i&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===nS(),unstyled:!0,to:nS(),"data-test":"marketing-preferences-link",children:e.marketing})}),l&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===oS(),unstyled:!0,to:oS(),"data-test":"delivery-preferences-link",children:e.deliveryPreferences})}),c&&s.jsx(no.Item,{children:s.jsx(Ye,{bold:u===rS(),unstyled:!0,to:rS(),"data-test":"help-centre-link",children:e.helpCentre})})]})})};lle.propTypes=jis;const Mis=e=>({displayAddresses:Ris(e),displayLoyalty:Dis(e),displayLanguage:gD(e),displayLoginDetails:Ois(e),displayWallet:Pis(e),displayMarketingPreferences:!Nis(e),displayDeliveryPreferences:Lis(e),displayHelpCentre:kis(e)}),wis=Tt(Ht,we(Mis))(lle),Fis=D("homedel"),Bis=D("loyalty"),Uis=D("ads"),Gis=D("pay.ywlt"),$is=D("hmpv"),His=D("dlvr.pref"),Vis=D("ccai"),oH=({messages:e})=>{const t=Ge(),n=Ne(),o=f(Fis),r=f(Bis),a=f(gD),i=f(Uis),l=f(Gis),c=!f($is),d=f(His),u=f(Vis),[p,g]=h.useState(n.pathname),{createOption:E,handleDeliveryPassChange:y}=Las(),I=S=>{y(S);const C=S.target.value;g(C),t(C)};return s.jsxs(Dr,{hideLabel:!0,label:e.menu,value:p,onChange:I,"data-test":"navigation-select",children:[i&&s.jsx("option",{value:jd(),children:e.loginDetails}),s.jsx("option",{value:Md(),children:e.details}),a&&s.jsx("option",{value:tS(),children:e.language}),r&&s.jsx("option",{value:Tp(),children:e.loyalty}),o&&s.jsx("option",{value:Xa(),children:e.addresses}),E(),l&&s.jsx("option",{value:Sg(),children:e.wallet}),s.jsx("option",{"data-test":"accessibility-settings-option",value:sS(),children:e.accessibilitySettings}),c&&s.jsx("option",{"data-test":"marketing-preferences-option",value:nS(),children:e.marketing}),d&&s.jsx("option",{"data-test":"delivery-preferences-option",value:oS(),children:e.deliveryPreferences}),u&&s.jsx("option",{"data-test":"help-centre-option",value:rS(),children:e.helpCentre})]})},cle=D("ads"),Wis=()=>{const e=L(),t=f(cle),n=e.formatMessage("settings.accessibility.heading"),o={addresses:e.formatMessage("settings.addresses.heading"),deliveryPass:e.formatMessage("settings.delivery.pass.heading"),details:e.formatMessage("settings.details.heading"),language:e.formatMessage("settings.language.heading"),loginDetails:e.formatMessage("settings.login.details.heading"),loyalty:e.formatMessage("settings.sidebar.loyalty"),marketing:e.formatMessage("settings.marketing.heading"),deliveryPreferences:e.formatMessage("settings.delivery.heading"),accessibilitySettings:n,menu:e.formatMessage("settings.page.menu.title"),title:e.formatMessage("settings.page.title"),wallet:e.formatMessage("settings.wallet.heading"),helpCentre:e.formatMessage("settings.chat.link")};return s.jsxs(h.Fragment,{children:[s.jsx(sn,{children:s.jsx(ee,{as:"h1","data-test":"account-settings-title",children:o.title})}),s.jsxs(V,{children:[s.jsxs(V.Item,{colSpan:{xs:12,sm:4,lg:3},children:[s.jsx(Kt,{breakpoint:"sm-up",children:s.jsx(wis,{messages:o})}),s.jsx(Lt,{breakpoint:"sm-up",children:t?s.jsxs(h.Fragment,{children:[s.jsx(ee,{as:"h2",className:"salt-m-y--2","data-test":"account-settings-menu-title",children:o.menu}),s.jsx(oH,{messages:o})]}):s.jsx(oH,{messages:o})})]}),s.jsx(V.Item,{colSpan:{xs:12,sm:8,lg:8},colStart:{sm:5,lg:4},children:s.jsx("div",{className:"salt-p-y--4",children:s.jsx(pR,{})})})]})]})},dle=()=>s.jsx(Et,{type:"Settings::route",children:s.jsx(Wis,{})});dle.fetchData=async({context:{store:e}})=>{if(cle(e.getState()))return e.dispatch(xs.getCurrentCustomer())};const rH={ERROR:"error",SUCCESS:"success"},Yis=ae.memo(({preference:{id:e,checkboxText:t,descriptionText:n,isChecked:o}})=>{const r=po();return s.jsx(zd,{control:r.control,name:e,defaultValue:o,render:({field:a})=>s.jsx(Lo,{...a,"data-test":e,input:{checked:a.value},label:t,bold:!0,last:!1,whiteSpace:"pre-wrap",children:n})},e)}),qis=ae.memo(({groups:e})=>s.jsx(h.Fragment,{children:e.map(({titleText:t,subtitleText:n="",preferences:o})=>s.jsxs("div",{className:"salt-m-b--4",children:[t&&s.jsx(ee,{as:"h3",className:"salt-m-t--8 salt-m-b--4",children:t}),n&&s.jsx(h_,{as:"p",className:"salt-m-b--4",html:n}),o.map(r=>r.checkboxText&&s.jsx(Yis,{preference:r},r.id))]},`${t}-${n}`))})),aH={RETAILER_REGION_ID_PLACEHOLDER:"{RETAILER_REGION_ID}",ACTIVE_LOCALE_PLACEHOLDER:"{0}"},Kis=e=>{const t=f(sa),n=f(Ms);let o=e;return o?(t&&(o=o.replace(aH.RETAILER_REGION_ID_PLACEHOLDER,t)),n&&(o=o.replace(aH.ACTIVE_LOCALE_PLACEHOLDER,n)),o):null},zis=({externalManagementUrl:e=null})=>{const t=Kis(e);return t?s.jsx(x,{asChild:!0,intent:"primary",children:s.jsx(tt,{href:t,intent:"ghost",target:"_blank","data-test":"marketing-preferences-retailer-managed-anchor",children:s.jsx(x.Text,{"aria-hidden":!0,children:s.jsx(b,{id:"settings.marketing.preferences.retailer.managed.button"})})})}):null},Qis=({isRetailerManaged:e,groups:t,externalManagementUrl:n})=>s.jsx(h.Fragment,{children:e?s.jsx(zis,{externalManagementUrl:n}):s.jsx(qis,{groups:t})}),Xis=ae.memo(({section:{id:e,titleText:t,headerText:n,groups:o,footers:r,isRetailerManaged:a,externalManagementUrl:i=null},lastUpdated:l})=>s.jsxs("div",{className:"salt-m-b--8",children:[t&&s.jsx(ee,{as:"h2",className:"salt-m-b--4",children:t}),n&&s.jsx("p",{className:"salt-m-b--4",children:n}),l?s.jsx(Qis,{groups:o,isRetailerManaged:a,externalManagementUrl:i}):null,r.length>0&&s.jsx("div",{className:"salt-m-t--8 salt-m-b--4",children:r.map(c=>{const{headerText:d="",descriptionText:u}=c;return s.jsxs("div",{className:"salt-m-b--4",children:[d&&s.jsx(ee,{as:"h3",className:"salt-m-b--4",children:d}),u&&s.jsx(h_,{as:"p",html:u})]},`${e}-footer-${d}`)})})]},e)),Zis=(e,t)=>!!e&&e===t.id,Jis=({sections:e,lastUpdated:t})=>{const n=e.filter(o=>!o.isRetailerManaged).pop()?.id;return s.jsx(h.Fragment,{children:e.map(o=>s.jsxs(h.Fragment,{children:[s.jsx(Xis,{section:o,lastUpdated:t},o.id),Zis(n,o)&&s.jsx("div",{className:"salt-m-b--8",children:s.jsx(x,{intent:"primary",type:"submit","data-test":"preferences-save-button",fill:!1,disabled:!t,children:s.jsx(x.Text,{children:s.jsx(b,{id:"settings.marketing.preferences.save"})})})})]},o.id))})},els=({marketingPreferences:e})=>{const t=Dn(),{lastUpdated:n,preferences:{sections:o}}=e,r=mse(),a=l=>{Z[l](`settings.update.marketing.preferences.${l}`)},i=async l=>{try{await r(l),a(rH.SUCCESS)}catch{a(rH.ERROR)}};return s.jsx(On,{...t,children:s.jsx("form",{"data-test":"section-preferences",onSubmit:t.handleSubmit(i),children:s.jsx(Jis,{"data-test":"section-preferences-list",sections:o,lastUpdated:n})})})},tls=({isFetchError:e,onFetchMarketingPreferences:t,marketingPreferences:n})=>e?s.jsx(Fc,{action:t}):s.jsx(els,{marketingPreferences:n}),ule=()=>{const e=f(Rt),{marketingPreferences:t,onFetchMarketingPreferences:n}=Mj(),{fetchError:o,preferences:r}=t,a=!!r.sections.length,i=o&&!a;return h.useEffect(()=>{const{lastUpdated:l}=t;(!e||!l)&&n()},[]),s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.marketing.preferences.page.title"}),s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"settings.marketing.heading"})})}),s.jsx(tls,{isFetchError:i,onFetchMarketingPreferences:n,marketingPreferences:t})]})};ule.fetchData=fkt;const sls={fields:m.arrayOf(m.shape({name:m.string.isRequired,label:m.string,placeholder:m.string,options:m.arrayOf(m.string),required:m.bool,type:m.string,validation:m.shape({messageKey:m.string,test:m.string}),readOnly:m.bool})).isRequired,intl:m.any.isRequired,isValid:m.func.isRequired,isReadOnly:m.bool.isRequired,registerField:m.func.isRequired,phoneNumberValidation:m.string.isRequired,areInitialValuesFetched:m.bool,values:m.objectOf(m.any)},nls={values:{},areInitialValuesFetched:!0},ols=v(Wo)`
    html[dir='rtl'] & {
        text-align: end;
    }
`;class Sw extends h.Component{constructor(t){super(t),this.generateField=this.generateField.bind(this)}getPhoneNumberValidation(){const{phoneNumberValidation:t}=this.props;return{test:n=>new RegExp(t).test(n),error:this.props.intl.formatMessage("accountSettings.contactDetails.mobilePhoneError")}}getTranslatedValidation({test:t,messageKey:n}={}){return t&&{test:t,error:this.props.intl.formatMessage(n)}}generateField(t){const n=this.transformField(t),{name:o,label:r,placeholder:a,type:i,options:l,required:c,readOnly:d,meta:u}=n,g={text:Wo,tel:ols,select:Dr,checkbox:Lo}[i]||Wo,E={key:o,label:r,placeholder:a,readOnly:d,required:c,type:i,meta:u,...this.props.registerField(n,this.props.areInitialValuesFetched)};if(i==="checkbox"){const{checked:y,onChange:I,...S}=E;return s.jsx(g,{bold:!1,input:{checked:y,onChange:I},label:r,"data-pii":"true",...S})}return i==="select"?s.jsx(g,{...E,"data-pii":"true",children:l.map(y=>s.jsx("option",{value:y,children:y},y))}):s.jsx(g,{...E,"data-pii":"true"})}transformField(t){const{intl:n,values:o,isReadOnly:r}=this.props,{label:a,placeholder:i,required:l,validation:c,options:d,type:u,...p}=t,g={meta:{touched:!1,invalid:!1},label:n.formatMessage(a),placeholder:n.formatMessage(i),value:o[t.name],...p};return r?{type:"text",readOnly:!0,...g}:{requiredMessage:l&&n.formatMessage("settings.user.details.required.field"),validation:u==="tel"?this.getPhoneNumberValidation():this.getTranslatedValidation(c),type:u,options:d,required:l,...g}}render(){const{fields:t}=this.props;return t.map(this.generateField)}}Sw.propTypes=sls;Sw.defaultProps=nls;const rls=({handleSubmit:e,intl:t,fields:n,customer:o,registerField:r,phoneNumberValidation:a,isValid:i,isLanguageSelectionAvailable:l,isReadOnly:c,availableLanguages:d,customerLanguage:u})=>s.jsxs("form",{onSubmit:e,"data-test":"details-form",children:[s.jsx(Sw,{intl:t,fields:n,values:o.data,registerField:r,phoneNumberValidation:a,isValid:i,isReadOnly:c,areInitialValuesFetched:!!o.lastUpdated}),l&&s.jsx(k_,{registerField:r,availableLanguages:d,customerLanguage:u,intl:t}),s.jsx(x,{className:c?"salt-d--none":void 0,disabled:c,intent:"primary",type:"submit","data-test":"details-submit-button",children:s.jsx(x.Text,{children:t.formatMessage("settings.user.details.save")})})]}),als={externalAccountManagementUrl:m.string,redirectUrl:m.string,children:m.node.isRequired},ils={externalAccountManagementUrl:void 0,redirectUrl:void 0},Cw=({externalAccountManagementUrl:e,redirectUrl:t,children:n})=>{const o=()=>{if(e){if(t){const r=`?redirect_uri=${t}`;return window.open(`${e}${r}`,"_self")}return window.open(`${e}`,"_self")}return Z.error("toast.notification.generic.error")};return s.jsx(x,{intent:"primary","data-test":"change-details-button",onClick:o,children:s.jsx(x.Text,{children:n})})},lls=e=>({externalAccountManagementUrl:gde(e),redirectUrl:hde(e)});Cw.defaultProps=ils;Cw.propTypes=als;const cls=we(lls)(Cw),dls=D("lng"),uls=D("ads"),pls=D("ecam"),mls=({actions:e,customer:t,intl:n,fields:o,defaultMobilePhoneCountry:r,phoneNumberValidation:a,availableLanguages:i,customerLanguage:l,registerField:c,getFieldValues:d,updateForm:u,isValid:p,isFormReadOnly:g,isServerRendered:E,isSuperuser:y,isAccountDetailsSplit:I,isLanguageSelectEnabled:S})=>{const C=ale();let T=!1;const[_,A]=h.useState(!1),R=F(),P=()=>{const H=t.data,K=d(),X=Object.keys(K).reduce((q,ne)=>(H[ne]&&K[ne]!==H[ne]&&(q[ne]=H[ne]),q),{});return Object.keys(X).length>0?u(X):!1};h.useEffect(()=>{A(o.every(H=>H.readOnly)&&!M()),(!E||!t.lastUpdated)&&e.getCurrentCustomer().then(P).catch(H=>H)},[]);const N=H=>e.updateCustomerLanguage(H).then(()=>{e.analyticsEvent({type:_r.LOCALE_CHANGED,locale:H});const K={event:"event",eventAction:"LOCALE_CHANGED",eventCategory:"Locale",eventLabel:H};te.sendEvent({GA:K,WA:null}),e.analyticsEvent({type:_r.LOCALE_CHANGED_GA4,locale:H});const X={event:"locale_changed",locale:H};te.sendEvent({GA:X,WA:null})}).then(()=>{T=!0}),k=H=>aEe(H,r)(R),M=()=>!I&&S&&i.length>1,w=H=>M()&&l!==H,j=H=>!!Object.keys(H).filter(K=>H[K]!==t.data[K]).length,G=()=>!I&&!y,W=H=>{if(H.preventDefault(),p()){const{language:K,...X}=d(),q={details:j(X),language:w(K)};return!q.details&&!q.language?!1:Promise.resolve().then(()=>q.details?k(X):Promise.resolve()).then(()=>q.language?N(K):Promise.resolve()).then(e.getCurrentCustomer).then(()=>{Z.success("settings.account.details.update.success")}).then(()=>{T&&Of(K)}).catch(ne=>{T=!1;const ue=ne?.message==="Invalid phone number provided"?"accountSettings.contactDetails.mobilePhoneError":"settings.account.details.update.error";Z.error(ue)})}return!1};return t.lastUpdated?s.jsxs(ae.Fragment,{children:[s.jsx("div",{className:"salt-m-b--4",children:s.jsx(rls,{"data-test":"user-details-form",handleSubmit:W,intl:n,fields:o,customer:t,registerField:c,phoneNumberValidation:a,isValid:p,isLanguageSelectionAvailable:M(),isReadOnly:g||_,customerLanguage:l,availableLanguages:i})}),g&&!G()&&s.jsx(cls,{"data-test":"details-edit-button",children:s.jsx(b,{id:"settings.user.details.edit"})}),G()?s.jsx("form",{onSubmit:C,children:s.jsx(rle,{})}):null]}):s.jsx(_s,{"data-test":"user-details-spinner"})},hls=e=>({customer:Ol(e),fields:pde(e),defaultMobilePhoneCountry:Ze(e,"default-mobile-phone-number-default-country"),phoneNumberValidation:Ze(e,"validation-mobile-phone-number-mask-frontend"),availableLanguages:Wp(e),customerLanguage:q2(e),isLanguageSelectEnabled:dls(e)&&IP(e),isAccountDetailsSplit:uls(e),isFormReadOnly:pls(e),isServerRendered:Rt(e),isSuperuser:e.session.isSuperuser}),gls=st({analyticsEvent:U.analyticsEvent,getCurrentCustomer:xs.getCurrentCustomer,updateCustomerLanguage:xs.updateCustomerLanguage}),Els=Tt(Ht,we(hls,gls),qO)(mls),fls=D("ads"),ple=()=>s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:"settings.details.page.title"}),s.jsx(ie,{asChild:!0,children:s.jsx("h2",{children:s.jsx(b,{id:"settings.details.heading"})})}),s.jsx(Els,{})]});ple.fetchData=({context:{store:e}})=>fls(e.getState())?Promise.resolve():e.dispatch(xs.getCurrentCustomer());const yls=D("homedel"),Ils=un.isSubscriptionEnabled,Sls=D("loyalty"),Cls=D("ads"),vls=D("pay.ywlt"),Tls=D("hmpv"),_ls=D("dlvr.pref"),bls=D("ccai"),xls=e=>[{path:"/settings",Component:e.Main,children:[{path:"/settings",Component:$s(Xe,dle),children:[{index:!0,Component:nH},{path:"customerDetails",Component:nH},{path:"login-details",Component:Ic([{condition:Cls,failComponent:ot}],ile)},{path:"user-details",Component:ple},{path:"language",Component:Ic([{condition:gD,failComponent:ot}],jie)},{path:"wallet",Component:as(vls,Mie,ot)},{path:"addresses",Component:as(yls,Cis,ot)},{path:"delivery-pass",Component:as(Ils,zie,ot)},{path:"loyalty",Component:as(Sls,wos,ot)},{path:"accessibility",Component:Vas},{path:"marketing",Component:as(Tls,ot,ule)},{path:"delivery-preferences",Component:as(_ls,ele,ot)},{path:"help-centre",Component:as(bls,Was,ot)},{path:"*",Component:ot}]}]}],Als=()=>s.jsx("div",{className:"salt-m-y--16",children:s.jsx(V,{children:s.jsx(V.Item,{colStart:{sm:3,md:4,lg:5},colSpan:{xs:12,sm:8,md:6,lg:4},children:s.jsx(Os,{titleIcon:"search",title:"shopinshop.not.found.title",titleAs:"h1",description:"shopinshop.not.found.description",primaryButton:{text:"shopinshop.not.found.button",to:"/"}})})})}),Rls=({html:e="",name:t,id:n})=>{const o=ZT();return h.useEffect(()=>{o.reportPageView({event:"view_shop_in_shop",name:t,id:n,pageType:"curated"})},[]),e?s.jsx("div",{"data-test":"shop-in-shop-html",dangerouslySetInnerHTML:{__html:e}}):null},Dls={reportImpression:m.func.isRequired,children:m.element.isRequired},Ols={children:void 0,reportImpression:void 0},vw=({reportImpression:e,children:t})=>{const n=TE(e);return s.jsx("div",{ref:n,"data-test":"sis-sub-category",children:t})};vw.propTypes=Dls;vw.defaultProps=Ols;const Pls={id:m.string.isRequired,label:m.string.isRequired,name:m.string.isRequired,html:m.string,images:m.shape({hero:m.shape({id:m.string.isRequired,name:m.string,headline:m.string,headlineHexColour:m.string,altText:m.string,contentType:m.string,images:m.arrayOf(m.shape({url:m.string,width:m.number.isRequired,height:m.number.isRequired})).isRequired}).isRequired,subCategories:m.arrayOf(m.shape({id:m.string.isRequired,name:m.string.isRequired,label:m.string.isRequired,altText:m.string.isRequired,contentType:m.string,images:m.arrayOf(m.shape({url:m.string.isRequired,width:m.number.isRequired,height:m.number.isRequired})).isRequired,target:m.oneOfType([m.shape({linkType:m.string,openInNewTab:m.bool,ids:m.array}),m.shape({linkType:m.string,openInNewTab:m.bool,values:m.array})]).isRequired})).isRequired})},Nls=e=>e?.startsWith("/")&&!e.includes("source=")?e.includes("?")?`${e}&source=SUB_CATEGORY_IMAGE_CLICKED`:`${e}?source=SUB_CATEGORY_IMAGE_CLICKED`:e,Lls=(e,{isSEOReadableURLEnabled:t})=>{if(e)return Nls(Aa.calculateLegacyTargetUrl(e,{isSEOReadableURLEnabled:t}))},kls=e=>e.openInNewTab?"_blank":void 0,Tx=e=>e?e.substring(e.lastIndexOf("/")+1):"",Tw=({id:e="",name:t="",label:n="",images:o})=>{const r=ZT();h.useEffect(()=>{r.reportPageView({event:"view_shop_in_shop",name:t,id:e,pageType:"curated"})},[]),h.useEffect(()=>{o?.hero?.images[0]&&r.reportHorizontalHeroImpression({id:e??"",name:t??"",shopInShopId:e,shopInShopHeadline:o?.hero?.headline??"",imageId:o?.hero?.images[0]?.url?Tx(o?.hero?.images[0]?.url):""})},[e,o]);const[a]=Ee(["seo.rdbl"]),i=h.useRef([]),l=h.useCallback(({imageId:p,subCategoryId:g,subCategoryName:E,subCategoryLabel:y,value:I,linkType:S,sequence:C})=>{r.reportSubCategoryClick({id:e??"",subCategoryId:g,subCategoryName:E,subCategoryLabel:y,value:I,linkType:S,imageId:p,sequence:C})},[]),c=h.useCallback(({imageId:p,subCategoryId:g,subCategoryName:E,subCategoryLabel:y,sequence:I})=>{i.current.includes(I)||(i.current.push(I),r.reportSubCategoryImpression({id:e??"",imageId:p,subCategoryId:g,subCategoryName:E,subCategoryLabel:y,sequence:I?.toString()}))},[]);if(!o)return null;const{hero:d,subCategories:u}=o;return s.jsxs(h.Fragment,{children:[n&&s.jsx(ee,{as:"h1","data-test":"sis-label",className:"salt-m-y--4",children:n}),d&&s.jsx("div",{className:"salt-m-b--4",children:s.jsx(If,{images:d.images,headlineText:d.headline,headlineColor:d.headlineHexColour,alt:d.altText??"",dataTest:"shop-in-shop-hero",headlineDataTest:"sis-hero-headline"})}),u&&s.jsx(Oe.MediaCardCollection,{formatting:"normal",gridVariant:"auto-fill",children:u.map((p,g)=>{const E=Lls(p?.target,{isSEOReadableURLEnabled:a}),y=kls(p?.target);return s.jsx(vw,{reportImpression:()=>c({imageId:p?.images[0]?.url?Tx(p?.images[0]?.url):"",subCategoryId:p?.id??"",subCategoryName:p?.name??"",sequence:g.toString(),subCategoryLabel:p?.label??""}),children:s.jsx(Oe.MediaNavigationCard,{variant:"fullImage",formatting:"normal",src:p?.images[0]?.url??"",alt:p?.altText,title:p?.label,href:E,target:y,titleDataTest:"sis-sub-category-label",onClick:()=>{l({subCategoryId:p?.id??"",subCategoryName:p?.name??"",imageId:p?.images[0]?.url?Tx(p?.images[0]?.url):"",linkType:p?.target.linkType??"",subCategoryLabel:p?.label??"",value:E,sequence:g.toString()})}})},p?.id??g)})})]})};Tw.propTypes=Pls;Tw.defaultProps={id:"",name:"",label:"",images:void 0};const jls=ae.memo(Tw,function(t,n){return t.id===n.id}),Mls=({id:e="",name:t="",label:n="",componentItems:o})=>{const r=ZT();return h.useEffect(()=>{r.reportPageView({event:"view_shop_in_shop",name:t,id:e,pageType:"curated"})},[]),s.jsxs("div",{"data-test":"sis-componentized",children:[n&&s.jsx(ee,{as:"h1","data-test":"sis-label",className:"salt-m-y--4",children:n}),s.jsx(Hk,{items:o,id:e,name:t,meta:{PAGE_TYPE:"curated",PAGE_NAME:"shop_in_shop",BANNER_PLACEMENT:"ABOVE_GRID",LOCATION:"SHOP_IN_SHOP"}})]})},wls=ae.memo(Mls,function(t,n){return t.id===n.id}),Fls=()=>{const e=F(),t=nn(),{id:n="",name:o="",label:r="",contentFormat:a="",html:i="",images:l=null,productIds:c=[],isFetching:d,fetchError:u=null,pageId:p=null,componentItems:g=null}=f(l6e),E=f(ts),[y]=Ee(["bt.top"]),I=p!==t.pageId,S=u?.statusCode===pF,C=u&&u?.statusCode!==pF,T=!!c?.length,_=!l&&!g&&!i&&!c?.length,A=I||!u&&_;h.useEffect(()=>{A&&t.pageId&&e(e8(t.pageId))},[t.pageId,A]),h.useEffect(()=>()=>{e(a6e())},[]);const R=a?.toUpperCase()==="IMAGES",P=a?.toUpperCase()==="COMPONENTIZED"&&g,N=a?.toUpperCase()==="HTML";return d&&!P?s.jsx(_s,{size:"m",className:"salt-m-t--32"}):C?s.jsx(ot,{}):S||n===""?s.jsx(Als,{}):s.jsxs("div",{className:"salt-m-y--2 salt-m-x--2",children:[R&&s.jsx(jls,{id:n,label:r,name:o,images:l,html:i}),P&&s.jsx(wls,{id:n,label:r,name:o,componentItems:g}),N&&s.jsx(Rls,{html:i,id:n,name:o}),T&&s.jsxs("div",{className:"salt-m-t--4",children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx(uo,{type:"catalogue",page:"shop-in-shop",productGroups:[{products:c,type:""}],productsByProductId:E,isFetching:d,"data-test":"sis-products-grid"})]}),y&&s.jsx(Du,{})]})},mle=()=>s.jsx(Et,{type:"ShopInShop::route",children:s.jsx(Fls,{})});mle.fetchData=({store:e,params:t})=>e.dispatch(e8(t.pageId));const Bls=D("sis"),Uls=e=>[{path:"/shop-in-shop/:pageId",Component:e.Main,key:"main",children:[{index:!0,Component:as(Bls,mle,ot)}]}],Gls=.5;class $ls{constructor({currentBreakpoint:t}){const n=["xs","sm","md"].includes(t)?co.v2.sm:co.v2.lgUp;this.entries=[],this.onEntries=this.onEntries.bind(this),typeof window<"u"&&"IntersectionObserver"in window&&(this.intersectionObserver=new window.IntersectionObserver(this.onEntries,{rootMargin:`-${n}px 0px 0px 0px`,threshold:Gls}))}onEntries(t){t.forEach(n=>{if(n.isIntersecting===!1)return;const o=this.entries.findIndex(i=>i&&i.ref.current===n.target),{onFirstImpression:r,onImpression:a}=this.entries[o];r&&(r(),delete this.entries[o].onFirstImpression),a&&a()})}observeElement({ref:t,onFirstImpression:n,onImpression:o}){try{this.intersectionObserver.observe(t.current),this.entries.push({ref:t,onFirstImpression:n,onImpression:o})}catch{}}unobserveElement({ref:t}){try{this.intersectionObserver.unobserve(t.current);const n=this.entries.findIndex(o=>o&&o.ref.current===t.current);delete this.entries[n]}catch{}}destroy(){try{this.intersectionObserver.disconnect()}catch{}delete this.intersectionObserver,delete this.entries}}const Hls=v(rt.Body)`
    inline-size: auto;
    inset-block-start: ${({verticalAlign:e})=>e==="top"?"0":`calc(100% + ${$(1)})`};
`,_w=({shoppingListId:e,name:t,listProductIds:n})=>{const o=F(),r=L(),[a,i]=h.useState(!1),l=ft(),c={dropdownEditButton:r.formatMessage("shopping.list.item.dropdown.edit"),dropdownDeleteButton:r.formatMessage("shopping.list.item.dropdown.delete"),moreOptionsButton:r.formatMessage("shopping.list.more.options.aria.label")},d=()=>l({type:ls.LIST_ACTIONS_MODAL_DISPLAYED,listId:e,userAction:wh.Close}),u=I=>{I.stopPropagation(),l({type:ls.LIST_ACTIONS_MODAL_DISPLAYED,listId:e,userAction:wh.Edit}),o(J.openModal(Cc.UPDATE_NAME,{shoppingListId:e,name:t})),i(!1)},p=I=>{I.stopPropagation(),l({type:ls.LIST_ACTIONS_MODAL_DISPLAYED,listId:e,userAction:wh.Delete}),o(J.openModal(Cc.DELETE,{shoppingListId:e,name:t,listProductIds:n})),i(!1)},g=I=>{I.stopPropagation(),a?(i(!1),d()):i(!0)},y=Dm(()=>{a&&(i(!1),d())},[a]);return s.jsxs(rt.Container,{children:[s.jsx(x,{intent:"tertiary",type:"button",size:"s",fill:!1,id:`shopping-list-item-button-${e}`,"aria-label":c.moreOptionsButton,"aria-controls":`shopping-list-item-menu-${e}`,"aria-haspopup":"true","data-test":"shopping-list-item-button","aria-expanded":a?"true":void 0,onClick:g,children:s.jsx(x.Icon,{name:"more"})}),s.jsx(Hls,{isOpen:a,align:"right",children:s.jsx(rt.Content,{ref:y,children:s.jsxs(Be,{inline:!1,id:`shopping-list-item-menu-${e}`,"aria-labelledby":`shopping-list-item-button-${e}`,children:[s.jsx(Be.Item,{children:s.jsx(rt.ItemButton,{onClick:u,"data-test":"shopping.list.item.dropdown.edit.button",children:c.dropdownEditButton})}),s.jsx(Be.Item,{children:s.jsx(rt.ItemButton,{onClick:p,"data-test":"shopping.list.item.dropdown.delete.button",children:c.dropdownDeleteButton})})]})})})]})},hle=({shoppingListId:e})=>{const t=ft(),n=()=>{const o=document.getElementById("search");o&&o.focus(),t({type:ls.EMPTY_LIST_PRODUCT_SEARCH_CLICKED,description:"User clicked the search button to browse products for an empty list",pageEventAttributes:{listId:e}})};return s.jsx(x,{intent:"primary",fill:!0,onClick:n,"data-test":"search-focus-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"shopping.lists.search.focus.button"})})})},Vls=({name:e,shoppingListId:t,viewportImpressionOfElement:n,onFirstImpression:o,...r})=>{const a=`shopping-list-header-${t}`,i=h.useRef(null);return h.useEffect(()=>(n&&n.observeElement({ref:i,onFirstImpression:o,onImpression:void 0}),()=>n&&n.unobserveElement({ref:i})),[n]),s.jsxs(Oe.Action,{innerRef:i,align:"left","aria-labelledby":a,"data-test":"shopping-list-empty-card",chip:null,...r,children:[s.jsx(Oe.Action.Options,{children:s.jsx(_w,{shoppingListId:t,name:e,listProductIds:[]})}),s.jsx(Oe.Action.Header,{id:a,children:s.jsx(Oe.Action.HeaderText,{"data-pii":"true",singleLine:!0,children:e})}),s.jsx(Oe.Action.Body,{children:s.jsx(b,{id:"shopping.list.card.empty.text"})}),s.jsx(Oe.Action.Footer,{children:s.jsx(Q,{wrap:"nowrap",children:s.jsx(hle,{shoppingListId:t})})})]})},Wls=ia(`
    mutation CartAddShoppingList($addShoppingListInput: CartAddShoppingListInput!) {
        cartAddShoppingList(addShoppingListInput: $addShoppingListInput) {
            successfulUpdates {
                product {
                    productId
                }
                quantity
            }
            unsuccessfulUpdates {
                product {
                    productId
                }
                quantity
                reason
            }
        }
    }
`),Yls=(e="UNKNOWN")=>{switch(e){case"EXCEEDED_CART_MAX_QUANTITY":return Jl.EXCEEDED_BASKET_MAX_QUANTITY;case"LIMITED_AVAILABILITY":return Jl.LIMITED_AVAILABILITY;case"EXCEEDED_PRODUCT_MAX_QUANTITY":return Jl.EXCEEDED_MAX_QUANTITY;case"OUT_OF_STOCK":return Jl.OUT_OF_STOCK;case"TIME_RESTRICTION":return Jl.TIME_RESTRICTION;default:return Jl.UNKNOWN}},gle=()=>{const e=Ge(),t=F(),n=f(mo),[{fetching:o},r]=Ep(Wls),a=ft(),i=f(Qs),l=async p=>{let g={};try{g=(await t(av({productIds:p})))?.payload?.product??{}}catch{g={}}const E={...n,...g},y=[];return p.forEach(I=>{const S=E[I];S&&y.push(S)}),y},c=async(p,g)=>{if(p.length>0){const y=(await l(p.map(C=>C.product.productId))).map(C=>({...C,addedAmount:1,totalAmount:1}));a({type:Re.BUY_ALL_PRODUCTS,product:y,productsRemoved:[],basketFinalPrice:g.totals?.itemPriceAfterPromos,productListName:"shopping-list: other",addedByFunction:"LIST_ADD_ALL",page:"shopping-list"});const I=wv({products:y,productListName:"shopping-list: other",addedByFunction:"LIST_ADD_ALL",page:"shopping-list",basket:g});te.sendEvent({GA:I,WA:null}),a({type:Re.ADD_TO_CART_GA4,basket:g,page:"shopping-list",addedByFunction:"LIST_ADD_ALL",product:y,productListName:"shopping-list: other"}),Fv({basket:g,page:"shopping-list",addedByFunction:"LIST_ADD_ALL",products:y,productListName:"shopping-list: other",featuredProductCampaigns:i}).forEach(C=>{te.sendEvent({GA:C,WA:null})})}},d=async(p,g)=>{if(p.length>0){const E=p.map(y=>({productId:y.product.productId,reason:Yls(y.reason),requestedAmount:1,addedAmount:0}));t(yr.setMergeResult({limitedItems:E,destination:jt(),sourceEventId:g})),t(J.openModal(gf))}else e(jt())};return{fetching:o,addListToBasket:async p=>{const g=ct();a({type:ls.ADD_ALL_TO_TROLLEY_BUTTON_CLICKED,listId:p,sourceEventId:g});const{data:E}=await r({addShoppingListInput:{shoppingListId:p}});if(E?.cartAddShoppingList){const y=await t(Yt.getBasket());if(E.cartAddShoppingList&&y){const{cartAddShoppingList:{unsuccessfulUpdates:I,successfulUpdates:S}}=E;await c(S??[],y),await d(I??[],g)}}else Z.error("request.error.title")}}},qls=v(Oe.Action)`
    cursor: pointer;
`,Kls=({shoppingList:e,viewportImpressionOfElement:t,onFirstImpression:n,...o})=>{const r=Ge(),a=He(),i=L(),l=h.useRef(null),[c,d,u]=Ee([EL,bT,"s.tax"]),{fetching:p,addListToBasket:g}=gle(),{shoppingListId:E,name:y,productCount:I,offerCount:S,products:C,prices:{discountedPrice:T}}=e,_={numberOfItems:i.formatMessage("shopping.list.card.number.of.items",{numberOfItems:I}),numberOfOffers:i.formatMessage("shopping.list.card.number.of.offers",{numberOfOffers:S}),addAll:i.formatMessage("shopping.list.card.add.all.button"),viewList:i.formatMessage("shopping.list.card.view.list.button"),discountedPrice:i.formatMessage("shopping.list.card.total.price",{totalPrice:a(T)})},A=`shopping-list-header-${E}`,R=`${_.viewList} ${y}`,P=`${_.addAll} ${y}`,N=h.useMemo(()=>C.map(j=>j.productId),[C]);h.useEffect(()=>(t&&t.observeElement({ref:l,onFirstImpression:n,onImpression:void 0}),()=>t&&t.unobserveElement({ref:l})),[t]);const k=async j=>{j.stopPropagation(),await g(E)},M=()=>{r(r0(E))},w=()=>C.slice(0,5).map(({productId:j,description:G,primaryImage:W,isAlcohol:H,restrictions:K})=>d&&K?.restrictedVisibility?s.jsx(C7,{children:s.jsx(nG,{"data-test":"shopping-list-card-image",alt:G,src:W?.url,visible:!1})},j):s.jsx(Ji,{isActive:H&&c,children:s.jsx(nG,{"data-test":"shopping-list-card-image",alt:G,src:W?.url})},j));return s.jsxs(qls,{innerRef:l,chip:null,align:"left","data-test":"shopping-list-populated-card","aria-labelledby":A,onClick:M,...o,children:[s.jsx(Oe.Action.Options,{children:s.jsx(_w,{shoppingListId:E,name:y,listProductIds:N})}),s.jsx(Oe.Action.Header,{id:A,children:s.jsx(Oe.Action.HeaderText,{"data-pii":"true",singleLine:!0,children:y})}),s.jsxs(Oe.Action.Body,{children:[s.jsxs(Q,{className:"salt-m-b--2",children:[s.jsxs(O,{className:"salt-m-r--1",children:[_.discountedPrice,u&&s.jsx("span",{className:"salt-m-l--1",children:s.jsx(b,{id:"order.details.tax.inclusive.price"})})]}),s.jsx(Ts,{orientation:"vertical"}),s.jsx(O,{className:"salt-m-x--2",children:_.numberOfItems}),S>0&&s.jsxs(h.Fragment,{children:[s.jsx(Ts,{orientation:"vertical"}),s.jsx(O,{className:"salt-m-x--2",intent:"promotion",children:_.numberOfOffers})]})]}),s.jsx(mit,{children:w()})]}),s.jsx(Oe.Action.Footer,{children:s.jsxs(Q,{wrap:"nowrap",children:[s.jsx(x,{className:"salt-m-r--2",intent:"secondary",fill:!0,asChild:!0,"data-test":"view-list-button","aria-label":R,children:s.jsx(Ye,{intent:"ghost",href:r0(E),children:s.jsx(x.Text,{children:_.viewList})})}),s.jsx(x,{className:"salt-m-l--2",intent:"action",fill:!0,onClick:k,"data-test":"shopping-list-populated-card-add-all","aria-label":P,loading:p,children:s.jsx(x.Text,{children:_.addAll})})]})})]})},zls=({...e})=>{const t=L(),n=F(),o=()=>{n(J.openModal(Cc.CREATE))};return s.jsx(Oe.Action,{"aria-label":t.formatMessage("shopping.list.page.create.new.list.button"),chip:null,innerRef:null,...e,children:s.jsx(x,{intent:"secondary",fill:!0,onClick:o,"data-test":"create-list-modal-button",children:s.jsx(x.Text,{children:s.jsx(b,{id:"shopping.list.page.create.new.list.button"})})})},"new-list-card")},Qls=({shoppingLists:e})=>{const t=dr(),n=ft(),o=h.useRef();h.useEffect(()=>(o.current=new $ls({currentBreakpoint:t}),()=>o.current?.destroy()),[]);const r=(a,i,l)=>{n({type:ls.LIST_CARD_IMPRESSION,listCardImpression:{LIST_ID:a,LIST_SEQUENCE:i,LIST_TOTAL_UNITS:l}})};return s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h1",children:s.jsx(b,{id:"shopping.lists.page.header","data-test":"shopping-lists-header"})})}),s.jsx("div",{className:"salt-m-x--2 salt-m-t--4 md:salt-m-x--8 lg:salt-m-x--32",children:s.jsxs(Oe.Collection,{"data-test":"shopping-list",lg:3,md:2,sm:2,children:[s.jsx(zls,{}),e.map((a,i)=>a.productCount===0?s.jsx(Vls,{name:a.name,shoppingListId:a.shoppingListId,viewportImpressionOfElement:o.current,onFirstImpression:()=>r(a.shoppingListId,i,e.length)},a.shoppingListId):s.jsx(Kls,{shoppingList:a,onFirstImpression:()=>r(a.shoppingListId,i,e.length),viewportImpressionOfElement:o.current},a.shoppingListId))]})})]})},_x=({...e})=>s.jsxs(Oe.Action,{chip:null,innerRef:null,"data-test":"placeholder-card",...e,children:[s.jsx(Oe.Action.Header,{children:s.jsx(_e,{className:"salt-m-b--2",height:"25px"})}),s.jsx(Oe.Action.Body,{children:s.jsxs(Q,{wrap:"nowrap",children:[s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px"})]})}),s.jsx(Oe.Action.Footer,{children:s.jsxs(Q,{wrap:"nowrap",children:[s.jsx(_e,{className:"salt-d--inline-block salt-m-r--0.5",height:"40px"}),s.jsx(_e,{className:"salt-d--inline-block",height:"40px"})]})})]}),Xls=()=>s.jsxs(Oe.Collection,{"data-test":"shopping-lists-skeleton",className:"salt-m-x--2 salt-m-t--4 md:salt-m-x--8 lg:salt-m-x--32",lg:3,md:2,sm:2,children:[s.jsx(_x,{},1),s.jsx(_x,{},2),s.jsx(_x,{},3)]}),Ele=e=>{const t=()=>e.type==="LISTS_PAGE"?s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-b--8",children:s.jsx(Os,{titleIcon:"list",title:"shopping.lists.no.results.title",titleAs:"h1",description:"shopping.lists.no.results.subtext"})}),s.jsx(zL,{})]}):s.jsxs(h.Fragment,{children:[s.jsx("div",{className:"salt-m-b--8",children:s.jsx(Os,{titleIcon:"list",title:"shopping.lists.details.empty.title",titleAs:"h2",description:"shopping.lists.details.empty.subtext"})}),s.jsx(hle,{shoppingListId:e.shoppingListId})]});return s.jsx(V,{fixed:!0,className:"salt-m-y--16","data-test":"no-shopping-lists",children:s.jsx(V.Item,{colStart:{xs:2,sm:3,md:4,lg:5},colSpan:{xs:10,sm:8,md:6,lg:4},children:t()})})},bw=({headerLabelId:e,isOpen:t,onClose:n,title:o,children:r})=>{const[a]=Ee(["m.la.h"]);return s.jsxs(B,{isOpen:t,onRequestClose:n,aria:{labelledby:e},children:[s.jsx(B.Header,{align:a?"left":"center",children:s.jsx(ee,{as:"h1",id:e,"data-test":e,children:o||""})}),s.jsx(B.Body,{children:r})]})},Zls=()=>{const e=F(),{formatMessage:t}=L(),n=f($e(Cc.CREATE)),o=()=>{e(J.closeModal())};return s.jsx(bw,{isOpen:n,onClose:o,headerLabelId:"create-shopping-list-modal-header",title:t("shopping.lists.action.modal.create.title"),children:s.jsx(zL,{onSubmit:o})})},Jls=v(O)`
    text-align: ${({textAlign:e})=>IE(e)};
`,ecs=ia(`
    mutation ShoppingListDelete($shoppingListDeleteInput: ShoppingListDeleteInput!) {
        shoppingListDelete(shoppingListDeleteInput: $shoppingListDeleteInput) {
            success
        }
    }
`),tcs=({shoppingListId:e,name:t,listProductIds:n,onSuccess:o})=>{const r=F(),[a]=Ee(["m.la.h"]),[{fetching:i},l]=Ep(ecs),c=ft(),d=MT(),u=()=>{c({type:ls.DELETE_LIST_MODAL_DISPLAYED,listId:e,userAction:oG.CANCEL}),r(J.closeModal())},p=async()=>{c({type:ls.DELETE_LIST_MODAL_DISPLAYED,listId:e,userAction:oG.DELETE});const{data:g}=await l({shoppingListDeleteInput:{shoppingListId:e}},{additionalTypenames:["ShoppingList"]});g?.shoppingListDelete?.success?(o?.(),c({type:ls.LIST_DELETED,listId:e}),d.sendDeleteListEvent(),n.length>0&&await r(av({productIds:n,ignoreProductCache:!0}))):Z.error("request.error.title"),r(J.closeModal())};return s.jsxs(h.Fragment,{children:[s.jsx(Jls,{className:"salt-d--block",size:"l",textAlign:a?"left":"center","data-pii":"true","data-test":"delete-shopping-list-name",children:s.jsx(b,{id:"shopping.lists.form.delete.message",values:{listName:t}})}),s.jsxs(Q,{className:"salt-p-t--8",direction:"row",wrap:"nowrap",children:[s.jsx(x,{className:"salt-m-x--2",intent:"secondary",onClick:u,fill:!0,"data-test":"delete-shopping-list-cancel-button",loading:i,children:s.jsx(x.Text,{children:s.jsx(b,{id:"shopping.lists.form.delete.cancel.button"})})}),s.jsx(x,{intent:"primary",onClick:p,fill:!0,"data-test":"delete-shopping-list-submit-button",loading:i,children:s.jsx(x.Text,{children:s.jsx(b,{id:"shopping.lists.form.delete.submit.button"})})})]})]})},fle=({onSuccess:e})=>{const{formatMessage:t}=L(),n=F(),o=ft(),r=f($e(Cc.DELETE)),a=f(Yn(Cc.DELETE))??{shoppingListId:"",name:"",listProductIds:[]};if(!r||!a?.shoppingListId||!a?.name)return null;const i=()=>{n(J.closeModal()),o({type:ls.LIST_ACTIONS_MODAL_DISPLAYED,listId:a?.shoppingListId,userAction:wh.Close})};return s.jsx(bw,{isOpen:r,title:t("shopping.lists.action.modal.delete.title"),headerLabelId:"delete-shopping-list-modal-header",onClose:i,children:s.jsx(tcs,{shoppingListId:a.shoppingListId,name:a.name,listProductIds:a.listProductIds??[],onSuccess:e})})},scs=ia(`
    mutation ShoppingListUpdateName($shoppingListUpdateNameInput: ShoppingListUpdateNameInput!) {
        shoppingListUpdateName(shoppingListUpdateNameInput: $shoppingListUpdateNameInput) {
            shoppingList {
                __typename
                shoppingListId
                name
            }
            success
            failureReason
        }
    }
`),ncs=({shoppingListId:e,name:t})=>{const{formatMessage:n}=L(),o=h.useRef(null),r=F(),[{fetching:a},i]=Ep(scs),l=ft(),c=()=>{r(J.closeModal()),l({type:ls.EDIT_NAME_MODAL_DISPLAYED,listId:e,userAction:rG.CANCEL})},d=async u=>{u.preventDefault();const g=new FormData(u.currentTarget).get("shopping-list");l({type:ls.EDIT_NAME_MODAL_DISPLAYED,listId:e,userAction:rG.SAVE});const{data:E,error:y}=await i({shoppingListUpdateNameInput:{shoppingListId:e,name:String(g)}});if(E?.shoppingListUpdateName?.success&&E?.shoppingListUpdateName?.shoppingList){const{shoppingList:I}=E.shoppingListUpdateName;l({type:ls.LIST_NAME_CHANGED,listId:I.shoppingListId})}if(!E?.shoppingListUpdateName?.success&&E?.shoppingListUpdateName?.failureReason){const{failureReason:I}=E.shoppingListUpdateName,S="request.error.title";if(I===Cet.ListNameInvalid){const C=o.current?.elements.namedItem("shopping-list");if(C instanceof HTMLInputElement){C.setCustomValidity(n("shopping.list.create.invalid.name")),C.reportValidity();return}}Z.error(S)}y&&!E?.shoppingListUpdateName&&Z.error("request.error.title"),r(J.closeModal()),o.current?.reset()};return s.jsxs(fs,{ref:o,id:"list-form",onSubmit:d,children:[s.jsx(rZ,{className:"salt-m-b--2",defaultValue:t}),s.jsxs("div",{className:"salt-d--flex salt-gap--2 salt-m-t--8",children:[s.jsx(x,{intent:"secondary",onClick:c,fill:!0,"data-test":"update-shopping-list-name-cancel-button",loading:a,children:s.jsx(x.Text,{children:n("shopping.lists.form.update.cancel.button")})}),s.jsx(x,{intent:"primary",fill:!0,type:"submit","data-test":"update-shopping-list-name -submit-button",loading:a,children:s.jsx(x.Text,{children:n("shopping.lists.form.update.submit.button")})})]})]})},yle=()=>{const{formatMessage:e}=L(),t=F(),n=ft(),o=f($e(Cc.UPDATE_NAME)),r=f(Yn(Cc.UPDATE_NAME))??{shoppingListId:"",name:""};if(!o||!r?.shoppingListId||!r?.name)return null;const a=()=>{t(J.closeModal()),n({type:ls.LIST_ACTIONS_MODAL_DISPLAYED,listId:r?.shoppingListId,userAction:wh.Close})};return s.jsx(bw,{isOpen:o,title:e("shopping.lists.action.modal.update.title"),headerLabelId:"update-shopping-list-name-modal-header",onClose:a,children:s.jsx(ncs,{shoppingListId:r.shoppingListId,name:r.name})})},Ile=100,Sle=5,Cle=ia(`
    query GetShoppingLists(
        $width: Int!
        $isAlcoholBlurringEnabled: Boolean!
        $isAgeRestrictedVisibilityEnabled: Boolean!
        $first: Int
    ) {
        shoppingLists {
            shoppingListId
            name
            productCount
            offerCount
            prices {
                discountedPrice {
                    amount
                    currency
                }
            }
            products(first: $first) {
                productId
                description
                isAlcohol @include(if: $isAlcoholBlurringEnabled)
                primaryImage(width: $width) {
                    url
                }
                restrictions @include(if: $isAgeRestrictedVisibilityEnabled) {
                    restrictedVisibility
                }
            }
        }
    }
`),vle={additionalTypenames:["ShoppingList"]},ocs=()=>{const[e,t]=Ee([EL,bT]),[{data:n,fetching:o,error:r}]=Kd({query:Cle,variables:{width:Ile,isAgeRestrictedVisibilityEnabled:!!t,isAlcoholBlurringEnabled:!!e,first:Sle},context:vle}),a=F(),i=ft();h.useEffect(()=>{!r&&n?.shoppingLists&&i({type:ls.LIST_TOTAL_COUNT,count:n.shoppingLists.length})},[n?.shoppingLists.length]),h.useEffect(()=>{!o&&!r&&n?.shoppingLists&&a(ds({name:dAe}))},[o]);const l=()=>o?s.jsx(Xls,{}):r||!n?s.jsx(jn,{showRefreshLink:!0,statusCode:500}):n?.shoppingLists.length===0?s.jsx(Ele,{type:"LISTS_PAGE"}):s.jsx(Qls,{shoppingLists:n.shoppingLists});return s.jsxs(zT,{activeTab:pa.SHOPPING_LISTS,children:[s.jsx(bt,{title:"shopping.lists.page.title"}),l(),s.jsx(Zls,{}),s.jsx(yle,{}),s.jsx(fle,{})]})},Tle=()=>s.jsx(Et,{type:"ShoppingLists::route",children:s.jsx(ocs,{})});Tle.fetchData=async({context:e})=>{const{store:t,urqlClient:n}=e,o=D(EL)(t.getState()),r=D(bT)(t.getState());await Promise.allSettled([t.dispatch(QT()),n.query(Cle,{width:Ile,isAlcoholBlurringEnabled:o,isAgeRestrictedVisibilityEnabled:r,first:Sle},vle)])};const iH=({name:e,shoppingListId:t,productCount:n,prices:{basePrice:o,discountedPrice:r,savings:a},lastModifiedDateTime:i,productIds:l})=>{const[c,d,u]=Ee(["prp","sib","s.tax"]),p=f(cr),{fetching:g,addListToBasket:E}=gle(),y=h.useMemo(()=>qs(p,i),[i]),I=!!Number(a?.amount),S=async()=>{await E(t)};return s.jsxs("div",{className:"salt-m-t--0 salt-m-r-0 salt-m-b--4",children:[s.jsxs(xe,{children:[s.jsxs(Q,{className:"salt-m-t--0 salt-m-r-0 salt-m-b--4",justify:"space-between",children:[s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"shopping.lists.summary.title","data-test":"shopping-lists-summary-title"})}),s.jsx(_w,{shoppingListId:t,name:e,listProductIds:l})]}),s.jsxs(fe,{children:[s.jsx(le.Items,{itemsRetailPrice:o,quantity:n,withTaxNote:u}),s.jsx(le.Savings,{savings:a}),d&&c&&I&&s.jsx(ui,{isSummarySection:!0,className:"salt-m-b--2"})]}),s.jsx(Ts,{className:"salt-m-y--2","data-test":"shopping-lists-summary-divider"}),s.jsx(le.TotalInline,{totalPrice:r,withTaxNote:u}),s.jsx(le.Buttons,{children:s.jsx(x,{className:"salt-m-t--4",intent:"action",fill:!0,onClick:S,"data-test":"shopping-lists-add-all",loading:g,children:s.jsx(x.Text,{children:s.jsx(b,{id:"shopping.lists.summary.add.all"})})})})]}),s.jsx("div",{className:"salt-m-t--2 salt-m-r--0 salt-m-b--4",children:s.jsx(O,{size:"m","data-test":"shopping.list.details.last.updated",children:s.jsx(b,{id:"shopping.list.details.last.updated",values:{lastUpdated:y}})})})]})},rcs=({shoppingList:{shoppingListId:e,productCount:t,lastModifiedDateTime:n,prices:o,products:r,name:a}})=>{const i=F(),l=f(mo)??{},c=h.useMemo(()=>r.map(d=>d.productId),[r]);return s.jsxs("div",{children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:8,lg:9},children:s.jsx(uo,{type:"catalogue",page:"shopping-list",productGroups:[{products:c}],productsByProductId:l,isFetching:!1,onInitialFopLoad:()=>i(ds({name:GF}))})}),s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:4,lg:3},children:s.jsx(iH,{shoppingListId:e,name:a,prices:o,productCount:t,lastModifiedDateTime:n,productIds:c})})]})}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:4,lg:3},children:s.jsx(iH,{shoppingListId:e,name:a,prices:o,productCount:t,lastModifiedDateTime:n,productIds:c})}),s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:8,lg:9},children:s.jsx(uo,{type:"catalogue",page:"shopping-list",productGroups:[{products:c}],productsByProductId:l,isFetching:!1,onInitialFopLoad:()=>i(ds({name:GF}))})})]})})]})},Oy=v(Oe.Action)`
    inline-size: 100%;
`,lH=()=>s.jsx(Oe.Collection,{"data-test":"shopping-list-details-skeleton",className:"salt-m-t--4",lg:3,md:2,sm:2,children:s.jsxs(Oy,{chip:null,innerRef:null,"data-test":"placeholder-card",children:[s.jsx(Oy.Header,{children:s.jsx(_e,{className:"salt-m-b--2",height:"25px"})}),s.jsx(Oy.Body,{children:s.jsxs(Q,{wrap:"nowrap",children:[s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px",className:"salt-m-r--2"}),s.jsx(_e,{height:"50px",width:"50px"})]})}),s.jsx(Oy.Footer,{children:s.jsxs(Q,{wrap:"nowrap",children:[s.jsx(_e,{className:"salt-d--inline-block salt-m-r--0.5",height:"40px"}),s.jsx(_e,{className:"salt-d--inline-block",height:"40px"})]})})]})}),acs=()=>s.jsxs("div",{className:"salt-m-t--16",children:[s.jsx(Kt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:8,lg:9},children:s.jsx(uo,{type:"catalogue",page:"shopping-list",productGroups:[{products:[]}],productsByProductId:{},isFetching:!0})}),s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:4,lg:3},children:s.jsx(lH,{})})]})}),s.jsx(Lt,{breakpoint:"sm-up",remainInDom:!1,children:s.jsxs(V,{children:[s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:4,lg:3},children:s.jsx(lH,{})}),s.jsx(V.Item,{colSpan:{xs:12,sm:12,md:8,lg:9},children:s.jsx(uo,{type:"catalogue",page:"shopping-list",productGroups:[{products:[]}],productsByProductId:{},isFetching:!0})})]})})]}),_le=ia(`
    query GetShoppingList($shoppingListId: ID!) {
        shoppingList(shoppingListId: $shoppingListId) {
            shoppingListId
            name
            productCount
            offerCount
            lastModifiedDateTime
            prices {
                basePrice {
                    amount
                    currency
                }
                discountedPrice {
                    amount
                    currency
                }
                savings {
                    amount
                    currency
                }
            }
            products {
                productId
            }
        }
    }
`),ics=()=>{const e=L(),t=F(),n=Ge(),{listId:o}=nn(),[{data:r,fetching:a,error:i}]=Kd({query:_le,variables:{shoppingListId:o}}),l=ft(),c=(E,y)=>Array.isArray(y)&&y.some(I=>I.path?.includes("shoppingList")&&I.extensions?.code===E),d=c("not-found",i?.graphQLErrors),u=c("bad-request",i?.graphQLErrors);if(h.useEffect(()=>{l({type:ls.LIST_ID,listId:o})},[]),h.useEffect(()=>{!r?.shoppingList?.products.length&&!a&&t(J.closeModal())},[r?.shoppingList?.products,a]),a)return s.jsx(acs,{});if(d)return s.jsx(ot,{});if(i||!r?.shoppingList)return s.jsx(jn,{showRefreshLink:!0,statusCode:u?400:500});const{shoppingList:p}=r,g=()=>{n(jp())};return s.jsxs(h.Fragment,{children:[s.jsxs(sn,{children:[s.jsx(bt,{title:"shopping.lists.subpage.title",values:{subPageName:p.name,separator:e.formatMessage("page.title.separator"),rootPageName:e.formatMessage("shopping.lists.page.title")}}),s.jsx(rm,{className:"md:salt-m-y--2",preface:null,trail:[{name:e.formatMessage("shopping.lists.breadcrumb.preface"),url:jp()},{name:s.jsx("span",{"data-pii":"true",children:p.name})}],linkElement:Ye})]}),p.products.length===0?s.jsx(Ele,{type:"DETAILS_PAGE",shoppingListId:p.shoppingListId}):s.jsxs(h.Fragment,{children:[s.jsx(ie,{asChild:!0,children:s.jsx(ee,{as:"h2",children:s.jsx(b,{id:"catalogue.products.heading"})})}),s.jsx(rcs,{shoppingList:p}),s.jsx(yle,{}),s.jsx(fle,{onSuccess:g})]})]})},ble=()=>s.jsx(Et,{type:"ShoppingListDetails::route",children:s.jsx(ics,{})});ble.fetchData=async({context:e,params:t})=>{const{store:n,urqlClient:o}=e,{listId:r}=t,a=await o.query(_le,{shoppingListId:r});if(a?.data?.shoppingList?.products.length){const i=a.data.shoppingList.products.map(({productId:l})=>l);await n.dispatch(av({productIds:i.slice(0,30),ignoreProductCache:!0}))}};const lcs=e=>[{path:"/lists",Component:e.Main,key:"main",children:[{index:!0,Component:$s(Xe,Tle)},{path:":listId",Component:$s(Xe,ble)}]}],ccs=({items:e=[],id:t="",name:n=""})=>s.jsx(Vee,{id:t,items:e,name:n,meta:{PAGE_TYPE:null,PAGE_NAME:"static_page",BANNER_PLACEMENT:"HERO",LOCATION:"CONTENT_PAGE"}}),dcs=ae.memo(ccs,(e,t)=>e.id===t.id),ucs=()=>{const e=F(),[t]=Ee(["cf.sp.comp"]),{pageId:n,content:o,pageTitle:r,componentItems:a,isFetching:i,fetchError:l}=f(noe),c=nn();return h.useEffect(()=>{n!==c.pageId&&e(F8(c.pageId))},[c.pageId]),i?s.jsx("div",{className:"salt-m-t--32",children:s.jsx(_s,{size:"m"})}):l?s.jsx(ot,{}):t&&a&&n?s.jsx("div",{"data-test":"static-page-componentized",className:"salt-m-t--4 salt-m-b--2 salt-m-x--2",children:s.jsx(dcs,{id:n,items:a,name:r})}):o?s.jsxs(h.Fragment,{children:[s.jsx(bt,{title:r,skipFormatTitle:!0}),s.jsx("div",{"data-test":"static-page",dangerouslySetInnerHTML:{__html:o}})]}):s.jsx(ot,{})},xle=()=>s.jsx(Et,{type:"FailedPaymentSummary::route",children:s.jsx(ucs,{})});xle.fetchData=async({store:e,params:t})=>e.dispatch(F8(t.pageId));const pcs=e=>[{path:"/content/:pageId",Component:e.Main,key:"main",children:[{index:!0,Component:xle}]}],Ps={Main:yoe,Checkout:Soe},mcs=[{path:"/",Component:d9,children:[...Crt(Ps),...xst(Ps),...oyt(Ps),...xQt(Ps),...uns(Ps),...Ljt(Ps),...lWt(Ps),...JZt(Ps),...cos(Ps),...mss(Ps),...O9t(Ps),...xls(Ps),...q3t(Ps),...c8t(Ps),...TQt(Ps),...jos(Ps),...$Ct(Ps),...Xbt(Ps),...Pos(Ps),...lcs(Ps),...Trt(),...pcs(Ps),...bss(Ps),...Uls(Ps),...xgt(Ps),...h9t(Ps),...kQt(Ps),...qCt(Ps),...jWt(Ps),{path:"*",Component:Ps.Main,key:"main",children:[{path:"*",Component:ot}]}]}],hcs=(e,t)=>{const o={...Qe.parse(e.search),error:void 0},r=Qe.stringify(o),a=r?`${e.pathname}?${r}`:e.pathname;t(a)},sc={authenticationError:"authenticationError",logoutError:"logoutError",customerDisabled:"customerDisabled",paypal:"paypal",changeCredentialsError:"changeCredentialsError"},gcs={[sc.customerDisabled]:"common.login.customerDisabled",[sc.authenticationError]:"toast.notification.generic.error",[sc.logoutError]:"toast.notification.generic.error",[sc.paypal]:"toast.notification.generic.error",[sc.changeCredentialsError]:"toast.notification.generic.error"};function Ecs(e){return typeof e=="string"&&e in sc}const fcs=()=>{const e=F(),t=Ge(),n=Ne(),o=r=>{e(U.analyticsEvent({type:on.LOGIN_FAILURE_ANALYTICS,error:r}));const a={event:"event",eventAction:"LoginFailure",eventLabel:r,eventCategory:"Login"};te.sendEvent({GA:a,WA:null})};return h.useEffect(()=>{const a=new URLSearchParams(n.search).get("error"),i=a===sc.authenticationError||a===sc.customerDisabled;Ecs(a)&&(i&&o(a),Z.error(gcs[a]),hcs(n,t))},[]),null},ycs=()=>{const e=Ne(),t=Hg(),[n,o]=h.useState(e);return h.useEffect(()=>{e!==n&&t==="PUSH"&&(o(e),e.state?.persistScroll||window.scrollTo(0,0))},[e,t]),null},Ics=e=>Uce({sdkKey:e,logLevel:"warn"}),Scs=({children:e})=>{const t=es("optimizely-sdk-key"),n=f(AR),o=ae.useMemo(()=>t?Ics(t):void 0,[t]);return o?s.jsx(Gce,{optimizely:o,user:{id:n??null},children:e}):s.jsx(ae.Fragment,{children:e})},Ccs=({store:e,helmetContext:t={}})=>{const n=e.getState(),o=ae.useMemo(()=>At(n),[]),r=ae.useMemo(()=>D("faro")(n),[]);return s.jsx(gR,{store:e,children:s.jsx($ce,{context:t,children:s.jsx(Scs,{children:s.jsxs(h.Fragment,{children:[s.jsx(XJe,{}),s.jsx(Hce,{basename:o,children:s.jsx(net,{children:s.jsxs(ZJe,{children:[s.jsx(ycs,{}),s.jsx(fcs,{}),s.jsx(set,{children:s.jsx(d0t,{children:o9(mcs,!0,r?Vce:cR)})})]})})})]})})})})};Vt.updateLocale("ar-sa",{preparse:e=>e,postformat:e=>e});const vcs={};Kde();lR.hydrateRoot(document.getElementById("app"),s.jsx(Ccs,{store:zJe,helmetContext:vcs}));
//# sourceMappingURL=index-DXvMVHkz.js.map
